<!DOCTYPE html><html lang="en" class="blogpost-view-page"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1, shrink-to-fit=no"/><meta data-react-helmet="true" name="description" property="og:description" content="EKS, AWS, Secrets Manager, Kubernetes, Security"/><meta data-react-helmet="true" name="keywords" content="EKS,AWS,Secrets Manager,Terraform,Security"/><meta data-react-helmet="true" name="author" content="@RajhiSaifeddine"/><meta data-react-helmet="true" property="og:title" content="Manage secrets in AWS EKS with AWS Secrets Manager securely - Blog"/><meta data-react-helmet="true" property="og:type" content="article"/><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"/><meta data-react-helmet="true" name="twitter:creator" content="@RajhiSaifeddine"/><meta data-react-helmet="true" name="twitter:title" content="Manage secrets in AWS EKS with AWS Secrets Manager securely - Blog"/><meta data-react-helmet="true" name="twitter:description" content="EKS, AWS, Secrets Manager, Kubernetes, Security"/><meta data-react-helmet="true" name="image" property="og:image" content="https://seifrajhi.github.io/static/ff6d20c44d5aeda3f918a6e6c9dcc495/47056/eks-secrets-manager.png"/><meta data-react-helmet="true" name="twitter:image" content="https://seifrajhi.github.io/static/ff6d20c44d5aeda3f918a6e6c9dcc495/47056/eks-secrets-manager.png"/><meta data-react-helmet="true" property="og:url" content="https://seifrajhi.github.io/blog/eks-and-aws-secrets-manager/"/><meta name="theme-color" content="#ffffff"/><link rel="stylesheet" href="/styles.19780313cdbeec1e4ef5.css"/><link rel="stylesheet"/><link rel="alternate" type="application/rss+xml" title="Saifeddine Rajhi&#x27;s Blog RSS Feed" href="/rss.xml"/><title data-react-helmet="true">Manage secrets in AWS EKS with AWS Secrets Manager securely - Blog by Saifeddine Rajhi</title><script data-react-helmet="true" type="application/ld+json">{"@context":"http://schema.org","@type":"BlogPosting","image":"/static/ff6d20c44d5aeda3f918a6e6c9dcc495/47056/eks-secrets-manager.png","headline":"Manage secrets in AWS EKS with AWS Secrets Manager securely","dateCreated":"2024-10-13","datePublished":"2024-10-13","dateModified":"2024-10-13","inLanguage":"en-US","isFamilyFriendly":true,"isAccessibleForFree":true,"author":{"@type":"Person","name":"Saifeddine Rajhi","url":"https://seifrajhi.github.io"},"publisher":{"@type":"Organization","name":"Saifeddine Rajhi's Website"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://seifrajhi.github.io/blog/eks-and-aws-secrets-manager/"},"keywords":["EKS","AWS","Secrets Manager","Terraform","Security"],"genre":["Platform engineer","software engineering","science","deep learning","statistics"],"articleSection":"Technical Blog","articleBody":"\n> **Enhance security and simplify secrets management for K8s apps**\n\n## üóØ Introduction\n\nManaging secrets like API keys and database passwords securely is important to keep the applications running in Kubernetes secure.\n\nAnd if you're using Amazon EKS Elastic Kubernetes Service for your Kubernetes applications, AWS KMS with AWS Secrets Manager can help you handle these secrets safely and easily.\n\n## „äôÔ∏è Using AWS Secrets Manager with Amazon¬†EKS\n\n[AWS Secrets Manager](https://docs.aws.amazon.com/secretsmanager/latest/userguide/integrating_csi_driver.html) can be integrated with EKS using the [AWS Secrets and Configuration Provider ASCP](https://github.com/aws/secrets-store-csi-driver-provider-aws) for the [Kubernetes Secrets Store CSI Driver](https://secrets-store-csi-driver.sigs.k8s.io/).\n\n**Benefits:**\n\n- Centralized secret management\n- Fine-grained access control\n- Seamless integration with EKS\n- Ability to mount secrets as volumes in pods\n- Option to sync with native Kubernetes secrets\n\n\n\n**Implementation steps:**\n\n1. Create secrets in AWS Secrets Manager\n2. Create an IAM policy for secret retrieval\n3. Use [IAM Roles for Service Accounts (IRSA)](https://docs.aws.amazon.com/eks/latest/userguide/iam-roles-for-service-accounts.html) to limit secret access\n4. Deploy a SecretProviderClass custom resource\n5. Configure pods to mount volumes based on the SecretProviderClass\n6. Sync mounted secrets to native Kubernetes secrets\n7. Set up environment variables in pods using specific secret keys\n\n\n\n## Encrypting Kubernetes Secrets in Amazon¬†EKS\n\nAmazon EKS clusters (version 1.13+) support encrypting [Kubernetes secrets](https://kubernetes.io/docs/concepts/configuration/secret/) using [AWS Key Management Service (KMS) Customer Managed Keys (CMK)](https://docs.aws.amazon.com/kms/latest/developerguide/concepts.html). This provides stronger security than the default Base64 encoding.\nKey points:\n\n- No changes are required in how secrets are used.\n- Encryption provider support must be enabled during EKS cluster creation\n- Each secret write generates a unique Data Encryption Key (DEK).\n- The DEK is encrypted with the CMK and stored in etcd.\n- Decryption occurs when pods access the secret.\n\n## EKS Secrets and Secrets Manager hands-on¬†guide\n\nLet us start by provisioning our EKS cluster using Terraform the IAC tool.\n\nFirst, clone the repo:\n\n```shell\n$ git clone https://github.com/seifrajhi/eks-secrets-manager-kms-demo.git\n```\n\nThen run the following commands:\n\n```shell\n$ cd eks-secrets-manager-kms-demo/eks-tf\n$ terraform init\n$ terraform plan\n$ terraform apply --auto-approve\n```\n\nThis will provision the EKS cluster and VPC with the needed add-ons.\n\n## Deploy the¬†app\n\nTo deploy the app, clone the repo:\n\n```shell\n$ git clone https://github.com/seifrajhi/eks-secrets-manager-kms-demo.git\n```\n\nFor the deployment of our demo application, we have created the Helm chart and uploaded it to the [Git Repository](https://github.com/seifrajhi/eks-secrets-manager-kms-demo/tree/main/helm-charts).\n\nInstall the Helm chart:\n\n```shell\ncd eks-secrets-manager-kms-demo/helm-charts\nhelm install demo .\nNAME: demo\nLAST DEPLOYED: Sat Oct 11 18:42:20 2024\nNAMESPACE: default\nSTATUS: deployed\nREVISION: 1\n```\n\n### Deploy Amazon EBS CSI¬†Driver\n\n[The Container Storage Interface (CSI)](https://github.com/container-storage-interface/spec/blob/master/spec.md) is a standard for exposing arbitrary block and file storage systems to containerized workloads on Container Orchestration Systems (COs) like Kubernetes.\nUsing CSI third-party storage providers can write and deploy plugins exposing new storage systems in Kubernetes without ever having to touch the core Kubernetes code.\n\n[The Amazon Elastic Block Store (Amazon EBS) Container Storage Interface (CSI) driver](https://github.com/kubernetes-sigs/aws-ebs-csi-driver) provides a CSI interface that allows Amazon Elastic Kubernetes Service (Amazon EKS) clusters to manage the lifecycle of Amazon EBS volumes for persistent volumes.\n\nEBS was installed as part of the cluster add-ons.\n\n### Define Storage Class\n\n[Dynamic Volume Provisioning](https://kubernetes.io/docs/concepts/storage/dynamic-provisioning/) allows storage volumes to be created on-demand.\n\n[StorageClass](https://kubernetes.io/docs/concepts/storage/storage-classes/) should be pre-created to define which provisioner should be used and what parameters should be passed when dynamic provisioning is invoked.\n\n```yaml\nkind: StorageClass\napiVersion: storage.k8s.io/v1\nmetadata:\n  name: mysql-gp3\nprovisioner: ebs.csi.aws.com # <--  Amazon EBS CSI driver\nparameters:\n  type: gp3\n  encrypted: 'true' \nvolumeBindingMode: WaitForFirstConsumer\nreclaimPolicy: Delete\nmountOptions:\n- debug\n```\n\nCreate storageclass `mysql-gp3` by running the following command:\n\n```shell\nkubectl create -f sc-gp3-mysql.yaml\n```\n\n### Deploy StatefulSet workload\n\nWe are going to deploy a MYSQL database using StatefulSet.\n\n<div class=\"note\">\n    <p><strong>üîµ Note:</strong></p>\n    <p>The MySQL deployment consists of a ConfigMap, two Services, a Kubernetes secret for the root password and a StatefulSet.</p>\n</div>\n\nThe [ConfigMap](https://kubernetes.io/docs/tasks/configure-pod-container/configure-pod-configmap/) allows you to decouple configuration artifacts and secrets from image content to keep containerized applications portable. \n\nThe ConfigMap stores `source.cnf`, `replica.cnf` and passes them when initializing leader and follower pods defined in StatefulSet:\n\n* **source.cnf:** is for the MySQL leader pod which has binary log option (log-bin) to provides a record of the data changes to be sent to follower servers.\n* **replica.cnf:** is for follower pods which have super-read-only option.\n\n`mysql-cm.yaml` manifest:\n\n```Yaml\napiVersion: v1\nkind: ConfigMap\nmetadata:\n  name: mysql-config\n  namespace: workshop\n  labels:\n    app: mysql\ndata:\n  source.cnf: |\n    # Apply this config only on the leader.\n    [mysqld]\n    log-bin\n  replica.cnf: |\n    # Apply this config only on followers.\n    [mysqld]\n    # super-read-only\n```\n\nThen run:\n```shell\nkubectl create -f mysql-cm.yaml\n```\n\nStatefulSet requires a [Headless Service](https://kubernetes.io/docs/concepts/services-networking/service/#headless-services) to control the domain of its Pods, directly reach each Pod with stable DNS entries.\n\n> The Headless Service provides a home for the DNS entries that the StatefulSet controller creates for each Pod that's part of the set. By specifying \"None\" for the clusterIP, you can create Headless Service.\n>\n> Because the Headless Service is named mysql, the Pods are accessible by resolving¬†**`.mysql`** from within any other Pod in the same Kubernetes cluster and namespace.\n\nYou can see the `mysql service` is for DNS resolution so that when pods are placed by StatefulSet controller, pods can be resolved using pod-name.mysql.\n\nThe Client Service `mysql-read` is a normal client Service with its own cluster IP that distributes connections across all MySQL Pods that report being Ready.\n\nCreate service **mysql** and **mysql-read** by running the following commands:\n\n```Shell\n$ git clone https://github.com/seifrajhi/eks-secrets-manager-kms-demo.git\n$ cd eks-secrets-manager-kms-demo/demo-app\n$ kubectl create -f mysql-svc.yaml\n```\n\nStatefulSet consists of **serviceName**, **replicas**, **template** and **volumeClaimTemplates**:\n\n- serviceName is \"mysql\", headless service we created in previous section.\n- replicas is 2, the desired number of pod.\n- template is the configuration of pod.\n- volumeClaimTemplates is to claim volume for pod based on storageClassName gp3.\n\nRun the following command under demo-app directory:\n\n```shell\n$ kubectl apply -f statefulset.yaml\n```\n\n**Populate database:**\n\nWe are creating the database qa and products table in below command and inserting a products into the table. Later we will see how this data will show up in our application which is accessing this database.\n\n```shell\n$ kubectl -n workshop run mysql-client --image=mysql:5.7 -i --rm --restart=Never --\\\n  mysql -uroot -pdemo_ascp -h mysql-0.mysql.workshop <<EOF\nCREATE DATABASE qa;\nCREATE TABLE qa.products (prodId VARCHAR(120), prodName VARCHAR(120));\nINSERT INTO qa.products (prodId,prodName) VALUES ('999','Mountain Bike');\nEOF\n```\n\n## Kubernetes secrets encryption using AWS KMS\n\nWhen we deployed the MySQL database, and the kubernetes secret `mysql-secret` to hold the **password** for the database, the EKS control plane created a [Data Encryption Key (DEK)](https://docs.aws.amazon.com/sns/latest/dg/sns-server-side-encryption.html#sse-key-terms) to encrypt the secret, saved the encrypted secret to etcd and used [kms:encrypt](https://kubernetes.io/docs/tasks/administer-cluster/kms-provider/) to encrypt DEK and cached the encrypted DEK.\n\nLet's use the Kubernetes secret `mysql-secret` created while deploying the MySQL StatefulSet in the prodcatalog service to connect to the MYSQL database and show how EKS uses KMS to decrypt the Kubernetes secret `mysql-secret`.\n\n```Shell\n$ cd helm-charts\n$ helm upgrade --reuse-values -f values-k8s-secret.yaml demo .\n\nRelease \"demo\" has been upgraded. Happy Helming!\nNAME: demo\nLAST DEPLOYED: Sat Oct 11 19:20:20 2024\nNAMESPACE: default\nSTATUS: deployed\nREVISION: 3\n```\n\n**Validate Kubernetes Encryption using KMS:**\n\nNow let's validate that AWS KMS was used when we create and use the kubernetes secret.\n\nLog into console and navigate to `EKS ‚Üí Cluster ‚Üí Overview,` you will see the Secrets encryption as shown below:\n\n![alt text](kms-eks.png)\n\nThe EKS cluster was created with KMS encryption enabled and that is why your Secrets encryption is enabled.\n\n_Make a note of the KMS key ID._\n\nA **cloudtrail Decrypt** event corresponding to this KMS key ID should be available with sourceIpAddress as `eks.amazonaws.com`.\n\nIf you go to [CloudTrail](https://docs.aws.amazon.com/awscloudtrail/latest/userguide/cloudtrail-user-guide.html) you should see a record available if you search for the Event types Encrypt and Decrypt.\n\n### Mount secrets from AWS Secrets¬†Manager\n\nWe have the MYSQL StatefulSet deployed and now we are going to save the password for the MYSQL database in AWS Secrets Manager and sync the secrets manager secret to a Native Kubernertes secret using the [Secrets Store CSI driver](https://secrets-store-csi-driver.sigs.k8s.io/).\n\nThe Kubernetes secret created by the CSI driver will be used in the **productcatalog** service to connect to the MYSQL Database.\n\n**Install CSI Driver:**\n\nPrepare your cluster by installing Secrets Store CSI Secret driver and AWS Secrets and Configuration Provider (ASCP).\n\n```shell\nhelm repo add secrets-store-csi-driver https://kubernetes-sigs.github.io/secrets-store-csi-driver/charts\n```\n\nThen install the CSI driver:\n\n```shell\n$ helm install -n kube-system csi-secrets-store \\\n--set syncSecret.enabled=true \\\n--set enableSecretRotation=true \\\nsecrets-store-csi-driver/secrets-store-csi-driver\n```\n\nThen install AWS Secrets and Configuration [Provider ASCP](https://docs.aws.amazon.com/secretsmanager/latest/userguide/integrating_csi_driver.html):\n\n```shell\nhelm repo add aws-secrets-manager https://aws.github.io/secrets-store-csi-driver-provider-aws\nhelm install -n kube-system secrets-provider-aws aws-secrets-manager/secrets-store-csi-driver-provider-aws\n```\n\n**Prepare Secret and IAM access:**\n\nNext step, create a test secret in AWS Secrets Manager:\n\n```Shell\n$ aws secretsmanager create-secret \\\n--name DBSecret_eksdemo \\\n--description \"MYSQL DB Secret.\" \\\n--secret-string \"{\\\"username\\\":\\\"root\\\",\\\"password\\\":\\\"demo_ascp\\\"}\"\n```\n\nAfter that, create an IAM policy with permissions to access the secrets manager secret:\n\n```Shell\nexport IAM_POLICY_ARN_SECRET=$(aws iam \\\ncreate-policy --query Policy.Arn \\\n--output text --policy-name DBSecret_eksdemo_secrets_policy\\\n--policy-document '{\n\"Version\": \"2012-10-17\",\n\"Statement\": [ {\n\"Effect\": \"Allow\",\n\"Action\": [\"secretsmanager:GetSecretValue\", \"secretsmanager:DescribeSecret\"],\n\"Resource\": [\"'\"$SECRET_ARN\"'\" ]\n} ]\n}')\n\necho $IAM_POLICY_ARN_SECRET | tee -a 00_iam_policy_arn_dbsecret\n```\nNext, create an IAM Service Account IRSA to access the secrets manager secret:\n\n```shell\n$ eksctl create iamserviceaccount \\\n--name \"catalog-deployment-sa\" \\\n--cluster \"demo-eks-secrets-kms-bottlerocket\" \\\n--attach-policy-arn \"$IAM_POLICY_ARN_SECRET\" --approve \\\n--namespace workshop \\\n--override-existing-serviceaccounts\n```\n\n**Sync with Native Kubernetes Secrets:**\n\nWhen all is ready, we can create a SecretProviderClass custom resource and use jmesPath field in the spec file.\n\n> Use of [jmesPath](https://jmespath.org/) allows extracting specific key-value from a JSON-formatted secret. It is a provider-specific feature from ASCP.\n\n[secretObjects](https://secrets-store-csi-driver.sigs.k8s.io/topics/sync-as-kubernetes-secret) spec section allows specifying the Kubernetes native secret structure synced from the objects: extracted from the JSON formatted secret using jmesPath.\n\nThe feature is provided by the standard [Secret Store CSI Driver](https://secrets-store-csi-driver.sigs.k8s.io/topics/sync-as-kubernetes-secret.html).\n\n`SecretProviderClass.yaml` template:\n\n```yaml\napiVersion: secrets-store.csi.x-k8s.io/v1\nkind: SecretProviderClass\nmetadata:\n  name: catalog-deployment-spc-k8s-secrets\n  namespace: workshop\nspec:\n  provider: aws\n  parameters: \n    objects: |\n      - objectName: \"DBSecret_eksworkshop\"\n        objectType: \"secretsmanager\"\n        jmesPath:\n          - path: username\n            objectAlias: dbusername\n          - path: password\n            objectAlias: dbpassword\n  secretObjects:                \n    - secretName: mysql-secret-from-secrets-manager\n      type: Opaque\n      data:\n        - objectName: dbusername\n          key: db_username\n        - objectName: dbpassword\n          key: db_password\n```\n\nAfter, run the command:\n\n```Shell\nkubectl apply -f SecretProviderClass.yaml\n```\n\n**Create Pod Mount Secrets Volumes and set up environment variables:**\n\nNow let us Configure productcatalog service pod to mount volumes for individually extracted key-value pairs from the secrets. Once the pod is created with secrets volume mounts, the Secrets Store CSI Driver then creates and syncs Kubernetes secret object mysql-secret-from-secrets-manager¬†.\nThe pod then be able to populate Environment variables from the Kubernetes secret.\n\n```Shell\n$ cd helm-charts\n$ helm upgrade --reuse-values -f values-secrets-manager.yaml demo .\n\nRelease \"demo\" has been upgraded. Happy Helming!\nNAME: demo\nLAST DEPLOYED: Sat Oct 11 20:11:20 2024\nNAMESPACE: default\nSTATUS: deployed\nREVISION: 5\n```\n\n**üéâ Verify the result:**\n\nGet a shell prompt within the product catalog pod by running the following commands. Verify the secret mounted as separate files for each extracted key-value pair and corresponding environment variables set as well.\n\n```Shell\nexport PROD_CATALOG=$(kubectl get pods -n workshop -l app=prodcatalog -o jsonpath='{.items[].metadata.name}')\nkubectl -n workshop exec -it ${PROD_CATALOG} -c prodcatalog bash\n```\n\nWait for the root shell prompt within the pod.\nRun the following set of commands and watch the output in the pod's shell:\n\n```Shell\nexport PS1='# '\ncd /mnt/secrets\nls -l #--- List mounted secrets\ncat dbusername; echo\ncat dbpassword; echo\ncat DBSecret_eksworkshop; echo\nenv | grep MYSQL #-- Display the MYSQL_ROOT_PASSWORD ENV variables set from the secret value\n```\n\nThe output shows the information as displayed below:\n\n```Shell\n# cd /mnt/secrets\n# ls -l #--- List mounted secrets\ntotal 12\n-rw-r--r-- 1 root root 41 Oct 11 21:42 DBSecret_eksworkshop\n-rw-r--r-- 1 root root  8 Oct 11 21:42 dbpassword\n-rw-r--r-- 1 root root  4 Oct 11 21:42 dbusername\n# \n# cat dbusername; echo\nroot\n# cat dbpassword; echo\ndemo_ascp\n# cat DBSecret_eksworkshop; echo\n{\"username\":\"root\",\"password\":\"demo_ascp\"}\n# \n# env | grep MYSQL #-- Display the MYSQL_ROOT_PASSWORD ENV variables set from the secret value\nMYSQL_ROOT_PASSWORD=demo_ascp\nMYSQL_READ_PORT_3306_TCP_PORT=3306\nMYSQL_READ_PORT_3306_TCP_PROTO=tcp\nMYSQL_READ_PORT_3306_TCP=tcp://10.100.88.165:3306\nMYSQL_READ_SERVICE_HOST=10.100.88.165\nMYSQL_READ_SERVICE_PORT=3306\nMYSQL_READ_SERVICE_PORT_MYSQL=3306\nMYSQL_READ_PORT_3306_TCP_ADDR=10.100.88.165\nMYSQL_READ_PORT=tcp://10.100.88.165:3306\n```\n\nNotice under the path `/mnt/secrets` key-values pairs extracted in separate files based on jmesPath specification. Files `dbusername` and `dbpassword` contains extracted values from the JSON formatted secret `DBSecret_eksworkshop`\n\nThe Environment variable **MYSQL_ROOT_PASSWORD** is set up correctly. \n\nThe ENV var mapped from the Kubernetes secrets object `mysql-secret-from-secrets-manager` created automatically by the CSI driver.\nConfirm the presence of Kubernetes secrets. It was created automatically by the CSI driver during pod deployment.\n\n```shell\n$ kubectl describe secrets mysql-secret-from-secrets-manager -n workshop\nName: mysql-secret-from-secrets-manager\nNamespace: workshop\nLabels: secrets-store.csi.k8s.io/managed=true\nAnnotations: <none>\nType: Opaque\nDatadb_password: 8 bytes\ndb_username: 4 bytes\n```\n\n## üí¨ Key Takeaways\n\nUsing AWS Secrets Manager with Amazon EKS makes handling secrets in Kubernetes much safer and easier.\n\nIt helps keep your sensitive information secure and makes managing secrets simpler.\n\n**_Until next time, „Å§„Å•„Åè üéâ üáµüá∏_**\n\n<br><br>\n\n> üí° Thank you for Reading !! üôåüèªüòÅüìÉ, see you in the next blog.ü§ò  _**Until next time üéâ**_\n\nüöÄ Thank you for sticking up till the end. If you have any questions/feedback regarding this blog feel free to connect with me:\n\n**‚ôªÔ∏è LinkedIn:** https://www.linkedin.com/in/rajhi-saif/\n\n**‚ôªÔ∏è X/Twitter:** https://x.com/rajhisaifeddine\n\n**The end ‚úåüèª**\n\n<h1 align=\"center\">üî∞ Keep Learning !! Keep Sharing !! üî∞</h1>\n\n**References:**\n\n- https://docs.aws.amazon.com/secretsmanager/latest/userguide/integrating_csi_driver.html\n- https://aws.amazon.com/blogs/security/how-to-use-aws-secrets-configuration-provider-with-kubernetes-secrets-store-csi-driver/\n- https://catalog.workshops.aws/eks-immersionday/en-US/secrets-manager\n- https://aws.github.io/aws-eks-best-practices/security/docs/data/\n- https://youtu.be/CXbFkpugxyQ\n  \n**üìÖ Stay updated**\n\nSubscribe to our newsletter for more insights on AWS cloud computing and containers.\n","wordcount":1510}</script><script data-react-helmet="true" type="application/ld+json">{"@context":"http://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Home","item":"https://seifrajhi.github.io/"},{"@type":"ListItem","position":2,"name":"Blog","item":"https://seifrajhi.github.io/blog/"},{"@type":"ListItem","position":3,"name":"Manage secrets in AWS EKS with AWS Secrets Manager securely","item":"https://seifrajhi.github.io/blog/eks-and-aws-secrets-manager/"}]}</script><link crossorigin="" href="https://utteranc.es" rel="preconnect"/><link crossorigin="" href="https://www.google-analytics.com" rel="preconnect"/><style>.gatsby-image-wrapper{position:relative;overflow:hidden}.gatsby-image-wrapper picture.object-fit-polyfill{position:static!important}.gatsby-image-wrapper img{bottom:0;height:100%;left:0;margin:0;max-width:none;padding:0;position:absolute;right:0;top:0;width:100%;object-fit:cover}.gatsby-image-wrapper [data-main-image]{opacity:0;transform:translateZ(0);transition:opacity .25s linear;will-change:opacity}.gatsby-image-wrapper-constrained{display:inline-block;vertical-align:top}</style><noscript><style>.gatsby-image-wrapper noscript [data-main-image]{opacity:1!important}.gatsby-image-wrapper [data-placeholder-image]{opacity:0!important}</style></noscript><script type="module">const e="undefined"!=typeof HTMLImageElement&&"loading"in HTMLImageElement.prototype;e&&document.body.addEventListener("load",(function(e){const t=e.target;if(void 0===t.dataset.mainImage)return;if(void 0===t.dataset.gatsbyImageSsr)return;let a=null,n=t;for(;null===a&&n;)void 0!==n.parentNode.dataset.gatsbyImageWrapper&&(a=n.parentNode),n=n.parentNode;const o=a.querySelector("[data-placeholder-image]"),r=new Image;r.src=t.currentSrc,r.decode().catch((()=>{})).then((()=>{t.style.opacity=1,o&&(o.style.opacity=0,o.style.transition="opacity 500ms linear")}))}),!0);</script><link rel="icon" href="/favicon-32x32.png?v=47ae28bb567c9025f1fee24afb2d20c9" type="image/png"/><link rel="manifest" href="/manifest.webmanifest" crossorigin="anonymous"/><link rel="apple-touch-icon" sizes="48x48" href="/icons/icon-48x48.png?v=47ae28bb567c9025f1fee24afb2d20c9"/><link rel="apple-touch-icon" sizes="72x72" href="/icons/icon-72x72.png?v=47ae28bb567c9025f1fee24afb2d20c9"/><link rel="apple-touch-icon" sizes="96x96" href="/icons/icon-96x96.png?v=47ae28bb567c9025f1fee24afb2d20c9"/><link rel="apple-touch-icon" sizes="144x144" href="/icons/icon-144x144.png?v=47ae28bb567c9025f1fee24afb2d20c9"/><link rel="apple-touch-icon" sizes="192x192" href="/icons/icon-192x192.png?v=47ae28bb567c9025f1fee24afb2d20c9"/><link rel="apple-touch-icon" sizes="256x256" href="/icons/icon-256x256.png?v=47ae28bb567c9025f1fee24afb2d20c9"/><link rel="apple-touch-icon" sizes="384x384" href="/icons/icon-384x384.png?v=47ae28bb567c9025f1fee24afb2d20c9"/><link rel="apple-touch-icon" sizes="512x512" href="/icons/icon-512x512.png?v=47ae28bb567c9025f1fee24afb2d20c9"/><link rel="preload" as="font" type="font/woff2" crossorigin="anonymous" href="/static/webfonts/s/dancingscript/v25/If2cXTr6YS-zF4S-kcSWSVi_sxjsohD9F50Ruu7BMSo3Sup8.woff2"/><link rel="preload" as="font" type="font/woff2" crossorigin="anonymous" href="/static/webfonts/s/dancingscript/v25/If2cXTr6YS-zF4S-kcSWSVi_sxjsohD9F50Ruu7B1i03Sup8.woff2"/><link rel="preload" as="font" type="font/woff2" crossorigin="anonymous" href="/static/webfonts/s/ledger/v16/j8_q6-HK1L3if_sBnMrx.woff2"/><style>@font-face{font-display:swap;font-family:Dancing Script;font-style:normal;font-weight:400;src:url(/static/webfonts/s/dancingscript/v25/If2cXTr6YS-zF4S-kcSWSVi_sxjsohD9F50Ruu7BMSo3Sup8.woff2) format("woff2")}@font-face{font-display:swap;font-family:Dancing Script;font-style:normal;font-weight:700;src:url(/static/webfonts/s/dancingscript/v25/If2cXTr6YS-zF4S-kcSWSVi_sxjsohD9F50Ruu7B1i03Sup8.woff2) format("woff2")}@font-face{font-display:swap;font-family:Dancing Script;font-style:normal;font-weight:400;src:url(/static/webfonts/s/dancingscript/v25/If2cXTr6YS-zF4S-kcSWSVi_sxjsohD9F50Ruu7BMSo3Sup6.woff) format("woff")}@font-face{font-display:swap;font-family:Dancing Script;font-style:normal;font-weight:700;src:url(/static/webfonts/s/dancingscript/v25/If2cXTr6YS-zF4S-kcSWSVi_sxjsohD9F50Ruu7B1i03Sup6.woff) format("woff")}@font-face{font-display:swap;font-family:Ledger;font-style:normal;font-weight:400;src:url(/static/webfonts/s/ledger/v16/j8_q6-HK1L3if_sBnMrx.woff2) format("woff2")}@font-face{font-display:swap;font-family:Ledger;font-style:normal;font-weight:400;src:url(/static/webfonts/s/ledger/v16/j8_q6-HK1L3if_sBnMr3.woff) format("woff")}</style><link rel="preconnect" href="https://www.google-analytics.com"/><link rel="dns-prefetch" href="https://www.google-analytics.com"/><script>
  
  function gaOptout(){document.cookie=disableStr+'=true; expires=Thu, 31 Dec 2099 23:59:59 UTC;path=/',window[disableStr]=!0}var gaProperty='G-LLPCCGNLH7',disableStr='ga-disable-'+gaProperty;document.cookie.indexOf(disableStr+'=true')>-1&&(window[disableStr]=!0);
  if(true) {
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  }
  if (typeof ga === "function") {
    ga('create', 'G-LLPCCGNLH7', 'auto', {"alwaysSendReferrer":true});
      ga('set', 'anonymizeIp', true);
      
      
      
      
      }</script><link rel="preconnect" href="https://www.googletagmanager.com"/><link rel="dns-prefetch" href="https://www.googletagmanager.com"/><script async="" src="https://www.googletagmanager.com/gtag/js?id=G-LLPCCGNLH7"></script><script>
      
      function gaOptout(){document.cookie=disableStr+'=true; expires=Thu, 31 Dec 2099 23:59:59 UTC;path=/',window[disableStr]=!0}var gaProperty='G-LLPCCGNLH7',disableStr='ga-disable-'+gaProperty;document.cookie.indexOf(disableStr+'=true')>-1&&(window[disableStr]=!0);
      if(true) {
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-LLPCCGNLH7', {"anonymize_ip":true,"send_page_view":false});gtag('config', 'GTM-5V895PDS', {"anonymize_ip":true,"send_page_view":false});
      }
      </script><link rel="stylesheet"/><script>
    document.addEventListener("DOMContentLoaded", function(event) {
      var hash = window.decodeURI(location.hash.replace('#', ''))
      if (hash !== '') {
        var element = document.getElementById(hash)
        if (element) {
          var scrollTop = window.pageYOffset || document.documentElement.scrollTop || document.body.scrollTop
          var clientTop = document.documentElement.clientTop || document.body.clientTop || 0
          var offset = element.getBoundingClientRect().top + scrollTop - clientTop
          // Wait for the browser to finish rendering before scrolling.
          setTimeout((function() {
            window.scrollTo(0, offset - 0)
          }), 0)
        }
      }
    })
  </script><link rel="canonical" href="https://seifrajhi.github.io/blog/eks-and-aws-secrets-manager/" data-baseprotocol="https:" data-basehost="seifrajhi.github.io"/><link rel="sitemap" type="application/xml" href="/sitemap-index.xml"/></head><body><script>
void function() {
  window.__onThemeChange = function() {}

  var preferredTheme
  try {
    preferredTheme = localStorage.getItem('theme')
  } catch (err) { }

  function setTheme(newTheme) {
    if (preferredTheme && document.body.classList.contains(preferredTheme)) {
      document.body.classList.replace(preferredTheme, newTheme)
    } else {
      document.body.classList.add(newTheme)
    }

    window.__theme = newTheme
    preferredTheme = newTheme
    window.__onThemeChange(newTheme)
  }

  window.__setPreferredTheme = function(newTheme) {
    setTheme(newTheme)
    try {
      localStorage.setItem('theme', newTheme)
    } catch (err) {}
  }

  var darkQuery = window.matchMedia('(prefers-color-scheme: dark)')
  darkQuery.addListener(function(e) {
    window.__setPreferredTheme(e.matches ? 'dark' : 'light')
  })

  setTheme(preferredTheme || (darkQuery.matches ? 'dark' : 'light'))
}()
    </script><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><div><div class="blogpost-header"><div class="view-page-header"><div class="view-page-header-wrapper"><div class="logo-wrapper"><div class="logo"><div data-gatsby-image-wrapper="" class="gatsby-image-wrapper gatsby-image-wrapper-constrained logo-img"><div style="max-width:150px;display:block"><img alt="" role="presentation" aria-hidden="true" src="data:image/svg+xml;charset=utf-8,%3Csvg%20height=&#x27;174&#x27;%20width=&#x27;150&#x27;%20xmlns=&#x27;http://www.w3.org/2000/svg&#x27;%20version=&#x27;1.1&#x27;%3E%3C/svg%3E" style="max-width:100%;display:block;position:static"/></div><div aria-hidden="true" data-placeholder-image="" style="opacity:1;transition:opacity 500ms linear;background-color:#080808;position:absolute;top:0;left:0;bottom:0;right:0"></div><picture><source type="image/avif" data-srcset="/static/a1a51351bdf7de55eaaa515eb15ce2da/2e0ee/saifeddine-rajhi.avif 38w,/static/a1a51351bdf7de55eaaa515eb15ce2da/81dba/saifeddine-rajhi.avif 75w,/static/a1a51351bdf7de55eaaa515eb15ce2da/20c67/saifeddine-rajhi.avif 150w,/static/a1a51351bdf7de55eaaa515eb15ce2da/94b9f/saifeddine-rajhi.avif 300w" sizes="(min-width: 150px) 150px, 100vw"/><source type="image/webp" data-srcset="/static/a1a51351bdf7de55eaaa515eb15ce2da/92aab/saifeddine-rajhi.webp 38w,/static/a1a51351bdf7de55eaaa515eb15ce2da/359cc/saifeddine-rajhi.webp 75w,/static/a1a51351bdf7de55eaaa515eb15ce2da/aac41/saifeddine-rajhi.webp 150w,/static/a1a51351bdf7de55eaaa515eb15ce2da/a15c6/saifeddine-rajhi.webp 300w" sizes="(min-width: 150px) 150px, 100vw"/><img data-gatsby-image-ssr="" data-main-image="" style="opacity:0" sizes="(min-width: 150px) 150px, 100vw" decoding="async" loading="lazy" data-src="/static/a1a51351bdf7de55eaaa515eb15ce2da/885b3/saifeddine-rajhi.png" data-srcset="/static/a1a51351bdf7de55eaaa515eb15ce2da/9c61d/saifeddine-rajhi.png 38w,/static/a1a51351bdf7de55eaaa515eb15ce2da/d405f/saifeddine-rajhi.png 75w,/static/a1a51351bdf7de55eaaa515eb15ce2da/885b3/saifeddine-rajhi.png 150w,/static/a1a51351bdf7de55eaaa515eb15ce2da/4aeea/saifeddine-rajhi.png 300w" alt="Saifeddine Rajhi"/></picture><noscript><picture><source type="image/avif" srcSet="/static/a1a51351bdf7de55eaaa515eb15ce2da/2e0ee/saifeddine-rajhi.avif 38w,/static/a1a51351bdf7de55eaaa515eb15ce2da/81dba/saifeddine-rajhi.avif 75w,/static/a1a51351bdf7de55eaaa515eb15ce2da/20c67/saifeddine-rajhi.avif 150w,/static/a1a51351bdf7de55eaaa515eb15ce2da/94b9f/saifeddine-rajhi.avif 300w" sizes="(min-width: 150px) 150px, 100vw"/><source type="image/webp" srcSet="/static/a1a51351bdf7de55eaaa515eb15ce2da/92aab/saifeddine-rajhi.webp 38w,/static/a1a51351bdf7de55eaaa515eb15ce2da/359cc/saifeddine-rajhi.webp 75w,/static/a1a51351bdf7de55eaaa515eb15ce2da/aac41/saifeddine-rajhi.webp 150w,/static/a1a51351bdf7de55eaaa515eb15ce2da/a15c6/saifeddine-rajhi.webp 300w" sizes="(min-width: 150px) 150px, 100vw"/><img data-gatsby-image-ssr="" data-main-image="" style="opacity:0" sizes="(min-width: 150px) 150px, 100vw" decoding="async" loading="lazy" src="/static/a1a51351bdf7de55eaaa515eb15ce2da/885b3/saifeddine-rajhi.png" srcSet="/static/a1a51351bdf7de55eaaa515eb15ce2da/9c61d/saifeddine-rajhi.png 38w,/static/a1a51351bdf7de55eaaa515eb15ce2da/d405f/saifeddine-rajhi.png 75w,/static/a1a51351bdf7de55eaaa515eb15ce2da/885b3/saifeddine-rajhi.png 150w,/static/a1a51351bdf7de55eaaa515eb15ce2da/4aeea/saifeddine-rajhi.png 300w" alt="Saifeddine Rajhi"/></picture></noscript><script type="module">const t="undefined"!=typeof HTMLImageElement&&"loading"in HTMLImageElement.prototype;if(t){const t=document.querySelectorAll("img[data-main-image]");for(let e of t){e.dataset.src&&(e.setAttribute("src",e.dataset.src),e.removeAttribute("data-src")),e.dataset.srcset&&(e.setAttribute("srcset",e.dataset.srcset),e.removeAttribute("data-srcset"));const t=e.parentNode.querySelectorAll("source[data-srcset]");for(let e of t)e.setAttribute("srcset",e.dataset.srcset),e.removeAttribute("data-srcset");e.complete&&(e.style.opacity=1,e.parentNode.parentNode.querySelector("[data-placeholder-image]").style.opacity=0)}}</script></div></div><div class="name"><a href="/blog/" title="back to blog">Saifeddine <br/> Rajhi</a></div></div><h2 class="blog-title"><a href="/blog/" title="back to the homepage">Blog</a></h2></div></div><nav class="main-navigation"><ul><li><a rel="home" title="Go Home" href="/">Home</a></li><li><a title="Go to my Technical Blog" href="/blog/">Blog</a></li><li><a title="Go to my Thoughts" href="/thoughts/">Thoughts</a></li><li><a title="My public talks" href="/talks/">talks</a></li><li><a title="Review My Resume" href="/cv/platform-engineer/">cv</a></li></ul></nav></div><main><article class="blog-wrapper"><header><figure class="cover"><div class="cover-filter"><div data-gatsby-image-wrapper="" class="gatsby-image-wrapper cover cover-image"><div aria-hidden="true" style="padding-top:56.3125%"></div><img aria-hidden="true" data-placeholder-image="" style="opacity:1;transition:opacity 500ms linear;object-fit:fill;object-position:center" decoding="async" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAAC4ElEQVR42iWS+08TeRTFh5dFWqBE3KjL7mp0QUWsPOLb0FArLwVXCZFKJFERZqaDtWp0UVe3uFVAWS2sSkzcJcijIuKD17QVatT/apOPl/GHk5t7594z53vPVTZ1v+Pk8BcqH37E+2iJ+r8/UhGao6o/ZqGy17Ty3T3zHB9c5rehJO77Jicl7pVazYMEtQ8T5OmTOLVJlPzgNAeloWZACOVj9UCCXbdnOXTPtEiq+mKU/zlHmWDP3QX2/7VAxZ059vUsUC59bulz3fpArjrxnTDbiLIvbNLy7DMHw4sWcdWDOJ7+hPWjhsdLVIuCY4+WaXv+ld1CfLgvzuHeOG6ZOzGYpPSPWewd45ZKxWFMYuuKku6fIHMFUlyJNnUcmz5OZucYmeoYWZLbBVmSr8AhNbvE1YJsbdxSZyncYLyjJJjEFVimKJDgl6DJrxdNNuuzFOuLVizU5tmmzrNVYrG2QJkap1CdtfISzaRYXSRPi5KrR2WH+isK9LcU+GcoNEy2X1oWohilWgyXtigDMXaqMXbIUKkQlalJIU/gktpm9QMF6gw/CZzGa2wtEZQs/xvs8syMzil+1N4LmUmhHqdI/8R6UVgkCrZocxY2Cio6X1GpTVGiL7FWm8ahyfO7prG1vSCl+gbKxvbfOXK5AXfoijj1L4r2kkO+MCONZxlrVtl7LkK6OipLH+Hnjmd4LtygTr3OViNCjgjJMabJbH1CSv1dUqu7Ucp8XtqvrSPwopZ1LT2kn+rlTE0X/x9rAJ+P5tNhVjX1kN/Sy84LEeq02xww+qgNhvhBzFvlGyS18RZpx2+S4vGjrDkfoeaSF1d3GHv7BBnSVHf0OslyN189jXhP92ETJ50do7KOf/D6Q9QH73Di2k1Wtw6LMiFrCpEmTqcH3sgditWO9lHrjnL8UbL9U+R3/MemtgHBY9Z0vsQpxjnFwZWzKDKG5SKGcLQ+RakLkeoJkHb2KRlX54Vwhm82j+rSUKKl1AAAAABJRU5ErkJggg==" alt=""/><picture><source type="image/webp" data-srcset="/static/ff6d20c44d5aeda3f918a6e6c9dcc495/a66aa/eks-secrets-manager.webp 750w,/static/ff6d20c44d5aeda3f918a6e6c9dcc495/65dd5/eks-secrets-manager.webp 1080w,/static/ff6d20c44d5aeda3f918a6e6c9dcc495/f9724/eks-secrets-manager.webp 1366w,/static/ff6d20c44d5aeda3f918a6e6c9dcc495/2bf2f/eks-secrets-manager.webp 1600w" sizes="100vw"/><img data-gatsby-image-ssr="" data-main-image="" style="object-fit:fill;object-position:center;opacity:0" sizes="100vw" decoding="async" loading="lazy" data-src="/static/ff6d20c44d5aeda3f918a6e6c9dcc495/47056/eks-secrets-manager.png" data-srcset="/static/ff6d20c44d5aeda3f918a6e6c9dcc495/0dee1/eks-secrets-manager.png 750w,/static/ff6d20c44d5aeda3f918a6e6c9dcc495/8beaa/eks-secrets-manager.png 1080w,/static/ff6d20c44d5aeda3f918a6e6c9dcc495/a4198/eks-secrets-manager.png 1366w,/static/ff6d20c44d5aeda3f918a6e6c9dcc495/47056/eks-secrets-manager.png 1600w" alt="Manage secrets in AWS EKS with AWS Secrets Manager securely"/></picture><noscript><picture><source type="image/webp" srcSet="/static/ff6d20c44d5aeda3f918a6e6c9dcc495/a66aa/eks-secrets-manager.webp 750w,/static/ff6d20c44d5aeda3f918a6e6c9dcc495/65dd5/eks-secrets-manager.webp 1080w,/static/ff6d20c44d5aeda3f918a6e6c9dcc495/f9724/eks-secrets-manager.webp 1366w,/static/ff6d20c44d5aeda3f918a6e6c9dcc495/2bf2f/eks-secrets-manager.webp 1600w" sizes="100vw"/><img data-gatsby-image-ssr="" data-main-image="" style="object-fit:fill;object-position:center;opacity:0" sizes="100vw" decoding="async" loading="lazy" src="/static/ff6d20c44d5aeda3f918a6e6c9dcc495/47056/eks-secrets-manager.png" srcSet="/static/ff6d20c44d5aeda3f918a6e6c9dcc495/0dee1/eks-secrets-manager.png 750w,/static/ff6d20c44d5aeda3f918a6e6c9dcc495/8beaa/eks-secrets-manager.png 1080w,/static/ff6d20c44d5aeda3f918a6e6c9dcc495/a4198/eks-secrets-manager.png 1366w,/static/ff6d20c44d5aeda3f918a6e6c9dcc495/47056/eks-secrets-manager.png 1600w" alt="Manage secrets in AWS EKS with AWS Secrets Manager securely"/></picture></noscript><script type="module">const t="undefined"!=typeof HTMLImageElement&&"loading"in HTMLImageElement.prototype;if(t){const t=document.querySelectorAll("img[data-main-image]");for(let e of t){e.dataset.src&&(e.setAttribute("src",e.dataset.src),e.removeAttribute("data-src")),e.dataset.srcset&&(e.setAttribute("srcset",e.dataset.srcset),e.removeAttribute("data-srcset"));const t=e.parentNode.querySelectorAll("source[data-srcset]");for(let e of t)e.setAttribute("srcset",e.dataset.srcset),e.removeAttribute("data-srcset");e.complete&&(e.style.opacity=1,e.parentNode.parentNode.querySelector("[data-placeholder-image]").style.opacity=0)}}</script></div></div><figcaption data-nosnippet="" class="image-title">Photo by Saifeddine Rajhi</figcaption></figure><h1>Manage secrets in AWS EKS with AWS Secrets Manager securely</h1><div data-nosnippet="" class="blog-details"><time class="blog-createdat" dateTime="2024-10-13">Oct 13, 2024</time><span> ‚Ä¢ </span><span class="blog-time2read">10<!-- -->mins<!-- --> read</span><div class="theme-switcher"><div class="theme-switcher-toggler"><div class="theme-switcher-track"></div><div class="theme-switcher-thumb"></div><input class="theme-switcher-input" type="checkbox" readonly="" aria-label="Switch between Dark and Light modes"/></div></div></div><ul data-nosnippet="" class="blog-tags"><li>EKS</li><li>AWS</li><li>Secrets Manager</li><li>Terraform</li><li>Security</li></ul></header><div class="blog-divider"></div><div id="intro"></div><div class="content-wrapper"><div data-nosnippet="" class="blog-content-nav-wrapper"><ul class="blog-content-nav"><h2>Content</h2><ul class="toc-list"></ul></ul></div><div class="content blog-content"><blockquote>
<p><strong>Enhance security and simplify secrets management for K8s apps</strong></p>
</blockquote>
<h2 id="-introduction" style="position:relative;"><a href="#-introduction" aria-label=" introduction permalink" class="anchor before"><svg class="anchor-icon" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>üóØ Introduction</h2>
<p>Managing secrets like API keys and database passwords securely is important to keep the applications running in Kubernetes secure.</p>
<p>And if you're using Amazon EKS Elastic Kubernetes Service for your Kubernetes applications, AWS KMS with AWS Secrets Manager can help you handle these secrets safely and easily.</p>
<h2 id="Ô∏è-using-aws-secrets-manager-with-amazoneks" style="position:relative;"><a href="#%EF%B8%8F-using-aws-secrets-manager-with-amazoneks" aria-label="Ô∏è using aws secrets manager with amazoneks permalink" class="anchor before"><svg class="anchor-icon" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>„äôÔ∏è Using AWS Secrets Manager with Amazon¬†EKS</h2>
<p><a href="https://docs.aws.amazon.com/secretsmanager/latest/userguide/integrating_csi_driver.html" target="_blank" rel="noopener noreferrer">AWS Secrets Manager</a> can be integrated with EKS using the <a href="https://github.com/aws/secrets-store-csi-driver-provider-aws" target="_blank" rel="noopener noreferrer">AWS Secrets and Configuration Provider ASCP</a> for the <a href="https://secrets-store-csi-driver.sigs.k8s.io/" target="_blank" rel="noopener noreferrer">Kubernetes Secrets Store CSI Driver</a>.</p>
<p><strong>Benefits:</strong></p>
<ul>
<li>Centralized secret management</li>
<li>Fine-grained access control</li>
<li>Seamless integration with EKS</li>
<li>Ability to mount secrets as volumes in pods</li>
<li>Option to sync with native Kubernetes secrets</li>
</ul>
<p><strong>Implementation steps:</strong></p>
<ol>
<li>Create secrets in AWS Secrets Manager</li>
<li>Create an IAM policy for secret retrieval</li>
<li>Use <a href="https://docs.aws.amazon.com/eks/latest/userguide/iam-roles-for-service-accounts.html" target="_blank" rel="noopener noreferrer">IAM Roles for Service Accounts (IRSA)</a> to limit secret access</li>
<li>Deploy a SecretProviderClass custom resource</li>
<li>Configure pods to mount volumes based on the SecretProviderClass</li>
<li>Sync mounted secrets to native Kubernetes secrets</li>
<li>Set up environment variables in pods using specific secret keys</li>
</ol>
<h2 id="encrypting-kubernetes-secrets-in-amazoneks" style="position:relative;"><a href="#encrypting-kubernetes-secrets-in-amazoneks" aria-label="encrypting kubernetes secrets in amazoneks permalink" class="anchor before"><svg class="anchor-icon" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Encrypting Kubernetes Secrets in Amazon¬†EKS</h2>
<p>Amazon EKS clusters (version 1.13+) support encrypting <a href="https://kubernetes.io/docs/concepts/configuration/secret/" target="_blank" rel="noopener noreferrer">Kubernetes secrets</a> using <a href="https://docs.aws.amazon.com/kms/latest/developerguide/concepts.html" target="_blank" rel="noopener noreferrer">AWS Key Management Service (KMS) Customer Managed Keys (CMK)</a>. This provides stronger security than the default Base64 encoding.
Key points:</p>
<ul>
<li>No changes are required in how secrets are used.</li>
<li>Encryption provider support must be enabled during EKS cluster creation</li>
<li>Each secret write generates a unique Data Encryption Key (DEK).</li>
<li>The DEK is encrypted with the CMK and stored in etcd.</li>
<li>Decryption occurs when pods access the secret.</li>
</ul>
<h2 id="eks-secrets-and-secrets-manager-hands-onguide" style="position:relative;"><a href="#eks-secrets-and-secrets-manager-hands-onguide" aria-label="eks secrets and secrets manager hands onguide permalink" class="anchor before"><svg class="anchor-icon" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>EKS Secrets and Secrets Manager hands-on¬†guide</h2>
<p>Let us start by provisioning our EKS cluster using Terraform the IAC tool.</p>
<p>First, clone the repo:</p>
<div class="gatsby-highlight" data-language="shell"><pre class="language-shell"><code class="language-shell">$ <span class="token function">git</span> clone https://github.com/seifrajhi/eks-secrets-manager-kms-demo.git</code></pre></div>
<p>Then run the following commands:</p>
<div class="gatsby-highlight" data-language="shell"><pre class="language-shell"><code class="language-shell">$ <span class="token builtin class-name">cd</span> eks-secrets-manager-kms-demo/eks-tf
$ terraform init
$ terraform plan
$ terraform apply --auto-approve</code></pre></div>
<p>This will provision the EKS cluster and VPC with the needed add-ons.</p>
<h2 id="deploy-theapp" style="position:relative;"><a href="#deploy-theapp" aria-label="deploy theapp permalink" class="anchor before"><svg class="anchor-icon" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Deploy the¬†app</h2>
<p>To deploy the app, clone the repo:</p>
<div class="gatsby-highlight" data-language="shell"><pre class="language-shell"><code class="language-shell">$ <span class="token function">git</span> clone https://github.com/seifrajhi/eks-secrets-manager-kms-demo.git</code></pre></div>
<p>For the deployment of our demo application, we have created the Helm chart and uploaded it to the <a href="https://github.com/seifrajhi/eks-secrets-manager-kms-demo/tree/main/helm-charts" target="_blank" rel="noopener noreferrer">Git Repository</a>.</p>
<p>Install the Helm chart:</p>
<div class="gatsby-highlight" data-language="shell"><pre class="language-shell"><code class="language-shell"><span class="token builtin class-name">cd</span> eks-secrets-manager-kms-demo/helm-charts
helm <span class="token function">install</span> demo <span class="token builtin class-name">.</span>
NAME: demo
LAST DEPLOYED: Sat Oct <span class="token number">11</span> <span class="token number">18</span>:42:20 <span class="token number">2024</span>
NAMESPACE: default
STATUS: deployed
REVISION: <span class="token number">1</span></code></pre></div>
<h3 id="deploy-amazon-ebs-csidriver" style="position:relative;"><a href="#deploy-amazon-ebs-csidriver" aria-label="deploy amazon ebs csidriver permalink" class="anchor before"><svg class="anchor-icon" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Deploy Amazon EBS CSI¬†Driver</h3>
<p><a href="https://github.com/container-storage-interface/spec/blob/master/spec.md" target="_blank" rel="noopener noreferrer">The Container Storage Interface (CSI)</a> is a standard for exposing arbitrary block and file storage systems to containerized workloads on Container Orchestration Systems (COs) like Kubernetes.
Using CSI third-party storage providers can write and deploy plugins exposing new storage systems in Kubernetes without ever having to touch the core Kubernetes code.</p>
<p><a href="https://github.com/kubernetes-sigs/aws-ebs-csi-driver" target="_blank" rel="noopener noreferrer">The Amazon Elastic Block Store (Amazon EBS) Container Storage Interface (CSI) driver</a> provides a CSI interface that allows Amazon Elastic Kubernetes Service (Amazon EKS) clusters to manage the lifecycle of Amazon EBS volumes for persistent volumes.</p>
<p>EBS was installed as part of the cluster add-ons.</p>
<h3 id="define-storage-class" style="position:relative;"><a href="#define-storage-class" aria-label="define storage class permalink" class="anchor before"><svg class="anchor-icon" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Define Storage Class</h3>
<p><a href="https://kubernetes.io/docs/concepts/storage/dynamic-provisioning/" target="_blank" rel="noopener noreferrer">Dynamic Volume Provisioning</a> allows storage volumes to be created on-demand.</p>
<p><a href="https://kubernetes.io/docs/concepts/storage/storage-classes/" target="_blank" rel="noopener noreferrer">StorageClass</a> should be pre-created to define which provisioner should be used and what parameters should be passed when dynamic provisioning is invoked.</p>
<div class="gatsby-highlight" data-language="yaml"><pre class="language-yaml"><code class="language-yaml"><span class="token key atrule">kind</span><span class="token punctuation">:</span> StorageClass
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> storage.k8s.io/v1
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> mysql<span class="token punctuation">-</span>gp3
<span class="token key atrule">provisioner</span><span class="token punctuation">:</span> ebs.csi.aws.com <span class="token comment"># &lt;--  Amazon EBS CSI driver</span>
<span class="token key atrule">parameters</span><span class="token punctuation">:</span>
  <span class="token key atrule">type</span><span class="token punctuation">:</span> gp3
  <span class="token key atrule">encrypted</span><span class="token punctuation">:</span> <span class="token string">'true'</span> 
<span class="token key atrule">volumeBindingMode</span><span class="token punctuation">:</span> WaitForFirstConsumer
<span class="token key atrule">reclaimPolicy</span><span class="token punctuation">:</span> Delete
<span class="token key atrule">mountOptions</span><span class="token punctuation">:</span>
<span class="token punctuation">-</span> debug</code></pre></div>
<p>Create storageclass <code class="language-text">mysql-gp3</code> by running the following command:</p>
<div class="gatsby-highlight" data-language="shell"><pre class="language-shell"><code class="language-shell">kubectl create <span class="token parameter variable">-f</span> sc-gp3-mysql.yaml</code></pre></div>
<h3 id="deploy-statefulset-workload" style="position:relative;"><a href="#deploy-statefulset-workload" aria-label="deploy statefulset workload permalink" class="anchor before"><svg class="anchor-icon" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Deploy StatefulSet workload</h3>
<p>We are going to deploy a MYSQL database using StatefulSet.</p>
<div class="note">
    <p><strong>üîµ Note:</strong></p>
    <p>The MySQL deployment consists of a ConfigMap, two Services, a Kubernetes secret for the root password and a StatefulSet.</p>
</div>
<p>The <a href="https://kubernetes.io/docs/tasks/configure-pod-container/configure-pod-configmap/" target="_blank" rel="noopener noreferrer">ConfigMap</a> allows you to decouple configuration artifacts and secrets from image content to keep containerized applications portable.</p>
<p>The ConfigMap stores <code class="language-text">source.cnf</code>, <code class="language-text">replica.cnf</code> and passes them when initializing leader and follower pods defined in StatefulSet:</p>
<ul>
<li><strong>source.cnf:</strong> is for the MySQL leader pod which has binary log option (log-bin) to provides a record of the data changes to be sent to follower servers.</li>
<li><strong>replica.cnf:</strong> is for follower pods which have super-read-only option.</li>
</ul>
<p><code class="language-text">mysql-cm.yaml</code> manifest:</p>
<div class="gatsby-highlight" data-language="yaml"><pre class="language-yaml"><code class="language-yaml"><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> ConfigMap
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> mysql<span class="token punctuation">-</span>config
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> workshop
  <span class="token key atrule">labels</span><span class="token punctuation">:</span>
    <span class="token key atrule">app</span><span class="token punctuation">:</span> mysql
<span class="token key atrule">data</span><span class="token punctuation">:</span>
  <span class="token key atrule">source.cnf</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token scalar string">
    # Apply this config only on the leader.
    [mysqld]
    log-bin</span>
  <span class="token key atrule">replica.cnf</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token scalar string">
    # Apply this config only on followers.
    [mysqld]
    # super-read-only</span></code></pre></div>
<p>Then run:</p>
<div class="gatsby-highlight" data-language="shell"><pre class="language-shell"><code class="language-shell">kubectl create <span class="token parameter variable">-f</span> mysql-cm.yaml</code></pre></div>
<p>StatefulSet requires a <a href="https://kubernetes.io/docs/concepts/services-networking/service/#headless-services" target="_blank" rel="noopener noreferrer">Headless Service</a> to control the domain of its Pods, directly reach each Pod with stable DNS entries.</p>
<blockquote>
<p>The Headless Service provides a home for the DNS entries that the StatefulSet controller creates for each Pod that's part of the set. By specifying "None" for the clusterIP, you can create Headless Service.</p>
<p>Because the Headless Service is named mysql, the Pods are accessible by resolving¬†<strong><code class="language-text">.mysql</code></strong> from within any other Pod in the same Kubernetes cluster and namespace.</p>
</blockquote>
<p>You can see the <code class="language-text">mysql service</code> is for DNS resolution so that when pods are placed by StatefulSet controller, pods can be resolved using pod-name.mysql.</p>
<p>The Client Service <code class="language-text">mysql-read</code> is a normal client Service with its own cluster IP that distributes connections across all MySQL Pods that report being Ready.</p>
<p>Create service <strong>mysql</strong> and <strong>mysql-read</strong> by running the following commands:</p>
<div class="gatsby-highlight" data-language="shell"><pre class="language-shell"><code class="language-shell">$ <span class="token function">git</span> clone https://github.com/seifrajhi/eks-secrets-manager-kms-demo.git
$ <span class="token builtin class-name">cd</span> eks-secrets-manager-kms-demo/demo-app
$ kubectl create <span class="token parameter variable">-f</span> mysql-svc.yaml</code></pre></div>
<p>StatefulSet consists of <strong>serviceName</strong>, <strong>replicas</strong>, <strong>template</strong> and <strong>volumeClaimTemplates</strong>:</p>
<ul>
<li>serviceName is "mysql", headless service we created in previous section.</li>
<li>replicas is 2, the desired number of pod.</li>
<li>template is the configuration of pod.</li>
<li>volumeClaimTemplates is to claim volume for pod based on storageClassName gp3.</li>
</ul>
<p>Run the following command under demo-app directory:</p>
<div class="gatsby-highlight" data-language="shell"><pre class="language-shell"><code class="language-shell">$ kubectl apply <span class="token parameter variable">-f</span> statefulset.yaml</code></pre></div>
<p><strong>Populate database:</strong></p>
<p>We are creating the database qa and products table in below command and inserting a products into the table. Later we will see how this data will show up in our application which is accessing this database.</p>
<div class="gatsby-highlight" data-language="shell"><pre class="language-shell"><code class="language-shell">$ kubectl <span class="token parameter variable">-n</span> workshop run mysql-client <span class="token parameter variable">--image</span><span class="token operator">=</span>mysql:5.7 <span class="token parameter variable">-i</span> <span class="token parameter variable">--rm</span> <span class="token parameter variable">--restart</span><span class="token operator">=</span>Never --<span class="token punctuation">\</span>
  mysql <span class="token parameter variable">-uroot</span> <span class="token parameter variable">-pdemo_ascp</span> <span class="token parameter variable">-h</span> mysql-0.mysql.workshop <span class="token operator">&lt;&lt;</span><span class="token string">EOF
CREATE DATABASE qa;
CREATE TABLE qa.products (prodId VARCHAR(120), prodName VARCHAR(120));
INSERT INTO qa.products (prodId,prodName) VALUES ('999','Mountain Bike');
EOF</span></code></pre></div>
<h2 id="kubernetes-secrets-encryption-using-aws-kms" style="position:relative;"><a href="#kubernetes-secrets-encryption-using-aws-kms" aria-label="kubernetes secrets encryption using aws kms permalink" class="anchor before"><svg class="anchor-icon" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Kubernetes secrets encryption using AWS KMS</h2>
<p>When we deployed the MySQL database, and the kubernetes secret <code class="language-text">mysql-secret</code> to hold the <strong>password</strong> for the database, the EKS control plane created a <a href="https://docs.aws.amazon.com/sns/latest/dg/sns-server-side-encryption.html#sse-key-terms" target="_blank" rel="noopener noreferrer">Data Encryption Key (DEK)</a> to encrypt the secret, saved the encrypted secret to etcd and used <a href="https://kubernetes.io/docs/tasks/administer-cluster/kms-provider/" target="_blank" rel="noopener noreferrer">kms:encrypt</a> to encrypt DEK and cached the encrypted DEK.</p>
<p>Let's use the Kubernetes secret <code class="language-text">mysql-secret</code> created while deploying the MySQL StatefulSet in the prodcatalog service to connect to the MYSQL database and show how EKS uses KMS to decrypt the Kubernetes secret <code class="language-text">mysql-secret</code>.</p>
<div class="gatsby-highlight" data-language="shell"><pre class="language-shell"><code class="language-shell">$ <span class="token builtin class-name">cd</span> helm-charts
$ helm upgrade --reuse-values <span class="token parameter variable">-f</span> values-k8s-secret.yaml demo <span class="token builtin class-name">.</span>

Release <span class="token string">"demo"</span> has been upgraded. Happy Helming<span class="token operator">!</span>
NAME: demo
LAST DEPLOYED: Sat Oct <span class="token number">11</span> <span class="token number">19</span>:20:20 <span class="token number">2024</span>
NAMESPACE: default
STATUS: deployed
REVISION: <span class="token number">3</span></code></pre></div>
<p><strong>Validate Kubernetes Encryption using KMS:</strong></p>
<p>Now let's validate that AWS KMS was used when we create and use the kubernetes secret.</p>
<p>Log into console and navigate to <code class="language-text">EKS ‚Üí Cluster ‚Üí Overview,</code> you will see the Secrets encryption as shown below:</p>
<p><span class="gatsby-resp-image-wrapper" style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; ">
      <span class="gatsby-resp-image-background-image" style="padding-bottom: 10.588235294117647%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAACCAIAAADXZGvcAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAQklEQVR42nXJQQ6AIAwEQP7/0V5sGgVa2C5GjxrjXKeoqohsakjmx5wzE4u35PsBlO4eEeuH7s1qHA5row+cjyJ5AcHjdOJhUX2xAAAAAElFTkSuQmCC'); background-size: cover; display: block;"></span>
  <img class="gatsby-resp-image-image" alt="alt text" title="" src="/static/63bafc0f58504402037c01232ad633af/c5bb3/kms-eks.png" srcset="/static/63bafc0f58504402037c01232ad633af/04472/kms-eks.png 170w,
/static/63bafc0f58504402037c01232ad633af/9f933/kms-eks.png 340w,
/static/63bafc0f58504402037c01232ad633af/c5bb3/kms-eks.png 680w,
/static/63bafc0f58504402037c01232ad633af/b12f7/kms-eks.png 1020w,
/static/63bafc0f58504402037c01232ad633af/b5a09/kms-eks.png 1360w,
/static/63bafc0f58504402037c01232ad633af/29007/kms-eks.png 1600w" sizes="(max-width: 680px) 100vw, 680px" style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;" loading="lazy" decoding="async">
    </span>
          </p>
<p>The EKS cluster was created with KMS encryption enabled and that is why your Secrets encryption is enabled.</p>
<p><em>Make a note of the KMS key ID.</em></p>
<p>A <strong>cloudtrail Decrypt</strong> event corresponding to this KMS key ID should be available with sourceIpAddress as <code class="language-text">eks.amazonaws.com</code>.</p>
<p>If you go to <a href="https://docs.aws.amazon.com/awscloudtrail/latest/userguide/cloudtrail-user-guide.html" target="_blank" rel="noopener noreferrer">CloudTrail</a> you should see a record available if you search for the Event types Encrypt and Decrypt.</p>
<h3 id="mount-secrets-from-aws-secretsmanager" style="position:relative;"><a href="#mount-secrets-from-aws-secretsmanager" aria-label="mount secrets from aws secretsmanager permalink" class="anchor before"><svg class="anchor-icon" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Mount secrets from AWS Secrets¬†Manager</h3>
<p>We have the MYSQL StatefulSet deployed and now we are going to save the password for the MYSQL database in AWS Secrets Manager and sync the secrets manager secret to a Native Kubernertes secret using the <a href="https://secrets-store-csi-driver.sigs.k8s.io/" target="_blank" rel="noopener noreferrer">Secrets Store CSI driver</a>.</p>
<p>The Kubernetes secret created by the CSI driver will be used in the <strong>productcatalog</strong> service to connect to the MYSQL Database.</p>
<p><strong>Install CSI Driver:</strong></p>
<p>Prepare your cluster by installing Secrets Store CSI Secret driver and AWS Secrets and Configuration Provider (ASCP).</p>
<div class="gatsby-highlight" data-language="shell"><pre class="language-shell"><code class="language-shell">helm repo <span class="token function">add</span> secrets-store-csi-driver https://kubernetes-sigs.github.io/secrets-store-csi-driver/charts</code></pre></div>
<p>Then install the CSI driver:</p>
<div class="gatsby-highlight" data-language="shell"><pre class="language-shell"><code class="language-shell">$ helm <span class="token function">install</span> <span class="token parameter variable">-n</span> kube-system csi-secrets-store <span class="token punctuation">\</span>
<span class="token parameter variable">--set</span> <span class="token assign-left variable">syncSecret.enabled</span><span class="token operator">=</span>true <span class="token punctuation">\</span>
<span class="token parameter variable">--set</span> <span class="token assign-left variable">enableSecretRotation</span><span class="token operator">=</span>true <span class="token punctuation">\</span>
secrets-store-csi-driver/secrets-store-csi-driver</code></pre></div>
<p>Then install AWS Secrets and Configuration <a href="https://docs.aws.amazon.com/secretsmanager/latest/userguide/integrating_csi_driver.html" target="_blank" rel="noopener noreferrer">Provider ASCP</a>:</p>
<div class="gatsby-highlight" data-language="shell"><pre class="language-shell"><code class="language-shell">helm repo <span class="token function">add</span> aws-secrets-manager https://aws.github.io/secrets-store-csi-driver-provider-aws
helm <span class="token function">install</span> <span class="token parameter variable">-n</span> kube-system secrets-provider-aws aws-secrets-manager/secrets-store-csi-driver-provider-aws</code></pre></div>
<p><strong>Prepare Secret and IAM access:</strong></p>
<p>Next step, create a test secret in AWS Secrets Manager:</p>
<div class="gatsby-highlight" data-language="shell"><pre class="language-shell"><code class="language-shell">$ aws secretsmanager create-secret <span class="token punctuation">\</span>
<span class="token parameter variable">--name</span> DBSecret_eksdemo <span class="token punctuation">\</span>
<span class="token parameter variable">--description</span> <span class="token string">"MYSQL DB Secret."</span> <span class="token punctuation">\</span>
--secret-string <span class="token string">"{<span class="token entity" title="\&quot;">\"</span>username<span class="token entity" title="\&quot;">\"</span>:<span class="token entity" title="\&quot;">\"</span>root<span class="token entity" title="\&quot;">\"</span>,<span class="token entity" title="\&quot;">\"</span>password<span class="token entity" title="\&quot;">\"</span>:<span class="token entity" title="\&quot;">\"</span>demo_ascp<span class="token entity" title="\&quot;">\"</span>}"</span></code></pre></div>
<p>After that, create an IAM policy with permissions to access the secrets manager secret:</p>
<div class="gatsby-highlight" data-language="shell"><pre class="language-shell"><code class="language-shell"><span class="token builtin class-name">export</span> <span class="token assign-left variable">IAM_POLICY_ARN_SECRET</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span>aws iam <span class="token punctuation">\</span>
create-policy <span class="token parameter variable">--query</span> Policy.Arn <span class="token punctuation">\</span>
<span class="token parameter variable">--output</span> text --policy-name DBSecret_eksdemo_secrets_policy<span class="token punctuation">\</span>
--policy-document <span class="token string">'{
"Version": "2012-10-17",
"Statement": [ {
"Effect": "Allow",
"Action": ["secretsmanager:GetSecretValue", "secretsmanager:DescribeSecret"],
"Resource": ["'</span>"$SECRET_ARN<span class="token string">"'"</span> <span class="token punctuation">]</span>
<span class="token punctuation">}</span> <span class="token punctuation">]</span>
<span class="token punctuation">}</span>'<span class="token variable">)</span></span>

<span class="token builtin class-name">echo</span> <span class="token variable">$IAM_POLICY_ARN_SECRET</span> <span class="token operator">|</span> <span class="token function">tee</span> <span class="token parameter variable">-a</span> 00_iam_policy_arn_dbsecret</code></pre></div>
<p>Next, create an IAM Service Account IRSA to access the secrets manager secret:</p>
<div class="gatsby-highlight" data-language="shell"><pre class="language-shell"><code class="language-shell">$ eksctl create iamserviceaccount <span class="token punctuation">\</span>
<span class="token parameter variable">--name</span> <span class="token string">"catalog-deployment-sa"</span> <span class="token punctuation">\</span>
<span class="token parameter variable">--cluster</span> <span class="token string">"demo-eks-secrets-kms-bottlerocket"</span> <span class="token punctuation">\</span>
--attach-policy-arn <span class="token string">"<span class="token variable">$IAM_POLICY_ARN_SECRET</span>"</span> <span class="token parameter variable">--approve</span> <span class="token punctuation">\</span>
<span class="token parameter variable">--namespace</span> workshop <span class="token punctuation">\</span>
--override-existing-serviceaccounts</code></pre></div>
<p><strong>Sync with Native Kubernetes Secrets:</strong></p>
<p>When all is ready, we can create a SecretProviderClass custom resource and use jmesPath field in the spec file.</p>
<blockquote>
<p>Use of <a href="https://jmespath.org/" target="_blank" rel="noopener noreferrer">jmesPath</a> allows extracting specific key-value from a JSON-formatted secret. It is a provider-specific feature from ASCP.</p>
</blockquote>
<p><a href="https://secrets-store-csi-driver.sigs.k8s.io/topics/sync-as-kubernetes-secret" target="_blank" rel="noopener noreferrer">secretObjects</a> spec section allows specifying the Kubernetes native secret structure synced from the objects: extracted from the JSON formatted secret using jmesPath.</p>
<p>The feature is provided by the standard <a href="https://secrets-store-csi-driver.sigs.k8s.io/topics/sync-as-kubernetes-secret.html" target="_blank" rel="noopener noreferrer">Secret Store CSI Driver</a>.</p>
<p><code class="language-text">SecretProviderClass.yaml</code> template:</p>
<div class="gatsby-highlight" data-language="yaml"><pre class="language-yaml"><code class="language-yaml"><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> secrets<span class="token punctuation">-</span>store.csi.x<span class="token punctuation">-</span>k8s.io/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> SecretProviderClass
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> catalog<span class="token punctuation">-</span>deployment<span class="token punctuation">-</span>spc<span class="token punctuation">-</span>k8s<span class="token punctuation">-</span>secrets
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> workshop
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">provider</span><span class="token punctuation">:</span> aws
  <span class="token key atrule">parameters</span><span class="token punctuation">:</span> 
    <span class="token key atrule">objects</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token scalar string">
      - objectName: "DBSecret_eksworkshop"
        objectType: "secretsmanager"
        jmesPath:
          - path: username
            objectAlias: dbusername
          - path: password
            objectAlias: dbpassword</span>
  <span class="token key atrule">secretObjects</span><span class="token punctuation">:</span>                
    <span class="token punctuation">-</span> <span class="token key atrule">secretName</span><span class="token punctuation">:</span> mysql<span class="token punctuation">-</span>secret<span class="token punctuation">-</span>from<span class="token punctuation">-</span>secrets<span class="token punctuation">-</span>manager
      <span class="token key atrule">type</span><span class="token punctuation">:</span> Opaque
      <span class="token key atrule">data</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">objectName</span><span class="token punctuation">:</span> dbusername
          <span class="token key atrule">key</span><span class="token punctuation">:</span> db_username
        <span class="token punctuation">-</span> <span class="token key atrule">objectName</span><span class="token punctuation">:</span> dbpassword
          <span class="token key atrule">key</span><span class="token punctuation">:</span> db_password</code></pre></div>
<p>After, run the command:</p>
<div class="gatsby-highlight" data-language="shell"><pre class="language-shell"><code class="language-shell">kubectl apply <span class="token parameter variable">-f</span> SecretProviderClass.yaml</code></pre></div>
<p><strong>Create Pod Mount Secrets Volumes and set up environment variables:</strong></p>
<p>Now let us Configure productcatalog service pod to mount volumes for individually extracted key-value pairs from the secrets. Once the pod is created with secrets volume mounts, the Secrets Store CSI Driver then creates and syncs Kubernetes secret object mysql-secret-from-secrets-manager¬†.
The pod then be able to populate Environment variables from the Kubernetes secret.</p>
<div class="gatsby-highlight" data-language="shell"><pre class="language-shell"><code class="language-shell">$ <span class="token builtin class-name">cd</span> helm-charts
$ helm upgrade --reuse-values <span class="token parameter variable">-f</span> values-secrets-manager.yaml demo <span class="token builtin class-name">.</span>

Release <span class="token string">"demo"</span> has been upgraded. Happy Helming<span class="token operator">!</span>
NAME: demo
LAST DEPLOYED: Sat Oct <span class="token number">11</span> <span class="token number">20</span>:11:20 <span class="token number">2024</span>
NAMESPACE: default
STATUS: deployed
REVISION: <span class="token number">5</span></code></pre></div>
<p><strong>üéâ Verify the result:</strong></p>
<p>Get a shell prompt within the product catalog pod by running the following commands. Verify the secret mounted as separate files for each extracted key-value pair and corresponding environment variables set as well.</p>
<div class="gatsby-highlight" data-language="shell"><pre class="language-shell"><code class="language-shell"><span class="token builtin class-name">export</span> <span class="token assign-left variable">PROD_CATALOG</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span>kubectl get pods <span class="token parameter variable">-n</span> workshop <span class="token parameter variable">-l</span> <span class="token assign-left variable">app</span><span class="token operator">=</span>prodcatalog <span class="token parameter variable">-o</span> <span class="token assign-left variable">jsonpath</span><span class="token operator">=</span><span class="token string">'{.items[].metadata.name}'</span><span class="token variable">)</span></span>
kubectl <span class="token parameter variable">-n</span> workshop <span class="token builtin class-name">exec</span> <span class="token parameter variable">-it</span> <span class="token variable">${PROD_CATALOG}</span> <span class="token parameter variable">-c</span> prodcatalog <span class="token function">bash</span></code></pre></div>
<p>Wait for the root shell prompt within the pod.
Run the following set of commands and watch the output in the pod's shell:</p>
<div class="gatsby-highlight" data-language="shell"><pre class="language-shell"><code class="language-shell"><span class="token builtin class-name">export</span> <span class="token assign-left variable"><span class="token environment constant">PS1</span></span><span class="token operator">=</span><span class="token string">'# '</span>
<span class="token builtin class-name">cd</span> /mnt/secrets
<span class="token function">ls</span> <span class="token parameter variable">-l</span> <span class="token comment">#--- List mounted secrets</span>
<span class="token function">cat</span> dbusername<span class="token punctuation">;</span> <span class="token builtin class-name">echo</span>
<span class="token function">cat</span> dbpassword<span class="token punctuation">;</span> <span class="token builtin class-name">echo</span>
<span class="token function">cat</span> DBSecret_eksworkshop<span class="token punctuation">;</span> <span class="token builtin class-name">echo</span>
<span class="token function">env</span> <span class="token operator">|</span> <span class="token function">grep</span> MYSQL <span class="token comment">#-- Display the MYSQL_ROOT_PASSWORD ENV variables set from the secret value</span></code></pre></div>
<p>The output shows the information as displayed below:</p>
<div class="gatsby-highlight" data-language="shell"><pre class="language-shell"><code class="language-shell"><span class="token comment"># cd /mnt/secrets</span>
<span class="token comment"># ls -l #--- List mounted secrets</span>
total <span class="token number">12</span>
-rw-r--r-- <span class="token number">1</span> root root <span class="token number">41</span> Oct <span class="token number">11</span> <span class="token number">21</span>:42 DBSecret_eksworkshop
-rw-r--r-- <span class="token number">1</span> root root  <span class="token number">8</span> Oct <span class="token number">11</span> <span class="token number">21</span>:42 dbpassword
-rw-r--r-- <span class="token number">1</span> root root  <span class="token number">4</span> Oct <span class="token number">11</span> <span class="token number">21</span>:42 dbusername
<span class="token comment"># </span>
<span class="token comment"># cat dbusername; echo</span>
root
<span class="token comment"># cat dbpassword; echo</span>
demo_ascp
<span class="token comment"># cat DBSecret_eksworkshop; echo</span>
<span class="token punctuation">{</span><span class="token string">"username"</span><span class="token builtin class-name">:</span><span class="token string">"root"</span>,<span class="token string">"password"</span><span class="token builtin class-name">:</span><span class="token string">"demo_ascp"</span><span class="token punctuation">}</span>
<span class="token comment"># </span>
<span class="token comment"># env | grep MYSQL #-- Display the MYSQL_ROOT_PASSWORD ENV variables set from the secret value</span>
<span class="token assign-left variable">MYSQL_ROOT_PASSWORD</span><span class="token operator">=</span>demo_ascp
<span class="token assign-left variable">MYSQL_READ_PORT_3306_TCP_PORT</span><span class="token operator">=</span><span class="token number">3306</span>
<span class="token assign-left variable">MYSQL_READ_PORT_3306_TCP_PROTO</span><span class="token operator">=</span>tcp
<span class="token assign-left variable">MYSQL_READ_PORT_3306_TCP</span><span class="token operator">=</span>tcp://10.100.88.165:3306
<span class="token assign-left variable">MYSQL_READ_SERVICE_HOST</span><span class="token operator">=</span><span class="token number">10.100</span>.88.165
<span class="token assign-left variable">MYSQL_READ_SERVICE_PORT</span><span class="token operator">=</span><span class="token number">3306</span>
<span class="token assign-left variable">MYSQL_READ_SERVICE_PORT_MYSQL</span><span class="token operator">=</span><span class="token number">3306</span>
<span class="token assign-left variable">MYSQL_READ_PORT_3306_TCP_ADDR</span><span class="token operator">=</span><span class="token number">10.100</span>.88.165
<span class="token assign-left variable">MYSQL_READ_PORT</span><span class="token operator">=</span>tcp://10.100.88.165:3306</code></pre></div>
<p>Notice under the path <code class="language-text">/mnt/secrets</code> key-values pairs extracted in separate files based on jmesPath specification. Files <code class="language-text">dbusername</code> and <code class="language-text">dbpassword</code> contains extracted values from the JSON formatted secret <code class="language-text">DBSecret_eksworkshop</code></p>
<p>The Environment variable <strong>MYSQL_ROOT_PASSWORD</strong> is set up correctly.</p>
<p>The ENV var mapped from the Kubernetes secrets object <code class="language-text">mysql-secret-from-secrets-manager</code> created automatically by the CSI driver.
Confirm the presence of Kubernetes secrets. It was created automatically by the CSI driver during pod deployment.</p>
<div class="gatsby-highlight" data-language="shell"><pre class="language-shell"><code class="language-shell">$ kubectl describe secrets mysql-secret-from-secrets-manager <span class="token parameter variable">-n</span> workshop
Name: mysql-secret-from-secrets-manager
Namespace: workshop
Labels: secrets-store.csi.k8s.io/managed<span class="token operator">=</span>true
Annotations: <span class="token operator">&lt;</span>none<span class="token operator">></span>
Type: Opaque
Datadb_password: <span class="token number">8</span> bytes
db_username: <span class="token number">4</span> bytes</code></pre></div>
<h2 id="-key-takeaways" style="position:relative;"><a href="#-key-takeaways" aria-label=" key takeaways permalink" class="anchor before"><svg class="anchor-icon" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>üí¨ Key Takeaways</h2>
<p>Using AWS Secrets Manager with Amazon EKS makes handling secrets in Kubernetes much safer and easier.</p>
<p>It helps keep your sensitive information secure and makes managing secrets simpler.</p>
<p><strong><em>Until next time, „Å§„Å•„Åè üéâ üáµüá∏</em></strong></p>
<p><br><br></p>
<blockquote>
<p>üí° Thank you for Reading !! üôåüèªüòÅüìÉ, see you in the next blog.ü§ò  <em><strong>Until next time üéâ</strong></em></p>
</blockquote>
<p>üöÄ Thank you for sticking up till the end. If you have any questions/feedback regarding this blog feel free to connect with me:</p>
<p><strong>‚ôªÔ∏è LinkedIn:</strong> <a href="https://www.linkedin.com/in/rajhi-saif/" target="_blank" rel="noopener noreferrer">https://www.linkedin.com/in/rajhi-saif/</a></p>
<p><strong>‚ôªÔ∏è X/Twitter:</strong> <a href="https://x.com/rajhisaifeddine" target="_blank" rel="noopener noreferrer">https://x.com/rajhisaifeddine</a></p>
<p><strong>The end ‚úåüèª</strong></p>
<h1 align="center">üî∞ Keep Learning !! Keep Sharing !! üî∞</h1>
<p><strong>References:</strong></p>
<ul>
<li><a href="https://docs.aws.amazon.com/secretsmanager/latest/userguide/integrating_csi_driver.html" target="_blank" rel="noopener noreferrer">https://docs.aws.amazon.com/secretsmanager/latest/userguide/integrating_csi_driver.html</a></li>
<li><a href="https://aws.amazon.com/blogs/security/how-to-use-aws-secrets-configuration-provider-with-kubernetes-secrets-store-csi-driver/" target="_blank" rel="noopener noreferrer">https://aws.amazon.com/blogs/security/how-to-use-aws-secrets-configuration-provider-with-kubernetes-secrets-store-csi-driver/</a></li>
<li><a href="https://catalog.workshops.aws/eks-immersionday/en-US/secrets-manager" target="_blank" rel="noopener noreferrer">https://catalog.workshops.aws/eks-immersionday/en-US/secrets-manager</a></li>
<li><a href="https://aws.github.io/aws-eks-best-practices/security/docs/data/" target="_blank" rel="noopener noreferrer">https://aws.github.io/aws-eks-best-practices/security/docs/data/</a></li>
<li>
<iframe width="100%" height="315" src="https://www.youtube-nocookie.com/embed/CXbFkpugxyQ?rel=0" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
</li>
</ul>
<p><strong>üìÖ Stay updated</strong></p>
<p>Subscribe to our newsletter for more insights on AWS cloud computing and containers.</p></div></div><div id="content-end"></div></article><div data-nosnippet="" class="social-share-wrapper"><h3>Share Your Love</h3><button keywords="" aria-label="Share Via Facebook" class="react-share__ShareButton social-share-item facebook" style="background-color:transparent;border:none;padding:0;font:inherit;color:inherit;cursor:pointer"><svg aria-hidden="true" focusable="false" data-prefix="fab" data-icon="facebook" class="svg-inline--fa fa-facebook " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M512 256C512 114.6 397.4 0 256 0S0 114.6 0 256C0 376 82.7 476.8 194.2 504.5V334.2H141.4V256h52.8V222.3c0-87.1 39.4-127.5 125-127.5c16.2 0 44.2 3.2 55.7 6.4V172c-6-.6-16.5-1-29.6-1c-42 0-58.2 15.9-58.2 57.2V256h83.6l-14.4 78.2H287V510.1C413.8 494.8 512 386.9 512 256h0z"></path></svg></button><button keywords="" aria-label="Share Via Twitter" class="react-share__ShareButton social-share-item twitter" style="background-color:transparent;border:none;padding:0;font:inherit;color:inherit;cursor:pointer"><svg aria-hidden="true" focusable="false" data-prefix="fab" data-icon="x-twitter" class="svg-inline--fa fa-x-twitter " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M389.2 48h70.6L305.6 224.2 487 464H345L233.7 318.6 106.5 464H35.8L200.7 275.5 26.8 48H172.4L272.9 180.9 389.2 48zM364.4 421.8h39.1L151.1 88h-42L364.4 421.8z"></path></svg></button><button aria-label="Share Via LinkedIn" keywords="" class="react-share__ShareButton social-share-item linkedin" style="background-color:transparent;border:none;padding:0;font:inherit;color:inherit;cursor:pointer"><svg aria-hidden="true" focusable="false" data-prefix="fab" data-icon="linkedin" class="svg-inline--fa fa-linkedin " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"></path></svg></button><button keywords="" aria-label="Share Via Reddit" class="react-share__ShareButton social-share-item reddit" style="background-color:transparent;border:none;padding:0;font:inherit;color:inherit;cursor:pointer"><svg aria-hidden="true" focusable="false" data-prefix="fab" data-icon="reddit" class="svg-inline--fa fa-reddit " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M0 256C0 114.6 114.6 0 256 0S512 114.6 512 256s-114.6 256-256 256L37.1 512c-13.7 0-20.5-16.5-10.9-26.2L75 437C28.7 390.7 0 326.7 0 256zM349.6 153.6c23.6 0 42.7-19.1 42.7-42.7s-19.1-42.7-42.7-42.7c-20.6 0-37.8 14.6-41.8 34c-34.5 3.7-61.4 33-61.4 68.4l0 .2c-37.5 1.6-71.8 12.3-99 29.1c-10.1-7.8-22.8-12.5-36.5-12.5c-33 0-59.8 26.8-59.8 59.8c0 24 14.1 44.6 34.4 54.1c2 69.4 77.6 125.2 170.6 125.2s168.7-55.9 170.6-125.3c20.2-9.6 34.1-30.2 34.1-54c0-33-26.8-59.8-59.8-59.8c-13.7 0-26.3 4.6-36.4 12.4c-27.4-17-62.1-27.7-100-29.1l0-.2c0-25.4 18.9-46.5 43.4-49.9l0 0c4.4 18.8 21.3 32.8 41.5 32.8zM177.1 246.9c16.7 0 29.5 17.6 28.5 39.3s-13.5 29.6-30.3 29.6s-31.4-8.8-30.4-30.5s15.4-38.3 32.1-38.3zm190.1 38.3c1 21.7-13.7 30.5-30.4 30.5s-29.3-7.9-30.3-29.6c-1-21.7 11.8-39.3 28.5-39.3s31.2 16.6 32.1 38.3zm-48.1 56.7c-10.3 24.6-34.6 41.9-63 41.9s-52.7-17.3-63-41.9c-1.2-2.9 .8-6.2 3.9-6.5c18.4-1.9 38.3-2.9 59.1-2.9s40.7 1 59.1 2.9c3.1 .3 5.1 3.6 3.9 6.5z"></path></svg></button><button keywords="" aria-label="Add to Pocket" class="react-share__ShareButton social-share-item pocket" style="background-color:transparent;border:none;padding:0;font:inherit;color:inherit;cursor:pointer"><svg aria-hidden="true" focusable="false" data-prefix="fab" data-icon="get-pocket" class="svg-inline--fa fa-get-pocket " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M407.6 64h-367C18.5 64 0 82.5 0 104.6v135.2C0 364.5 99.7 464 224.2 464c124 0 223.8-99.5 223.8-224.2V104.6c0-22.4-17.7-40.6-40.4-40.6zm-162 268.5c-12.4 11.8-31.4 11.1-42.4 0C89.5 223.6 88.3 227.4 88.3 209.3c0-16.9 13.8-30.7 30.7-30.7 17 0 16.1 3.8 105.2 89.3 90.6-86.9 88.6-89.3 105.5-89.3 16.9 0 30.7 13.8 30.7 30.7 0 17.8-2.9 15.7-114.8 123.2z"></path></svg></button></div><br/><br/><br/></main><aside class="blogpost-sidebar"><div data-nosnippet="" class="blog-navigation-wrapper"><h3>Read Other Posts</h3><nav class="blog-navigation"><div class="nav-links"><a rel="next" class="next-post" href="/blog/kubernetes-os-choice/">Choosing the right Linux Operating System for your Kubernetes cluster<!-- --> ‚Üí</a><a rel="prev" class="prev-post" href="/blog/aws-tagging-resources-best-practices/">‚Üê <!-- -->Tagging AWS resources the right way using Terraform</a><a class="all-posts" href="/blog/">All Posts</a></div></nav></div></aside><footer data-nosnippet=""><div class="footer-wrapper"><div data-nosnippet="" class="social"><ul class="social-list"><li class="social-item social-linkedin"><a rel="me" itemProp="url" eventCategory="social" eventAction="click" eventLabel="linkedin" href="https://www.linkedin.com/in/rajhi-saif/" title="Saifeddine Rajhi on LinkedIn" target="blank"><svg aria-hidden="true" focusable="false" data-prefix="fab" data-icon="linkedin-in" class="svg-inline--fa fa-linkedin-in fa-beat fa-2x " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M100.28 448H7.4V148.9h92.88zM53.79 108.1C24.09 108.1 0 83.5 0 53.8a53.79 53.79 0 0 1 107.58 0c0 29.7-24.1 54.3-53.79 54.3zM447.9 448h-92.68V302.4c0-34.7-.7-79.2-48.29-79.2-48.29 0-55.69 37.7-55.69 76.7V448h-92.78V148.9h89.08v40.8h1.3c12.4-23.5 42.69-48.3 87.88-48.3 94 0 111.28 61.9 111.28 142.3V448z"></path></svg><span>LinkedIn</span></a></li><li class="social-item social-github"><a rel="me" itemProp="url" eventCategory="social" eventAction="click" eventLabel="github" href="https://github.com/seifrajhi" title="Saifeddine Rajhi on Github" target="blank"><svg aria-hidden="true" focusable="false" data-prefix="fab" data-icon="github" class="svg-inline--fa fa-github fa-beat fa-2x " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path fill="currentColor" d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"></path></svg><span>GitHub</span></a></li><li class="social-item social-email"><a itemProp="email" eventCategory="social" eventAction="click" eventLabel="email" href="mailto:rajhiseif@gmail.com" title="Saifeddine Rajhi&#x27;s Email"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="envelope" class="svg-inline--fa fa-envelope fa-beat fa-2x " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M48 64C21.5 64 0 85.5 0 112c0 15.1 7.1 29.3 19.2 38.4L236.8 313.6c11.4 8.5 27 8.5 38.4 0L492.8 150.4c12.1-9.1 19.2-23.3 19.2-38.4c0-26.5-21.5-48-48-48L48 64zM0 176L0 384c0 35.3 28.7 64 64 64l384 0c35.3 0 64-28.7 64-64l0-208L294.4 339.2c-22.8 17.1-54 17.1-76.8 0L0 176z"></path></svg><span>Email</span></a></li><li class="social-item social-bluesky"><a rel="me" itemProp="url" eventCategory="bluesky" eventAction="click" eventLabel="social" href="https://bsky.app/profile/saifrajhi.bsky.social" title="Saifeddine Rajhi on Bluesky Social" target="blank"><svg aria-hidden="true" focusable="false" data-prefix="fab" data-icon="bluesky" class="svg-inline--fa fa-bluesky fa-beat fa-2x " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M111.8 62.2C170.2 105.9 233 194.7 256 242.4c23-47.6 85.8-136.4 144.2-180.2c42.1-31.6 110.3-56 110.3 21.8c0 15.5-8.9 130.5-14.1 149.2C478.2 298 412 314.6 353.1 304.5c102.9 17.5 129.1 75.5 72.5 133.5c-107.4 110.2-154.3-27.6-166.3-62.9l0 0c-1.7-4.9-2.6-7.8-3.3-7.8s-1.6 3-3.3 7.8l0 0c-12 35.3-59 173.1-166.3 62.9c-56.5-58-30.4-116 72.5-133.5C100 314.6 33.8 298 15.7 233.1C10.4 214.4 1.5 99.4 1.5 83.9c0-77.8 68.2-53.4 110.3-21.8z"></path></svg><span>Bluesky Social</span></a></li><li class="social-item social-X/Twitter"><a rel="me" itemProp="url" eventCategory="social" eventAction="click" eventLabel="X/Twitter" href="https://x.com/RajhiSaifeddine" title="Saifeddine Rajhi on X/Twitter" target="blank"><svg aria-hidden="true" focusable="false" data-prefix="fab" data-icon="x-twitter" class="svg-inline--fa fa-x-twitter fa-beat fa-2x " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M389.2 48h70.6L305.6 224.2 487 464H345L233.7 318.6 106.5 464H35.8L200.7 275.5 26.8 48H172.4L272.9 180.9 389.2 48zM364.4 421.8h39.1L151.1 88h-42L364.4 421.8z"></path></svg><span>X/Twitter</span></a></li><li class="social-item social-reddit"><a rel="me" itemProp="url" eventCategory="social" eventAction="click" eventLabel="reddit" href="https://www.reddit.com/user/ScoreApprehensive992/" title="Saifeddine Rajhi on Reddit" target="blank"><svg aria-hidden="true" focusable="false" data-prefix="fab" data-icon="reddit-alien" class="svg-inline--fa fa-reddit-alien fa-beat fa-2x " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M373 138.6c-25.2 0-46.3-17.5-51.9-41l0 0c-30.6 4.3-54.2 30.7-54.2 62.4l0 .2c47.4 1.8 90.6 15.1 124.9 36.3c12.6-9.7 28.4-15.5 45.5-15.5c41.3 0 74.7 33.4 74.7 74.7c0 29.8-17.4 55.5-42.7 67.5c-2.4 86.8-97 156.6-213.2 156.6S45.5 410.1 43 323.4C17.6 311.5 0 285.7 0 255.7c0-41.3 33.4-74.7 74.7-74.7c17.2 0 33 5.8 45.7 15.6c34-21.1 76.8-34.4 123.7-36.4l0-.3c0-44.3 33.7-80.9 76.8-85.5C325.8 50.2 347.2 32 373 32c29.4 0 53.3 23.9 53.3 53.3s-23.9 53.3-53.3 53.3zM157.5 255.3c-20.9 0-38.9 20.8-40.2 47.9s17.1 38.1 38 38.1s36.6-9.8 37.8-36.9s-14.7-49.1-35.7-49.1zM395 303.1c-1.2-27.1-19.2-47.9-40.2-47.9s-36.9 22-35.7 49.1c1.2 27.1 16.9 36.9 37.8 36.9s39.3-11 38-38.1zm-60.1 70.8c1.5-3.6-1-7.7-4.9-8.1c-23-2.3-47.9-3.6-73.8-3.6s-50.8 1.3-73.8 3.6c-3.9 .4-6.4 4.5-4.9 8.1c12.9 30.8 43.3 52.4 78.7 52.4s65.8-21.6 78.7-52.4z"></path></svg><span>Reddit</span></a></li><li class="social-item social-stackoverflow"><a rel="me" itemProp="url" eventCategory="social" eventAction="click" eventLabel="StackOverflow" href="https://stackoverflow.com/users/21897244/saifeddine-rajhi" title="Saifeddine Rajhi on StackOverflow" target="blank"><svg aria-hidden="true" focusable="false" data-prefix="fab" data-icon="stack-overflow" class="svg-inline--fa fa-stack-overflow fa-beat fa-2x " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512"><path fill="currentColor" d="M290.7 311L95 269.7 86.8 309l195.7 41zm51-87L188.2 95.7l-25.5 30.8 153.5 128.3zm-31.2 39.7L129.2 179l-16.7 36.5L293.7 300zM262 32l-32 24 119.3 160.3 32-24zm20.5 328h-200v39.7h200zm39.7 80H42.7V320h-40v160h359.5V320h-40z"></path></svg><span>StackOverflow</span></a></li><li class="social-item social-Goodreads"><a rel="me" eventLabel="StackOverflow" href="https://www.goodreads.com/user/show/176103378-saifeddine" title="Saifeddine Rajhi on Goodreads" target="blank"><svg aria-hidden="true" focusable="false" data-prefix="fab" data-icon="goodreads" class="svg-inline--fa fa-goodreads fa-beat fa-2x " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M299.9 191.2c5.1 37.3-4.7 79-35.9 100.7-22.3 15.5-52.8 14.1-70.8 5.7-37.1-17.3-49.5-58.6-46.8-97.2 4.3-60.9 40.9-87.9 75.3-87.5 46.9-.2 71.8 31.8 78.2 78.3zM448 88v336c0 30.9-25.1 56-56 56H56c-30.9 0-56-25.1-56-56V88c0-30.9 25.1-56 56-56h336c30.9 0 56 25.1 56 56zM330 313.2s-.1-34-.1-217.3h-29v40.3c-.8.3-1.2-.5-1.6-1.2-9.6-20.7-35.9-46.3-76-46-51.9.4-87.2 31.2-100.6 77.8-4.3 14.9-5.8 30.1-5.5 45.6 1.7 77.9 45.1 117.8 112.4 115.2 28.9-1.1 54.5-17 69-45.2.5-1 1.1-1.9 1.7-2.9.2.1.4.1.6.2.3 3.8.2 30.7.1 34.5-.2 14.8-2 29.5-7.2 43.5-7.8 21-22.3 34.7-44.5 39.5-17.8 3.9-35.6 3.8-53.2-1.2-21.5-6.1-36.5-19-41.1-41.8-.3-1.6-1.3-1.3-2.3-1.3h-26.8c.8 10.6 3.2 20.3 8.5 29.2 24.2 40.5 82.7 48.5 128.2 37.4 49.9-12.3 67.3-54.9 67.4-106.3z"></path></svg><span>Goodreads</span></a></li><li class="social-item social-osi"><a rel="me" itemProp="url" eventCategory="social" eventAction="click" eventLabel="StackOverflow" href="https://ossinsight.io/analyze/seifrajhi" title="Saifeddine Rajhi on OSSInsights" target="blank"><svg aria-hidden="true" focusable="false" data-prefix="fab" data-icon="osi" class="svg-inline--fa fa-osi fa-beat fa-2x " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M8 266.44C10.3 130.64 105.4 34 221.8 18.34c138.8-18.6 255.6 75.8 278 201.1 21.3 118.8-44 230-151.6 274-9.3 3.8-14.4 1.7-18-7.7q-26.7-69.45-53.4-139c-3.1-8.1-1-13.2 7-16.8 24.2-11 39.3-29.4 43.3-55.8a71.47 71.47 0 0 0-64.5-82.2c-39-3.4-71.8 23.7-77.5 59.7-5.2 33 11.1 63.7 41.9 77.7 9.6 4.4 11.5 8.6 7.8 18.4q-26.85 69.9-53.7 139.9c-2.6 6.9-8.3 9.3-15.5 6.5-52.6-20.3-101.4-61-130.8-119-24.9-49.2-25.2-87.7-26.8-108.7zm20.9-1.9c.4 6.6.6 14.3 1.3 22.1 6.3 71.9 49.6 143.5 131 183.1 3.2 1.5 4.4.8 5.6-2.3q22.35-58.65 45-117.3c1.3-3.3.6-4.8-2.4-6.7-31.6-19.9-47.3-48.5-45.6-86 1-21.6 9.3-40.5 23.8-56.3 30-32.7 77-39.8 115.5-17.6a91.64 91.64 0 0 1 45.2 90.4c-3.6 30.6-19.3 53.9-45.7 69.8-2.7 1.6-3.5 2.9-2.3 6q22.8 58.8 45.2 117.7c1.2 3.1 2.4 3.8 5.6 2.3 35.5-16.6 65.2-40.3 88.1-72 34.8-48.2 49.1-101.9 42.3-161-13.7-117.5-119.4-214.8-255.5-198-106.1 13-195.3 102.5-197.1 225.8z"></path></svg><span>OSSInsights</span></a></li><li class="social-item social-devstats"><a rel="me" itemProp="url" eventCategory="social" eventAction="click" eventLabel="StackOverflow" href="https://devstats.cluster.fun/?user=seifrajhi" title="Saifeddine Rajhi on DevStats" target="blank"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="chart-line" class="svg-inline--fa fa-chart-line fa-beat fa-2x " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M64 64c0-17.7-14.3-32-32-32S0 46.3 0 64L0 400c0 44.2 35.8 80 80 80l400 0c17.7 0 32-14.3 32-32s-14.3-32-32-32L80 416c-8.8 0-16-7.2-16-16L64 64zm406.6 86.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0L320 210.7l-57.4-57.4c-12.5-12.5-32.8-12.5-45.3 0l-112 112c-12.5 12.5-12.5 32.8 0 45.3s32.8 12.5 45.3 0L240 221.3l57.4 57.4c12.5 12.5 32.8 12.5 45.3 0l128-128z"></path></svg><span>DevStats</span></a></li><li class="social-item social-RSS"><a rel="me" itemProp="url" eventCategory="social" eventAction="click" eventLabel="RSS" href="https://seifrajhi.github.io/rss.xml" title="Subscribe to my blog post" target="blank"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="rss" class="svg-inline--fa fa-rss fa-beat fa-2x " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M0 64C0 46.3 14.3 32 32 32c229.8 0 416 186.2 416 416c0 17.7-14.3 32-32 32s-32-14.3-32-32C384 253.6 226.4 96 32 96C14.3 96 0 81.7 0 64zM0 416a64 64 0 1 1 128 0A64 64 0 1 1 0 416zM32 160c159.1 0 288 128.9 288 288c0 17.7-14.3 32-32 32s-32-14.3-32-32c0-123.7-100.3-224-224-224c-17.7 0-32-14.3-32-32s14.3-32 32-32z"></path></svg><span>RSS</span></a></li></ul></div><div class="copyright">Saifeddine Rajhi ¬© 1994 - <!-- -->2025<!-- --> <br/><a rel="license" href="https://creativecommons.org/licenses/by/4.0/" title="Content is published under CC BY 4.0 license">CC BY 4.0</a></div><div class="pgp"><a href="https://keybase.io/saifrajhi">0C3B BABB 8BC1 EA2B</a></div></div></footer></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/blog/eks-and-aws-secrets-manager/";/*]]>*/</script><!-- slice-start id="_gatsby-scripts-1" -->
          <script
            id="gatsby-chunk-mapping"
          >
            window.___chunkMapping="{\"app\":[\"/app-2f4f174b7ccfc9183c7b.js\"],\"component---cache-caches-gatsby-plugin-offline-app-shell-js\":[\"/component---cache-caches-gatsby-plugin-offline-app-shell-js-88fb5c28d68e831e730a.js\"],\"component---src-pages-404-tsx\":[\"/component---src-pages-404-tsx-a0e3d27d11d1ae18e8f0.js\"],\"component---src-pages-blog-js\":[\"/component---src-pages-blog-js-ebba4d9aefd856068672.js\"],\"component---src-pages-cv-platform-engineer-js\":[\"/component---src-pages-cv-platform-engineer-js-6b113f68e4ef180c17b2.js\"],\"component---src-pages-index-tsx\":[\"/component---src-pages-index-tsx-cca2029691d058282d40.js\"],\"component---src-pages-talks-js\":[\"/component---src-pages-talks-js-d3fd645d0085de17a5e9.js\"],\"component---src-pages-thoughts-js\":[\"/component---src-pages-thoughts-js-0950be014b397a2b3d9c.js\"],\"component---src-templates-blog-template-js\":[\"/component---src-templates-blog-template-js-8b499d4855ef1cb13add.js\"],\"component---src-templates-talk-template-js\":[\"/component---src-templates-talk-template-js-7623845caf43043e0341.js\"],\"component---src-templates-thought-template-js\":[\"/component---src-templates-thought-template-js-b8bdd67706c6a1d2873c.js\"]}";
          </script>
        <script>window.___webpackCompilationHash="88092f7f5940cd0b45c0";</script><script src="/webpack-runtime-7456f0bc58205084e1e1.js" async></script><script src="/framework-580c5b11fe009445c659.js" async></script><script src="/app-2f4f174b7ccfc9183c7b.js" async></script><!-- slice-end id="_gatsby-scripts-1" --></body></html>