<!DOCTYPE html><html lang="en" class="blogpost-view-page"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1, shrink-to-fit=no"/><meta data-react-helmet="true" name="description" property="og:description" content="Building a fortress in Kubernetes: How OPA Gatekeeper and Policy-as-Code keep your cluster safe."/><meta data-react-helmet="true" name="keywords" content="Kubernetes,OPA Gatekeeper,Policy-as-Code,k8s,DevOps"/><meta data-react-helmet="true" name="author" content="@RajhiSaifeddine"/><meta data-react-helmet="true" property="og:title" content="Securing Your Kubernetes Cluster with OPA Gatekeeper: The Power of Policy-as-Code üõ°Ô∏è - Blog"/><meta data-react-helmet="true" property="og:type" content="article"/><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"/><meta data-react-helmet="true" name="twitter:creator" content="@RajhiSaifeddine"/><meta data-react-helmet="true" name="twitter:title" content="Securing Your Kubernetes Cluster with OPA Gatekeeper: The Power of Policy-as-Code üõ°Ô∏è - Blog"/><meta data-react-helmet="true" name="twitter:description" content="Building a fortress in Kubernetes: How OPA Gatekeeper and Policy-as-Code keep your cluster safe."/><meta data-react-helmet="true" name="image" property="og:image" content="https://seifrajhi.github.io/static/0d302c8dc1d23228ca71bf4d2b37e947/211a3/opa-gatekeeper-cover.png"/><meta data-react-helmet="true" name="twitter:image" content="https://seifrajhi.github.io/static/0d302c8dc1d23228ca71bf4d2b37e947/211a3/opa-gatekeeper-cover.png"/><meta data-react-helmet="true" property="og:url" content="https://seifrajhi.github.io/blog/kubernetes-opa-gatekeeper-policy-as-code/"/><meta name="theme-color" content="#ffffff"/><link rel="stylesheet" href="/styles.19780313cdbeec1e4ef5.css"/><link rel="stylesheet"/><link rel="alternate" type="application/rss+xml" title="Saifeddine Rajhi&#x27;s Blog RSS Feed" href="/rss.xml"/><title data-react-helmet="true">Securing Your Kubernetes Cluster with OPA Gatekeeper: The Power of Policy-as-Code üõ°Ô∏è - Blog by Saifeddine Rajhi</title><script data-react-helmet="true" type="application/ld+json">{"@context":"http://schema.org","@type":"BlogPosting","image":"/static/0d302c8dc1d23228ca71bf4d2b37e947/211a3/opa-gatekeeper-cover.png","headline":"Securing Your Kubernetes Cluster with OPA Gatekeeper: The Power of Policy-as-Code üõ°Ô∏è","dateCreated":"2024-10-31","datePublished":"2024-10-31","dateModified":"2024-10-31","inLanguage":"en-US","isFamilyFriendly":true,"isAccessibleForFree":true,"author":{"@type":"Person","name":"Saifeddine Rajhi","url":"https://seifrajhi.github.io"},"publisher":{"@type":"Organization","name":"Saifeddine Rajhi's Website"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://seifrajhi.github.io/blog/kubernetes-opa-gatekeeper-policy-as-code/"},"keywords":["Kubernetes","OPA Gatekeeper","Policy-as-Code","k8s","DevOps"],"genre":["Platform engineer","software engineering","science","deep learning","statistics"],"articleSection":"Technical Blog","articleBody":"\n> **Building a Fortress in Kubernetes: How OPA Gatekeeper and Policy-as-Code Keep Your Cluster Safe üõ°Ô∏è**\n\n## Introduction\n\nAs organizations adopt Kubernetes as their container orchestration platform, policy management becomes increasingly important. Traditional approaches to policy enforcement can be time-consuming and error-prone.\n\nManual policy reviews and audits create delays and introduce human error. In dynamic cloud environments, policies need to be constantly updated to reflect changes in the infrastructure.\n\nPolicy as Code (PaC) with [Open Policy Agent (OPA)](https://www.openpolicyagent.org/docs/latest/) for Kubernetes provides an automated and efficient solution. PaC allows easy policy integration into CI/CD pipelines. This approach ensures consistent policy enforcement and reduces human error risk.\n\n![bad pod](./bad-pod.jpg)\n\n## üéØ Goals & Objectives\n\nIn this article, we will explore how Policy as Code (PaC) with Open Policy Agent (OPA) for Kubernetes can streamline policy enforcement.  \n**HAPPY LEARNING üíª**\n\n![opa](./opa.png)\n\nTo properly evaluate PaC with OPA, it's essential to first understand Policy as Code.\n\n### Policy as Code\n\nPolicy as Code involves managing policy enforcement using machine-readable definition files, rather than documentation or interactive configuration tools. The primary goal is to ensure consistent enforcement of standards and rules across clusters or organizations.\n\nOnce policies are established, the next step is to enforce them effectively. This is where tools like [OPA](https://github.com/open-policy-agent/opa) and [Kyverno](https://github.com/kyverno/kyverno) come into play.\n\n### Open Policy Agent (OPA)\n\n[Open Policy Agent (OPA)](https://www.openpolicyagent.org/) is an open-source tool that enables creating, validating, and enforcing policies across systems, including Kubernetes. OPA uses the declarative Rego language to define policies as code, enabling easy integration into CI/CD pipelines. It ensures consistent, efficient policy enforcement, reduces human error risk, and provides policy management flexibility based on specific use cases and requirements.\n\nTo expand on the capabilities of OPA in Kubernetes, let's explore the additional features provided by OPA Gatekeeper, a policy controller that runs on top of OPA.\n\n### OPA Gatekeeper\n\n[OPA Gatekeeper](https://open-policy-agent.github.io/gatekeeper) is a policy controller that runs on top of OPA in Kubernetes. It extends the functionality of OPA by enabling users to enforce policies at scale across multiple Kubernetes clusters. Gatekeeper uses the same declarative policy language as OPA, Rego, to define policies as code.\n\nGatekeeper integrates with Kubernetes' admission controller mechanism, which allows it to evaluate policies before resources are created or updated. This ensures that only resources that meet the defined policies are allowed to run, reducing the risk of security vulnerabilities and ensuring compliance.\n\n![opa-gatekeeper](./opa-gatekeeper.png)\n\n### Admission Controllers\n\nAdmission controllers in Kubernetes intercept API requests, validate them against specific criteria, and mutate them if necessary. There are two types of admission controllers: mutating admission controllers and validating admission controllers. Mutating admission controllers modify requests while validating admission controllers check requests for compliance with pre-defined policies. They are a powerful tool for enforcing policies and ensuring consistency in Kubernetes environments.\n\n![steps](./steps.png)\n\nBelow are the steps of our demo:\n\n![demo](./demo1.png)\n\n### Installing OPA Gatekeeper as CRD\n\n```shell\nkubectl apply -f https://raw.githubusercontent.com/open-policy-agent/gatekeeper/master/deploy/gatekeeper.yaml\n```\n\nThis will create a namespace `gatekeeper-system`:\n\n```shell\nkubectl get ns\nNAME                 STATUS   AGE\ndefault              Active   1h\ngatekeeper-system    Active   48s\nkube-node-lease      Active   1h\nkube-public          Active   1h\nkube-system          Active   1h\nlocal-path-storage   Active   1h\n```\n\nFollowing are the objects created as part of the Gatekeeper installation:\n\n```shell\nkubectl get all -n gatekeeper-system\n\nNAME                                                 READY   STATUS    RESTARTS   AGE\npod/gatekeeper-audit-56ddcd8749-mlvjv                1/1     Running   0          2m5s\npod/gatekeeper-controller-manager-64fd6c8cfd-cqvnw   1/1     Running   0          2m4s\npod/gatekeeper-controller-manager-64fd6c8cfd-xgmxv   1/1     Running   0          2m4s\npod/gatekeeper-controller-manager-64fd6c8cfd-znxfh   1/1     Running   0          2m4s\n\nNAME                                 TYPE        CLUSTER-IP     EXTERNAL-IP   PORT(S)   AGE\nservice/gatekeeper-webhook-service   ClusterIP   10.25.5.7   <none>        443/TCP   2m51s\n\nNAME                                            READY   UP-TO-DATE   AVAILABLE   AGE\ndeployment.apps/gatekeeper-audit                1/1     1            1           2m5s\ndeployment.apps/gatekeeper-controller-manager   3/3     3            3           2m5s\n\nNAME                                                       DESIRED   CURRENT   READY   AGE\nreplicaset.apps/gatekeeper-audit-56ddcd8749                1         1         1       2m5s\nreplicaset.apps/gatekeeper-controller-manager-64fd6c8cfd   3         3         3       2m5s\n```\n\nAfter installing all the Gatekeeper components in the cluster, the API server will activate the Gatekeeper admission webhook to handle admission requests for resource creation, updates, and deletions. In the validation process, Gatekeeper serves as an intermediary between the API server and OPA, with the API server enforcing all policies executed by OPA.\n\n### Custom Resource Definition\n\nBy using the [CustomResourceDefinition (CRD)](https://kubernetes.io/docs/concepts/extend-kubernetes/api-extension/custom-resources/#customresourcedefinitions) API, it is possible to define custom resources in Kubernetes. Once a CRD object is defined, a new custom resource can be created with a name and schema specified by the user. The Kubernetes API handles the storage and serving of these custom resources.\n\nGatekeeper leverages the use of CustomResourceDefinitions to enforce policies on Kubernetes resources like Pods, Deployments, and Jobs, by defining ConstraintTemplates and Constraints. As part of the installation process, Gatekeeper generates multiple CRDs to facilitate the implementation of its functionalities.\n\n```shell\nkubectl get crd | grep -i gatekeeper\n\nassign.mutations.gatekeeper.sh                       2024-10-30T13:34:01Z\nassignmetadata.mutations.gatekeeper.sh               2024-10-30T13:34:01Z\nconfigs.config.gatekeeper.sh                         2024-10-30T13:34:01Z\nconstraintpodstatuses.status.gatekeeper.sh           2024-10-30T13:34:01Z\nconstrainttemplatepodstatuses.status.gatekeeper.sh   2024-10-30T13:34:01Z\nconstrainttemplates.templates.gatekeeper.sh          2024-10-30T13:34:01Z #<---\nexpansiontemplate.expansion.gatekeeper.sh            2024-10-30T13:34:01Z\nmodifyset.mutations.gatekeeper.sh                    2024-10-30T13:34:01Z\nmutatorpodstatuses.status.gatekeeper.sh              2024-10-30T13:34:01Z\nproviders.externaldata.gatekeeper.sh                 2024-10-30T13:34:01Z\n```\n\nOne of them is `constrainttemplates.templates.gatekeeper.sh`, which allows us to create **ConstraintTemplates** and **Constraints** to work with Gatekeeper. Now, we have all the resources, Pods, and Services running in the `gatekeeper-system` namespace.\n\nThe next step is to define policies. In this example, I will create a policy using Rego that denies all namespace creation if the label `hr` is not defined. The first step is to define **ConstraintTemplate** and **Constraint** CRDs using Rego.\n\n![policies](./policies.png)\n\n### Constraints and Constraint Templates\n\n- **Constraints**: These are rules that enforce specific policy requirements on resources in a system. They can be defined and customized by users to meet their specific needs.\n- **Constraint Templates**: These are reusable policy definitions that allow users to create Constraints more easily and consistently by specifying parameters for the policy rules. They provide a way to standardize policy enforcement across multiple systems and applications and can be customized and extended as needed.\n\nHaving received a substantial amount of new information, I am now eager to explain to you how it all integrates in reality. [This post](https://kubernetes.io/blog/2019/08/06/opa-gatekeeper-policy-and-governance-for-kubernetes/) does a great job of discussing the inter-relationships between Constraint templates and Constraint CRDs.\n\nThe diagram below is my pictorial representation of the relationship:\n\n![relationship](./relationship.png)\n\nStarting with the [constraint template](https://github.com/open-policy-agent/gatekeeper/blob/master/example/templates/k8srequiredlabels_template.yaml) which is a YAML file named ConstraintTemplate.yaml.\n\n![ConstraintTemplate](./ConstraintTemplate.png)\n\nCreate the ConstraintTemplate using the above-defined manifests:\n\n```shell\nkubectl create -f ConstraintTemplate.yaml\n#„ÄÄList the available ConstraintTemplate's \nkubectl get ConstraintTemplate\nNAME                AGE\nk8srequiredlabels   59s\nConstraint: Namespace label\n```\n\nLet's generate a Constraint specification in the file `ns-enforce-label.yaml` that mandates a namespace to have a label named \"hr\" whenever it is generated.\n\n![Constraint](./Constraint.png)\n\nCreate the Constraint on our Kubernetes cluster and list the available constraints:\n\n```shell\nkubectl create -f ns-enforce-label.yaml\n# List the available Constraints\nkubectl get constraints\nNAME                      ENFORCEMENT-ACTION   TOTAL-VIOLATIONS\nns-must-have-hr                                 13\n```\n\nNext, create a namespace without defining the required label, which is \"hr\" in this case:\n\n```shell\nkubectl create ns demo\nError from server (Forbidden): admission webhook \"validation.gatekeeper.sh\" denied the request: [ns-must-have-hr] you must provide labels: {\"hr\"}\n```\n\nNow, create a namespace using the required label and observe the result:\n\n```yaml\n# demo-ns.yaml\napiVersion: v1\nkind: Namespace\nmetadata:\n    name: demo\n    labels:\n        hr: foo   #<---\n---\n```\n\n```shell\nkubectl create -f demo-ns.yaml\nnamespace/demo created\n```\n\nIn the above demonstration, we can see that the namespace is created without any issues because we specified the required label.\n\n## üåü Conclusion üåü\n\nOPA enables developers to write and implement policies as code, making it easier to enforce and validate policies across an organization's infrastructure. This blog discussed the importance of policy as code, the structure of OPA policies, and how they can be used to enforce policies in Kubernetes.\n\nI hope you enjoyed this hands-on tutorial and learned more than you knew before. Let me know if you have any questions related to this blog.\n\n<br>\n\n**_Until next time, „Å§„Å•„Åè üéâ_**\n\n> üí° Thank you for Reading !! üôåüèªüòÅüìÉ, see you in the next blog.ü§ò  **_Until next time üéâ_**\n\nüöÄ Thank you for sticking up till the end. If you have any questions/feedback regarding this blog feel free to connect with me:\n\n**‚ôªÔ∏è LinkedIn:** https://www.linkedin.com/in/rajhi-saif/\n\n**‚ôªÔ∏è X/Twitter:** https://x.com/rajhisaifeddine\n\n**The end ‚úåüèª**\n\n<h1 align=\"center\">üî∞ Keep Learning !! Keep Sharing !! üî∞</h1>\n\n**üìÖ Stay updated**\n\nSubscribe to our newsletter for more insights on AWS cloud computing and containers.x\n","wordcount":1065}</script><script data-react-helmet="true" type="application/ld+json">{"@context":"http://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Home","item":"https://seifrajhi.github.io/"},{"@type":"ListItem","position":2,"name":"Blog","item":"https://seifrajhi.github.io/blog/"},{"@type":"ListItem","position":3,"name":"Securing Your Kubernetes Cluster with OPA Gatekeeper: The Power of Policy-as-Code üõ°Ô∏è","item":"https://seifrajhi.github.io/blog/kubernetes-opa-gatekeeper-policy-as-code/"}]}</script><link crossorigin="" href="https://utteranc.es" rel="preconnect"/><link crossorigin="" href="https://www.google-analytics.com" rel="preconnect"/><style>.gatsby-image-wrapper{position:relative;overflow:hidden}.gatsby-image-wrapper picture.object-fit-polyfill{position:static!important}.gatsby-image-wrapper img{bottom:0;height:100%;left:0;margin:0;max-width:none;padding:0;position:absolute;right:0;top:0;width:100%;object-fit:cover}.gatsby-image-wrapper [data-main-image]{opacity:0;transform:translateZ(0);transition:opacity .25s linear;will-change:opacity}.gatsby-image-wrapper-constrained{display:inline-block;vertical-align:top}</style><noscript><style>.gatsby-image-wrapper noscript [data-main-image]{opacity:1!important}.gatsby-image-wrapper [data-placeholder-image]{opacity:0!important}</style></noscript><script type="module">const e="undefined"!=typeof HTMLImageElement&&"loading"in HTMLImageElement.prototype;e&&document.body.addEventListener("load",(function(e){const t=e.target;if(void 0===t.dataset.mainImage)return;if(void 0===t.dataset.gatsbyImageSsr)return;let a=null,n=t;for(;null===a&&n;)void 0!==n.parentNode.dataset.gatsbyImageWrapper&&(a=n.parentNode),n=n.parentNode;const o=a.querySelector("[data-placeholder-image]"),r=new Image;r.src=t.currentSrc,r.decode().catch((()=>{})).then((()=>{t.style.opacity=1,o&&(o.style.opacity=0,o.style.transition="opacity 500ms linear")}))}),!0);</script><link rel="icon" href="/favicon-32x32.png?v=47ae28bb567c9025f1fee24afb2d20c9" type="image/png"/><link rel="manifest" href="/manifest.webmanifest" crossorigin="anonymous"/><link rel="apple-touch-icon" sizes="48x48" href="/icons/icon-48x48.png?v=47ae28bb567c9025f1fee24afb2d20c9"/><link rel="apple-touch-icon" sizes="72x72" href="/icons/icon-72x72.png?v=47ae28bb567c9025f1fee24afb2d20c9"/><link rel="apple-touch-icon" sizes="96x96" href="/icons/icon-96x96.png?v=47ae28bb567c9025f1fee24afb2d20c9"/><link rel="apple-touch-icon" sizes="144x144" href="/icons/icon-144x144.png?v=47ae28bb567c9025f1fee24afb2d20c9"/><link rel="apple-touch-icon" sizes="192x192" href="/icons/icon-192x192.png?v=47ae28bb567c9025f1fee24afb2d20c9"/><link rel="apple-touch-icon" sizes="256x256" href="/icons/icon-256x256.png?v=47ae28bb567c9025f1fee24afb2d20c9"/><link rel="apple-touch-icon" sizes="384x384" href="/icons/icon-384x384.png?v=47ae28bb567c9025f1fee24afb2d20c9"/><link rel="apple-touch-icon" sizes="512x512" href="/icons/icon-512x512.png?v=47ae28bb567c9025f1fee24afb2d20c9"/><link rel="preload" as="font" type="font/woff2" crossorigin="anonymous" href="/static/webfonts/s/dancingscript/v25/If2cXTr6YS-zF4S-kcSWSVi_sxjsohD9F50Ruu7BMSo3Sup8.woff2"/><link rel="preload" as="font" type="font/woff2" crossorigin="anonymous" href="/static/webfonts/s/dancingscript/v25/If2cXTr6YS-zF4S-kcSWSVi_sxjsohD9F50Ruu7B1i03Sup8.woff2"/><link rel="preload" as="font" type="font/woff2" crossorigin="anonymous" href="/static/webfonts/s/ledger/v16/j8_q6-HK1L3if_sBnMrx.woff2"/><style>@font-face{font-display:swap;font-family:Dancing Script;font-style:normal;font-weight:400;src:url(/static/webfonts/s/dancingscript/v25/If2cXTr6YS-zF4S-kcSWSVi_sxjsohD9F50Ruu7BMSo3Sup8.woff2) format("woff2")}@font-face{font-display:swap;font-family:Dancing Script;font-style:normal;font-weight:700;src:url(/static/webfonts/s/dancingscript/v25/If2cXTr6YS-zF4S-kcSWSVi_sxjsohD9F50Ruu7B1i03Sup8.woff2) format("woff2")}@font-face{font-display:swap;font-family:Dancing Script;font-style:normal;font-weight:400;src:url(/static/webfonts/s/dancingscript/v25/If2cXTr6YS-zF4S-kcSWSVi_sxjsohD9F50Ruu7BMSo3Sup6.woff) format("woff")}@font-face{font-display:swap;font-family:Dancing Script;font-style:normal;font-weight:700;src:url(/static/webfonts/s/dancingscript/v25/If2cXTr6YS-zF4S-kcSWSVi_sxjsohD9F50Ruu7B1i03Sup6.woff) format("woff")}@font-face{font-display:swap;font-family:Ledger;font-style:normal;font-weight:400;src:url(/static/webfonts/s/ledger/v16/j8_q6-HK1L3if_sBnMrx.woff2) format("woff2")}@font-face{font-display:swap;font-family:Ledger;font-style:normal;font-weight:400;src:url(/static/webfonts/s/ledger/v16/j8_q6-HK1L3if_sBnMr3.woff) format("woff")}</style><link rel="preconnect" href="https://www.google-analytics.com"/><link rel="dns-prefetch" href="https://www.google-analytics.com"/><script>
  
  function gaOptout(){document.cookie=disableStr+'=true; expires=Thu, 31 Dec 2099 23:59:59 UTC;path=/',window[disableStr]=!0}var gaProperty='G-LLPCCGNLH7',disableStr='ga-disable-'+gaProperty;document.cookie.indexOf(disableStr+'=true')>-1&&(window[disableStr]=!0);
  if(true) {
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  }
  if (typeof ga === "function") {
    ga('create', 'G-LLPCCGNLH7', 'auto', {"alwaysSendReferrer":true});
      ga('set', 'anonymizeIp', true);
      
      
      
      
      }</script><link rel="preconnect" href="https://www.googletagmanager.com"/><link rel="dns-prefetch" href="https://www.googletagmanager.com"/><script async="" src="https://www.googletagmanager.com/gtag/js?id=G-LLPCCGNLH7"></script><script>
      
      function gaOptout(){document.cookie=disableStr+'=true; expires=Thu, 31 Dec 2099 23:59:59 UTC;path=/',window[disableStr]=!0}var gaProperty='G-LLPCCGNLH7',disableStr='ga-disable-'+gaProperty;document.cookie.indexOf(disableStr+'=true')>-1&&(window[disableStr]=!0);
      if(true) {
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-LLPCCGNLH7', {"anonymize_ip":true,"send_page_view":false});gtag('config', 'GTM-5V895PDS', {"anonymize_ip":true,"send_page_view":false});
      }
      </script><link rel="stylesheet"/><script>
    document.addEventListener("DOMContentLoaded", function(event) {
      var hash = window.decodeURI(location.hash.replace('#', ''))
      if (hash !== '') {
        var element = document.getElementById(hash)
        if (element) {
          var scrollTop = window.pageYOffset || document.documentElement.scrollTop || document.body.scrollTop
          var clientTop = document.documentElement.clientTop || document.body.clientTop || 0
          var offset = element.getBoundingClientRect().top + scrollTop - clientTop
          // Wait for the browser to finish rendering before scrolling.
          setTimeout((function() {
            window.scrollTo(0, offset - 0)
          }), 0)
        }
      }
    })
  </script><link rel="canonical" href="https://seifrajhi.github.io/blog/kubernetes-opa-gatekeeper-policy-as-code/" data-baseprotocol="https:" data-basehost="seifrajhi.github.io"/><link rel="sitemap" type="application/xml" href="/sitemap-index.xml"/></head><body><script>
void function() {
  window.__onThemeChange = function() {}

  var preferredTheme
  try {
    preferredTheme = localStorage.getItem('theme')
  } catch (err) { }

  function setTheme(newTheme) {
    if (preferredTheme && document.body.classList.contains(preferredTheme)) {
      document.body.classList.replace(preferredTheme, newTheme)
    } else {
      document.body.classList.add(newTheme)
    }

    window.__theme = newTheme
    preferredTheme = newTheme
    window.__onThemeChange(newTheme)
  }

  window.__setPreferredTheme = function(newTheme) {
    setTheme(newTheme)
    try {
      localStorage.setItem('theme', newTheme)
    } catch (err) {}
  }

  var darkQuery = window.matchMedia('(prefers-color-scheme: dark)')
  darkQuery.addListener(function(e) {
    window.__setPreferredTheme(e.matches ? 'dark' : 'light')
  })

  setTheme(preferredTheme || (darkQuery.matches ? 'dark' : 'light'))
}()
    </script><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><div><div class="blogpost-header"><div class="view-page-header"><div class="view-page-header-wrapper"><div class="logo-wrapper"><div class="logo"><div data-gatsby-image-wrapper="" class="gatsby-image-wrapper gatsby-image-wrapper-constrained logo-img"><div style="max-width:150px;display:block"><img alt="" role="presentation" aria-hidden="true" src="data:image/svg+xml;charset=utf-8,%3Csvg%20height=&#x27;174&#x27;%20width=&#x27;150&#x27;%20xmlns=&#x27;http://www.w3.org/2000/svg&#x27;%20version=&#x27;1.1&#x27;%3E%3C/svg%3E" style="max-width:100%;display:block;position:static"/></div><div aria-hidden="true" data-placeholder-image="" style="opacity:1;transition:opacity 500ms linear;background-color:#080808;position:absolute;top:0;left:0;bottom:0;right:0"></div><picture><source type="image/avif" data-srcset="/static/a1a51351bdf7de55eaaa515eb15ce2da/2e0ee/saifeddine-rajhi.avif 38w,/static/a1a51351bdf7de55eaaa515eb15ce2da/81dba/saifeddine-rajhi.avif 75w,/static/a1a51351bdf7de55eaaa515eb15ce2da/20c67/saifeddine-rajhi.avif 150w,/static/a1a51351bdf7de55eaaa515eb15ce2da/94b9f/saifeddine-rajhi.avif 300w" sizes="(min-width: 150px) 150px, 100vw"/><source type="image/webp" data-srcset="/static/a1a51351bdf7de55eaaa515eb15ce2da/92aab/saifeddine-rajhi.webp 38w,/static/a1a51351bdf7de55eaaa515eb15ce2da/359cc/saifeddine-rajhi.webp 75w,/static/a1a51351bdf7de55eaaa515eb15ce2da/aac41/saifeddine-rajhi.webp 150w,/static/a1a51351bdf7de55eaaa515eb15ce2da/a15c6/saifeddine-rajhi.webp 300w" sizes="(min-width: 150px) 150px, 100vw"/><img data-gatsby-image-ssr="" data-main-image="" style="opacity:0" sizes="(min-width: 150px) 150px, 100vw" decoding="async" loading="lazy" data-src="/static/a1a51351bdf7de55eaaa515eb15ce2da/885b3/saifeddine-rajhi.png" data-srcset="/static/a1a51351bdf7de55eaaa515eb15ce2da/9c61d/saifeddine-rajhi.png 38w,/static/a1a51351bdf7de55eaaa515eb15ce2da/d405f/saifeddine-rajhi.png 75w,/static/a1a51351bdf7de55eaaa515eb15ce2da/885b3/saifeddine-rajhi.png 150w,/static/a1a51351bdf7de55eaaa515eb15ce2da/4aeea/saifeddine-rajhi.png 300w" alt="Saifeddine Rajhi"/></picture><noscript><picture><source type="image/avif" srcSet="/static/a1a51351bdf7de55eaaa515eb15ce2da/2e0ee/saifeddine-rajhi.avif 38w,/static/a1a51351bdf7de55eaaa515eb15ce2da/81dba/saifeddine-rajhi.avif 75w,/static/a1a51351bdf7de55eaaa515eb15ce2da/20c67/saifeddine-rajhi.avif 150w,/static/a1a51351bdf7de55eaaa515eb15ce2da/94b9f/saifeddine-rajhi.avif 300w" sizes="(min-width: 150px) 150px, 100vw"/><source type="image/webp" srcSet="/static/a1a51351bdf7de55eaaa515eb15ce2da/92aab/saifeddine-rajhi.webp 38w,/static/a1a51351bdf7de55eaaa515eb15ce2da/359cc/saifeddine-rajhi.webp 75w,/static/a1a51351bdf7de55eaaa515eb15ce2da/aac41/saifeddine-rajhi.webp 150w,/static/a1a51351bdf7de55eaaa515eb15ce2da/a15c6/saifeddine-rajhi.webp 300w" sizes="(min-width: 150px) 150px, 100vw"/><img data-gatsby-image-ssr="" data-main-image="" style="opacity:0" sizes="(min-width: 150px) 150px, 100vw" decoding="async" loading="lazy" src="/static/a1a51351bdf7de55eaaa515eb15ce2da/885b3/saifeddine-rajhi.png" srcSet="/static/a1a51351bdf7de55eaaa515eb15ce2da/9c61d/saifeddine-rajhi.png 38w,/static/a1a51351bdf7de55eaaa515eb15ce2da/d405f/saifeddine-rajhi.png 75w,/static/a1a51351bdf7de55eaaa515eb15ce2da/885b3/saifeddine-rajhi.png 150w,/static/a1a51351bdf7de55eaaa515eb15ce2da/4aeea/saifeddine-rajhi.png 300w" alt="Saifeddine Rajhi"/></picture></noscript><script type="module">const t="undefined"!=typeof HTMLImageElement&&"loading"in HTMLImageElement.prototype;if(t){const t=document.querySelectorAll("img[data-main-image]");for(let e of t){e.dataset.src&&(e.setAttribute("src",e.dataset.src),e.removeAttribute("data-src")),e.dataset.srcset&&(e.setAttribute("srcset",e.dataset.srcset),e.removeAttribute("data-srcset"));const t=e.parentNode.querySelectorAll("source[data-srcset]");for(let e of t)e.setAttribute("srcset",e.dataset.srcset),e.removeAttribute("data-srcset");e.complete&&(e.style.opacity=1,e.parentNode.parentNode.querySelector("[data-placeholder-image]").style.opacity=0)}}</script></div></div><div class="name"><a href="/blog/" title="back to blog">Saifeddine <br/> Rajhi</a></div></div><h2 class="blog-title"><a href="/blog/" title="back to the homepage">Blog</a></h2></div></div><nav class="main-navigation"><ul><li><a rel="home" title="Go Home" href="/">Home</a></li><li><a title="Go to my Technical Blog" href="/blog/">Blog</a></li><li><a title="Go to my Thoughts" href="/thoughts/">Thoughts</a></li><li><a title="My public talks" href="/talks/">talks</a></li><li><a title="Review My Resume" href="/cv/platform-engineer/">cv</a></li></ul></nav></div><main><article class="blog-wrapper"><header><figure class="cover"><div class="cover-filter"><div data-gatsby-image-wrapper="" class="gatsby-image-wrapper cover cover-image"><div aria-hidden="true" style="padding-top:57.14285714285714%"></div><img aria-hidden="true" data-placeholder-image="" style="opacity:1;transition:opacity 500ms linear;object-fit:fill;object-position:center" decoding="async" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAAsTAAALEwEAmpwYAAABzklEQVR42o1S30vbUBTuP+ce9iCD4RgIMvag+CKbok8q23TYB1+cfVCczBcVDIo/5lprEtMkNElb2tXAOmTYQlttSGL60/Te9qaepLa+DT9uLt+5937nfPfc+BzHsW2746Hdbvf5c+AzTbNYLOpWOZpI6oaRy+UQQpCREOJ46JL+3AeEvjvTPAqGF9e23k/OjH6c4iIRqP/cyvCt7x7Mr258XQkMvH6zd3isyLIkSalUSlVVnudZlqUZGng2m+MFMRaLpdNpWC8UCq54P8zOLAfefZgeHB6JRKVEPE5RlCAIiqJkMhlRFC84jmE5RZbUdPL75g+aYQSez+fzrhguwMiJibkvqUsVwu5VXdKz50UdrUxuLAJt7e4+2gbgVkszjN7RJ1XvFcjar8rQkvbWX/JTVt0mHcdrmFvZcfLFm1q9rumGbt7phgm8Uq3BsCpVgu+T/9Dg59J6sEqJjVcL2onScDMSrzJCOPH7kuaEw9PQSegcSIi+OA0zP8+Yo+C5dpvdidij3/T4FYIs05vm0l75Sezp0b1tY9wCAiYxxhDWavUmwuDsutR6OV/6tG35qfKL2Vvpb9Pz2xP/B/A7wBz90xwPGGOrxrHc6LfwAXBJRlOL/TQMAAAAAElFTkSuQmCC" alt=""/><picture><source type="image/webp" data-srcset="/static/0d302c8dc1d23228ca71bf4d2b37e947/4c8c9/opa-gatekeeper-cover.webp 750w,/static/0d302c8dc1d23228ca71bf4d2b37e947/ab556/opa-gatekeeper-cover.webp 840w" sizes="100vw"/><img data-gatsby-image-ssr="" data-main-image="" style="object-fit:fill;object-position:center;opacity:0" sizes="100vw" decoding="async" loading="lazy" data-src="/static/0d302c8dc1d23228ca71bf4d2b37e947/211a3/opa-gatekeeper-cover.png" data-srcset="/static/0d302c8dc1d23228ca71bf4d2b37e947/596c0/opa-gatekeeper-cover.png 750w,/static/0d302c8dc1d23228ca71bf4d2b37e947/211a3/opa-gatekeeper-cover.png 840w" alt="Securing Your Kubernetes Cluster with OPA Gatekeeper: The Power of Policy-as-Code üõ°Ô∏è"/></picture><noscript><picture><source type="image/webp" srcSet="/static/0d302c8dc1d23228ca71bf4d2b37e947/4c8c9/opa-gatekeeper-cover.webp 750w,/static/0d302c8dc1d23228ca71bf4d2b37e947/ab556/opa-gatekeeper-cover.webp 840w" sizes="100vw"/><img data-gatsby-image-ssr="" data-main-image="" style="object-fit:fill;object-position:center;opacity:0" sizes="100vw" decoding="async" loading="lazy" src="/static/0d302c8dc1d23228ca71bf4d2b37e947/211a3/opa-gatekeeper-cover.png" srcSet="/static/0d302c8dc1d23228ca71bf4d2b37e947/596c0/opa-gatekeeper-cover.png 750w,/static/0d302c8dc1d23228ca71bf4d2b37e947/211a3/opa-gatekeeper-cover.png 840w" alt="Securing Your Kubernetes Cluster with OPA Gatekeeper: The Power of Policy-as-Code üõ°Ô∏è"/></picture></noscript><script type="module">const t="undefined"!=typeof HTMLImageElement&&"loading"in HTMLImageElement.prototype;if(t){const t=document.querySelectorAll("img[data-main-image]");for(let e of t){e.dataset.src&&(e.setAttribute("src",e.dataset.src),e.removeAttribute("data-src")),e.dataset.srcset&&(e.setAttribute("srcset",e.dataset.srcset),e.removeAttribute("data-srcset"));const t=e.parentNode.querySelectorAll("source[data-srcset]");for(let e of t)e.setAttribute("srcset",e.dataset.srcset),e.removeAttribute("data-srcset");e.complete&&(e.style.opacity=1,e.parentNode.parentNode.querySelector("[data-placeholder-image]").style.opacity=0)}}</script></div></div><figcaption data-nosnippet="" class="image-title">Photo by Saifeddine Rajhi</figcaption></figure><h1>Securing Your Kubernetes Cluster with OPA Gatekeeper: The Power of Policy-as-Code üõ°Ô∏è</h1><div data-nosnippet="" class="blog-details"><time class="blog-createdat" dateTime="2024-10-31">Oct 31, 2024</time><span> ‚Ä¢ </span><span class="blog-time2read">6<!-- -->mins<!-- --> read</span><div class="theme-switcher"><div class="theme-switcher-toggler"><div class="theme-switcher-track"></div><div class="theme-switcher-thumb"></div><input class="theme-switcher-input" type="checkbox" readonly="" aria-label="Switch between Dark and Light modes"/></div></div></div><ul data-nosnippet="" class="blog-tags"><li>Kubernetes</li><li>OPA Gatekeeper</li><li>Policy-as-Code</li><li>k8s</li><li>DevOps</li></ul></header><div class="blog-divider"></div><div id="intro"></div><div class="content-wrapper"><div data-nosnippet="" class="blog-content-nav-wrapper"><ul class="blog-content-nav"><h2>Content</h2><ul class="toc-list"></ul></ul></div><div class="content blog-content"><blockquote>
<p><strong>Building a Fortress in Kubernetes: How OPA Gatekeeper and Policy-as-Code Keep Your Cluster Safe üõ°Ô∏è</strong></p>
</blockquote>
<h2 id="introduction" style="position:relative;"><a href="#introduction" aria-label="introduction permalink" class="anchor before"><svg class="anchor-icon" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Introduction</h2>
<p>As organizations adopt Kubernetes as their container orchestration platform, policy management becomes increasingly important. Traditional approaches to policy enforcement can be time-consuming and error-prone.</p>
<p>Manual policy reviews and audits create delays and introduce human error. In dynamic cloud environments, policies need to be constantly updated to reflect changes in the infrastructure.</p>
<p>Policy as Code (PaC) with <a href="https://www.openpolicyagent.org/docs/latest/" target="_blank" rel="noopener noreferrer">Open Policy Agent (OPA)</a> for Kubernetes provides an automated and efficient solution. PaC allows easy policy integration into CI/CD pipelines. This approach ensures consistent policy enforcement and reduces human error risk.</p>
<p><span class="gatsby-resp-image-wrapper" style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; ">
      <span class="gatsby-resp-image-background-image" style="padding-bottom: 52.352941176470594%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAKABQDASIAAhEBAxEB/8QAFwABAQEBAAAAAAAAAAAAAAAAAAUEBv/EABQBAQAAAAAAAAAAAAAAAAAAAAD/2gAMAwEAAhADEAAAAa8vfCOqB//EABsQAAEEAwAAAAAAAAAAAAAAAAMAAQQ0AhET/9oACAEBAAEFAjvoQc26qZXj2F//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/AT//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/AT//xAAdEAAABgMBAAAAAAAAAAAAAAAAAQIQIXEREkFh/9oACAEBAAY/AjnHpBMa8tlBFt//xAAbEAEAAQUBAAAAAAAAAAAAAAABEQAQIUGxYf/aAAgBAQABPyE3qxjYVBpeW9uPtJc9n//aAAwDAQACAAMAAAAQU8//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/ED//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/ED//xAAfEAEAAgIABwAAAAAAAAAAAAABABEhMRBBYYGRobH/2gAIAQEAAT8QBfLoWjgQ7ysHK1FjHPBRi/HD0vhLgTjt6MNT/9k='); background-size: cover; display: block;"></span>
  <img class="gatsby-resp-image-image" alt="bad pod" title="" src="/static/330135c77f8164bfe91aa3e5f420962c/7bf67/bad-pod.jpg" srcset="/static/330135c77f8164bfe91aa3e5f420962c/651be/bad-pod.jpg 170w,
/static/330135c77f8164bfe91aa3e5f420962c/d30a3/bad-pod.jpg 340w,
/static/330135c77f8164bfe91aa3e5f420962c/7bf67/bad-pod.jpg 680w,
/static/330135c77f8164bfe91aa3e5f420962c/990cb/bad-pod.jpg 1020w,
/static/330135c77f8164bfe91aa3e5f420962c/e5166/bad-pod.jpg 1200w" sizes="(max-width: 680px) 100vw, 680px" style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;" loading="lazy" decoding="async">
    </span>
          </p>
<h2 id="-goals--objectives" style="position:relative;"><a href="#-goals--objectives" aria-label=" goals  objectives permalink" class="anchor before"><svg class="anchor-icon" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>üéØ Goals &#x26; Objectives</h2>
<p>In this article, we will explore how Policy as Code (PaC) with Open Policy Agent (OPA) for Kubernetes can streamline policy enforcement.<br>
<strong>HAPPY LEARNING üíª</strong></p>
<p><span class="gatsby-resp-image-wrapper" style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 580px; ">
      <span class="gatsby-resp-image-background-image" style="padding-bottom: 76.47058823529412%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAAAsTAAALEwEAmpwYAAACAklEQVR42p2TXUhTYRjHR9+uTcHlljXSCkFQ2lUjiiLqoi6ivOkiyUgsYXkZRUZBQdIh6MMMFn1ABBHREMfSm75WUA5FsLwI8i5OY07Mcjt+nfOeX2fHLftgndUDL++B87y/5/0/z/+18Q+h66AJYye763/m2AoCCWEc1n9AZ1Q9b66tcJhgPKXREZ6g8cooN7snSE/NF7EE6ppmLNX8jstxQ6NCRyRNc/soD16kOXgpyb2nKfO/JvQCgNmyib4YIf8G7jQdInA1QTDylWF5mmtd3zh+e8z6hjlQ8nWUaN1uQh4H0vatBCrdnD4Vov4WSKEUe8+N0PVWMXNFPmCmX5mY+SzTWeUluqqY9jIHh8vL2Fdip6fxAOfbejh6IkqkV7EeSg44O/yRizu2Ie/cRGylg7MlS5FK7bx3LaPbs4jHZ06aeaomLKZsyDVvn4gj7dnFh80+givs3PW6eL7OQ2d1Bc+cC3nU2jo3DFW1BpoxqRAOHKHPX8P+5Uvor12LvMVHor6OfncRseCNud5ZAn+S/VJqY2BjDdPrXXyqLOXN6mKUWi9ht4ORWO8vuQUBk4MDXKgo54lzgdG/IhoW2zjmtPOwpdlUIn73y998mLPOl6F3vGpqQKpaw32/j6Hrlw1/pyEPzNLYOfDs+Bja1OR8Mf0/33JGvsi2IAMSxnO0iu/S5SwgYdyhTQAAAABJRU5ErkJggg=='); background-size: cover; display: block;"></span>
  <img class="gatsby-resp-image-image" alt="opa" title="" src="/static/626ecdac374ce2e2c867cb3db477b4cd/b6272/opa.png" srcset="/static/626ecdac374ce2e2c867cb3db477b4cd/04472/opa.png 170w,
/static/626ecdac374ce2e2c867cb3db477b4cd/9f933/opa.png 340w,
/static/626ecdac374ce2e2c867cb3db477b4cd/b6272/opa.png 580w" sizes="(max-width: 580px) 100vw, 580px" style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;" loading="lazy" decoding="async">
    </span>
          </p>
<p>To properly evaluate PaC with OPA, it's essential to first understand Policy as Code.</p>
<h3 id="policy-as-code" style="position:relative;"><a href="#policy-as-code" aria-label="policy as code permalink" class="anchor before"><svg class="anchor-icon" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Policy as Code</h3>
<p>Policy as Code involves managing policy enforcement using machine-readable definition files, rather than documentation or interactive configuration tools. The primary goal is to ensure consistent enforcement of standards and rules across clusters or organizations.</p>
<p>Once policies are established, the next step is to enforce them effectively. This is where tools like <a href="https://github.com/open-policy-agent/opa" target="_blank" rel="noopener noreferrer">OPA</a> and <a href="https://github.com/kyverno/kyverno" target="_blank" rel="noopener noreferrer">Kyverno</a> come into play.</p>
<h3 id="open-policy-agent-opa" style="position:relative;"><a href="#open-policy-agent-opa" aria-label="open policy agent opa permalink" class="anchor before"><svg class="anchor-icon" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Open Policy Agent (OPA)</h3>
<p><a href="https://www.openpolicyagent.org/" target="_blank" rel="noopener noreferrer">Open Policy Agent (OPA)</a> is an open-source tool that enables creating, validating, and enforcing policies across systems, including Kubernetes. OPA uses the declarative Rego language to define policies as code, enabling easy integration into CI/CD pipelines. It ensures consistent, efficient policy enforcement, reduces human error risk, and provides policy management flexibility based on specific use cases and requirements.</p>
<p>To expand on the capabilities of OPA in Kubernetes, let's explore the additional features provided by OPA Gatekeeper, a policy controller that runs on top of OPA.</p>
<h3 id="opa-gatekeeper" style="position:relative;"><a href="#opa-gatekeeper" aria-label="opa gatekeeper permalink" class="anchor before"><svg class="anchor-icon" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>OPA Gatekeeper</h3>
<p><a href="https://open-policy-agent.github.io/gatekeeper" target="_blank" rel="noopener noreferrer">OPA Gatekeeper</a> is a policy controller that runs on top of OPA in Kubernetes. It extends the functionality of OPA by enabling users to enforce policies at scale across multiple Kubernetes clusters. Gatekeeper uses the same declarative policy language as OPA, Rego, to define policies as code.</p>
<p>Gatekeeper integrates with Kubernetes' admission controller mechanism, which allows it to evaluate policies before resources are created or updated. This ensures that only resources that meet the defined policies are allowed to run, reducing the risk of security vulnerabilities and ensuring compliance.</p>
<p><span class="gatsby-resp-image-wrapper" style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; ">
      <span class="gatsby-resp-image-background-image" style="padding-bottom: 50.588235294117645%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsTAAALEwEAmpwYAAAChUlEQVR42jWR2U8TYRTF+4+pUWNc0OiT4cHEFWNijAZ5EDcsCJGIS9UGMSIQd42KaDRojL4YVxaxgGg705npTNuZLtNpZ6alxZ9fqz6cnJO7nHvv9wU+zlqcfaQQGtPoe6zQdV+nU+DUPYG7Ot0PDfqeGPQ+MgiKWB31/H9drz8p6sLPDYpFl8DlMYV919P0jObYO6Cz7ITK8g6DNV0a604rbD6jsjNs0HwhwepgglVBjZWnVKG1hl4l9IoOUdutETdyBK691GgdSXJ13KJtRKWlX2VbSGXXZYngA4P9AzHab6m039bZ2ic3OPTC5NgdndZBiXPPTM4/T4teDTmRJXDxqd6YtqVX5eCQQXg8z7G7SZrPSXTcT3FUmLUNy/Q8TrM9JHNgUOe4MDt0Q2d3WOHITV3AYE//P8Oh10mxeoKNp2PsvhKld9Tk8LDOph6ZlrAkzBR2XfpF65DKjpDEWvEUTd0SG7pirBdnNnX+FE+jiasMkpZNIGsXmVNdvs7pfJlN8HkuxZcfGaaiNh8jKaYFRxSXGckRXGJGdng/Y/D1h0kkXuRTJMm7CYWFeAbfF5/ieR6wxGKlTKXs4xdzSPNTuPmUCPtQE/lqSbDbQNW3sa0Erp0mb+nk0grfJj/jFGw8z68b+jhOkYnJKVJJA8oFHDuLW8iS1lXRmGXJzVJ1zAZqns3Sok/FdbDSycbAmpenWvtNqVT6u2G5XMbKZMhnUmKzNAWnhGma/IpKJOJRcnoUTZF48/YVdkrCLhT4/j0ierKNq6pFk8VqDbduWHeNxWIsLPxElmVKOZ2ipQiolO0kXi5BJROlYgljdYZFWxOXWxjyLPPTH4jPT+I7Fp5fpr7cH5mEnjtrb/tjAAAAAElFTkSuQmCC'); background-size: cover; display: block;"></span>
  <img class="gatsby-resp-image-image" alt="opa-gatekeeper" title="" src="/static/ba0fd96ef4e497eeafbf1aba8bfb27a7/c5bb3/opa-gatekeeper.png" srcset="/static/ba0fd96ef4e497eeafbf1aba8bfb27a7/04472/opa-gatekeeper.png 170w,
/static/ba0fd96ef4e497eeafbf1aba8bfb27a7/9f933/opa-gatekeeper.png 340w,
/static/ba0fd96ef4e497eeafbf1aba8bfb27a7/c5bb3/opa-gatekeeper.png 680w,
/static/ba0fd96ef4e497eeafbf1aba8bfb27a7/146da/opa-gatekeeper.png 943w" sizes="(max-width: 680px) 100vw, 680px" style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;" loading="lazy" decoding="async">
    </span>
          </p>
<h3 id="admission-controllers" style="position:relative;"><a href="#admission-controllers" aria-label="admission controllers permalink" class="anchor before"><svg class="anchor-icon" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Admission Controllers</h3>
<p>Admission controllers in Kubernetes intercept API requests, validate them against specific criteria, and mutate them if necessary. There are two types of admission controllers: mutating admission controllers and validating admission controllers. Mutating admission controllers modify requests while validating admission controllers check requests for compliance with pre-defined policies. They are a powerful tool for enforcing policies and ensuring consistency in Kubernetes environments.</p>
<p><span class="gatsby-resp-image-wrapper" style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; ">
      <span class="gatsby-resp-image-background-image" style="padding-bottom: 37.05882352941176%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAAsTAAALEwEAmpwYAAABcElEQVR42q2QzUsbURTF8w+6qVl004Xb7qQbS1GxFFyVghJKoYg7UUQLXbbatIIhxqlpY7SNJppo4sw0mZl8zOfLm58vExAXWfbC45577jn3Xl5KCIHnRxhWwD87JIykwmFSBwq3nRBT8X4o6XSVTmEvGOL0xx7XHxKo3qge6VOeNyCr3TI9f8TMskb2xCC9kCc9n2dfM3j+tsizN8d8Kei8yJR4ulTg00GT1+vnPHmVZzt7y/vdGlNzOTa+NkihojuI0P62+X1pYfcCfql8UmljdT2VLQ5LJnpnQKXe4axmqctczusOP4o6TbPHVdMmd2oojTceOCk8d4BhtNQXRLiuT+O6imO1ESLC1FuKc/H9AOPuBsfuKEec+JKBIyjjOHkjPIzjhHX6AR8/X5PZqVL8oxNLkfTDSLC5d8O7rQu+a81kkJCSWPkmXhiPl2H3QxbXyrz8UKJ81X3oi6FkZbvC7GqRbz/NhJPy0YX/M+4BpjsGLXNWy+QAAAAASUVORK5CYII='); background-size: cover; display: block;"></span>
  <img class="gatsby-resp-image-image" alt="steps" title="" src="/static/7ac61158ec2144d7082cb6e0b059485a/c5bb3/steps.png" srcset="/static/7ac61158ec2144d7082cb6e0b059485a/04472/steps.png 170w,
/static/7ac61158ec2144d7082cb6e0b059485a/9f933/steps.png 340w,
/static/7ac61158ec2144d7082cb6e0b059485a/c5bb3/steps.png 680w,
/static/7ac61158ec2144d7082cb6e0b059485a/b12f7/steps.png 1020w,
/static/7ac61158ec2144d7082cb6e0b059485a/b5a09/steps.png 1360w,
/static/7ac61158ec2144d7082cb6e0b059485a/2cefc/steps.png 1400w" sizes="(max-width: 680px) 100vw, 680px" style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;" loading="lazy" decoding="async">
    </span>
          </p>
<p>Below are the steps of our demo:</p>
<p><span class="gatsby-resp-image-wrapper" style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; ">
      <span class="gatsby-resp-image-background-image" style="padding-bottom: 62.94117647058823%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAAsTAAALEwEAmpwYAAACHUlEQVR42q2Ta0/aYBiG+d9b3L/Ypp+mX5bMqZs6zcTMlXIoJ6UFoxwU2lJbhFGgHAQr196WYDYT55c9yZW77fPcd98e3giims0m29vbZLNZcrkckiQRjUZJJBIhiqJQqVTIZDLIskwymSSVSoWzQT8mrgXedrtNJAgcjUZ0Oh2GwyGtVotGoxHexDRNKtUKumEwGHjY9g31eh3HccK+bduhBliWxXg8XgT+zwoD5/M5C4Xpvc/4bkav7z0yEefT2YPA527qMxMzgecpj4HL8sYzHHfCTdejbFpUTJtKUzxWt4/jjbEHI1q9CS0xMxHBz65wWXZnzJXjoRcEB7+oHd5iHLl4MgzkuQDM+oiaPcD1pi8HNsSget3n6qKMmT2hnpUw8jHMXFxoHFNQvbIp1Hq0xUrD1/SvwAvdRT7voqp5zpVN1NQOmkBNblHO7wl2ObtsECt2sDqjlwML1S5HuVvkfBlZiSOlkkjJBKlcBq2kogpiZ02+Z8Wv5QwfP+Rfgb7vEzB/8ImXWuz8NHhfsHilXbOSr7KiCi02eF245k3V4eOpw+eTBpdGT9gfuL9f+JdEXNcloN9z2ZNrrH0tsb5/zsZuiY29Uqjrfxx/EL3VL0UUzWA46NHtLvxLIrqui52h0zQNDiSNt58U1rbSrD5D0Hu3qZA6vcRqGqE3yFgS0TSNgGJR4/RM5fBHmv3jNN+eYT+a5jiWZel7ym+noLNSLyjKmgAAAABJRU5ErkJggg=='); background-size: cover; display: block;"></span>
  <img class="gatsby-resp-image-image" alt="demo" title="" src="/static/7e1d556e0359f2723ebc1f05cd3b4364/c5bb3/demo1.png" srcset="/static/7e1d556e0359f2723ebc1f05cd3b4364/04472/demo1.png 170w,
/static/7e1d556e0359f2723ebc1f05cd3b4364/9f933/demo1.png 340w,
/static/7e1d556e0359f2723ebc1f05cd3b4364/c5bb3/demo1.png 680w,
/static/7e1d556e0359f2723ebc1f05cd3b4364/b12f7/demo1.png 1020w,
/static/7e1d556e0359f2723ebc1f05cd3b4364/0d0e4/demo1.png 1230w" sizes="(max-width: 680px) 100vw, 680px" style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;" loading="lazy" decoding="async">
    </span>
          </p>
<h3 id="installing-opa-gatekeeper-as-crd" style="position:relative;"><a href="#installing-opa-gatekeeper-as-crd" aria-label="installing opa gatekeeper as crd permalink" class="anchor before"><svg class="anchor-icon" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Installing OPA Gatekeeper as CRD</h3>
<div class="gatsby-highlight" data-language="shell"><pre class="language-shell"><code class="language-shell">kubectl apply <span class="token parameter variable">-f</span> https://raw.githubusercontent.com/open-policy-agent/gatekeeper/master/deploy/gatekeeper.yaml</code></pre></div>
<p>This will create a namespace <code class="language-text">gatekeeper-system</code>:</p>
<div class="gatsby-highlight" data-language="shell"><pre class="language-shell"><code class="language-shell">kubectl get ns
NAME                 STATUS   AGE
default              Active   1h
gatekeeper-system    Active   48s
kube-node-lease      Active   1h
kube-public          Active   1h
kube-system          Active   1h
local-path-storage   Active   1h</code></pre></div>
<p>Following are the objects created as part of the Gatekeeper installation:</p>
<div class="gatsby-highlight" data-language="shell"><pre class="language-shell"><code class="language-shell">kubectl get all <span class="token parameter variable">-n</span> gatekeeper-system

NAME                                                 READY   STATUS    RESTARTS   AGE
pod/gatekeeper-audit-56ddcd8749-mlvjv                <span class="token number">1</span>/1     Running   <span class="token number">0</span>          2m5s
pod/gatekeeper-controller-manager-64fd6c8cfd-cqvnw   <span class="token number">1</span>/1     Running   <span class="token number">0</span>          2m4s
pod/gatekeeper-controller-manager-64fd6c8cfd-xgmxv   <span class="token number">1</span>/1     Running   <span class="token number">0</span>          2m4s
pod/gatekeeper-controller-manager-64fd6c8cfd-znxfh   <span class="token number">1</span>/1     Running   <span class="token number">0</span>          2m4s

NAME                                 TYPE        CLUSTER-IP     EXTERNAL-IP   PORT<span class="token punctuation">(</span>S<span class="token punctuation">)</span>   AGE
service/gatekeeper-webhook-service   ClusterIP   <span class="token number">10.25</span>.5.7   <span class="token operator">&lt;</span>none<span class="token operator">></span>        <span class="token number">443</span>/TCP   2m51s

NAME                                            READY   UP-TO-DATE   AVAILABLE   AGE
deployment.apps/gatekeeper-audit                <span class="token number">1</span>/1     <span class="token number">1</span>            <span class="token number">1</span>           2m5s
deployment.apps/gatekeeper-controller-manager   <span class="token number">3</span>/3     <span class="token number">3</span>            <span class="token number">3</span>           2m5s

NAME                                                       DESIRED   CURRENT   READY   AGE
replicaset.apps/gatekeeper-audit-56ddcd8749                <span class="token number">1</span>         <span class="token number">1</span>         <span class="token number">1</span>       2m5s
replicaset.apps/gatekeeper-controller-manager-64fd6c8cfd   <span class="token number">3</span>         <span class="token number">3</span>         <span class="token number">3</span>       2m5s</code></pre></div>
<p>After installing all the Gatekeeper components in the cluster, the API server will activate the Gatekeeper admission webhook to handle admission requests for resource creation, updates, and deletions. In the validation process, Gatekeeper serves as an intermediary between the API server and OPA, with the API server enforcing all policies executed by OPA.</p>
<h3 id="custom-resource-definition" style="position:relative;"><a href="#custom-resource-definition" aria-label="custom resource definition permalink" class="anchor before"><svg class="anchor-icon" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Custom Resource Definition</h3>
<p>By using the <a href="https://kubernetes.io/docs/concepts/extend-kubernetes/api-extension/custom-resources/#customresourcedefinitions" target="_blank" rel="noopener noreferrer">CustomResourceDefinition (CRD)</a> API, it is possible to define custom resources in Kubernetes. Once a CRD object is defined, a new custom resource can be created with a name and schema specified by the user. The Kubernetes API handles the storage and serving of these custom resources.</p>
<p>Gatekeeper leverages the use of CustomResourceDefinitions to enforce policies on Kubernetes resources like Pods, Deployments, and Jobs, by defining ConstraintTemplates and Constraints. As part of the installation process, Gatekeeper generates multiple CRDs to facilitate the implementation of its functionalities.</p>
<div class="gatsby-highlight" data-language="shell"><pre class="language-shell"><code class="language-shell">kubectl get crd <span class="token operator">|</span> <span class="token function">grep</span> <span class="token parameter variable">-i</span> gatekeeper

assign.mutations.gatekeeper.sh                       <span class="token number">2024</span>-10-30T13:34:01Z
assignmetadata.mutations.gatekeeper.sh               <span class="token number">2024</span>-10-30T13:34:01Z
configs.config.gatekeeper.sh                         <span class="token number">2024</span>-10-30T13:34:01Z
constraintpodstatuses.status.gatekeeper.sh           <span class="token number">2024</span>-10-30T13:34:01Z
constrainttemplatepodstatuses.status.gatekeeper.sh   <span class="token number">2024</span>-10-30T13:34:01Z
constrainttemplates.templates.gatekeeper.sh          <span class="token number">2024</span>-10-30T13:34:01Z <span class="token comment">#&lt;---</span>
expansiontemplate.expansion.gatekeeper.sh            <span class="token number">2024</span>-10-30T13:34:01Z
modifyset.mutations.gatekeeper.sh                    <span class="token number">2024</span>-10-30T13:34:01Z
mutatorpodstatuses.status.gatekeeper.sh              <span class="token number">2024</span>-10-30T13:34:01Z
providers.externaldata.gatekeeper.sh                 <span class="token number">2024</span>-10-30T13:34:01Z</code></pre></div>
<p>One of them is <code class="language-text">constrainttemplates.templates.gatekeeper.sh</code>, which allows us to create <strong>ConstraintTemplates</strong> and <strong>Constraints</strong> to work with Gatekeeper. Now, we have all the resources, Pods, and Services running in the <code class="language-text">gatekeeper-system</code> namespace.</p>
<p>The next step is to define policies. In this example, I will create a policy using Rego that denies all namespace creation if the label <code class="language-text">hr</code> is not defined. The first step is to define <strong>ConstraintTemplate</strong> and <strong>Constraint</strong> CRDs using Rego.</p>
<p><span class="gatsby-resp-image-wrapper" style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; ">
      <span class="gatsby-resp-image-background-image" style="padding-bottom: 50%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsTAAALEwEAmpwYAAACKUlEQVR42nWS7U/TUBTG94frJ01QiTFGkWjADwZJMFOIDAYjTAXH2+bEbcAodsBe2q7tuhXade2GP+8tQvzCaW567rnnPOc8T04iDEM8zyMIAnzfZzAYMBwOiaLo9t/v95F5Mkf6V1dX3GUJCVav11EUBV3XsSwL0zTjY9s2nU6HSqVCLpcjn89Tq9XiRncCyqlkoWVbcbGcQNof8UmTDTVNo1qtoqpq3Oh/wNFoJO7R7dQJ6fh+n74XEPQHhIOIQSDPQJxQ3ENBe0jfD4jCKKYt49IfDke4rovW1Oh2u3GjhERVmwobB6usFVKkd+b5Wl6meLLD1lGW9Z+LpLaSZIoLbFez6IbGrrLBan6B5Nos6d1PbB5m0NtazCYG/KXuMZ19yuTSY17OP2Lm2yRfBOhcboo3mXFep8Z5t/6CdPEDLaPJ5x/vmUiN8WzuAdMrz1nYm4njkmlCSqWZTcqnRaqNEqetYzTjjI7T5nejzOFZAVXEWu0GbcuIdT7Xj1H1ErXWIZbTFHTbIm5zeelda+i6F3iuLx4uKSgXbJZtMtsqubJDUfFEssuF0KrX62F3HL6XHFZ22swt77O4eS6kMgVlG9/7BygF7fUcDMthMq3zKFnn3lSBh7MnTCw1BZ0Obk/mdDFtR8hgMvZR5/7bfZ4kz3glchq62BBfAMpFvtk93WiTLeos5002SjaFI4PKiYYh4je7Kf1C9fp998Dg6NRCbYha3YgH+wv0B9djzhF4vAAAAABJRU5ErkJggg=='); background-size: cover; display: block;"></span>
  <img class="gatsby-resp-image-image" alt="policies" title="" src="/static/e00ca923b84a8f84c4e28a4533ef2de3/c5bb3/policies.png" srcset="/static/e00ca923b84a8f84c4e28a4533ef2de3/04472/policies.png 170w,
/static/e00ca923b84a8f84c4e28a4533ef2de3/9f933/policies.png 340w,
/static/e00ca923b84a8f84c4e28a4533ef2de3/c5bb3/policies.png 680w,
/static/e00ca923b84a8f84c4e28a4533ef2de3/b12f7/policies.png 1020w,
/static/e00ca923b84a8f84c4e28a4533ef2de3/b5a09/policies.png 1360w,
/static/e00ca923b84a8f84c4e28a4533ef2de3/e515d/policies.png 1430w" sizes="(max-width: 680px) 100vw, 680px" style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;" loading="lazy" decoding="async">
    </span>
          </p>
<h3 id="constraints-and-constraint-templates" style="position:relative;"><a href="#constraints-and-constraint-templates" aria-label="constraints and constraint templates permalink" class="anchor before"><svg class="anchor-icon" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Constraints and Constraint Templates</h3>
<ul>
<li><strong>Constraints</strong>: These are rules that enforce specific policy requirements on resources in a system. They can be defined and customized by users to meet their specific needs.</li>
<li><strong>Constraint Templates</strong>: These are reusable policy definitions that allow users to create Constraints more easily and consistently by specifying parameters for the policy rules. They provide a way to standardize policy enforcement across multiple systems and applications and can be customized and extended as needed.</li>
</ul>
<p>Having received a substantial amount of new information, I am now eager to explain to you how it all integrates in reality. <a href="https://kubernetes.io/blog/2019/08/06/opa-gatekeeper-policy-and-governance-for-kubernetes/" target="_blank" rel="noopener noreferrer">This post</a> does a great job of discussing the inter-relationships between Constraint templates and Constraint CRDs.</p>
<p>The diagram below is my pictorial representation of the relationship:</p>
<p><span class="gatsby-resp-image-wrapper" style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; ">
      <span class="gatsby-resp-image-background-image" style="padding-bottom: 45.294117647058826%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsTAAALEwEAmpwYAAAB0ElEQVR42k2R2W7bQAxF9f/fVKBAgXQB2qRxFhSObNmyPJZkRdJomUUj+5R2GjQPBwQ45CV5J3pORxZJz33SCT23ccPNYs/DVvKbnt8rzd2qo2gmVLfjUT3w4883vgu361/cPN3wVVhk9yT1imi7r3jZHIi3B17ijGSTs1ymrCWu01LyObFEPXjasSItNqSHhF22IlMJ6X5NJjlVbql0QTR2Ffq4xddHwuuFirltOA095zDB+STMwpm27Vjex6jHArXI2d0qunyAaSKMjnkKRMaMvB4zQR51Q9+39F3LIIJDrzFjh661iFkGaepaTakG6nKkEfo+4MOMdRPeeyJnjDQN+MnhvME5c41eGIeRuhlohSBbnGXL82zomoOgsL3CjTmzLZiD5XQ6y8mDpq4yqvxAe6wx2jCIgNaOVjDWy0WeeQ7Ml+t9gVbfKOLPlOtP6N0XTs1PZlNxkoLI+wnd5GRxwuExpXjaou5WVInCy9mTnOGcu043pme/lo943lEsFWWcMzYNViyyWuPHUQTdxZdK/KuwTY2VTzFFjq2qqyf+n+As072z1MeS7ti+8dpzWei9bhJbImftteH6MH3gQ+Gb4Cw+hauXIfznIvJOCIG/GbqqVmawFw4AAAAASUVORK5CYII='); background-size: cover; display: block;"></span>
  <img class="gatsby-resp-image-image" alt="relationship" title="" src="/static/867dd8c6b6fbfc09443c3a6db355ea38/c5bb3/relationship.png" srcset="/static/867dd8c6b6fbfc09443c3a6db355ea38/04472/relationship.png 170w,
/static/867dd8c6b6fbfc09443c3a6db355ea38/9f933/relationship.png 340w,
/static/867dd8c6b6fbfc09443c3a6db355ea38/c5bb3/relationship.png 680w,
/static/867dd8c6b6fbfc09443c3a6db355ea38/b12f7/relationship.png 1020w,
/static/867dd8c6b6fbfc09443c3a6db355ea38/121b3/relationship.png 1070w" sizes="(max-width: 680px) 100vw, 680px" style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;" loading="lazy" decoding="async">
    </span>
          </p>
<p>Starting with the <a href="https://github.com/open-policy-agent/gatekeeper/blob/master/example/templates/k8srequiredlabels_template.yaml" target="_blank" rel="noopener noreferrer">constraint template</a> which is a YAML file named ConstraintTemplate.yaml.</p>
<p><span class="gatsby-resp-image-wrapper" style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; ">
      <span class="gatsby-resp-image-background-image" style="padding-bottom: 101.76470588235296%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAsTAAALEwEAmpwYAAAC7ElEQVR42o1U2W7bMBDM/39QCzRFgRboQ2IjcYpcli1btnVS1EHdkhNMZ9kk7UNb52HBJbicnT3PVrGDO/8W23AD3z/AcRx4nof9fo8wDJGmqZUwCGCMwTiOGIbhryJvZ8voER/uPuLefUQQhAiiEFsCKoIcn58xHidMxyOmpyeM0/RPsDfAKAtw5y2QK4XY96HIKvYD6ChCR0ZdVaGn2LNuTgPG8R6LxwvUeYZJPpgKI2UQsKJEWxRWRK8Shb7v/w/YmxqH7IAL7xJFbTD0I/qRBnzsxYjhHiVcSpXnpwENmT0NR2yUi6vtFRx3idVqBdd14SyXUExFQYZN0zCKdwBWEipZrZM1Pj+c42Z1g9lshuvFNebzORY3C0TMZ1VXENu+OwFovXYdXDK83F7AVz4KXUAxX0mSIIkTtE2LJwk5y04zFMCubXEX3OL84RMuNxc2fMlrWATw9BbKKOoh+9LD2A+nQxYjVSrMvBnmlMXuCrrUlk3btej6zuomS9/BUFqCIU/TEQ6n5svjF6icH9veGvyajNE29fuKwrzUZYmRAE1l8N35Cm/PCt8/oMg0RjrrmZKBYtQ7+rBh792s5/ixuUKqOCXBAUkY2KmJDwekrLBMT84CSTQnJ0VCNW2Fb2Tm+muoKEYcx6xygohAshTknkmF5SMZWpZ/nMPQ/wZ8VcS7IVjLItUMtWG+ai6IjumQljm+LIc3GV9OTpJdGi/5fgOstEbOMPV+h5LsCm6dggwLWVs6RcbVJrrY5NQln3LXux2qVKM1xrK1gILecbT0zkO6cW0Dp5sNMuYwJ2hGJ9lhD73dQK1XSNZra2d1jmke+ChJoKvrF0CKTEuycpBwwRZxxHNpQYS5sBbGLT+07ISmLCwBYSUgMhivLXZmFeagZwML/ZyshIn2tvQa2d6rydikinktyF5bUAGXvItDaauRvToJYMuLSMXki9itQs+NfODdyCd5k6KJsGgV3yvDNzordWZtBUMG5CdyQu8hCCeizAAAAABJRU5ErkJggg=='); background-size: cover; display: block;"></span>
  <img class="gatsby-resp-image-image" alt="ConstraintTemplate" title="" src="/static/1e24eb0a6e52e4b823d09161e8674449/c5bb3/ConstraintTemplate.png" srcset="/static/1e24eb0a6e52e4b823d09161e8674449/04472/ConstraintTemplate.png 170w,
/static/1e24eb0a6e52e4b823d09161e8674449/9f933/ConstraintTemplate.png 340w,
/static/1e24eb0a6e52e4b823d09161e8674449/c5bb3/ConstraintTemplate.png 680w,
/static/1e24eb0a6e52e4b823d09161e8674449/57dc1/ConstraintTemplate.png 718w" sizes="(max-width: 680px) 100vw, 680px" style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;" loading="lazy" decoding="async">
    </span>
          </p>
<p>Create the ConstraintTemplate using the above-defined manifests:</p>
<div class="gatsby-highlight" data-language="shell"><pre class="language-shell"><code class="language-shell">kubectl create <span class="token parameter variable">-f</span> ConstraintTemplate.yaml
<span class="token comment">#„ÄÄList the available ConstraintTemplate's </span>
kubectl get ConstraintTemplate
NAME                AGE
k8srequiredlabels   59s
Constraint: Namespace label</code></pre></div>
<p>Let's generate a Constraint specification in the file <code class="language-text">ns-enforce-label.yaml</code> that mandates a namespace to have a label named "hr" whenever it is generated.</p>
<p><span class="gatsby-resp-image-wrapper" style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 606px; ">
      <span class="gatsby-resp-image-background-image" style="padding-bottom: 61.76470588235294%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAAsTAAALEwEAmpwYAAACCElEQVR42oWTWW/aQBSF+f9/ppX60ohIVF0CaVhCxFaMd2PwhjHjHdDXsRNVfWjJw9HRSL6fz71zpyNywcJdsN6vWTkzjL1CEkW4lsXesdm9uWuZmIaBab6653u4rst2u0XTNWzb5nQ60fGOHnerO4bKI4NBj6+De+aTMbPRiMnjI6N+X54nqPMZ5nqN7TgYEuj7Pp7ntWpgDTxNUzrhKaCn9BhrQ0aT7+irJc5mQ9B8pGm4uo4vUwoJqGTB5XrlcrlQ1zXnRudze268LEs6WZEx2874LFN+eelirCVQU7E2CraqtqlcQ0JNoy0oiqJV+eZ/qwUWVcHUmTK1X4ia+MqGzXIhwetWynzegpuUTcF76giR0Bt/Yrj4hmtrVMcjRXwgf1PZnA8HskNEGgYIqZvAMss5RD4/zSful1282ONaXzlXZ+qq/tNK02JZVSRylkWe/x+YihNlIohExNR6ZmKOsUILzVdx4i0izRBJQiYhZzn8JAhuA/NUkMkCrrSJ+nqf7qrLszXh5dcTrqLgGxqh3EUhWw/d3WvaWy27noUe6iie0gIf1AcS+aM0ijnaFvHWIZZ+DHwCuW+3gWmOs9N5Mod8nH5goA/QdwaxvHERx2SyuJY7Vsmdq9uW35lhJmTLXsDO1Rkuf6DocwL5Gjx1gy+XOpRP6yTn1lxG4/F+3wKLf+xho99ROoIi0ofYDAAAAABJRU5ErkJggg=='); background-size: cover; display: block;"></span>
  <img class="gatsby-resp-image-image" alt="Constraint" title="" src="/static/1cbee96c7efa1a130354bacbf2c2844a/4d4a2/Constraint.png" srcset="/static/1cbee96c7efa1a130354bacbf2c2844a/04472/Constraint.png 170w,
/static/1cbee96c7efa1a130354bacbf2c2844a/9f933/Constraint.png 340w,
/static/1cbee96c7efa1a130354bacbf2c2844a/4d4a2/Constraint.png 606w" sizes="(max-width: 606px) 100vw, 606px" style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;" loading="lazy" decoding="async">
    </span>
          </p>
<p>Create the Constraint on our Kubernetes cluster and list the available constraints:</p>
<div class="gatsby-highlight" data-language="shell"><pre class="language-shell"><code class="language-shell">kubectl create <span class="token parameter variable">-f</span> ns-enforce-label.yaml
<span class="token comment"># List the available Constraints</span>
kubectl get constraints
NAME                      ENFORCEMENT-ACTION   TOTAL-VIOLATIONS
ns-must-have-hr                                 <span class="token number">13</span></code></pre></div>
<p>Next, create a namespace without defining the required label, which is "hr" in this case:</p>
<div class="gatsby-highlight" data-language="shell"><pre class="language-shell"><code class="language-shell">kubectl create ns demo
Error from server <span class="token punctuation">(</span>Forbidden<span class="token punctuation">)</span>: admission webhook <span class="token string">"validation.gatekeeper.sh"</span> denied the request: <span class="token punctuation">[</span>ns-must-have-hr<span class="token punctuation">]</span> you must provide labels: <span class="token punctuation">{</span><span class="token string">"hr"</span><span class="token punctuation">}</span></code></pre></div>
<p>Now, create a namespace using the required label and observe the result:</p>
<div class="gatsby-highlight" data-language="yaml"><pre class="language-yaml"><code class="language-yaml"><span class="token comment"># demo-ns.yaml</span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Namespace
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> demo
    <span class="token key atrule">labels</span><span class="token punctuation">:</span>
        <span class="token key atrule">hr</span><span class="token punctuation">:</span> foo   <span class="token comment">#&lt;---</span>
<span class="token punctuation">---</span></code></pre></div>
<div class="gatsby-highlight" data-language="shell"><pre class="language-shell"><code class="language-shell">kubectl create <span class="token parameter variable">-f</span> demo-ns.yaml
namespace/demo created</code></pre></div>
<p>In the above demonstration, we can see that the namespace is created without any issues because we specified the required label.</p>
<h2 id="-conclusion-" style="position:relative;"><a href="#-conclusion-" aria-label=" conclusion  permalink" class="anchor before"><svg class="anchor-icon" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>üåü Conclusion üåü</h2>
<p>OPA enables developers to write and implement policies as code, making it easier to enforce and validate policies across an organization's infrastructure. This blog discussed the importance of policy as code, the structure of OPA policies, and how they can be used to enforce policies in Kubernetes.</p>
<p>I hope you enjoyed this hands-on tutorial and learned more than you knew before. Let me know if you have any questions related to this blog.</p>
<br>
<p><strong><em>Until next time, „Å§„Å•„Åè üéâ</em></strong></p>
<blockquote>
<p>üí° Thank you for Reading !! üôåüèªüòÅüìÉ, see you in the next blog.ü§ò  <strong><em>Until next time üéâ</em></strong></p>
</blockquote>
<p>üöÄ Thank you for sticking up till the end. If you have any questions/feedback regarding this blog feel free to connect with me:</p>
<p><strong>‚ôªÔ∏è LinkedIn:</strong> <a href="https://www.linkedin.com/in/rajhi-saif/" target="_blank" rel="noopener noreferrer">https://www.linkedin.com/in/rajhi-saif/</a></p>
<p><strong>‚ôªÔ∏è X/Twitter:</strong> <a href="https://x.com/rajhisaifeddine" target="_blank" rel="noopener noreferrer">https://x.com/rajhisaifeddine</a></p>
<p><strong>The end ‚úåüèª</strong></p>
<h1 align="center">üî∞ Keep Learning !! Keep Sharing !! üî∞</h1>
<p><strong>üìÖ Stay updated</strong></p>
<p>Subscribe to our newsletter for more insights on AWS cloud computing and containers.x</p></div></div><div id="content-end"></div></article><div data-nosnippet="" class="social-share-wrapper"><h3>Share Your Love</h3><button keywords="" aria-label="Share Via Facebook" class="react-share__ShareButton social-share-item facebook" style="background-color:transparent;border:none;padding:0;font:inherit;color:inherit;cursor:pointer"><svg aria-hidden="true" focusable="false" data-prefix="fab" data-icon="facebook" class="svg-inline--fa fa-facebook " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M512 256C512 114.6 397.4 0 256 0S0 114.6 0 256C0 376 82.7 476.8 194.2 504.5V334.2H141.4V256h52.8V222.3c0-87.1 39.4-127.5 125-127.5c16.2 0 44.2 3.2 55.7 6.4V172c-6-.6-16.5-1-29.6-1c-42 0-58.2 15.9-58.2 57.2V256h83.6l-14.4 78.2H287V510.1C413.8 494.8 512 386.9 512 256h0z"></path></svg></button><button keywords="" aria-label="Share Via Twitter" class="react-share__ShareButton social-share-item twitter" style="background-color:transparent;border:none;padding:0;font:inherit;color:inherit;cursor:pointer"><svg aria-hidden="true" focusable="false" data-prefix="fab" data-icon="x-twitter" class="svg-inline--fa fa-x-twitter " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M389.2 48h70.6L305.6 224.2 487 464H345L233.7 318.6 106.5 464H35.8L200.7 275.5 26.8 48H172.4L272.9 180.9 389.2 48zM364.4 421.8h39.1L151.1 88h-42L364.4 421.8z"></path></svg></button><button aria-label="Share Via LinkedIn" keywords="" class="react-share__ShareButton social-share-item linkedin" style="background-color:transparent;border:none;padding:0;font:inherit;color:inherit;cursor:pointer"><svg aria-hidden="true" focusable="false" data-prefix="fab" data-icon="linkedin" class="svg-inline--fa fa-linkedin " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"></path></svg></button><button keywords="" aria-label="Share Via Reddit" class="react-share__ShareButton social-share-item reddit" style="background-color:transparent;border:none;padding:0;font:inherit;color:inherit;cursor:pointer"><svg aria-hidden="true" focusable="false" data-prefix="fab" data-icon="reddit" class="svg-inline--fa fa-reddit " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M0 256C0 114.6 114.6 0 256 0S512 114.6 512 256s-114.6 256-256 256L37.1 512c-13.7 0-20.5-16.5-10.9-26.2L75 437C28.7 390.7 0 326.7 0 256zM349.6 153.6c23.6 0 42.7-19.1 42.7-42.7s-19.1-42.7-42.7-42.7c-20.6 0-37.8 14.6-41.8 34c-34.5 3.7-61.4 33-61.4 68.4l0 .2c-37.5 1.6-71.8 12.3-99 29.1c-10.1-7.8-22.8-12.5-36.5-12.5c-33 0-59.8 26.8-59.8 59.8c0 24 14.1 44.6 34.4 54.1c2 69.4 77.6 125.2 170.6 125.2s168.7-55.9 170.6-125.3c20.2-9.6 34.1-30.2 34.1-54c0-33-26.8-59.8-59.8-59.8c-13.7 0-26.3 4.6-36.4 12.4c-27.4-17-62.1-27.7-100-29.1l0-.2c0-25.4 18.9-46.5 43.4-49.9l0 0c4.4 18.8 21.3 32.8 41.5 32.8zM177.1 246.9c16.7 0 29.5 17.6 28.5 39.3s-13.5 29.6-30.3 29.6s-31.4-8.8-30.4-30.5s15.4-38.3 32.1-38.3zm190.1 38.3c1 21.7-13.7 30.5-30.4 30.5s-29.3-7.9-30.3-29.6c-1-21.7 11.8-39.3 28.5-39.3s31.2 16.6 32.1 38.3zm-48.1 56.7c-10.3 24.6-34.6 41.9-63 41.9s-52.7-17.3-63-41.9c-1.2-2.9 .8-6.2 3.9-6.5c18.4-1.9 38.3-2.9 59.1-2.9s40.7 1 59.1 2.9c3.1 .3 5.1 3.6 3.9 6.5z"></path></svg></button><button keywords="" aria-label="Add to Pocket" class="react-share__ShareButton social-share-item pocket" style="background-color:transparent;border:none;padding:0;font:inherit;color:inherit;cursor:pointer"><svg aria-hidden="true" focusable="false" data-prefix="fab" data-icon="get-pocket" class="svg-inline--fa fa-get-pocket " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M407.6 64h-367C18.5 64 0 82.5 0 104.6v135.2C0 364.5 99.7 464 224.2 464c124 0 223.8-99.5 223.8-224.2V104.6c0-22.4-17.7-40.6-40.4-40.6zm-162 268.5c-12.4 11.8-31.4 11.1-42.4 0C89.5 223.6 88.3 227.4 88.3 209.3c0-16.9 13.8-30.7 30.7-30.7 17 0 16.1 3.8 105.2 89.3 90.6-86.9 88.6-89.3 105.5-89.3 16.9 0 30.7 13.8 30.7 30.7 0 17.8-2.9 15.7-114.8 123.2z"></path></svg></button></div><br/><br/><br/></main><aside class="blogpost-sidebar"><div data-nosnippet="" class="blog-navigation-wrapper"><h3>Read Other Posts</h3><nav class="blog-navigation"><div class="nav-links"><a rel="next" class="next-post" href="/blog/kubernetes-validation-cel/">Introducing Kubernetes Validation with Common Expression Language (CEL) ‚òØ<!-- --> ‚Üí</a><a rel="prev" class="prev-post" href="/blog/eks-upgrade-guide/">‚Üê <!-- -->EKS cluster upgrades: A Step-by-Step guide to a secure Process</a><a class="all-posts" href="/blog/">All Posts</a></div></nav></div></aside><footer data-nosnippet=""><div class="footer-wrapper"><div data-nosnippet="" class="social"><ul class="social-list"><li class="social-item social-linkedin"><a rel="me" itemProp="url" eventCategory="social" eventAction="click" eventLabel="linkedin" href="https://www.linkedin.com/in/rajhi-saif/" title="Saifeddine Rajhi on LinkedIn" target="blank"><svg aria-hidden="true" focusable="false" data-prefix="fab" data-icon="linkedin-in" class="svg-inline--fa fa-linkedin-in fa-beat fa-2x " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M100.28 448H7.4V148.9h92.88zM53.79 108.1C24.09 108.1 0 83.5 0 53.8a53.79 53.79 0 0 1 107.58 0c0 29.7-24.1 54.3-53.79 54.3zM447.9 448h-92.68V302.4c0-34.7-.7-79.2-48.29-79.2-48.29 0-55.69 37.7-55.69 76.7V448h-92.78V148.9h89.08v40.8h1.3c12.4-23.5 42.69-48.3 87.88-48.3 94 0 111.28 61.9 111.28 142.3V448z"></path></svg><span>LinkedIn</span></a></li><li class="social-item social-github"><a rel="me" itemProp="url" eventCategory="social" eventAction="click" eventLabel="github" href="https://github.com/seifrajhi" title="Saifeddine Rajhi on Github" target="blank"><svg aria-hidden="true" focusable="false" data-prefix="fab" data-icon="github" class="svg-inline--fa fa-github fa-beat fa-2x " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path fill="currentColor" d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"></path></svg><span>GitHub</span></a></li><li class="social-item social-email"><a itemProp="email" eventCategory="social" eventAction="click" eventLabel="email" href="mailto:rajhiseif@gmail.com" title="Saifeddine Rajhi&#x27;s Email"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="envelope" class="svg-inline--fa fa-envelope fa-beat fa-2x " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M48 64C21.5 64 0 85.5 0 112c0 15.1 7.1 29.3 19.2 38.4L236.8 313.6c11.4 8.5 27 8.5 38.4 0L492.8 150.4c12.1-9.1 19.2-23.3 19.2-38.4c0-26.5-21.5-48-48-48L48 64zM0 176L0 384c0 35.3 28.7 64 64 64l384 0c35.3 0 64-28.7 64-64l0-208L294.4 339.2c-22.8 17.1-54 17.1-76.8 0L0 176z"></path></svg><span>Email</span></a></li><li class="social-item social-bluesky"><a rel="me" itemProp="url" eventCategory="bluesky" eventAction="click" eventLabel="social" href="https://bsky.app/profile/saifrajhi.bsky.social" title="Saifeddine Rajhi on Bluesky Social" target="blank"><svg aria-hidden="true" focusable="false" data-prefix="fab" data-icon="bluesky" class="svg-inline--fa fa-bluesky fa-beat fa-2x " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M111.8 62.2C170.2 105.9 233 194.7 256 242.4c23-47.6 85.8-136.4 144.2-180.2c42.1-31.6 110.3-56 110.3 21.8c0 15.5-8.9 130.5-14.1 149.2C478.2 298 412 314.6 353.1 304.5c102.9 17.5 129.1 75.5 72.5 133.5c-107.4 110.2-154.3-27.6-166.3-62.9l0 0c-1.7-4.9-2.6-7.8-3.3-7.8s-1.6 3-3.3 7.8l0 0c-12 35.3-59 173.1-166.3 62.9c-56.5-58-30.4-116 72.5-133.5C100 314.6 33.8 298 15.7 233.1C10.4 214.4 1.5 99.4 1.5 83.9c0-77.8 68.2-53.4 110.3-21.8z"></path></svg><span>Bluesky Social</span></a></li><li class="social-item social-X/Twitter"><a rel="me" itemProp="url" eventCategory="social" eventAction="click" eventLabel="X/Twitter" href="https://x.com/RajhiSaifeddine" title="Saifeddine Rajhi on X/Twitter" target="blank"><svg aria-hidden="true" focusable="false" data-prefix="fab" data-icon="x-twitter" class="svg-inline--fa fa-x-twitter fa-beat fa-2x " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M389.2 48h70.6L305.6 224.2 487 464H345L233.7 318.6 106.5 464H35.8L200.7 275.5 26.8 48H172.4L272.9 180.9 389.2 48zM364.4 421.8h39.1L151.1 88h-42L364.4 421.8z"></path></svg><span>X/Twitter</span></a></li><li class="social-item social-reddit"><a rel="me" itemProp="url" eventCategory="social" eventAction="click" eventLabel="reddit" href="https://www.reddit.com/user/ScoreApprehensive992/" title="Saifeddine Rajhi on Reddit" target="blank"><svg aria-hidden="true" focusable="false" data-prefix="fab" data-icon="reddit-alien" class="svg-inline--fa fa-reddit-alien fa-beat fa-2x " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M373 138.6c-25.2 0-46.3-17.5-51.9-41l0 0c-30.6 4.3-54.2 30.7-54.2 62.4l0 .2c47.4 1.8 90.6 15.1 124.9 36.3c12.6-9.7 28.4-15.5 45.5-15.5c41.3 0 74.7 33.4 74.7 74.7c0 29.8-17.4 55.5-42.7 67.5c-2.4 86.8-97 156.6-213.2 156.6S45.5 410.1 43 323.4C17.6 311.5 0 285.7 0 255.7c0-41.3 33.4-74.7 74.7-74.7c17.2 0 33 5.8 45.7 15.6c34-21.1 76.8-34.4 123.7-36.4l0-.3c0-44.3 33.7-80.9 76.8-85.5C325.8 50.2 347.2 32 373 32c29.4 0 53.3 23.9 53.3 53.3s-23.9 53.3-53.3 53.3zM157.5 255.3c-20.9 0-38.9 20.8-40.2 47.9s17.1 38.1 38 38.1s36.6-9.8 37.8-36.9s-14.7-49.1-35.7-49.1zM395 303.1c-1.2-27.1-19.2-47.9-40.2-47.9s-36.9 22-35.7 49.1c1.2 27.1 16.9 36.9 37.8 36.9s39.3-11 38-38.1zm-60.1 70.8c1.5-3.6-1-7.7-4.9-8.1c-23-2.3-47.9-3.6-73.8-3.6s-50.8 1.3-73.8 3.6c-3.9 .4-6.4 4.5-4.9 8.1c12.9 30.8 43.3 52.4 78.7 52.4s65.8-21.6 78.7-52.4z"></path></svg><span>Reddit</span></a></li><li class="social-item social-stackoverflow"><a rel="me" itemProp="url" eventCategory="social" eventAction="click" eventLabel="StackOverflow" href="https://stackoverflow.com/users/21897244/saifeddine-rajhi" title="Saifeddine Rajhi on StackOverflow" target="blank"><svg aria-hidden="true" focusable="false" data-prefix="fab" data-icon="stack-overflow" class="svg-inline--fa fa-stack-overflow fa-beat fa-2x " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512"><path fill="currentColor" d="M290.7 311L95 269.7 86.8 309l195.7 41zm51-87L188.2 95.7l-25.5 30.8 153.5 128.3zm-31.2 39.7L129.2 179l-16.7 36.5L293.7 300zM262 32l-32 24 119.3 160.3 32-24zm20.5 328h-200v39.7h200zm39.7 80H42.7V320h-40v160h359.5V320h-40z"></path></svg><span>StackOverflow</span></a></li><li class="social-item social-Goodreads"><a rel="me" eventLabel="StackOverflow" href="https://www.goodreads.com/user/show/176103378-saifeddine" title="Saifeddine Rajhi on Goodreads" target="blank"><svg aria-hidden="true" focusable="false" data-prefix="fab" data-icon="goodreads" class="svg-inline--fa fa-goodreads fa-beat fa-2x " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M299.9 191.2c5.1 37.3-4.7 79-35.9 100.7-22.3 15.5-52.8 14.1-70.8 5.7-37.1-17.3-49.5-58.6-46.8-97.2 4.3-60.9 40.9-87.9 75.3-87.5 46.9-.2 71.8 31.8 78.2 78.3zM448 88v336c0 30.9-25.1 56-56 56H56c-30.9 0-56-25.1-56-56V88c0-30.9 25.1-56 56-56h336c30.9 0 56 25.1 56 56zM330 313.2s-.1-34-.1-217.3h-29v40.3c-.8.3-1.2-.5-1.6-1.2-9.6-20.7-35.9-46.3-76-46-51.9.4-87.2 31.2-100.6 77.8-4.3 14.9-5.8 30.1-5.5 45.6 1.7 77.9 45.1 117.8 112.4 115.2 28.9-1.1 54.5-17 69-45.2.5-1 1.1-1.9 1.7-2.9.2.1.4.1.6.2.3 3.8.2 30.7.1 34.5-.2 14.8-2 29.5-7.2 43.5-7.8 21-22.3 34.7-44.5 39.5-17.8 3.9-35.6 3.8-53.2-1.2-21.5-6.1-36.5-19-41.1-41.8-.3-1.6-1.3-1.3-2.3-1.3h-26.8c.8 10.6 3.2 20.3 8.5 29.2 24.2 40.5 82.7 48.5 128.2 37.4 49.9-12.3 67.3-54.9 67.4-106.3z"></path></svg><span>Goodreads</span></a></li><li class="social-item social-osi"><a rel="me" itemProp="url" eventCategory="social" eventAction="click" eventLabel="StackOverflow" href="https://ossinsight.io/analyze/seifrajhi" title="Saifeddine Rajhi on OSSInsights" target="blank"><svg aria-hidden="true" focusable="false" data-prefix="fab" data-icon="osi" class="svg-inline--fa fa-osi fa-beat fa-2x " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M8 266.44C10.3 130.64 105.4 34 221.8 18.34c138.8-18.6 255.6 75.8 278 201.1 21.3 118.8-44 230-151.6 274-9.3 3.8-14.4 1.7-18-7.7q-26.7-69.45-53.4-139c-3.1-8.1-1-13.2 7-16.8 24.2-11 39.3-29.4 43.3-55.8a71.47 71.47 0 0 0-64.5-82.2c-39-3.4-71.8 23.7-77.5 59.7-5.2 33 11.1 63.7 41.9 77.7 9.6 4.4 11.5 8.6 7.8 18.4q-26.85 69.9-53.7 139.9c-2.6 6.9-8.3 9.3-15.5 6.5-52.6-20.3-101.4-61-130.8-119-24.9-49.2-25.2-87.7-26.8-108.7zm20.9-1.9c.4 6.6.6 14.3 1.3 22.1 6.3 71.9 49.6 143.5 131 183.1 3.2 1.5 4.4.8 5.6-2.3q22.35-58.65 45-117.3c1.3-3.3.6-4.8-2.4-6.7-31.6-19.9-47.3-48.5-45.6-86 1-21.6 9.3-40.5 23.8-56.3 30-32.7 77-39.8 115.5-17.6a91.64 91.64 0 0 1 45.2 90.4c-3.6 30.6-19.3 53.9-45.7 69.8-2.7 1.6-3.5 2.9-2.3 6q22.8 58.8 45.2 117.7c1.2 3.1 2.4 3.8 5.6 2.3 35.5-16.6 65.2-40.3 88.1-72 34.8-48.2 49.1-101.9 42.3-161-13.7-117.5-119.4-214.8-255.5-198-106.1 13-195.3 102.5-197.1 225.8z"></path></svg><span>OSSInsights</span></a></li><li class="social-item social-devstats"><a rel="me" itemProp="url" eventCategory="social" eventAction="click" eventLabel="StackOverflow" href="https://devstats.cluster.fun/?user=seifrajhi" title="Saifeddine Rajhi on DevStats" target="blank"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="chart-line" class="svg-inline--fa fa-chart-line fa-beat fa-2x " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M64 64c0-17.7-14.3-32-32-32S0 46.3 0 64L0 400c0 44.2 35.8 80 80 80l400 0c17.7 0 32-14.3 32-32s-14.3-32-32-32L80 416c-8.8 0-16-7.2-16-16L64 64zm406.6 86.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0L320 210.7l-57.4-57.4c-12.5-12.5-32.8-12.5-45.3 0l-112 112c-12.5 12.5-12.5 32.8 0 45.3s32.8 12.5 45.3 0L240 221.3l57.4 57.4c12.5 12.5 32.8 12.5 45.3 0l128-128z"></path></svg><span>DevStats</span></a></li><li class="social-item social-RSS"><a rel="me" itemProp="url" eventCategory="social" eventAction="click" eventLabel="RSS" href="https://seifrajhi.github.io/rss.xml" title="Subscribe to my blog post" target="blank"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="rss" class="svg-inline--fa fa-rss fa-beat fa-2x " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M0 64C0 46.3 14.3 32 32 32c229.8 0 416 186.2 416 416c0 17.7-14.3 32-32 32s-32-14.3-32-32C384 253.6 226.4 96 32 96C14.3 96 0 81.7 0 64zM0 416a64 64 0 1 1 128 0A64 64 0 1 1 0 416zM32 160c159.1 0 288 128.9 288 288c0 17.7-14.3 32-32 32s-32-14.3-32-32c0-123.7-100.3-224-224-224c-17.7 0-32-14.3-32-32s14.3-32 32-32z"></path></svg><span>RSS</span></a></li></ul></div><div class="copyright">Saifeddine Rajhi ¬© 1994 - <!-- -->2025<!-- --> <br/><a rel="license" href="https://creativecommons.org/licenses/by/4.0/" title="Content is published under CC BY 4.0 license">CC BY 4.0</a></div><div class="pgp"><a href="https://keybase.io/saifrajhi">0C3B BABB 8BC1 EA2B</a></div></div></footer></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/blog/kubernetes-opa-gatekeeper-policy-as-code/";/*]]>*/</script><!-- slice-start id="_gatsby-scripts-1" -->
          <script
            id="gatsby-chunk-mapping"
          >
            window.___chunkMapping="{\"app\":[\"/app-841ae7833f9baaa41e35.js\"],\"component---cache-caches-gatsby-plugin-offline-app-shell-js\":[\"/component---cache-caches-gatsby-plugin-offline-app-shell-js-88fb5c28d68e831e730a.js\"],\"component---src-pages-404-tsx\":[\"/component---src-pages-404-tsx-83bdb4e48c18bf191297.js\"],\"component---src-pages-blog-js\":[\"/component---src-pages-blog-js-ecde77d98197d52cb813.js\"],\"component---src-pages-cv-platform-engineer-js\":[\"/component---src-pages-cv-platform-engineer-js-b123892ec44b2247c14c.js\"],\"component---src-pages-index-tsx\":[\"/component---src-pages-index-tsx-ea9268b02241eb42b7ab.js\"],\"component---src-pages-talks-js\":[\"/component---src-pages-talks-js-be8ac3db9e3c2f2f5cd6.js\"],\"component---src-pages-thoughts-js\":[\"/component---src-pages-thoughts-js-54f56c1476e2dcbf7fc4.js\"],\"component---src-templates-blog-template-js\":[\"/component---src-templates-blog-template-js-36418f189bad33f744db.js\"],\"component---src-templates-talk-template-js\":[\"/component---src-templates-talk-template-js-7623845caf43043e0341.js\"],\"component---src-templates-thought-template-js\":[\"/component---src-templates-thought-template-js-4e873e19a182fe3c30b3.js\"]}";
          </script>
        <script>window.___webpackCompilationHash="9600e2f7479c4625ce7f";</script><script src="/webpack-runtime-f12c1039389262de0401.js" async></script><script src="/framework-c989293af61a95023f7f.js" async></script><script src="/app-841ae7833f9baaa41e35.js" async></script><!-- slice-end id="_gatsby-scripts-1" --></body></html>