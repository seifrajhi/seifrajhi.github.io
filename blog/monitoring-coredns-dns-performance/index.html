<!DOCTYPE html><html lang="en" class="blogpost-view-page"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1, shrink-to-fit=no"/><meta data-react-helmet="true" name="description" property="og:description" content="Ensure reliable DNS resolution in Amazon Kubernetes clusters by monitoring CoreDNS performance. This guide covers essential metrics and best practices for effective DNS monitoring."/><meta data-react-helmet="true" name="keywords" content="CoreDNS,Amazon EKS,Kubernetes,Monitoring"/><meta data-react-helmet="true" name="author" content="@RajhiSaifeddine"/><meta data-react-helmet="true" property="og:title" content="Everything You Need to Know About Monitoring CoreDNS for DNS Performance - Blog"/><meta data-react-helmet="true" property="og:type" content="article"/><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"/><meta data-react-helmet="true" name="twitter:creator" content="@RajhiSaifeddine"/><meta data-react-helmet="true" name="twitter:title" content="Everything You Need to Know About Monitoring CoreDNS for DNS Performance - Blog"/><meta data-react-helmet="true" name="twitter:description" content="Ensure reliable DNS resolution in Amazon Kubernetes clusters by monitoring CoreDNS performance. This guide covers essential metrics and best practices for effective DNS monitoring."/><meta data-react-helmet="true" name="image" property="og:image" content="https://seifrajhi.github.io/static/bf9e127d7b6dc07f97525a890e662947/e7e88/coredns-cover.png"/><meta data-react-helmet="true" name="twitter:image" content="https://seifrajhi.github.io/static/bf9e127d7b6dc07f97525a890e662947/e7e88/coredns-cover.png"/><meta data-react-helmet="true" property="og:url" content="https://seifrajhi.github.io/blog/monitoring-coredns-dns-performance/"/><meta name="theme-color" content="#ffffff"/><link rel="stylesheet" href="/styles.19780313cdbeec1e4ef5.css"/><link rel="stylesheet"/><link rel="alternate" type="application/rss+xml" title="Saifeddine Rajhi&#x27;s Blog RSS Feed" href="/rss.xml"/><title data-react-helmet="true">Everything You Need to Know About Monitoring CoreDNS for DNS Performance - Blog by Saifeddine Rajhi</title><script data-react-helmet="true" type="application/ld+json">{"@context":"http://schema.org","@type":"BlogPosting","image":"/static/bf9e127d7b6dc07f97525a890e662947/e7e88/coredns-cover.png","headline":"Everything You Need to Know About Monitoring CoreDNS for DNS Performance","dateCreated":"2024-10-21","datePublished":"2024-10-21","dateModified":"2024-10-21","inLanguage":"en-US","isFamilyFriendly":true,"isAccessibleForFree":true,"author":{"@type":"Person","name":"Saifeddine Rajhi","url":"https://seifrajhi.github.io"},"publisher":{"@type":"Organization","name":"Saifeddine Rajhi's Website"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://seifrajhi.github.io/blog/monitoring-coredns-dns-performance/"},"keywords":["CoreDNS","Amazon EKS","Kubernetes","Monitoring"],"genre":["Platform engineer","software engineering","science","deep learning","statistics"],"articleSection":"Technical Blog","articleBody":"\n## üìö Introduction\n\nRunning DNS-intensive workloads can sometimes lead to intermittent [CoreDNS](https://kubernetes.io/docs/tasks/administer-cluster/dns-custom-nameservers/#coredns) failures caused by DNS throttling. These issues can have a significant impact on your applications.\n\nSuch disruptions can hinder the reliability and performance of your services, making it mandatory to have a monitoring solution in place. AWS offers a suite of open-source tools‚Ää‚Äî‚Ää[CloudWatch](https://aws.amazon.com/cloudwatch/), [Fluentd](https://www.fluentd.org/), and [Grafana](https://grafana.com/)‚Ää‚Äî‚Ääthat can be integrated to monitor CoreDNS.\n\n## üß© Introduction to Kubernetes DNS\n\nKubernetes relies on [DNS](https://kubernetes.io/docs/tasks/administer-cluster/dns-custom-nameservers/#introduction) for service discovery within clusters. When applications running in pods need to communicate with each other, they often refer to services by their domain names rather than IP addresses.\n\nThis is where Kubernetes DNS comes into play. It ensures that these domain names are resolved to the correct IP addresses, allowing pods and services to communicate.\n\nIn Kubernetes, each pod is assigned a temporary IP address. However, these IP addresses are dynamic and can change over time, making it challenging for applications to keep track of them. Kubernetes addresses this challenge by assigning fully qualified domain names ([FQDNs](https://kubernetes.io/docs/concepts/services-networking/dns-pod-service/#dns-records)) to pods and services.\n\nCoreDNS, the default DNS provider in Kubernetes, is responsible for handling DNS queries within the cluster. It maps these FQDNs to the corresponding IP addresses, enabling communication between pods and services.\n\n## üõ†Ô∏è CoreDNS in Kubernetes\n\nCoreDNS plays an important role in providing DNS services within Kubernetes clusters. As the default DNS provider since Kubernetes v1.13, CoreDNS simplifies cluster networking by enabling clients to access services using DNS names rather than IP addresses. It resolves domain name requests and facilitates service discovery within the cluster.\n\n### ‚öôÔ∏è How CoreDNS Operates\n\nCoreDNS operates as a resolver and forwarder for DNS requests within Kubernetes clusters. When a pod needs to communicate with another service, it sends a DNS query to CoreDNS, specifying the domain name of the target service. CoreDNS then resolves this query by mapping the domain name to the corresponding IP address using its internal records.\n\nFor external domain names that CoreDNS is not authoritative for, it forwards the DNS query to public resolvers or upstream DNS servers for resolution.\n\nTo enhance performance and reduce latency, CoreDNS can cache DNS responses for frequently accessed domain names. This caching mechanism improves the responsiveness of DNS queries and reduces the load on upstream DNS servers.\n\nCoreDNS achieves this functionality through its modular architecture and extensible plugin system, allowing operators to customize and optimize DNS resolution according to their specific requirements.\n\n## üöÄ Mitigating CoreDNS Throttling in Amazon EKS\n\nIn Amazon EKS clusters, CoreDNS and DNS throttling issues can be challenging to identify and troubleshoot. While many users focus on monitoring CoreDNS logs and metrics, they often overlook the hard limit of 1024 [packets per second (PPS)](https://docs.aws.amazon.com/vpc/latest/userguide/vpc-dns.html#vpc-dns-limits) enforced at the Elastic Network Interface (ENI) level. Understanding how this limit can lead to throttling issues requires insight into the typical DNS resolution flow of a Kubernetes pod.\n\nIn a Kubernetes environment, pods must resolve domain names for both internal and external services to enable communication. This resolution process involves routing DNS queries through the worker node's ENI, particularly when resolving external endpoints. Even for internal endpoints, if the CoreDNS pod is not co-located with the querying pod, DNS packets still traverse the worker node's ENI.\n\nConsider a scenario where there is a sudden surge in DNS queries, causing the PPS to approach the hard limit of 1024. This situation can result in DNS throttling, impacting all microservices running on the affected worker node. Unfortunately, troubleshooting such issues can be hard because the focus tends to be on CoreDNS pods rather than ENI metrics.\n\nTo mitigate DNS throttling issues in EKS clusters, it is important to monitor packet drops occurring at the ENI level continuously. This monitoring allows for early detection and prevention of potential outages. In this blog post, we introduce a solution that leverages network performance metrics to identify DNS throttling issues effectively.\n\n### üõ°Ô∏è Solution\n\nAn easy way to identify the DNS throttling issues in worker nodes is by capturing the `linklocal_allowance_exceeded` metric provided by the Elastic Network Adapter (ENA) driver and other metrics as well.\n\nThe [`linklocal_allowance_exceeded`](https://docs.aws.amazon.com/AmazonCloudWatch/latest/monitoring/metrics-collected-by-CloudWatch-agent.html#linux-metrics-enabled-by-CloudWatch-agent) metric indicates the number of packets dropped because the PPS of the traffic to local proxy services exceeded the maximum for the network interface. This impacts traffic to the DNS service, the Instance Metadata Service, and the Amazon Time Sync Service.\n\nInstead of tracking this event in real-time, we can stream this metric to [Amazon Managed Service for Prometheus](https://aws.amazon.com/prometheus/) and visualize it in [Amazon Managed Grafana](https://aws.amazon.com/grafana/).\n\n\n![adot](adot.jpg)\n\n\n## üõ†Ô∏è Hands-on: Collect and Visualize CoreDNS Metrics in AWS EKS\n\n### üìä CoreDNS Prometheus Plugin\n\nThe [CoreDNS Prometheus plugin](https://coredns.io/plugins/metrics/) exposes metrics in the [OpenMetrics](https://github.com/OpenObservability/OpenMetrics/blob/main/specification/OpenMetrics.md) format, a text-based standard that evolved from the [Prometheus format](https://prometheus.io/docs/instrumenting/exposition_formats/#text-based-format). In a Kubernetes cluster, the plugin is enabled by default, so you can begin monitoring [many key metrics](https://www.datadoghq.com/blog/coredns-metrics) as soon as you launch your cluster.\n\nBy default, the Prometheus plugin writes metrics to a `/metrics` endpoint on port `9153` on each CoreDNS pod.\n\n### üèóÔ∏è Create an Amazon Managed Service for Prometheus Workspace and Managed Service for Grafana\n\nIn this step, we will create a workspace for Amazon Managed Service for Prometheus and Managed Service for Grafana. The configuration in these files creates:\n\n- AMP workspace\n- AMP alert manager definition\n\n#### `main.tf`\n\n```hcl\nmodule \"prometheus\" {\n    source = \"terraform-aws-modules/managed-service-prometheus/aws\"\n\n    workspace_alias = \"demo-coredns\"\n\n    alert_manager_definition = <<-EOT\n    alertmanager_config: |\n        route:\n            receiver: 'default'\n        receivers:\n            - name: 'default'\n    EOT\n\n    rule_group_namespaces = {}\n}\n```\n\n#### `versions.tf`\n\n```hcl\nterraform {\n    required_version = \">= 1.3\"\n\n    required_providers {\n        aws = {\n            source  = \"hashicorp/aws\"\n            version = \">= 5.32\"\n        }\n    }\n}\n```\n\nTo run the Terraform code, execute:\n\n```sh\n# terraform init\n# terraform plan\n# terraform apply\n```\n\n### üñ•Ô∏è Create a Default Grafana Workspace\n\nThe below configuration files will create a default Grafana workspace using defaults provided by the module.\n\n#### `main.tf`\n\n```hcl\nprovider \"aws\" {\n    region = local.region\n}\n\ndata \"aws_availability_zones\" \"available\" {}\n\nlocals {\n    region      = \"eu-west-1\"\n    name        = \"amg-ex-${replace(basename(path.cwd), \"_\", \"-\")}\"\n    description = \"AWS Managed Grafana service for ${local.name}\"\n\n    vpc_cidr = \"10.0.0.0/16\"\n    azs      = slice(data.aws_availability_zones.available.names, 0, 3)\n}\n\nmodule \"managed_grafana\" {\n    source = \"terraform-aws-modules/managed-service-grafana/aws\"\n\n    name                      = local.name\n    associate_license         = false\n    description               = local.description\n    account_access_type       = \"CURRENT_ACCOUNT\"\n    authentication_providers  = [\"AWS_SSO\"]\n    permission_type           = \"SERVICE_MANAGED\"\n    data_sources              = [\"CLOUDWATCH\", \"PROMETHEUS\", \"XRAY\"]\n    notification_destinations = [\"SNS\"]\n    stack_set_name            = local.name\n    grafana_version           = \"9.4\"\n\n    configuration = jsonencode({\n        unifiedAlerting = {\n            enabled = true\n        },\n        plugins = {\n            pluginAdminEnabled = false\n        }\n    })\n\n    vpc_configuration = {\n        subnet_ids = module.vpc.private_subnets\n    }\n    security_group_rules = {\n        egress_postgresql = {\n            description = \"Allow egress to PostgreSQL\"\n            from_port   = 5432\n            to_port     = 5432\n            protocol    = \"tcp\"\n            cidr_blocks = module.vpc.private_subnets_cidr_blocks\n        }\n    }\n\n    workspace_api_keys = {\n        viewer = {\n            key_name        = \"viewer\"\n            key_role        = \"VIEWER\"\n            seconds_to_live = 3600\n        }\n        editor = {\n            key_name        = \"editor\"\n            key_role        = \"EDITOR\"\n            seconds_to_live = 3600\n        }\n        admin = {\n            key_name        = \"admin\"\n            key_role        = \"ADMIN\"\n            seconds_to_live = 3600\n        }\n    }\n\n    create_iam_role                = true\n    iam_role_name                  = local.name\n    use_iam_role_name_prefix       = true\n    iam_role_description           = local.description\n    iam_role_path                  = \"/grafana/\"\n    iam_role_force_detach_policies = true\n    iam_role_max_session_duration  = 7200\n    iam_role_tags                  = { role = true }\n\n    tags = local.tags\n}\n\nmodule \"managed_grafana_default\" {\n    source = \"terraform-aws-modules/managed-service-grafana/aws\"\n\n    name              = \"${local.name}-default\"\n    associate_license = false\n\n    tags = local.tags\n}\n\nmodule \"managed_grafana_disabled\" {\n    source = \"terraform-aws-modules/managed-service-grafana/aws\"\n\n    name   = local.name\n    create = false\n}\n\nmodule \"vpc\" {\n    source  = \"terraform-aws-modules/vpc/aws\"\n    version = \"~> 5.0\"\n\n    name = local.name\n    cidr = local.vpc_cidr\n\n    azs             = local.azs\n    private_subnets = [for k, v in local.azs : cidrsubnet(local.vpc_cidr, 4, k)]\n    public_subnets  = [for k, v in local.azs : cidrsubnet(local.vpc_cidr, 8, k + 48)]\n\n    enable_nat_gateway = false \n    single_nat_gateway = true\n\n    tags = local.tags\n}\n```\n\n#### versions.tf\n\n```hcl\nterraform {\n    required_version = \">= 1.0\"\n\n    required_providers {\n        aws = {\n            source  = \"hashicorp/aws\"\n            version = \">= 5.0\"\n        }\n    }\n}\n```\n\nTo run this code, execute:\n\n```shell\n# terraform init\n# terraform plan\n# terraform apply\n```\n\n### üöÄ Deploying Prometheus Ethtool Exporter\n\n[Ethtool](https://linux.die.net/man/8/ethtool) is a Linux tool for configuring and gathering information about Ethernet devices on worker nodes. We will use ethtool's output to detect packet loss and convert it to Prometheus format with a Prometheus ethtool exporter utility.\n\nDeploy the exporter using:\n\n```sh\nkubectl apply -f https://raw.githubusercontent.com/Showmax/prometheus-ethtool-exporter/master/deploy/k8s-daemonset.yaml\n```\n\n### üì¶ Deploy ADOT Collector to Scrape Ethtool Metrics\n\nIn this step, we will deploy the ADOT collector and configure it to ingest metrics to Amazon Managed Service for Prometheus. We will use the [Amazon EKS add-on for ADOT operator](https://docs.aws.amazon.com/eks/latest/userguide/opentelemetry.html) to send the metrics [linklocal_allowance_exceeded](https://docs.aws.amazon.com/AmazonCloudWatch/latest/monitoring/metrics-collected-by-CloudWatch-agent.html#linux-metrics-enabled-by-CloudWatch-agent) to Amazon Managed Service for Prometheus for monitoring CoreDNS.\n\n#### Create an IAM Role and Amazon EKS Service Account\n\nWe will deploy the ADOT collector to run under the identity of a Kubernetes [service account](https://kubernetes.io/docs/tasks/configure-pod-container/configure-service-account/) `adot-collector`. [IAM roles for service accounts (IRSA)](https://docs.aws.amazon.com/eks/latest/userguide/iam-roles-for-service-accounts.html) let you associate the `AmazonPrometheusRemoteWriteAccess` role with a Kubernetes service account, thereby providing IAM permissions to any pod utilizing the service account to ingest the metrics to Amazon Managed Service for Prometheus.\n\nYou need `kubectl` and `eksctl` CLI tools to run the script. They must be configured to access your Amazon EKS cluster.\n\n```sh\neksctl create iamserviceaccount \\\n--name adot-collector \\\n--namespace default \\\n--region eu-west-1 \\\n--cluster coredns-monitoring-demo \\\n--attach-policy-arn arn:aws:iam::aws:policy/AmazonPrometheusRemoteWriteAccess \\\n--approve \\\n--override-existing-serviceaccounts\n```\n\n#### Install ADOT Add-on\n\nYou can check the list of add-ons enabled for different versions of Amazon EKS using the following command:\n\n```sh\naws eks describe-addon-versions --addon-name adot --kubernetes-version 1.28 \\\n    --query \"addons[].addonVersions[].[addonVersion, compatibilities[].defaultVersion]\" --output text\n```\n\nRun the following command to install the ADOT add-on, replacing the `--addon-version` flag based on your Amazon EKS cluster version as shown in the step above.\n\n```sh\naws eks create-addon --addon-name adot --addon-version v0.66.0-eksbuild.1 --cluster-name coredns-monitoring-demo\n```\n\nVerify that the ADOT add-on is ready using the following command:\n\n```sh\nkubectl get po -n opentelemetry-operator-system\n```\n\nThe following procedure uses an example YAML file with `deployment` as the mode value. This is the default mode and deploys the ADOT Collector similarly to a standalone application. This configuration receives OTLP metrics from the sample application and Amazon Managed Service for Prometheus metrics scraped from pods on the cluster.\n\n```sh\ncurl -o collector-config-amp.yaml https://raw.githubusercontent.com/aws-observability/aws-otel-community/master/sample-configs/operator/collector-config-amp.yaml\n```\n\nIn `collector-config-amp.yaml`, replace the following with your own values:\n\n- `mode: deployment`\n- `serviceAccount: adot-collector`\n- `endpoint: \"\"`\n- `region: \"\"`\n- `name: adot-collector`\n\nApply the configuration:\n\n```sh\nkubectl apply -f collector-config-amp.yaml\n```\n\nOnce the ADOT collector is deployed, the metrics will be stored successfully in Amazon Prometheus.\n\n### üìà Visualize Ethtool Metrics in Amazon Managed Grafana\n\nConfigure the Amazon Managed Service for Prometheus workspace as a datasource inside the Amazon Managed Grafana console.\n\nLet's explore the metrics in Amazon Managed Grafana now: Click the explore button, and search for `ethtool`.\n\n![apm](./apm.png)\n\nLet's build a dashboard for the linklocal_allowance_exceeded metric by using the query\n\n```shell\nrate(node_net_ethtool{device=\"eth0\",type=\"linklocal_allo\nwance_exceeded\"} [30s])\n```\n\n![result](./result.png)\n\nWe can see that there were no packets dropped as the value is zero. You can further extend this by configuring alerts in the alert manager in Amazon Managed Service for Prometheus to send notifications.\n\n## Conclusion\n\nIn this post, we showed how to monitor and create alerts for CoreDNS throttling issues using AWS Distro for OpenTelemetry (ADOT), Amazon Managed Service for Prometheus, and Amazon Managed Grafana. By monitoring the coreDNS metrics, customers can proactively detect packet drops and take preventive actions.\n\n**References:**\n\n- https://www.datadoghq.com/blog/coredns-monitoring-tools/\n- https://cilium.io/blog/2019/12/18/how-to-debug-dns-issues-in-k8s/\n- https://sysdig.com/blog/how-to-monitor-coredns/\n- https://www.datadoghq.com/blog/coredns-metrics/\n- https://aws.amazon.com/blogs/mt/monitoring-coredns-for-dns-throttling-issues-using-aws-open-source-monitoring-services/\n\n<br>\n\n**_Until next time, „Å§„Å•„Åè üéâ_**\n\n> üí° Thank you for Reading !! üôåüèªüòÅüìÉ, see you in the next blog.ü§ò  **_Until next time üéâ_**\n\nüöÄ Thank you for sticking up till the end. If you have any questions/feedback regarding this blog feel free to connect with me:\n\n**‚ôªÔ∏è LinkedIn:** https://www.linkedin.com/in/rajhi-saif/\n\n**‚ôªÔ∏è X/Twitter:** https://x.com/rajhisaifeddine\n\n**The end ‚úåüèª**\n\n<h1 align=\"center\">üî∞ Keep Learning !! Keep Sharing !! üî∞</h1>\n\n**üìÖ Stay updated**\n\nSubscribe to our newsletter for more insights on AWS cloud computing and containers.\n","wordcount":1431}</script><script data-react-helmet="true" type="application/ld+json">{"@context":"http://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Home","item":"https://seifrajhi.github.io/"},{"@type":"ListItem","position":2,"name":"Blog","item":"https://seifrajhi.github.io/blog/"},{"@type":"ListItem","position":3,"name":"Everything You Need to Know About Monitoring CoreDNS for DNS Performance","item":"https://seifrajhi.github.io/blog/monitoring-coredns-dns-performance/"}]}</script><link crossorigin="" href="https://utteranc.es" rel="preconnect"/><link crossorigin="" href="https://www.google-analytics.com" rel="preconnect"/><style>.gatsby-image-wrapper{position:relative;overflow:hidden}.gatsby-image-wrapper picture.object-fit-polyfill{position:static!important}.gatsby-image-wrapper img{bottom:0;height:100%;left:0;margin:0;max-width:none;padding:0;position:absolute;right:0;top:0;width:100%;object-fit:cover}.gatsby-image-wrapper [data-main-image]{opacity:0;transform:translateZ(0);transition:opacity .25s linear;will-change:opacity}.gatsby-image-wrapper-constrained{display:inline-block;vertical-align:top}</style><noscript><style>.gatsby-image-wrapper noscript [data-main-image]{opacity:1!important}.gatsby-image-wrapper [data-placeholder-image]{opacity:0!important}</style></noscript><script type="module">const e="undefined"!=typeof HTMLImageElement&&"loading"in HTMLImageElement.prototype;e&&document.body.addEventListener("load",(function(e){const t=e.target;if(void 0===t.dataset.mainImage)return;if(void 0===t.dataset.gatsbyImageSsr)return;let a=null,n=t;for(;null===a&&n;)void 0!==n.parentNode.dataset.gatsbyImageWrapper&&(a=n.parentNode),n=n.parentNode;const o=a.querySelector("[data-placeholder-image]"),r=new Image;r.src=t.currentSrc,r.decode().catch((()=>{})).then((()=>{t.style.opacity=1,o&&(o.style.opacity=0,o.style.transition="opacity 500ms linear")}))}),!0);</script><link rel="icon" href="/favicon-32x32.png?v=47ae28bb567c9025f1fee24afb2d20c9" type="image/png"/><link rel="manifest" href="/manifest.webmanifest" crossorigin="anonymous"/><link rel="apple-touch-icon" sizes="48x48" href="/icons/icon-48x48.png?v=47ae28bb567c9025f1fee24afb2d20c9"/><link rel="apple-touch-icon" sizes="72x72" href="/icons/icon-72x72.png?v=47ae28bb567c9025f1fee24afb2d20c9"/><link rel="apple-touch-icon" sizes="96x96" href="/icons/icon-96x96.png?v=47ae28bb567c9025f1fee24afb2d20c9"/><link rel="apple-touch-icon" sizes="144x144" href="/icons/icon-144x144.png?v=47ae28bb567c9025f1fee24afb2d20c9"/><link rel="apple-touch-icon" sizes="192x192" href="/icons/icon-192x192.png?v=47ae28bb567c9025f1fee24afb2d20c9"/><link rel="apple-touch-icon" sizes="256x256" href="/icons/icon-256x256.png?v=47ae28bb567c9025f1fee24afb2d20c9"/><link rel="apple-touch-icon" sizes="384x384" href="/icons/icon-384x384.png?v=47ae28bb567c9025f1fee24afb2d20c9"/><link rel="apple-touch-icon" sizes="512x512" href="/icons/icon-512x512.png?v=47ae28bb567c9025f1fee24afb2d20c9"/><link rel="preload" as="font" type="font/woff2" crossorigin="anonymous" href="/static/webfonts/s/dancingscript/v25/If2cXTr6YS-zF4S-kcSWSVi_sxjsohD9F50Ruu7BMSo3Sup8.woff2"/><link rel="preload" as="font" type="font/woff2" crossorigin="anonymous" href="/static/webfonts/s/dancingscript/v25/If2cXTr6YS-zF4S-kcSWSVi_sxjsohD9F50Ruu7B1i03Sup8.woff2"/><link rel="preload" as="font" type="font/woff2" crossorigin="anonymous" href="/static/webfonts/s/ledger/v16/j8_q6-HK1L3if_sBnMrx.woff2"/><style>@font-face{font-display:swap;font-family:Dancing Script;font-style:normal;font-weight:400;src:url(/static/webfonts/s/dancingscript/v25/If2cXTr6YS-zF4S-kcSWSVi_sxjsohD9F50Ruu7BMSo3Sup8.woff2) format("woff2")}@font-face{font-display:swap;font-family:Dancing Script;font-style:normal;font-weight:700;src:url(/static/webfonts/s/dancingscript/v25/If2cXTr6YS-zF4S-kcSWSVi_sxjsohD9F50Ruu7B1i03Sup8.woff2) format("woff2")}@font-face{font-display:swap;font-family:Dancing Script;font-style:normal;font-weight:400;src:url(/static/webfonts/s/dancingscript/v25/If2cXTr6YS-zF4S-kcSWSVi_sxjsohD9F50Ruu7BMSo3Sup6.woff) format("woff")}@font-face{font-display:swap;font-family:Dancing Script;font-style:normal;font-weight:700;src:url(/static/webfonts/s/dancingscript/v25/If2cXTr6YS-zF4S-kcSWSVi_sxjsohD9F50Ruu7B1i03Sup6.woff) format("woff")}@font-face{font-display:swap;font-family:Ledger;font-style:normal;font-weight:400;src:url(/static/webfonts/s/ledger/v16/j8_q6-HK1L3if_sBnMrx.woff2) format("woff2")}@font-face{font-display:swap;font-family:Ledger;font-style:normal;font-weight:400;src:url(/static/webfonts/s/ledger/v16/j8_q6-HK1L3if_sBnMr3.woff) format("woff")}</style><link rel="preconnect" href="https://www.google-analytics.com"/><link rel="dns-prefetch" href="https://www.google-analytics.com"/><script>
  
  function gaOptout(){document.cookie=disableStr+'=true; expires=Thu, 31 Dec 2099 23:59:59 UTC;path=/',window[disableStr]=!0}var gaProperty='G-LLPCCGNLH7',disableStr='ga-disable-'+gaProperty;document.cookie.indexOf(disableStr+'=true')>-1&&(window[disableStr]=!0);
  if(true) {
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  }
  if (typeof ga === "function") {
    ga('create', 'G-LLPCCGNLH7', 'auto', {"alwaysSendReferrer":true});
      ga('set', 'anonymizeIp', true);
      
      
      
      
      }</script><link rel="preconnect" href="https://www.googletagmanager.com"/><link rel="dns-prefetch" href="https://www.googletagmanager.com"/><script async="" src="https://www.googletagmanager.com/gtag/js?id=G-LLPCCGNLH7"></script><script>
      
      function gaOptout(){document.cookie=disableStr+'=true; expires=Thu, 31 Dec 2099 23:59:59 UTC;path=/',window[disableStr]=!0}var gaProperty='G-LLPCCGNLH7',disableStr='ga-disable-'+gaProperty;document.cookie.indexOf(disableStr+'=true')>-1&&(window[disableStr]=!0);
      if(true) {
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-LLPCCGNLH7', {"anonymize_ip":true,"send_page_view":false});gtag('config', 'GTM-5V895PDS', {"anonymize_ip":true,"send_page_view":false});
      }
      </script><link rel="stylesheet"/><script>
    document.addEventListener("DOMContentLoaded", function(event) {
      var hash = window.decodeURI(location.hash.replace('#', ''))
      if (hash !== '') {
        var element = document.getElementById(hash)
        if (element) {
          var scrollTop = window.pageYOffset || document.documentElement.scrollTop || document.body.scrollTop
          var clientTop = document.documentElement.clientTop || document.body.clientTop || 0
          var offset = element.getBoundingClientRect().top + scrollTop - clientTop
          // Wait for the browser to finish rendering before scrolling.
          setTimeout((function() {
            window.scrollTo(0, offset - 0)
          }), 0)
        }
      }
    })
  </script><link rel="canonical" href="https://seifrajhi.github.io/blog/monitoring-coredns-dns-performance/" data-baseprotocol="https:" data-basehost="seifrajhi.github.io"/><link rel="sitemap" type="application/xml" href="/sitemap-index.xml"/></head><body><script>
void function() {
  window.__onThemeChange = function() {}

  var preferredTheme
  try {
    preferredTheme = localStorage.getItem('theme')
  } catch (err) { }

  function setTheme(newTheme) {
    if (preferredTheme && document.body.classList.contains(preferredTheme)) {
      document.body.classList.replace(preferredTheme, newTheme)
    } else {
      document.body.classList.add(newTheme)
    }

    window.__theme = newTheme
    preferredTheme = newTheme
    window.__onThemeChange(newTheme)
  }

  window.__setPreferredTheme = function(newTheme) {
    setTheme(newTheme)
    try {
      localStorage.setItem('theme', newTheme)
    } catch (err) {}
  }

  var darkQuery = window.matchMedia('(prefers-color-scheme: dark)')
  darkQuery.addListener(function(e) {
    window.__setPreferredTheme(e.matches ? 'dark' : 'light')
  })

  setTheme(preferredTheme || (darkQuery.matches ? 'dark' : 'light'))
}()
    </script><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><div><div class="blogpost-header"><div class="view-page-header"><div class="view-page-header-wrapper"><div class="logo-wrapper"><div class="logo"><div data-gatsby-image-wrapper="" class="gatsby-image-wrapper gatsby-image-wrapper-constrained logo-img"><div style="max-width:150px;display:block"><img alt="" role="presentation" aria-hidden="true" src="data:image/svg+xml;charset=utf-8,%3Csvg%20height=&#x27;174&#x27;%20width=&#x27;150&#x27;%20xmlns=&#x27;http://www.w3.org/2000/svg&#x27;%20version=&#x27;1.1&#x27;%3E%3C/svg%3E" style="max-width:100%;display:block;position:static"/></div><div aria-hidden="true" data-placeholder-image="" style="opacity:1;transition:opacity 500ms linear;background-color:#080808;position:absolute;top:0;left:0;bottom:0;right:0"></div><picture><source type="image/avif" data-srcset="/static/a1a51351bdf7de55eaaa515eb15ce2da/2e0ee/saifeddine-rajhi.avif 38w,/static/a1a51351bdf7de55eaaa515eb15ce2da/81dba/saifeddine-rajhi.avif 75w,/static/a1a51351bdf7de55eaaa515eb15ce2da/20c67/saifeddine-rajhi.avif 150w,/static/a1a51351bdf7de55eaaa515eb15ce2da/94b9f/saifeddine-rajhi.avif 300w" sizes="(min-width: 150px) 150px, 100vw"/><source type="image/webp" data-srcset="/static/a1a51351bdf7de55eaaa515eb15ce2da/92aab/saifeddine-rajhi.webp 38w,/static/a1a51351bdf7de55eaaa515eb15ce2da/359cc/saifeddine-rajhi.webp 75w,/static/a1a51351bdf7de55eaaa515eb15ce2da/aac41/saifeddine-rajhi.webp 150w,/static/a1a51351bdf7de55eaaa515eb15ce2da/a15c6/saifeddine-rajhi.webp 300w" sizes="(min-width: 150px) 150px, 100vw"/><img data-gatsby-image-ssr="" data-main-image="" style="opacity:0" sizes="(min-width: 150px) 150px, 100vw" decoding="async" loading="lazy" data-src="/static/a1a51351bdf7de55eaaa515eb15ce2da/885b3/saifeddine-rajhi.png" data-srcset="/static/a1a51351bdf7de55eaaa515eb15ce2da/9c61d/saifeddine-rajhi.png 38w,/static/a1a51351bdf7de55eaaa515eb15ce2da/d405f/saifeddine-rajhi.png 75w,/static/a1a51351bdf7de55eaaa515eb15ce2da/885b3/saifeddine-rajhi.png 150w,/static/a1a51351bdf7de55eaaa515eb15ce2da/4aeea/saifeddine-rajhi.png 300w" alt="Saifeddine Rajhi"/></picture><noscript><picture><source type="image/avif" srcSet="/static/a1a51351bdf7de55eaaa515eb15ce2da/2e0ee/saifeddine-rajhi.avif 38w,/static/a1a51351bdf7de55eaaa515eb15ce2da/81dba/saifeddine-rajhi.avif 75w,/static/a1a51351bdf7de55eaaa515eb15ce2da/20c67/saifeddine-rajhi.avif 150w,/static/a1a51351bdf7de55eaaa515eb15ce2da/94b9f/saifeddine-rajhi.avif 300w" sizes="(min-width: 150px) 150px, 100vw"/><source type="image/webp" srcSet="/static/a1a51351bdf7de55eaaa515eb15ce2da/92aab/saifeddine-rajhi.webp 38w,/static/a1a51351bdf7de55eaaa515eb15ce2da/359cc/saifeddine-rajhi.webp 75w,/static/a1a51351bdf7de55eaaa515eb15ce2da/aac41/saifeddine-rajhi.webp 150w,/static/a1a51351bdf7de55eaaa515eb15ce2da/a15c6/saifeddine-rajhi.webp 300w" sizes="(min-width: 150px) 150px, 100vw"/><img data-gatsby-image-ssr="" data-main-image="" style="opacity:0" sizes="(min-width: 150px) 150px, 100vw" decoding="async" loading="lazy" src="/static/a1a51351bdf7de55eaaa515eb15ce2da/885b3/saifeddine-rajhi.png" srcSet="/static/a1a51351bdf7de55eaaa515eb15ce2da/9c61d/saifeddine-rajhi.png 38w,/static/a1a51351bdf7de55eaaa515eb15ce2da/d405f/saifeddine-rajhi.png 75w,/static/a1a51351bdf7de55eaaa515eb15ce2da/885b3/saifeddine-rajhi.png 150w,/static/a1a51351bdf7de55eaaa515eb15ce2da/4aeea/saifeddine-rajhi.png 300w" alt="Saifeddine Rajhi"/></picture></noscript><script type="module">const t="undefined"!=typeof HTMLImageElement&&"loading"in HTMLImageElement.prototype;if(t){const t=document.querySelectorAll("img[data-main-image]");for(let e of t){e.dataset.src&&(e.setAttribute("src",e.dataset.src),e.removeAttribute("data-src")),e.dataset.srcset&&(e.setAttribute("srcset",e.dataset.srcset),e.removeAttribute("data-srcset"));const t=e.parentNode.querySelectorAll("source[data-srcset]");for(let e of t)e.setAttribute("srcset",e.dataset.srcset),e.removeAttribute("data-srcset");e.complete&&(e.style.opacity=1,e.parentNode.parentNode.querySelector("[data-placeholder-image]").style.opacity=0)}}</script></div></div><div class="name"><a href="/blog/" title="back to blog">Saifeddine <br/> Rajhi</a></div></div><h2 class="blog-title"><a href="/blog/" title="back to the homepage">Blog</a></h2></div></div><nav class="main-navigation"><ul><li><a rel="home" title="Go Home" href="/">Home</a></li><li><a title="Go to my Technical Blog" href="/blog/">Blog</a></li><li><a title="Go to my Thoughts" href="/thoughts/">Thoughts</a></li><li><a title="My public talks" href="/talks/">talks</a></li><li><a title="Review My Resume" href="/cv/platform-engineer/">cv</a></li></ul></nav></div><main><article class="blog-wrapper"><header><figure class="cover"><div class="cover-filter"><div data-gatsby-image-wrapper="" class="gatsby-image-wrapper cover cover-image"><div aria-hidden="true" style="padding-top:54.37499999999999%"></div><img aria-hidden="true" data-placeholder-image="" style="opacity:1;transition:opacity 500ms linear;object-fit:fill;object-position:center" decoding="async" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAADDElEQVR42h2S60+aBxTG+cv2oTNbl7abXUzpXC3etS1e26ogioBQQC5KZfWGYJSh9VKlRlBkWulMF7fZqivN1mTZvPC+XBSsqY2b+e3tPjzJyfnwO8/z5Mj20+c8f3WA0TVJi3UGdVeIemOQarWHZvsqSn2ISu081R0hFPeGabRGqXkQpVofQV4f4KtqL+XmOLfcR5TYRGRv9s7xLfxFY2eABn2Ajt4YLbYwtaoeWh2L1JmilGnmUKjnuFzqolgTotH+QjqwRIHSy5WKfqq6fudO7xHFH4HTS3Hk5VqaDEMYesPUtfuoumtB7/SjNo9QpLRS2TbNrY5Z5DUeLt50kF/RTYlqhoI7Xq7fD/JpoY284iFKHWlkT9ZEnKObuMZ3iG4kCMfeouv/lcHZOM2OCPWmefq+j9H68EcUrSGKNFFq7Vs0u99Q63zNbVucks6X3DD8JkVOSQ6fnzCz/o+kM9Zff2B1+4zI9jmhjSwNbQ8prrVRpwtQpfbySb6Ka41P6Jz8F2Mgi24sS9PQEXWPclS5sty0JpGNrx7TM5lgYjnNytYpj+azxHZOefrzKVPRJP6VUyzTJ4yuvKPFk6GhL0WBXuCiKsHXehGlO81tV4oyR5Iii9Th/cG33HVto2x5xsRigtWtD6ztnOEe2OFqXhcVhcP4nopMxE4wPz7kijbBDUsCy4RIpVMgT7UvuUtTak/xrVkClplfMjAr0NT1CtfYH/iW3+NdPKS5fAzFhS4ufTlI30KO4XCONl+GS+0HjCwJRDczTD0T+KJ9l0LzR2CSb0wSsKFbKlO7Qan2FwbnkyxsvCe4fozJt4vJvsnoUoaR6DEaCVbZneJC8z6uOYGf4imGQwk+b91Dbkr+/zLyTgHZ47UTWgf+xOIXsE1lGY1kmVzeoz+4iyd8wPgPAlrP39R/J3JvIE2+QeQzCVLm3Ody2740i5Q7pbgPBAoMCWTBF+/wRU6wT+WkXg7xLOYw+kV0Iwk0HkHaZTD409S4k5IyqDyHEixJvk7kmlGC9SRRWEWuGwWu6hL8B/hEfHqMLUR0AAAAAElFTkSuQmCC" alt=""/><picture><source type="image/webp" data-srcset="/static/bf9e127d7b6dc07f97525a890e662947/ea0da/coredns-cover.webp 750w,/static/bf9e127d7b6dc07f97525a890e662947/d1e72/coredns-cover.webp 1080w,/static/bf9e127d7b6dc07f97525a890e662947/c101e/coredns-cover.webp 1366w,/static/bf9e127d7b6dc07f97525a890e662947/5eda1/coredns-cover.webp 1440w" sizes="100vw"/><img data-gatsby-image-ssr="" data-main-image="" style="object-fit:fill;object-position:center;opacity:0" sizes="100vw" decoding="async" loading="lazy" data-src="/static/bf9e127d7b6dc07f97525a890e662947/e7e88/coredns-cover.png" data-srcset="/static/bf9e127d7b6dc07f97525a890e662947/1d7e8/coredns-cover.png 750w,/static/bf9e127d7b6dc07f97525a890e662947/f874f/coredns-cover.png 1080w,/static/bf9e127d7b6dc07f97525a890e662947/365c0/coredns-cover.png 1366w,/static/bf9e127d7b6dc07f97525a890e662947/e7e88/coredns-cover.png 1440w" alt="Everything You Need to Know About Monitoring CoreDNS for DNS Performance"/></picture><noscript><picture><source type="image/webp" srcSet="/static/bf9e127d7b6dc07f97525a890e662947/ea0da/coredns-cover.webp 750w,/static/bf9e127d7b6dc07f97525a890e662947/d1e72/coredns-cover.webp 1080w,/static/bf9e127d7b6dc07f97525a890e662947/c101e/coredns-cover.webp 1366w,/static/bf9e127d7b6dc07f97525a890e662947/5eda1/coredns-cover.webp 1440w" sizes="100vw"/><img data-gatsby-image-ssr="" data-main-image="" style="object-fit:fill;object-position:center;opacity:0" sizes="100vw" decoding="async" loading="lazy" src="/static/bf9e127d7b6dc07f97525a890e662947/e7e88/coredns-cover.png" srcSet="/static/bf9e127d7b6dc07f97525a890e662947/1d7e8/coredns-cover.png 750w,/static/bf9e127d7b6dc07f97525a890e662947/f874f/coredns-cover.png 1080w,/static/bf9e127d7b6dc07f97525a890e662947/365c0/coredns-cover.png 1366w,/static/bf9e127d7b6dc07f97525a890e662947/e7e88/coredns-cover.png 1440w" alt="Everything You Need to Know About Monitoring CoreDNS for DNS Performance"/></picture></noscript><script type="module">const t="undefined"!=typeof HTMLImageElement&&"loading"in HTMLImageElement.prototype;if(t){const t=document.querySelectorAll("img[data-main-image]");for(let e of t){e.dataset.src&&(e.setAttribute("src",e.dataset.src),e.removeAttribute("data-src")),e.dataset.srcset&&(e.setAttribute("srcset",e.dataset.srcset),e.removeAttribute("data-srcset"));const t=e.parentNode.querySelectorAll("source[data-srcset]");for(let e of t)e.setAttribute("srcset",e.dataset.srcset),e.removeAttribute("data-srcset");e.complete&&(e.style.opacity=1,e.parentNode.parentNode.querySelector("[data-placeholder-image]").style.opacity=0)}}</script></div></div><figcaption data-nosnippet="" class="image-title">Photo by Saifeddine Rajhi</figcaption></figure><h1>Everything You Need to Know About Monitoring CoreDNS for DNS Performance</h1><div data-nosnippet="" class="blog-details"><time class="blog-createdat" dateTime="2024-10-21">Oct 21, 2024</time><span> ‚Ä¢ </span><span class="blog-time2read">8<!-- -->mins<!-- --> read</span><div class="theme-switcher"><div class="theme-switcher-toggler"><div class="theme-switcher-track"></div><div class="theme-switcher-thumb"></div><input class="theme-switcher-input" type="checkbox" readonly="" aria-label="Switch between Dark and Light modes"/></div></div></div><ul data-nosnippet="" class="blog-tags"><li>CoreDNS</li><li>Amazon EKS</li><li>Kubernetes</li><li>Monitoring</li></ul></header><div class="blog-divider"></div><div id="intro"></div><div class="content-wrapper"><div data-nosnippet="" class="blog-content-nav-wrapper"><ul class="blog-content-nav"><h2>Content</h2><ul class="toc-list"></ul></ul></div><div class="content blog-content"><h2 id="-introduction" style="position:relative;"><a href="#-introduction" aria-label=" introduction permalink" class="anchor before"><svg class="anchor-icon" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>üìö Introduction</h2>
<p>Running DNS-intensive workloads can sometimes lead to intermittent <a href="https://kubernetes.io/docs/tasks/administer-cluster/dns-custom-nameservers/#coredns" target="_blank" rel="noopener noreferrer">CoreDNS</a> failures caused by DNS throttling. These issues can have a significant impact on your applications.</p>
<p>Such disruptions can hinder the reliability and performance of your services, making it mandatory to have a monitoring solution in place. AWS offers a suite of open-source tools‚Ää‚Äî‚Ää<a href="https://aws.amazon.com/cloudwatch/" target="_blank" rel="noopener noreferrer">CloudWatch</a>, <a href="https://www.fluentd.org/" target="_blank" rel="noopener noreferrer">Fluentd</a>, and <a href="https://grafana.com/" target="_blank" rel="noopener noreferrer">Grafana</a>‚Ää‚Äî‚Ääthat can be integrated to monitor CoreDNS.</p>
<h2 id="-introduction-to-kubernetes-dns" style="position:relative;"><a href="#-introduction-to-kubernetes-dns" aria-label=" introduction to kubernetes dns permalink" class="anchor before"><svg class="anchor-icon" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>üß© Introduction to Kubernetes DNS</h2>
<p>Kubernetes relies on <a href="https://kubernetes.io/docs/tasks/administer-cluster/dns-custom-nameservers/#introduction" target="_blank" rel="noopener noreferrer">DNS</a> for service discovery within clusters. When applications running in pods need to communicate with each other, they often refer to services by their domain names rather than IP addresses.</p>
<p>This is where Kubernetes DNS comes into play. It ensures that these domain names are resolved to the correct IP addresses, allowing pods and services to communicate.</p>
<p>In Kubernetes, each pod is assigned a temporary IP address. However, these IP addresses are dynamic and can change over time, making it challenging for applications to keep track of them. Kubernetes addresses this challenge by assigning fully qualified domain names (<a href="https://kubernetes.io/docs/concepts/services-networking/dns-pod-service/#dns-records" target="_blank" rel="noopener noreferrer">FQDNs</a>) to pods and services.</p>
<p>CoreDNS, the default DNS provider in Kubernetes, is responsible for handling DNS queries within the cluster. It maps these FQDNs to the corresponding IP addresses, enabling communication between pods and services.</p>
<h2 id="Ô∏è-coredns-in-kubernetes" style="position:relative;"><a href="#%EF%B8%8F-coredns-in-kubernetes" aria-label="Ô∏è coredns in kubernetes permalink" class="anchor before"><svg class="anchor-icon" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>üõ†Ô∏è CoreDNS in Kubernetes</h2>
<p>CoreDNS plays an important role in providing DNS services within Kubernetes clusters. As the default DNS provider since Kubernetes v1.13, CoreDNS simplifies cluster networking by enabling clients to access services using DNS names rather than IP addresses. It resolves domain name requests and facilitates service discovery within the cluster.</p>
<h3 id="Ô∏è-how-coredns-operates" style="position:relative;"><a href="#%EF%B8%8F-how-coredns-operates" aria-label="Ô∏è how coredns operates permalink" class="anchor before"><svg class="anchor-icon" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>‚öôÔ∏è How CoreDNS Operates</h3>
<p>CoreDNS operates as a resolver and forwarder for DNS requests within Kubernetes clusters. When a pod needs to communicate with another service, it sends a DNS query to CoreDNS, specifying the domain name of the target service. CoreDNS then resolves this query by mapping the domain name to the corresponding IP address using its internal records.</p>
<p>For external domain names that CoreDNS is not authoritative for, it forwards the DNS query to public resolvers or upstream DNS servers for resolution.</p>
<p>To enhance performance and reduce latency, CoreDNS can cache DNS responses for frequently accessed domain names. This caching mechanism improves the responsiveness of DNS queries and reduces the load on upstream DNS servers.</p>
<p>CoreDNS achieves this functionality through its modular architecture and extensible plugin system, allowing operators to customize and optimize DNS resolution according to their specific requirements.</p>
<h2 id="-mitigating-coredns-throttling-in-amazon-eks" style="position:relative;"><a href="#-mitigating-coredns-throttling-in-amazon-eks" aria-label=" mitigating coredns throttling in amazon eks permalink" class="anchor before"><svg class="anchor-icon" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>üöÄ Mitigating CoreDNS Throttling in Amazon EKS</h2>
<p>In Amazon EKS clusters, CoreDNS and DNS throttling issues can be challenging to identify and troubleshoot. While many users focus on monitoring CoreDNS logs and metrics, they often overlook the hard limit of 1024 <a href="https://docs.aws.amazon.com/vpc/latest/userguide/vpc-dns.html#vpc-dns-limits" target="_blank" rel="noopener noreferrer">packets per second (PPS)</a> enforced at the Elastic Network Interface (ENI) level. Understanding how this limit can lead to throttling issues requires insight into the typical DNS resolution flow of a Kubernetes pod.</p>
<p>In a Kubernetes environment, pods must resolve domain names for both internal and external services to enable communication. This resolution process involves routing DNS queries through the worker node's ENI, particularly when resolving external endpoints. Even for internal endpoints, if the CoreDNS pod is not co-located with the querying pod, DNS packets still traverse the worker node's ENI.</p>
<p>Consider a scenario where there is a sudden surge in DNS queries, causing the PPS to approach the hard limit of 1024. This situation can result in DNS throttling, impacting all microservices running on the affected worker node. Unfortunately, troubleshooting such issues can be hard because the focus tends to be on CoreDNS pods rather than ENI metrics.</p>
<p>To mitigate DNS throttling issues in EKS clusters, it is important to monitor packet drops occurring at the ENI level continuously. This monitoring allows for early detection and prevention of potential outages. In this blog post, we introduce a solution that leverages network performance metrics to identify DNS throttling issues effectively.</p>
<h3 id="Ô∏è-solution" style="position:relative;"><a href="#%EF%B8%8F-solution" aria-label="Ô∏è solution permalink" class="anchor before"><svg class="anchor-icon" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>üõ°Ô∏è Solution</h3>
<p>An easy way to identify the DNS throttling issues in worker nodes is by capturing the <code class="language-text">linklocal_allowance_exceeded</code> metric provided by the Elastic Network Adapter (ENA) driver and other metrics as well.</p>
<p>The <a href="https://docs.aws.amazon.com/AmazonCloudWatch/latest/monitoring/metrics-collected-by-CloudWatch-agent.html#linux-metrics-enabled-by-CloudWatch-agent" target="_blank" rel="noopener noreferrer"><code class="language-text">linklocal_allowance_exceeded</code></a> metric indicates the number of packets dropped because the PPS of the traffic to local proxy services exceeded the maximum for the network interface. This impacts traffic to the DNS service, the Instance Metadata Service, and the Amazon Time Sync Service.</p>
<p>Instead of tracking this event in real-time, we can stream this metric to <a href="https://aws.amazon.com/prometheus/" target="_blank" rel="noopener noreferrer">Amazon Managed Service for Prometheus</a> and visualize it in <a href="https://aws.amazon.com/grafana/" target="_blank" rel="noopener noreferrer">Amazon Managed Grafana</a>.</p>
<p><span class="gatsby-resp-image-wrapper" style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 581px; ">
      <span class="gatsby-resp-image-background-image" style="padding-bottom: 77.64705882352942%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAQABQDASIAAhEBAxEB/8QAFwABAQEBAAAAAAAAAAAAAAAAAAIDBf/EABYBAQEBAAAAAAAAAAAAAAAAAAABAv/aAAwDAQACEAMQAAAB7k1C6hn/xAAaEAACAgMAAAAAAAAAAAAAAAAAAQISESEx/9oACAEBAAEFAuF1YztpOR//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/AT//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/AT//xAAcEAABAwUAAAAAAAAAAAAAAAARABBBAQISIVH/2gAIAQEABj8CCxlhtCtscb//xAAbEAEAAgIDAAAAAAAAAAAAAAABESEAEDFBcf/aAAgBAQABPyEQGB7+E6aYeorG0ibPbX//2gAMAwEAAgADAAAAENPf/8QAFhEBAQEAAAAAAAAAAAAAAAAAARBB/9oACAEDAQE/EANn/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPxA//8QAGxAAAwEAAwEAAAAAAAAAAAAAAREhABAxUXH/2gAIAQEAAT8QAgtIU3EoRYEUuLazKQXp3xkBA0nupv/Z'); background-size: cover; display: block;"></span>
  <img class="gatsby-resp-image-image" alt="adot" title="" src="/static/9c0e9af412476642f6bdb554799934fd/f0d01/adot.jpg" srcset="/static/9c0e9af412476642f6bdb554799934fd/651be/adot.jpg 170w,
/static/9c0e9af412476642f6bdb554799934fd/d30a3/adot.jpg 340w,
/static/9c0e9af412476642f6bdb554799934fd/f0d01/adot.jpg 581w" sizes="(max-width: 581px) 100vw, 581px" style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;" loading="lazy" decoding="async">
    </span>
          </p>
<h2 id="Ô∏è-hands-on-collect-and-visualize-coredns-metrics-in-aws-eks" style="position:relative;"><a href="#%EF%B8%8F-hands-on-collect-and-visualize-coredns-metrics-in-aws-eks" aria-label="Ô∏è hands on collect and visualize coredns metrics in aws eks permalink" class="anchor before"><svg class="anchor-icon" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>üõ†Ô∏è Hands-on: Collect and Visualize CoreDNS Metrics in AWS EKS</h2>
<h3 id="-coredns-prometheus-plugin" style="position:relative;"><a href="#-coredns-prometheus-plugin" aria-label=" coredns prometheus plugin permalink" class="anchor before"><svg class="anchor-icon" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>üìä CoreDNS Prometheus Plugin</h3>
<p>The <a href="https://coredns.io/plugins/metrics/" target="_blank" rel="noopener noreferrer">CoreDNS Prometheus plugin</a> exposes metrics in the <a href="https://github.com/OpenObservability/OpenMetrics/blob/main/specification/OpenMetrics.md" target="_blank" rel="noopener noreferrer">OpenMetrics</a> format, a text-based standard that evolved from the <a href="https://prometheus.io/docs/instrumenting/exposition_formats/#text-based-format" target="_blank" rel="noopener noreferrer">Prometheus format</a>. In a Kubernetes cluster, the plugin is enabled by default, so you can begin monitoring <a href="https://www.datadoghq.com/blog/coredns-metrics" target="_blank" rel="noopener noreferrer">many key metrics</a> as soon as you launch your cluster.</p>
<p>By default, the Prometheus plugin writes metrics to a <code class="language-text">/metrics</code> endpoint on port <code class="language-text">9153</code> on each CoreDNS pod.</p>
<h3 id="Ô∏è-create-an-amazon-managed-service-for-prometheus-workspace-and-managed-service-for-grafana" style="position:relative;"><a href="#%EF%B8%8F-create-an-amazon-managed-service-for-prometheus-workspace-and-managed-service-for-grafana" aria-label="Ô∏è create an amazon managed service for prometheus workspace and managed service for grafana permalink" class="anchor before"><svg class="anchor-icon" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>üèóÔ∏è Create an Amazon Managed Service for Prometheus Workspace and Managed Service for Grafana</h3>
<p>In this step, we will create a workspace for Amazon Managed Service for Prometheus and Managed Service for Grafana. The configuration in these files creates:</p>
<ul>
<li>AMP workspace</li>
<li>AMP alert manager definition</li>
</ul>
<h4 id="code-classlanguage-textmaintfcode" style="position:relative;"><a href="#code-classlanguage-textmaintfcode" aria-label="code classlanguage textmaintfcode permalink" class="anchor before"><svg class="anchor-icon" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a><code class="language-text">main.tf</code></h4>
<div class="gatsby-highlight" data-language="hcl"><pre class="language-hcl"><code class="language-hcl"><span class="token keyword">module<span class="token type variable"> "prometheus" </span></span><span class="token punctuation">{</span>
    <span class="token property">source</span> <span class="token punctuation">=</span> <span class="token string">"terraform-aws-modules/managed-service-prometheus/aws"</span>

    <span class="token property">workspace_alias</span> <span class="token punctuation">=</span> <span class="token string">"demo-coredns"</span>

    <span class="token property">alert_manager_definition</span> <span class="token punctuation">=</span> <span class="token heredoc string">&lt;&lt;-EOT
    alertmanager_config: |
        route:
            receiver: 'default'
        receivers:
            - name: 'default'
    EOT</span>

    <span class="token property">rule_group_namespaces</span> <span class="token punctuation">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></div>
<h4 id="code-classlanguage-textversionstfcode" style="position:relative;"><a href="#code-classlanguage-textversionstfcode" aria-label="code classlanguage textversionstfcode permalink" class="anchor before"><svg class="anchor-icon" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a><code class="language-text">versions.tf</code></h4>
<div class="gatsby-highlight" data-language="hcl"><pre class="language-hcl"><code class="language-hcl"><span class="token keyword">terraform</span> <span class="token punctuation">{</span>
    <span class="token property">required_version</span> <span class="token punctuation">=</span> <span class="token string">">= 1.3"</span>

    <span class="token keyword">required_providers</span> <span class="token punctuation">{</span>
        <span class="token property">aws</span> <span class="token punctuation">=</span> <span class="token punctuation">{</span>
            <span class="token property">source</span>  <span class="token punctuation">=</span> <span class="token string">"hashicorp/aws"</span>
            <span class="token property">version</span> <span class="token punctuation">=</span> <span class="token string">">= 5.32"</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></div>
<p>To run the Terraform code, execute:</p>
<div class="gatsby-highlight" data-language="sh"><pre class="language-sh"><code class="language-sh"><span class="token comment"># terraform init</span>
<span class="token comment"># terraform plan</span>
<span class="token comment"># terraform apply</span></code></pre></div>
<h3 id="Ô∏è-create-a-default-grafana-workspace" style="position:relative;"><a href="#%EF%B8%8F-create-a-default-grafana-workspace" aria-label="Ô∏è create a default grafana workspace permalink" class="anchor before"><svg class="anchor-icon" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>üñ•Ô∏è Create a Default Grafana Workspace</h3>
<p>The below configuration files will create a default Grafana workspace using defaults provided by the module.</p>
<h4 id="code-classlanguage-textmaintfcode-1" style="position:relative;"><a href="#code-classlanguage-textmaintfcode-1" aria-label="code classlanguage textmaintfcode 1 permalink" class="anchor before"><svg class="anchor-icon" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a><code class="language-text">main.tf</code></h4>
<div class="gatsby-highlight" data-language="hcl"><pre class="language-hcl"><code class="language-hcl"><span class="token keyword">provider<span class="token type variable"> "aws" </span></span><span class="token punctuation">{</span>
    <span class="token property">region</span> <span class="token punctuation">=</span> local.region
<span class="token punctuation">}</span>

<span class="token keyword">data <span class="token type variable">"aws_availability_zones"</span></span> <span class="token string">"available"</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

<span class="token keyword">locals</span> <span class="token punctuation">{</span>
    <span class="token property">region</span>      <span class="token punctuation">=</span> <span class="token string">"eu-west-1"</span>
    <span class="token property">name</span>        <span class="token punctuation">=</span> <span class="token string">"amg-ex-<span class="token interpolation"><span class="token punctuation">$</span><span class="token punctuation">{</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token function">basename</span><span class="token punctuation">(</span><span class="token keyword">path</span><span class="token punctuation">.</span><span class="token type variable">cwd</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"_"</span><span class="token punctuation">,</span> <span class="token string">"-"</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span>"</span>
    <span class="token property">description</span> <span class="token punctuation">=</span> <span class="token string">"AWS Managed Grafana service for <span class="token interpolation"><span class="token punctuation">$</span><span class="token punctuation">{</span><span class="token keyword">local</span><span class="token punctuation">.</span><span class="token type variable">name</span><span class="token punctuation">}</span></span>"</span>

    <span class="token property">vpc_cidr</span> <span class="token punctuation">=</span> <span class="token string">"10.0.0.0/16"</span>
    <span class="token property">azs</span>      <span class="token punctuation">=</span> slice(data.aws_availability_zones.available.names, <span class="token number">0</span>, <span class="token number">3</span>)
<span class="token punctuation">}</span>

<span class="token keyword">module<span class="token type variable"> "managed_grafana" </span></span><span class="token punctuation">{</span>
    <span class="token property">source</span> <span class="token punctuation">=</span> <span class="token string">"terraform-aws-modules/managed-service-grafana/aws"</span>

    <span class="token property">name</span>                      <span class="token punctuation">=</span> local.name
    <span class="token property">associate_license</span>         <span class="token punctuation">=</span> <span class="token boolean">false</span>
    <span class="token property">description</span>               <span class="token punctuation">=</span> local.description
    <span class="token property">account_access_type</span>       <span class="token punctuation">=</span> <span class="token string">"CURRENT_ACCOUNT"</span>
    <span class="token property">authentication_providers</span>  <span class="token punctuation">=</span> <span class="token punctuation">[</span><span class="token string">"AWS_SSO"</span><span class="token punctuation">]</span>
    <span class="token property">permission_type</span>           <span class="token punctuation">=</span> <span class="token string">"SERVICE_MANAGED"</span>
    <span class="token property">data_sources</span>              <span class="token punctuation">=</span> <span class="token punctuation">[</span><span class="token string">"CLOUDWATCH"</span>, <span class="token string">"PROMETHEUS"</span>, <span class="token string">"XRAY"</span><span class="token punctuation">]</span>
    <span class="token property">notification_destinations</span> <span class="token punctuation">=</span> <span class="token punctuation">[</span><span class="token string">"SNS"</span><span class="token punctuation">]</span>
    <span class="token property">stack_set_name</span>            <span class="token punctuation">=</span> local.name
    <span class="token property">grafana_version</span>           <span class="token punctuation">=</span> <span class="token string">"9.4"</span>

    <span class="token property">configuration</span> <span class="token punctuation">=</span> jsonencode(<span class="token punctuation">{</span>
        <span class="token property">unifiedAlerting</span> <span class="token punctuation">=</span> <span class="token punctuation">{</span>
            <span class="token property">enabled</span> <span class="token punctuation">=</span> <span class="token boolean">true</span>
        <span class="token punctuation">}</span>,
        <span class="token property">plugins</span> <span class="token punctuation">=</span> <span class="token punctuation">{</span>
            <span class="token property">pluginAdminEnabled</span> <span class="token punctuation">=</span> <span class="token boolean">false</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>)

    <span class="token property">vpc_configuration</span> <span class="token punctuation">=</span> <span class="token punctuation">{</span>
        <span class="token property">subnet_ids</span> <span class="token punctuation">=</span> module.vpc.private_subnets
    <span class="token punctuation">}</span>
    <span class="token property">security_group_rules</span> <span class="token punctuation">=</span> <span class="token punctuation">{</span>
        <span class="token property">egress_postgresql</span> <span class="token punctuation">=</span> <span class="token punctuation">{</span>
            <span class="token property">description</span> <span class="token punctuation">=</span> <span class="token string">"Allow egress to PostgreSQL"</span>
            <span class="token property">from_port</span>   <span class="token punctuation">=</span> <span class="token number">5432</span>
            <span class="token property">to_port</span>     <span class="token punctuation">=</span> <span class="token number">5432</span>
            <span class="token property">protocol</span>    <span class="token punctuation">=</span> <span class="token string">"tcp"</span>
            <span class="token property">cidr_blocks</span> <span class="token punctuation">=</span> module.vpc.private_subnets_cidr_blocks
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token property">workspace_api_keys</span> <span class="token punctuation">=</span> <span class="token punctuation">{</span>
        <span class="token property">viewer</span> <span class="token punctuation">=</span> <span class="token punctuation">{</span>
            <span class="token property">key_name</span>        <span class="token punctuation">=</span> <span class="token string">"viewer"</span>
            <span class="token property">key_role</span>        <span class="token punctuation">=</span> <span class="token string">"VIEWER"</span>
            <span class="token property">seconds_to_live</span> <span class="token punctuation">=</span> <span class="token number">3600</span>
        <span class="token punctuation">}</span>
        <span class="token property">editor</span> <span class="token punctuation">=</span> <span class="token punctuation">{</span>
            <span class="token property">key_name</span>        <span class="token punctuation">=</span> <span class="token string">"editor"</span>
            <span class="token property">key_role</span>        <span class="token punctuation">=</span> <span class="token string">"EDITOR"</span>
            <span class="token property">seconds_to_live</span> <span class="token punctuation">=</span> <span class="token number">3600</span>
        <span class="token punctuation">}</span>
        <span class="token property">admin</span> <span class="token punctuation">=</span> <span class="token punctuation">{</span>
            <span class="token property">key_name</span>        <span class="token punctuation">=</span> <span class="token string">"admin"</span>
            <span class="token property">key_role</span>        <span class="token punctuation">=</span> <span class="token string">"ADMIN"</span>
            <span class="token property">seconds_to_live</span> <span class="token punctuation">=</span> <span class="token number">3600</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token property">create_iam_role</span>                <span class="token punctuation">=</span> <span class="token boolean">true</span>
    <span class="token property">iam_role_name</span>                  <span class="token punctuation">=</span> local.name
    <span class="token property">use_iam_role_name_prefix</span>       <span class="token punctuation">=</span> <span class="token boolean">true</span>
    <span class="token property">iam_role_description</span>           <span class="token punctuation">=</span> local.description
    <span class="token property">iam_role_path</span>                  <span class="token punctuation">=</span> <span class="token string">"/grafana/"</span>
    <span class="token property">iam_role_force_detach_policies</span> <span class="token punctuation">=</span> <span class="token boolean">true</span>
    <span class="token property">iam_role_max_session_duration</span>  <span class="token punctuation">=</span> <span class="token number">7200</span>
    <span class="token property">iam_role_tags</span>                  <span class="token punctuation">=</span> <span class="token punctuation">{</span> <span class="token property">role</span> <span class="token punctuation">=</span> <span class="token boolean">true</span> <span class="token punctuation">}</span>

    <span class="token property">tags</span> <span class="token punctuation">=</span> local.tags
<span class="token punctuation">}</span>

<span class="token keyword">module<span class="token type variable"> "managed_grafana_default" </span></span><span class="token punctuation">{</span>
    <span class="token property">source</span> <span class="token punctuation">=</span> <span class="token string">"terraform-aws-modules/managed-service-grafana/aws"</span>

    <span class="token property">name</span>              <span class="token punctuation">=</span> <span class="token string">"<span class="token interpolation"><span class="token punctuation">$</span><span class="token punctuation">{</span><span class="token keyword">local</span><span class="token punctuation">.</span><span class="token type variable">name</span><span class="token punctuation">}</span></span>-default"</span>
    <span class="token property">associate_license</span> <span class="token punctuation">=</span> <span class="token boolean">false</span>

    <span class="token property">tags</span> <span class="token punctuation">=</span> local.tags
<span class="token punctuation">}</span>

<span class="token keyword">module<span class="token type variable"> "managed_grafana_disabled" </span></span><span class="token punctuation">{</span>
    <span class="token property">source</span> <span class="token punctuation">=</span> <span class="token string">"terraform-aws-modules/managed-service-grafana/aws"</span>

    <span class="token property">name</span>   <span class="token punctuation">=</span> local.name
    <span class="token property">create</span> <span class="token punctuation">=</span> <span class="token boolean">false</span>
<span class="token punctuation">}</span>

<span class="token keyword">module<span class="token type variable"> "vpc" </span></span><span class="token punctuation">{</span>
    <span class="token property">source</span>  <span class="token punctuation">=</span> <span class="token string">"terraform-aws-modules/vpc/aws"</span>
    <span class="token property">version</span> <span class="token punctuation">=</span> <span class="token string">"~> 5.0"</span>

    <span class="token property">name</span> <span class="token punctuation">=</span> local.name
    <span class="token property">cidr</span> <span class="token punctuation">=</span> local.vpc_cidr

    <span class="token property">azs</span>             <span class="token punctuation">=</span> local.azs
    <span class="token property">private_subnets</span> <span class="token punctuation">=</span> <span class="token punctuation">[</span>for k, v in local.azs : cidrsubnet(local.vpc_cidr, <span class="token number">4</span>, k)<span class="token punctuation">]</span>
    <span class="token property">public_subnets</span>  <span class="token punctuation">=</span> <span class="token punctuation">[</span>for k, v in local.azs : cidrsubnet(local.vpc_cidr, <span class="token number">8</span>, k + <span class="token number">48</span>)<span class="token punctuation">]</span>

    <span class="token property">enable_nat_gateway</span> <span class="token punctuation">=</span> <span class="token boolean">false</span> 
    <span class="token property">single_nat_gateway</span> <span class="token punctuation">=</span> <span class="token boolean">true</span>

    <span class="token property">tags</span> <span class="token punctuation">=</span> local.tags
<span class="token punctuation">}</span></code></pre></div>
<h4 id="versionstf" style="position:relative;"><a href="#versionstf" aria-label="versionstf permalink" class="anchor before"><svg class="anchor-icon" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>versions.tf</h4>
<div class="gatsby-highlight" data-language="hcl"><pre class="language-hcl"><code class="language-hcl"><span class="token keyword">terraform</span> <span class="token punctuation">{</span>
    <span class="token property">required_version</span> <span class="token punctuation">=</span> <span class="token string">">= 1.0"</span>

    <span class="token keyword">required_providers</span> <span class="token punctuation">{</span>
        <span class="token property">aws</span> <span class="token punctuation">=</span> <span class="token punctuation">{</span>
            <span class="token property">source</span>  <span class="token punctuation">=</span> <span class="token string">"hashicorp/aws"</span>
            <span class="token property">version</span> <span class="token punctuation">=</span> <span class="token string">">= 5.0"</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></div>
<p>To run this code, execute:</p>
<div class="gatsby-highlight" data-language="shell"><pre class="language-shell"><code class="language-shell"><span class="token comment"># terraform init</span>
<span class="token comment"># terraform plan</span>
<span class="token comment"># terraform apply</span></code></pre></div>
<h3 id="-deploying-prometheus-ethtool-exporter" style="position:relative;"><a href="#-deploying-prometheus-ethtool-exporter" aria-label=" deploying prometheus ethtool exporter permalink" class="anchor before"><svg class="anchor-icon" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>üöÄ Deploying Prometheus Ethtool Exporter</h3>
<p><a href="https://linux.die.net/man/8/ethtool" target="_blank" rel="noopener noreferrer">Ethtool</a> is a Linux tool for configuring and gathering information about Ethernet devices on worker nodes. We will use ethtool's output to detect packet loss and convert it to Prometheus format with a Prometheus ethtool exporter utility.</p>
<p>Deploy the exporter using:</p>
<div class="gatsby-highlight" data-language="sh"><pre class="language-sh"><code class="language-sh">kubectl apply <span class="token parameter variable">-f</span> https://raw.githubusercontent.com/Showmax/prometheus-ethtool-exporter/master/deploy/k8s-daemonset.yaml</code></pre></div>
<h3 id="-deploy-adot-collector-to-scrape-ethtool-metrics" style="position:relative;"><a href="#-deploy-adot-collector-to-scrape-ethtool-metrics" aria-label=" deploy adot collector to scrape ethtool metrics permalink" class="anchor before"><svg class="anchor-icon" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>üì¶ Deploy ADOT Collector to Scrape Ethtool Metrics</h3>
<p>In this step, we will deploy the ADOT collector and configure it to ingest metrics to Amazon Managed Service for Prometheus. We will use the <a href="https://docs.aws.amazon.com/eks/latest/userguide/opentelemetry.html" target="_blank" rel="noopener noreferrer">Amazon EKS add-on for ADOT operator</a> to send the metrics <a href="https://docs.aws.amazon.com/AmazonCloudWatch/latest/monitoring/metrics-collected-by-CloudWatch-agent.html#linux-metrics-enabled-by-CloudWatch-agent" target="_blank" rel="noopener noreferrer">linklocal_allowance_exceeded</a> to Amazon Managed Service for Prometheus for monitoring CoreDNS.</p>
<h4 id="create-an-iam-role-and-amazon-eks-service-account" style="position:relative;"><a href="#create-an-iam-role-and-amazon-eks-service-account" aria-label="create an iam role and amazon eks service account permalink" class="anchor before"><svg class="anchor-icon" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Create an IAM Role and Amazon EKS Service Account</h4>
<p>We will deploy the ADOT collector to run under the identity of a Kubernetes <a href="https://kubernetes.io/docs/tasks/configure-pod-container/configure-service-account/" target="_blank" rel="noopener noreferrer">service account</a> <code class="language-text">adot-collector</code>. <a href="https://docs.aws.amazon.com/eks/latest/userguide/iam-roles-for-service-accounts.html" target="_blank" rel="noopener noreferrer">IAM roles for service accounts (IRSA)</a> let you associate the <code class="language-text">AmazonPrometheusRemoteWriteAccess</code> role with a Kubernetes service account, thereby providing IAM permissions to any pod utilizing the service account to ingest the metrics to Amazon Managed Service for Prometheus.</p>
<p>You need <code class="language-text">kubectl</code> and <code class="language-text">eksctl</code> CLI tools to run the script. They must be configured to access your Amazon EKS cluster.</p>
<div class="gatsby-highlight" data-language="sh"><pre class="language-sh"><code class="language-sh">eksctl create iamserviceaccount <span class="token punctuation">\</span>
<span class="token parameter variable">--name</span> adot-collector <span class="token punctuation">\</span>
<span class="token parameter variable">--namespace</span> default <span class="token punctuation">\</span>
<span class="token parameter variable">--region</span> eu-west-1 <span class="token punctuation">\</span>
<span class="token parameter variable">--cluster</span> coredns-monitoring-demo <span class="token punctuation">\</span>
--attach-policy-arn arn:aws:iam::aws:policy/AmazonPrometheusRemoteWriteAccess <span class="token punctuation">\</span>
<span class="token parameter variable">--approve</span> <span class="token punctuation">\</span>
--override-existing-serviceaccounts</code></pre></div>
<h4 id="install-adot-add-on" style="position:relative;"><a href="#install-adot-add-on" aria-label="install adot add on permalink" class="anchor before"><svg class="anchor-icon" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Install ADOT Add-on</h4>
<p>You can check the list of add-ons enabled for different versions of Amazon EKS using the following command:</p>
<div class="gatsby-highlight" data-language="sh"><pre class="language-sh"><code class="language-sh">aws eks describe-addon-versions --addon-name adot --kubernetes-version <span class="token number">1.28</span> <span class="token punctuation">\</span>
    <span class="token parameter variable">--query</span> <span class="token string">"addons[].addonVersions[].[addonVersion, compatibilities[].defaultVersion]"</span> <span class="token parameter variable">--output</span> text</code></pre></div>
<p>Run the following command to install the ADOT add-on, replacing the <code class="language-text">--addon-version</code> flag based on your Amazon EKS cluster version as shown in the step above.</p>
<div class="gatsby-highlight" data-language="sh"><pre class="language-sh"><code class="language-sh">aws eks create-addon --addon-name adot --addon-version v0.66.0-eksbuild.1 --cluster-name coredns-monitoring-demo</code></pre></div>
<p>Verify that the ADOT add-on is ready using the following command:</p>
<div class="gatsby-highlight" data-language="sh"><pre class="language-sh"><code class="language-sh">kubectl get po <span class="token parameter variable">-n</span> opentelemetry-operator-system</code></pre></div>
<p>The following procedure uses an example YAML file with <code class="language-text">deployment</code> as the mode value. This is the default mode and deploys the ADOT Collector similarly to a standalone application. This configuration receives OTLP metrics from the sample application and Amazon Managed Service for Prometheus metrics scraped from pods on the cluster.</p>
<div class="gatsby-highlight" data-language="sh"><pre class="language-sh"><code class="language-sh"><span class="token function">curl</span> <span class="token parameter variable">-o</span> collector-config-amp.yaml https://raw.githubusercontent.com/aws-observability/aws-otel-community/master/sample-configs/operator/collector-config-amp.yaml</code></pre></div>
<p>In <code class="language-text">collector-config-amp.yaml</code>, replace the following with your own values:</p>
<ul>
<li><code class="language-text">mode: deployment</code></li>
<li><code class="language-text">serviceAccount: adot-collector</code></li>
<li><code class="language-text">endpoint: ""</code></li>
<li><code class="language-text">region: ""</code></li>
<li><code class="language-text">name: adot-collector</code></li>
</ul>
<p>Apply the configuration:</p>
<div class="gatsby-highlight" data-language="sh"><pre class="language-sh"><code class="language-sh">kubectl apply <span class="token parameter variable">-f</span> collector-config-amp.yaml</code></pre></div>
<p>Once the ADOT collector is deployed, the metrics will be stored successfully in Amazon Prometheus.</p>
<h3 id="-visualize-ethtool-metrics-in-amazon-managed-grafana" style="position:relative;"><a href="#-visualize-ethtool-metrics-in-amazon-managed-grafana" aria-label=" visualize ethtool metrics in amazon managed grafana permalink" class="anchor before"><svg class="anchor-icon" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>üìà Visualize Ethtool Metrics in Amazon Managed Grafana</h3>
<p>Configure the Amazon Managed Service for Prometheus workspace as a datasource inside the Amazon Managed Grafana console.</p>
<p>Let's explore the metrics in Amazon Managed Grafana now: Click the explore button, and search for <code class="language-text">ethtool</code>.</p>
<p><span class="gatsby-resp-image-wrapper" style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; ">
      <span class="gatsby-resp-image-background-image" style="padding-bottom: 45.88235294117647%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAIAAAC9o5sfAAAACXBIWXMAAAsTAAALEwEAmpwYAAABLklEQVR42m2QW2rDMBREvY3Yji3JkiNZsiLJbyctIdCSr0CX0d/u/6MTm5S2GA6X4UpzX1GwVlZOSaO146Ki7EBZSWi5iD9IVavKKkTdXe5f0/tnlKQ547oybZrSXZwBiH1WxAnZxfkmeNpnPElJhN+lPKIY5TVbkMqqyolSs0IWXCFmOf8NSicpBRFlgjAldVMIs2LqxtTBHjvnh2dsne8BhA+jNh4NsEgkmMgILw8GCy8oH4amnZtmgoDTL6zCuR7mEEZUf5jzvMiJwJBPc4VCUtqDtFxoXA5DbpLuGQ5GcF4Y4F9KqDB/yHpirMTC684/gj2EXDOPzjDjelBoAnAPH+b5dO37sxAaQ635f+A/mkfT/Hp0XT+cu/4E2m6+XN5ut/v55Qq9JjcJzfgNOSlWDJU98DgAAAAASUVORK5CYII='); background-size: cover; display: block;"></span>
  <img class="gatsby-resp-image-image" alt="apm" title="" src="/static/8073f7721006157bf3b6efc69fec4184/c5bb3/apm.png" srcset="/static/8073f7721006157bf3b6efc69fec4184/04472/apm.png 170w,
/static/8073f7721006157bf3b6efc69fec4184/9f933/apm.png 340w,
/static/8073f7721006157bf3b6efc69fec4184/c5bb3/apm.png 680w,
/static/8073f7721006157bf3b6efc69fec4184/b12f7/apm.png 1020w,
/static/8073f7721006157bf3b6efc69fec4184/b5a09/apm.png 1360w,
/static/8073f7721006157bf3b6efc69fec4184/07a9c/apm.png 1440w" sizes="(max-width: 680px) 100vw, 680px" style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;" loading="lazy" decoding="async">
    </span>
          </p>
<p>Let's build a dashboard for the linklocal_allowance_exceeded metric by using the query</p>
<div class="gatsby-highlight" data-language="shell"><pre class="language-shell"><code class="language-shell">rate<span class="token punctuation">(</span>node_net_ethtool<span class="token punctuation">{</span>device<span class="token operator">=</span><span class="token string">"eth0"</span>,type<span class="token operator">=</span><span class="token string">"linklocal_allo
wance_exceeded"</span><span class="token punctuation">}</span> <span class="token punctuation">[</span>30s<span class="token punctuation">]</span><span class="token punctuation">)</span></code></pre></div>
<p><span class="gatsby-resp-image-wrapper" style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; ">
      <span class="gatsby-resp-image-background-image" style="padding-bottom: 53.529411764705884%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA6ElEQVR42p2SaU7EMAyFcwVmaRpncewsRAX+cP/D4SadzqgDCCF9spyXPtuKq3xIBvB0nl9O+sD5Yg5HPfupo024XEFNJqwHwAOzjQ6zxEfFONoRoxqSxGeG4XtclJbqx+vfGeY+0n/N4NkGBk+SdOiW05NIj6KGoIhL5OLE79AIFmGLUTBdhD3a+wdr5xSz9eyxCi4kyc3tVUGi7fQcHA9EyfVddqHa2yel11yXlBtiKmXJpXFuAXOIRa4iVeI26u4gVbBRlfbBdemFSa8jjSbb8vYRDn/BBHiVsa2UDGm220p154+v/QUx8kjqifT8IgAAAABJRU5ErkJggg=='); background-size: cover; display: block;"></span>
  <img class="gatsby-resp-image-image" alt="result" title="" src="/static/65e84ae8ccc9fd90579aa4af904c0687/c5bb3/result.png" srcset="/static/65e84ae8ccc9fd90579aa4af904c0687/04472/result.png 170w,
/static/65e84ae8ccc9fd90579aa4af904c0687/9f933/result.png 340w,
/static/65e84ae8ccc9fd90579aa4af904c0687/c5bb3/result.png 680w,
/static/65e84ae8ccc9fd90579aa4af904c0687/b12f7/result.png 1020w,
/static/65e84ae8ccc9fd90579aa4af904c0687/b5a09/result.png 1360w,
/static/65e84ae8ccc9fd90579aa4af904c0687/07a9c/result.png 1440w" sizes="(max-width: 680px) 100vw, 680px" style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;" loading="lazy" decoding="async">
    </span>
          </p>
<p>We can see that there were no packets dropped as the value is zero. You can further extend this by configuring alerts in the alert manager in Amazon Managed Service for Prometheus to send notifications.</p>
<h2 id="conclusion" style="position:relative;"><a href="#conclusion" aria-label="conclusion permalink" class="anchor before"><svg class="anchor-icon" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Conclusion</h2>
<p>In this post, we showed how to monitor and create alerts for CoreDNS throttling issues using AWS Distro for OpenTelemetry (ADOT), Amazon Managed Service for Prometheus, and Amazon Managed Grafana. By monitoring the coreDNS metrics, customers can proactively detect packet drops and take preventive actions.</p>
<p><strong>References:</strong></p>
<ul>
<li><a href="https://www.datadoghq.com/blog/coredns-monitoring-tools/" target="_blank" rel="noopener noreferrer">https://www.datadoghq.com/blog/coredns-monitoring-tools/</a></li>
<li><a href="https://cilium.io/blog/2019/12/18/how-to-debug-dns-issues-in-k8s/" target="_blank" rel="noopener noreferrer">https://cilium.io/blog/2019/12/18/how-to-debug-dns-issues-in-k8s/</a></li>
<li><a href="https://sysdig.com/blog/how-to-monitor-coredns/" target="_blank" rel="noopener noreferrer">https://sysdig.com/blog/how-to-monitor-coredns/</a></li>
<li><a href="https://www.datadoghq.com/blog/coredns-metrics/" target="_blank" rel="noopener noreferrer">https://www.datadoghq.com/blog/coredns-metrics/</a></li>
<li><a href="https://aws.amazon.com/blogs/mt/monitoring-coredns-for-dns-throttling-issues-using-aws-open-source-monitoring-services/" target="_blank" rel="noopener noreferrer">https://aws.amazon.com/blogs/mt/monitoring-coredns-for-dns-throttling-issues-using-aws-open-source-monitoring-services/</a></li>
</ul>
<br>
<p><strong><em>Until next time, „Å§„Å•„Åè üéâ</em></strong></p>
<blockquote>
<p>üí° Thank you for Reading !! üôåüèªüòÅüìÉ, see you in the next blog.ü§ò  <strong><em>Until next time üéâ</em></strong></p>
</blockquote>
<p>üöÄ Thank you for sticking up till the end. If you have any questions/feedback regarding this blog feel free to connect with me:</p>
<p><strong>‚ôªÔ∏è LinkedIn:</strong> <a href="https://www.linkedin.com/in/rajhi-saif/" target="_blank" rel="noopener noreferrer">https://www.linkedin.com/in/rajhi-saif/</a></p>
<p><strong>‚ôªÔ∏è X/Twitter:</strong> <a href="https://x.com/rajhisaifeddine" target="_blank" rel="noopener noreferrer">https://x.com/rajhisaifeddine</a></p>
<p><strong>The end ‚úåüèª</strong></p>
<h1 align="center">üî∞ Keep Learning !! Keep Sharing !! üî∞</h1>
<p><strong>üìÖ Stay updated</strong></p>
<p>Subscribe to our newsletter for more insights on AWS cloud computing and containers.</p></div></div><div id="content-end"></div></article><div data-nosnippet="" class="social-share-wrapper"><h3>Share Your Love</h3><button keywords="" aria-label="Share Via Facebook" class="react-share__ShareButton social-share-item facebook" style="background-color:transparent;border:none;padding:0;font:inherit;color:inherit;cursor:pointer"><svg aria-hidden="true" focusable="false" data-prefix="fab" data-icon="facebook" class="svg-inline--fa fa-facebook " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M512 256C512 114.6 397.4 0 256 0S0 114.6 0 256C0 376 82.7 476.8 194.2 504.5V334.2H141.4V256h52.8V222.3c0-87.1 39.4-127.5 125-127.5c16.2 0 44.2 3.2 55.7 6.4V172c-6-.6-16.5-1-29.6-1c-42 0-58.2 15.9-58.2 57.2V256h83.6l-14.4 78.2H287V510.1C413.8 494.8 512 386.9 512 256h0z"></path></svg></button><button keywords="" aria-label="Share Via Twitter" class="react-share__ShareButton social-share-item twitter" style="background-color:transparent;border:none;padding:0;font:inherit;color:inherit;cursor:pointer"><svg aria-hidden="true" focusable="false" data-prefix="fab" data-icon="x-twitter" class="svg-inline--fa fa-x-twitter " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M389.2 48h70.6L305.6 224.2 487 464H345L233.7 318.6 106.5 464H35.8L200.7 275.5 26.8 48H172.4L272.9 180.9 389.2 48zM364.4 421.8h39.1L151.1 88h-42L364.4 421.8z"></path></svg></button><button aria-label="Share Via LinkedIn" keywords="" class="react-share__ShareButton social-share-item linkedin" style="background-color:transparent;border:none;padding:0;font:inherit;color:inherit;cursor:pointer"><svg aria-hidden="true" focusable="false" data-prefix="fab" data-icon="linkedin" class="svg-inline--fa fa-linkedin " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"></path></svg></button><button keywords="" aria-label="Share Via Reddit" class="react-share__ShareButton social-share-item reddit" style="background-color:transparent;border:none;padding:0;font:inherit;color:inherit;cursor:pointer"><svg aria-hidden="true" focusable="false" data-prefix="fab" data-icon="reddit" class="svg-inline--fa fa-reddit " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M0 256C0 114.6 114.6 0 256 0S512 114.6 512 256s-114.6 256-256 256L37.1 512c-13.7 0-20.5-16.5-10.9-26.2L75 437C28.7 390.7 0 326.7 0 256zM349.6 153.6c23.6 0 42.7-19.1 42.7-42.7s-19.1-42.7-42.7-42.7c-20.6 0-37.8 14.6-41.8 34c-34.5 3.7-61.4 33-61.4 68.4l0 .2c-37.5 1.6-71.8 12.3-99 29.1c-10.1-7.8-22.8-12.5-36.5-12.5c-33 0-59.8 26.8-59.8 59.8c0 24 14.1 44.6 34.4 54.1c2 69.4 77.6 125.2 170.6 125.2s168.7-55.9 170.6-125.3c20.2-9.6 34.1-30.2 34.1-54c0-33-26.8-59.8-59.8-59.8c-13.7 0-26.3 4.6-36.4 12.4c-27.4-17-62.1-27.7-100-29.1l0-.2c0-25.4 18.9-46.5 43.4-49.9l0 0c4.4 18.8 21.3 32.8 41.5 32.8zM177.1 246.9c16.7 0 29.5 17.6 28.5 39.3s-13.5 29.6-30.3 29.6s-31.4-8.8-30.4-30.5s15.4-38.3 32.1-38.3zm190.1 38.3c1 21.7-13.7 30.5-30.4 30.5s-29.3-7.9-30.3-29.6c-1-21.7 11.8-39.3 28.5-39.3s31.2 16.6 32.1 38.3zm-48.1 56.7c-10.3 24.6-34.6 41.9-63 41.9s-52.7-17.3-63-41.9c-1.2-2.9 .8-6.2 3.9-6.5c18.4-1.9 38.3-2.9 59.1-2.9s40.7 1 59.1 2.9c3.1 .3 5.1 3.6 3.9 6.5z"></path></svg></button><button keywords="" aria-label="Add to Pocket" class="react-share__ShareButton social-share-item pocket" style="background-color:transparent;border:none;padding:0;font:inherit;color:inherit;cursor:pointer"><svg aria-hidden="true" focusable="false" data-prefix="fab" data-icon="get-pocket" class="svg-inline--fa fa-get-pocket " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M407.6 64h-367C18.5 64 0 82.5 0 104.6v135.2C0 364.5 99.7 464 224.2 464c124 0 223.8-99.5 223.8-224.2V104.6c0-22.4-17.7-40.6-40.4-40.6zm-162 268.5c-12.4 11.8-31.4 11.1-42.4 0C89.5 223.6 88.3 227.4 88.3 209.3c0-16.9 13.8-30.7 30.7-30.7 17 0 16.1 3.8 105.2 89.3 90.6-86.9 88.6-89.3 105.5-89.3 16.9 0 30.7 13.8 30.7 30.7 0 17.8-2.9 15.7-114.8 123.2z"></path></svg></button></div><br/><br/><br/></main><aside class="blogpost-sidebar"><div data-nosnippet="" class="blog-navigation-wrapper"><h3>Read Other Posts</h3><nav class="blog-navigation"><div class="nav-links"><a rel="next" class="next-post" href="/blog/daemonless-kaniko-container-images/">Building Container Images in Kubernetes Cluster with Kaniko<!-- --> ‚Üí</a><a rel="prev" class="prev-post" href="/blog/local-kubernetes-development-tools/">‚Üê <!-- -->Exploring Local Kubernetes Development Tools and Solutions</a><a class="all-posts" href="/blog/">All Posts</a></div></nav></div></aside><footer data-nosnippet=""><div class="footer-wrapper"><div data-nosnippet="" class="social"><ul class="social-list"><li class="social-item social-linkedin"><a rel="me" itemProp="url" eventCategory="social" eventAction="click" eventLabel="linkedin" href="https://www.linkedin.com/in/rajhi-saif/" title="Saifeddine Rajhi on LinkedIn" target="blank"><svg aria-hidden="true" focusable="false" data-prefix="fab" data-icon="linkedin-in" class="svg-inline--fa fa-linkedin-in fa-beat fa-2x " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M100.28 448H7.4V148.9h92.88zM53.79 108.1C24.09 108.1 0 83.5 0 53.8a53.79 53.79 0 0 1 107.58 0c0 29.7-24.1 54.3-53.79 54.3zM447.9 448h-92.68V302.4c0-34.7-.7-79.2-48.29-79.2-48.29 0-55.69 37.7-55.69 76.7V448h-92.78V148.9h89.08v40.8h1.3c12.4-23.5 42.69-48.3 87.88-48.3 94 0 111.28 61.9 111.28 142.3V448z"></path></svg><span>LinkedIn</span></a></li><li class="social-item social-github"><a rel="me" itemProp="url" eventCategory="social" eventAction="click" eventLabel="github" href="https://github.com/seifrajhi" title="Saifeddine Rajhi on Github" target="blank"><svg aria-hidden="true" focusable="false" data-prefix="fab" data-icon="github" class="svg-inline--fa fa-github fa-beat fa-2x " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path fill="currentColor" d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"></path></svg><span>GitHub</span></a></li><li class="social-item social-email"><a itemProp="email" eventCategory="social" eventAction="click" eventLabel="email" href="mailto:rajhiseif@gmail.com" title="Saifeddine Rajhi&#x27;s Email"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="envelope" class="svg-inline--fa fa-envelope fa-beat fa-2x " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M48 64C21.5 64 0 85.5 0 112c0 15.1 7.1 29.3 19.2 38.4L236.8 313.6c11.4 8.5 27 8.5 38.4 0L492.8 150.4c12.1-9.1 19.2-23.3 19.2-38.4c0-26.5-21.5-48-48-48L48 64zM0 176L0 384c0 35.3 28.7 64 64 64l384 0c35.3 0 64-28.7 64-64l0-208L294.4 339.2c-22.8 17.1-54 17.1-76.8 0L0 176z"></path></svg><span>Email</span></a></li><li class="social-item social-bluesky"><a rel="me" itemProp="url" eventCategory="bluesky" eventAction="click" eventLabel="social" href="https://bsky.app/profile/saifrajhi.bsky.social" title="Saifeddine Rajhi on Bluesky Social" target="blank"><svg aria-hidden="true" focusable="false" data-prefix="fab" data-icon="bluesky" class="svg-inline--fa fa-bluesky fa-beat fa-2x " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M111.8 62.2C170.2 105.9 233 194.7 256 242.4c23-47.6 85.8-136.4 144.2-180.2c42.1-31.6 110.3-56 110.3 21.8c0 15.5-8.9 130.5-14.1 149.2C478.2 298 412 314.6 353.1 304.5c102.9 17.5 129.1 75.5 72.5 133.5c-107.4 110.2-154.3-27.6-166.3-62.9l0 0c-1.7-4.9-2.6-7.8-3.3-7.8s-1.6 3-3.3 7.8l0 0c-12 35.3-59 173.1-166.3 62.9c-56.5-58-30.4-116 72.5-133.5C100 314.6 33.8 298 15.7 233.1C10.4 214.4 1.5 99.4 1.5 83.9c0-77.8 68.2-53.4 110.3-21.8z"></path></svg><span>Bluesky Social</span></a></li><li class="social-item social-X/Twitter"><a rel="me" itemProp="url" eventCategory="social" eventAction="click" eventLabel="X/Twitter" href="https://x.com/RajhiSaifeddine" title="Saifeddine Rajhi on X/Twitter" target="blank"><svg aria-hidden="true" focusable="false" data-prefix="fab" data-icon="x-twitter" class="svg-inline--fa fa-x-twitter fa-beat fa-2x " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M389.2 48h70.6L305.6 224.2 487 464H345L233.7 318.6 106.5 464H35.8L200.7 275.5 26.8 48H172.4L272.9 180.9 389.2 48zM364.4 421.8h39.1L151.1 88h-42L364.4 421.8z"></path></svg><span>X/Twitter</span></a></li><li class="social-item social-reddit"><a rel="me" itemProp="url" eventCategory="social" eventAction="click" eventLabel="reddit" href="https://www.reddit.com/user/ScoreApprehensive992/" title="Saifeddine Rajhi on Reddit" target="blank"><svg aria-hidden="true" focusable="false" data-prefix="fab" data-icon="reddit-alien" class="svg-inline--fa fa-reddit-alien fa-beat fa-2x " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M373 138.6c-25.2 0-46.3-17.5-51.9-41l0 0c-30.6 4.3-54.2 30.7-54.2 62.4l0 .2c47.4 1.8 90.6 15.1 124.9 36.3c12.6-9.7 28.4-15.5 45.5-15.5c41.3 0 74.7 33.4 74.7 74.7c0 29.8-17.4 55.5-42.7 67.5c-2.4 86.8-97 156.6-213.2 156.6S45.5 410.1 43 323.4C17.6 311.5 0 285.7 0 255.7c0-41.3 33.4-74.7 74.7-74.7c17.2 0 33 5.8 45.7 15.6c34-21.1 76.8-34.4 123.7-36.4l0-.3c0-44.3 33.7-80.9 76.8-85.5C325.8 50.2 347.2 32 373 32c29.4 0 53.3 23.9 53.3 53.3s-23.9 53.3-53.3 53.3zM157.5 255.3c-20.9 0-38.9 20.8-40.2 47.9s17.1 38.1 38 38.1s36.6-9.8 37.8-36.9s-14.7-49.1-35.7-49.1zM395 303.1c-1.2-27.1-19.2-47.9-40.2-47.9s-36.9 22-35.7 49.1c1.2 27.1 16.9 36.9 37.8 36.9s39.3-11 38-38.1zm-60.1 70.8c1.5-3.6-1-7.7-4.9-8.1c-23-2.3-47.9-3.6-73.8-3.6s-50.8 1.3-73.8 3.6c-3.9 .4-6.4 4.5-4.9 8.1c12.9 30.8 43.3 52.4 78.7 52.4s65.8-21.6 78.7-52.4z"></path></svg><span>Reddit</span></a></li><li class="social-item social-stackoverflow"><a rel="me" itemProp="url" eventCategory="social" eventAction="click" eventLabel="StackOverflow" href="https://stackoverflow.com/users/21897244/saifeddine-rajhi" title="Saifeddine Rajhi on StackOverflow" target="blank"><svg aria-hidden="true" focusable="false" data-prefix="fab" data-icon="stack-overflow" class="svg-inline--fa fa-stack-overflow fa-beat fa-2x " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512"><path fill="currentColor" d="M290.7 311L95 269.7 86.8 309l195.7 41zm51-87L188.2 95.7l-25.5 30.8 153.5 128.3zm-31.2 39.7L129.2 179l-16.7 36.5L293.7 300zM262 32l-32 24 119.3 160.3 32-24zm20.5 328h-200v39.7h200zm39.7 80H42.7V320h-40v160h359.5V320h-40z"></path></svg><span>StackOverflow</span></a></li><li class="social-item social-Goodreads"><a rel="me" eventLabel="StackOverflow" href="https://www.goodreads.com/user/show/176103378-saifeddine" title="Saifeddine Rajhi on Goodreads" target="blank"><svg aria-hidden="true" focusable="false" data-prefix="fab" data-icon="goodreads" class="svg-inline--fa fa-goodreads fa-beat fa-2x " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M299.9 191.2c5.1 37.3-4.7 79-35.9 100.7-22.3 15.5-52.8 14.1-70.8 5.7-37.1-17.3-49.5-58.6-46.8-97.2 4.3-60.9 40.9-87.9 75.3-87.5 46.9-.2 71.8 31.8 78.2 78.3zM448 88v336c0 30.9-25.1 56-56 56H56c-30.9 0-56-25.1-56-56V88c0-30.9 25.1-56 56-56h336c30.9 0 56 25.1 56 56zM330 313.2s-.1-34-.1-217.3h-29v40.3c-.8.3-1.2-.5-1.6-1.2-9.6-20.7-35.9-46.3-76-46-51.9.4-87.2 31.2-100.6 77.8-4.3 14.9-5.8 30.1-5.5 45.6 1.7 77.9 45.1 117.8 112.4 115.2 28.9-1.1 54.5-17 69-45.2.5-1 1.1-1.9 1.7-2.9.2.1.4.1.6.2.3 3.8.2 30.7.1 34.5-.2 14.8-2 29.5-7.2 43.5-7.8 21-22.3 34.7-44.5 39.5-17.8 3.9-35.6 3.8-53.2-1.2-21.5-6.1-36.5-19-41.1-41.8-.3-1.6-1.3-1.3-2.3-1.3h-26.8c.8 10.6 3.2 20.3 8.5 29.2 24.2 40.5 82.7 48.5 128.2 37.4 49.9-12.3 67.3-54.9 67.4-106.3z"></path></svg><span>Goodreads</span></a></li><li class="social-item social-osi"><a rel="me" itemProp="url" eventCategory="social" eventAction="click" eventLabel="StackOverflow" href="https://ossinsight.io/analyze/seifrajhi" title="Saifeddine Rajhi on OSSInsights" target="blank"><svg aria-hidden="true" focusable="false" data-prefix="fab" data-icon="osi" class="svg-inline--fa fa-osi fa-beat fa-2x " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M8 266.44C10.3 130.64 105.4 34 221.8 18.34c138.8-18.6 255.6 75.8 278 201.1 21.3 118.8-44 230-151.6 274-9.3 3.8-14.4 1.7-18-7.7q-26.7-69.45-53.4-139c-3.1-8.1-1-13.2 7-16.8 24.2-11 39.3-29.4 43.3-55.8a71.47 71.47 0 0 0-64.5-82.2c-39-3.4-71.8 23.7-77.5 59.7-5.2 33 11.1 63.7 41.9 77.7 9.6 4.4 11.5 8.6 7.8 18.4q-26.85 69.9-53.7 139.9c-2.6 6.9-8.3 9.3-15.5 6.5-52.6-20.3-101.4-61-130.8-119-24.9-49.2-25.2-87.7-26.8-108.7zm20.9-1.9c.4 6.6.6 14.3 1.3 22.1 6.3 71.9 49.6 143.5 131 183.1 3.2 1.5 4.4.8 5.6-2.3q22.35-58.65 45-117.3c1.3-3.3.6-4.8-2.4-6.7-31.6-19.9-47.3-48.5-45.6-86 1-21.6 9.3-40.5 23.8-56.3 30-32.7 77-39.8 115.5-17.6a91.64 91.64 0 0 1 45.2 90.4c-3.6 30.6-19.3 53.9-45.7 69.8-2.7 1.6-3.5 2.9-2.3 6q22.8 58.8 45.2 117.7c1.2 3.1 2.4 3.8 5.6 2.3 35.5-16.6 65.2-40.3 88.1-72 34.8-48.2 49.1-101.9 42.3-161-13.7-117.5-119.4-214.8-255.5-198-106.1 13-195.3 102.5-197.1 225.8z"></path></svg><span>OSSInsights</span></a></li><li class="social-item social-devstats"><a rel="me" itemProp="url" eventCategory="social" eventAction="click" eventLabel="StackOverflow" href="https://devstats.cluster.fun/?user=seifrajhi" title="Saifeddine Rajhi on DevStats" target="blank"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="chart-line" class="svg-inline--fa fa-chart-line fa-beat fa-2x " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M64 64c0-17.7-14.3-32-32-32S0 46.3 0 64L0 400c0 44.2 35.8 80 80 80l400 0c17.7 0 32-14.3 32-32s-14.3-32-32-32L80 416c-8.8 0-16-7.2-16-16L64 64zm406.6 86.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0L320 210.7l-57.4-57.4c-12.5-12.5-32.8-12.5-45.3 0l-112 112c-12.5 12.5-12.5 32.8 0 45.3s32.8 12.5 45.3 0L240 221.3l57.4 57.4c12.5 12.5 32.8 12.5 45.3 0l128-128z"></path></svg><span>DevStats</span></a></li><li class="social-item social-RSS"><a rel="me" itemProp="url" eventCategory="social" eventAction="click" eventLabel="RSS" href="https://seifrajhi.github.io/rss.xml" title="Subscribe to my blog post" target="blank"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="rss" class="svg-inline--fa fa-rss fa-beat fa-2x " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M0 64C0 46.3 14.3 32 32 32c229.8 0 416 186.2 416 416c0 17.7-14.3 32-32 32s-32-14.3-32-32C384 253.6 226.4 96 32 96C14.3 96 0 81.7 0 64zM0 416a64 64 0 1 1 128 0A64 64 0 1 1 0 416zM32 160c159.1 0 288 128.9 288 288c0 17.7-14.3 32-32 32s-32-14.3-32-32c0-123.7-100.3-224-224-224c-17.7 0-32-14.3-32-32s14.3-32 32-32z"></path></svg><span>RSS</span></a></li></ul></div><div class="copyright">Saifeddine Rajhi ¬© 1994 - <!-- -->2025<!-- --> <br/><a rel="license" href="https://creativecommons.org/licenses/by/4.0/" title="Content is published under CC BY 4.0 license">CC BY 4.0</a></div><div class="pgp"><a href="https://keybase.io/saifrajhi">0C3B BABB 8BC1 EA2B</a></div></div></footer></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/blog/monitoring-coredns-dns-performance/";/*]]>*/</script><!-- slice-start id="_gatsby-scripts-1" -->
          <script
            id="gatsby-chunk-mapping"
          >
            window.___chunkMapping="{\"app\":[\"/app-2f4f174b7ccfc9183c7b.js\"],\"component---cache-caches-gatsby-plugin-offline-app-shell-js\":[\"/component---cache-caches-gatsby-plugin-offline-app-shell-js-88fb5c28d68e831e730a.js\"],\"component---src-pages-404-tsx\":[\"/component---src-pages-404-tsx-a0e3d27d11d1ae18e8f0.js\"],\"component---src-pages-blog-js\":[\"/component---src-pages-blog-js-ebba4d9aefd856068672.js\"],\"component---src-pages-cv-platform-engineer-js\":[\"/component---src-pages-cv-platform-engineer-js-6b113f68e4ef180c17b2.js\"],\"component---src-pages-index-tsx\":[\"/component---src-pages-index-tsx-cca2029691d058282d40.js\"],\"component---src-pages-talks-js\":[\"/component---src-pages-talks-js-d3fd645d0085de17a5e9.js\"],\"component---src-pages-thoughts-js\":[\"/component---src-pages-thoughts-js-0950be014b397a2b3d9c.js\"],\"component---src-templates-blog-template-js\":[\"/component---src-templates-blog-template-js-8b499d4855ef1cb13add.js\"],\"component---src-templates-talk-template-js\":[\"/component---src-templates-talk-template-js-7623845caf43043e0341.js\"],\"component---src-templates-thought-template-js\":[\"/component---src-templates-thought-template-js-b8bdd67706c6a1d2873c.js\"]}";
          </script>
        <script>window.___webpackCompilationHash="eaddde9f0729f628bfa3";</script><script src="/webpack-runtime-7456f0bc58205084e1e1.js" async></script><script src="/framework-580c5b11fe009445c659.js" async></script><script src="/app-2f4f174b7ccfc9183c7b.js" async></script><!-- slice-end id="_gatsby-scripts-1" --></body></html>