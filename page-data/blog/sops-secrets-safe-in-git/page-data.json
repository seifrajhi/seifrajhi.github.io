{"componentChunkName":"component---src-templates-blog-template-js","path":"/blog/sops-secrets-safe-in-git/","result":{"data":{"markdownRemark":{"html":"<blockquote>\n<p><strong>SOPS: A foolproof way to keep your secrets safe üî•</strong></p>\n</blockquote>\n<h2 id=\"-introduction\" style=\"position:relative;\"><a href=\"#-introduction\" aria-label=\" introduction permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üìö Introduction</h2>\n<p>Secrets are a fact of life in the world of DevOps. We use them to access servers, databases, and other sensitive resources. But storing secrets in plain text is a security risk. If your secrets are compromised, an attacker could gain access to your systems and data.</p>\n<p>SOPS is a tool that helps you store your secrets securely in Git. It encrypts your secrets using a key that is stored in a separate file. This way, your secrets are never stored in plain text, even in your Git repository.</p>\n<p>In this blog post, I will show you how to use SOPS to keep your secrets safe.</p>\n<p><span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 66.47058823529413%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAANABQDASIAAhEBAxEB/8QAFwAAAwEAAAAAAAAAAAAAAAAAAAMEAv/EABUBAQEAAAAAAAAAAAAAAAAAAAID/9oADAMBAAIQAxAAAAFuKlKchWOX/8QAGBAAAwEBAAAAAAAAAAAAAAAAAAExEkH/2gAIAQEAAQUCjphjR0//xAAXEQEAAwAAAAAAAAAAAAAAAAAAAQIS/9oACAEDAQE/AZYq/8QAFhEBAQEAAAAAAAAAAAAAAAAAAAER/9oACAECAQE/AW1//8QAFhAAAwAAAAAAAAAAAAAAAAAAABEg/9oACAEBAAY/AhT/AP/EABgQAAMBAQAAAAAAAAAAAAAAAAABMRFR/9oACAEBAAE/IVwLdDQ4aGWaf//aAAwDAQACAAMAAAAQB8//xAAZEQADAAMAAAAAAAAAAAAAAAAAAREhMUH/2gAIAQMBAT8QwU4O22f/xAAWEQEBAQAAAAAAAAAAAAAAAAAAAVH/2gAIAQIBAT8Qmov/xAAaEAEAAwEBAQAAAAAAAAAAAAABABExIWFR/9oACAEBAAE/EKoi7p5GgimJ8iY6heL8iCjjnIozJ//Z'); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"Alt text\" title=\"\" src=\"/static/f7781eb9ab87898c67b9247d67094aab/7bf67/sops.jpg\" srcset=\"/static/f7781eb9ab87898c67b9247d67094aab/651be/sops.jpg 170w,\n/static/f7781eb9ab87898c67b9247d67094aab/d30a3/sops.jpg 340w,\n/static/f7781eb9ab87898c67b9247d67094aab/7bf67/sops.jpg 680w,\n/static/f7781eb9ab87898c67b9247d67094aab/4b190/sops.jpg 800w\" sizes=\"(max-width: 680px) 100vw, 680px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n    </span>\n          </p>\n<h2 id=\"Ô∏è-traditional-secret-storage\" style=\"position:relative;\"><a href=\"#%EF%B8%8F-traditional-secret-storage\" aria-label=\"Ô∏è traditional secret storage permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üèõÔ∏è Traditional Secret Storage</h2>\n<p>Traditionally, secrets are stored in a separate, secure location, such as <a href=\"https://www.vaultproject.io/\" target=\"_blank\" rel=\"noopener noreferrer\">Hashicorp Vault</a>, <a href=\"https://docs.aws.amazon.com/secretsmanager/latest/userguide/intro.html\" target=\"_blank\" rel=\"noopener noreferrer\">AWS Secrets Manager</a>, <a href=\"https://cloud.google.com/security-key-management\" target=\"_blank\" rel=\"noopener noreferrer\">GCP KMS</a>, <a href=\"https://learn.microsoft.com/en-us/azure/key-vault/general/basic-concepts\" target=\"_blank\" rel=\"noopener noreferrer\">Azure Key Vault</a>, and well-known credential storages like <a href=\"https://1password.com/\" target=\"_blank\" rel=\"noopener noreferrer\">1Password</a>. This has the advantage of isolating the secrets from the code that references them. However, it also introduces an extra step: the code must fetch the secret value from the vault or credential manager before it can use it. This can be a security risk, as it exposes the secret value to the code for a brief period of time.</p>\n<h2 id=\"-sops\" style=\"position:relative;\"><a href=\"#-sops\" aria-label=\" sops permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üîê SOPS</h2>\n<p><a href=\"https://github.com/getsops/sops\" target=\"_blank\" rel=\"noopener noreferrer\">SOPS</a> offers a simplified version of secret storage. With SOPS, the secret values are directly stored in the code, and they are encrypted using a key that is stored in a separate file. This way, the secret values are never stored in plain text, even in the code. To decrypt the secret values, the code must use the key file. This eliminates the need to fetch the secret values from a vault or credential manager, which reduces the security risk.</p>\n<p>SOPS supports a variety of encryption methods, including AWS KMS, PGP, GCP KMS, Azure Key Vault, HashiCorp Key Vault, and <a href=\"https://github.com/FiloSottile/age\" target=\"_blank\" rel=\"noopener noreferrer\">age</a>. This makes it a flexible and versatile tool that can be used to store secrets in a variety of environments.</p>\n<h2 id=\"Ô∏è-a-step-by-step-guide-to-using-sops\" style=\"position:relative;\"><a href=\"#%EF%B8%8F-a-step-by-step-guide-to-using-sops\" aria-label=\"Ô∏è a step by step guide to using sops permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üõ†Ô∏è A Step-by-Step Guide to Using SOPS</h2>\n<p>In this section, we will deploy a sample chart to a Kubernetes cluster using <a href=\"https://helm.sh/\" target=\"_blank\" rel=\"noopener noreferrer\">Helm</a> (Helmfile) and AWS KMS.</p>\n<h3 id=\"-helm-helmfile\" style=\"position:relative;\"><a href=\"#-helm-helmfile\" aria-label=\" helm helmfile permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üì¶ Helm (Helmfile)</h3>\n<p><a href=\"https://helm.sh/\" target=\"_blank\" rel=\"noopener noreferrer\">Helm</a> is a package manager for Kubernetes. It allows you to deploy and manage Kubernetes applications. <a href=\"https://github.com/helmfile/helmfile\" target=\"_blank\" rel=\"noopener noreferrer\">Helmfile</a> is a tool that helps you manage Helm charts.</p>\n<h3 id=\"-sops-1\" style=\"position:relative;\"><a href=\"#-sops-1\" aria-label=\" sops 1 permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üîê SOPS</h3>\n<p><a href=\"https://github.com/getsops/sops\" target=\"_blank\" rel=\"noopener noreferrer\">SOPS</a> is a tool that helps you encrypt and decrypt secrets using a variety of encryption methods, including AWS KMS.</p>\n<h3 id=\"-aws-kms-key\" style=\"position:relative;\"><a href=\"#-aws-kms-key\" aria-label=\" aws kms key permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üîë AWS KMS Key</h3>\n<p><a href=\"https://aws.amazon.com/kms/\" target=\"_blank\" rel=\"noopener noreferrer\">AWS KMS</a> is a key management service that allows you to create and manage encryption keys. You can use AWS KMS to encrypt secrets that you want to store in your Kubernetes cluster.</p>\n<p>Here are the reference code and a few Terraform templates to create KMS and IAM resources. I also added a walkthrough for Terraform <a href=\"https://github.com/seifrajhi/sops-secrets-blog\" target=\"_blank\" rel=\"noopener noreferrer\">here</a>.</p>\n<h3 id=\"-deployment-steps\" style=\"position:relative;\"><a href=\"#-deployment-steps\" aria-label=\" deployment steps permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üöÄ Deployment Steps</h3>\n<p>To deploy the sample httpbin app in your Kubernetes cluster, you can use the following steps:</p>\n<ol>\n<li>\n<p><strong>Clone the repository:</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token function\">git</span> clone https://github.com/seifrajhi/sops-secrets-blog</code></pre></div>\n</li>\n<li>\n<p><strong>Change the directory to the helmfile directory:</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token builtin class-name\">cd</span> sops-secrets-blog/helmfile/</code></pre></div>\n</li>\n<li>\n<p><strong>Deploy the httpbin app using Helmfile:</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">helmfile <span class=\"token parameter variable\">-e</span> sops-poc apply</code></pre></div>\n<p>This will deploy the httpbin app in your Kubernetes environment, including a pod, a service, a service account, and a secret.</p>\n</li>\n<li>\n<p><strong>Examine the environment variables in the newly created pod:</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">kubectl get pods <span class=\"token parameter variable\">-o</span> wide</code></pre></div>\n<p>This will show you the environment variables that are set for the pod, including the <code class=\"language-text\">FIRST_VAR</code> and <code class=\"language-text\">SECOND_VAR</code> variables. We will use this information in a later step.</p>\n</li>\n</ol>\n<h2 id=\"-the-real-deal-managing-secrets-with-helmfile\" style=\"position:relative;\"><a href=\"#-the-real-deal-managing-secrets-with-helmfile\" aria-label=\" the real deal managing secrets with helmfile permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üîë The Real Deal: Managing Secrets with Helmfile</h2>\n<p>Now, let's talk about secrets. Helmfile supports secrets by using the <code class=\"language-text\">helm-secrets</code> plugin. This plugin allows you to manage and inject sensitive information into a given release's values.</p>\n<p>However, there is a caveat: the secret values will be shown in plain text in the <code class=\"language-text\">helmfile diff</code> or <code class=\"language-text\">helmfile apply</code> outputs. This is not ideal, as it could expose sensitive information to unauthorized users.</p>\n<p>Fortunately, there is a workaround for this. You can use the <code class=\"language-text\">helm-secrets</code> plugin to encrypt your secrets before storing them in Helmfile. This plugin will decrypt the secrets when Helmfile deploys the release, but the secret values will not be shown in plain text in the <code class=\"language-text\">helmfile diff</code> or <code class=\"language-text\">helmfile apply</code> outputs.</p>\n<p>To learn more about how to use the <code class=\"language-text\">helm-secrets</code> plugin, please refer to the <a href=\"https://github.com/jkroepke/helm-secrets\" target=\"_blank\" rel=\"noopener noreferrer\">helm-secrets GitHub repository</a>.</p>\n<h3 id=\"-installing-code-classlanguage-texthelm-secretscode\" style=\"position:relative;\"><a href=\"#-installing-code-classlanguage-texthelm-secretscode\" aria-label=\" installing code classlanguage texthelm secretscode permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üì• Installing <code class=\"language-text\">helm-secrets</code></h3>\n<p>To use the <code class=\"language-text\">helm-secrets</code> plugin, you will need to install it first. You can do this by running the following command:</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">helm plugin <span class=\"token function\">install</span> https://github.com/jkroepke/helm-secrets</code></pre></div>\n<p>This will install the <code class=\"language-text\">helm-secrets</code> plugin in your local Helm installation. Once the plugin is installed, you can use it to encrypt and decrypt secrets in your Helmfile manifests.</p>\n<h3 id=\"-installing-sops\" style=\"position:relative;\"><a href=\"#-installing-sops\" aria-label=\" installing sops permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üîê Installing SOPS</h3>\n<p>To install SOPS, you can use the following command:</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">brew <span class=\"token function\">install</span> sops</code></pre></div>\n<p>Once SOPS is installed, you can use it to encrypt and decrypt files.</p>\n<h3 id=\"Ô∏è-configuring-sops\" style=\"position:relative;\"><a href=\"#%EF%B8%8F-configuring-sops\" aria-label=\"Ô∏è configuring sops permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üõ†Ô∏è Configuring SOPS</h3>\n<p>To use SOPS, you need to create a <code class=\"language-text\">.sops.yaml</code> configuration file. This file tells SOPS what files to encrypt and how to encrypt them. The following is an example of a <code class=\"language-text\">.sops.yaml</code> configuration file:</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">creation_rules</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">path_regex</span><span class=\"token punctuation\">:</span> \\.yaml$\n        <span class=\"token key atrule\">kms</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'arn:of:your:kms:key'</span></code></pre></div>\n<p>This configuration file tells SOPS to encrypt any file that ends in <code class=\"language-text\">.yaml</code> using the KMS key with the ARN <code class=\"language-text\">arn:of:your:kms:key</code>.</p>\n<p>You can create the <code class=\"language-text\">.sops.yaml</code> file anywhere in your filesystem. SOPS will look for it in the current directory by default, but you can also specify the path to the file using the <code class=\"language-text\">-c</code> flag.</p>\n<h3 id=\"-creating-and-encrypting-secrets\" style=\"position:relative;\"><a href=\"#-creating-and-encrypting-secrets\" aria-label=\" creating and encrypting secrets permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üîè Creating and Encrypting Secrets</h3>\n<p>To create the <code class=\"language-text\">secrets.yaml</code> file, you can use the following command:</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">sops secrets.yaml</code></pre></div>\n<p>This will open a text editor with prefilled sample values. Replace the content with the following:</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">my_var</span><span class=\"token punctuation\">:</span> a top secret value\n<span class=\"token key atrule\">my_other_var</span><span class=\"token punctuation\">:</span> not that sensitive<span class=\"token punctuation\">,</span> but still please don't tell anyone<span class=\"token tag\">!</span></code></pre></div>\n<p>When you save and close the file, SOPS will encrypt it automatically. You can then open the file and have a look at its content. SOPS will have added metadata to the file, including the KMS ARN that was used to encrypt the file, a timestamp, and some other information.</p>\n<h3 id=\"-adding-secrets-to-helmfile\" style=\"position:relative;\"><a href=\"#-adding-secrets-to-helmfile\" aria-label=\" adding secrets to helmfile permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üìÑ Adding Secrets to Helmfile</h3>\n<p>Now, it's time to add the secrets to the Helmfile manifest. To do this, you need to add a <code class=\"language-text\">secrets:</code> section to the release in the <code class=\"language-text\">helmfile.yaml</code> file. The following is an example of how to do this:</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">bases</span><span class=\"token punctuation\">:</span>\n<span class=\"token punctuation\">-</span> environments.yaml\n\n<span class=\"token key atrule\">releases</span><span class=\"token punctuation\">:</span>\n<span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> example<span class=\"token punctuation\">-</span>release\n    <span class=\"token key atrule\">namespace</span><span class=\"token punctuation\">:</span> example<span class=\"token punctuation\">-</span>ns\n    <span class=\"token key atrule\">labels</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">app</span><span class=\"token punctuation\">:</span> example\n    <span class=\"token key atrule\">values</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> values.yaml.gotmpl\n    <span class=\"token key atrule\">secrets</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> secrets.yaml\n    <span class=\"token key atrule\">chart</span><span class=\"token punctuation\">:</span> ./charts/httpbin</code></pre></div>\n<p>As a result of adding the <code class=\"language-text\">secrets:</code> section to the release in the <code class=\"language-text\">helmfile.yaml</code> file, Helmfile will merge the <code class=\"language-text\">values.yaml</code> and <code class=\"language-text\">secrets.yaml</code> files as one and then use it to populate the templates in the <code class=\"language-text\">charts/httpbin/templates/</code> directory when deploying the release.</p>\n<h3 id=\"-modifying-deployment-template\" style=\"position:relative;\"><a href=\"#-modifying-deployment-template\" aria-label=\" modifying deployment template permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üìù Modifying Deployment Template</h3>\n<p>To make use of the new secrets, you need to modify the deployment template in the <code class=\"language-text\">charts/httpbin/templates/deployment.yaml</code> file. The following is an example of how to do this:</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> apps/v1\n<span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> Deployment\n<span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> .Values.name <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\n<span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">replicas</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> .Values.replicas <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\n    <span class=\"token key atrule\">selector</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">matchLabels</span><span class=\"token punctuation\">:</span>\n            <span class=\"token key atrule\">app</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> .Values.name <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\n            <span class=\"token key atrule\">version</span><span class=\"token punctuation\">:</span> v1\n    <span class=\"token key atrule\">template</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n            <span class=\"token key atrule\">labels</span><span class=\"token punctuation\">:</span>\n                <span class=\"token key atrule\">app</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> .Values.name <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\n                <span class=\"token key atrule\">version</span><span class=\"token punctuation\">:</span> v1\n        <span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span>\n            <span class=\"token key atrule\">serviceAccountName</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> .Values.name <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\n            <span class=\"token key atrule\">containers</span><span class=\"token punctuation\">:</span>\n            <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> docker.io/kong/httpbin\n                <span class=\"token key atrule\">imagePullPolicy</span><span class=\"token punctuation\">:</span> IfNotPresent\n                <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> .Values.name <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\n                <span class=\"token key atrule\">ports</span><span class=\"token punctuation\">:</span>\n                <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">containerPort</span><span class=\"token punctuation\">:</span> <span class=\"token number\">80</span>\n                <span class=\"token key atrule\">env</span><span class=\"token punctuation\">:</span>\n                <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> FIRST_VAR\n                    <span class=\"token key atrule\">value</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> .Values.my_var <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\n                <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> SECOND_VAR\n                    <span class=\"token key atrule\">value</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> .Values.my_other_var <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span></code></pre></div>\n<h3 id=\"-verifying-changes\" style=\"position:relative;\"><a href=\"#-verifying-changes\" aria-label=\" verifying changes permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üîç Verifying Changes</h3>\n<p>If we check what Helmfile does, you can run the below command:</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">helmfile <span class=\"token parameter variable\">-e</span> sops-poc <span class=\"token function\">diff</span></code></pre></div>\n<p>Now the values are effectively taken from a Kubernetes secret instead of directly from secrets defined in the Helmfile release.</p>\n<p>Go ahead and run <code class=\"language-text\">helmfile -e sops-poc apply</code> to deploy the changes.</p>\n<h3 id=\"-updating-secrets\" style=\"position:relative;\"><a href=\"#-updating-secrets\" aria-label=\" updating secrets permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üîÑ Updating Secrets</h3>\n<p>Let's now modify <code class=\"language-text\">secrets.yaml</code> values:</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">sops secrets.yaml</code></pre></div>\n<p>I removed random characters from both <code class=\"language-text\">my_var</code> and <code class=\"language-text\">my_other_var</code> in <code class=\"language-text\">secrets.yaml</code>, it doesn't really matter the change, it is just an example. Save and close the file to have SOPS re-encrypt it.</p>\n<p>And now if you see what Helmfile tries to do, you will find that there are no secrets shown in plain text anymore! üéâ</p>\n<h2 id=\"-conclusion\" style=\"position:relative;\"><a href=\"#-conclusion\" aria-label=\" conclusion permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üîè Conclusion</h2>\n<p>In this blog post, we discussed SOPS, a tool that can be used to encrypt and decrypt secrets in Git. We also discussed the benefits of using SOPS, and how it can help to keep your secrets safe.</p>\n<p>SOPS is a powerful tool that can be used to encrypt a wide variety of secrets, including passwords, API keys, and SSH keys. SOPS uses a variety of encryption methods, including AES-256, RSA-2048, and Ed25519. This makes it very difficult for attackers to decrypt SOPS-encrypted secrets.</p>\n<p>SOPS also supports a variety of key management options, including KMS, HashiCorp Vault, and AWS Secrets Manager. This makes it easy to store and manage your SOPS keys in a secure manner.</p>\n<p>By using SOPS, you can be sure that your secrets are safe in Git. SOPS is a foolproof way to keep your secrets safe.</p>\n<br>\n<p><strong><em>Until next time, „Å§„Å•„Åè üéâ</em></strong></p>\n<blockquote>\n<p>üí° Thank you for Reading !! üôåüèªüòÅüìÉ, see you in the next blog.ü§ò  <em><strong>Until next time üéâ</strong></em></p>\n</blockquote>\n<p>üöÄ Thank you for sticking up till the end. If you have any questions/feedback regarding this blog feel free to connect with me:</p>\n<p><strong>‚ôªÔ∏è LinkedIn:</strong> <a href=\"https://www.linkedin.com/in/rajhi-saif/\" target=\"_blank\" rel=\"noopener noreferrer\">https://www.linkedin.com/in/rajhi-saif/</a></p>\n<p><strong>‚ôªÔ∏è X/Twitter:</strong> <a href=\"https://x.com/rajhisaifeddine\" target=\"_blank\" rel=\"noopener noreferrer\">https://x.com/rajhisaifeddine</a></p>\n<p><strong>The end ‚úåüèª</strong></p>\n<h1 align=\"center\">üî∞ Keep Learning !! Keep Sharing !! üî∞</h1>\n<p><strong>üìÖ Stay updated</strong></p>\n<p>Subscribe to our newsletter for more insights on AWS cloud computing and containers.</p>","timeToRead":6,"rawMarkdownBody":"\n> **SOPS: A foolproof way to keep your secrets safe üî•**\n\n## üìö Introduction\n\nSecrets are a fact of life in the world of DevOps. We use them to access servers, databases, and other sensitive resources. But storing secrets in plain text is a security risk. If your secrets are compromised, an attacker could gain access to your systems and data.\n\nSOPS is a tool that helps you store your secrets securely in Git. It encrypts your secrets using a key that is stored in a separate file. This way, your secrets are never stored in plain text, even in your Git repository.\n\nIn this blog post, I will show you how to use SOPS to keep your secrets safe.\n\n![Alt text](./sops.jpg)\n\n## üèõÔ∏è Traditional Secret Storage\n\nTraditionally, secrets are stored in a separate, secure location, such as [Hashicorp Vault](https://www.vaultproject.io/), [AWS Secrets Manager](https://docs.aws.amazon.com/secretsmanager/latest/userguide/intro.html), [GCP KMS](https://cloud.google.com/security-key-management), [Azure Key Vault](https://learn.microsoft.com/en-us/azure/key-vault/general/basic-concepts), and well-known credential storages like [1Password](https://1password.com/). This has the advantage of isolating the secrets from the code that references them. However, it also introduces an extra step: the code must fetch the secret value from the vault or credential manager before it can use it. This can be a security risk, as it exposes the secret value to the code for a brief period of time.\n\n## üîê SOPS\n\n[SOPS](https://github.com/getsops/sops) offers a simplified version of secret storage. With SOPS, the secret values are directly stored in the code, and they are encrypted using a key that is stored in a separate file. This way, the secret values are never stored in plain text, even in the code. To decrypt the secret values, the code must use the key file. This eliminates the need to fetch the secret values from a vault or credential manager, which reduces the security risk.\n\nSOPS supports a variety of encryption methods, including AWS KMS, PGP, GCP KMS, Azure Key Vault, HashiCorp Key Vault, and [age](https://github.com/FiloSottile/age). This makes it a flexible and versatile tool that can be used to store secrets in a variety of environments.\n\n## üõ†Ô∏è A Step-by-Step Guide to Using SOPS\n\nIn this section, we will deploy a sample chart to a Kubernetes cluster using [Helm](https://helm.sh/) (Helmfile) and AWS KMS.\n\n### üì¶ Helm (Helmfile)\n\n[Helm](https://helm.sh/) is a package manager for Kubernetes. It allows you to deploy and manage Kubernetes applications. [Helmfile](https://github.com/helmfile/helmfile) is a tool that helps you manage Helm charts.\n\n### üîê SOPS\n\n[SOPS](https://github.com/getsops/sops) is a tool that helps you encrypt and decrypt secrets using a variety of encryption methods, including AWS KMS.\n\n### üîë AWS KMS Key\n\n[AWS KMS](https://aws.amazon.com/kms/) is a key management service that allows you to create and manage encryption keys. You can use AWS KMS to encrypt secrets that you want to store in your Kubernetes cluster.\n\nHere are the reference code and a few Terraform templates to create KMS and IAM resources. I also added a walkthrough for Terraform [here](https://github.com/seifrajhi/sops-secrets-blog).\n\n### üöÄ Deployment Steps\n\nTo deploy the sample httpbin app in your Kubernetes cluster, you can use the following steps:\n\n1. **Clone the repository:**\n\n    ```shell\n    git clone https://github.com/seifrajhi/sops-secrets-blog\n    ```\n\n2. **Change the directory to the helmfile directory:**\n\n    ```shell\n    cd sops-secrets-blog/helmfile/\n    ```\n\n3. **Deploy the httpbin app using Helmfile:**\n\n    ```shell\n    helmfile -e sops-poc apply\n    ```\n\n    This will deploy the httpbin app in your Kubernetes environment, including a pod, a service, a service account, and a secret.\n\n4. **Examine the environment variables in the newly created pod:**\n\n    ```shell\n    kubectl get pods -o wide\n    ```\n\n    This will show you the environment variables that are set for the pod, including the `FIRST_VAR` and `SECOND_VAR` variables. We will use this information in a later step.\n\n## üîë The Real Deal: Managing Secrets with Helmfile\n\nNow, let's talk about secrets. Helmfile supports secrets by using the `helm-secrets` plugin. This plugin allows you to manage and inject sensitive information into a given release's values.\n\nHowever, there is a caveat: the secret values will be shown in plain text in the `helmfile diff` or `helmfile apply` outputs. This is not ideal, as it could expose sensitive information to unauthorized users.\n\nFortunately, there is a workaround for this. You can use the `helm-secrets` plugin to encrypt your secrets before storing them in Helmfile. This plugin will decrypt the secrets when Helmfile deploys the release, but the secret values will not be shown in plain text in the `helmfile diff` or `helmfile apply` outputs.\n\nTo learn more about how to use the `helm-secrets` plugin, please refer to the [helm-secrets GitHub repository](https://github.com/jkroepke/helm-secrets).\n\n### üì• Installing `helm-secrets`\n\nTo use the `helm-secrets` plugin, you will need to install it first. You can do this by running the following command:\n\n```shell\nhelm plugin install https://github.com/jkroepke/helm-secrets\n```\n\nThis will install the `helm-secrets` plugin in your local Helm installation. Once the plugin is installed, you can use it to encrypt and decrypt secrets in your Helmfile manifests.\n\n### üîê Installing SOPS\n\nTo install SOPS, you can use the following command:\n\n```shell\nbrew install sops\n```\n\nOnce SOPS is installed, you can use it to encrypt and decrypt files.\n\n### üõ†Ô∏è Configuring SOPS\n\nTo use SOPS, you need to create a `.sops.yaml` configuration file. This file tells SOPS what files to encrypt and how to encrypt them. The following is an example of a `.sops.yaml` configuration file:\n\n```yaml\ncreation_rules:\n    - path_regex: \\.yaml$\n        kms: 'arn:of:your:kms:key'\n```\n\nThis configuration file tells SOPS to encrypt any file that ends in `.yaml` using the KMS key with the ARN `arn:of:your:kms:key`.\n\nYou can create the `.sops.yaml` file anywhere in your filesystem. SOPS will look for it in the current directory by default, but you can also specify the path to the file using the `-c` flag.\n\n### üîè Creating and Encrypting Secrets\n\nTo create the `secrets.yaml` file, you can use the following command:\n\n```shell\nsops secrets.yaml\n```\n\nThis will open a text editor with prefilled sample values. Replace the content with the following:\n\n```yaml\nmy_var: a top secret value\nmy_other_var: not that sensitive, but still please don't tell anyone!\n```\n\nWhen you save and close the file, SOPS will encrypt it automatically. You can then open the file and have a look at its content. SOPS will have added metadata to the file, including the KMS ARN that was used to encrypt the file, a timestamp, and some other information.\n\n### üìÑ Adding Secrets to Helmfile\n\nNow, it's time to add the secrets to the Helmfile manifest. To do this, you need to add a `secrets:` section to the release in the `helmfile.yaml` file. The following is an example of how to do this:\n\n```yaml\nbases:\n- environments.yaml\n\nreleases:\n- name: example-release\n    namespace: example-ns\n    labels:\n        app: example\n    values:\n    - values.yaml.gotmpl\n    secrets:\n    - secrets.yaml\n    chart: ./charts/httpbin\n```\n\nAs a result of adding the `secrets:` section to the release in the `helmfile.yaml` file, Helmfile will merge the `values.yaml` and `secrets.yaml` files as one and then use it to populate the templates in the `charts/httpbin/templates/` directory when deploying the release.\n\n### üìù Modifying Deployment Template\n\nTo make use of the new secrets, you need to modify the deployment template in the `charts/httpbin/templates/deployment.yaml` file. The following is an example of how to do this:\n\n```yaml\napiVersion: apps/v1\nkind: Deployment\nmetadata:\n    name: {{ .Values.name }}\nspec:\n    replicas: {{ .Values.replicas }}\n    selector:\n        matchLabels:\n            app: {{ .Values.name }}\n            version: v1\n    template:\n        metadata:\n            labels:\n                app: {{ .Values.name }}\n                version: v1\n        spec:\n            serviceAccountName: {{ .Values.name }}\n            containers:\n            - image: docker.io/kong/httpbin\n                imagePullPolicy: IfNotPresent\n                name: {{ .Values.name }}\n                ports:\n                - containerPort: 80\n                env:\n                - name: FIRST_VAR\n                    value: {{ .Values.my_var }}\n                - name: SECOND_VAR\n                    value: {{ .Values.my_other_var }}\n```\n\n### üîç Verifying Changes\n\nIf we check what Helmfile does, you can run the below command:\n\n```shell\nhelmfile -e sops-poc diff\n```\n\nNow the values are effectively taken from a Kubernetes secret instead of directly from secrets defined in the Helmfile release.\n\nGo ahead and run `helmfile -e sops-poc apply` to deploy the changes.\n\n### üîÑ Updating Secrets\n\nLet's now modify `secrets.yaml` values:\n\n```shell\nsops secrets.yaml\n```\n\nI removed random characters from both `my_var` and `my_other_var` in `secrets.yaml`, it doesn't really matter the change, it is just an example. Save and close the file to have SOPS re-encrypt it.\n\nAnd now if you see what Helmfile tries to do, you will find that there are no secrets shown in plain text anymore! üéâ\n\n## üîè Conclusion\n\nIn this blog post, we discussed SOPS, a tool that can be used to encrypt and decrypt secrets in Git. We also discussed the benefits of using SOPS, and how it can help to keep your secrets safe.\n\nSOPS is a powerful tool that can be used to encrypt a wide variety of secrets, including passwords, API keys, and SSH keys. SOPS uses a variety of encryption methods, including AES-256, RSA-2048, and Ed25519. This makes it very difficult for attackers to decrypt SOPS-encrypted secrets.\n\nSOPS also supports a variety of key management options, including KMS, HashiCorp Vault, and AWS Secrets Manager. This makes it easy to store and manage your SOPS keys in a secure manner.\n\nBy using SOPS, you can be sure that your secrets are safe in Git. SOPS is a foolproof way to keep your secrets safe.\n\n<br>\n\n**_Until next time, „Å§„Å•„Åè üéâ_**\n\n> üí° Thank you for Reading !! üôåüèªüòÅüìÉ, see you in the next blog.ü§ò  _**Until next time üéâ**_\n\nüöÄ Thank you for sticking up till the end. If you have any questions/feedback regarding this blog feel free to connect with me:\n\n**‚ôªÔ∏è LinkedIn:** https://www.linkedin.com/in/rajhi-saif/\n\n**‚ôªÔ∏è X/Twitter:** https://x.com/rajhisaifeddine\n\n**The end ‚úåüèª**\n\n<h1 align=\"center\">üî∞ Keep Learning !! Keep Sharing !! üî∞</h1>\n\n**üìÖ Stay updated**\n\nSubscribe to our newsletter for more insights on AWS cloud computing and containers.\n","wordCount":{"words":1340},"frontmatter":{"id":"c7e60ef3d7a8a8d7e6ebda4a","path":"/blog/sops-secrets-safe-in-git/","humanDate":"Oct 19, 2024","fullDate":"2024-10-19","title":"The SOPS way: The only way to keep your secrets safe in Git","keywords":["SOPS","Git","Secret Management","Cloud Security"],"excerpt":"How to use SOPS to securely manage your secrets in Git. This guide provides a foolproof method to ensure your sensitive information remains protected.","cover":{"childImageSharp":{"gatsbyImageData":{"layout":"fullWidth","placeholder":{"fallback":"data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAPABQDASIAAhEBAxEB/8QAFgABAQEAAAAAAAAAAAAAAAAAAwQA/8QAFgEBAQEAAAAAAAAAAAAAAAAAAgED/9oADAMBAAIQAxAAAAE5yozsGXM//8QAGxAAAgIDAQAAAAAAAAAAAAAAAAEREgIDITL/2gAIAQEAAQUCz18aqokUi81P/8QAFhEBAQEAAAAAAAAAAAAAAAAAAAER/9oACAEDAQE/AY2P/8QAFREBAQAAAAAAAAAAAAAAAAAAEBH/2gAIAQIBAT8Bh//EABoQAAMAAwEAAAAAAAAAAAAAAAABIQIQEZH/2gAIAQEABj8CnGRY+ERBa//EABoQAAMBAQEBAAAAAAAAAAAAAAABESExQVH/2gAIAQEAAT8hnb/TTBcU29F6ZDg4F9hw+n//2gAMAwEAAgADAAAAEMvf/8QAFxEBAAMAAAAAAAAAAAAAAAAAAAERQf/aAAgBAwEBPxCmpH//xAAWEQEBAQAAAAAAAAAAAAAAAAABABH/2gAIAQIBAT8QEWN//8QAGxABAAMBAQEBAAAAAAAAAAAAAQARQSExUWH/2gAIAQEAAT8QBEmMFZbyMHrRYqu9mvGBdMY8xA/ZZwND9lwWN4z/2Q=="},"images":{"fallback":{"src":"/static/aeabb352d32dace336d1faa23144f232/1d8b4/sops-cover.jpg","srcSet":"/static/aeabb352d32dace336d1faa23144f232/1d8b4/sops-cover.jpg 606w","sizes":"100vw"},"sources":[{"srcSet":"/static/aeabb352d32dace336d1faa23144f232/252ef/sops-cover.webp 606w","type":"image/webp","sizes":"100vw"}]},"width":1,"height":0.7491749174917492}}},"coverCredits":"Photo by Saifeddine Rajhi"}}},"pageContext":{"prevThought":{"frontmatter":{"path":"/blog/kubernetes-gateway-api-part2/","title":"Redefining Kubernetes networking with Gateway API: Part 2","date":"2024-10-19 19:06:00"},"excerpt":"Optimizing AWS EKS Networking with Gateway API and VPC Lattice Integration üï∏ üìï Introduction Building upon our exploration of Kubernetes‚Ä¶"},"nextThought":{"frontmatter":{"path":"/blog/kubernetes-gateway-api-part1/","title":"Redefining Kubernetes networking with Gateway API: Part 1","date":"2024-10-19 13:06:00"},"excerpt":"Improving connectivity and security in k8s clusters üï∏ üìï Introduction The core ideas for this Gateway API were initially proposed by Bowei‚Ä¶"}}},"staticQueryHashes":["1271460761","1321585977"],"slicesMap":{}}