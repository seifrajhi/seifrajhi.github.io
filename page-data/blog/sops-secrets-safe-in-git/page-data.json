{"componentChunkName":"component---src-templates-blog-template-js","path":"/blog/sops-secrets-safe-in-git/","result":{"data":{"markdownRemark":{"html":"<blockquote>\n<p><strong>SOPS: A foolproof way to keep your secrets safe 🔥</strong></p>\n</blockquote>\n<h2 id=\"-introduction\" style=\"position:relative;\"><a href=\"#-introduction\" aria-label=\" introduction permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>📚 Introduction</h2>\n<p>Secrets are a fact of life in the world of DevOps. We use them to access servers, databases, and other sensitive resources. But storing secrets in plain text is a security risk. If your secrets are compromised, an attacker could gain access to your systems and data.</p>\n<p>SOPS is a tool that helps you store your secrets securely in Git. It encrypts your secrets using a key that is stored in a separate file. This way, your secrets are never stored in plain text, even in your Git repository.</p>\n<p>In this blog post, I will show you how to use SOPS to keep your secrets safe.</p>\n<p><span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 66.47058823529413%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAANABQDASIAAhEBAxEB/8QAFwAAAwEAAAAAAAAAAAAAAAAAAAMEAv/EABUBAQEAAAAAAAAAAAAAAAAAAAID/9oADAMBAAIQAxAAAAFuKlKchWOX/8QAGBAAAwEBAAAAAAAAAAAAAAAAAAExEkH/2gAIAQEAAQUCjphjR0//xAAXEQEAAwAAAAAAAAAAAAAAAAAAAQIS/9oACAEDAQE/AZYq/8QAFhEBAQEAAAAAAAAAAAAAAAAAAAER/9oACAECAQE/AW1//8QAFhAAAwAAAAAAAAAAAAAAAAAAABEg/9oACAEBAAY/AhT/AP/EABgQAAMBAQAAAAAAAAAAAAAAAAABMRFR/9oACAEBAAE/IVwLdDQ4aGWaf//aAAwDAQACAAMAAAAQB8//xAAYEQADAQEAAAAAAAAAAAAAAAAAARExQf/aAAgBAwEBPxBIpwdtZ//EABYRAQEBAAAAAAAAAAAAAAAAAAABUf/aAAgBAgEBPxCai//EABoQAQADAQEBAAAAAAAAAAAAAAEAETEhYVH/2gAIAQEAAT8QqiLunkaCKYnyJjqF4vyIKOOcijMn/9k='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"Alt text\" title=\"\" src=\"/static/f7781eb9ab87898c67b9247d67094aab/7bf67/sops.jpg\" srcset=\"/static/f7781eb9ab87898c67b9247d67094aab/651be/sops.jpg 170w,\n/static/f7781eb9ab87898c67b9247d67094aab/d30a3/sops.jpg 340w,\n/static/f7781eb9ab87898c67b9247d67094aab/7bf67/sops.jpg 680w,\n/static/f7781eb9ab87898c67b9247d67094aab/4b190/sops.jpg 800w\" sizes=\"(max-width: 680px) 100vw, 680px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n    </span>\n          </p>\n<h2 id=\"️-traditional-secret-storage\" style=\"position:relative;\"><a href=\"#%EF%B8%8F-traditional-secret-storage\" aria-label=\"️ traditional secret storage permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>🏛️ Traditional Secret Storage</h2>\n<p>Traditionally, secrets are stored in a separate, secure location, such as <a href=\"https://www.vaultproject.io/\" target=\"_blank\" rel=\"noopener noreferrer\">Hashicorp Vault</a>, <a href=\"https://docs.aws.amazon.com/secretsmanager/latest/userguide/intro.html\" target=\"_blank\" rel=\"noopener noreferrer\">AWS Secrets Manager</a>, <a href=\"https://cloud.google.com/security-key-management\" target=\"_blank\" rel=\"noopener noreferrer\">GCP KMS</a>, <a href=\"https://learn.microsoft.com/en-us/azure/key-vault/general/basic-concepts\" target=\"_blank\" rel=\"noopener noreferrer\">Azure Key Vault</a>, and well-known credential storages like <a href=\"https://1password.com/\" target=\"_blank\" rel=\"noopener noreferrer\">1Password</a>. This has the advantage of isolating the secrets from the code that references them. However, it also introduces an extra step: the code must fetch the secret value from the vault or credential manager before it can use it. This can be a security risk, as it exposes the secret value to the code for a brief period of time.</p>\n<h2 id=\"-sops\" style=\"position:relative;\"><a href=\"#-sops\" aria-label=\" sops permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>🔐 SOPS</h2>\n<p><a href=\"https://github.com/getsops/sops\" target=\"_blank\" rel=\"noopener noreferrer\">SOPS</a> offers a simplified version of secret storage. With SOPS, the secret values are directly stored in the code, and they are encrypted using a key that is stored in a separate file. This way, the secret values are never stored in plain text, even in the code. To decrypt the secret values, the code must use the key file. This eliminates the need to fetch the secret values from a vault or credential manager, which reduces the security risk.</p>\n<p>SOPS supports a variety of encryption methods, including AWS KMS, PGP, GCP KMS, Azure Key Vault, HashiCorp Key Vault, and <a href=\"https://github.com/FiloSottile/age\" target=\"_blank\" rel=\"noopener noreferrer\">age</a>. This makes it a flexible and versatile tool that can be used to store secrets in a variety of environments.</p>\n<h2 id=\"️-a-step-by-step-guide-to-using-sops\" style=\"position:relative;\"><a href=\"#%EF%B8%8F-a-step-by-step-guide-to-using-sops\" aria-label=\"️ a step by step guide to using sops permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>🛠️ A Step-by-Step Guide to Using SOPS</h2>\n<p>In this section, we will deploy a sample chart to a Kubernetes cluster using <a href=\"https://helm.sh/\" target=\"_blank\" rel=\"noopener noreferrer\">Helm</a> (Helmfile) and AWS KMS.</p>\n<h3 id=\"-helm-helmfile\" style=\"position:relative;\"><a href=\"#-helm-helmfile\" aria-label=\" helm helmfile permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>📦 Helm (Helmfile)</h3>\n<p><a href=\"https://helm.sh/\" target=\"_blank\" rel=\"noopener noreferrer\">Helm</a> is a package manager for Kubernetes. It allows you to deploy and manage Kubernetes applications. <a href=\"https://github.com/helmfile/helmfile\" target=\"_blank\" rel=\"noopener noreferrer\">Helmfile</a> is a tool that helps you manage Helm charts.</p>\n<h3 id=\"-sops-1\" style=\"position:relative;\"><a href=\"#-sops-1\" aria-label=\" sops 1 permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>🔐 SOPS</h3>\n<p><a href=\"https://github.com/getsops/sops\" target=\"_blank\" rel=\"noopener noreferrer\">SOPS</a> is a tool that helps you encrypt and decrypt secrets using a variety of encryption methods, including AWS KMS.</p>\n<h3 id=\"-aws-kms-key\" style=\"position:relative;\"><a href=\"#-aws-kms-key\" aria-label=\" aws kms key permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>🔑 AWS KMS Key</h3>\n<p><a href=\"https://aws.amazon.com/kms/\" target=\"_blank\" rel=\"noopener noreferrer\">AWS KMS</a> is a key management service that allows you to create and manage encryption keys. You can use AWS KMS to encrypt secrets that you want to store in your Kubernetes cluster.</p>\n<p>Here are the reference code and a few Terraform templates to create KMS and IAM resources. I also added a walkthrough for Terraform <a href=\"https://github.com/seifrajhi/sops-secrets-blog\" target=\"_blank\" rel=\"noopener noreferrer\">here</a>.</p>\n<h3 id=\"-deployment-steps\" style=\"position:relative;\"><a href=\"#-deployment-steps\" aria-label=\" deployment steps permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>🚀 Deployment Steps</h3>\n<p>To deploy the sample httpbin app in your Kubernetes cluster, you can use the following steps:</p>\n<ol>\n<li>\n<p><strong>Clone the repository:</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token function\">git</span> clone https://github.com/seifrajhi/sops-secrets-blog</code></pre></div>\n</li>\n<li>\n<p><strong>Change the directory to the helmfile directory:</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token builtin class-name\">cd</span> sops-secrets-blog/helmfile/</code></pre></div>\n</li>\n<li>\n<p><strong>Deploy the httpbin app using Helmfile:</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">helmfile <span class=\"token parameter variable\">-e</span> sops-poc apply</code></pre></div>\n<p>This will deploy the httpbin app in your Kubernetes environment, including a pod, a service, a service account, and a secret.</p>\n</li>\n<li>\n<p><strong>Examine the environment variables in the newly created pod:</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">kubectl get pods <span class=\"token parameter variable\">-o</span> wide</code></pre></div>\n<p>This will show you the environment variables that are set for the pod, including the <code class=\"language-text\">FIRST_VAR</code> and <code class=\"language-text\">SECOND_VAR</code> variables. We will use this information in a later step.</p>\n</li>\n</ol>\n<h2 id=\"-the-real-deal-managing-secrets-with-helmfile\" style=\"position:relative;\"><a href=\"#-the-real-deal-managing-secrets-with-helmfile\" aria-label=\" the real deal managing secrets with helmfile permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>🔑 The Real Deal: Managing Secrets with Helmfile</h2>\n<p>Now, let's talk about secrets. Helmfile supports secrets by using the <code class=\"language-text\">helm-secrets</code> plugin. This plugin allows you to manage and inject sensitive information into a given release's values.</p>\n<p>However, there is a caveat: the secret values will be shown in plain text in the <code class=\"language-text\">helmfile diff</code> or <code class=\"language-text\">helmfile apply</code> outputs. This is not ideal, as it could expose sensitive information to unauthorized users.</p>\n<p>Fortunately, there is a workaround for this. You can use the <code class=\"language-text\">helm-secrets</code> plugin to encrypt your secrets before storing them in Helmfile. This plugin will decrypt the secrets when Helmfile deploys the release, but the secret values will not be shown in plain text in the <code class=\"language-text\">helmfile diff</code> or <code class=\"language-text\">helmfile apply</code> outputs.</p>\n<p>To learn more about how to use the <code class=\"language-text\">helm-secrets</code> plugin, please refer to the <a href=\"https://github.com/jkroepke/helm-secrets\" target=\"_blank\" rel=\"noopener noreferrer\">helm-secrets GitHub repository</a>.</p>\n<h3 id=\"-installing-code-classlanguage-texthelm-secretscode\" style=\"position:relative;\"><a href=\"#-installing-code-classlanguage-texthelm-secretscode\" aria-label=\" installing code classlanguage texthelm secretscode permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>📥 Installing <code class=\"language-text\">helm-secrets</code></h3>\n<p>To use the <code class=\"language-text\">helm-secrets</code> plugin, you will need to install it first. You can do this by running the following command:</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">helm plugin <span class=\"token function\">install</span> https://github.com/jkroepke/helm-secrets</code></pre></div>\n<p>This will install the <code class=\"language-text\">helm-secrets</code> plugin in your local Helm installation. Once the plugin is installed, you can use it to encrypt and decrypt secrets in your Helmfile manifests.</p>\n<h3 id=\"-installing-sops\" style=\"position:relative;\"><a href=\"#-installing-sops\" aria-label=\" installing sops permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>🔐 Installing SOPS</h3>\n<p>To install SOPS, you can use the following command:</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">brew <span class=\"token function\">install</span> sops</code></pre></div>\n<p>Once SOPS is installed, you can use it to encrypt and decrypt files.</p>\n<h3 id=\"️-configuring-sops\" style=\"position:relative;\"><a href=\"#%EF%B8%8F-configuring-sops\" aria-label=\"️ configuring sops permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>🛠️ Configuring SOPS</h3>\n<p>To use SOPS, you need to create a <code class=\"language-text\">.sops.yaml</code> configuration file. This file tells SOPS what files to encrypt and how to encrypt them. The following is an example of a <code class=\"language-text\">.sops.yaml</code> configuration file:</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">creation_rules</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">path_regex</span><span class=\"token punctuation\">:</span> \\.yaml$\n        <span class=\"token key atrule\">kms</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'arn:of:your:kms:key'</span></code></pre></div>\n<p>This configuration file tells SOPS to encrypt any file that ends in <code class=\"language-text\">.yaml</code> using the KMS key with the ARN <code class=\"language-text\">arn:of:your:kms:key</code>.</p>\n<p>You can create the <code class=\"language-text\">.sops.yaml</code> file anywhere in your filesystem. SOPS will look for it in the current directory by default, but you can also specify the path to the file using the <code class=\"language-text\">-c</code> flag.</p>\n<h3 id=\"-creating-and-encrypting-secrets\" style=\"position:relative;\"><a href=\"#-creating-and-encrypting-secrets\" aria-label=\" creating and encrypting secrets permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>🔏 Creating and Encrypting Secrets</h3>\n<p>To create the <code class=\"language-text\">secrets.yaml</code> file, you can use the following command:</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">sops secrets.yaml</code></pre></div>\n<p>This will open a text editor with prefilled sample values. Replace the content with the following:</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">my_var</span><span class=\"token punctuation\">:</span> a top secret value\n<span class=\"token key atrule\">my_other_var</span><span class=\"token punctuation\">:</span> not that sensitive<span class=\"token punctuation\">,</span> but still please don't tell anyone<span class=\"token tag\">!</span></code></pre></div>\n<p>When you save and close the file, SOPS will encrypt it automatically. You can then open the file and have a look at its content. SOPS will have added metadata to the file, including the KMS ARN that was used to encrypt the file, a timestamp, and some other information.</p>\n<h3 id=\"-adding-secrets-to-helmfile\" style=\"position:relative;\"><a href=\"#-adding-secrets-to-helmfile\" aria-label=\" adding secrets to helmfile permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>📄 Adding Secrets to Helmfile</h3>\n<p>Now, it's time to add the secrets to the Helmfile manifest. To do this, you need to add a <code class=\"language-text\">secrets:</code> section to the release in the <code class=\"language-text\">helmfile.yaml</code> file. The following is an example of how to do this:</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">bases</span><span class=\"token punctuation\">:</span>\n<span class=\"token punctuation\">-</span> environments.yaml\n\n<span class=\"token key atrule\">releases</span><span class=\"token punctuation\">:</span>\n<span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> example<span class=\"token punctuation\">-</span>release\n    <span class=\"token key atrule\">namespace</span><span class=\"token punctuation\">:</span> example<span class=\"token punctuation\">-</span>ns\n    <span class=\"token key atrule\">labels</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">app</span><span class=\"token punctuation\">:</span> example\n    <span class=\"token key atrule\">values</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> values.yaml.gotmpl\n    <span class=\"token key atrule\">secrets</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> secrets.yaml\n    <span class=\"token key atrule\">chart</span><span class=\"token punctuation\">:</span> ./charts/httpbin</code></pre></div>\n<p>As a result of adding the <code class=\"language-text\">secrets:</code> section to the release in the <code class=\"language-text\">helmfile.yaml</code> file, Helmfile will merge the <code class=\"language-text\">values.yaml</code> and <code class=\"language-text\">secrets.yaml</code> files as one and then use it to populate the templates in the <code class=\"language-text\">charts/httpbin/templates/</code> directory when deploying the release.</p>\n<h3 id=\"-modifying-deployment-template\" style=\"position:relative;\"><a href=\"#-modifying-deployment-template\" aria-label=\" modifying deployment template permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>📝 Modifying Deployment Template</h3>\n<p>To make use of the new secrets, you need to modify the deployment template in the <code class=\"language-text\">charts/httpbin/templates/deployment.yaml</code> file. The following is an example of how to do this:</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> apps/v1\n<span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> Deployment\n<span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> .Values.name <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\n<span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">replicas</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> .Values.replicas <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\n    <span class=\"token key atrule\">selector</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">matchLabels</span><span class=\"token punctuation\">:</span>\n            <span class=\"token key atrule\">app</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> .Values.name <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\n            <span class=\"token key atrule\">version</span><span class=\"token punctuation\">:</span> v1\n    <span class=\"token key atrule\">template</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n            <span class=\"token key atrule\">labels</span><span class=\"token punctuation\">:</span>\n                <span class=\"token key atrule\">app</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> .Values.name <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\n                <span class=\"token key atrule\">version</span><span class=\"token punctuation\">:</span> v1\n        <span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span>\n            <span class=\"token key atrule\">serviceAccountName</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> .Values.name <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\n            <span class=\"token key atrule\">containers</span><span class=\"token punctuation\">:</span>\n            <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> docker.io/kong/httpbin\n                <span class=\"token key atrule\">imagePullPolicy</span><span class=\"token punctuation\">:</span> IfNotPresent\n                <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> .Values.name <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\n                <span class=\"token key atrule\">ports</span><span class=\"token punctuation\">:</span>\n                <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">containerPort</span><span class=\"token punctuation\">:</span> <span class=\"token number\">80</span>\n                <span class=\"token key atrule\">env</span><span class=\"token punctuation\">:</span>\n                <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> FIRST_VAR\n                    <span class=\"token key atrule\">value</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> .Values.my_var <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\n                <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> SECOND_VAR\n                    <span class=\"token key atrule\">value</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> .Values.my_other_var <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span></code></pre></div>\n<h3 id=\"-verifying-changes\" style=\"position:relative;\"><a href=\"#-verifying-changes\" aria-label=\" verifying changes permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>🔍 Verifying Changes</h3>\n<p>If we check what Helmfile does, you can run the below command:</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">helmfile <span class=\"token parameter variable\">-e</span> sops-poc <span class=\"token function\">diff</span></code></pre></div>\n<p>Now the values are effectively taken from a Kubernetes secret instead of directly from secrets defined in the Helmfile release.</p>\n<p>Go ahead and run <code class=\"language-text\">helmfile -e sops-poc apply</code> to deploy the changes.</p>\n<h3 id=\"-updating-secrets\" style=\"position:relative;\"><a href=\"#-updating-secrets\" aria-label=\" updating secrets permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>🔄 Updating Secrets</h3>\n<p>Let's now modify <code class=\"language-text\">secrets.yaml</code> values:</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">sops secrets.yaml</code></pre></div>\n<p>I removed random characters from both <code class=\"language-text\">my_var</code> and <code class=\"language-text\">my_other_var</code> in <code class=\"language-text\">secrets.yaml</code>, it doesn't really matter the change, it is just an example. Save and close the file to have SOPS re-encrypt it.</p>\n<p>And now if you see what Helmfile tries to do, you will find that there are no secrets shown in plain text anymore! 🎉</p>\n<h2 id=\"-conclusion\" style=\"position:relative;\"><a href=\"#-conclusion\" aria-label=\" conclusion permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>🔏 Conclusion</h2>\n<p>In this blog post, we discussed SOPS, a tool that can be used to encrypt and decrypt secrets in Git. We also discussed the benefits of using SOPS, and how it can help to keep your secrets safe.</p>\n<p>SOPS is a powerful tool that can be used to encrypt a wide variety of secrets, including passwords, API keys, and SSH keys. SOPS uses a variety of encryption methods, including AES-256, RSA-2048, and Ed25519. This makes it very difficult for attackers to decrypt SOPS-encrypted secrets.</p>\n<p>SOPS also supports a variety of key management options, including KMS, HashiCorp Vault, and AWS Secrets Manager. This makes it easy to store and manage your SOPS keys in a secure manner.</p>\n<p>By using SOPS, you can be sure that your secrets are safe in Git. SOPS is a foolproof way to keep your secrets safe.</p>\n<br>\n<p><strong><em>Until next time, つづく 🎉</em></strong></p>\n<blockquote>\n<p>💡 Thank you for Reading !! 🙌🏻😁📃, see you in the next blog.🤘  <em><strong>Until next time 🎉</strong></em></p>\n</blockquote>\n<p>🚀 Thank you for sticking up till the end. If you have any questions/feedback regarding this blog feel free to connect with me:</p>\n<p><strong>♻️ LinkedIn:</strong> <a href=\"https://www.linkedin.com/in/rajhi-saif/\" target=\"_blank\" rel=\"noopener noreferrer\">https://www.linkedin.com/in/rajhi-saif/</a></p>\n<p><strong>♻️ X/Twitter:</strong> <a href=\"https://x.com/rajhisaifeddine\" target=\"_blank\" rel=\"noopener noreferrer\">https://x.com/rajhisaifeddine</a></p>\n<p><strong>The end ✌🏻</strong></p>\n<h1 align=\"center\">🔰 Keep Learning !! Keep Sharing !! 🔰</h1>\n<p><strong>📅 Stay updated</strong></p>\n<p>Subscribe to our newsletter for more insights on AWS cloud computing and containers.</p>","timeToRead":6,"rawMarkdownBody":"\n> **SOPS: A foolproof way to keep your secrets safe 🔥**\n\n## 📚 Introduction\n\nSecrets are a fact of life in the world of DevOps. We use them to access servers, databases, and other sensitive resources. But storing secrets in plain text is a security risk. If your secrets are compromised, an attacker could gain access to your systems and data.\n\nSOPS is a tool that helps you store your secrets securely in Git. It encrypts your secrets using a key that is stored in a separate file. This way, your secrets are never stored in plain text, even in your Git repository.\n\nIn this blog post, I will show you how to use SOPS to keep your secrets safe.\n\n![Alt text](./sops.jpg)\n\n## 🏛️ Traditional Secret Storage\n\nTraditionally, secrets are stored in a separate, secure location, such as [Hashicorp Vault](https://www.vaultproject.io/), [AWS Secrets Manager](https://docs.aws.amazon.com/secretsmanager/latest/userguide/intro.html), [GCP KMS](https://cloud.google.com/security-key-management), [Azure Key Vault](https://learn.microsoft.com/en-us/azure/key-vault/general/basic-concepts), and well-known credential storages like [1Password](https://1password.com/). This has the advantage of isolating the secrets from the code that references them. However, it also introduces an extra step: the code must fetch the secret value from the vault or credential manager before it can use it. This can be a security risk, as it exposes the secret value to the code for a brief period of time.\n\n## 🔐 SOPS\n\n[SOPS](https://github.com/getsops/sops) offers a simplified version of secret storage. With SOPS, the secret values are directly stored in the code, and they are encrypted using a key that is stored in a separate file. This way, the secret values are never stored in plain text, even in the code. To decrypt the secret values, the code must use the key file. This eliminates the need to fetch the secret values from a vault or credential manager, which reduces the security risk.\n\nSOPS supports a variety of encryption methods, including AWS KMS, PGP, GCP KMS, Azure Key Vault, HashiCorp Key Vault, and [age](https://github.com/FiloSottile/age). This makes it a flexible and versatile tool that can be used to store secrets in a variety of environments.\n\n## 🛠️ A Step-by-Step Guide to Using SOPS\n\nIn this section, we will deploy a sample chart to a Kubernetes cluster using [Helm](https://helm.sh/) (Helmfile) and AWS KMS.\n\n### 📦 Helm (Helmfile)\n\n[Helm](https://helm.sh/) is a package manager for Kubernetes. It allows you to deploy and manage Kubernetes applications. [Helmfile](https://github.com/helmfile/helmfile) is a tool that helps you manage Helm charts.\n\n### 🔐 SOPS\n\n[SOPS](https://github.com/getsops/sops) is a tool that helps you encrypt and decrypt secrets using a variety of encryption methods, including AWS KMS.\n\n### 🔑 AWS KMS Key\n\n[AWS KMS](https://aws.amazon.com/kms/) is a key management service that allows you to create and manage encryption keys. You can use AWS KMS to encrypt secrets that you want to store in your Kubernetes cluster.\n\nHere are the reference code and a few Terraform templates to create KMS and IAM resources. I also added a walkthrough for Terraform [here](https://github.com/seifrajhi/sops-secrets-blog).\n\n### 🚀 Deployment Steps\n\nTo deploy the sample httpbin app in your Kubernetes cluster, you can use the following steps:\n\n1. **Clone the repository:**\n\n    ```shell\n    git clone https://github.com/seifrajhi/sops-secrets-blog\n    ```\n\n2. **Change the directory to the helmfile directory:**\n\n    ```shell\n    cd sops-secrets-blog/helmfile/\n    ```\n\n3. **Deploy the httpbin app using Helmfile:**\n\n    ```shell\n    helmfile -e sops-poc apply\n    ```\n\n    This will deploy the httpbin app in your Kubernetes environment, including a pod, a service, a service account, and a secret.\n\n4. **Examine the environment variables in the newly created pod:**\n\n    ```shell\n    kubectl get pods -o wide\n    ```\n\n    This will show you the environment variables that are set for the pod, including the `FIRST_VAR` and `SECOND_VAR` variables. We will use this information in a later step.\n\n## 🔑 The Real Deal: Managing Secrets with Helmfile\n\nNow, let's talk about secrets. Helmfile supports secrets by using the `helm-secrets` plugin. This plugin allows you to manage and inject sensitive information into a given release's values.\n\nHowever, there is a caveat: the secret values will be shown in plain text in the `helmfile diff` or `helmfile apply` outputs. This is not ideal, as it could expose sensitive information to unauthorized users.\n\nFortunately, there is a workaround for this. You can use the `helm-secrets` plugin to encrypt your secrets before storing them in Helmfile. This plugin will decrypt the secrets when Helmfile deploys the release, but the secret values will not be shown in plain text in the `helmfile diff` or `helmfile apply` outputs.\n\nTo learn more about how to use the `helm-secrets` plugin, please refer to the [helm-secrets GitHub repository](https://github.com/jkroepke/helm-secrets).\n\n### 📥 Installing `helm-secrets`\n\nTo use the `helm-secrets` plugin, you will need to install it first. You can do this by running the following command:\n\n```shell\nhelm plugin install https://github.com/jkroepke/helm-secrets\n```\n\nThis will install the `helm-secrets` plugin in your local Helm installation. Once the plugin is installed, you can use it to encrypt and decrypt secrets in your Helmfile manifests.\n\n### 🔐 Installing SOPS\n\nTo install SOPS, you can use the following command:\n\n```shell\nbrew install sops\n```\n\nOnce SOPS is installed, you can use it to encrypt and decrypt files.\n\n### 🛠️ Configuring SOPS\n\nTo use SOPS, you need to create a `.sops.yaml` configuration file. This file tells SOPS what files to encrypt and how to encrypt them. The following is an example of a `.sops.yaml` configuration file:\n\n```yaml\ncreation_rules:\n    - path_regex: \\.yaml$\n        kms: 'arn:of:your:kms:key'\n```\n\nThis configuration file tells SOPS to encrypt any file that ends in `.yaml` using the KMS key with the ARN `arn:of:your:kms:key`.\n\nYou can create the `.sops.yaml` file anywhere in your filesystem. SOPS will look for it in the current directory by default, but you can also specify the path to the file using the `-c` flag.\n\n### 🔏 Creating and Encrypting Secrets\n\nTo create the `secrets.yaml` file, you can use the following command:\n\n```shell\nsops secrets.yaml\n```\n\nThis will open a text editor with prefilled sample values. Replace the content with the following:\n\n```yaml\nmy_var: a top secret value\nmy_other_var: not that sensitive, but still please don't tell anyone!\n```\n\nWhen you save and close the file, SOPS will encrypt it automatically. You can then open the file and have a look at its content. SOPS will have added metadata to the file, including the KMS ARN that was used to encrypt the file, a timestamp, and some other information.\n\n### 📄 Adding Secrets to Helmfile\n\nNow, it's time to add the secrets to the Helmfile manifest. To do this, you need to add a `secrets:` section to the release in the `helmfile.yaml` file. The following is an example of how to do this:\n\n```yaml\nbases:\n- environments.yaml\n\nreleases:\n- name: example-release\n    namespace: example-ns\n    labels:\n        app: example\n    values:\n    - values.yaml.gotmpl\n    secrets:\n    - secrets.yaml\n    chart: ./charts/httpbin\n```\n\nAs a result of adding the `secrets:` section to the release in the `helmfile.yaml` file, Helmfile will merge the `values.yaml` and `secrets.yaml` files as one and then use it to populate the templates in the `charts/httpbin/templates/` directory when deploying the release.\n\n### 📝 Modifying Deployment Template\n\nTo make use of the new secrets, you need to modify the deployment template in the `charts/httpbin/templates/deployment.yaml` file. The following is an example of how to do this:\n\n```yaml\napiVersion: apps/v1\nkind: Deployment\nmetadata:\n    name: {{ .Values.name }}\nspec:\n    replicas: {{ .Values.replicas }}\n    selector:\n        matchLabels:\n            app: {{ .Values.name }}\n            version: v1\n    template:\n        metadata:\n            labels:\n                app: {{ .Values.name }}\n                version: v1\n        spec:\n            serviceAccountName: {{ .Values.name }}\n            containers:\n            - image: docker.io/kong/httpbin\n                imagePullPolicy: IfNotPresent\n                name: {{ .Values.name }}\n                ports:\n                - containerPort: 80\n                env:\n                - name: FIRST_VAR\n                    value: {{ .Values.my_var }}\n                - name: SECOND_VAR\n                    value: {{ .Values.my_other_var }}\n```\n\n### 🔍 Verifying Changes\n\nIf we check what Helmfile does, you can run the below command:\n\n```shell\nhelmfile -e sops-poc diff\n```\n\nNow the values are effectively taken from a Kubernetes secret instead of directly from secrets defined in the Helmfile release.\n\nGo ahead and run `helmfile -e sops-poc apply` to deploy the changes.\n\n### 🔄 Updating Secrets\n\nLet's now modify `secrets.yaml` values:\n\n```shell\nsops secrets.yaml\n```\n\nI removed random characters from both `my_var` and `my_other_var` in `secrets.yaml`, it doesn't really matter the change, it is just an example. Save and close the file to have SOPS re-encrypt it.\n\nAnd now if you see what Helmfile tries to do, you will find that there are no secrets shown in plain text anymore! 🎉\n\n## 🔏 Conclusion\n\nIn this blog post, we discussed SOPS, a tool that can be used to encrypt and decrypt secrets in Git. We also discussed the benefits of using SOPS, and how it can help to keep your secrets safe.\n\nSOPS is a powerful tool that can be used to encrypt a wide variety of secrets, including passwords, API keys, and SSH keys. SOPS uses a variety of encryption methods, including AES-256, RSA-2048, and Ed25519. This makes it very difficult for attackers to decrypt SOPS-encrypted secrets.\n\nSOPS also supports a variety of key management options, including KMS, HashiCorp Vault, and AWS Secrets Manager. This makes it easy to store and manage your SOPS keys in a secure manner.\n\nBy using SOPS, you can be sure that your secrets are safe in Git. SOPS is a foolproof way to keep your secrets safe.\n\n<br>\n\n**_Until next time, つづく 🎉_**\n\n> 💡 Thank you for Reading !! 🙌🏻😁📃, see you in the next blog.🤘  _**Until next time 🎉**_\n\n🚀 Thank you for sticking up till the end. If you have any questions/feedback regarding this blog feel free to connect with me:\n\n**♻️ LinkedIn:** https://www.linkedin.com/in/rajhi-saif/\n\n**♻️ X/Twitter:** https://x.com/rajhisaifeddine\n\n**The end ✌🏻**\n\n<h1 align=\"center\">🔰 Keep Learning !! Keep Sharing !! 🔰</h1>\n\n**📅 Stay updated**\n\nSubscribe to our newsletter for more insights on AWS cloud computing and containers.\n","wordCount":{"words":1340},"frontmatter":{"id":"c7e60ef3d7a8a8d7e6ebda4a","path":"/blog/sops-secrets-safe-in-git/","humanDate":"Oct 19, 2024","fullDate":"2024-10-19","title":"The SOPS way: The only way to keep your secrets safe in Git","keywords":["SOPS","Git","Secret Management","Cloud Security"],"excerpt":"How to use SOPS to securely manage your secrets in Git. This guide provides a foolproof method to ensure your sensitive information remains protected.","cover":{"childImageSharp":{"gatsbyImageData":{"layout":"fullWidth","placeholder":{"fallback":"data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAPABQDASIAAhEBAxEB/8QAFgABAQEAAAAAAAAAAAAAAAAAAwQA/8QAFgEBAQEAAAAAAAAAAAAAAAAAAgED/9oADAMBAAIQAxAAAAE5yozsGXM//8QAGxAAAgEFAAAAAAAAAAAAAAAAAREAAgMSITL/2gAIAQEAAQUCrt6IQTgcHOM//8QAFhEBAQEAAAAAAAAAAAAAAAAAAAER/9oACAEDAQE/AY2P/8QAFREBAQAAAAAAAAAAAAAAAAAAEBH/2gAIAQIBAT8Bh//EABoQAAMAAwEAAAAAAAAAAAAAAAABIQIQEZH/2gAIAQEABj8CnGRY+ERBa//EABoQAAIDAQEAAAAAAAAAAAAAAAABESExQVH/2gAIAQEAAT8h3v6WUbii50TsyDBwF7Dg9P/aAAwDAQACAAMAAAAQS9//xAAXEQEAAwAAAAAAAAAAAAAAAAAAARFB/9oACAEDAQE/EKakf//EABYRAQEBAAAAAAAAAAAAAAAAAAEAEf/aAAgBAgEBPxARY3//xAAaEAEBAAMBAQAAAAAAAAAAAAABEQAhQTFR/9oACAEBAAE/EAEk44JyusYo0qipvedeOBY4x5CTKaDB+5YKO6c//9k="},"images":{"fallback":{"src":"/static/aeabb352d32dace336d1faa23144f232/1d8b4/sops-cover.jpg","srcSet":"/static/aeabb352d32dace336d1faa23144f232/1d8b4/sops-cover.jpg 606w","sizes":"100vw"},"sources":[{"srcSet":"/static/aeabb352d32dace336d1faa23144f232/252ef/sops-cover.webp 606w","type":"image/webp","sizes":"100vw"}]},"width":1,"height":0.7491749174917492}}},"coverCredits":"Photo by Saifeddine Rajhi"}}},"pageContext":{"prevThought":{"frontmatter":{"path":"/blog/kubernetes-gateway-api-part2/","title":"Redefining Kubernetes networking with Gateway API: Part 2","date":"2024-10-19 19:06:00"},"excerpt":"Optimizing AWS EKS Networking with Gateway API and VPC Lattice Integration 🕸 📕 Introduction Building upon our exploration of Kubernetes…","html":"<blockquote>\n<p><strong>Optimizing AWS EKS Networking with Gateway API and VPC Lattice Integration 🕸</strong></p>\n</blockquote>\n<h2 id=\"-introduction\" style=\"position:relative;\"><a href=\"#-introduction\" aria-label=\" introduction permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>📕 Introduction</h2>\n<p>Building upon our exploration of Kubernetes networking evolution with the Gateway API, Part 2 tackles AWS Application Networking. This implementation of the Kubernetes Gateway API operates within Kubernetes clusters to manage AWS VPC Lattice resources. By using Kubernetes Custom Resource Definitions such as Gateway and HTTPRoute, AWS Application Networking orchestrates networking operations, enhancing the efficiency and security of networking within Kubernetes environments.</p>\n<h2 id=\"-amazon-vpc-lattice\" style=\"position:relative;\"><a href=\"#-amazon-vpc-lattice\" aria-label=\" amazon vpc lattice permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>🌐 Amazon VPC Lattice</h2>\n<p><a href=\"https://aws.amazon.com/vpc/lattice/\" target=\"_blank\" rel=\"noopener noreferrer\">Amazon VPC Lattice</a>, a new feature of Amazon Virtual Private Cloud (Amazon VPC), is generally available, offering a unified approach to connect, secure, and monitor service communication.</p>\n<p>With the launch of Amazon VPC Lattice comes the introduction of the <a href=\"https://github.com/aws/aws-application-networking-k8s\" target=\"_blank\" rel=\"noopener noreferrer\">AWS Gateway API controller</a>, an implementation of the Kubernetes Gateway API. This open-source standard interface enhances Kubernetes application networking through flexible, extensible, and role-oriented interfaces.</p>\n<blockquote>\n<p>The AWS Gateway API controller extends custom resources defined by the Gateway API, enabling the creation of VPC Lattice resources using Kubernetes APIs.</p>\n</blockquote>\n<p>As organizations transition from monolithic applications to microservices architecture with Kubernetes, they gain agility and enable more frequent deployments. However, this shift introduces challenges related to application traffic management, security, monitoring, and routing. To address these concerns across ingress (north-south) and service-to-service communication (east-west), customers often rely on various tools like load balancers, service discovery mechanisms, service meshes, and monitoring agents.</p>\n<p>Amazon VPC Lattice is a fully managed service built directly into the AWS network infrastructure. Amazon VPC Lattice allows you to:</p>\n<ul>\n<li>Handle network connectivity seamlessly between services across VPCs and accounts.</li>\n<li>Discover these services spanning multiple Kubernetes clusters.</li>\n<li>Implement a defense-in-depth strategy to secure communication between those services.</li>\n<li>Observe the request/response traffic across the services.</li>\n</ul>\n<p>To implement the features just described, you aren't required to develop custom code or manage Kubernetes sidecar proxies.</p>\n<h2 id=\"️-aws-gateway-api-controller\" style=\"position:relative;\"><a href=\"#%EF%B8%8F-aws-gateway-api-controller\" aria-label=\"️ aws gateway api controller permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>🛠️ AWS Gateway API Controller</h2>\n<p>Gateway API is an open-source project managed by the Kubernetes networking community. It is a collection of resources that model application networking in Kubernetes. Gateway API supports resources such as GatewayClass, Gateway, and Route that have been implemented by many vendors and have broad industry support.</p>\n<p>Originally conceived as a successor to the well-known Ingress API, the benefits of the Gateway API include (but are not limited to) explicit support for many commonly used networking protocols, as well as tightly integrated support for Transport Layer Security (TLS).</p>\n<p>When installed in your cluster, the controller watches for the creation of Gateway API resources such as gateways and routes and provisions corresponding Amazon VPC Lattice objects according to the mapping in the image below. The AWS Gateway API Controller is an open-source project and fully supported by Amazon.</p>\n<p><span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 48.8235294117647%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsTAAALEwEAmpwYAAACeElEQVR42m2R20uTYRzH97dEN9FV2EXUVUTQCepK6E7oJoguJAZRJGRQgRaIhIfIm5qttpw6T9PmaZunOedO7+ve953bdJvv5k6a2abQp8fZjeAPvjzwwPN9fp/v1yCteYlH7MhaCkVdR1PjJLQEUUnjp3OBSYeH6TE3M+NzLEwvo0fj6HKMXT1Pbf5yYgxTU2ZcA89ZDMdZCUbwByRUWcUuTM7U3eTClbtcvlbP+Uu3qLtaj+aTSa1EKCYz/w1POhpG3Mv0O5fwRtYIyBpBSWEtquETj0zmYSxH+mqnr28MW5+DZFglHVIop7McHBzwZ3+fSqXCvjir1SqGiOQhGTIRVjdZUzQURWALJbU4MfFByBdkdWEFdVUiLVB1eZ3NYJRcIsV2fpt0Oo2u66RSKYrFothwcgyLqVVsGBPIEoGgTFhgy2KLew1Gzl28zfU7DZytu4HxWSsZca/O+ylubJ2e4bg3zJAriF9WBLJKSCArSoxUMo3L7cNuc9BvHWagb5TAYoAdkV0hmqCcyVGpVtjb26vp8PDw2NAz52ZqyIok2pUEYkycs7NLfOgy8bH7C2bzIKWNDC7nHO1tPXR3fMZuGaW4uUWhWCCXy5HNZms51gy/22y0tTbjCyv4BXJ8PcmMy0tTcxtNL9/R2dVLIZFm4IeDlrcdvG/twtRjpbSps7O7W8utXC6Tz+drxRgs4zP0Djpwr4QJCtT2T9+439DIm5ZOrKLVBw+f0mh8hdfj44nxNY8ev8Bpm6htfWRYKpYolUoUCoVjw/WMTkJoYyvL1naBZdHm0NgUngU/oYjCiGOGyel5NuIpJpxuHBOzqJJK9ddvTpt/jjSl/XeBN+EAAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"AWS Gateway API Controller\" title=\"\" src=\"/static/e6f8e13509d8eb86dae5809ae052fb49/c5bb3/gw.png\" srcset=\"/static/e6f8e13509d8eb86dae5809ae052fb49/04472/gw.png 170w,\n/static/e6f8e13509d8eb86dae5809ae052fb49/9f933/gw.png 340w,\n/static/e6f8e13509d8eb86dae5809ae052fb49/c5bb3/gw.png 680w,\n/static/e6f8e13509d8eb86dae5809ae052fb49/5a190/gw.png 800w\" sizes=\"(max-width: 680px) 100vw, 680px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n    </span>\n          </p>\n<p>As shown in the figure, there are different personas associated with different levels of control in the Kubernetes Gateway API:</p>\n<ul>\n<li><strong>Infrastructure provider</strong>: Creates the Kubernetes GatewayClass to identify VPC Lattice as the GatewayClass.</li>\n<li><strong>Cluster operator</strong>: Creates the Kubernetes Gateway, which gets information from VPC Lattice related to the service networks.</li>\n<li><strong>Application developer</strong>: Creates HTTPRoute objects that specify how the traffic is redirected from the gateway to backend Kubernetes services.</li>\n</ul>\n<p>AWS Kubernetes Gateway API resources and VPC Lattice resources correspond as follows:</p>\n<p><span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 56.470588235294116%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAAsTAAALEwEAmpwYAAACMUlEQVR42g2Sy27TQABF7/j9GI/HY4+fsePGebUlCWmTtI1LmyBSKIiKSCBUhJBggwCJHUL8PdndzTk6i4uzJlterKeTaXvVNkfN5mazOpufjsab9rpdLJeT2c355d16e7faPVzv38z337Y/f7/49+Pk7xf9D26my5P6eeBHnssY9XOZflhW44LViShlVHBRiaSdLqZZfy5P1uLsVXT7MX736H5+xC8cj7uOwQ3N4kxYhmOpmqQuNfRECOG4wlYK39ss2yGLG/AZKa4w2mJ9j/0e31GPjznllukKP6Q2Y47dzflhdWKZ+jSlWu7Z7WQ+dsUI/gz5BY5vSbvDwz2+ws0HJjG5L8MgEX7CqRd6hqMpknmhbUqbVL6z370c06AP9gTZOUZrXN3g9QafYMe1a7hV2UQB7feqbhEd5XYRuaWMy0gUzCg9Z3fZHuAG7ATZUwwXWK2wW+E97KCSgag7dRrFR1Ux6iVNwYZdWcd2L5FdwTmUAEqlWj3Ch8hOMZhgMcV2grdw/Y5rg3OiqsTQEQVKL6dVFkvXKqOwDPyQKLFiVJpTE94j2QCDEeZDPOvjDpRmjg3GiGVCU+E5GHTYoOJl6KWURoYpiCqJ0VGdSgm6JKtJv8asi8sOtnAdaZkk8NVYKmlMikTr5UYnxlGq9g7loZ/oRqKYpe4WiihIXqApMMmwjLGGDPPA555LGT2cxBPMDxzL0wjXidCJNLRE13LdzDWaKmF6kKOROA0x51j+Bwb6Q4RIlsygAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"AWS Kubernetes Gateway API Resources\" title=\"\" src=\"/static/e3a49f13f904560b4242bf12e06e1019/c5bb3/vpc-lattice.png\" srcset=\"/static/e3a49f13f904560b4242bf12e06e1019/04472/vpc-lattice.png 170w,\n/static/e3a49f13f904560b4242bf12e06e1019/9f933/vpc-lattice.png 340w,\n/static/e3a49f13f904560b4242bf12e06e1019/c5bb3/vpc-lattice.png 680w,\n/static/e3a49f13f904560b4242bf12e06e1019/5a190/vpc-lattice.png 800w\" sizes=\"(max-width: 680px) 100vw, 680px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n    </span>\n          </p>\n<h3 id=\"-deploying-the-aws-gateway-api-controller\" style=\"position:relative;\"><a href=\"#-deploying-the-aws-gateway-api-controller\" aria-label=\" deploying the aws gateway api controller permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>🚀 Deploying the AWS Gateway API Controller</h3>\n<p>Follow these instructions to create a cluster and deploy the AWS Gateway API Controller.</p>\n<h4 id=\"-configure-security-group\" style=\"position:relative;\"><a href=\"#-configure-security-group\" aria-label=\" configure security group permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>🔒 Configure Security Group</h4>\n<p>First, configure the security group to receive traffic from the VPC Lattice network. You must set up security groups so that they allow all Pods communicating with VPC Lattice to allow traffic from the VPC Lattice managed prefix lists.</p>\n<p>Lattice has both an IPv4 and IPv6 prefix lists available.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token assign-left variable\">CLUSTER_SG</span><span class=\"token operator\">=</span><span class=\"token variable\"><span class=\"token variable\">$(</span>aws eks describe-cluster <span class=\"token parameter variable\">--name</span> $EKS_CLUSTER_NAME <span class=\"token parameter variable\">--output</span> json <span class=\"token operator\">|</span> jq <span class=\"token parameter variable\">-r</span> <span class=\"token string\">'.cluster.resourcesVpcConfig.clusterSecurityGroupId'</span><span class=\"token variable\">)</span></span>\n<span class=\"token assign-left variable\">PREFIX_LIST_ID</span><span class=\"token operator\">=</span><span class=\"token variable\"><span class=\"token variable\">$(</span>aws ec2 describe-managed-prefix-lists <span class=\"token parameter variable\">--query</span> <span class=\"token string\">\"PrefixLists[?PrefixListName=='com.amazonaws.<span class=\"token variable\">$AWS_REGION</span>.vpc-lattice'].PrefixListId\"</span> <span class=\"token operator\">|</span> jq <span class=\"token parameter variable\">-r</span> <span class=\"token string\">'.[]'</span><span class=\"token variable\">)</span></span>\naws ec2 authorize-security-group-ingress --group-id <span class=\"token variable\">$CLUSTER_SG</span> --ip-permissions <span class=\"token string\">\"PrefixListIds=[{PrefixListId=<span class=\"token variable\">${PREFIX_LIST_ID}</span>}],IpProtocol=-1\"</span>\n<span class=\"token assign-left variable\">PREFIX_LIST_ID_IPV6</span><span class=\"token operator\">=</span><span class=\"token variable\"><span class=\"token variable\">$(</span>aws ec2 describe-managed-prefix-lists <span class=\"token parameter variable\">--query</span> <span class=\"token string\">\"PrefixLists[?PrefixListName=='com.amazonaws.<span class=\"token variable\">$AWS_REGION</span>.ipv6.vpc-lattice'].PrefixListId\"</span> <span class=\"token operator\">|</span> jq <span class=\"token parameter variable\">-r</span> <span class=\"token string\">'.[]'</span><span class=\"token variable\">)</span></span>\naws ec2 authorize-security-group-ingress --group-id <span class=\"token variable\">$CLUSTER_SG</span> --ip-permissions <span class=\"token string\">\"PrefixListIds=[{PrefixListId=<span class=\"token variable\">${PREFIX_LIST_ID_IPV6}</span>}],IpProtocol=-1\"</span></code></pre></div>\n<h4 id=\"-install-the-controller\" style=\"position:relative;\"><a href=\"#-install-the-controller\" aria-label=\" install the controller permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>📦 Install the Controller</h4>\n<p>This step will install the controller and the CRDs (Custom Resource Definitions) required to interact with the Kubernetes Gateway API.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">aws ecr-public get-login-password <span class=\"token parameter variable\">--region</span> us-east-1 <span class=\"token operator\">|</span> helm registry login <span class=\"token parameter variable\">--username</span> AWS --password-stdin public.ecr.aws\nhelm <span class=\"token function\">install</span> gateway-api-controller <span class=\"token punctuation\">\\</span>\n    oci://public.ecr.aws/aws-application-networking-k8s/aws-gateway-controller-chart <span class=\"token punctuation\">\\</span>\n    <span class=\"token parameter variable\">--version</span><span class=\"token operator\">=</span>v1.0.1 <span class=\"token punctuation\">\\</span>\n    --create-namespace <span class=\"token punctuation\">\\</span>\n    <span class=\"token parameter variable\">--set</span><span class=\"token operator\">=</span>aws.region<span class=\"token operator\">=</span><span class=\"token variable\">${AWS_REGION}</span> <span class=\"token punctuation\">\\</span>\n    <span class=\"token parameter variable\">--set</span> serviceAccount.annotations.<span class=\"token string\">\"eks\\.amazonaws\\.com/role-arn\"</span><span class=\"token operator\">=</span><span class=\"token string\">\"<span class=\"token variable\">$LATTICE_IAM_ROLE</span>\"</span> <span class=\"token punctuation\">\\</span>\n    <span class=\"token parameter variable\">--set</span><span class=\"token operator\">=</span>defaultServiceNetwork<span class=\"token operator\">=</span><span class=\"token variable\">${EKS_CLUSTER_NAME}</span> <span class=\"token punctuation\">\\</span>\n    <span class=\"token parameter variable\">--namespace</span> gateway-api-controller <span class=\"token punctuation\">\\</span>\n    <span class=\"token parameter variable\">--wait</span></code></pre></div>\n<p>The controller will now be running as a deployment:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">kubectl get deployment <span class=\"token parameter variable\">-n</span> gateway-api-controller\nNAME                                                  READY   UP-TO-DATE   AVAILABLE   AGE\ngateway-api-controller-aws-gateway-controller-chart   <span class=\"token number\">2</span>/2     <span class=\"token number\">2</span>            <span class=\"token number\">2</span>           24s</code></pre></div>\n<h3 id=\"-service-network\" style=\"position:relative;\"><a href=\"#-service-network\" aria-label=\" service network permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>🌐 Service Network</h3>\n<p>The Gateway API controller has been configured to create a VPC Lattice service network and associate a Kubernetes cluster VPC with it automatically. A service network is a logical boundary that's used to automatically implement service discovery and connectivity as well as apply access and observability policies to a collection of services.</p>\n<p>It offers inter-application connectivity over HTTP, HTTPS, and gRPC protocols within a VPC. As of today, the controller supports HTTP and HTTPS.</p>\n<h4 id=\"️-create-gatewayclass\" style=\"position:relative;\"><a href=\"#%EF%B8%8F-create-gatewayclass\" aria-label=\"️ create gatewayclass permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>🛠️ Create GatewayClass</h4>\n<p>Before creating a Gateway, we need to formalize the types of load balancing implementations that are available via the Kubernetes resource model with a GatewayClass.</p>\n<p>The controller that listens to the Gateway API relies on an associated GatewayClass resource that the user can reference from their Gateway:</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token comment\"># Create a new Gateway Class for AWS VPC lattice provider</span>\n<span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> gateway.networking.k8s.io/v1\n<span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> GatewayClass\n<span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> amazon<span class=\"token punctuation\">-</span>vpc<span class=\"token punctuation\">-</span>lattice\n<span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">controllerName</span><span class=\"token punctuation\">:</span> application<span class=\"token punctuation\">-</span>networking.k8s.aws/gateway<span class=\"token punctuation\">-</span>api<span class=\"token punctuation\">-</span>controller</code></pre></div>\n<h4 id=\"-create-gateway\" style=\"position:relative;\"><a href=\"#-create-gateway\" aria-label=\" create gateway permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>🚀 Create Gateway</h4>\n<p>The following YAML will create a Kubernetes Gateway resource which is associated with a VPC Lattice Service Network.</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> gateway.networking.k8s.io/v1\n<span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> Gateway\n<span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">{</span>EKS_CLUSTER_NAME<span class=\"token punctuation\">}</span>\n  <span class=\"token key atrule\">namespace</span><span class=\"token punctuation\">:</span> checkout\n<span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">gatewayClassName</span><span class=\"token punctuation\">:</span> amazon<span class=\"token punctuation\">-</span>vpc<span class=\"token punctuation\">-</span>lattice\n  <span class=\"token key atrule\">listeners</span><span class=\"token punctuation\">:</span>\n  <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> http\n    <span class=\"token key atrule\">protocol</span><span class=\"token punctuation\">:</span> HTTP\n    <span class=\"token key atrule\">port</span><span class=\"token punctuation\">:</span> <span class=\"token number\">80</span></code></pre></div>\n<p>Apply it and verify that the <code class=\"language-text\">eks-workshop</code> gateway is created:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">kubectl get gateway <span class=\"token parameter variable\">-n</span> checkout\nNAME                CLASS                ADDRESS   PROGRAMMED   AGE\neks-workshop        amazon-vpc-lattice             True         29s</code></pre></div>\n<p>Once the gateway is created, find the VPC Lattice service network. Wait until the status is Reconciled (this could take about five minutes).</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">kubectl describe gateway <span class=\"token variable\">${EKS_CLUSTER_NAME}</span> <span class=\"token parameter variable\">-n</span> checkout\napiVersion: gateway.networking.k8s.io/v1\nkind: Gateway\nstatus:\n   conditions:\n      message: <span class=\"token string\">'aws-gateway-arn: arn:aws:vpc-lattice:us-west-2:1234567890:servicenetwork/sn-03015ffef38fdc005'</span>\n      reason: Programmed\n      status: <span class=\"token string\">\"True\"</span>\n\nkubectl <span class=\"token function\">wait</span> <span class=\"token parameter variable\">--for</span><span class=\"token operator\">=</span>condition<span class=\"token operator\">=</span>Programmed gateway/<span class=\"token variable\">${EKS_CLUSTER_NAME}</span> <span class=\"token parameter variable\">-n</span> checkout</code></pre></div>\n<p>Now you can see the associated Service Network created in the VPC console under the Lattice resources in the <a href=\"https://aws.amazon.com/console/\" target=\"_blank\" rel=\"noopener noreferrer\">AWS console</a>.</p>\n<p><span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 21.764705882352942%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA2ElEQVR42jWQy27DIBBF/dlVpf5ZlXV33XSRbtJGcRw/MMZgBrArnYCbLK5gZuDc0a2GQfF7PnM6/dB1PSEEFu93+cf5VIyR2VqUUtyGCVt/og6vtIc3+vcXpP6g0tPEtblxqZtdTdvhnMO6BTNbbAYUiDEWL2E3DDEgIRIXzTp+E4Yj0n4xqyuVF8mP5/x5Jq0rbllQo2Yyhm3bcu13YLmH54bjyKh1rhPGBXrt8PEP56UAfW4KF2XReZhSophI3mR9QLp+IOZ+MZQ9kv95iaDEUhgxRUQCd5h8MAqHdbEcAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"Image description\" title=\"\" src=\"/static/8da85ab037d0548ad90c845f310986f1/c5bb3/svc-net.png\" srcset=\"/static/8da85ab037d0548ad90c845f310986f1/04472/svc-net.png 170w,\n/static/8da85ab037d0548ad90c845f310986f1/9f933/svc-net.png 340w,\n/static/8da85ab037d0548ad90c845f310986f1/c5bb3/svc-net.png 680w,\n/static/8da85ab037d0548ad90c845f310986f1/5a190/svc-net.png 800w\" sizes=\"(max-width: 680px) 100vw, 680px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n    </span>\n          </p>\n<h3 id=\"️-configuring-routes\" style=\"position:relative;\"><a href=\"#%EF%B8%8F-configuring-routes\" aria-label=\"️ configuring routes permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>⚙️ Configuring Routes</h3>\n<p>In this section, we will show how to use Amazon VPC Lattice for advanced traffic management with weighted routing for blue/green and canary-style deployments.</p>\n<p>Let's deploy a modified version of the checkout microservice with the added prefix \"Lattice\" in the shipping options. We'll deploy this new version in a new namespace (<code class=\"language-text\">checkoutv2</code>) using Kustomize.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">git</span> clone https://github.com/seifrajhi/gateaway-api-vpc-lattice.git\nkubectl apply <span class=\"token parameter variable\">-f</span> gateaway-api-vpc-lattice/abtesting/</code></pre></div>\n<p>The <code class=\"language-text\">checkoutv2</code> namespace now contains a second version of the application, while using the same Redis instance in the <code class=\"language-text\">checkout</code> namespace.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ kubectl get pods <span class=\"token parameter variable\">-n</span> checkoutv2\nNAME                        READY   STATUS    RESTARTS   AGE\ncheckout-854cd7cd66-s2blp   <span class=\"token number\">1</span>/1     Running   <span class=\"token number\">0</span>          26s</code></pre></div>\n<p>Now let's demonstrate how weighted routing works by creating <code class=\"language-text\">HTTPRoute</code> resources.</p>\n<p>First, we'll create a <code class=\"language-text\">TargetGroupPolicy</code> that tells Lattice how to properly perform health checks on our checkout service:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">kubectl apply <span class=\"token parameter variable\">-f</span> gateaway-api-vpc-lattice/target-group-policy/target-group-policy.yaml</code></pre></div>\n<p>Now create the Kubernetes <code class=\"language-text\">HTTPRoute</code> that distributes 75% traffic to <code class=\"language-text\">checkoutv2</code> and the remaining 25% traffic to <code class=\"language-text\">checkout</code>:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">kubectl apply <span class=\"token parameter variable\">-f</span> gateaway-api-vpc-lattice/routes/checkout-route.yaml</code></pre></div>\n<p>The creation of the associated resources may take 2–3 minutes. Run the following command to wait for it to complete:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ kubectl <span class=\"token function\">wait</span> <span class=\"token parameter variable\">-n</span> checkout <span class=\"token parameter variable\">--timeout</span><span class=\"token operator\">=</span>3m <span class=\"token punctuation\">\\</span>\n    <span class=\"token parameter variable\">--for</span><span class=\"token operator\">=</span>jsonpath<span class=\"token operator\">=</span><span class=\"token string\">'{.status.parents[-1:].conditions[-1:].reason}'</span><span class=\"token operator\">=</span>ResolvedRefs httproute/checkoutroute</code></pre></div>\n<p>Once completed, you will find the <code class=\"language-text\">HTTPRoute</code>'s DNS name from <code class=\"language-text\">HTTPRoute</code> status (highlighted here on the message line):</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ kubectl describe httproute checkoutroute <span class=\"token parameter variable\">-n</span> checkout\nName:         checkoutroute\nNamespace:    checkout\nLabels:       <span class=\"token operator\">&lt;</span>none<span class=\"token operator\">></span>\nAnnotations:  application-networking.k8s.aws/lattice-assigned-domain-name:\n                                checkoutroute-checkout-0d8e3f4604a069e36.7d67968.vpc-lattice-svcs.eu-west-1.on.aws\nAPI Version:  gateway.networking.k8s.io/v1beta1\nKind:         HTTPRoute\n<span class=\"token punctuation\">..</span>.\nStatus:\n    Parents:\n        Conditions:\n            Last Transition Time:  <span class=\"token number\">2023</span>-06-12T16:42:08Z\n            Message:               DNS Name: checkoutroute-checkout-0d8e3f4604a069e36.7d67968.vpc-lattice-svcs.us-east-2.on.aws\n            Reason:                ResolvedRefs\n            Status:                True\n            Type:                  ResolvedRefs\n<span class=\"token punctuation\">..</span>.</code></pre></div>\n<p>Now you can see the associated service created in the VPC Lattice console under the Lattice resources.</p>\n<p><span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 28.82352941176471%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAAAsTAAALEwEAmpwYAAABB0lEQVR42nVQ203EMBBMu/RCETRBEfxQwp0Qlzjx207iV5CGXQdOOgk+Ruv1PmZ2BiE1RiGgjMGWCrZcz7jv/2Ldtj8R1xXD5XrFOE0IMSLYBU5+wKkbQgjwnkCRa7/ROY+dlh7HgdbaHZwz2SCVwm2cSKWCeX+BeH3C+vaMmjeUUgnlAZlQa31YxDn3ssrBWId5WWCshdYS1irE4JBS6sPMmn8W7fSX9oRWG0ot1JPPes5Y6Vy+YkiUSO3Iu4Y1kX80oIkkl4yjHVDa9OYvUsIkQs9njXJLfeMkyJ7Y1cdIHrJMYSM+pYcw4c7IkRU58tE619/8J72Ei76r87SILZvnpfvLJ38DNWfLETnDQeoAAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"Service in VPC Lattice\" title=\"\" src=\"/static/2a13f3d9d8c64c80d2d86bf1e64de6c0/c5bb3/svc-lattice.png\" srcset=\"/static/2a13f3d9d8c64c80d2d86bf1e64de6c0/04472/svc-lattice.png 170w,\n/static/2a13f3d9d8c64c80d2d86bf1e64de6c0/9f933/svc-lattice.png 340w,\n/static/2a13f3d9d8c64c80d2d86bf1e64de6c0/c5bb3/svc-lattice.png 680w,\n/static/2a13f3d9d8c64c80d2d86bf1e64de6c0/5a190/svc-lattice.png 800w\" sizes=\"(max-width: 680px) 100vw, 680px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n    </span>\n          </p>\n<h2 id=\"-summary\" style=\"position:relative;\"><a href=\"#-summary\" aria-label=\" summary permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>🚀 <strong>Summary:</strong></h2>\n<p>In conclusion, the integration of Gateway API with AWS EKS and VPC Lattice has demonstrated significant improvements in networking efficiency and scalability.</p>\n<p>By optimizing configurations, this integration enhances the performance of AWS EKS clusters and simplifies networking tasks.</p>\n<p>Overall, it represents a promising advancement in AWS EKS networking, paving the way for smoother operations and increased resilience.</p>\n<br>\n<p><strong><em>Until next time, つづく 🎉</em></strong></p>\n<blockquote>\n<p>💡 Thank you for Reading !! 🙌🏻😁📃, see you in the next blog.🤘  <em><strong>Until next time 🎉</strong></em></p>\n</blockquote>\n<p>🚀 Thank you for sticking up till the end. If you have any questions/feedback regarding this blog feel free to connect with me:</p>\n<p><strong>♻️ LinkedIn:</strong> <a href=\"https://www.linkedin.com/in/rajhi-saif/\" target=\"_blank\" rel=\"noopener noreferrer\">https://www.linkedin.com/in/rajhi-saif/</a></p>\n<p><strong>♻️ X/Twitter:</strong> <a href=\"https://x.com/rajhisaifeddine\" target=\"_blank\" rel=\"noopener noreferrer\">https://x.com/rajhisaifeddine</a></p>\n<p><strong>The end ✌🏻</strong></p>\n<h1 align=\"center\">🔰 Keep Learning !! Keep Sharing !! 🔰</h1>\n<p><strong>📅 Stay updated</strong></p>\n<p>Subscribe to our newsletter for more insights on AWS cloud computing and containers.</p>"},"nextThought":{"frontmatter":{"path":"/blog/kubernetes-gateway-api-part1/","title":"Redefining Kubernetes networking with Gateway API: Part 1","date":"2024-10-19 13:06:00"},"excerpt":"Improving connectivity and security in k8s clusters 🕸 📕 Introduction The core ideas for this Gateway API were initially proposed by Bowei…","html":"<blockquote>\n<p><strong>Improving connectivity and security in k8s clusters 🕸</strong></p>\n</blockquote>\n<h2 id=\"-introduction\" style=\"position:relative;\"><a href=\"#-introduction\" aria-label=\" introduction permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>📕 Introduction</h2>\n<p>The core ideas for this Gateway API were initially <a href=\"https://youtu.be/Ne9UJL6irXY?si=jVRaFZpbjI1osfHq\" target=\"_blank\" rel=\"noopener noreferrer\">proposed by Bowei Du (Software Engineer, Google)</a> at KubeCon San Diego as \"Ingress v2\", the next generation of the Ingress API for Kubernetes.</p>\n<p>This proposal came as the shortcomings of the original Ingress API were becoming apparent.</p>\n<p>The <a href=\"https://gateway-api.sigs.k8s.io/\" target=\"_blank\" rel=\"noopener noreferrer\">Gateway API</a> is changing how traffic is managed in Kubernetes, giving more control and flexibility.</p>\n<p>The <a href=\"https://gateway-api.sigs.k8s.io/mesh/gamma/\" target=\"_blank\" rel=\"noopener noreferrer\">GAMMA</a> initiative highlights the collaboration to use Gateway API for Service Mesh, showing the industry's dedication to improving networking in Kubernetes.</p>\n<p>The <a href=\"https://www.gateway-api-controller.eks.aws.dev/dev/concepts/concepts/\" target=\"_blank\" rel=\"noopener noreferrer\">AWS Gateway API Controller</a> is key in connecting Kubernetes clusters with VPC Lattice, making it easier to manage networking resources.</p>\n<p>Keep following as we explore the impact of Gateway API and AWS VPC Lattice on Kubernetes networking, leading to a more efficient and secure infrastructure.</p>\n<p>This series of posts will look at how these technologies work together and show how combining the AWS Gateway API Controller with VPC Lattice enhances the efficiency and security of networking in AWS EKS clusters, thereby smoothing networking and improving connectivity in Kubernetes setups.</p>\n<h2 id=\"-ingress-limitations--the-gateway-api\" style=\"position:relative;\"><a href=\"#-ingress-limitations--the-gateway-api\" aria-label=\" ingress limitations  the gateway api permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>🚧 Ingress Limitations &#x26; the Gateway API</h2>\n<p>As per documentation: Ingress is frozen. New features are being added to the Gateway API.</p>\n<p><span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 64.11764705882354%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAABYlAAAWJQFJUiTwAAAB/ElEQVR42mVTiW7bMAzN/3/UCmzDsGVYO6DYurZp1yS+D12+EsvSG0XXXdIYeCD5RD+JpLQaRg/VeTSDh+k9Kj2hP0yQjYNuLXTnaN1BGIeaIJoJqnUolYPp5rz+6LF8KyEV9lGKKE4hpIZ1wOQ87ASCx8R2xjh55kLOaOf10XrOfxOM4xhXVx+w/vYV2+0Lk9ZaODeRmCVMJyCerHOOrSf7/lt1XQelFIKVUjLqukZZlqiqin0hBIqiYG7hg9Vas/iZYPjhZbujsiPsdjukaYY4ScimSNLQihgJxRGt7/cR+TO3f42HYTgXbJsGUlQwtJuSAlpJOrGkE7fsS1FDE98YzXzIlbJm/ng4XJZsBodNLPG4K/C4L/AUV3hOBP6mEttcY1cYtkucqgMjU0fk2sIM07lg2QKfbxN8vH7Ap5snfLndYn0X4fufBNebAj+fK9yQXVP84yHDphzxVFnCiPv8iMxYFlrmvOr7nkpT1GCDpm15KMEPDdfGwJgGivyGWhMQBiiE5MGEQV6U3DSGJzgjR5alyPOcMU+V+HKe8JJXkZ9lGW9+IdgOIzo6Jd8tgvf+zV9iBsfh7s33cHq9j2HtTPBXpPD77p5LWcoyVOpiufSw1vZo6Xm2fdjwv8iFYHOw3KeW+ncqdtqz0JauG+itOxJ1LLic/H3J/wBi3OYwXx/yXAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"Freeze Ingress\" title=\"\" src=\"/static/2d17ef3d49128f0db4eab8031b607c70/c5bb3/freeze-ingress.png\" srcset=\"/static/2d17ef3d49128f0db4eab8031b607c70/04472/freeze-ingress.png 170w,\n/static/2d17ef3d49128f0db4eab8031b607c70/9f933/freeze-ingress.png 340w,\n/static/2d17ef3d49128f0db4eab8031b607c70/c5bb3/freeze-ingress.png 680w,\n/static/2d17ef3d49128f0db4eab8031b607c70/b12f7/freeze-ingress.png 1020w,\n/static/2d17ef3d49128f0db4eab8031b607c70/b5a09/freeze-ingress.png 1360w,\n/static/2d17ef3d49128f0db4eab8031b607c70/169e3/freeze-ingress.png 1682w\" sizes=\"(max-width: 680px) 100vw, 680px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n    </span>\n          </p>\n<div class=\"image-title\"><a href=\"https://kubernetes.io/docs/concepts/services-networking/ingress/\">Source Documentation</a></div>\n<p>Traditional Kubernetes Ingress, while functional, often falls short in complex environments due to limitations such as restricted traffic routing, limited extensibility, minimal role-based access control, constrained protocol support, and inconsistent implementations.</p>\n<p>On the other hand, Custom Resource Definitions (CRDs) offer extensive flexibility but lack a standardized approach, leading to a landscape emphasizing flexibility over uniformity.</p>\n<p>Although IngressClass decouples the ingress gateway from the back-end implementation, it still has significant limitations.</p>\n<p>Ingress is too simple for most real-world use and it only supports HTTP protocol routing. It only supports host and path matching, and there is no standard configuration for advanced routing features, which can only be achieved through annotation, such as URL redirection using Nginx Ingress Controller, which requires configuration of <code class=\"language-text\">nginx.ingress.kubernetes.io/rewrite-target</code> annotation, which is no longer adaptable to the needs of a programmable proxy.</p>\n<p>The situation where services in different namespaces must be bound to the same gateway often arises in practical situations where the ingress gateway cannot be shared across multiple namespaces.</p>\n<p>No delineation of responsibilities for creating and managing ingress gateways, resulting in developers having to not only configure gateway routes but also create and manage gateways themselves.</p>\n<p>To tackle these challenges, the Kubernetes SIG-NETWORK group initiated the development of the Gateway API in 2019. The Kubernetes Gateway API serves as a unified and adaptable solution that seamlessly integrates with native Kubernetes resources, addresses advanced use cases, adopts a role-centric approach, and emphasizes portability.</p>\n<p>The core concept is to move away from a one-size-fits-all model and capitalize on the benefits of more comprehensive frameworks. The Gateway API represents a significant advancement beyond traditional Ingress; it presents a more capable, extensible, and secure solution for managing traffic in Kubernetes environments.</p>\n<h3 id=\"-gateway-api-vs-ingress\" style=\"position:relative;\"><a href=\"#-gateway-api-vs-ingress\" aria-label=\" gateway api vs ingress permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>🚀 Gateway API vs. Ingress</h3>\n<p>The Kubernetes Gateway API is a specification overseen by the <a href=\"https://github.com/kubernetes-sigs/gateway-api\" target=\"_blank\" rel=\"noopener noreferrer\">SIG-NETWORK community</a>, aimed at modeling service networking within Kubernetes. This API is crafted to enhance Kubernetes service networking through adaptable and role-oriented interfaces. As a standardized specification, projects, and organizations supporting the Gateway API must comply with its guidelines.</p>\n<table>\n<thead>\n<tr>\n<th><strong>Feature</strong></th>\n<th><strong>Ingress</strong></th>\n<th><strong>Gateway API</strong></th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>Traffic Routing</strong></td>\n<td>Basic HTTP routing and advanced routing features are not natively supported.</td>\n<td>Header-based matching, traffic weighting, typed routes, and different backend types.</td>\n</tr>\n<tr>\n<td><strong>Extensibility</strong></td>\n<td>Achieved with custom annotations through a vendor-specific approach.</td>\n<td>Allows users to define their own custom resources.</td>\n</tr>\n<tr>\n<td><strong>Standardization</strong></td>\n<td>Individual implementations with inconsistencies across different Ingress controllers.</td>\n<td>Universal specification that is supported across various implementations.</td>\n</tr>\n<tr>\n<td><strong>Role-Based Access Control</strong></td>\n<td>Does not natively let different teams manage different configuration sections.</td>\n<td>Allows individual teams to manage their traffic while cluster operators set the policies.</td>\n</tr>\n<tr>\n<td><strong>Protocol Support</strong></td>\n<td>To expose non-HTTP services to the internet, different Kubernetes resources are needed.</td>\n<td>Extensive protocol support.</td>\n</tr>\n<tr>\n<td><strong>Security</strong></td>\n<td>Basic support for TLS termination.</td>\n<td>Generally facilitates enhanced security controls which the cluster operators define.</td>\n</tr>\n</tbody>\n</table>\n<p>For more details, you can refer to the <a href=\"https://gateway-api.sigs.k8s.io/\" target=\"_blank\" rel=\"noopener noreferrer\">official Gateway API documentation</a>.</p>\n<h2 id=\"-gateway-api-concepts-and-features\" style=\"position:relative;\"><a href=\"#-gateway-api-concepts-and-features\" aria-label=\" gateway api concepts and features permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>🌐 Gateway API Concepts and Features</h2>\n<p>The Gateway API embodies four fundamental concepts: <strong>role-oriented approach</strong>, <strong>portability</strong>, <strong>expressiveness</strong>, and <strong>extensibility</strong>. These principles establish a versatile framework for Kubernetes service networking, empowering teams with enhanced control, advanced routing capabilities, flexible configurations, and standardized traffic management within Kubernetes clusters. When managing network traffic in Kubernetes, the Gateway API promises a comprehensive set of features that add value in the context of modern infrastructures.</p>\n<p><span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 87.64705882352942%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAASCAYAAABb0P4QAAAACXBIWXMAAAsTAAALEwEAmpwYAAACk0lEQVR42n1U2U4bQRD0//9K8hIleUGJIqEkioRQDkBgxxhjew+vvYf3nLvoHnvDAiYltT0zO1M9XVu9IzgHhigDiOIvrMywh0MP3tIIB6EOoR1amhuLFxi5A+H45xdMzt6jiG9gaaksS1RVhaapEa03mIYS48BgEmhcrxSWW4Oqc89SEyH/KCUxv7/H7e0Mq+US1hiYQ1hr0HYSi42iMLhPFOaJQZAaf+ujhIy6rlDsduiExDHYXhopwVXx1LkjJe812j+5uzjH8uYHqjx8FO+AsrVIK4usUshrQ2GPJn5C+OfXGN9OvyMKI0i6SVEUXsc0TbGIcgSZw++7vX7bnfFaHyXssVwFuB5PUdWtn+81tHAUu8ZgQySrpEGUCuSN9dq5/xEqpYhEQWvlyZ5D0nNOoLWmkEfoBoR92bIMcXb6EZ9OPvt50zS+fLYRW6goW6wLi0VCzlgrJDuLbWkp0cCHfTCSOMTV5SXGVDrfsm1bT7YjB0jRIYgzRJnGJDQ4nxJpopEUBsq4lyUz6WKxxGx2izgK9/o5C0MSPNoH3tAdLdWtojElHThtlCUxcnqLrEuPTvIBbjOLsu7IwNbPh5VwMtG16LrG6951nV8bfT35gHdv32C72fiu2KZckkCcWypL+0hJI/bdsHeruiZNW99hURR7WYQQGN1MZ7i4ukaW5VSaRl6UCFNJhI76VmC8ktgQIZOagfFqIuQIggBJkniNPWEcRUjWa3/lHkLz10XTBuVbsSKtpH5qEV8yEfQ24jHL8eSl8BvlB1J2lL30duEDDfU5B/uU9/D/a/hnGz6Y5znpEWE8mfgxt12eF96L8/ncR5Zlfv1VwqFlWAc+EIahJ2QivhFrxTqtSRpe57XXCB8AqwV0AaICF9kAAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"Gateway Schema\" title=\"\" src=\"/static/1d5defe45ad2ab92f234f1e9df7409df/c5bb3/gw-schema.png\" srcset=\"/static/1d5defe45ad2ab92f234f1e9df7409df/04472/gw-schema.png 170w,\n/static/1d5defe45ad2ab92f234f1e9df7409df/9f933/gw-schema.png 340w,\n/static/1d5defe45ad2ab92f234f1e9df7409df/c5bb3/gw-schema.png 680w,\n/static/1d5defe45ad2ab92f234f1e9df7409df/5a190/gw-schema.png 800w\" sizes=\"(max-width: 680px) 100vw, 680px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n    </span>\n          </p>\n<h3 id=\"️-classes\" style=\"position:relative;\"><a href=\"#%EF%B8%8F-classes\" aria-label=\"️ classes permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>🏷️ Classes</h3>\n<p><strong>GatewayClasses</strong> serve to formalize distinct load balancing implementations, simplifying users' comprehension of the diverse capabilities available through the Kubernetes resource model. By categorizing load balancing options, GatewayClasses offer users clarity and specificity regarding the features each option provides.</p>\n<h3 id=\"-gateways\" style=\"position:relative;\"><a href=\"#-gateways\" aria-label=\" gateways permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>🌉 Gateways</h3>\n<p>The Gateway API supports <strong>Shared Gateways</strong> and <strong>cross-Namespace functionality</strong>, enabling the sharing of load balancers and Virtual IPs (VIPs) by allowing independent Route resources to connect to the same Gateway. This feature facilitates secure infrastructure sharing among teams operating across different namespaces without necessitating direct coordination. It promotes efficiency and collaboration within Kubernetes environments.</p>\n<h3 id=\"️-routes\" style=\"position:relative;\"><a href=\"#%EF%B8%8F-routes\" aria-label=\"️ routes permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>🛤️ Routes</h3>\n<p>Unlike Ingress, which is confined to HTTP routing, the Gateway API broadens its scope by introducing <strong>Typed Routes</strong> and diverse backend support. This expanded flexibility enables the API to accommodate various protocols like HTTP and gRPC, along with a variety of backend targets, enhancing its versatility in managing network traffic effectively.</p>\n<h3 id=\"-gamma-initiative-extending-the-gateway-api-for-service-mesh-management\" style=\"position:relative;\"><a href=\"#-gamma-initiative-extending-the-gateway-api-for-service-mesh-management\" aria-label=\" gamma initiative extending the gateway api for service mesh management permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>🧩 GAMMA Initiative: Extending the Gateway API for Service Mesh Management</h3>\n<p>The <strong>GAMMA Initiative</strong> is a special project within the Gateway API group. It started in 2022 to make the Gateway API better for how services communicate within a cluster.</p>\n<p>Originally, the Gateway API was mainly for managing traffic from outside to inside a cluster (like a front door). But as more people wanted to use it for communication between services inside the cluster (like talking between rooms), the GAMMA Initiative was created.</p>\n<p>GAMMA's main goal is to make it easier to set up and manage how services talk to each other in a cluster. They want to do this without changing the Gateway API too much and keeping its main way of working.</p>\n<p>They also want all projects using the Gateway API for service communication to do it in a similar way, no matter what technology they use. It's interesting that around the same time, another project called <a href=\"https://www.envoyproxy.io/docs/envoy/latest/start/sandboxes/envoy-gateway\" target=\"_blank\" rel=\"noopener noreferrer\">Envoy Gateway</a> started too.</p>\n<p>This shows that many are interested in making the Gateway API work better for both inside-cluster communication (east-west) and outside-cluster traffic (north-south).</p>\n<p>This means that in the future, the Gateway API could be used not just for letting traffic in from outside but also for helping services talk to each other within Kubernetes clusters.</p>\n<p>The work of the GAMMA initiative will be captured in Gateway Enhancement Proposals that extend or refine the Gateway API specification to cover mesh and mesh-adjacent use cases. To date, these have been relatively small changes (albeit sometimes with relatively large impacts!) and we expect that to continue. Governance of the Gateway API specification remains solely with the maintainers of the Gateway API subproject.</p>\n<p>The ideal final outcome of the GAMMA initiative is that service mesh use cases become a first-party concern of Gateway API, at which point there will be no further need for a separate initiative.</p>\n<h3 id=\"-summary\" style=\"position:relative;\"><a href=\"#-summary\" aria-label=\" summary permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>📜 Summary</h3>\n<p>The Gateway API is like a newer version of the Kubernetes Ingress API. It provides a clearer set of rules for Kubernetes gateway providers compared to the older Ingress API.</p>\n<p>This upgrade enhances the features of the ingress gateway, making it easier to use and manage gateways by different groups. Additionally, the GAMMA initiative is working on combining the Ingress Gateway with the Gateway API for service mesh applications.</p>\n<p>There are plans to expand the Gateway API's capabilities to include east-west gateways through policy attachments.</p>\n<br>\n<p><strong><em>Until next time, つづく 🎉</em></strong></p>\n<blockquote>\n<p>💡 Thank you for Reading !! 🙌🏻😁📃, see you in the next blog.🤘  <em><strong>Until next time 🎉</strong></em></p>\n</blockquote>\n<p>🚀 Thank you for sticking up till the end. If you have any questions/feedback regarding this blog feel free to connect with me:</p>\n<p><strong>♻️ LinkedIn:</strong> <a href=\"https://www.linkedin.com/in/rajhi-saif/\" target=\"_blank\" rel=\"noopener noreferrer\">https://www.linkedin.com/in/rajhi-saif/</a></p>\n<p><strong>♻️ X/Twitter:</strong> <a href=\"https://x.com/rajhisaifeddine\" target=\"_blank\" rel=\"noopener noreferrer\">https://x.com/rajhisaifeddine</a></p>\n<p><strong>The end ✌🏻</strong></p>\n<h1 align=\"center\">🔰 Keep Learning !! Keep Sharing !! 🔰</h1>\n<p><strong>📅 Stay updated</strong></p>\n<p>Subscribe to our newsletter for more insights on AWS cloud computing and containers.</p>"}}},"staticQueryHashes":["1271460761","1321585977"],"slicesMap":{}}