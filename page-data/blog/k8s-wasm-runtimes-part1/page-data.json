{"componentChunkName":"component---src-templates-blog-template-js","path":"/blog/k8s-wasm-runtimes-part1/","result":{"data":{"markdownRemark":{"html":"<blockquote>\n<p><strong>Wasm on K8s: everything you need to know üê≥</strong></p>\n</blockquote>\n<h2 id=\"-introduction\" style=\"position:relative;\"><a href=\"#-introduction\" aria-label=\" introduction permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üìå Introduction</h2>\n<p>WebAssembly (<a href=\"https://webassembly.org/\" target=\"_blank\" rel=\"noopener noreferrer\">Wasm</a>) and Kubernetes (<a href=\"https://kubernetes.io/\" target=\"_blank\" rel=\"noopener noreferrer\">K8s</a>) are two of the most transformative technologies in cloud computing today. Wasm is a portable, lightweight bytecode format that enables developers to run code written in any language on the web. Kubernetes is a container orchestration platform that automates many of the tasks involved in deploying and managing containerized applications.</p>\n<p>Together, Wasm and K8s have the potential to revolutionize cloud-native application development. Wasm can be used to create portable, scalable, and secure applications that can run on any platform, including Kubernetes clusters. K8s can be used to manage and deploy Wasm applications at scale, making it easy to build and maintain complex cloud-native applications.</p>\n<p>In this blog post, we will explore the connection between Wasm and K8s and discuss their potential to usher in a new era of cloud-native application development. We will also discuss some of the challenges and opportunities that lie ahead for this emerging technology stack.</p>\n<h3 id=\"-webassembly-basics\" style=\"position:relative;\"><a href=\"#-webassembly-basics\" aria-label=\" webassembly basics permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üåê WebAssembly Basics</h3>\n<p>WebAssembly is a revolutionary new technology that is changing the way web applications are developed. It is a low-level binary format that can compile a variety of programming languages, including C, C++, and Rust. This allows developers to create web applications that are much faster and more efficient than those written in JavaScript alone.</p>\n<p>WebAssembly has three main advantages: <strong>speed</strong>, <strong>security</strong>, and <strong>support</strong>.</p>\n<ul>\n<li><strong>Speed</strong>: WebAssembly programs run at near-native speeds, which means that they can be just as fast as desktop applications.</li>\n<li><strong>Security</strong>: WebAssembly programs run in a memory-safe sandbox, which makes them more secure than JavaScript programs.</li>\n<li><strong>Support</strong>: WebAssembly is supported by all major browsers, so developers can be confident that their applications will work for all users.</li>\n</ul>\n<p>WebAssembly is already being used to create a wide variety of web applications, including games, video editing software, and even machine learning applications. As the technology continues to mature, it is likely to have an even greater impact on the web development landscape.</p>\n<h3 id=\"-docker-vs-wasm\" style=\"position:relative;\"><a href=\"#-docker-vs-wasm\" aria-label=\" docker vs wasm permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üêã Docker Vs WASM</h3>\n<p><span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 47.05882352941176%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsTAAALEwEAmpwYAAAClUlEQVR42i2RS0wTURiFZ+fGBS7duVGSggvUxAQwIXGjLkwIwcQHMSGsDBqjFBUiiRirEREihigFOmBiSwu2IFDoG2lDH0MftIWZDp3pw4KUFijumPb+3ku8yXfPuScnZ3Mpi49z2BkeLF62ZF/dRKaVKLIxPKFkYziwMTFWpbeX9an0ZcvhNBcQD8HD5UoeNouYWB6tYPWwu6WA+BccoaSDckYyJWfkD7iiWXBz+7C8tgUrbB5c67vIGdnBPgvGZU+FzuqpCPFZiCcPYEPYR+HNPNY9IMqKezgvgG8jU6LmXVGJnvgF6hkvzNjXYXDcAj9MYdDN+5FKswRzSxFkcPtlfrdb1m9lUetiBl6YEkjhSMFrRwZeWRMgN6Xg4UIalLaoRPWaI+iqToQGgwgtxiTcn0tAM9bGaRHVaRPQtcghs8FQ5Zo3VD2aZdGZ8ThUT8RR/c8kNGCu6ZNwUR2HszjvXoggqgdfNWMC3PguwJ1JEW5pBbiL9aZaQJdpATrwiGVm6sIS5vE0h86NpECmFND5ERGua1JQPiRA5XACKkaT0D2HB9u/xqRTjTmofZKHmrYDqG0rHGudPI/KGvPQ9FZAuS237DDnlt1WCOgkzqqf5lHd8wJU4+4VeYG84UR9Dtq+cEVKY44VFXRaej+ekDoG/FLn56DUNRiU3o0JR2/odJGe5ZF3PVhJIJ5kCjp+1DEQkDoxXYMhqedbUlLQKUlj5ouUk9mIb2cOQIxvI583BIwvfAzP/UY7W/jngvz+xynjaQLxJIuxKdxdA4bgi0BC2EFkg2xR34zecp09cK93dLK1b3hS3ksYUj9TTplatPZgk86+eon6f4jXWoNNowZHs+KT6uUHpaa9B3f7x/QPyAbZ+ger/BDFaCrfAQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"wasm-vs-docker\" title=\"\" src=\"/static/93c92163a0baaa2389b0523a5aef1f56/c5bb3/wasm-vs-docker.png\" srcset=\"/static/93c92163a0baaa2389b0523a5aef1f56/04472/wasm-vs-docker.png 170w,\n/static/93c92163a0baaa2389b0523a5aef1f56/9f933/wasm-vs-docker.png 340w,\n/static/93c92163a0baaa2389b0523a5aef1f56/c5bb3/wasm-vs-docker.png 680w,\n/static/93c92163a0baaa2389b0523a5aef1f56/5a190/wasm-vs-docker.png 800w\" sizes=\"(max-width: 680px) 100vw, 680px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n    </span>\n          </p>\n<p>Docker packages a program and its dependencies in a single image and then runs it as a container. A Docker container runs as a full file system (utilities, binaries, etc.), appearing to be a complete operating system for the application. Additionally, you need to create an image according to the right system architecture (e.g., Intel, ARM, etc.). For example, if someone has a Raspberry Pi OS running a Docker image, then you need to create an image for a C/C++ application based on a Linux image and compile it for the ARM processor system architecture. If not done, the container won't run as expected.</p>\n<p>On the other hand, a WASM module/binary is a precompiled C/C++ application that can run swiftly on a WASM runtime. It doesn't rely on or is coupled with the host OS or system architecture as it doesn't contain a precompiled file system or low-level OS primitives similar to Docker. Every directory and system resource is attached to the WASM module during runtime facilitated by <a href=\"https://wasi.dev/\" target=\"_blank\" rel=\"noopener noreferrer\">WASI</a>.</p>\n<h3 id=\"Ô∏è-docker-vs-wasm-performance\" style=\"position:relative;\"><a href=\"#%EF%B8%8F-docker-vs-wasm-performance\" aria-label=\"Ô∏è docker vs wasm performance permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>‚öñÔ∏è Docker vs WASM Performance</h3>\n<p><span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 43.529411764705884%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsTAAALEwEAmpwYAAABW0lEQVR42lWS2a6CQBBE+f9/4QtcXnzyhZhoohEBcTeCCwiCS+rmdDLGO8lklq6urq4Z7/l8qqoqxXGsy+Wi1+ulx+Ohoij0fr91Pp81n891vV4tBrYsy28sDEO7Y/R6PXlt2wpSCAGyr+vaCInt93stFguLcyaZGOR5nlux2+32n/B0Olml3W5n6lwSwOVyqc1mY4ScXQwc+CRJdDwejbDb7cr7fD7KsswSUIPCpml0v99tJUYi7UHCJEbLh8NBq9XKYox+vy8PwHq9traoRtsQoYJitL/dbm3l/NsyxdI0/bZsCmlnPB5rOp1qNBqZJyRTlQR8Qjkr01mBVeBQiShGp9ORBziKIpu07R4HIHsUoNxNijgvKYogfsCXEOmQYiytuWrc/arkS7EHh8+QUBQMeYzBYCAPw2ezmfUfBIE9AEajjuooxBLuOPPq7uXBD4dDTSYTs8L3ff0BOjOgIo6T3VoAAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"compare-performance\" title=\"\" src=\"/static/81d20f6e29ec6c5d3bddf48b3ab7e72c/c5bb3/compare-performance.png\" srcset=\"/static/81d20f6e29ec6c5d3bddf48b3ab7e72c/04472/compare-performance.png 170w,\n/static/81d20f6e29ec6c5d3bddf48b3ab7e72c/9f933/compare-performance.png 340w,\n/static/81d20f6e29ec6c5d3bddf48b3ab7e72c/c5bb3/compare-performance.png 680w,\n/static/81d20f6e29ec6c5d3bddf48b3ab7e72c/5a190/compare-performance.png 800w\" sizes=\"(max-width: 680px) 100vw, 680px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n    </span>\n          </p>\n<p>WASM provides near-native speed performance, quicker startup time, and high security, allowing C/C++/Rust/Go code to run in the browser and even outside the browser. Docker, on the other hand, provides runtime isolation and better portability.</p>\n<div class=\"note\">\n    <p><strong>üîµ Note:</strong></p>\n    <p>The key is that Wasm binaries don't rely on host OS or processor architectures like Docker containers. Instead, all the resources the Wasm module needs (such as environment variables and system resources) are provisioned to the Wasm module by the runtime through the WASI standard. This means Wasm modules are not coupled to the OS or underlying computer. It's an ideal mechanism for highly portable web-based application development.</p>\n</div>\n<h2 id=\"webassembly-on-kubernetes\" style=\"position:relative;\"><a href=\"#webassembly-on-kubernetes\" aria-label=\"webassembly on kubernetes permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>WebAssembly on Kubernetes</h2>\n<p>Kubernetes needs two things to be able to run WebAssembly workloads:</p>\n<ol>\n<li><strong>Worker nodes bootstrapped with a WebAssembly runtime.</strong></li>\n<li><strong>RuntimeClass objects mapping to nodes with a WebAssembly runtime.</strong></li>\n</ol>\n<p>We'll explain all of the following in more detail:</p>\n<ol>\n<li><strong>Worker node configuration with containerd and runwasi</strong></li>\n<li><strong>Bootstrapping Kubernetes workers with Wasm runtimes</strong></li>\n<li><strong>Using labels to target workloads</strong></li>\n<li><strong>RuntimeClasses and Wasm</strong></li>\n<li><strong>Wasm apps in Kubernetes Pods</strong></li>\n</ol>\n<h3 id=\"Ô∏è-containerd-and-runwasi\" style=\"position:relative;\"><a href=\"#%EF%B8%8F-containerd-and-runwasi\" aria-label=\"Ô∏è containerd and runwasi permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>‚öôÔ∏è containerd and runwasi</h3>\n<p>Most Kubernetes clusters use <a href=\"https://containerd.io/\" target=\"_blank\" rel=\"noopener noreferrer\">containerd</a> as the high-level runtime. It runs on every node and manages container lifecycle events such as create, start, stop, and delete. However, containerd only manages these events; it actually uses a low-level container runtime called <code class=\"language-text\">runc</code> to perform the actual work. A shim process sits between containerd and the low-level runtime and performs important tasks such as abstracting the low-level runtime.</p>\n<p>The architecture is shown below:</p>\n<p><span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 56.470588235294116%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAALABQDASIAAhEBAxEB/8QAFwABAQEBAAAAAAAAAAAAAAAABAABA//EABYBAQEBAAAAAAAAAAAAAAAAAAQCA//aAAwDAQACEAMQAAABEg3RZDWUaf/EABoQAQEAAgMAAAAAAAAAAAAAAAECAAMRITL/2gAIAQEAAQUC1iZbVFHDD0uV6//EABURAQEAAAAAAAAAAAAAAAAAAAEQ/9oACAEDAQE/AVn/xAAVEQEBAAAAAAAAAAAAAAAAAAAQEf/aAAgBAgEBPwGH/8QAGhAAAgIDAAAAAAAAAAAAAAAAAAECERAhof/aAAgBAQAGPwJOjceFMWf/xAAcEAADAQACAwAAAAAAAAAAAAABESEAMUFRgZH/2gAIAQEAAT8hRb2Tk6WIVEuKcCI6xOj5iL34xst//9oADAMBAAIAAwAAABDU7//EABcRAAMBAAAAAAAAAAAAAAAAAAABETH/2gAIAQMBAT8Qg4LD/8QAFxEAAwEAAAAAAAAAAAAAAAAAAAERMf/aAAgBAgEBPxBUqPT/xAAaEAEAAgMBAAAAAAAAAAAAAAABABExQVEh/9oACAEBAAE/ELxsLQgalJIWEKcRqOcskAej54nB2wjIat4VP//Z'); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"containerd-wasm\" title=\"\" src=\"/static/e6b38c010a7af6b060106bcb176d33af/7bf67/containerd-wasm.jpg\" srcset=\"/static/e6b38c010a7af6b060106bcb176d33af/651be/containerd-wasm.jpg 170w,\n/static/e6b38c010a7af6b060106bcb176d33af/d30a3/containerd-wasm.jpg 340w,\n/static/e6b38c010a7af6b060106bcb176d33af/7bf67/containerd-wasm.jpg 680w,\n/static/e6b38c010a7af6b060106bcb176d33af/4b190/containerd-wasm.jpg 800w\" sizes=\"(max-width: 680px) 100vw, 680px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n    </span>\n          </p>\n<p><a href=\"https://github.com/containerd/runwasi\" target=\"_blank\" rel=\"noopener noreferrer\">runwasi</a> is a containerd project that lets you swap out container runtimes for WebAssembly runtimes. It operates as a shim layer between containerd and low-level Wasm runtimes and enables WebAssembly workloads to seamlessly run on Kubernetes clusters. The architecture is shown below:</p>\n<p><span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 56.470588235294116%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAALABQDASIAAhEBAxEB/8QAFgABAQEAAAAAAAAAAAAAAAAAAAQD/8QAFgEBAQEAAAAAAAAAAAAAAAAABAEC/9oADAMBAAIQAxAAAAGXefVR4xm//8QAGhAAAQUBAAAAAAAAAAAAAAAAAgABAxIyMf/aAAgBAQABBQKIXR2JjGpBl+Sb/8QAFREBAQAAAAAAAAAAAAAAAAAAARD/2gAIAQMBAT8BZ//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8BP//EABwQAAEDBQAAAAAAAAAAAAAAAAABAhEhMWFxgf/aAAgBAQAGPwJrslYvAqDdnRT/xAAZEAACAwEAAAAAAAAAAAAAAAAAAREhMUH/2gAIAQEAAT8hSi7BUZamCgmXUORrBi//2gAMAwEAAgADAAAAEGgf/8QAFhEBAQEAAAAAAAAAAAAAAAAAEQAB/9oACAEDAQE/EMYjF//EABcRAQEBAQAAAAAAAAAAAAAAAAEAESH/2gAIAQIBAT8QDey3/8QAGxABAAMAAwEAAAAAAAAAAAAAAQARQSExYVH/2gAIAQEAAT8QGCPeWLPNnInx6uJ2lqPTxVsI2XXPYyr9wqf/2Q=='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"runwasi\" title=\"\" src=\"/static/e437674d03204e7e170d877f86a5c578/7bf67/runwasi.jpg\" srcset=\"/static/e437674d03204e7e170d877f86a5c578/651be/runwasi.jpg 170w,\n/static/e437674d03204e7e170d877f86a5c578/d30a3/runwasi.jpg 340w,\n/static/e437674d03204e7e170d877f86a5c578/7bf67/runwasi.jpg 680w,\n/static/e437674d03204e7e170d877f86a5c578/4b190/runwasi.jpg 800w\" sizes=\"(max-width: 680px) 100vw, 680px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n    </span>\n          </p>\n<p>Everything from containerd and below is opaque to Kubernetes‚Ää‚Äî‚ÄäKubernetes schedules work tasks to nodes and doesn't care if it's a traditional OCI container or a WebAssembly workload.</p>\n<h2 id=\"Ô∏è-bootstrapping-kubernetes-workers-with-wasm-runtimes\" style=\"position:relative;\"><a href=\"#%EF%B8%8F-bootstrapping-kubernetes-workers-with-wasm-runtimes\" aria-label=\"Ô∏è bootstrapping kubernetes workers with wasm runtimes permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üõ†Ô∏è Bootstrapping Kubernetes workers with Wasm runtimes</h2>\n<p>For a Kubernetes worker to execute WebAssembly workloads, it needs bootstrapping with a Wasm runtime. This is a two-step process:</p>\n<ol>\n<li><strong>Install the Wasm runtime</strong></li>\n<li><strong>Register the Wasm runtime with containerd</strong></li>\n</ol>\n<p>In most cases, your Kubernetes distro will provide a CLI or UI that automates these steps. However, we'll explain what's happening behind the scenes.</p>\n<p>Wasm runtimes are binary executables that should be installed on worker nodes in a path that's visible to containerd. They should also be named according to the containerd binary runtime naming convention. The following list shows the <code class=\"language-text\">wasmtime</code> and <code class=\"language-text\">spin</code> runtime binaries named appropriately and installed into the <code class=\"language-text\">/bin</code> directory:</p>\n<ul>\n<li><code class=\"language-text\">wasmtime</code>: <code class=\"language-text\">/bin/containerd-shim-wasmtime-v1</code></li>\n<li><code class=\"language-text\">spin</code>: <code class=\"language-text\">/bin/containerd-shim-spin-v1</code></li>\n</ul>\n<p>Once installed, runtimes need registering with containerd. This is done by adding them to the containerd config file, which is usually located at <code class=\"language-text\">/etc/containerd/config.toml</code>.</p>\n<p>The following extract shows how to register the <code class=\"language-text\">wasmtime</code> and <code class=\"language-text\">spin</code> runtimes in the containerd <code class=\"language-text\">config.toml</code> file:</p>\n<div class=\"gatsby-highlight\" data-language=\"toml\"><pre class=\"language-toml\"><code class=\"language-toml\"><span class=\"token punctuation\">[</span><span class=\"token table class-name\">plugins.cri.containerd.runtimes.wasmtime</span><span class=\"token punctuation\">]</span>\n    <span class=\"token key property\">runtime_type</span> <span class=\"token punctuation\">=</span> <span class=\"token string\">\"io.containerd.wasmtime.v1\"</span>\n<span class=\"token punctuation\">[</span><span class=\"token table class-name\">plugins.cri.containerd.runtimes.spin</span><span class=\"token punctuation\">]</span>\n    <span class=\"token key property\">runtime_type</span> <span class=\"token punctuation\">=</span> <span class=\"token string\">\"io.containerd.spin.v1\"</span></code></pre></div>\n<p>Once the Wasm runtimes are installed and registered, the final node configuration step is to label the nodes.</p>\n<h3 id=\"Ô∏è-using-labels-to-target-workloads\" style=\"position:relative;\"><a href=\"#%EF%B8%8F-using-labels-to-target-workloads\" aria-label=\"Ô∏è using labels to target workloads permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üè∑Ô∏è Using Labels to Target Workloads</h3>\n<p>If all of your cluster nodes have the same runtimes, you do not need to label them. However, if you have subsets of nodes with Wasm runtimes, you need to label them so that <a href=\"https://kubernetes.io/docs/concepts/containers/runtime-class/\" target=\"_blank\" rel=\"noopener noreferrer\">RuntimeClass</a> objects can target them.</p>\n<p>The following diagram shows a cluster with 6 nodes. Two have <code class=\"language-text\">runc</code>, 4 have <code class=\"language-text\">wasmtime</code>, and 2 have <code class=\"language-text\">spin</code>. See how the labels make it obvious which nodes have which runtimes.</p>\n<p><span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 23.52941176470588%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAIAAADKYVtkAAAACXBIWXMAAAsTAAALEwEAmpwYAAABPElEQVR42gExAc7+AIxh/Ydl+4du+4V0+oF594CC93qF9p+p+MLK+r7K+rjJ+His8G+v73C472y+7mrE7GjL62bS62TZ6WDe5wCTaP6VdP+KcfuHdvuQiP+EhvuMlPTJy+PJz+ePq/bFzua/zuCAuO+ky+rS3uiJzuuJ0enQ4uaj4Olg3ugA0cjvv7vVwLb0x776wL/Vvr/owsX/7fbv1+jqs8j56e/24fDostb24u349vbvvubxy+r39/Tx3fHwauHqANnX6La3v8a/8NPN+ra2vcXG4bq98dze2M3V27jK89LU2tjc2bDQ7eXw/Ofu7cTq89Ht+erv8N7y8m7i6gCvkf6xmv2ijvugkvyvqvyio/qPl/OgrO+bre6LqfOWteybve2Fuu+XzPSh1vWK0fCK1/Cd4/OS5PBl3+holOqS+VCT2wAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"labels\" title=\"\" src=\"/static/a1f4df8f6bf0d2034451ca55dda3cb2c/c5bb3/labels.png\" srcset=\"/static/a1f4df8f6bf0d2034451ca55dda3cb2c/04472/labels.png 170w,\n/static/a1f4df8f6bf0d2034451ca55dda3cb2c/9f933/labels.png 340w,\n/static/a1f4df8f6bf0d2034451ca55dda3cb2c/c5bb3/labels.png 680w,\n/static/a1f4df8f6bf0d2034451ca55dda3cb2c/898f6/labels.png 798w\" sizes=\"(max-width: 680px) 100vw, 680px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n    </span>\n          </p>\n<p>Be sure to use meaningful labels and avoid reserved namespaces such as <code class=\"language-text\">kubernetes.io</code> and <code class=\"language-text\">k8s.io</code>.</p>\n<p>The following command applies the <code class=\"language-text\">wasmtime-enabled=yes</code> label to a node called <code class=\"language-text\">wrkr3</code>. RuntimeClasses can use this label to send Wasm workloads to the node.</p>\n<div class=\"gatsby-highlight\" data-language=\"sh\"><pre class=\"language-sh\"><code class=\"language-sh\">$ kubectl label nodes wrkr3 wasmtime-enabled<span class=\"token operator\">=</span>yes</code></pre></div>\n<p>The output of the next command shows the label was correctly applied.</p>\n<div class=\"gatsby-highlight\" data-language=\"sh\"><pre class=\"language-sh\"><code class=\"language-sh\">$ kubectl get nodes --show-labels\nNAME     STATUS    ROLES    AGE     VERSION        LABELS\nwrkr1    Ready     <span class=\"token operator\">&lt;</span>none<span class=\"token operator\">></span>   5d      v1.25.1\nwrkr2    Ready     <span class=\"token operator\">&lt;</span>none<span class=\"token operator\">></span>   5d      v1.25.1\nwrkr3    Ready     <span class=\"token operator\">&lt;</span>none<span class=\"token operator\">></span>   2m      v1.25.1        wasmtime-enabled<span class=\"token operator\">=</span>yes</code></pre></div>\n<p>With Wasm runtimes installed, registered with containerd, and labels applied, a node is ready to execute Wasm tasks. The next step is to create a <a href=\"https://kubernetes.io/docs/concepts/containers/runtime-class/\" target=\"_blank\" rel=\"noopener noreferrer\">RuntimeClass</a> that sends Wasm workloads to the node(s).</p>\n<h2 id=\"Ô∏è-runtimeclasses-and-wasm\" style=\"position:relative;\"><a href=\"#%EF%B8%8F-runtimeclasses-and-wasm\" aria-label=\"Ô∏è runtimeclasses and wasm permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üè∑Ô∏è RuntimeClasses and Wasm</h2>\n<p><a href=\"https://kubernetes.io/docs/concepts/containers/runtime-class/\" target=\"_blank\" rel=\"noopener noreferrer\">RuntimeClasses</a> allow Kubernetes to schedule Pods to specific nodes and target specific runtimes. They have three important properties:</p>\n<ul>\n<li><strong>metadata.name</strong></li>\n<li><strong>scheduling.nodeSelector</strong></li>\n<li><strong>handler</strong></li>\n</ul>\n<p>The <strong>name</strong> is how you tell other objects, such as Pods, to use it. The <strong>nodeSelector</strong> tells Kubernetes which nodes to schedule work to. The <strong>handler</strong> tells containerd which runtime to use.</p>\n<p>The following <code class=\"language-text\">RuntimeClass</code> is called <code class=\"language-text\">wasm1</code>. The <code class=\"language-text\">scheduling.nodeSelector</code> property sends work to nodes with the <code class=\"language-text\">wasmtime-enabled=yes</code> label, and the <code class=\"language-text\">handler</code> property ensures the <code class=\"language-text\">wasmtime</code> runtime will execute the work.</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> node.k8s.io/v1\n<span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> RuntimeClass\n<span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"wasm1\"</span>\n<span class=\"token key atrule\">scheduling</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">nodeSelector</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">wasmtime-enabled</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"yes\"</span>\n<span class=\"token key atrule\">handler</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"wasmtime\"</span></code></pre></div>\n<p>The following diagram shows three worker nodes. One of them is running the <code class=\"language-text\">wasmtime</code> and <code class=\"language-text\">spin</code> runtimes and is labelled appropriately. The Pod and RuntimeClass on the left target work against the <code class=\"language-text\">wasmtime</code> runtime. The Pod and RuntimeClass on the right target work against the <code class=\"language-text\">spin</code> runtime.</p>\n<p><span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 56.470588235294116%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAAsTAAALEwEAmpwYAAACkElEQVR42h3PaVMSAQCAYf6eM019afqQRjnOpNkINDhSo6goaio2XgVJVkijqSlyKILkgamgHaApICws1x6wN7uwy7WZP+CZd17J0F1xdbwKRrnryxIC1Q53q5YlftkuKF6zKn1BOc/IzLTaQV2kmSjCghQPkDWjqWhDuKY4JOlrKFsMFF8O0USgUr6EUlk4WXcdCLJhVmVglR+Z5yZq1M0mceQkefUHBoJwxr9FnsKMNAFLNPfYWbngWa5sr5Y2v3EuZ2nPW9UZSp06tuu2LDfTynXKHCgsXtGmEGECyA2U0lxkGuOwRN3AWWZ4LE9DGSaf4ylSLAviulOQj9yW55mOBbp/iwZRKotReZpjKzVeqLnTeNMN7mvg1/Ukhp8zZKxeYyplQhRp1wEvH+FezRW7PrMdZnpsh0vmEX8iHMlkYgiShKB9CHucQCTaO6Jdz2K5X2jmN5I+J/BkVUhb3fzTvqJMl2+fyrUYac0Wc5wCnZGLIAofg4kLJO3BCCmASEbv18ektRlVYVJNvNHmDbOl6bdl3bvCqvVSM/ype8C44vnbYyN7PESvKzXkhdRH0GCE6ojmH8ag/9g6Xf++UrV/qfUqcKUM12jpDQedzoeOE4dB6CcMh9fOKKUtJ10CnuzAH4DCYpoxZqnmm+epR2IoSK5ZnEA0Oz/NdXfROFYulfnTDHaOZPf2vZFrAIxF4jDZtpHq9JHROGJd3AFAVAnhkslG0b+LL5gdvqPo3ERN9YIIBBgULQbimOPgbG3ZFk3AiTTqu8Za7bDCR/mvsub3myfnoPwGjz8Qh6RMd0uotz07qKz2vhQGhoVxvaB9X3zWF1RMhPstXP92UblNt7nxth9Eqwds+epv9oalSfQfz8T376hyLa8AAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"nodes\" title=\"\" src=\"/static/0265c0c10560eeea44387ae859d9595c/c5bb3/nodes.png\" srcset=\"/static/0265c0c10560eeea44387ae859d9595c/04472/nodes.png 170w,\n/static/0265c0c10560eeea44387ae859d9595c/9f933/nodes.png 340w,\n/static/0265c0c10560eeea44387ae859d9595c/c5bb3/nodes.png 680w,\n/static/0265c0c10560eeea44387ae859d9595c/5a190/nodes.png 800w\" sizes=\"(max-width: 680px) 100vw, 680px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n    </span>\n          </p>\n<p>With worker nodes configured and RuntimeClasses in place, the last thing to do is bind Pods to the correct RuntimeClass.</p>\n<h3 id=\"wasm-apps-in-kubernetes-pods\" style=\"position:relative;\"><a href=\"#wasm-apps-in-kubernetes-pods\" aria-label=\"wasm apps in kubernetes pods permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Wasm apps in Kubernetes Pods</h3>\n<p>The following YAML snippet targets the Pod at the wasm1 RuntimeClass. This will ensure the Pod gets assigned to a node and runtime specified in the wasm1 RuntimeClass.\nIn the real world, the Pod template will be embedded inside a higher order object such as a Deployment.</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> v1\n<span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> Pod\n<span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> wasm<span class=\"token punctuation\">-</span>test\n<span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">runtimeClassName</span><span class=\"token punctuation\">:</span> wasm1    &lt;&lt;&lt;&lt;==== Use this RuntimeClass\n  <span class=\"token key atrule\">container</span><span class=\"token punctuation\">:</span>\n  <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> ctr<span class=\"token punctuation\">-</span>wasm\n    <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> &lt;OCI image with Wasm module<span class=\"token punctuation\">></span>\n    <span class=\"token punctuation\">...</span></code></pre></div>\n<p>This Pod can be posted to the Kubernetes API server where it will use the wasm1 RuntimeClass to ensure it executes on the correct node with the correct runtime (handler).\nNotice how the Pod template defines a container even though it's deploying a Wasm app. This is because Kubernetes Pods were designed with containers in mind. For Wasm to work on Kubernetes, <strong>Wasm apps have to be packaged inside of OCI container images.</strong></p>\n<h2 id=\"-deploying-a-wasm-app\" style=\"position:relative;\"><a href=\"#-deploying-a-wasm-app\" aria-label=\" deploying a wasm app permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üöÄ Deploying a Wasm App</h2>\n<p>You'll need Docker Desktop and K3d to follow along, and the remainder of the article assumes you have these installed. You'll complete the following steps:</p>\n<ol>\n<li><strong>Build a K3d cluster</strong></li>\n<li><strong>Verify the runtime configuration</strong></li>\n<li><strong>Configure node labels</strong></li>\n<li><strong>Create a RuntimeClass</strong></li>\n<li><strong>Deploy an app</strong></li>\n<li><strong>Test the app</strong></li>\n<li><strong>Scale the app</strong></li>\n<li><strong>Inspect the containerd processes</strong></li>\n</ol>\n<h3 id=\"Ô∏è-build-a-k3d-kubernetes-cluster\" style=\"position:relative;\"><a href=\"#%EF%B8%8F-build-a-k3d-kubernetes-cluster\" aria-label=\"Ô∏è build a k3d kubernetes cluster permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üèóÔ∏è Build a K3d Kubernetes Cluster</h3>\n<p>Run the following command to create a 3-node K3d Kubernetes cluster. You'll need Docker Desktop installed and running, but you do not need the Docker Desktop Kubernetes cluster running.</p>\n<div class=\"gatsby-highlight\" data-language=\"sh\"><pre class=\"language-sh\"><code class=\"language-sh\">$ k3d cluster create wasm-cluster <span class=\"token punctuation\">\\</span>\n    <span class=\"token parameter variable\">--image</span> ghcr.io/deislabs/containerd-wasm-shims/examples/k3d:v0.5.1 <span class=\"token punctuation\">\\</span>\n    <span class=\"token parameter variable\">-p</span> <span class=\"token string\">\"8081:80@loadbalancer\"</span> <span class=\"token parameter variable\">--agents</span> <span class=\"token number\">2</span></code></pre></div>\n<p>Verify the cluster is up and running.</p>\n<div class=\"gatsby-highlight\" data-language=\"sh\"><pre class=\"language-sh\"><code class=\"language-sh\">$ kubectl get nodes\nNAME                        STATUS   ROLES                  AGE   VERSION\nk3d-wasm-cluster-server-0   Ready    control-plane,master   2m    v1.24.6+k3s1\nk3d-wasm-cluster-agent-0    Ready    <span class=\"token operator\">&lt;</span>none<span class=\"token operator\">></span>                 2m    v1.24.6+k3s1\nk3d-wasm-cluster-agent-1    Ready    <span class=\"token operator\">&lt;</span>none<span class=\"token operator\">></span>                 2m    v1.24.6+k3s1</code></pre></div>\n<p>The command to build the cluster used <a href=\"https://github.com/deislabs/containerd-wasm-shims/pkgs/container/containerd-wasm-shims%2Fexamples%2Fk3d\" target=\"_blank\" rel=\"noopener noreferrer\">an image</a> with the <a href=\"https://github.com/fermyon/spin\" target=\"_blank\" rel=\"noopener noreferrer\">spin</a> and <a href=\"https://github.com/deislabs/spiderlightning\" target=\"_blank\" rel=\"noopener noreferrer\">slight</a> Wasm runtimes pre-installed. These are vital to running WebAssembly apps on Kubernetes.</p>\n<h3 id=\"-verify-the-runtime-configuration\" style=\"position:relative;\"><a href=\"#-verify-the-runtime-configuration\" aria-label=\" verify the runtime configuration permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üîç Verify the Runtime Configuration</h3>\n<p>Use <code class=\"language-text\">docker exec</code> to log on to the <code class=\"language-text\">k3d-wasm-cluster-agent-0</code> node.</p>\n<div class=\"gatsby-highlight\" data-language=\"sh\"><pre class=\"language-sh\"><code class=\"language-sh\">$ <span class=\"token function\">docker</span> <span class=\"token builtin class-name\">exec</span> <span class=\"token parameter variable\">-it</span> k3d-wasm-cluster-agent-0 ash</code></pre></div>\n<p>Run all of the following commands from inside the exec session.</p>\n<p>Check the <code class=\"language-text\">/bin</code> directory for containerd shims named according to <a href=\"https://github.com/containerd/containerd/blob/main/core/runtime/v2/README.md\" target=\"_blank\" rel=\"noopener noreferrer\">the containerd shim naming convention</a>.</p>\n<div class=\"gatsby-highlight\" data-language=\"sh\"><pre class=\"language-sh\"><code class=\"language-sh\">$ <span class=\"token function\">ls</span> /bin <span class=\"token operator\">|</span> <span class=\"token function\">grep</span> containerd-\ncontainerd-shim-runc-v2\ncontainerd-shim-slight-v1\ncontainerd-shim-spin-v1</code></pre></div>\n<p>You can see the <a href=\"https://github.com/opencontainers/runc\" target=\"_blank\" rel=\"noopener noreferrer\">runc</a>, <a href=\"https://github.com/deislabs/spiderlightning\" target=\"_blank\" rel=\"noopener noreferrer\">slight</a>, and <a href=\"https://www.fermyon.com/spin\" target=\"_blank\" rel=\"noopener noreferrer\">spin</a> shims. <code class=\"language-text\">runc</code> is the default low-level runtime for running containers on Kubernetes and is present on all worker nodes running containerd. <code class=\"language-text\">spin</code> and <code class=\"language-text\">slight</code> are Wasm runtimes for running WebAssembly apps on Kubernetes.</p>\n<p>With the shims installed correctly, run a <code class=\"language-text\">ps</code> command to verify containerd is running.</p>\n<div class=\"gatsby-highlight\" data-language=\"sh\"><pre class=\"language-sh\"><code class=\"language-sh\"><span class=\"token comment\"># ps</span>\nPID     <span class=\"token environment constant\">USER</span>     COMMAND\n<span class=\"token operator\">&lt;</span>Snip<span class=\"token operator\">></span>\n     <span class=\"token number\">58</span>   <span class=\"token number\">0</span>        containerd <span class=\"token parameter variable\">-c</span> /var/lib/rancher/k3s/agent/etc/containerd/config.toml<span class=\"token punctuation\">..</span>.</code></pre></div>\n<p>The output is trimmed, but it shows the containerd process is running. The <code class=\"language-text\">-c</code> flag is used to pass containerd a custom location for the <a href=\"https://github.com/containerd/containerd/blob/main/docs/man/containerd-config.toml.5.md\" target=\"_blank\" rel=\"noopener noreferrer\">config.toml</a> file.</p>\n<p>List the contents of this <code class=\"language-text\">config.toml</code> to see the registered runtimes.</p>\n<div class=\"gatsby-highlight\" data-language=\"sh\"><pre class=\"language-sh\"><code class=\"language-sh\">$ <span class=\"token function\">cat</span> /var/lib/rancher/k3s/agent/etc/containerd/config.toml\n<span class=\"token operator\">&lt;</span>Snip<span class=\"token operator\">></span>\n<span class=\"token punctuation\">[</span>plugins.cri.containerd.runtimes.runc<span class=\"token punctuation\">]</span>\n    runtime_type <span class=\"token operator\">=</span> <span class=\"token string\">\"io.containerd.runc.v2\"</span>\n<span class=\"token punctuation\">[</span>plugins.cri.containerd.runtimes.spin<span class=\"token punctuation\">]</span>\n    runtime_type <span class=\"token operator\">=</span> <span class=\"token string\">\"io.containerd.spin.v1\"</span>\n<span class=\"token punctuation\">[</span>plugins.cri.containerd.runtimes.slight<span class=\"token punctuation\">]</span>\n    runtime_type <span class=\"token operator\">=</span> <span class=\"token string\">\"io.containerd.slight.v1\"</span></code></pre></div>\n<p><code class=\"language-text\">runc</code>, <code class=\"language-text\">spin</code>, and <code class=\"language-text\">slight</code> are all installed and registered with containerd.</p>\n<p>You can repeat these steps for the other two nodes and will get similar results as all three are running containerd and are configured with the <code class=\"language-text\">spin</code> and <code class=\"language-text\">slight</code> Wasm runtimes.</p>\n<p>The next step is to label your nodes.</p>\n<h3 id=\"Ô∏è-configure-node-labels\" style=\"position:relative;\"><a href=\"#%EF%B8%8F-configure-node-labels\" aria-label=\"Ô∏è configure node labels permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üè∑Ô∏è Configure Node Labels</h3>\n<p>We'll add a custom label to a single worker node and use it in a future step to force Wasm apps onto just that node. Run the following command to add the <code class=\"language-text\">spin=yes</code> label to the <code class=\"language-text\">k3d-wasm-cluster-agent-0</code> worker node.</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">$ kubectl label nodes k3d-wasm-cluster-agent-0 <span class=\"token assign-left variable\">spin</span><span class=\"token operator\">=</span>yes</code></pre></div>\n<p>Verify the operation. Your output will be longer, but only the <code class=\"language-text\">k3d-wasm-cluster-agent-0</code> should be displayed.</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">$ kubectl get nodes --show-labels <span class=\"token operator\">|</span> <span class=\"token function\">grep</span> spin\nNAME                        STATUS   ROLES     <span class=\"token punctuation\">..</span>.  LABELS\nk3d-wasm-cluster-agent-0    Ready    <span class=\"token operator\">&lt;</span>none<span class=\"token operator\">></span>    <span class=\"token punctuation\">..</span>.  beta.kubernetes<span class=\"token punctuation\">..</span>., <span class=\"token assign-left variable\">spin</span><span class=\"token operator\">=</span>yes</code></pre></div>\n<p>At this point, <code class=\"language-text\">k3d-wasm-cluster-agent-0</code> is the only node with the <code class=\"language-text\">spin=yes</code> label. In the next step, you'll create a RuntimeClass that targets this node.</p>\n<h3 id=\"-create-a-runtimeclass\" style=\"position:relative;\"><a href=\"#-create-a-runtimeclass\" aria-label=\" create a runtimeclass permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üèÉ Create a RuntimeClass</h3>\n<p>The following YAML defines a RuntimeClass called <code class=\"language-text\">spin-test</code>. It selects nodes with the <code class=\"language-text\">spin=yes</code> label and specifies the <code class=\"language-text\">spin</code> runtime as the handler.</p>\n<p>Copy and paste the whole block into your terminal to deploy it.</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">kubectl apply <span class=\"token parameter variable\">-f</span> - <span class=\"token operator\">&lt;&lt;</span><span class=\"token string\">EOF\napiVersion: node.k8s.io/v1\nkind: RuntimeClass\nmetadata:\n    name: spin-test\nhandler: spin\nscheduling:\n    nodeSelector:\n        spin: \"yes\"\nEOF</span></code></pre></div>\n<p>The following command verifies the RuntimeClass was created and is available.</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">$ kubectl get runtimeclass\nNAME         HANDLER   AGE\nspin-test    spin      10s</code></pre></div>\n<p>At this point, you have a 3-node Kubernetes cluster, and all three nodes have the <code class=\"language-text\">spin</code> runtime installed. You also have a RuntimeClass that can be used to schedule tasks against the <code class=\"language-text\">k3d-wasm-cluster-agent-0</code> node. This means you're ready to run WebAssembly apps on Kubernetes!</p>\n<p>In the next step, you'll deploy a Kubernetes app.</p>\n<h3 id=\"Ô∏è-deploy-an-app\" style=\"position:relative;\"><a href=\"#%EF%B8%8F-deploy-an-app\" aria-label=\"Ô∏è deploy an app permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üèóÔ∏è Deploy an App</h3>\n<p>You can find the app code here: <a href=\"https://github.com/spinkube/containerd-shim-spin\" target=\"_blank\" rel=\"noopener noreferrer\">containerd-wasm-shims</a>.</p>\n<p>The following YAML snippet is from the <a href=\"https://github.com/nigelpoulton/spin1/blob/main/app.yml\" target=\"_blank\" rel=\"noopener noreferrer\">app</a> you're about to deploy. The only bit we're interested in is the <code class=\"language-text\">spec.template.spec.runtimeClassName = spin-test</code> field. This tells Kubernetes to use the <code class=\"language-text\">spin-test</code> RuntimeClass you created in the previous step. This will schedule the app to the correct node and ensure it executes with the appropriate handler (runtime).</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> apps/v1\n<span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> Deployment\n<span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> wasm<span class=\"token punctuation\">-</span>spin\n<span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">replicas</span><span class=\"token punctuation\">:</span> <span class=\"token number\">1</span>\n    <span class=\"token punctuation\">...</span>\n    <span class=\"token key atrule\">template</span><span class=\"token punctuation\">:</span>\n        <span class=\"token punctuation\">...</span>\n        <span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span>\n            <span class=\"token key atrule\">runtimeClassName</span><span class=\"token punctuation\">:</span> spin<span class=\"token punctuation\">-</span>test     &lt;&lt;==== Targets the RuntimeClass\n            containers<span class=\"token punctuation\">:</span></code></pre></div>\n<p>Deploy it with the following command:</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">kubectl apply <span class=\"token parameter variable\">-f</span> https://raw.githubusercontent.com/seifrajhi/wasm-k8s/main/wasp-app.yaml</code></pre></div>\n<p>Verify the app was deployed. It might take a few seconds for it to enter the ready state and it will only work if you followed all previous steps.</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">$ kubectl get deploy\nNAME          READY   UP-TO-DATE   AVAILABLE   AGE\nwasm-spin     <span class=\"token number\">1</span>/1     <span class=\"token number\">1</span>            <span class=\"token number\">1</span>           14s</code></pre></div>\n<p>Verify it's running on the correct node:</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">$ kubectl get pods <span class=\"token parameter variable\">-o</span> wide\nNAME                         READY   STATUS    AGE   NODE\nwasm-spin-74cff79dcb-npwwj   <span class=\"token number\">1</span>/1     Running   86s   k3d-wasm-cluster-agent-0</code></pre></div>\n<p>It's running on the <code class=\"language-text\">k3d-wasm-cluster-agent-0</code> worker node that has the label and handler specified in the RuntimeClass. Test the app is working by pointing your browser to <a href=\"http://localhost:8081/spin/hello\" target=\"_blank\" rel=\"noopener noreferrer\">http://localhost:8081/spin/hello</a> or by running the following curl command:</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">$ <span class=\"token function\">curl</span> <span class=\"token parameter variable\">-v</span> http://127.0.0.1:8081/spin/hello\n<span class=\"token operator\">&lt;</span>Snip<span class=\"token operator\">></span>\nHello world from Spin<span class=\"token operator\">!</span></code></pre></div>\n<p>Congratulations, the application is successfully deployed to the worker node specified in the RuntimeClass. In the next step, you'll scale the app to prove that all replicas get scheduled to the same node.</p>\n<h3 id=\"-scale-the-app\" style=\"position:relative;\"><a href=\"#-scale-the-app\" aria-label=\" scale the app permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üìà Scale the App</h3>\n<p>Increase the number of replicas from 1 to 3:</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">$ kubectl scale <span class=\"token parameter variable\">--replicas</span> <span class=\"token number\">3</span> deploy/wasm-spin\ndeployment.apps/wasm-spin scaled</code></pre></div>\n<p>Verify all three Pods are running on the <code class=\"language-text\">k3d-wasm-cluster-agent-0</code> node:</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">$ kubectl get pods <span class=\"token parameter variable\">-o</span> wide\nNAME                         READY   STATUS     AGE     NODE\nwasm-spin-74cff79dcb-npwwj   <span class=\"token number\">1</span>/1     Running    3m32s   k3d-wasm-cluster-agent-0\nwasm-spin-74cff79dcb-vsz7t   <span class=\"token number\">1</span>/1     Running    7s      k3d-wasm-cluster-agent-0\nwasm-spin-74cff79dcb-q4vxr   <span class=\"token number\">1</span>/1     Running    7s      k3d-wasm-cluster-agent-0</code></pre></div>\n<p>The RuntimeClass is doing its job of ensuring the Wasm workloads run on the correct node.</p>\n<h3 id=\"-inspect-the-containerd-processes\" style=\"position:relative;\"><a href=\"#-inspect-the-containerd-processes\" aria-label=\" inspect the containerd processes permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üîç Inspect the containerd Processes</h3>\n<p>Exec onto the <code class=\"language-text\">k3d-wasm-cluster-agent-0</code> node:</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">$ <span class=\"token function\">docker</span> <span class=\"token builtin class-name\">exec</span> <span class=\"token parameter variable\">-it</span> k3d-wasm-cluster-agent-0 ash</code></pre></div>\n<p>Run the following commands from inside the exec session:</p>\n<p>List running spin processes:</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token comment\"># ps | grep spin</span>\nPID    <span class=\"token environment constant\">USER</span>  COMMAND\n<span class=\"token operator\">&lt;</span>Snip<span class=\"token operator\">></span>\n<span class=\"token number\">1764</span>  <span class=\"token number\">0</span>     <span class=\"token punctuation\">{</span>containerd-shim<span class=\"token punctuation\">}</span><span class=\"token punctuation\">..</span>./bin/containerd-shim-spin-v1 <span class=\"token parameter variable\">-namespace</span> k8s.io <span class=\"token parameter variable\">-id</span> <span class=\"token punctuation\">..</span>.\n<span class=\"token number\">2015</span>  <span class=\"token number\">0</span>     <span class=\"token punctuation\">{</span>containerd-shim<span class=\"token punctuation\">}</span><span class=\"token punctuation\">..</span>./bin/containerd-shim-spin-v1 <span class=\"token parameter variable\">-namespace</span> k8s.io <span class=\"token parameter variable\">-id</span> <span class=\"token punctuation\">..</span>.\n<span class=\"token number\">2017</span>  <span class=\"token number\">0</span>     <span class=\"token punctuation\">{</span>containerd-shim<span class=\"token punctuation\">}</span><span class=\"token punctuation\">..</span>./bin/containerd-shim-spin-v1 <span class=\"token parameter variable\">-namespace</span> k8s.io <span class=\"token parameter variable\">-id</span> <span class=\"token punctuation\">..</span>.</code></pre></div>\n<p>The output is trimmed, but you can see three <code class=\"language-text\">containerd-shim-spin-v1</code> processes. This is one shim process for each of the three replicas.</p>\n<p>The long hex ID attached to each of the three shim processes is the ID of the associated container task. This is because containerd runs each Wasm task inside its own container.</p>\n<p>Run the following command to list containers on the host. Notice how some of the container task IDs match with the hex IDs associated with the spin shim processes from the previous command. The PID also matches the PID of the spin shim processes.</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">$ ctr task <span class=\"token function\">ls</span>\nTASK                                                                PID     STATUS\n3f083847f6818c3f76ff0e9927b3a81f84f4bf1415a32e09f2a37ed2a528aed1    <span class=\"token number\">2015</span>    RUNNING\nf8166727d7d10220e55aa82d6185a0c7b9b7e66a4db77cc5ca4973f1c8909f85    <span class=\"token number\">2017</span>    RUNNING\n78c8b0b17213d895f4758288500dc4e1e88d7aa7181fe6b9d69268dffafbd95b    <span class=\"token number\">1764</span>    RUNNING\n<span class=\"token operator\">&lt;</span>/Snip<span class=\"token operator\">></span></code></pre></div>\n<p>The output is trimmed to only show the Wasm containers.</p>\n<p>You can see more detailed info with the info command:</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">$ ctr containers info 3f083847f6<span class=\"token punctuation\">..</span>.a37ed2a528aed1\n<span class=\"token punctuation\">{</span>\n        <span class=\"token operator\">&lt;</span>Snip<span class=\"token operator\">></span>\n        <span class=\"token string\">\"Runtime\"</span><span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token string\">\"Name\"</span><span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"io.containerd.spin.v1\"</span>,\n                <span class=\"token operator\">&lt;</span>Snip<span class=\"token operator\">></span>\n                <span class=\"token string\">\"annotations\"</span><span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">{</span>\n                        <span class=\"token string\">\"io.kubernetes.cri.container-name\"</span><span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"spin-hello\"</span>,\n                        <span class=\"token string\">\"io.kubernetes.cri.container-type\"</span><span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"container\"</span>,\n                        <span class=\"token string\">\"io.kubernetes.cri.image-name\"</span><span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"ghcr.io/deislabs/containerd-wasm-shims/examples/spin-rust-hello:v0.5.1\"</span>,\n                        <span class=\"token string\">\"io.kubernetes.cri.sandbox-id\"</span><span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"3f083847f6818c3f76ff0e9927b3a81f84f4bf1415a32e09f2a37ed2a528aed1\"</span>,\n                        <span class=\"token string\">\"io.kubernetes.cri.sandbox-name\"</span><span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"wasm-spin-5bd4bd7b9-kqgjt\"</span>,\n                        <span class=\"token string\">\"io.kubernetes.cri.sandbox-namespace\"</span><span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"default\"</span>\n                        <span class=\"token operator\">&lt;</span>Snip<span class=\"token operator\">></span></code></pre></div>\n<p>If you examine the output of the previous command, you'll see typical container constructs such as namespaces and cgroups. The WebAssembly app is executing inside the normal WebAssembly sandbox, which, in turn, is executing inside a minimal container.</p>\n<h2 id=\"-summary\" style=\"position:relative;\"><a href=\"#-summary\" aria-label=\" summary permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üçâ Summary</h2>\n<p>WebAssembly is a new technology that is changing the way cloud-native applications are developed and deployed. It is now possible to run WebAssembly applications on Kubernetes, which means that developers can take advantage of the performance, security, and portability of WebAssembly while also benefiting from the scalability and manageability of Kubernetes.</p>\n<p>To run WebAssembly applications on Kubernetes, you need to bootstrap Kubernetes worker nodes with a WebAssembly runtime and use RuntimeClasses to map WebAssembly applications to the appropriate nodes. This is a relatively new process, but it is becoming increasingly popular as WebAssembly matures and becomes more widely adopted.\n<br></p>\n<p><strong><em>Until next time, „Å§„Å•„Åè üéâ</em></strong></p>\n<blockquote>\n<p>üí° Thank you for Reading !! üôåüèªüòÅüìÉ, see you in the next blog.ü§ò  <strong><em>Until next time üéâ</em></strong></p>\n</blockquote>\n<p>üöÄ Thank you for sticking up till the end. If you have any questions/feedback regarding this blog feel free to connect with me:</p>\n<p><strong>‚ôªÔ∏è LinkedIn:</strong> <a href=\"https://www.linkedin.com/in/rajhi-saif/\" target=\"_blank\" rel=\"noopener noreferrer\">https://www.linkedin.com/in/rajhi-saif/</a></p>\n<p><strong>‚ôªÔ∏è X/Twitter:</strong> <a href=\"https://x.com/rajhisaifeddine\" target=\"_blank\" rel=\"noopener noreferrer\">https://x.com/rajhisaifeddine</a></p>\n<p><strong>The end ‚úåüèª</strong></p>\n<h1 align=\"center\">üî∞ Keep Learning !! Keep Sharing !! üî∞</h1>\n<p><strong>üìÖ Stay updated</strong></p>\n<p>Subscribe to our newsletter for more insights on AWS cloud computing and containers.</p>","timeToRead":14,"rawMarkdownBody":"\n> **Wasm on K8s: everything you need to know üê≥**\n\n## üìå Introduction\n\n\nWebAssembly ([Wasm](https://webassembly.org/)) and Kubernetes ([K8s](https://kubernetes.io/)) are two of the most transformative technologies in cloud computing today. Wasm is a portable, lightweight bytecode format that enables developers to run code written in any language on the web. Kubernetes is a container orchestration platform that automates many of the tasks involved in deploying and managing containerized applications.\n\nTogether, Wasm and K8s have the potential to revolutionize cloud-native application development. Wasm can be used to create portable, scalable, and secure applications that can run on any platform, including Kubernetes clusters. K8s can be used to manage and deploy Wasm applications at scale, making it easy to build and maintain complex cloud-native applications.\n\nIn this blog post, we will explore the connection between Wasm and K8s and discuss their potential to usher in a new era of cloud-native application development. We will also discuss some of the challenges and opportunities that lie ahead for this emerging technology stack.\n\n### üåê WebAssembly Basics\n\nWebAssembly is a revolutionary new technology that is changing the way web applications are developed. It is a low-level binary format that can compile a variety of programming languages, including C, C++, and Rust. This allows developers to create web applications that are much faster and more efficient than those written in JavaScript alone.\n\nWebAssembly has three main advantages: **speed**, **security**, and **support**.\n\n- **Speed**: WebAssembly programs run at near-native speeds, which means that they can be just as fast as desktop applications.\n- **Security**: WebAssembly programs run in a memory-safe sandbox, which makes them more secure than JavaScript programs.\n- **Support**: WebAssembly is supported by all major browsers, so developers can be confident that their applications will work for all users.\n\nWebAssembly is already being used to create a wide variety of web applications, including games, video editing software, and even machine learning applications. As the technology continues to mature, it is likely to have an even greater impact on the web development landscape.\n\n### üêã Docker Vs WASM\n\n![wasm-vs-docker](./wasm-vs-docker.png)\n\nDocker packages a program and its dependencies in a single image and then runs it as a container. A Docker container runs as a full file system (utilities, binaries, etc.), appearing to be a complete operating system for the application. Additionally, you need to create an image according to the right system architecture (e.g., Intel, ARM, etc.). For example, if someone has a Raspberry Pi OS running a Docker image, then you need to create an image for a C/C++ application based on a Linux image and compile it for the ARM processor system architecture. If not done, the container won't run as expected.\n\nOn the other hand, a WASM module/binary is a precompiled C/C++ application that can run swiftly on a WASM runtime. It doesn't rely on or is coupled with the host OS or system architecture as it doesn't contain a precompiled file system or low-level OS primitives similar to Docker. Every directory and system resource is attached to the WASM module during runtime facilitated by [WASI](https://wasi.dev/).\n\n### ‚öñÔ∏è Docker vs WASM Performance\n\n![compare-performance](./compare-performance.png)\n\nWASM provides near-native speed performance, quicker startup time, and high security, allowing C/C++/Rust/Go code to run in the browser and even outside the browser. Docker, on the other hand, provides runtime isolation and better portability.\n\n<div class=\"note\">\n    <p><strong>üîµ Note:</strong></p>\n    <p>The key is that Wasm binaries don't rely on host OS or processor architectures like Docker containers. Instead, all the resources the Wasm module needs (such as environment variables and system resources) are provisioned to the Wasm module by the runtime through the WASI standard. This means Wasm modules are not coupled to the OS or underlying computer. It's an ideal mechanism for highly portable web-based application development.</p>\n</div>\n\n## WebAssembly on Kubernetes\n\nKubernetes needs two things to be able to run WebAssembly workloads:\n1. **Worker nodes bootstrapped with a WebAssembly runtime.**\n2. **RuntimeClass objects mapping to nodes with a WebAssembly runtime.**\n\nWe'll explain all of the following in more detail:\n1. **Worker node configuration with containerd and runwasi**\n2. **Bootstrapping Kubernetes workers with Wasm runtimes**\n3. **Using labels to target workloads**\n4. **RuntimeClasses and Wasm**\n5. **Wasm apps in Kubernetes Pods**\n\n### ‚öôÔ∏è containerd and runwasi\n\nMost Kubernetes clusters use [containerd](https://containerd.io/) as the high-level runtime. It runs on every node and manages container lifecycle events such as create, start, stop, and delete. However, containerd only manages these events; it actually uses a low-level container runtime called `runc` to perform the actual work. A shim process sits between containerd and the low-level runtime and performs important tasks such as abstracting the low-level runtime.\n\nThe architecture is shown below:\n\n![containerd-wasm](./containerd-wasm.jpg)\n\n[runwasi](https://github.com/containerd/runwasi) is a containerd project that lets you swap out container runtimes for WebAssembly runtimes. It operates as a shim layer between containerd and low-level Wasm runtimes and enables WebAssembly workloads to seamlessly run on Kubernetes clusters. The architecture is shown below:\n\n![runwasi](./runwasi.jpg)\n\nEverything from containerd and below is opaque to Kubernetes‚Ää‚Äî‚ÄäKubernetes schedules work tasks to nodes and doesn't care if it's a traditional OCI container or a WebAssembly workload.\n\n## üõ†Ô∏è Bootstrapping Kubernetes workers with Wasm runtimes\n\nFor a Kubernetes worker to execute WebAssembly workloads, it needs bootstrapping with a Wasm runtime. This is a two-step process:\n1. **Install the Wasm runtime**\n2. **Register the Wasm runtime with containerd**\n\nIn most cases, your Kubernetes distro will provide a CLI or UI that automates these steps. However, we'll explain what's happening behind the scenes.\n\nWasm runtimes are binary executables that should be installed on worker nodes in a path that's visible to containerd. They should also be named according to the containerd binary runtime naming convention. The following list shows the `wasmtime` and `spin` runtime binaries named appropriately and installed into the `/bin` directory:\n- `wasmtime`: `/bin/containerd-shim-wasmtime-v1`\n- `spin`: `/bin/containerd-shim-spin-v1`\n\nOnce installed, runtimes need registering with containerd. This is done by adding them to the containerd config file, which is usually located at `/etc/containerd/config.toml`.\n\nThe following extract shows how to register the `wasmtime` and `spin` runtimes in the containerd `config.toml` file:\n\n```toml\n[plugins.cri.containerd.runtimes.wasmtime]\n    runtime_type = \"io.containerd.wasmtime.v1\"\n[plugins.cri.containerd.runtimes.spin]\n    runtime_type = \"io.containerd.spin.v1\"\n```\n\nOnce the Wasm runtimes are installed and registered, the final node configuration step is to label the nodes.\n\n### üè∑Ô∏è Using Labels to Target Workloads\n\nIf all of your cluster nodes have the same runtimes, you do not need to label them. However, if you have subsets of nodes with Wasm runtimes, you need to label them so that [RuntimeClass](https://kubernetes.io/docs/concepts/containers/runtime-class/) objects can target them.\n\nThe following diagram shows a cluster with 6 nodes. Two have `runc`, 4 have `wasmtime`, and 2 have `spin`. See how the labels make it obvious which nodes have which runtimes.\n\n![labels](./labels.png)\n\nBe sure to use meaningful labels and avoid reserved namespaces such as `kubernetes.io` and `k8s.io`.\n\nThe following command applies the `wasmtime-enabled=yes` label to a node called `wrkr3`. RuntimeClasses can use this label to send Wasm workloads to the node.\n\n```sh\n$ kubectl label nodes wrkr3 wasmtime-enabled=yes\n```\n\nThe output of the next command shows the label was correctly applied.\n\n```sh\n$ kubectl get nodes --show-labels\nNAME     STATUS    ROLES    AGE     VERSION        LABELS\nwrkr1    Ready     <none>   5d      v1.25.1\nwrkr2    Ready     <none>   5d      v1.25.1\nwrkr3    Ready     <none>   2m      v1.25.1        wasmtime-enabled=yes\n```\n\nWith Wasm runtimes installed, registered with containerd, and labels applied, a node is ready to execute Wasm tasks. The next step is to create a [RuntimeClass](https://kubernetes.io/docs/concepts/containers/runtime-class/) that sends Wasm workloads to the node(s).\n\n## üè∑Ô∏è RuntimeClasses and Wasm\n\n[RuntimeClasses](https://kubernetes.io/docs/concepts/containers/runtime-class/) allow Kubernetes to schedule Pods to specific nodes and target specific runtimes. They have three important properties:\n\n- **metadata.name**\n- **scheduling.nodeSelector**\n- **handler**\n\nThe **name** is how you tell other objects, such as Pods, to use it. The **nodeSelector** tells Kubernetes which nodes to schedule work to. The **handler** tells containerd which runtime to use.\n\nThe following `RuntimeClass` is called `wasm1`. The `scheduling.nodeSelector` property sends work to nodes with the `wasmtime-enabled=yes` label, and the `handler` property ensures the `wasmtime` runtime will execute the work.\n\n```yaml\napiVersion: node.k8s.io/v1\nkind: RuntimeClass\nmetadata:\n    name: \"wasm1\"\nscheduling:\n    nodeSelector:\n        wasmtime-enabled: \"yes\"\nhandler: \"wasmtime\"\n```\n\nThe following diagram shows three worker nodes. One of them is running the `wasmtime` and `spin` runtimes and is labelled appropriately. The Pod and RuntimeClass on the left target work against the `wasmtime` runtime. The Pod and RuntimeClass on the right target work against the `spin` runtime.\n\n![nodes](./nodes.png)\n\nWith worker nodes configured and RuntimeClasses in place, the last thing to do is bind Pods to the correct RuntimeClass.\n\n### Wasm apps in Kubernetes Pods\n\nThe following YAML snippet targets the Pod at the wasm1 RuntimeClass. This will ensure the Pod gets assigned to a node and runtime specified in the wasm1 RuntimeClass.\nIn the real world, the Pod template will be embedded inside a higher order object such as a Deployment.\n\n```yaml\napiVersion: v1\nkind: Pod\nmetadata:\n  name: wasm-test\nspec:\n  runtimeClassName: wasm1    <<<<==== Use this RuntimeClass\n  container:\n  - name: ctr-wasm\n    image: <OCI image with Wasm module>\n    ...\n```\n\nThis Pod can be posted to the Kubernetes API server where it will use the wasm1 RuntimeClass to ensure it executes on the correct node with the correct runtime (handler).\nNotice how the Pod template defines a container even though it's deploying a Wasm app. This is because Kubernetes Pods were designed with containers in mind. For Wasm to work on Kubernetes, **Wasm apps have to be packaged inside of OCI container images.**\n\n## üöÄ Deploying a Wasm App\n\nYou'll need Docker Desktop and K3d to follow along, and the remainder of the article assumes you have these installed. You'll complete the following steps:\n\n1. **Build a K3d cluster**\n2. **Verify the runtime configuration**\n3. **Configure node labels**\n4. **Create a RuntimeClass**\n5. **Deploy an app**\n6. **Test the app**\n7. **Scale the app**\n8. **Inspect the containerd processes**\n\n### üèóÔ∏è Build a K3d Kubernetes Cluster\n\nRun the following command to create a 3-node K3d Kubernetes cluster. You'll need Docker Desktop installed and running, but you do not need the Docker Desktop Kubernetes cluster running.\n\n```sh\n$ k3d cluster create wasm-cluster \\\n    --image ghcr.io/deislabs/containerd-wasm-shims/examples/k3d:v0.5.1 \\\n    -p \"8081:80@loadbalancer\" --agents 2\n```\n\nVerify the cluster is up and running.\n\n```sh\n$ kubectl get nodes\nNAME                        STATUS   ROLES                  AGE   VERSION\nk3d-wasm-cluster-server-0   Ready    control-plane,master   2m    v1.24.6+k3s1\nk3d-wasm-cluster-agent-0    Ready    <none>                 2m    v1.24.6+k3s1\nk3d-wasm-cluster-agent-1    Ready    <none>                 2m    v1.24.6+k3s1\n```\n\nThe command to build the cluster used [an image](https://github.com/deislabs/containerd-wasm-shims/pkgs/container/containerd-wasm-shims%2Fexamples%2Fk3d) with the [spin](https://github.com/fermyon/spin) and [slight](https://github.com/deislabs/spiderlightning) Wasm runtimes pre-installed. These are vital to running WebAssembly apps on Kubernetes.\n\n### üîç Verify the Runtime Configuration\n\nUse `docker exec` to log on to the `k3d-wasm-cluster-agent-0` node.\n\n```sh\n$ docker exec -it k3d-wasm-cluster-agent-0 ash\n```\n\nRun all of the following commands from inside the exec session.\n\nCheck the `/bin` directory for containerd shims named according to [the containerd shim naming convention](https://github.com/containerd/containerd/blob/main/core/runtime/v2/README.md).\n\n```sh\n$ ls /bin | grep containerd-\ncontainerd-shim-runc-v2\ncontainerd-shim-slight-v1\ncontainerd-shim-spin-v1\n```\n\nYou can see the [runc](https://github.com/opencontainers/runc), [slight](https://github.com/deislabs/spiderlightning), and [spin](https://www.fermyon.com/spin) shims. `runc` is the default low-level runtime for running containers on Kubernetes and is present on all worker nodes running containerd. `spin` and `slight` are Wasm runtimes for running WebAssembly apps on Kubernetes.\n\nWith the shims installed correctly, run a `ps` command to verify containerd is running.\n\n```sh\n# ps\nPID     USER     COMMAND\n<Snip>\n     58   0        containerd -c /var/lib/rancher/k3s/agent/etc/containerd/config.toml...\n```\n\nThe output is trimmed, but it shows the containerd process is running. The `-c` flag is used to pass containerd a custom location for the [config.toml](https://github.com/containerd/containerd/blob/main/docs/man/containerd-config.toml.5.md) file.\n\nList the contents of this `config.toml` to see the registered runtimes.\n\n```sh\n$ cat /var/lib/rancher/k3s/agent/etc/containerd/config.toml\n<Snip>\n[plugins.cri.containerd.runtimes.runc]\n    runtime_type = \"io.containerd.runc.v2\"\n[plugins.cri.containerd.runtimes.spin]\n    runtime_type = \"io.containerd.spin.v1\"\n[plugins.cri.containerd.runtimes.slight]\n    runtime_type = \"io.containerd.slight.v1\"\n```\n\n`runc`, `spin`, and `slight` are all installed and registered with containerd.\n\nYou can repeat these steps for the other two nodes and will get similar results as all three are running containerd and are configured with the `spin` and `slight` Wasm runtimes.\n\nThe next step is to label your nodes.\n\n### üè∑Ô∏è Configure Node Labels\n\nWe'll add a custom label to a single worker node and use it in a future step to force Wasm apps onto just that node. Run the following command to add the `spin=yes` label to the `k3d-wasm-cluster-agent-0` worker node.\n\n```shell\n$ kubectl label nodes k3d-wasm-cluster-agent-0 spin=yes\n```\n\nVerify the operation. Your output will be longer, but only the `k3d-wasm-cluster-agent-0` should be displayed.\n\n```shell\n$ kubectl get nodes --show-labels | grep spin\nNAME                        STATUS   ROLES     ...  LABELS\nk3d-wasm-cluster-agent-0    Ready    <none>    ...  beta.kubernetes..., spin=yes\n```\n\nAt this point, `k3d-wasm-cluster-agent-0` is the only node with the `spin=yes` label. In the next step, you'll create a RuntimeClass that targets this node.\n\n### üèÉ Create a RuntimeClass\n\nThe following YAML defines a RuntimeClass called `spin-test`. It selects nodes with the `spin=yes` label and specifies the `spin` runtime as the handler.\n\nCopy and paste the whole block into your terminal to deploy it.\n\n```shell\nkubectl apply -f - <<EOF\napiVersion: node.k8s.io/v1\nkind: RuntimeClass\nmetadata:\n    name: spin-test\nhandler: spin\nscheduling:\n    nodeSelector:\n        spin: \"yes\"\nEOF\n```\n\nThe following command verifies the RuntimeClass was created and is available.\n\n```shell\n$ kubectl get runtimeclass\nNAME         HANDLER   AGE\nspin-test    spin      10s\n```\n\nAt this point, you have a 3-node Kubernetes cluster, and all three nodes have the `spin` runtime installed. You also have a RuntimeClass that can be used to schedule tasks against the `k3d-wasm-cluster-agent-0` node. This means you're ready to run WebAssembly apps on Kubernetes!\n\nIn the next step, you'll deploy a Kubernetes app.\n\n### üèóÔ∏è Deploy an App\n\nYou can find the app code here: [containerd-wasm-shims](https://github.com/spinkube/containerd-shim-spin).\n\nThe following YAML snippet is from the [app](https://github.com/nigelpoulton/spin1/blob/main/app.yml) you're about to deploy. The only bit we're interested in is the `spec.template.spec.runtimeClassName = spin-test` field. This tells Kubernetes to use the `spin-test` RuntimeClass you created in the previous step. This will schedule the app to the correct node and ensure it executes with the appropriate handler (runtime).\n\n```yaml\napiVersion: apps/v1\nkind: Deployment\nmetadata:\n    name: wasm-spin\nspec:\n    replicas: 1\n    ...\n    template:\n        ...\n        spec:\n            runtimeClassName: spin-test     <<==== Targets the RuntimeClass\n            containers:\n```\n\nDeploy it with the following command:\n\n```shell\nkubectl apply -f https://raw.githubusercontent.com/seifrajhi/wasm-k8s/main/wasp-app.yaml\n```\n\nVerify the app was deployed. It might take a few seconds for it to enter the ready state and it will only work if you followed all previous steps.\n\n```shell\n$ kubectl get deploy\nNAME          READY   UP-TO-DATE   AVAILABLE   AGE\nwasm-spin     1/1     1            1           14s\n```\n\nVerify it's running on the correct node:\n\n```shell\n$ kubectl get pods -o wide\nNAME                         READY   STATUS    AGE   NODE\nwasm-spin-74cff79dcb-npwwj   1/1     Running   86s   k3d-wasm-cluster-agent-0\n```\n\nIt's running on the `k3d-wasm-cluster-agent-0` worker node that has the label and handler specified in the RuntimeClass. Test the app is working by pointing your browser to [http://localhost:8081/spin/hello](http://localhost:8081/spin/hello) or by running the following curl command:\n\n```shell\n$ curl -v http://127.0.0.1:8081/spin/hello\n<Snip>\nHello world from Spin!\n```\n\nCongratulations, the application is successfully deployed to the worker node specified in the RuntimeClass. In the next step, you'll scale the app to prove that all replicas get scheduled to the same node.\n\n### üìà Scale the App\n\nIncrease the number of replicas from 1 to 3:\n\n```shell\n$ kubectl scale --replicas 3 deploy/wasm-spin\ndeployment.apps/wasm-spin scaled\n```\n\nVerify all three Pods are running on the `k3d-wasm-cluster-agent-0` node:\n\n```shell\n$ kubectl get pods -o wide\nNAME                         READY   STATUS     AGE     NODE\nwasm-spin-74cff79dcb-npwwj   1/1     Running    3m32s   k3d-wasm-cluster-agent-0\nwasm-spin-74cff79dcb-vsz7t   1/1     Running    7s      k3d-wasm-cluster-agent-0\nwasm-spin-74cff79dcb-q4vxr   1/1     Running    7s      k3d-wasm-cluster-agent-0\n```\n\nThe RuntimeClass is doing its job of ensuring the Wasm workloads run on the correct node.\n\n### üîç Inspect the containerd Processes\n\nExec onto the `k3d-wasm-cluster-agent-0` node:\n\n```shell\n$ docker exec -it k3d-wasm-cluster-agent-0 ash\n```\n\nRun the following commands from inside the exec session:\n\nList running spin processes:\n\n```shell\n# ps | grep spin\nPID    USER  COMMAND\n<Snip>\n1764  0     {containerd-shim}.../bin/containerd-shim-spin-v1 -namespace k8s.io -id ...\n2015  0     {containerd-shim}.../bin/containerd-shim-spin-v1 -namespace k8s.io -id ...\n2017  0     {containerd-shim}.../bin/containerd-shim-spin-v1 -namespace k8s.io -id ...\n```\n\nThe output is trimmed, but you can see three `containerd-shim-spin-v1` processes. This is one shim process for each of the three replicas.\n\nThe long hex ID attached to each of the three shim processes is the ID of the associated container task. This is because containerd runs each Wasm task inside its own container.\n\nRun the following command to list containers on the host. Notice how some of the container task IDs match with the hex IDs associated with the spin shim processes from the previous command. The PID also matches the PID of the spin shim processes.\n\n```shell\n$ ctr task ls\nTASK                                                                PID     STATUS\n3f083847f6818c3f76ff0e9927b3a81f84f4bf1415a32e09f2a37ed2a528aed1    2015    RUNNING\nf8166727d7d10220e55aa82d6185a0c7b9b7e66a4db77cc5ca4973f1c8909f85    2017    RUNNING\n78c8b0b17213d895f4758288500dc4e1e88d7aa7181fe6b9d69268dffafbd95b    1764    RUNNING\n</Snip>\n```\n\nThe output is trimmed to only show the Wasm containers.\n\nYou can see more detailed info with the info command:\n\n```shell\n$ ctr containers info 3f083847f6...a37ed2a528aed1\n{\n        <Snip>\n        \"Runtime\": {\n                \"Name\": \"io.containerd.spin.v1\",\n                <Snip>\n                \"annotations\": {\n                        \"io.kubernetes.cri.container-name\": \"spin-hello\",\n                        \"io.kubernetes.cri.container-type\": \"container\",\n                        \"io.kubernetes.cri.image-name\": \"ghcr.io/deislabs/containerd-wasm-shims/examples/spin-rust-hello:v0.5.1\",\n                        \"io.kubernetes.cri.sandbox-id\": \"3f083847f6818c3f76ff0e9927b3a81f84f4bf1415a32e09f2a37ed2a528aed1\",\n                        \"io.kubernetes.cri.sandbox-name\": \"wasm-spin-5bd4bd7b9-kqgjt\",\n                        \"io.kubernetes.cri.sandbox-namespace\": \"default\"\n                        <Snip>\n```\n\nIf you examine the output of the previous command, you'll see typical container constructs such as namespaces and cgroups. The WebAssembly app is executing inside the normal WebAssembly sandbox, which, in turn, is executing inside a minimal container.\n\n## üçâ Summary\n\nWebAssembly is a new technology that is changing the way cloud-native applications are developed and deployed. It is now possible to run WebAssembly applications on Kubernetes, which means that developers can take advantage of the performance, security, and portability of WebAssembly while also benefiting from the scalability and manageability of Kubernetes.\n\nTo run WebAssembly applications on Kubernetes, you need to bootstrap Kubernetes worker nodes with a WebAssembly runtime and use RuntimeClasses to map WebAssembly applications to the appropriate nodes. This is a relatively new process, but it is becoming increasingly popular as WebAssembly matures and becomes more widely adopted.\n<br>\n\n**_Until next time, „Å§„Å•„Åè üéâ_**\n\n> üí° Thank you for Reading !! üôåüèªüòÅüìÉ, see you in the next blog.ü§ò  **_Until next time üéâ_**\n\nüöÄ Thank you for sticking up till the end. If you have any questions/feedback regarding this blog feel free to connect with me:\n\n**‚ôªÔ∏è LinkedIn:** https://www.linkedin.com/in/rajhi-saif/\n\n**‚ôªÔ∏è X/Twitter:** https://x.com/rajhisaifeddine\n\n**The end ‚úåüèª**\n\n<h1 align=\"center\">üî∞ Keep Learning !! Keep Sharing !! üî∞</h1>\n\n**üìÖ Stay updated**\n\nSubscribe to our newsletter for more insights on AWS cloud computing and containers.\n","wordCount":{"words":2366},"frontmatter":{"id":"38ebbaaa3ee11700ae5a091e","path":"/blog/k8s-wasm-runtimes-part1/","humanDate":"Oct 20, 2024","fullDate":"2024-10-20","title":"Wasm and Kubernetes: A new era of cloud-native application deployment; Part1","keywords":["WebAssembly","Kubernetes","cloud-native","application deployment","Wasm","K8s","runtimes"],"excerpt":"Explore the integration of WebAssembly (Wasm) with Kubernetes for cloud-native application deployment. This first part of the series covers the basics and benefits of using Wasm on K8s.","cover":{"childImageSharp":{"gatsbyImageData":{"layout":"fullWidth","placeholder":{"fallback":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAAAsTAAALEwEAmpwYAAAEIklEQVR42iWTW0zTdxTH/y97mprpdDG6RSpqUSktLbYgrlqwULoCpfzbQrXlooW2lEK5Q4ECU4cORbTeAdnm5pzzilvcjPG2uCwzXhI3iZo9mmzObUYXH1z22W/x4Zvz8D3nm+/35Bxpu9LNsNLFiNLJbqXMvqUyh1JKSKjWsVNTyehymTGVi3GVk8QyJ8Mpr7BdzHQnuYi+U0bdXBfBt5xEknxIZzJKObeyjHOrPJxetZ79OREmTEESpgb2G6o5onYwoZYZVcnsSJEZXOzk/WQnPQo3nQtcNM+XiS7y0ZzRQKspjjSy0MY+TTk77d0MFfewubiPPflNHNU5Oaq2M55WyoFUmT3C+YjAkEiyJVmmb4FMt8JFb/pGNhd0MljUy9bCbqQ9Sjv7kywc0Ii4xVHGXO18ZSzjRHoxxzJkPtE4RGQhuqxUrKSUHWItQ2kehrOq2WuNcMjdwaiY+R8HXR1IJ+U6TlirOaMvZdK6gdNykAuZMmd0JRxTl3BUK3NE7+bjzHI+Mnr5tMjPKV8Ln3s7OVwW46AcI+EQ6YS7gYIepMuBGi76g1ysCfBtVYjvC/2Mq/M4ucrB+SIfF3yCrw5xJRDmSijKpUAXe+21jMttTJTFSZSIqNZe+i1xOtf2IX1TGeVqdSO3Yh7+uq3g/iaZ4oUpjBSa+aO7kV8itdwNhbhcEWZSbuSsu53cRWoCOju7TTF69VE6tVE6tK20GbqQjsldfO2NcX1jP1PbKhn2qqlMV9NgSONLfxOH4+c56etnm7qeWFoP1iQ3htlKMmalElrsJa5uJqZppTWthTa9ELxRG+BmYB27rDaC6UbqDdlENRqqsl1oLQ1YwuPkuiew6faRrmgkK3UTpnlWrHONZM4xkDfPjG+Jhy5dG63aNqSXLTK/1xfxYY6KmxtXs2VlFt65SgqNITbEJ0mMnUXv2IHN1E9T4DsigS+wpXrxKbJoT7fTkGbGkVRAl3AfWd6J9GLAxt9xG4eLdVyqeJdEgYbNuctIFGlZV7WF7MB5Buub6bP7CVccp91RRWe+gWHbUk5VaDkr8Jkzi6mok2s1bqR/D5q4N6Sh0jqLoDwDl2kafvObVK6exvrcObjXKqjLf4OKnNlsWDMdb/Zr+HNfp9w4gxrLTDyrp7PVOxMmVbw8vhTp+UAmv27N4MZAMrcHF3C1I5mmnPkk5IXciS7nRjiFHyIafoxqudWs41rDCuqNb4tzUfBTi5rr4VTuivr0Az1/CkiPw4U8Cdl4VpvPi7CZxwEz7folHLet4J86C09r83getPBM9L2IOngiapNusXgGHYQLBL9WIJ/f/FYeB21ID6w+7ueVc99cxkOzhzu5burFnY1m5vFIruHeez6mBH8vx8XUGhe3ctwEklWMaY08yvfws+h/WFjBA9srnf8A3NibHYFhjOcAAAAASUVORK5CYII="},"images":{"fallback":{"src":"/static/fdb5b1bf164d5ae3f3c47c1f90378fd1/3a424/wasm-cover.png","srcSet":"/static/fdb5b1bf164d5ae3f3c47c1f90378fd1/3ed2c/wasm-cover.png 750w,\n/static/fdb5b1bf164d5ae3f3c47c1f90378fd1/3a424/wasm-cover.png 800w","sizes":"100vw"},"sources":[{"srcSet":"/static/fdb5b1bf164d5ae3f3c47c1f90378fd1/36718/wasm-cover.webp 750w,\n/static/fdb5b1bf164d5ae3f3c47c1f90378fd1/74b70/wasm-cover.webp 800w","type":"image/webp","sizes":"100vw"}]},"width":1,"height":0.73125}}},"coverCredits":"Photo by Saifeddine Rajhi"}}},"pageContext":{"prevThought":{"frontmatter":{"path":"/blog/eks-detect-manual-actions/","title":"Detecting Manual Actions in EKS Clusters with Terraform and SNS üïµ","date":"2024-10-20 21:36:00"},"excerpt":"Enhancing Security and Compliance in EKS through Proactive Audit Monitoring. üìå Introduction AWS Kubernetes audit logs for EKS, also known‚Ä¶","html":"<blockquote>\n<p><strong>Enhancing Security and Compliance in EKS through Proactive Audit Monitoring.</strong></p>\n</blockquote>\n<h2 id=\"-introduction\" style=\"position:relative;\"><a href=\"#-introduction\" aria-label=\" introduction permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üìå Introduction</h2>\n<p>AWS Kubernetes audit logs for EKS, also known as Amazon EKS control plane logs, are retrieved through AWS CloudWatch‚Ää‚Äî‚Ääno agent is needed. It's important to keep an eye on EKS audit logs and to monitor manual changes that could impact the stability and security of the environment.</p>\n<p>In this blog post, we'll explore how to use <a href=\"https://github.com/seifrajhi/eks-auditing-bot-module\" target=\"_blank\" rel=\"noopener noreferrer\">this Terraform module</a> based on Amazon SNS to set up audit alerts and monitoring for manual actions in crucial AWS Elastic Kubernetes Service (EKS) resources, such as ClusterRoleBinding or Secret creation or deletion. By using EKS Audit Logs and SNS, we can detect and notify operators of any manual changes made to the cluster's crucial resources, helping to ensure the integrity and security of the environment.</p>\n<blockquote>\n<p><strong>Enhancing Security and Compliance in EKS Clusters through Proactive Audit Monitoring.</strong></p>\n</blockquote>\n<h3 id=\"-importance-of-eks-audit-logs-and-sns-alerts\" style=\"position:relative;\"><a href=\"#-importance-of-eks-audit-logs-and-sns-alerts\" aria-label=\" importance of eks audit logs and sns alerts permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üö® Importance of EKS Audit Logs and SNS Alerts</h3>\n<p>EKS Audit Logs are essential for monitoring and securing your Kubernetes environment, as they provide a comprehensive overview of all actions taking place within the cluster. By making use of uing <a href=\"https://docs.aws.amazon.com/eks/latest/userguide/control-plane-logs.html\" target=\"_blank\" rel=\"noopener noreferrer\">EKS Audit Logs</a> and <a href=\"https://aws.amazon.com/sns/features/\" target=\"_blank\" rel=\"noopener noreferrer\">SNS</a> alerts, you can benefit from the following advantages:</p>\n<ul>\n<li><strong>Enhanced Security</strong>: Audit logs help you detect potentially suspicious activities in your EKS clusters, such as unauthorized access, malicious actions, or configuration changes. By monitoring these logs, you can quickly identify and respond to security incidents, ensuring the integrity of your environment.</li>\n<li><strong>Compliance</strong>: Audit logs are crucial for maintaining compliance with regulatory requirements and industry standards, such as <a href=\"https://www.pcisecuritystandards.org/\" target=\"_blank\" rel=\"noopener noreferrer\">PCI-DSS</a> or <a href=\"https://www.hhs.gov/hipaa/index.html\" target=\"_blank\" rel=\"noopener noreferrer\">HIPAA</a>. By regularly reviewing and analyzing these logs, you can ensure that your EKS cluster adheres to the necessary regulations and guidelines.</li>\n<li><strong>Troubleshooting</strong>: Audit logs can provide valuable insights into the cause of issues or errors in your EKS cluster, allowing you to troubleshoot and resolve problems more efficiently.</li>\n<li><strong>Monitoring</strong>: By leveraging EKS Audit Logs and SNS alerts, you can monitor your EKS cluster's activities and make informed decisions based on the data provided by the audit logs. This enables you to maintain better control over your Kubernetes environment and optimize its performance.</li>\n</ul>\n<p>Enhancing Security and Compliance in EKS Clusters through Proactive Audit Monitoring.</p>\n<h2 id=\"-eks-audit-logs-audit-and-monitoring-module\" style=\"position:relative;\"><a href=\"#-eks-audit-logs-audit-and-monitoring-module\" aria-label=\" eks audit logs audit and monitoring module permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üëÆ EKS Audit Logs Audit and Monitoring Module</h2>\n<p><a href=\"https://github.com/seifrajhi/eks-auditing-bot-module\" target=\"_blank\" rel=\"noopener noreferrer\">The EKS Audit Logs audit and monitoring module</a> enables you to ingest EKS audit logs from the Kubernetes API, providing more visibility, automated threat detection, additional compliance checks, and robust reporting.</p>\n<p>By leveraging EKS Audit Logs and SNS, you can detect and notify operators of any manual changes made to the cluster's crucial resources, such as ClusterRoleBinding or Secret creation or deletion.</p>\n<p>The <code class=\"language-text\">eks-auditing-bot-module</code> can be used in conjunction with Amazon SNS and AWS Lambda to create a powerful monitoring and alerting system for your EKS cluster. By combining EKS Audit Logs, SNS, and Lambda, you can create a robust monitoring and alerting system that enhances the security, compliance, and overall management of your EKS cluster. This approach allows you to detect and respond to potential issues or threats in a timely and efficient manner, ensuring the stability and security of your Kubernetes environment.</p>\n<p><span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 35.29411764705882%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAAsTAAALEwEAmpwYAAABW0lEQVR42nWSuY7CMBRFrZkBJ6A4cRaykIUJmQxCAQokaGhB/AMdPQUFNd9AyS/wlXMvIhLNWHpKzlvus58tbNsuDcPITdMcFkXhgL+llCOtdRaGYR/fHNb4vl+Tq6qS+I+Zl2VZUpalTQ3Lsn6DIBgL13XVbDbTcRz7SFYoGqzX6xDcE0J0KTKdTt08zzW4A/ti46ZpQjSy2YCxlgXX8Xi0NpuNpjhtu90OYH02Qdg8nU7q8Xh8ite6Xq8ft9tNtszY/X7vtSzO57PJpJbZgLtNksTjDne7XbZYLJwoigL6JpOJdzgc1L+C7PYuiITuO18uF2u/30vP8yzacrnsgQOEJI+8Wq0UT/FMxkB1Xdc+5wIzwA5nRmYyBebz+SBNUxf+LsQ6nC9iAXxD7hgzLMHpc4a8LcdxCswupQiOOFJKjckshGACrnCLPxSnj7fMGqyINXwhfBm45eoPWTBHCOI3GIAAAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"Steps\" title=\"\" src=\"/static/efdef2fcdbafe4cb33cd9f7b4a613f4c/c5bb3/steps.png\" srcset=\"/static/efdef2fcdbafe4cb33cd9f7b4a613f4c/04472/steps.png 170w,\n/static/efdef2fcdbafe4cb33cd9f7b4a613f4c/9f933/steps.png 340w,\n/static/efdef2fcdbafe4cb33cd9f7b4a613f4c/c5bb3/steps.png 680w,\n/static/efdef2fcdbafe4cb33cd9f7b4a613f4c/5a190/steps.png 800w\" sizes=\"(max-width: 680px) 100vw, 680px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n    </span>\n          </p>\n<h3 id=\"Ô∏è-terraform-configuration\" style=\"position:relative;\"><a href=\"#%EF%B8%8F-terraform-configuration\" aria-label=\"Ô∏è terraform configuration permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üõ†Ô∏è Terraform Configuration</h3>\n<p>To use the <code class=\"language-text\">eks-auditing-bot-module</code>, you can use the following Terraform configuration:</p>\n<div class=\"gatsby-highlight\" data-language=\"hcl\"><pre class=\"language-hcl\"><code class=\"language-hcl\"><span class=\"token keyword\">terraform</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">source</span> <span class=\"token punctuation\">=</span> <span class=\"token string\">\"git::https://github.com/seifrajhi/eks-auditing-bot-module.git\"</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token property\">inputs</span> <span class=\"token punctuation\">=</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">eks_bot_name</span>              <span class=\"token punctuation\">=</span> <span class=\"token string\">\"eks_audit_logs_bot\"</span>\n    <span class=\"token property\">timeout</span>                   <span class=\"token punctuation\">=</span> <span class=\"token number\">60</span>\n    <span class=\"token property\">memory_limit</span>              <span class=\"token punctuation\">=</span> <span class=\"token number\">256</span>\n    <span class=\"token property\">aws_cloudwatch_log_group</span>  <span class=\"token punctuation\">=</span> <span class=\"token string\">\"/aws/eks/cluster-name/cluster\"</span>\n    <span class=\"token property\">account_id</span>                <span class=\"token punctuation\">=</span> <span class=\"token string\">\"XXXXXXXXXX\"</span>\n    <span class=\"token property\">account_name</span>              <span class=\"token punctuation\">=</span> <span class=\"token string\">\"account-name\"</span>\n    <span class=\"token property\">sns_topic_arn</span>             <span class=\"token punctuation\">=</span> <span class=\"token string\">\"arn:aws:sns:eu-west-1:XXXXXXXXXX:alerts\"</span>\n    <span class=\"token property\">filter_pattern</span>            <span class=\"token punctuation\">=</span> <span class=\"token string\">\"{ ($.verb != \\\"get\\\" &amp;&amp; $.verb != \\\"list\\\" &amp;&amp; $.verb != \\\"watch\\\") &amp;&amp; ($.user.username = \\\"sre/*\\\" || $.user.username = \\\"ssouser/*\\\" || $.user.username = \\\"kubernetes-admin\\\" ) &amp;&amp; ((($.objectRef.namespace = \\\"kube-system\\\" || $.objectRef.namespace = \\\"consul\\\" || $.objectRef.namespace = \\\"vault\\\" || $.objectRef.namespace = \\\"consul\\\" || $.objectRef.namespace = \\\"istio-ingress\\\" || $.objectRef.namespace = \\\"ingress-system\\\" || $.objectRef.namespace = \\\"istio-system\\\" ) &amp;&amp; ($.objectRef.resource = \\\"roles\\\" || $.objectRef.resource = \\\"secrets\\\" || $.objectRef.resource = \\\"serviceaccounts\\\" || $.objectRef.resource = \\\"role\\\" || $.objectRef.resource = \\\"rolebindings\\\")) || ($.objectRef.resource = \\\"clusterroles\\\" || $.objectRef.resource = \\\"clusterrolebindings\\\") ) }\"</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p><strong>Where:</strong></p>\n<ul>\n<li><code class=\"language-text\">eks_bot_name</code>: The name of the EKS auditing bot.</li>\n<li><code class=\"language-text\">timeout</code>: Execution timeout for the auditing bot (in seconds).</li>\n<li><code class=\"language-text\">memory_limit</code>: Memory limit for the auditing bot (in MB).</li>\n<li><code class=\"language-text\">aws_cloudwatch_log_group</code>: CloudWatch Log Group for EKS Audit Logs.</li>\n<li><code class=\"language-text\">account_id</code>: AWS account ID.</li>\n<li><code class=\"language-text\">account_name</code>: AWS account name.</li>\n<li><code class=\"language-text\">sns_topic_arn</code>: ARN of the SNS topic for sending alerts.</li>\n<li><code class=\"language-text\">filter_pattern</code>: CloudWatch Logs filter pattern for detecting manual actions.</li>\n</ul>\n<p>After messages are delivered to this topic, you can subscribe to this topic to receive the published alerts. SNS topics can be subscribed to by a variety of services and clients, including:</p>\n<ul>\n<li>üìß <strong>Email messages</strong> (through Amazon SES)</li>\n<li>üì± <strong>SMS text messages</strong></li>\n<li>üì≤ <strong>Mobile push notifications</strong></li>\n<li>üì• <strong>SQS queues</strong></li>\n<li>üõ†Ô∏è <strong>AWS Lambda functions</strong></li>\n<li>üåê <strong>HTTP/HTTPS endpoints</strong> (e.g., <a href=\"https://www.atlassian.com/software/opsgenie\" target=\"_blank\" rel=\"noopener noreferrer\">Opsgenie</a>, <a href=\"https://www.pagerduty.com/\" target=\"_blank\" rel=\"noopener noreferrer\">PagerDuty</a>)</li>\n</ul>\n<p>If you find the <code class=\"language-text\">eks-auditing-bot-module</code> helpful, don't forget to star ‚≠êÔ∏è the <a href=\"https://github.com/seifrajhi/eks-auditing-bot-module\" target=\"_blank\" rel=\"noopener noreferrer\">repository</a> to show your support for the project and the open-source community.</p>\n<p>If you have any further enhancements or specific comments, feel free to share them, and I can incorporate them into the content.</p>\n<p><span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 42.94117647058824%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsTAAALEwEAmpwYAAABgElEQVR42n2Q206DQBCGuVfbRqNSrVVgYRfKcbucKS2xMdHn8NIn8AV87N9hG43xdPFlJhvmY+Y3Xl7fUJQltrs92uEB+WaPMCvghRKOn4CtMkIeapB+VmeVwg4S2P4Bx49hiQjG4/MzJhenmByd4OyOw4xrLPMdbst7XCU1znmCC5HBXOUwfYk59XN6uw5zWKqHJTtiAytriBrGch1AKAXPFWDMhfB8pN0e6+EJkWro3YPLODwe4GaxhHk5x9y8woJ6x/G+wHU1WC2h+g0GOlcEEc5pwDQPXC9uEMYSQZRpOJ3k8lDD+AqOG/zAcKoMsm3RNFsw2m46neGEOJ7MMJ2d4s72YDMBi7Bdn4b+RwvLbY+m6lBVLcq6Q5SskcpCw/1IC78PMi/4XchIyNseotiCq45OXCNOlSaVOcUQfwr1pmNW1H/Un8I6Qz4MqNoBjDIaP/zKKBm3GU8vyhb97h5V00MV9R8nqwRJXsAnmeOKP7MZ5WMESZbrH4xR/CZ8B8+AC97Aqo1LAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"Alert\" title=\"\" src=\"/static/ae7f599223d17a5eb090ae1adf067a17/c5bb3/alert.png\" srcset=\"/static/ae7f599223d17a5eb090ae1adf067a17/04472/alert.png 170w,\n/static/ae7f599223d17a5eb090ae1adf067a17/9f933/alert.png 340w,\n/static/ae7f599223d17a5eb090ae1adf067a17/c5bb3/alert.png 680w,\n/static/ae7f599223d17a5eb090ae1adf067a17/5a190/alert.png 800w\" sizes=\"(max-width: 680px) 100vw, 680px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n    </span>\n          </p>\n<h2 id=\"-conclusion\" style=\"position:relative;\"><a href=\"#-conclusion\" aria-label=\" conclusion permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üìò Conclusion</h2>\n<p>By using the <code class=\"language-text\">eks-auditing-bot-module</code>, you can enhance the security and compliance of your EKS clusters through proactive audit monitoring and alerting. This approach allows you to detect and respond to manual changes in crucial resources, ensuring the stability and security of your Kubernetes environment.</p>\n<br>\n<p><strong><em>Until next time, „Å§„Å•„Åè üéâ</em></strong></p>\n<blockquote>\n<p>üí° Thank you for Reading !! üôåüèªüòÅüìÉ, see you in the next blog.ü§ò  <em><strong>Until next time üéâ</strong></em></p>\n</blockquote>\n<p>üöÄ Thank you for sticking up till the end. If you have any questions/feedback regarding this blog feel free to connect with me:</p>\n<p><strong>‚ôªÔ∏è LinkedIn:</strong> <a href=\"https://www.linkedin.com/in/rajhi-saif/\" target=\"_blank\" rel=\"noopener noreferrer\">https://www.linkedin.com/in/rajhi-saif/</a></p>\n<p><strong>‚ôªÔ∏è X/Twitter:</strong> <a href=\"https://x.com/rajhisaifeddine\" target=\"_blank\" rel=\"noopener noreferrer\">https://x.com/rajhisaifeddine</a></p>\n<p><strong>The end ‚úåüèª</strong></p>\n<h1 align=\"center\">üî∞ Keep Learning !! Keep Sharing !! üî∞</h1>\n<p><strong>üìÖ Stay updated</strong></p>\n<p>Subscribe to our newsletter for more insights on AWS cloud computing and containers.</p>"},"nextThought":{"frontmatter":{"path":"/blog/eks-backup-velero/","title":"EKS Backup Simplified: A Deep Dive into Velero's Magic","date":"2024-10-20 21:06:00"},"excerpt":"Easily Backup EKS with Velero üõ≥ ‚ò∏Ô∏è Introduction Welcome to a journey to explore Velero and how it makes Kubernetes backups easy. In the‚Ä¶","html":"<blockquote>\n<p><strong>Easily Backup EKS with Velero üõ≥</strong></p>\n</blockquote>\n<h2 id=\"Ô∏è-introduction\" style=\"position:relative;\"><a href=\"#%EF%B8%8F-introduction\" aria-label=\"Ô∏è introduction permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>‚ò∏Ô∏è Introduction</h2>\n<p>Welcome to a journey to explore <strong>Velero</strong> and how it makes Kubernetes backups easy. In the world of Kubernetes, keeping your cluster safe is very important. Velero helps with its strong features and simple interface.</p>\n<p>We‚Äôll look at how Velero changes Kubernetes backups. See how it makes managing backups, snapshots, and custom resources easy.</p>\n<h3 id=\"-goals--objectives\" style=\"position:relative;\"><a href=\"#-goals--objectives\" aria-label=\" goals  objectives permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üéØ Goals &#x26; Objectives</h3>\n<p>Join us as we explore Velero‚Äôs magic, offering practical tips and best practices to easily protect your AWS Kubernetes cluster. Let‚Äôs dive into the world of simple Kubernetes backups with Velero!</p>\n<h3 id=\"-prerequisites\" style=\"position:relative;\"><a href=\"#-prerequisites\" aria-label=\" prerequisites permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üöÄ Prerequisites</h3>\n<p>Before we start, I assume you have the following:</p>\n<ul>\n<li><a href=\"https://aws.amazon.com/\" target=\"_blank\" rel=\"noopener noreferrer\">AWS</a> and <a href=\"https://github.com/\" target=\"_blank\" rel=\"noopener noreferrer\">GitHub</a> accounts.</li>\n<li><a href=\"https://www.terraform.io/\" target=\"_blank\" rel=\"noopener noreferrer\">Terraform</a> installed and configured.</li>\n<li>The <a href=\"https://aws.amazon.com/cli/\" target=\"_blank\" rel=\"noopener noreferrer\">AWS CLI</a> installed and configured.</li>\n<li><a href=\"https://velero.io/\" target=\"_blank\" rel=\"noopener noreferrer\">Velero</a> installed.</li>\n<li><a href=\"https://terragrunt.gruntwork.io/\" target=\"_blank\" rel=\"noopener noreferrer\">Terragrunt</a></li>\n</ul>\n<h2 id=\"-the-workflow-landscape\" style=\"position:relative;\"><a href=\"#-the-workflow-landscape\" aria-label=\" the workflow landscape permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>‚ùÑ The Workflow Landscape</h2>\n<p><span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 72.94117647058825%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAAAsTAAALEwEAmpwYAAACvklEQVR42m1TS2/TQBB2S088JAQ/BK78gV6olIKKigAhLqGVKEIV4hwhfgJcKpC490ARx0IVTkjcQkCtkkDzcJz4/Yiz3l3vxsOs8yBBHWViz+w338x+3tU0NDvmmwHhXy0//uAnabkfJne1iTVMv2AGg6gfDW9Oc70B2QiT9KjvRwd+wstOzO+rPAAs5wCHpNsRE3rHdn+ENO0YIdmZ1C7XutajARPQ9ON7U8KuN1D4lm67VYV3Sfp0Roh/S9o4Wlor7Z3X/jO1XgG4MMPN2VrpE+LHebW+iCmVls8i1M4g+ke4NyOcmTkg6wGDdZewW42+vekzUXAIK2C8YUbJjWn3HIuxhfr5DAq+EIVK23poYp3CB0zcPjasVY0ICe2+BV3bBTrKQGS5SyQBJkdH880TjFW+1bOkbo3xqXKsUXZi2KChuFlD72XNnpWp9xgRJB0JBYiYXCAMmfyiOp12++LUMLMBlyP0LEbHfFbtWJnGkXyYCsDu2BHwCcAnE0Z8kXDAxxMmQkpVwyZ4NhpP+LODE/qEgeEE0PciCJJUkUCjrUuCwPA/QtWAY6HhBrLnhYBHBnBqqLd0CIcJVHUkdGMKuu0pEPiEI6mAynFNekOKhIsaKgkYEqJ+0nD8fAC8CFA5qYGJ9VXdAY1KEAjKHccXROTvqg5Qn8PFLcvD/GPhT+EVNlE+AqW5QA2F5ng+1JttaHUNOG3ruTeabcnx64+yrKzOJ4JX7uzvn2NpWlaEpu3I4/pv+NPuoHfBDcJcw3oPJ3QIfexRXsTzuN0wvecepUV7SItWTHasIV2dP4cqRvwTtY6SFGuINwndUjHquV3VzQdn3pTpJQ84vx6n2S6Ct+JU7vqcX5tfP/OmqO1M/c1++eKz9weXX3/+fjWfiNBXaisdJ6DqaVH6UuXffvt1ReFevPt4ab4e9Vj5C7egB8wR+DxlAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"workflow\" title=\"\" src=\"/static/67c895ab0aa79187931427924267ce45/c5bb3/workflow.png\" srcset=\"/static/67c895ab0aa79187931427924267ce45/04472/workflow.png 170w,\n/static/67c895ab0aa79187931427924267ce45/9f933/workflow.png 340w,\n/static/67c895ab0aa79187931427924267ce45/c5bb3/workflow.png 680w,\n/static/67c895ab0aa79187931427924267ce45/5a190/workflow.png 800w\" sizes=\"(max-width: 680px) 100vw, 680px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n    </span>\n          </p>\n<p>Velero is ideal for disaster recovery use cases, as well as for snapshotting your application state prior to performing system operations on your cluster (e.g., upgrades).</p>\n<h3 id=\"Ô∏è-velero-backup-workflow\" style=\"position:relative;\"><a href=\"#%EF%B8%8F-velero-backup-workflow\" aria-label=\"Ô∏è velero backup workflow permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>‚≠êÔ∏è Velero Backup Workflow</h3>\n<p>When you run <code class=\"language-text\">velero backup create test-backup</code>:</p>\n<ol>\n<li>The Velero client makes a call to the Kubernetes API server to create a Backup object.</li>\n<li>The <code class=\"language-text\">BackupController</code> notices the new Backup object and performs validation.</li>\n<li>The <code class=\"language-text\">BackupController</code> begins the backup process by collecting the data to back up by querying the API server for resources.</li>\n<li>The <code class=\"language-text\">BackupController</code> makes a call to the object storage service (e.g., <a href=\"https://aws.amazon.com/s3/\" target=\"_blank\" rel=\"noopener noreferrer\">AWS S3</a>) to upload the backup file.</li>\n</ol>\n<p>By default, <code class=\"language-text\">velero backup create</code> makes disk snapshots of any persistent volumes. You can adjust the snapshots by specifying additional flags. Run <code class=\"language-text\">velero backup create --help</code> to see available flags. Snapshots can be disabled with the option <code class=\"language-text\">--snapshot-volumes=false</code>.</p>\n<p><span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 56.470588235294116%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAACs0lEQVR42mNgmHnzE8MMKmKggVcZZt28yjjz1jXGmTeugWgQHyYOxjNuAMVuAMVuoMrNvAHFSGoZZt3awjATiOfdWAcU2Aim59zYBBYHy93cBBafeWMzmIaJz7qxiQlIM824tY1x5s3NEHmgOJAxCeiySbx1d3fqlT95IV/+6Cpb3+35QA0TgXITGWfcmMU869Z9IH4B1LgYaOgEhjnXeqQmPVxn3f7pExB/Nul494Rtxs2pQD0TGBgWXUkTq727IKrz0/95O7/9bV72879p2bNHQG8WMMy4niay+P5C5TXP/6tufPtffNnDbQzTrqWwzLhZat3x+ZFd66e3pi0vzji3fvmn1/NmG8OsSxkMDMuuuSoWPt/Ws+H3/9N3fvzcde7rP+/GNz/Zm+9nMiy86cI77168+soH1zVXPXgisfh+EcOcm3ZqE17VO3f8+GPU9GSDSsuNVsuGp9cc2r++ZJ51JxBo4FVtpcJHvWlTf/xfdujnnwmb//63q3x9T7DxsrvClL12ui2rPYWnHHVW79oSqtO61lWxb7uLQP9JO4fOX5fsWz4+Na95cNC29vl346YnMxnmntMChuFdOYaZ1yT18p4scah4/sK69NkdqfwnfsLLNkgFl3UHRZR2RgZUTfKMqOwIiSpvTwivmBCq3j5dwbjjXZRj69eXdg2vn9tUPzojOemGBsOch1IMDB1n+IGG8ovvvMAt135JUGXiCT7RVVd4GIBsJaAcX/0OIa2uLRJK3UfF+PvPC8i1HxbkB8oJzznCC6J5Ws+JCgH1CHbc5WeoPy8AdOFMVob6K2wWhcc4c2/dYo+fv59Dvv4+B0MaUByE6/ezoGCouHz9fg6VidvY4excCJsBDur/M9kDNYAwA8N/RrDY//+M9QwMTP+RaBCGydnX/2cB4dDQ/8wwcwCjqbSaDdTsmQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"logo\" title=\"\" src=\"/static/48361060518a22260fda230c6572a3d5/c5bb3/logo.png\" srcset=\"/static/48361060518a22260fda230c6572a3d5/04472/logo.png 170w,\n/static/48361060518a22260fda230c6572a3d5/9f933/logo.png 340w,\n/static/48361060518a22260fda230c6572a3d5/c5bb3/logo.png 680w,\n/static/48361060518a22260fda230c6572a3d5/5a190/logo.png 800w\" sizes=\"(max-width: 680px) 100vw, 680px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n    </span>\n          </p>\n<h2 id=\"streamline-infrastructure-automation-with-terraform-and-terragrunt\" style=\"position:relative;\"><a href=\"#streamline-infrastructure-automation-with-terraform-and-terragrunt\" aria-label=\"streamline infrastructure automation with terraform and terragrunt permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Streamline Infrastructure Automation with Terraform and Terragrunt</h2>\n<p>Automating infrastructure provisioning with <a href=\"https://www.terraform.io/\" target=\"_blank\" rel=\"noopener noreferrer\">Terraform</a> is a seamless process. By leveraging the comprehensive <a href=\"https://registry.terraform.io/providers/hashicorp/aws/latest\" target=\"_blank\" rel=\"noopener noreferrer\">AWS provider</a> available in the Terraform registry, setting up EKS, OIDC, and Velero resources becomes effortless.</p>\n<p>However, before diving into infrastructure automation, it's crucial to ensure that the Terraform provider is properly configured to interact with the target AWS account. Once configured, Terraform empowers you to effortlessly orchestrate the deployment of complex infrastructure setups, enabling you to focus on higher-level tasks and freeing up valuable time and resources.</p>\n<h2 id=\"-provision-of-the-eks-oidc-and-velero-resources-on-aws\" style=\"position:relative;\"><a href=\"#-provision-of-the-eks-oidc-and-velero-resources-on-aws\" aria-label=\" provision of the eks oidc and velero resources on aws permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üåê Provision of the EKS, OIDC, and Velero Resources on AWS</h2>\n<p>The Terraform configuration is organized as shown below:</p>\n<p><span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 139.41176470588235%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAcCAYAAABh2p9gAAAACXBIWXMAAAsTAAALEwEAmpwYAAABXklEQVR42q2Va26DQAyE98Xu2rSQtLlB73/BKmjrwUuJVKkKMT8skJA+jT1j475uw/d09Qt5t3CSirZyY3J3eWkcekVbOSrhTtPQ6JIbjckMdZSlXQqNZoHOuXEJJqhjAQJCk6j7KI05nqCwAjg0fpdK3g5kATKAqMGf0HKNjUQdXYuqHLwVqC3XWxWn4x6hcDxOCswCpLi6vCp9S1pwHpGC6vzcKHaF3NuetFbnESd8k5E8a5aaIgpZQl2vWY3ZsvhKy7+xQYuTAMmYQ3FUg405bZtiApawYDvW2aFlgE3AKkC0KzD6LNqyJdj00DJJDvlARP6PDVReuimG9eux8apsUwdjsjcAoephM5DJV+/ifm0A3Bw+79pk+4HdgbJ6uNjYlhqsB7bPEFnEDA0qVSH12GxAw29AFSLYY9K/HqcTjgMyJwr/XJrU6whwrHHZ2oUheI5zv4t4HlnD5NsPf1VQcyv7Y+AAAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"code\" title=\"\" src=\"/static/1bcd7b014302897252113fefa3143695/c5bb3/code.png\" srcset=\"/static/1bcd7b014302897252113fefa3143695/04472/code.png 170w,\n/static/1bcd7b014302897252113fefa3143695/9f933/code.png 340w,\n/static/1bcd7b014302897252113fefa3143695/c5bb3/code.png 680w,\n/static/1bcd7b014302897252113fefa3143695/5a190/code.png 800w\" sizes=\"(max-width: 680px) 100vw, 680px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n    </span>\n          </p>\n<h3 id=\"initialize-the-infrastructure-on-an-aws-account\" style=\"position:relative;\"><a href=\"#initialize-the-infrastructure-on-an-aws-account\" aria-label=\"initialize the infrastructure on an aws account permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Initialize the Infrastructure on an AWS Account</h3>\n<p>First, update the content of the local Terragrunt variable called <code class=\"language-text\">aws_profile</code> in the file named <a href=\"https://github.com/seifrajhi/aws-eks-irsa/blob/main/terraform/terragrunt-global-config.hcl\" target=\"_blank\" rel=\"noopener noreferrer\">terragrunt-global-config.hcl</a> to point to your AWS profile instead of mine üòâ.</p>\n<p>Once this is done, you can apply the infrastructure with Terragrunt as follows:</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token builtin class-name\">cd</span> terraform\nterragrunt run-all init\nterragrunt run-all apply</code></pre></div>\n<ul>\n<li>The first Terragrunt command will run <code class=\"language-text\">terraform init</code> in every Terraform layer in the <code class=\"language-text\">terraform</code> folder.</li>\n<li>The second Terragrunt command will run <code class=\"language-text\">terraform apply</code> in each layer.</li>\n</ul>\n<p>On the first apply, Terragrunt will ask if you want to create the Terraform states S3 bucket if it does not exist on your AWS account. It will also create a DynamoDB table for state locking.</p>\n<h3 id=\"how-is-the-aws-iam-oidc-provider-created\" style=\"position:relative;\"><a href=\"#how-is-the-aws-iam-oidc-provider-created\" aria-label=\"how is the aws iam oidc provider created permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>How is the AWS IAM OIDC Provider Created?</h3>\n<p>By default, the IAM OIDC provider is created by the <a href=\"https://github.com/aws-ia/terraform-aws-eks-blueprints/\" target=\"_blank\" rel=\"noopener noreferrer\">AWS EKS Blueprints for Terraform</a> with the input <code class=\"language-text\">enable_irsa</code> set to true.</p>\n<p>To demonstrate how it works, I set that input to false and created the OIDC provider with the AWS provider resources myself (you can find those resources in the file named <code class=\"language-text\">irsa.tf</code>).</p>\n<h3 id=\"how-are-the-velero-resources-created\" style=\"position:relative;\"><a href=\"#how-are-the-velero-resources-created\" aria-label=\"how are the velero resources created permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>How are the Velero Resources Created?</h3>\n<p>The Velero resources are defined in the <code class=\"language-text\">velero.tf</code> file, where configurations for backups, restores, and other Velero functionalities are specified. This Terraform script ensures the creation and configuration of Velero-related resources, enabling efficient data backups and restores for your infrastructure within the defined AWS environment.</p>\n<h3 id=\"how-to-manage-velero-technical-aspect\" style=\"position:relative;\"><a href=\"#how-to-manage-velero-technical-aspect\" aria-label=\"how to manage velero technical aspect permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>How to Manage Velero: Technical Aspect</h3>\n<p>After installing the Velero server on the EKS cluster, you can view Velero's server-side components by running:</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">kubectl get all <span class=\"token parameter variable\">-n</span> velero</code></pre></div>\n<p>Where <code class=\"language-text\">velero</code> is the namespace where all Velero components are running.</p>\n<p>Velero also uses a number of CRDs (Custom Resource Definitions) to represent its own resources like backups, backup schedules, etc.</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">kubectl get crd <span class=\"token operator\">|</span> <span class=\"token function\">grep</span> velero</code></pre></div>\n<h3 id=\"deploy-test-application\" style=\"position:relative;\"><a href=\"#deploy-test-application\" aria-label=\"deploy test application permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Deploy Test Application</h3>\n<p>This step involves deploying a sample application to validate the infrastructure setup and ensure successful integration of the components.</p>\n<p>Create a namespace and deploy the application:</p>\n<p><span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 32.35294117647059%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA00lEQVR42nVR0ZKEIAzza462IKsirNz5/1+lk2sX2fNh7yHTNJ1pUhjqIse4MoQ9vBew9y94kQbjnxDCR334Sulw5QlKCZwz9vTAPo0YlTvVAhECsy6/mRhe2q32hVTy4bYNtK6wyrWCf74bX5sJ7TtiighVTbYKspnhqUEUj1wwq7lo6sGVcrI2tl3GsSG2ame1PirXBPHiNrvmnYfrCQaX82kuvCygUuCU98Sk6fw0gSy1amJcNZ7ndmp/u/vJGvM0B+lp3on+3K2Xe6J/PsQW/gK7n7eJqDjB/gAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"app-test\" title=\"\" src=\"/static/ae8af3428090588d73ccc3a1fb208b9a/c5bb3/app-test.png\" srcset=\"/static/ae8af3428090588d73ccc3a1fb208b9a/04472/app-test.png 170w,\n/static/ae8af3428090588d73ccc3a1fb208b9a/9f933/app-test.png 340w,\n/static/ae8af3428090588d73ccc3a1fb208b9a/c5bb3/app-test.png 680w,\n/static/ae8af3428090588d73ccc3a1fb208b9a/5a190/app-test.png 800w\" sizes=\"(max-width: 680px) 100vw, 680px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n    </span>\n          </p>\n<p>Then verify the deployed application:</p>\n<p><span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 17.058823529411764%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAYAAACTWi8uAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAXElEQVR42pWMQQ6AIBADeQ4uLCECwvL/VxmwAol3OUzaQzuqBro56IcO6saYTkSLr8/cQcVTt5I0UorIuaBWGXnBew8RgbUWY/gbxUxtMI4M5yYOzLxEs+/IpvAF7N5a/KQQW5EAAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"get\" title=\"\" src=\"/static/9e58f0b788a32741f2d3a634b878ee18/c5bb3/get.png\" srcset=\"/static/9e58f0b788a32741f2d3a634b878ee18/04472/get.png 170w,\n/static/9e58f0b788a32741f2d3a634b878ee18/9f933/get.png 340w,\n/static/9e58f0b788a32741f2d3a634b878ee18/c5bb3/get.png 680w,\n/static/9e58f0b788a32741f2d3a634b878ee18/5a190/get.png 800w\" sizes=\"(max-width: 680px) 100vw, 680px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n    </span>\n          </p>\n<h3 id=\"-backups\" style=\"position:relative;\"><a href=\"#-backups\" aria-label=\" backups permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üíæ Backups</h3>\n<p>Now, let's look into backups in case something happens to the blog. Backups are for Kubernetes resources and persistent volumes. You can back up your entire cluster, or optionally choose a namespace or label selector to back up. They can be run one-off or scheduled. It's a good idea to have scheduled backups so you are certain you have a recent backup to easily fall back to. You can also create backup hooks if you want to execute actions before or after a backup is made. By default, the backup retention is 30 days, but you can change it with the <code class=\"language-text\">-ttl</code> flag.</p>\n<p>To see what all you can do with backups, run:</p>\n<p><span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 17.058823529411764%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAYAAACTWi8uAAAACXBIWXMAAAsTAAALEwEAmpwYAAAARklEQVR42mOwNtT8pWus8U9LU/uvtpbWX21tbYowg7qh0R8NE9P/6ubm/7VMTP5r6+r+B0qQjRm0dHT+gAzRAhlEoWEgAwGLKlo1qyYi6AAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"bckp\" title=\"\" src=\"/static/4a6c2a9b89deb93396ccab30d2dffdb8/c5bb3/bckp.png\" srcset=\"/static/4a6c2a9b89deb93396ccab30d2dffdb8/04472/bckp.png 170w,\n/static/4a6c2a9b89deb93396ccab30d2dffdb8/9f933/bckp.png 340w,\n/static/4a6c2a9b89deb93396ccab30d2dffdb8/c5bb3/bckp.png 680w,\n/static/4a6c2a9b89deb93396ccab30d2dffdb8/5a190/bckp.png 800w\" sizes=\"(max-width: 680px) 100vw, 680px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n    </span>\n          </p>\n<p>Let's start with the most basic option: creating a one-off backup. It's a good idea to give it a meaningful name so you remember what it was for, unlike what is done here.</p>\n<p><span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 17.058823529411764%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAYAAACTWi8uAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAbElEQVR42p3PzQ6EIAwE4LKA0CLFn7Pv/45GHRvZZC+e9vAdmklmUto07KruYqJTPsb/rwR3UqrxKCujLBkyJbBGiHew8CGBjPuiH/+OuIZDpgG8WFkbkFtEHRNmyagc+0BLPdd+M3vYN6+FN/aUQCmSYrGeAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"example\" title=\"\" src=\"/static/cf761c976566410cf11eee26251870af/c5bb3/example.png\" srcset=\"/static/cf761c976566410cf11eee26251870af/04472/example.png 170w,\n/static/cf761c976566410cf11eee26251870af/9f933/example.png 340w,\n/static/cf761c976566410cf11eee26251870af/c5bb3/example.png 680w,\n/static/cf761c976566410cf11eee26251870af/5a190/example.png 800w\" sizes=\"(max-width: 680px) 100vw, 680px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n    </span>\n          </p>\n<p>If we want to do a backup with all namespaces included, we can remove the flag <code class=\"language-text\">--include-namespaces</code>. And to include all namespaces except specific ones, we could use <code class=\"language-text\">--exclude-namespaces</code> with the namespace(s) we don't want.</p>\n<p>Let's create a backup from a schedule.</p>\n<p><span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 32.35294117647059%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAAAsTAAALEwEAmpwYAAABEUlEQVR42nVRXU+DQBC8A7UmRkRaTX2TUij9UkAbnwyltLalfDX9//8EMu4diWLUh8mws5fZ2YX1ZmF1MV+CmSuwQQRmrX6B/6G1e3wYNxDa9Syp+osTbr0MhpdDsRpj3jYyo2bYQPTib0OhmRTmcdmwNJzvK91L0Q1y3L+W0OYH6M8Z7l5Kqo+4HG9h+Dl6QQHVD8G8d7BJ+KV3Se8vjvJbpGSGl9VX071Mo9prKHbcMDUVYvFIdTYS3KYENiUZRrIv3p05a5yPNpJlQtVNau6mYBIHsFFCIJ4U4FRzZ0cmG8IHDaUh1vrnym0IjdLV2hPdLyhxQ6tqBMG6X6Az3lGdynXEjcVZHt5O6Ljbf3/gJzt7rZDt0DXoAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"schedule\" title=\"\" src=\"/static/fa7c116f89fb97f998abc491e2cfbdf6/c5bb3/schedule.png\" srcset=\"/static/fa7c116f89fb97f998abc491e2cfbdf6/04472/schedule.png 170w,\n/static/fa7c116f89fb97f998abc491e2cfbdf6/9f933/schedule.png 340w,\n/static/fa7c116f89fb97f998abc491e2cfbdf6/c5bb3/schedule.png 680w,\n/static/fa7c116f89fb97f998abc491e2cfbdf6/5a190/schedule.png 800w\" sizes=\"(max-width: 680px) 100vw, 680px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n    </span>\n          </p>\n<p>See all of the backups created:</p>\n<p><span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 20.58823529411765%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAyElEQVR42k1PyQ6CUBADwSii4BZJPLmABkXE7eLFuCOC0YP//yOYOvMICYem89pZ+qS+f0j11RGqc4M8PkEaHSEx53URuV70C31ivhUkqeHH0Ny7ELRZxiX7jMYiQt2LoM8fhBCKc8mGh9ki9io0x9wgqBPyB/tvam3fUOihTq/oUV33HpBtXh6i6t5QJt3afdAOEpj+E93NGwZxfqyzfokemUJIph/9OqsXmkEs0vElzQ1FAsU5i6RcF9Oayxg1SsxLGHw4//IfvzZ0uue9IYwAAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"result\" title=\"\" src=\"/static/e81f131c9d6961e08d7194c3f35afed0/c5bb3/result.png\" srcset=\"/static/e81f131c9d6961e08d7194c3f35afed0/04472/result.png 170w,\n/static/e81f131c9d6961e08d7194c3f35afed0/9f933/result.png 340w,\n/static/e81f131c9d6961e08d7194c3f35afed0/c5bb3/result.png 680w,\n/static/e81f131c9d6961e08d7194c3f35afed0/5a190/result.png 800w\" sizes=\"(max-width: 680px) 100vw, 680px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n    </span>\n          </p>\n<h2 id=\"-wreak-havoc\" style=\"position:relative;\"><a href=\"#-wreak-havoc\" aria-label=\" wreak havoc permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üí• Wreak Havoc</h2>\n<p>Now that we have a happy cluster state and that most excellent blog you created‚Ä¶ let's nuke the demo.</p>\n<p>Let's say that someone (you) accidentally (definitely intentionally) deleted the demo namespace by running the following:</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">kubectl delete namespace demo</code></pre></div>\n<p>Try to connect to the demo again. Shoot‚Ä¶ Now the site is down and so is that super important blog post you just made. What now?</p>\n<h3 id=\"-restore\" style=\"position:relative;\"><a href=\"#-restore\" aria-label=\" restore permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üîÑ Restore</h3>\n<p>Well, it's a good thing you have backups! Now it's time to look into restoring from a backup. To see what all you can do with restore, run:</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">velero restore <span class=\"token parameter variable\">-h</span></code></pre></div>\n<p>Let's now wait for all of the resources to be gone. First, check the output of <code class=\"language-text\">get all</code>:</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">kubectl get all <span class=\"token parameter variable\">-n</span> demo</code></pre></div>\n<p>Note: It might take some time until everything is properly deleted; so you may run these commands above until they give you a (somewhat ominous) \"No resources found\" output.</p>\n<p>Now to perform a restore:</p>\n<p>To take a look at what backups you have, you can run the following again:</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">velero backup get</code></pre></div>\n<p>To restore from the specific backup we created first:</p>\n<p>So the big questions are:\nDid all the resources come back up?</p>\n<p>Let's find out. First, let's check to see if our resources are back and running:</p>\n<p><span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 10.588235294117647%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAACCAYAAABYBvyLAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAaElEQVR42lXKwQoDIQyEYY0uaKJGwrrXQt//CUu3U4XSbQ/fYX7G3W17dPMvJn9K9Ccv4d/q8tNlKpE+zX2t7azwc2jBoRV7Exy9gmNCDgoOHckbNDcMFWRiJFLUreE2dhjPH7n5u7wBd6wrpLczbRcAAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"restore\" title=\"\" src=\"/static/a6c9b4eef35a409cb385d9618e5d3f77/c5bb3/restore.png\" srcset=\"/static/a6c9b4eef35a409cb385d9618e5d3f77/04472/restore.png 170w,\n/static/a6c9b4eef35a409cb385d9618e5d3f77/9f933/restore.png 340w,\n/static/a6c9b4eef35a409cb385d9618e5d3f77/c5bb3/restore.png 680w,\n/static/a6c9b4eef35a409cb385d9618e5d3f77/5a190/restore.png 800w\" sizes=\"(max-width: 680px) 100vw, 680px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n    </span>\n          </p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">kubectl get all <span class=\"token parameter variable\">-n</span> demo</code></pre></div>\n<p>It worked üéâ</p>\n<h2 id=\"-conclusion-\" style=\"position:relative;\"><a href=\"#-conclusion-\" aria-label=\" conclusion  permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üåü Conclusion üåü</h2>\n<p>This hands-on blog explored the simplified process of backing up a Kubernetes cluster using Velero. We delved into the magic of Velero, understanding its key components and how it seamlessly integrates with EKS. By following the step-by-step guide, readers can now confidently implement effective backup strategies for their EKS infrastructure, ensuring data resilience and peace of mind.</p>\n<p>Velero truly simplifies EKS backups, empowering organizations to safeguard their valuable data effortlessly.</p>\n<p>I hope you guys have enjoyed this hands-on tutorial and learned a bit more than what you knew before. Let me know if you have any questions related to this blog.</p>\n<br>\n<p><strong><em>Until next time, „Å§„Å•„Åè üéâ</em></strong></p>\n<blockquote>\n<p>üí° Thank you for Reading !! üôåüèªüòÅüìÉ, see you in the next blog.ü§ò  <em><strong>Until next time üéâ</strong></em></p>\n</blockquote>\n<p>üöÄ Thank you for sticking up till the end. If you have any questions/feedback regarding this blog feel free to connect with me:</p>\n<p><strong>‚ôªÔ∏è LinkedIn:</strong> <a href=\"https://www.linkedin.com/in/rajhi-saif/\" target=\"_blank\" rel=\"noopener noreferrer\">https://www.linkedin.com/in/rajhi-saif/</a></p>\n<p><strong>‚ôªÔ∏è X/Twitter:</strong> <a href=\"https://x.com/rajhisaifeddine\" target=\"_blank\" rel=\"noopener noreferrer\">https://x.com/rajhisaifeddine</a></p>\n<p><strong>The end ‚úåüèª</strong></p>\n<h1 align=\"center\">üî∞ Keep Learning !! Keep Sharing !! üî∞</h1>\n<p><strong>üìÖ Stay updated</strong></p>\n<p>Subscribe to our newsletter for more insights on AWS cloud computing and containers.</p>"}}},"staticQueryHashes":["1271460761","1321585977"],"slicesMap":{}}