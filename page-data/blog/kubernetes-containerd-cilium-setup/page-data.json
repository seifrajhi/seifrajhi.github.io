{"componentChunkName":"component---src-templates-blog-template-js","path":"/blog/kubernetes-containerd-cilium-setup/","result":{"data":{"markdownRemark":{"html":"<blockquote>\n<p><strong>Definitive Guide to Setting Up Kubernetes 1.31 with containerd v2 and Cilium</strong></p>\n</blockquote>\n<h2 id=\"introduction\" style=\"position:relative;\"><a href=\"#introduction\" aria-label=\"introduction permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Introduction</h2>\n<p>Welcome to this guide on setting up <a href=\"https://kubernetes.io/blog/2024/08/13/kubernetes-v1-31-release/\" target=\"_blank\" rel=\"noopener noreferrer\">Kubernetes 1.31</a> with the <a href=\"https://github.com/containerd/containerd/releases/tag/v2.0.0\" target=\"_blank\" rel=\"noopener noreferrer\">containerd v2</a> runtime and <a href=\"https://isovalent.com/blog/post/cilium-1-16/\" target=\"_blank\" rel=\"noopener noreferrer\">Cilium</a> for networking. This guide is designed to be a comprehensive reference for professionals worldwide, ensuring a robust and efficient container orchestration environment with advanced networking capabilities.</p>\n<p>This guide is designed to be a comprehensive reference for professionals worldwide, ensuring an efficient container orchestration environment with advanced networking capabilities.</p>\n<p><span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 56.470588235294116%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAABYlAAAWJQFJUiTwAAACsElEQVR42lWSa08TQRSGt9vtbru73V5BLFBFaEAqYqUCClrRpPESo9wqBVQqKF5iNWrVNIJKECQE0RgToyZ+9JuGH2FMiL/DxF/xeNpI1A9nZzYz88y873sU3QpxKFLHqdoYx6LbOOQE2O849HpNhvYk+fZ6meORKF1OiE5NZzU3yKt7N0m4NTKBAEnT5LSsJ0O1aGYQxW342WmHSDoRkv4w/X6HlOWnyzDprW/g+/s1pg72sMOls9f0s/G8zMKlPK2qh322TZvXoMVnUSMwVViK5nVQZOKRsT8YJeMPkA1GOGIHOBffydcnJRZGB0l5LHKJVjaelnh85gQZeW3GtOn0mSgCd8v5KqvyqcD0Shk2mlvHo3lxKR5C4VquzU4xM3MRrx2mu6eH8sMi6QNpbCtIc1MCTfa6NUMYgb/AavkCVOSrblkUsCUW1NbHyU/kmb46TUe6l7PDw1yZnSHR1s6bt+/Y3NykMb4LRVHRRfJ/QI9hoQlIUTTC0Rj9A1lGxiYoz89z536JxRcrPJqbZ2VtjaHzea4XS5TKCzQ1766e+QcoL9NNXN4Yqh4QqT4aGmJ0dO4h0Z6m+3CG4fwks7duM1GYITc5RaQxwfriPD++fGBXS7sADQH+kayKuXZ9N+VPv+jLvcQrLbP6KMvCqRSGVYMeqmNovED2bI6LV4v0DpyUQ0FGD3fy+eYAYWkZRfz2+P4FxtI8+PiTvtE1uUmjcHmIwUwB3V9He9cBllaWmXv2hOcrS4xdKhCLN9FSE2RusI1YfQrTSYpdYpmo/StZj+LSLFRVQrG2ofmlzDBHs1mmJYji3SI3ijcYL0zRk+rg80gj69kI8aYLbI8Pi13GFtCpTjxeuxqKS9UlaV0u8aH6HPmXPlMqJYG5nOro0kOkmlsJS6+6NVv22myF+xub+ExAFfRKCQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"alt text\" title=\"\" src=\"/static/12cdd828513870f8806426a0fb0e22b5/c5bb3/k8s-containerd-cilium-cover.png\" srcset=\"/static/12cdd828513870f8806426a0fb0e22b5/04472/k8s-containerd-cilium-cover.png 170w,\n/static/12cdd828513870f8806426a0fb0e22b5/9f933/k8s-containerd-cilium-cover.png 340w,\n/static/12cdd828513870f8806426a0fb0e22b5/c5bb3/k8s-containerd-cilium-cover.png 680w,\n/static/12cdd828513870f8806426a0fb0e22b5/b12f7/k8s-containerd-cilium-cover.png 1020w,\n/static/12cdd828513870f8806426a0fb0e22b5/b5a09/k8s-containerd-cilium-cover.png 1360w,\n/static/12cdd828513870f8806426a0fb0e22b5/0e758/k8s-containerd-cilium-cover.png 2502w\" sizes=\"(max-width: 680px) 100vw, 680px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n    </span>\n          </p>\n<h2 id=\"prerequisites\" style=\"position:relative;\"><a href=\"#prerequisites\" aria-label=\"prerequisites permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Prerequisites</h2>\n<p>Before we begin, ensure you have the following prerequisites:</p>\n<ul>\n<li>A system running <a href=\"https://releases.ubuntu.com/\" target=\"_blank\" rel=\"noopener noreferrer\">Ubuntu 22.04 LTS</a> or higher, 64-bit x86, and kernel 6.8.</li>\n<li>Root or sudo access to the system.</li>\n<li>Basic knowledge of <a href=\"https://kubernetes.io/\" target=\"_blank\" rel=\"noopener noreferrer\">Kubernetes</a>, <a href=\"https://containerd.io/\" target=\"_blank\" rel=\"noopener noreferrer\">containerd</a>, and <a href=\"https://cilium.io/\" target=\"_blank\" rel=\"noopener noreferrer\">Cilium</a>.</li>\n</ul>\n<h2 id=\"step-by-step-guide\" style=\"position:relative;\"><a href=\"#step-by-step-guide\" aria-label=\"step by step guide permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Step-by-Step Guide</h2>\n<h3 id=\"1-install-required-tools\" style=\"position:relative;\"><a href=\"#1-install-required-tools\" aria-label=\"1 install required tools permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>1. Install Required Tools</h3>\n<p>First, we need to ensure that <code class=\"language-text\">figlet</code> and <code class=\"language-text\">toilet</code> are installed for printing colorful messages.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token keyword\">if</span> <span class=\"token operator\">!</span> <span class=\"token builtin class-name\">command</span> <span class=\"token parameter variable\">-v</span> figlet <span class=\"token operator\">&amp;></span> /dev/null <span class=\"token operator\">||</span> <span class=\"token operator\">!</span> <span class=\"token builtin class-name\">command</span> <span class=\"token parameter variable\">-v</span> toilet <span class=\"token operator\">&amp;></span> /dev/null<span class=\"token punctuation\">;</span> <span class=\"token keyword\">then</span>\n    <span class=\"token builtin class-name\">echo</span> <span class=\"token parameter variable\">-e</span> <span class=\"token string\">\"<span class=\"token entity\" title=\"\\033\">\\033</span>[0;33mFiglet or Toilet not found, installing...\"</span>\n    <span class=\"token function\">sudo</span> <span class=\"token function\">apt-get</span> update <span class=\"token operator\">&amp;&amp;</span> <span class=\"token function\">sudo</span> <span class=\"token function\">apt-get</span> <span class=\"token function\">install</span> <span class=\"token parameter variable\">-y</span> figlet toilet\n<span class=\"token keyword\">fi</span></code></pre></div>\n<h3 id=\"2-print-the-title\" style=\"position:relative;\"><a href=\"#2-print-the-title\" aria-label=\"2 print the title permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>2. Print the Title</h3>\n<p>Use <code class=\"language-text\">figlet</code> to print the title of the script.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">figlet <span class=\"token parameter variable\">-f</span> smblock <span class=\"token string\">\"Setup Kubernetes 1.31 with containerd v2 and Cilium\"</span></code></pre></div>\n<h3 id=\"3-disable-swap\" style=\"position:relative;\"><a href=\"#3-disable-swap\" aria-label=\"3 disable swap permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>3. Disable Swap</h3>\n<p>Disabling swap is crucial for Kubernetes to function correctly. Kubernetes requires swap to be disabled to ensure optimal performance and stability.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">swapoff <span class=\"token parameter variable\">-a</span>\n<span class=\"token function\">sed</span> <span class=\"token parameter variable\">-i</span> <span class=\"token string\">'/swap/d'</span> /etc/fstab</code></pre></div>\n<blockquote>\n<p><strong>Note</strong>: Disabling swap ensures that Kubernetes can manage resources more effectively, preventing potential issues with resource allocation.</p>\n</blockquote>\n<h3 id=\"4-load-necessary-kernel-modules\" style=\"position:relative;\"><a href=\"#4-load-necessary-kernel-modules\" aria-label=\"4 load necessary kernel modules permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>4. Load Necessary Kernel Modules</h3>\n<p>Load the required kernel modules for containerd.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">cat</span> <span class=\"token operator\">>></span>/etc/modules-load.d/containerd.conf<span class=\"token operator\">&lt;&lt;</span><span class=\"token string\">EOF\noverlay\nbr_netfilter\nEOF</span>\nmodprobe overlay\nmodprobe br_netfilter</code></pre></div>\n<h3 id=\"5-configure-sysctl-for-kubernetes\" style=\"position:relative;\"><a href=\"#5-configure-sysctl-for-kubernetes\" aria-label=\"5 configure sysctl for kubernetes permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>5. Configure sysctl for Kubernetes</h3>\n<p>Configure sysctl parameters required by Kubernetes.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">cat</span> <span class=\"token operator\">>></span>/etc/sysctl.d/kubernetes.conf<span class=\"token operator\">&lt;&lt;</span><span class=\"token string\">EOF\nnet.bridge.bridge-nf-call-ip6tables = 1\nnet.bridge.bridge-nf-call-iptables  = 1\nnet.ipv4.ip_forward                 = 1\nEOF</span>\n<span class=\"token function\">sysctl</span> <span class=\"token parameter variable\">--system</span></code></pre></div>\n<h3 id=\"6-disable-ufw\" style=\"position:relative;\"><a href=\"#6-disable-ufw\" aria-label=\"6 disable ufw permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>6. Disable UFW</h3>\n<p>Disable the Uncomplicated Firewall (UFW) to avoid network issues.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">ufw disable</code></pre></div>\n<h3 id=\"7-remove-unnecessary-packages\" style=\"position:relative;\"><a href=\"#7-remove-unnecessary-packages\" aria-label=\"7 remove unnecessary packages permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>7. Remove Unnecessary Packages</h3>\n<p>Remove unnecessary packages to avoid conflicts.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">sudo</span> <span class=\"token function\">apt-get</span> remove containernetworking-plugins <span class=\"token parameter variable\">-y</span> <span class=\"token operator\">&amp;&amp;</span> <span class=\"token function\">sudo</span> <span class=\"token function\">apt-get</span> remove conmon <span class=\"token parameter variable\">-y</span></code></pre></div>\n<h3 id=\"8-create-keyrings-directory\" style=\"position:relative;\"><a href=\"#8-create-keyrings-directory\" aria-label=\"8 create keyrings directory permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>8. Create Keyrings Directory</h3>\n<p>Create the keyrings directory for storing GPG keys.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">mkdir</span> <span class=\"token parameter variable\">-p</span> /etc/apt/keyrings/</code></pre></div>\n<h3 id=\"9-install-containerd\" style=\"position:relative;\"><a href=\"#9-install-containerd\" aria-label=\"9 install containerd permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>9. Install containerd</h3>\n<p>Download and install containerd.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">wget</span> https://github.com/containerd/containerd/releases/download/v2.0.0/containerd-2.0.0-linux-amd64.tar.gz\n<span class=\"token function\">tar</span> <span class=\"token parameter variable\">-C</span> /usr/local <span class=\"token parameter variable\">-xzvf</span> containerd-2.0.0-linux-amd64.tar.gz</code></pre></div>\n<h3 id=\"10-configure-containerd\" style=\"position:relative;\"><a href=\"#10-configure-containerd\" aria-label=\"10 configure containerd permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>10. Configure containerd</h3>\n<p>Create a systemd service file for containerd and start the service.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">mkdir</span> <span class=\"token parameter variable\">-p</span> /usr/local/lib/systemd/system/\n<span class=\"token function\">cat</span> <span class=\"token operator\">&lt;&lt;</span><span class=\"token string\">EOF<span class=\"token bash punctuation\"> <span class=\"token operator\">></span> /usr/local/lib/systemd/system/containerd.service</span>\n[Unit]\nDescription=containerd container runtime\nDocumentation=https://containerd.io\nAfter=network.target local-fs.target dbus.service\n\n[Service]\nExecStartPre=-/sbin/modprobe overlay\nExecStart=/usr/local/bin/containerd\n\nType=notify\nDelegate=yes\nKillMode=process\nRestart=always\nRestartSec=5\n\nLimitNPROC=infinity\nLimitCORE=infinity\nTasksMax=infinity\nOOMScoreAdjust=-999\n\n[Install]\nWantedBy=multi-user.target\nEOF</span>\n\nsystemctl daemon-reload\nsystemctl <span class=\"token builtin class-name\">enable</span> <span class=\"token parameter variable\">--now</span> containerd</code></pre></div>\n<h3 id=\"11-install-runc\" style=\"position:relative;\"><a href=\"#11-install-runc\" aria-label=\"11 install runc permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>11. Install runc</h3>\n<p>Download and install runc.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">wget</span> https://github.com/opencontainers/runc/releases/download/v1.2.1/runc.amd64\n<span class=\"token function\">install</span> <span class=\"token parameter variable\">-m</span> <span class=\"token number\">755</span> runc.amd64 /usr/local/sbin/runc</code></pre></div>\n<h3 id=\"12-install-cni-plugins\" style=\"position:relative;\"><a href=\"#12-install-cni-plugins\" aria-label=\"12 install cni plugins permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>12. Install CNI Plugins</h3>\n<p>Download and install CNI plugins.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">wget</span> https://github.com/containernetworking/plugins/releases/download/v1.6.0/cni-plugins-linux-amd64-v1.6.0.tgz\n<span class=\"token function\">mkdir</span> <span class=\"token parameter variable\">-p</span> /opt/cni/bin\n<span class=\"token function\">tar</span> <span class=\"token parameter variable\">-C</span> /opt/cni/bin <span class=\"token parameter variable\">-xzvf</span> cni-plugins-linux-amd64-v1.6.0.tgz\nsystemctl restart containerd</code></pre></div>\n<h3 id=\"13-verify-containerd-installation\" style=\"position:relative;\"><a href=\"#13-verify-containerd-installation\" aria-label=\"13 verify containerd installation permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>13. Verify containerd Installation</h3>\n<p>Verify the installation of containerd.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">containerd <span class=\"token parameter variable\">-v</span></code></pre></div>\n<h3 id=\"14-add-kubernetes-repository-and-install-components\" style=\"position:relative;\"><a href=\"#14-add-kubernetes-repository-and-install-components\" aria-label=\"14 add kubernetes repository and install components permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>14. Add Kubernetes Repository and Install Components</h3>\n<p>Add the Kubernetes repository and install the necessary components.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"deb [signed-by=/etc/apt/keyrings/kubernetes-apt-keyring.gpg] https://pkgs.k8s.io/core:/stable:/v1.31/deb/ /\"</span> <span class=\"token operator\">|</span> <span class=\"token function\">sudo</span> <span class=\"token function\">tee</span> /etc/apt/sources.list.d/kubernetes.list\n<span class=\"token function\">curl</span> <span class=\"token parameter variable\">-fsSL</span> https://pkgs.k8s.io/core:/stable:/v1.31/deb/Release.key <span class=\"token operator\">|</span> <span class=\"token function\">sudo</span> gpg <span class=\"token parameter variable\">--dearmor</span> <span class=\"token parameter variable\">-o</span> /etc/apt/keyrings/kubernetes-apt-keyring.gpg\n<span class=\"token function\">sudo</span> <span class=\"token function\">apt-get</span> update\n<span class=\"token function\">sudo</span> <span class=\"token function\">apt-get</span> <span class=\"token function\">install</span> kubelet kubeadm kubectl <span class=\"token parameter variable\">-y</span>\n<span class=\"token function\">sudo</span> apt-mark hold kubelet kubeadm kubectl</code></pre></div>\n<h3 id=\"15-output-versions-of-kubernetes-components\" style=\"position:relative;\"><a href=\"#15-output-versions-of-kubernetes-components\" aria-label=\"15 output versions of kubernetes components permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>15. Output Versions of Kubernetes Components</h3>\n<p>Output the versions of the installed Kubernetes components.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">kubeadm version\nkubelet <span class=\"token parameter variable\">--version</span>\nkubectl version <span class=\"token parameter variable\">--client</span></code></pre></div>\n<h3 id=\"16-enable-and-start-kubelet\" style=\"position:relative;\"><a href=\"#16-enable-and-start-kubelet\" aria-label=\"16 enable and start kubelet permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>16. Enable and Start kubelet</h3>\n<p>Enable and start the kubelet service.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">sudo</span> systemctl <span class=\"token builtin class-name\">enable</span> <span class=\"token parameter variable\">--now</span> kubelet</code></pre></div>\n<h3 id=\"17-initialize-kubernetes-cluster-with-kubeadm\" style=\"position:relative;\"><a href=\"#17-initialize-kubernetes-cluster-with-kubeadm\" aria-label=\"17 initialize kubernetes cluster with kubeadm permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>17. Initialize Kubernetes Cluster with kubeadm</h3>\n<p>Initialize the Kubernetes cluster with the specified pod network CIDR using <code class=\"language-text\">kubeadm</code>.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">kubeadm init --pod-network-cidr<span class=\"token operator\">=</span><span class=\"token number\">192.168</span>.0.0/16 --cri-socket unix:///run/containerd/containerd.sock --ignore-preflight-errors<span class=\"token operator\">=</span>NumCPU</code></pre></div>\n<h3 id=\"18-configure-kubectl-for-the-current-user\" style=\"position:relative;\"><a href=\"#18-configure-kubectl-for-the-current-user\" aria-label=\"18 configure kubectl for the current user permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>18. Configure kubectl for the Current User</h3>\n<p>Set up <code class=\"language-text\">kubectl</code> for the current user.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">mkdir</span> <span class=\"token parameter variable\">-p</span> <span class=\"token environment constant\">$HOME</span>/.kube\n<span class=\"token function\">sudo</span> <span class=\"token function\">cp</span> <span class=\"token parameter variable\">-i</span> /etc/kubernetes/admin.conf <span class=\"token environment constant\">$HOME</span>/.kube/config\n<span class=\"token function\">sudo</span> <span class=\"token function\">chown</span> <span class=\"token variable\"><span class=\"token variable\">$(</span><span class=\"token function\">id</span> <span class=\"token parameter variable\">-u</span><span class=\"token variable\">)</span></span><span class=\"token builtin class-name\">:</span><span class=\"token variable\"><span class=\"token variable\">$(</span><span class=\"token function\">id</span> <span class=\"token parameter variable\">-g</span><span class=\"token variable\">)</span></span> <span class=\"token environment constant\">$HOME</span>/.kube/config\n<span class=\"token builtin class-name\">export</span> <span class=\"token assign-left variable\">KUBECONFIG</span><span class=\"token operator\">=</span>/etc/kubernetes/admin.conf\nkubectl cluster-info dump</code></pre></div>\n<h3 id=\"19-remove-taints-on-control-plane-nodes\" style=\"position:relative;\"><a href=\"#19-remove-taints-on-control-plane-nodes\" aria-label=\"19 remove taints on control plane nodes permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>19. Remove Taints on Control-Plane Nodes</h3>\n<p>Remove taints on control-plane nodes to allow scheduling of pods.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">kubectl taint nodes <span class=\"token parameter variable\">--all</span> node-role.kubernetes.io/control-plane-\nkubectl get nodes <span class=\"token parameter variable\">-o</span> wide</code></pre></div>\n<h3 id=\"20-install-cilium-cni\" style=\"position:relative;\"><a href=\"#20-install-cilium-cni\" aria-label=\"20 install cilium cni permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>20. Install Cilium CNI</h3>\n<p>Cilium is a networking, observability, and security solution with an eBPF-based data plane. Cilium provides a simple flat Layer 3 network with the ability to span multiple clusters in either a native routing or overlay/encapsulation mode, and can enforce network policies on L3-L7 using an identity-based security model that is decoupled from network addressing. Cilium can act as a replacement for kube-proxy; it also offers additional, opt-in observability and security features. Cilium is a CNCF project at the Graduated level.</p>\n<p>Install Cilium CNI for networking.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token assign-left variable\">CILIUM_CLI_VERSION</span><span class=\"token operator\">=</span><span class=\"token variable\"><span class=\"token variable\">$(</span><span class=\"token function\">curl</span> <span class=\"token parameter variable\">-s</span> https://raw.githubusercontent.com/cilium/cilium-cli/main/stable.txt<span class=\"token variable\">)</span></span>\n<span class=\"token assign-left variable\">CLI_ARCH</span><span class=\"token operator\">=</span>amd64\n<span class=\"token keyword\">if</span> <span class=\"token punctuation\">[</span> <span class=\"token string\">\"<span class=\"token variable\"><span class=\"token variable\">$(</span><span class=\"token function\">uname</span> <span class=\"token parameter variable\">-m</span><span class=\"token variable\">)</span></span>\"</span> <span class=\"token operator\">=</span> <span class=\"token string\">\"aarch64\"</span> <span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span> <span class=\"token keyword\">then</span> <span class=\"token assign-left variable\">CLI_ARCH</span><span class=\"token operator\">=</span>arm64<span class=\"token punctuation\">;</span> <span class=\"token keyword\">fi</span>\n<span class=\"token function\">curl</span> <span class=\"token parameter variable\">-L</span> <span class=\"token parameter variable\">--fail</span> --remote-name-all https://github.com/cilium/cilium-cli/releases/download/<span class=\"token variable\">${CILIUM_CLI_VERSION}</span>/cilium-linux-<span class=\"token variable\">${CLI_ARCH}</span>.tar.gz<span class=\"token punctuation\">{</span>,.sha256sum<span class=\"token punctuation\">}</span>\nsha256sum <span class=\"token parameter variable\">--check</span> cilium-linux-<span class=\"token variable\">${CLI_ARCH}</span>.tar.gz.sha256sum\n<span class=\"token function\">sudo</span> <span class=\"token function\">tar</span> xzvfC cilium-linux-<span class=\"token variable\">${CLI_ARCH}</span>.tar.gz /usr/local/bin\n<span class=\"token function\">rm</span> cilium-linux-<span class=\"token variable\">${CLI_ARCH}</span>.tar.gz<span class=\"token punctuation\">{</span>,.sha256sum<span class=\"token punctuation\">}</span>\n\ncilium <span class=\"token function\">install</span> <span class=\"token parameter variable\">--version</span> <span class=\"token number\">1.16</span>.3</code></pre></div>\n<h2 id=\"conclusion\" style=\"position:relative;\"><a href=\"#conclusion\" aria-label=\"conclusion permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Conclusion</h2>\n<p>By following these steps, you can set up Kubernetes 1.31 with the containerd v2 runtime and Cilium for networking using <code class=\"language-text\">kubeadm</code>. This setup provides a robust and efficient container orchestration environment with advanced networking capabilities.</p>\n<blockquote>\n<p><strong>Troubleshooting Tips</strong>: If you encounter any issues during the setup, refer to the official documentation for <a href=\"https://kubernetes.io/docs/\" target=\"_blank\" rel=\"noopener noreferrer\">Kubernetes</a>, <a href=\"https://containerd.io/docs/\" target=\"_blank\" rel=\"noopener noreferrer\">containerd</a>, and <a href=\"https://docs.cilium.io/en/stable/\" target=\"_blank\" rel=\"noopener noreferrer\">Cilium</a>. Additionally, check the logs for any error messages and ensure all prerequisites are met.</p>\n</blockquote>\n<blockquote>\n<p><strong>Security Considerations</strong>: Ensure that your Kubernetes cluster is secured by following best practices, such as enabling RBAC, using network policies, and regularly updating your components.</p>\n</blockquote>\n<blockquote>\n<p><strong>Performance Tips</strong>: Optimize your cluster's performance by monitoring resource usage, scaling appropriately, and tuning configurations based on your workload requirements.</p>\n</blockquote>\n<br>\n<p><strong><em>Until next time, „Å§„Å•„Åè üéâ</em></strong></p>\n<blockquote>\n<p>üí° Thank you for Reading !! üôåüèªüòÅüìÉ, see you in the next blog.ü§ò  <em><strong>Until next time üéâ</strong></em></p>\n</blockquote>\n<p>üöÄ Thank you for sticking up till the end. If you have any questions/feedback regarding this blog feel free to connect with me:</p>\n<p><strong>‚ôªÔ∏è LinkedIn:</strong> <a href=\"https://www.linkedin.com/in/rajhi-saif/\" target=\"_blank\" rel=\"noopener noreferrer\">https://www.linkedin.com/in/rajhi-saif/</a></p>\n<p><strong>‚ôªÔ∏è X/Twitter:</strong> <a href=\"https://x.com/rajhisaifeddine\" target=\"_blank\" rel=\"noopener noreferrer\">https://x.com/rajhisaifeddine</a></p>\n<p><strong>The end ‚úåüèª</strong></p>\n<h1 align=\"center\">üî∞ Keep Learning !! Keep Sharing !! üî∞</h1>\n<p><strong>üìÖ Stay updated</strong></p>\n<p>Subscribe to our newsletter for more insights on AWS cloud computing and containers.</p>","timeToRead":5,"rawMarkdownBody":"> **Definitive Guide to Setting Up Kubernetes 1.31 with containerd v2 and Cilium**\n\n## Introduction\n\nWelcome to this guide on setting up [Kubernetes 1.31](https://kubernetes.io/blog/2024/08/13/kubernetes-v1-31-release/) with the [containerd v2](https://github.com/containerd/containerd/releases/tag/v2.0.0) runtime and [Cilium](https://isovalent.com/blog/post/cilium-1-16/) for networking. This guide is designed to be a comprehensive reference for professionals worldwide, ensuring a robust and efficient container orchestration environment with advanced networking capabilities.\n\nThis guide is designed to be a comprehensive reference for professionals worldwide, ensuring an efficient container orchestration environment with advanced networking capabilities.\n\n![alt text](k8s-containerd-cilium-cover.png)\n\n## Prerequisites\n\nBefore we begin, ensure you have the following prerequisites:\n\n- A system running [Ubuntu 22.04 LTS](https://releases.ubuntu.com/) or higher, 64-bit x86, and kernel 6.8.\n- Root or sudo access to the system.\n- Basic knowledge of [Kubernetes](https://kubernetes.io/), [containerd](https://containerd.io/), and [Cilium](https://cilium.io/).\n\n## Step-by-Step Guide\n\n### 1. Install Required Tools\n\nFirst, we need to ensure that `figlet` and `toilet` are installed for printing colorful messages.\n\n```bash\nif ! command -v figlet &> /dev/null || ! command -v toilet &> /dev/null; then\n    echo -e \"\\033[0;33mFiglet or Toilet not found, installing...\"\n    sudo apt-get update && sudo apt-get install -y figlet toilet\nfi\n```\n\n### 2. Print the Title\n\nUse `figlet` to print the title of the script.\n\n```bash\nfiglet -f smblock \"Setup Kubernetes 1.31 with containerd v2 and Cilium\"\n```\n\n### 3. Disable Swap\n\nDisabling swap is crucial for Kubernetes to function correctly. Kubernetes requires swap to be disabled to ensure optimal performance and stability.\n\n```bash\nswapoff -a\nsed -i '/swap/d' /etc/fstab\n```\n\n> **Note**: Disabling swap ensures that Kubernetes can manage resources more effectively, preventing potential issues with resource allocation.\n\n### 4. Load Necessary Kernel Modules\n\nLoad the required kernel modules for containerd.\n\n```bash\ncat >>/etc/modules-load.d/containerd.conf<<EOF\noverlay\nbr_netfilter\nEOF\nmodprobe overlay\nmodprobe br_netfilter\n```\n\n### 5. Configure sysctl for Kubernetes\n\nConfigure sysctl parameters required by Kubernetes.\n\n```bash\ncat >>/etc/sysctl.d/kubernetes.conf<<EOF\nnet.bridge.bridge-nf-call-ip6tables = 1\nnet.bridge.bridge-nf-call-iptables  = 1\nnet.ipv4.ip_forward                 = 1\nEOF\nsysctl --system\n```\n\n### 6. Disable UFW\n\nDisable the Uncomplicated Firewall (UFW) to avoid network issues.\n\n```bash\nufw disable\n```\n\n### 7. Remove Unnecessary Packages\n\nRemove unnecessary packages to avoid conflicts.\n\n```bash\nsudo apt-get remove containernetworking-plugins -y && sudo apt-get remove conmon -y\n```\n\n### 8. Create Keyrings Directory\n\nCreate the keyrings directory for storing GPG keys.\n\n```bash\nmkdir -p /etc/apt/keyrings/\n```\n\n### 9. Install containerd\n\nDownload and install containerd.\n\n```bash\nwget https://github.com/containerd/containerd/releases/download/v2.0.0/containerd-2.0.0-linux-amd64.tar.gz\ntar -C /usr/local -xzvf containerd-2.0.0-linux-amd64.tar.gz\n```\n\n### 10. Configure containerd\n\nCreate a systemd service file for containerd and start the service.\n\n```bash\nmkdir -p /usr/local/lib/systemd/system/\ncat <<EOF > /usr/local/lib/systemd/system/containerd.service\n[Unit]\nDescription=containerd container runtime\nDocumentation=https://containerd.io\nAfter=network.target local-fs.target dbus.service\n\n[Service]\nExecStartPre=-/sbin/modprobe overlay\nExecStart=/usr/local/bin/containerd\n\nType=notify\nDelegate=yes\nKillMode=process\nRestart=always\nRestartSec=5\n\nLimitNPROC=infinity\nLimitCORE=infinity\nTasksMax=infinity\nOOMScoreAdjust=-999\n\n[Install]\nWantedBy=multi-user.target\nEOF\n\nsystemctl daemon-reload\nsystemctl enable --now containerd\n```\n\n### 11. Install runc\n\nDownload and install runc.\n\n```bash\nwget https://github.com/opencontainers/runc/releases/download/v1.2.1/runc.amd64\ninstall -m 755 runc.amd64 /usr/local/sbin/runc\n```\n\n### 12. Install CNI Plugins\n\nDownload and install CNI plugins.\n\n```bash\nwget https://github.com/containernetworking/plugins/releases/download/v1.6.0/cni-plugins-linux-amd64-v1.6.0.tgz\nmkdir -p /opt/cni/bin\ntar -C /opt/cni/bin -xzvf cni-plugins-linux-amd64-v1.6.0.tgz\nsystemctl restart containerd\n```\n\n### 13. Verify containerd Installation\n\nVerify the installation of containerd.\n\n```bash\ncontainerd -v\n```\n\n### 14. Add Kubernetes Repository and Install Components\n\nAdd the Kubernetes repository and install the necessary components.\n\n```bash\necho \"deb [signed-by=/etc/apt/keyrings/kubernetes-apt-keyring.gpg] https://pkgs.k8s.io/core:/stable:/v1.31/deb/ /\" | sudo tee /etc/apt/sources.list.d/kubernetes.list\ncurl -fsSL https://pkgs.k8s.io/core:/stable:/v1.31/deb/Release.key | sudo gpg --dearmor -o /etc/apt/keyrings/kubernetes-apt-keyring.gpg\nsudo apt-get update\nsudo apt-get install kubelet kubeadm kubectl -y\nsudo apt-mark hold kubelet kubeadm kubectl\n```\n\n### 15. Output Versions of Kubernetes Components\n\nOutput the versions of the installed Kubernetes components.\n\n```bash\nkubeadm version\nkubelet --version\nkubectl version --client\n```\n\n### 16. Enable and Start kubelet\n\nEnable and start the kubelet service.\n\n```bash\nsudo systemctl enable --now kubelet\n```\n\n### 17. Initialize Kubernetes Cluster with kubeadm\n\nInitialize the Kubernetes cluster with the specified pod network CIDR using `kubeadm`.\n\n```bash\nkubeadm init --pod-network-cidr=192.168.0.0/16 --cri-socket unix:///run/containerd/containerd.sock --ignore-preflight-errors=NumCPU\n```\n\n### 18. Configure kubectl for the Current User\n\nSet up `kubectl` for the current user.\n\n```bash\nmkdir -p $HOME/.kube\nsudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config\nsudo chown $(id -u):$(id -g) $HOME/.kube/config\nexport KUBECONFIG=/etc/kubernetes/admin.conf\nkubectl cluster-info dump\n```\n\n### 19. Remove Taints on Control-Plane Nodes\n\nRemove taints on control-plane nodes to allow scheduling of pods.\n\n```bash\nkubectl taint nodes --all node-role.kubernetes.io/control-plane-\nkubectl get nodes -o wide\n```\n\n### 20. Install Cilium CNI\n\nCilium is a networking, observability, and security solution with an eBPF-based data plane. Cilium provides a simple flat Layer 3 network with the ability to span multiple clusters in either a native routing or overlay/encapsulation mode, and can enforce network policies on L3-L7 using an identity-based security model that is decoupled from network addressing. Cilium can act as a replacement for kube-proxy; it also offers additional, opt-in observability and security features. Cilium is a CNCF project at the Graduated level.\n\nInstall Cilium CNI for networking.\n\n```bash\nCILIUM_CLI_VERSION=$(curl -s https://raw.githubusercontent.com/cilium/cilium-cli/main/stable.txt)\nCLI_ARCH=amd64\nif [ \"$(uname -m)\" = \"aarch64\" ]; then CLI_ARCH=arm64; fi\ncurl -L --fail --remote-name-all https://github.com/cilium/cilium-cli/releases/download/${CILIUM_CLI_VERSION}/cilium-linux-${CLI_ARCH}.tar.gz{,.sha256sum}\nsha256sum --check cilium-linux-${CLI_ARCH}.tar.gz.sha256sum\nsudo tar xzvfC cilium-linux-${CLI_ARCH}.tar.gz /usr/local/bin\nrm cilium-linux-${CLI_ARCH}.tar.gz{,.sha256sum}\n\ncilium install --version 1.16.3\n```\n\n## Conclusion\n\nBy following these steps, you can set up Kubernetes 1.31 with the containerd v2 runtime and Cilium for networking using `kubeadm`. This setup provides a robust and efficient container orchestration environment with advanced networking capabilities.\n\n> **Troubleshooting Tips**: If you encounter any issues during the setup, refer to the official documentation for [Kubernetes](https://kubernetes.io/docs/), [containerd](https://containerd.io/docs/), and [Cilium](https://docs.cilium.io/en/stable/). Additionally, check the logs for any error messages and ensure all prerequisites are met.\n\n> **Security Considerations**: Ensure that your Kubernetes cluster is secured by following best practices, such as enabling RBAC, using network policies, and regularly updating your components.\n\n> **Performance Tips**: Optimize your cluster's performance by monitoring resource usage, scaling appropriately, and tuning configurations based on your workload requirements.\n\n<br>\n\n**_Until next time, „Å§„Å•„Åè üéâ_**\n\n> üí° Thank you for Reading !! üôåüèªüòÅüìÉ, see you in the next blog.ü§ò  _**Until next time üéâ**_\n\nüöÄ Thank you for sticking up till the end. If you have any questions/feedback regarding this blog feel free to connect with me:\n\n**‚ôªÔ∏è LinkedIn:** https://www.linkedin.com/in/rajhi-saif/\n\n**‚ôªÔ∏è X/Twitter:** https://x.com/rajhisaifeddine\n\n**The end ‚úåüèª**\n\n<h1 align=\"center\">üî∞ Keep Learning !! Keep Sharing !! üî∞</h1>\n\n**üìÖ Stay updated**\n\nSubscribe to our newsletter for more insights on AWS cloud computing and containers.\n","wordCount":{"words":651},"frontmatter":{"id":"db7135ca07ebb25d38a4a243","path":"/blog/kubernetes-containerd-cilium-setup/","humanDate":"Nov 11, 2024","fullDate":"2024-11-11","title":"Guide to Setting Up Kubernetes 1.31 with containerd v2 and Cilium","keywords":["Kubernetes","containerd","Cilium","Networking"],"excerpt":"An authoritative, step-by-step guide to setting up Kubernetes 1.31 with containerd v2 runtime and Cilium for advanced networking.","cover":{"childImageSharp":{"gatsbyImageData":{"layout":"fullWidth","placeholder":{"fallback":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAABYlAAAWJQFJUiTwAAACsElEQVR42lWSa08TQRSGt9vtbru73V5BLFBFaEAqYqUCClrRpPESo9wqBVQqKF5iNWrVNIJKECQE0RgToyZ+9JuGH2FMiL/DxF/xeNpI1A9nZzYz88y873sU3QpxKFLHqdoYx6LbOOQE2O849HpNhvYk+fZ6meORKF1OiE5NZzU3yKt7N0m4NTKBAEnT5LSsJ0O1aGYQxW342WmHSDoRkv4w/X6HlOWnyzDprW/g+/s1pg72sMOls9f0s/G8zMKlPK2qh322TZvXoMVnUSMwVViK5nVQZOKRsT8YJeMPkA1GOGIHOBffydcnJRZGB0l5LHKJVjaelnh85gQZeW3GtOn0mSgCd8v5KqvyqcD0Shk2mlvHo3lxKR5C4VquzU4xM3MRrx2mu6eH8sMi6QNpbCtIc1MCTfa6NUMYgb/AavkCVOSrblkUsCUW1NbHyU/kmb46TUe6l7PDw1yZnSHR1s6bt+/Y3NykMb4LRVHRRfJ/QI9hoQlIUTTC0Rj9A1lGxiYoz89z536JxRcrPJqbZ2VtjaHzea4XS5TKCzQ1766e+QcoL9NNXN4Yqh4QqT4aGmJ0dO4h0Z6m+3CG4fwks7duM1GYITc5RaQxwfriPD++fGBXS7sADQH+kayKuXZ9N+VPv+jLvcQrLbP6KMvCqRSGVYMeqmNovED2bI6LV4v0DpyUQ0FGD3fy+eYAYWkZRfz2+P4FxtI8+PiTvtE1uUmjcHmIwUwB3V9He9cBllaWmXv2hOcrS4xdKhCLN9FSE2RusI1YfQrTSYpdYpmo/StZj+LSLFRVQrG2ofmlzDBHs1mmJYji3SI3ijcYL0zRk+rg80gj69kI8aYLbI8Pi13GFtCpTjxeuxqKS9UlaV0u8aH6HPmXPlMqJYG5nOro0kOkmlsJS6+6NVv22myF+xub+ExAFfRKCQAAAABJRU5ErkJggg=="},"images":{"fallback":{"src":"/static/12cdd828513870f8806426a0fb0e22b5/3e9e3/k8s-containerd-cilium-cover.png","srcSet":"/static/12cdd828513870f8806426a0fb0e22b5/d0df2/k8s-containerd-cilium-cover.png 750w,\n/static/12cdd828513870f8806426a0fb0e22b5/dc0d4/k8s-containerd-cilium-cover.png 1080w,\n/static/12cdd828513870f8806426a0fb0e22b5/d079a/k8s-containerd-cilium-cover.png 1366w,\n/static/12cdd828513870f8806426a0fb0e22b5/3e9e3/k8s-containerd-cilium-cover.png 1920w","sizes":"100vw"},"sources":[{"srcSet":"/static/12cdd828513870f8806426a0fb0e22b5/b9516/k8s-containerd-cilium-cover.webp 750w,\n/static/12cdd828513870f8806426a0fb0e22b5/2a327/k8s-containerd-cilium-cover.webp 1080w,\n/static/12cdd828513870f8806426a0fb0e22b5/4fad6/k8s-containerd-cilium-cover.webp 1366w,\n/static/12cdd828513870f8806426a0fb0e22b5/467a8/k8s-containerd-cilium-cover.webp 1920w","type":"image/webp","sizes":"100vw"}]},"width":1,"height":0.5619791666666667}}},"coverCredits":"Photo by Saifeddine Rajhi"}}},"pageContext":{"prevThought":{"frontmatter":{"path":"/blog/kro-aws/","title":"Simplify Kubernetes Resource Management with KRO by AWS","date":"2024-11-16 20:00:00"},"excerpt":"Simplify Kubernetes Resource Management with kro by AWS ‚ö° Introduction AWS recently introduced Kube Resource Orchestrator (kro) that‚Ä¶"},"nextThought":{"frontmatter":{"path":"/blog/kubernetes-user-namespaces/","title":"Enhancing Kubernetes Security with User Namespaces","date":"2024-11-10 20:00:00"},"excerpt":"Enhancing Kubernetes Security with User Namespaces üõ°Ô∏è Introduction User namespaces in Kubernetes offer a robust mechanism for enhancing‚Ä¶"}}},"staticQueryHashes":["1271460761","1321585977"],"slicesMap":{}}