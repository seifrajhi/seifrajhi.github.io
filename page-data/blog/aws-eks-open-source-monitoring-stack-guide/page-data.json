{"componentChunkName":"component---src-templates-blog-template-js","path":"/blog/aws-eks-open-source-monitoring-stack-guide/","result":{"data":{"markdownRemark":{"html":"<blockquote>\n<p><strong>Monitoring AWS EKS with performant open source tools</strong></p>\n</blockquote>\n<h2 id=\"-introduction\" style=\"position:relative;\"><a href=\"#-introduction\" aria-label=\" introduction permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üîñ Introduction</h2>\n<p>Amazon Elastic Kubernetes Service (EKS) is a managed Kubernetes service that makes it easy to run Kubernetes on AWS. However, EKS doesn't come with a built-in monitoring solution. This means that you need to set up your own monitoring stack if you want to track the health and performance of your EKS cluster.</p>\n<p>In this article, we will show you how to create a monitoring stack for AWS EKS using <strong>Grafana</strong>, <strong>Prometheus</strong>, <strong>AlertManager</strong>, <strong>Promtail</strong>, and <strong>Loki</strong>. These open source tools provide a comprehensive monitoring solution that can help you track all aspects of your EKS cluster, from metrics to logs.</p>\n<p>We will walk you through the steps of installing and configuring these tools, and we will show you how to create dashboards in Grafana to visualize your data. By the end of this article, you will have a solid understanding of how to monitor your AWS EKS cluster using open source tools.</p>\n<p><span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 60.58823529411765%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAAsTAAALEwEAmpwYAAACGElEQVR42o1SW0/UQBTmB/nsgxp/gG/y6JNvGi9ECEZJjDExPhiNyaIE0GgCSohEBTUYjW5EIqvIqgiuySKIuCyb3W23a2/TaTvz2Zlply364ElPz8y5fD3nO+1ALP7qV5D5LDhx8L/CbRPcsSK1xU36OsTLmhhE9fgBNK72oNbdCWY14wounpS2/MyHM5mBOXQ6stfBqasAxVfKnbvgZB9JhzhbD2+pwjBI6tvAmDTeu7Eorw9efgzOiysINpcVIDMNVA7vgzvzBEFlI+rwIMyoYyksxHzRw8mBOk4NafjygwqnDNHvd+EtXgMjBHRlHLQ4sj2y+WAYRqYP9vQ96BePwm9oMjg1Z2NvTxln7+joGqxjf+8Wsp/VaIFVgr9+AWGtH/7GJYTGx21AuZSfRdDCApggOvaJrnpvash9I5hddnHsRh3nRxuKDUFDWAJ3F8D9tYSPBJC3rY637ocuV2V3cwUiVXR5JFOP01LEprfcAmKKHxbnvS142N21iRMDCmhPdxlL67Qth6fA0oA7/7E4R3B25raOcyONaHQvFfuXSMDVrQC6yaT+qgWwXAYtOleNEJ6vqkWs1gxR0gIYFoNhK63oIepNBpvEIwsz/cHF+GsLUzkHz/MuJnM2nr53kF+h6H/8O1oIweIaxfAzM8qzcf+NjZefCCZm1Xn0lYWZJZIeOeFY0JiMJKwfcBCqHEH497h8h/0DILp1p6X4WIsAAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"Grafana and Prometheus\" title=\"\" src=\"/static/aa73b94cec6b832e7e484005aa23ff4a/c5bb3/gr-prom.png\" srcset=\"/static/aa73b94cec6b832e7e484005aa23ff4a/04472/gr-prom.png 170w,\n/static/aa73b94cec6b832e7e484005aa23ff4a/9f933/gr-prom.png 340w,\n/static/aa73b94cec6b832e7e484005aa23ff4a/c5bb3/gr-prom.png 680w,\n/static/aa73b94cec6b832e7e484005aa23ff4a/5a190/gr-prom.png 800w\" sizes=\"(max-width: 680px) 100vw, 680px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n    </span>\n          </p>\n<h3 id=\"-goals--objectives\" style=\"position:relative;\"><a href=\"#-goals--objectives\" aria-label=\" goals  objectives permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üéØ Goals &#x26; Objectives</h3>\n<p>If you are looking for a comprehensive and cost-effective monitoring solution for your AWS EKS cluster, then this monitoring stack is a great option. So, roll your sleeves and let's get cracking! üî•</p>\n<h3 id=\"-prerequisites\" style=\"position:relative;\"><a href=\"#-prerequisites\" aria-label=\" prerequisites permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üìã Prerequisites</h3>\n<ul>\n<li>Knowledge of Kubernetes.</li>\n<li>AWS EKS cluster.</li>\n<li><a href=\"https://helm.sh/docs/intro/install/\" target=\"_blank\" rel=\"noopener noreferrer\">Helm</a>.</li>\n</ul>\n<h2 id=\"Ô∏è-kube-prometheus-stack-an-effective-way-to-monitor-aws-eks-cluster\" style=\"position:relative;\"><a href=\"#%EF%B8%8F-kube-prometheus-stack-an-effective-way-to-monitor-aws-eks-cluster\" aria-label=\"Ô∏è kube prometheus stack an effective way to monitor aws eks cluster permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üõ†Ô∏è Kube-Prometheus-Stack: An Effective Way to Monitor AWS EKS Cluster</h2>\n<p><a href=\"https://github.com/prometheus-community/helm-charts/tree/main/charts/kube-prometheus-stack\" target=\"_blank\" rel=\"noopener noreferrer\"><strong>Kube-Prometheus-stack</strong></a>, also known as <strong>Prometheus Operator</strong>, is a popular open-source project providing complete monitoring and alerting solutions for Kubernetes clusters. It combines tools and components to create a monitoring stack for Kubernetes environments.</p>\n<p>We will use the official Helm Chart <a href=\"https://artifacthub.io/packages/helm/prometheus-community/kube-prometheus-stack\" target=\"_blank\" rel=\"noopener noreferrer\"><strong>Kube-Prometheus-stack</strong></a>, with a customized value file.</p>\n<h4 id=\"steps-to-deploy-the-monitoring-stack\" style=\"position:relative;\"><a href=\"#steps-to-deploy-the-monitoring-stack\" aria-label=\"steps to deploy the monitoring stack permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Steps to Deploy the Monitoring Stack</h4>\n<ol>\n<li>\n<p><strong>Creating Namespace called monitoring</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"sh\"><pre class=\"language-sh\"><code class=\"language-sh\">kubectl create namespace monitoring</code></pre></div>\n</li>\n<li>\n<p><strong>Add a new Helm Repository</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"sh\"><pre class=\"language-sh\"><code class=\"language-sh\">helm repo <span class=\"token function\">add</span> prometheus-community https://prometheus-community.github.io/helm-charts\nhelm repo update</code></pre></div>\n</li>\n<li>\n<p><strong>Edit the Values</strong></p>\n<p>These settings indicate that the selectors mentioned (rule, service monitor, pod monitor, and scrape config) will have independent configurations and will not be based on Helm graphic values.</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">prometheus</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">enabled</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span>\n  <span class=\"token key atrule\">agentMode</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">false</span>\n  <span class=\"token key atrule\">annotations</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n  <span class=\"token key atrule\">networkPolicy</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">enabled</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">false</span>\n    <span class=\"token key atrule\">flavor</span><span class=\"token punctuation\">:</span> kubernetes\n  <span class=\"token key atrule\">serviceAccount</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">create</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span>\n    <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"\"</span>\n    <span class=\"token key atrule\">annotations</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n  <span class=\"token key atrule\">serviceMonitor</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">interval</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"\"</span>\n    <span class=\"token key atrule\">selfMonitor</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span>\n    <span class=\"token key atrule\">sampleLimit</span><span class=\"token punctuation\">:</span> <span class=\"token number\">0</span>\n    <span class=\"token key atrule\">targetLimit</span><span class=\"token punctuation\">:</span> <span class=\"token number\">0</span>\n    <span class=\"token key atrule\">labelLimit</span><span class=\"token punctuation\">:</span> <span class=\"token number\">0</span>\n    <span class=\"token key atrule\">labelNameLengthLimit</span><span class=\"token punctuation\">:</span> <span class=\"token number\">0</span>\n    <span class=\"token key atrule\">labelValueLengthLimit</span><span class=\"token punctuation\">:</span> <span class=\"token number\">0</span>\n    <span class=\"token key atrule\">scheme</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"\"</span>\n    <span class=\"token key atrule\">tlsConfig</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n    <span class=\"token key atrule\">bearerTokenFile</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">metricRelabelings</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\n    <span class=\"token key atrule\">relabelings</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\n  <span class=\"token key atrule\">prometheusSpec</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">disableCompaction</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">false</span>\n    <span class=\"token key atrule\">enableRemoteWriteReceiver</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">false</span>\n    <span class=\"token key atrule\">replicaExternalLabelName</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"\"</span>\n    <span class=\"token key atrule\">replicaExternalLabelNameClear</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">false</span>\n    <span class=\"token key atrule\">prometheusExternalLabelName</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"\"</span>\n    <span class=\"token key atrule\">prometheusExternalLabelNameClear</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">false</span>\n    <span class=\"token key atrule\">externalUrl</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"\"</span>\n    <span class=\"token key atrule\">nodeSelector</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n    <span class=\"token key atrule\">secrets</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\n    <span class=\"token key atrule\">configMaps</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\n    <span class=\"token key atrule\">query</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n    <span class=\"token key atrule\">ruleNamespaceSelector</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n    <span class=\"token key atrule\">ruleSelectorNilUsesHelmValues</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span>\n    <span class=\"token key atrule\">ruleSelector</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n    <span class=\"token key atrule\">serviceMonitorSelectorNilUsesHelmValues</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span>\n    <span class=\"token key atrule\">serviceMonitorSelector</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n    <span class=\"token key atrule\">serviceMonitorNamespaceSelector</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n    <span class=\"token key atrule\">podMonitorSelectorNilUsesHelmValues</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span>\n    <span class=\"token key atrule\">podMonitorSelector</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n    <span class=\"token key atrule\">podMonitorNamespaceSelector</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n    <span class=\"token key atrule\">probeSelectorNilUsesHelmValues</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span>\n    <span class=\"token key atrule\">probeSelector</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n    <span class=\"token key atrule\">probeNamespaceSelector</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n    <span class=\"token key atrule\">scrapeConfigSelectorNilUsesHelmValues</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span>\n    <span class=\"token key atrule\">scrapeConfigSelector</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n    <span class=\"token key atrule\">scrapeConfigNamespaceSelector</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n    <span class=\"token key atrule\">retention</span><span class=\"token punctuation\">:</span> 10d\n    <span class=\"token key atrule\">retentionSize</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"\"</span>\n    <span class=\"token key atrule\">tsdb</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">outOfOrderTimeWindow</span><span class=\"token punctuation\">:</span> 0s\n    <span class=\"token key atrule\">walCompression</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span>\n    <span class=\"token key atrule\">paused</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">false</span>\n    <span class=\"token key atrule\">replicas</span><span class=\"token punctuation\">:</span> <span class=\"token number\">1</span>\n    <span class=\"token key atrule\">shards</span><span class=\"token punctuation\">:</span> <span class=\"token number\">1</span>\n    <span class=\"token key atrule\">logLevel</span><span class=\"token punctuation\">:</span> info\n    <span class=\"token key atrule\">logFormat</span><span class=\"token punctuation\">:</span> logfmt\n    <span class=\"token key atrule\">routePrefix</span><span class=\"token punctuation\">:</span> /\n    <span class=\"token key atrule\">podMetadata</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n    <span class=\"token key atrule\">podAntiAffinity</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"\"</span>\n    <span class=\"token key atrule\">podAntiAffinityTopologyKey</span><span class=\"token punctuation\">:</span> kubernetes.io/hostname\n    <span class=\"token key atrule\">affinity</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n    <span class=\"token key atrule\">remoteRead</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\n    <span class=\"token key atrule\">additionalRemoteRead</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\n    <span class=\"token key atrule\">remoteWrite</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\n    <span class=\"token key atrule\">additionalRemoteWrite</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\n    <span class=\"token key atrule\">remoteWriteDashboards</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">false</span>\n    <span class=\"token key atrule\">resources</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n    <span class=\"token key atrule\">storageSpec</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n    <span class=\"token key atrule\">volumes</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\n    <span class=\"token key atrule\">volumeMounts</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\n    <span class=\"token key atrule\">additionalScrapeConfigs</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\n    <span class=\"token key atrule\">additionalScrapeConfigsSecret</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n    <span class=\"token key atrule\">additionalPrometheusSecretsAnnotations</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n    <span class=\"token key atrule\">additionalAlertManagerConfigs</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\n    <span class=\"token key atrule\">additionalAlertManagerConfigsSecret</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n    <span class=\"token key atrule\">additionalAlertRelabelConfigs</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\n    <span class=\"token key atrule\">additionalAlertRelabelConfigsSecret</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n    <span class=\"token key atrule\">arbitraryFSAccessThroughSMs</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">false</span>\n    <span class=\"token key atrule\">overrideHonorLabels</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">false</span>\n    <span class=\"token key atrule\">overrideHonorTimestamps</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">false</span>\n    <span class=\"token key atrule\">ignoreNamespaceSelectors</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">false</span>\n    <span class=\"token key atrule\">enforcedNamespaceLabel</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"\"</span>\n    <span class=\"token key atrule\">prometheusRulesExcludedFromEnforce</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\n    <span class=\"token key atrule\">excludedFromEnforcement</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\n    <span class=\"token key atrule\">queryLogFile</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">false</span>\n    <span class=\"token key atrule\">enforcedSampleLimit</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">false</span>\n    <span class=\"token key atrule\">enforcedTargetLimit</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">false</span>\n    <span class=\"token key atrule\">enforcedLabelLimit</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">false</span>\n    <span class=\"token key atrule\">enforcedLabelNameLengthLimit</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">false</span>\n    <span class=\"token key atrule\">enforcedLabelValueLengthLimit</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">false</span>\n    <span class=\"token key atrule\">allowOverlappingBlocks</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">false</span>\n    <span class=\"token key atrule\">minReadySeconds</span><span class=\"token punctuation\">:</span> <span class=\"token number\">0</span>\n    <span class=\"token key atrule\">hostNetwork</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">false</span>\n    <span class=\"token key atrule\">hostAliases</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\n    <span class=\"token key atrule\">tracingConfig</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span></code></pre></div>\n</li>\n<li>\n<p><strong>Run the Helm Deployment Command</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"sh\"><pre class=\"language-sh\"><code class=\"language-sh\">helm upgrade <span class=\"token parameter variable\">--install</span> <span class=\"token parameter variable\">-f</span> values.yaml kube-prometheus-stack prometheus-community/kube-prometheus-stack <span class=\"token parameter variable\">-n</span> monitoring</code></pre></div>\n</li>\n</ol>\n<p>After we deploy the Kube-Prometheus stack, we get:</p>\n<ul>\n<li><strong>Grafana</strong></li>\n<li><strong>Prometheus</strong></li>\n<li><strong>AlertManager</strong></li>\n</ul>\n<h2 id=\"-testing\" style=\"position:relative;\"><a href=\"#-testing\" aria-label=\" testing permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üß™ Testing</h2>\n<p>To check if everything is working, you can use the following commands:</p>\n<h3 id=\"prometheus-dashboard\" style=\"position:relative;\"><a href=\"#prometheus-dashboard\" aria-label=\"prometheus dashboard permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Prometheus Dashboard</h3>\n<div class=\"gatsby-highlight\" data-language=\"sh\"><pre class=\"language-sh\"><code class=\"language-sh\">kubectl port-forward svc/prometheus-operated <span class=\"token number\">9090</span>:9090 <span class=\"token parameter variable\">-n</span> monitoring</code></pre></div>\n<p>You can access the Prometheus dashboard at <a href=\"http://localhost:9090\" target=\"_blank\" rel=\"noopener noreferrer\">http://localhost:9090</a>.</p>\n<h3 id=\"grafana-dashboard\" style=\"position:relative;\"><a href=\"#grafana-dashboard\" aria-label=\"grafana dashboard permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Grafana Dashboard</h3>\n<div class=\"gatsby-highlight\" data-language=\"sh\"><pre class=\"language-sh\"><code class=\"language-sh\">kubectl port-forward svc/kube-prometheus-stack-grafana <span class=\"token number\">3000</span>:3000 <span class=\"token parameter variable\">-n</span> monitoring</code></pre></div>\n<p>You can access the Grafana dashboard at <a href=\"http://localhost:3000\" target=\"_blank\" rel=\"noopener noreferrer\">http://localhost:3000</a>.</p>\n<h3 id=\"check-running-pods\" style=\"position:relative;\"><a href=\"#check-running-pods\" aria-label=\"check running pods permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Check Running Pods</h3>\n<p>To ensure all pods are running, use the following command:</p>\n<div class=\"gatsby-highlight\" data-language=\"sh\"><pre class=\"language-sh\"><code class=\"language-sh\">kubectl get pods <span class=\"token parameter variable\">--namespace</span> monitoring</code></pre></div>\n<h2 id=\"Ô∏è-create-a-servicemonitor\" style=\"position:relative;\"><a href=\"#%EF%B8%8F-create-a-servicemonitor\" aria-label=\"Ô∏è create a servicemonitor permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üõ°Ô∏è Create a ServiceMonitor</h2>\n<p>Prometheus Operator uses ServiceMonitors to auto-detect target pods based on label selectors and associate them with Prometheus instances. The ServiceMonitor defines an application that scrapes metrics from Kubernetes.</p>\n<p>Below is an example manifest for a ServiceMonitor:</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> monitoring.coreos.com/v1\n<span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> ServiceMonitor\n<span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> prometheus<span class=\"token punctuation\">-</span>self\n    <span class=\"token key atrule\">labels</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">app</span><span class=\"token punctuation\">:</span> kube<span class=\"token punctuation\">-</span>prometheus<span class=\"token punctuation\">-</span>stack<span class=\"token punctuation\">-</span>prometheus\n<span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">endpoints</span><span class=\"token punctuation\">:</span>\n        <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">interval</span><span class=\"token punctuation\">:</span> 30s\n            <span class=\"token key atrule\">port</span><span class=\"token punctuation\">:</span> web\n    <span class=\"token key atrule\">selector</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">matchLabels</span><span class=\"token punctuation\">:</span>\n            <span class=\"token key atrule\">app</span><span class=\"token punctuation\">:</span> kube<span class=\"token punctuation\">-</span>prometheus<span class=\"token punctuation\">-</span>stack<span class=\"token punctuation\">-</span>prometheus</code></pre></div>\n<p>The ServiceMonitor defined above will select pods labeled <code class=\"language-text\">app: kube-prometheus-stack-prometheus</code> using the <code class=\"language-text\">spec.selector.matchLabels</code> field.</p>\n<p>To apply the ServiceMonitor manifest, run the following command:</p>\n<div class=\"gatsby-highlight\" data-language=\"sh\"><pre class=\"language-sh\"><code class=\"language-sh\">kubectl apply <span class=\"token parameter variable\">-f</span> servicemonitor.yaml <span class=\"token parameter variable\">-n</span> monitoring</code></pre></div>\n<h2 id=\"-integration-of-promtail-and-loki-to-grafana\" style=\"position:relative;\"><a href=\"#-integration-of-promtail-and-loki-to-grafana\" aria-label=\" integration of promtail and loki to grafana permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üîó Integration of Promtail and Loki to Grafana</h2>\n<p>Promtail is a log agent that ships logs to Loki, a horizontally scalable, highly available, and efficient log store. Loki can be integrated with Grafana to create dashboards that visualize your logs and metrics. This integration provides a powerful way to monitor your applications and infrastructure.</p>\n<h3 id=\"-intro-to-loki\" style=\"position:relative;\"><a href=\"#-intro-to-loki\" aria-label=\" intro to loki permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üìú Intro to Loki</h3>\n<p>Loki uses Promtail as its primary log collector, but it can also accept log flows from other sources, such as Syslog or other log senders. It offers high uptime and supports data replication across multiple replicas for durability and fault tolerance. Loki is tightly integrated with Grafana, allowing you to visualize log metrics. Think of Loki as Prometheus, but for logs.</p>\n<p><span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 76.47058823529412%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAAAsTAAALEwEAmpwYAAADdUlEQVR42mWU628bRRTF/e+CBF8ACcQHEFVbqUICJKo0rXgVNVHURiGpQnDtJjFpHk7qJk1iZ9cOjh3ba3tt79P79No/rh2KkFjt1WhGc88998yZSflRQtQpE3XLxMmEOIro6F1KRYVOp0s8ivF9n9FoJOsdTkundPU+kewLAh/b9bEcH8P2cJwhqa4+oF4uoJVW0bQmQ3dIGHp4TZfQ9WaAYRhKoRHDwMLw20yigGQUMnBCDst99ksa+0oXteWS0rQ2aqXCVa1GvV7HtXWG6iO65/M4pe8IWgeEY4hNFav8s6w/4uz0T5o9n54V8LI44OVbjRcnbY7+ckglo4hkPJEYIz+RsNGP52hlvkDPfUzQyDFCAK0GtZ1PUbc/oJi5zUBv0HNGLLxqMP+HytyGyquLAalCpYfVVPDb5/i9Cn4grTp1olaVhmbSsGPisSd6GfiGytA4o9lsYg+lsBnyNN/hl61Lfty6Yle1SC1tlqg++5zW0nuUsu/T9lTs46/Q9z6S+SdUStuEwtDs5+m//oze0Yesri9SvDKwhjHLeY2FnTq/5mrsqYZo2OnRLebQzzcZXOZxIpvWdQb9dB3nZJ3EqTERwHEcodXT6NU1asprbMdFtyKy5wNywixTNDi8FIZxFBJJRjTVaTJhFIuNZLRlxfUTEp/Z5098/NkuZgWYjOlKy0sHGj9kFObTCruKScrzPHxvSOB7hOKrqb9G0xBG/tjBsU28oYs3sYXmhHEimsaxjCMBDLifrXN7rcKtlTLZsz6pqWmnEQTBjd/im4QkGWN5Axpmlau+Stu5pu90bgqKyRMBNNxItLvi69ULvnmucFAe/MPwP4DThEhkQCxUqO+ycvyYjZNnPH+7wPbF71iWPQOMpWBoNNDVAzpKHl05wGld/B/wXZDAcX2PxcM5FvcfsnT08AbQtGZyiNTi0QKDwydoh8v08osMlTSpoeg3jX9Bg5AgDJhIQqG2x3LhJ1aPnvDbm8fkLjaEoTW77/IE4FV3MV/coZu+xyB9B/fkKSnTM+T424Q9ubOxgAmgL4czZbijprm/eYuH2Xs82LrL2psFTMOU2xQQiSTu+Tp2+ks62w8wM3exd+dIdbwmvW6XftWgdl3Dtu0Zw+lj0NBrbEpS+nRFTnCNS02RDiIJ6UR6dmWub31Pa3OOdvZbTCXH3+D1Qwt2M2GrAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"Promtail\" title=\"\" src=\"/static/e34799ae75e169ae345722b568a24cc9/c5bb3/promtail.png\" srcset=\"/static/e34799ae75e169ae345722b568a24cc9/04472/promtail.png 170w,\n/static/e34799ae75e169ae345722b568a24cc9/9f933/promtail.png 340w,\n/static/e34799ae75e169ae345722b568a24cc9/c5bb3/promtail.png 680w,\n/static/e34799ae75e169ae345722b568a24cc9/f8067/promtail.png 726w\" sizes=\"(max-width: 680px) 100vw, 680px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n    </span>\n          </p>\n<h3 id=\"-add-a-new-helm-repository\" style=\"position:relative;\"><a href=\"#-add-a-new-helm-repository\" aria-label=\" add a new helm repository permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üì• Add a New Helm Repository</h3>\n<div class=\"gatsby-highlight\" data-language=\"sh\"><pre class=\"language-sh\"><code class=\"language-sh\">helm repo <span class=\"token function\">add</span> grafana https://grafana.github.io/helm-charts\nhelm repo update</code></pre></div>\n<h3 id=\"-run-the-helm-deployment-command\" style=\"position:relative;\"><a href=\"#-run-the-helm-deployment-command\" aria-label=\" run the helm deployment command permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üöÄ Run the Helm Deployment Command</h3>\n<div class=\"gatsby-highlight\" data-language=\"sh\"><pre class=\"language-sh\"><code class=\"language-sh\">helm upgrade <span class=\"token parameter variable\">--install</span> loki grafana/loki-distributed <span class=\"token parameter variable\">-n</span> monitoring</code></pre></div>\n<p>After deploying Loki, update the Kube-Prometheus-stack values file to add additional data sources. This configuration defines a default additional data source that connects to a Loki log aggregation system. It specifies the URL for accessing Loki and sets the access method to the proxy.</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">grafana</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">additionalDataSources</span><span class=\"token punctuation\">:</span>\n        <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Loki\n            <span class=\"token key atrule\">type</span><span class=\"token punctuation\">:</span> loki\n            <span class=\"token key atrule\">url</span><span class=\"token punctuation\">:</span> http<span class=\"token punctuation\">:</span>//loki<span class=\"token punctuation\">-</span>loki<span class=\"token punctuation\">-</span>distributed<span class=\"token punctuation\">-</span>gateway.monitoring.svc.cluster.local\n            <span class=\"token key atrule\">access</span><span class=\"token punctuation\">:</span> proxy</code></pre></div>\n<p>Please refer to the <a href=\"https://github.com/grafana/helm-charts\" target=\"_blank\" rel=\"noopener noreferrer\">Helm values</a> for more details.</p>\n<h3 id=\"-intro-to-promtail\" style=\"position:relative;\"><a href=\"#-intro-to-promtail\" aria-label=\" intro to promtail permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üìú Intro to Promtail</h3>\n<p>Promtail can log files from different sources, including local files, container output streams (stdout and stderr), and systemd journals. It supports the development, filtering, and relabeling of logs before sending them to Loki.</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">clients</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">url</span><span class=\"token punctuation\">:</span> http<span class=\"token punctuation\">:</span>//loki<span class=\"token punctuation\">-</span>loki<span class=\"token punctuation\">-</span>distributed<span class=\"token punctuation\">-</span>gateway.monitoring.svc.cluster.local/loki/api/v1/push</code></pre></div>\n<p>Please refer to the <a href=\"https://github.com/grafana/helm-charts\" target=\"_blank\" rel=\"noopener noreferrer\">Helm values</a> for more details.</p>\n<h3 id=\"-run-the-helm-upgrade-command\" style=\"position:relative;\"><a href=\"#-run-the-helm-upgrade-command\" aria-label=\" run the helm upgrade command permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üöÄ Run the Helm Upgrade Command</h3>\n<div class=\"gatsby-highlight\" data-language=\"sh\"><pre class=\"language-sh\"><code class=\"language-sh\">helm upgrade <span class=\"token parameter variable\">--install</span> <span class=\"token parameter variable\">-f</span> promtail.yaml promtail grafana/promtail <span class=\"token parameter variable\">-n</span> monitoring</code></pre></div>\n<p>After deploying Promtail and Loki, two new data sources will be presented to Grafana.</p>\n<h3 id=\"-access-grafana\" style=\"position:relative;\"><a href=\"#-access-grafana\" aria-label=\" access grafana permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üîç Access Grafana</h3>\n<p>Run the following command to port-forward Grafana:</p>\n<div class=\"gatsby-highlight\" data-language=\"sh\"><pre class=\"language-sh\"><code class=\"language-sh\">kubectl port-forward svc/kube-prometheus-stack-grafana <span class=\"token number\">3000</span>:3000 <span class=\"token parameter variable\">-n</span> monitoring</code></pre></div>\n<p>Connect to Grafana by navigating to <a href=\"http://localhost:3000\" target=\"_blank\" rel=\"noopener noreferrer\">http://localhost:3000</a>, then go to <strong>Menu -> Data Sources</strong> to add the new data sources.</p>\n<h3 id=\"-summary\" style=\"position:relative;\"><a href=\"#-summary\" aria-label=\" summary permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üìù Summary</h3>\n<p>Setting up a monitoring stack for Kubernetes is a complex task, but it is essential for ensuring the health and performance of your applications. The steps outlined in this article provide a good starting point, but they are just the beginning. In most cases, workloads will not be limited to Kubernetes pods and containers. There will also be a need to monitor virtual machines and other infrastructure components. A unified logging mechanism based on the same tools is essential for getting a complete view of your system.</p>\n<br>\n<p><strong><em>Until next time, „Å§„Å•„Åè üéâ</em></strong></p>\n<blockquote>\n<p>üí° Thank you for Reading !! üôåüèªüòÅüìÉ, see you in the next blog.ü§ò  <strong><em>Until next time üéâ</em></strong></p>\n</blockquote>\n<p>üöÄ Thank you for sticking up till the end. If you have any questions/feedback regarding this blog feel free to connect with me:</p>\n<p><strong>‚ôªÔ∏è LinkedIn:</strong> <a href=\"https://www.linkedin.com/in/rajhi-saif/\" target=\"_blank\" rel=\"noopener noreferrer\">https://www.linkedin.com/in/rajhi-saif/</a></p>\n<p><strong>‚ôªÔ∏è X/Twitter:</strong> <a href=\"https://x.com/rajhisaifeddine\" target=\"_blank\" rel=\"noopener noreferrer\">https://x.com/rajhisaifeddine</a></p>\n<p><strong>The end ‚úåüèª</strong></p>\n<h1 align=\"center\">üî∞ Keep Learning !! Keep Sharing !! üî∞</h1>\n<p><strong>üìÖ Stay updated</strong></p>\n<p>Subscribe to our newsletter for more insights on AWS cloud computing and containers.</p>","timeToRead":5,"rawMarkdownBody":"\n> **Monitoring AWS EKS with performant open source tools**\n\n## üîñ Introduction\n\nAmazon Elastic Kubernetes Service (EKS) is a managed Kubernetes service that makes it easy to run Kubernetes on AWS. However, EKS doesn't come with a built-in monitoring solution. This means that you need to set up your own monitoring stack if you want to track the health and performance of your EKS cluster.\n\nIn this article, we will show you how to create a monitoring stack for AWS EKS using **Grafana**, **Prometheus**, **AlertManager**, **Promtail**, and **Loki**. These open source tools provide a comprehensive monitoring solution that can help you track all aspects of your EKS cluster, from metrics to logs.\n\nWe will walk you through the steps of installing and configuring these tools, and we will show you how to create dashboards in Grafana to visualize your data. By the end of this article, you will have a solid understanding of how to monitor your AWS EKS cluster using open source tools.\n\n![Grafana and Prometheus](./gr-prom.png)\n\n### üéØ Goals & Objectives\n\nIf you are looking for a comprehensive and cost-effective monitoring solution for your AWS EKS cluster, then this monitoring stack is a great option. So, roll your sleeves and let's get cracking! üî•\n\n### üìã Prerequisites\n\n- Knowledge of Kubernetes.\n- AWS EKS cluster.\n- [Helm](https://helm.sh/docs/intro/install/).\n\n## üõ†Ô∏è Kube-Prometheus-Stack: An Effective Way to Monitor AWS EKS Cluster\n\n[**Kube-Prometheus-stack**](https://github.com/prometheus-community/helm-charts/tree/main/charts/kube-prometheus-stack), also known as **Prometheus Operator**, is a popular open-source project providing complete monitoring and alerting solutions for Kubernetes clusters. It combines tools and components to create a monitoring stack for Kubernetes environments.\n\nWe will use the official Helm Chart [**Kube-Prometheus-stack**](https://artifacthub.io/packages/helm/prometheus-community/kube-prometheus-stack), with a customized value file.\n\n#### Steps to Deploy the Monitoring Stack\n\n1. **Creating Namespace called monitoring**\n\n    ```sh\n    kubectl create namespace monitoring\n    ```\n\n2. **Add a new Helm Repository**\n\n    ```sh\n    helm repo add prometheus-community https://prometheus-community.github.io/helm-charts\n    helm repo update\n    ```\n\n3. **Edit the Values**\n\n    These settings indicate that the selectors mentioned (rule, service monitor, pod monitor, and scrape config) will have independent configurations and will not be based on Helm graphic values.\n\n    ```yaml\n    prometheus:\n      enabled: true\n      agentMode: false\n      annotations: {}\n      networkPolicy:\n        enabled: false\n        flavor: kubernetes\n      serviceAccount:\n        create: true\n        name: \"\"\n        annotations: {}\n      serviceMonitor:\n        interval: \"\"\n        selfMonitor: true\n        sampleLimit: 0\n        targetLimit: 0\n        labelLimit: 0\n        labelNameLengthLimit: 0\n        labelValueLengthLimit: 0\n        scheme: \"\"\n        tlsConfig: {}\n        bearerTokenFile:\n        metricRelabelings: []\n        relabelings: []\n      prometheusSpec:\n        disableCompaction: false\n        enableRemoteWriteReceiver: false\n        replicaExternalLabelName: \"\"\n        replicaExternalLabelNameClear: false\n        prometheusExternalLabelName: \"\"\n        prometheusExternalLabelNameClear: false\n        externalUrl: \"\"\n        nodeSelector: {}\n        secrets: []\n        configMaps: []\n        query: {}\n        ruleNamespaceSelector: {}\n        ruleSelectorNilUsesHelmValues: true\n        ruleSelector: {}\n        serviceMonitorSelectorNilUsesHelmValues: true\n        serviceMonitorSelector: {}\n        serviceMonitorNamespaceSelector: {}\n        podMonitorSelectorNilUsesHelmValues: true\n        podMonitorSelector: {}\n        podMonitorNamespaceSelector: {}\n        probeSelectorNilUsesHelmValues: true\n        probeSelector: {}\n        probeNamespaceSelector: {}\n        scrapeConfigSelectorNilUsesHelmValues: true\n        scrapeConfigSelector: {}\n        scrapeConfigNamespaceSelector: {}\n        retention: 10d\n        retentionSize: \"\"\n        tsdb:\n          outOfOrderTimeWindow: 0s\n        walCompression: true\n        paused: false\n        replicas: 1\n        shards: 1\n        logLevel: info\n        logFormat: logfmt\n        routePrefix: /\n        podMetadata: {}\n        podAntiAffinity: \"\"\n        podAntiAffinityTopologyKey: kubernetes.io/hostname\n        affinity: {}\n        remoteRead: []\n        additionalRemoteRead: []\n        remoteWrite: []\n        additionalRemoteWrite: []\n        remoteWriteDashboards: false\n        resources: {}\n        storageSpec: {}\n        volumes: []\n        volumeMounts: []\n        additionalScrapeConfigs: []\n        additionalScrapeConfigsSecret: {}\n        additionalPrometheusSecretsAnnotations: {}\n        additionalAlertManagerConfigs: []\n        additionalAlertManagerConfigsSecret: {}\n        additionalAlertRelabelConfigs: []\n        additionalAlertRelabelConfigsSecret: {}\n        arbitraryFSAccessThroughSMs: false\n        overrideHonorLabels: false\n        overrideHonorTimestamps: false\n        ignoreNamespaceSelectors: false\n        enforcedNamespaceLabel: \"\"\n        prometheusRulesExcludedFromEnforce: []\n        excludedFromEnforcement: []\n        queryLogFile: false\n        enforcedSampleLimit: false\n        enforcedTargetLimit: false\n        enforcedLabelLimit: false\n        enforcedLabelNameLengthLimit: false\n        enforcedLabelValueLengthLimit: false\n        allowOverlappingBlocks: false\n        minReadySeconds: 0\n        hostNetwork: false\n        hostAliases: []\n        tracingConfig: {}\n    ```\n\n4. **Run the Helm Deployment Command**\n\n    ```sh\n    helm upgrade --install -f values.yaml kube-prometheus-stack prometheus-community/kube-prometheus-stack -n monitoring\n    ```\n\nAfter we deploy the Kube-Prometheus stack, we get:\n\n- **Grafana**\n- **Prometheus**\n- **AlertManager**\n\n\n\n\n\n## üß™ Testing\n\nTo check if everything is working, you can use the following commands:\n\n### Prometheus Dashboard\n\n```sh\nkubectl port-forward svc/prometheus-operated 9090:9090 -n monitoring\n```\n\nYou can access the Prometheus dashboard at [http://localhost:9090](http://localhost:9090).\n\n### Grafana Dashboard\n\n```sh\nkubectl port-forward svc/kube-prometheus-stack-grafana 3000:3000 -n monitoring\n```\n\nYou can access the Grafana dashboard at [http://localhost:3000](http://localhost:3000).\n\n### Check Running Pods\n\nTo ensure all pods are running, use the following command:\n\n```sh\nkubectl get pods --namespace monitoring\n```\n\n## üõ°Ô∏è Create a ServiceMonitor\n\nPrometheus Operator uses ServiceMonitors to auto-detect target pods based on label selectors and associate them with Prometheus instances. The ServiceMonitor defines an application that scrapes metrics from Kubernetes.\n\nBelow is an example manifest for a ServiceMonitor:\n\n```yaml\napiVersion: monitoring.coreos.com/v1\nkind: ServiceMonitor\nmetadata:\n    name: prometheus-self\n    labels:\n        app: kube-prometheus-stack-prometheus\nspec:\n    endpoints:\n        - interval: 30s\n            port: web\n    selector:\n        matchLabels:\n            app: kube-prometheus-stack-prometheus\n```\n\nThe ServiceMonitor defined above will select pods labeled `app: kube-prometheus-stack-prometheus` using the `spec.selector.matchLabels` field.\n\nTo apply the ServiceMonitor manifest, run the following command:\n\n```sh\nkubectl apply -f servicemonitor.yaml -n monitoring\n```\n\n\n## üîó Integration of Promtail and Loki to Grafana\n\nPromtail is a log agent that ships logs to Loki, a horizontally scalable, highly available, and efficient log store. Loki can be integrated with Grafana to create dashboards that visualize your logs and metrics. This integration provides a powerful way to monitor your applications and infrastructure.\n\n### üìú Intro to Loki\n\nLoki uses Promtail as its primary log collector, but it can also accept log flows from other sources, such as Syslog or other log senders. It offers high uptime and supports data replication across multiple replicas for durability and fault tolerance. Loki is tightly integrated with Grafana, allowing you to visualize log metrics. Think of Loki as Prometheus, but for logs.\n\n![Promtail](./promtail.png)\n\n### üì• Add a New Helm Repository\n\n```sh\nhelm repo add grafana https://grafana.github.io/helm-charts\nhelm repo update\n```\n\n### üöÄ Run the Helm Deployment Command\n\n```sh\nhelm upgrade --install loki grafana/loki-distributed -n monitoring\n```\n\nAfter deploying Loki, update the Kube-Prometheus-stack values file to add additional data sources. This configuration defines a default additional data source that connects to a Loki log aggregation system. It specifies the URL for accessing Loki and sets the access method to the proxy.\n\n```yaml\ngrafana:\n    additionalDataSources:\n        - name: Loki\n            type: loki\n            url: http://loki-loki-distributed-gateway.monitoring.svc.cluster.local\n            access: proxy\n```\n\nPlease refer to the [Helm values](https://github.com/grafana/helm-charts) for more details.\n\n### üìú Intro to Promtail\n\nPromtail can log files from different sources, including local files, container output streams (stdout and stderr), and systemd journals. It supports the development, filtering, and relabeling of logs before sending them to Loki.\n\n```yaml\nclients:\n    - url: http://loki-loki-distributed-gateway.monitoring.svc.cluster.local/loki/api/v1/push\n```\n\nPlease refer to the [Helm values](https://github.com/grafana/helm-charts) for more details.\n\n### üöÄ Run the Helm Upgrade Command\n\n```sh\nhelm upgrade --install -f promtail.yaml promtail grafana/promtail -n monitoring\n```\n\nAfter deploying Promtail and Loki, two new data sources will be presented to Grafana.\n\n### üîç Access Grafana\n\nRun the following command to port-forward Grafana:\n\n```sh\nkubectl port-forward svc/kube-prometheus-stack-grafana 3000:3000 -n monitoring\n```\n\nConnect to Grafana by navigating to [http://localhost:3000](http://localhost:3000), then go to **Menu -> Data Sources** to add the new data sources.\n\n### üìù Summary\n\nSetting up a monitoring stack for Kubernetes is a complex task, but it is essential for ensuring the health and performance of your applications. The steps outlined in this article provide a good starting point, but they are just the beginning. In most cases, workloads will not be limited to Kubernetes pods and containers. There will also be a need to monitor virtual machines and other infrastructure components. A unified logging mechanism based on the same tools is essential for getting a complete view of your system.\n\n<br>\n\n**_Until next time, „Å§„Å•„Åè üéâ_**\n\n> üí° Thank you for Reading !! üôåüèªüòÅüìÉ, see you in the next blog.ü§ò  **_Until next time üéâ_**\n\nüöÄ Thank you for sticking up till the end. If you have any questions/feedback regarding this blog feel free to connect with me:\n\n**‚ôªÔ∏è LinkedIn:** https://www.linkedin.com/in/rajhi-saif/\n\n**‚ôªÔ∏è X/Twitter:** https://x.com/rajhisaifeddine\n\n**The end ‚úåüèª**\n\n<h1 align=\"center\">üî∞ Keep Learning !! Keep Sharing !! üî∞</h1>\n\n**üìÖ Stay updated**\n\nSubscribe to our newsletter for more insights on AWS cloud computing and containers.\n","wordCount":{"words":863},"frontmatter":{"id":"427564576549657714b18aa8","path":"/blog/aws-eks-open-source-monitoring-stack-guide/","humanDate":"Oct 19, 2024","fullDate":"2024-10-19","title":"AWS EKS Monitoring Stack: Grafana, Prometheus, AlertManager, Promtail, and Loki","keywords":["AWS EKS","Grafana","Prometheus","AlertManager","Promtail","Loki","Open Source Monitoring"],"excerpt":"Build a  monitoring solution for AWS EKS using open source tools like Grafana, Prometheus, AlertManager, Promtail, and Loki.","cover":{"childImageSharp":{"gatsbyImageData":{"layout":"fullWidth","placeholder":{"fallback":"data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAANABQDASIAAhEBAxEB/8QAFwAAAwEAAAAAAAAAAAAAAAAAAAIFBP/EABYBAQEBAAAAAAAAAAAAAAAAAAEAAv/aAAwDAQACEAMQAAAB0LETNXIwn//EABkQAQADAQEAAAAAAAAAAAAAAAEAAhEDEv/aAAgBAQABBQLmVIWreIabPSRtr//EABURAQEAAAAAAAAAAAAAAAAAABAh/9oACAEDAQE/AYf/xAAVEQEBAAAAAAAAAAAAAAAAAAAQIf/aAAgBAgEBPwGn/8QAGhAAAgIDAAAAAAAAAAAAAAAAAAEQITEyYf/aAAgBAQAGPwKx8jZmY//EABsQAQADAAMBAAAAAAAAAAAAAAEAESExQVFh/9oACAEBAAE/IfjDmOYr05c7oiJC00oqKaz/2gAMAwEAAgADAAAAEO8//8QAFhEBAQEAAAAAAAAAAAAAAAAAEQAB/9oACAEDAQE/EARl/8QAGBEAAgMAAAAAAAAAAAAAAAAAAAERUXH/2gAIAQIBAT8Q0Q7P/8QAHhABAQACAQUBAAAAAAAAAAAAAREAIUExUWFxgcH/2gAIAQEAAT8QmLIXTjIzDmGyzXqY9r88PhAGR8T9ySAXv1mAGUrNZ//Z"},"images":{"fallback":{"src":"/static/d0373c5aed13102fe758285deac4b7a6/20b93/eks-oss-cover.jpg","srcSet":"/static/d0373c5aed13102fe758285deac4b7a6/6cce3/eks-oss-cover.jpg 750w,\n/static/d0373c5aed13102fe758285deac4b7a6/20b93/eks-oss-cover.jpg 800w","sizes":"100vw"},"sources":[{"srcSet":"/static/d0373c5aed13102fe758285deac4b7a6/d2a19/eks-oss-cover.webp 750w,\n/static/d0373c5aed13102fe758285deac4b7a6/56f2e/eks-oss-cover.webp 800w","type":"image/webp","sizes":"100vw"}]},"width":1,"height":0.6675}}},"coverCredits":"Photo by Saifeddine Rajhi"}}},"pageContext":{"prevThought":{"frontmatter":{"path":"/blog/aws-signer-oci-artifacts/","title":"Secure the software supply chain with AWS Signer for signing and validating OCI artifacts","date":"2024-10-19 12:34:00"},"excerpt":"Ensuring the integrity and authenticity of containerized applications and Metadata üîñ Introduction The adoption of containers grows, so does‚Ä¶","html":"<blockquote>\n<p><strong>Ensuring the integrity and authenticity of containerized applications and Metadata</strong></p>\n</blockquote>\n<h2 id=\"-introduction\" style=\"position:relative;\"><a href=\"#-introduction\" aria-label=\" introduction permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üîñ Introduction</h2>\n<p>The adoption of containers grows, so does the need to ensure the integrity and authenticity of the software artifacts that make up these applications.</p>\n<p>Beyond just the container images themselves, organizations are required to secure additional metadata files, such as Common Vulnerabilities and Exposure (CVE) scan results, Software Bill of Materials (SBOM), and Helm charts, that provide critical information about the components and dependencies of their containerized applications.</p>\n<p><em>Ensuring the provenance and trustworthiness of these artifacts is essential for maintaining the overall security and compliance of the software supply chain.</em></p>\n<p>In this blog post, we will explore how AWS Signer, a fully managed code-signing service, can be used to cryptographically sign and validate not only container images, but also the associated OCI (Open Container Initiative) artifacts that accompany them.</p>\n<h2 id=\"open-container-initiative-oci\" style=\"position:relative;\"><a href=\"#open-container-initiative-oci\" aria-label=\"open container initiative oci permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Open Container Initiative OCI</h2>\n<p>The Open Container Initiative (OCI) is a lightweight, open governance structure (project), formed under the auspices of the Linux Foundation, for the express purpose of creating open industry standards around container formats and runtimes. The OCI was launched on June 22nd 2015 by Docker, CoreOS and other leaders in the container industry.</p>\n<p>The OCI currently contains three specifications: the Runtime Specification (runtime-spec), the Image Specification (image-spec) and the Distribution Specification (distribution-spec). The Runtime Specification outlines how to run a ‚Äúfilesystem bundle‚Äù that is unpacked on disk.</p>\n<h2 id=\"aws-signer\" style=\"position:relative;\"><a href=\"#aws-signer\" aria-label=\"aws signer permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>AWS Signer</h2>\n<p>AWS Signer is a fully managed signing service that simplifies the process of signing container images. It integrates seamlessly with ECR, allowing you to sign and verify images easily in your ECR repositories.</p>\n<p>AWS Signer uses the Notary project, an open-source container image signing tool, to perform the signing and verification operations. Image signing involves creating a cryptographic signature using a private key and the image‚Äôs digest.</p>\n<p>The signature is then attached to the image, and when the image is deployed, the signature is verified using the corresponding public key.</p>\n<p>If the verification fails, it indicates that the image has been tampered with and should not be deployed.</p>\n<p><span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 48.8235294117647%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAKABQDASIAAhEBAxEB/8QAFwABAQEBAAAAAAAAAAAAAAAAAQADBf/EABQBAQAAAAAAAAAAAAAAAAAAAAH/2gAMAwEAAhADEAAAAeauSMSf/8QAGBAAAgMAAAAAAAAAAAAAAAAAEBEAAQL/2gAIAQEAAQUCcdjR/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPwE//8QAFREBAQAAAAAAAAAAAAAAAAAAEBH/2gAIAQIBAT8Bh//EABQQAQAAAAAAAAAAAAAAAAAAACD/2gAIAQEABj8CX//EABsQAAIBBQAAAAAAAAAAAAAAAAABIRARMWGB/9oACAEBAAE/IU1lJsHLky5X/9oADAMBAAIAAwAAABCIP//EABYRAAMAAAAAAAAAAAAAAAAAAAEQEf/aAAgBAwEBPxClf//EABURAQEAAAAAAAAAAAAAAAAAABAR/9oACAECAQE/EIP/xAAcEAEAAgIDAQAAAAAAAAAAAAABABEhYRAxQXH/2gAIAQEAAT8QMQjOot17rNRqqthBUBp95//Z'); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"Image description\" title=\"\" src=\"/static/c13fa318951a791335eb2364ccbcb103/7bf67/signer.jpg\" srcset=\"/static/c13fa318951a791335eb2364ccbcb103/651be/signer.jpg 170w,\n/static/c13fa318951a791335eb2364ccbcb103/d30a3/signer.jpg 340w,\n/static/c13fa318951a791335eb2364ccbcb103/7bf67/signer.jpg 680w,\n/static/c13fa318951a791335eb2364ccbcb103/4b190/signer.jpg 800w\" sizes=\"(max-width: 680px) 100vw, 680px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n    </span>\n          </p>\n<h2 id=\"hands-on-example\" style=\"position:relative;\"><a href=\"#hands-on-example\" aria-label=\"hands on example permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Hands-On example</h2>\n<p>If you want to implement image signing within our development workflows. It‚Äôs important to think about which other OCI artifacts we intend to incorporate alongside our images. Equally critical is ensuring that security is integrated at every stage of the image‚Äôs lifecycle, from its initial creation to deployment. For this latter aspect, leveraging signatures within an OCI repository can be advantageous, addressing key container security practices:</p>\n<ul>\n<li>Establishing ongoing trust as vulnerabilities and configuration requirements evolve</li>\n<li>Validating the integrity of images to ensure they remain untampered</li>\n<li>Approving images and artifacts that align with organizational compliance standards.</li>\n</ul>\n<p>Consequently, our approach should involve selecting, signing, and managing all relevant OCI artifacts for an image to enhance trust and enhance visibility across the software development lifecycle (SDLC).</p>\n<p>Let‚Äôs check a typical development process and explore how our organization can embrace these practices. Additionally, you can refer to this security blog for further insights on integrating AWS Signer into a pipeline.</p>\n<p><span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 14.117647058823529%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAYAAACTWi8uAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAkElEQVR42jWO3Q6FIAyDff/3U4MGBRT5EQgh8bonXXIulqXb+nXT+74IIYA9pQRrLZxzoltr6L1DKYV5nmXOijHKLft1XTiOA+d54r5vTBTbtiHnjOd5sK6rQAn6vg+1VgHzjuAxBrTWAvPei4dQBtIzGWOw77ssmLAsiwTQQBiD/p/wC0JY1PRwTx8/L6XgB6xj3HIHDGD8AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"Image description\" title=\"\" src=\"/static/64c3bc91eeee6e82c1495482e8ea2693/c5bb3/example.png\" srcset=\"/static/64c3bc91eeee6e82c1495482e8ea2693/04472/example.png 170w,\n/static/64c3bc91eeee6e82c1495482e8ea2693/9f933/example.png 340w,\n/static/64c3bc91eeee6e82c1495482e8ea2693/c5bb3/example.png 680w,\n/static/64c3bc91eeee6e82c1495482e8ea2693/5a190/example.png 800w\" sizes=\"(max-width: 680px) 100vw, 680px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n    </span>\n          </p>\n<p>Initially, developers fetch public images for initial testing and customization on their local machines.</p>\n<p>Once prepared for building, they upload their build specification files to a shared code repository, such as <strong>AWS CodeCommit</strong>.</p>\n<p>A modification in the shared repository triggers a pipeline via AWS CodeBuild. This pipeline utilizes the build specification files to construct and sign an image using** AWS Signer**.</p>\n<p>Subsequently, the image is uploaded to an <strong>OCI-compliant</strong> image repository, such as Amazon Elastic Container Registry (Amazon ECR). Notably, AWS Signer, in conjunction with the underlying Notation CLI client, can be employed with any OCI 1.0 compatible registry.</p>\n<h2 id=\"conclusion\" style=\"position:relative;\"><a href=\"#conclusion\" aria-label=\"conclusion permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Conclusion</h2>\n<p>By integrating AWS Signer into your software development lifecycle, you can establish a robust and centralized solution for managing the signing and verification of your containerized applications and their supporting metadata, ensuring the trust and integrity of your software supply chain.</p>\n<p><strong>References:</strong></p>\n<ul>\n<li><a href=\"https://aws.amazon.com/blogs/containers/signing-and-validating-oci-artifacts-with-aws-signer/\" target=\"_blank\" rel=\"noopener noreferrer\">https://aws.amazon.com/blogs/containers/signing-and-validating-oci-artifacts-with-aws-signer/</a></li>\n<li><a href=\"https://aws.amazon.com/blogs/security/best-practices-to-help-secure-your-container-image-build-pipeline-by-using-aws-signer/\" target=\"_blank\" rel=\"noopener noreferrer\">https://aws.amazon.com/blogs/security/best-practices-to-help-secure-your-container-image-build-pipeline-by-using-aws-signer/</a></li>\n<li><a href=\"https://aws.amazon.com/blogs/containers/cryptographic-signing-for-containers/\" target=\"_blank\" rel=\"noopener noreferrer\">https://aws.amazon.com/blogs/containers/cryptographic-signing-for-containers/</a></li>\n<li><a href=\"https://opencontainers.org/about/overview/\" target=\"_blank\" rel=\"noopener noreferrer\">https://opencontainers.org/about/overview/</a></li>\n</ul>\n<p><strong><em>Until next time, „Å§„Å•„Åè üéâ</em></strong></p>\n<blockquote>\n<p>üí° Thank you for Reading !! üôåüèªüòÅüìÉ, see you in the next blog.ü§ò  <em><strong>Until next time üéâ</strong></em></p>\n</blockquote>\n<p>üöÄ Thank you for sticking up till the end. If you have any questions/feedback regarding this blog feel free to connect with me:</p>\n<p><strong>‚ôªÔ∏è LinkedIn:</strong> <a href=\"https://www.linkedin.com/in/rajhi-saif/\" target=\"_blank\" rel=\"noopener noreferrer\">https://www.linkedin.com/in/rajhi-saif/</a></p>\n<p><strong>‚ôªÔ∏è X/Twitter:</strong> <a href=\"https://x.com/rajhisaifeddine\" target=\"_blank\" rel=\"noopener noreferrer\">https://x.com/rajhisaifeddine</a></p>\n<p><strong>The end ‚úåüèª</strong></p>\n<h1 align=\"center\">üî∞ Keep Learning !! Keep Sharing !! üî∞</h1>\n<p><strong>üìÖ Stay updated</strong></p>\n<p>Subscribe to our newsletter for more insights on AWS cloud computing and containers.</p>"},"nextThought":{"frontmatter":{"path":"/blog/kubeconfig-eks-authentication-guide-under-the-hood/","title":"Discover Kubeconfig: A guide to EKS authentication with AWS ü§î","date":"2024-10-19 10:36:00"},"excerpt":"AWS EKS-Kubeconfig Connection üêã üìå Introduction One of the key challenges of using EKS is authentication. EKS uses IAM to provide‚Ä¶","html":"<blockquote>\n<p><strong>AWS EKS-Kubeconfig Connection üêã</strong></p>\n</blockquote>\n<h2 id=\"-introduction\" style=\"position:relative;\"><a href=\"#-introduction\" aria-label=\" introduction permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üìå Introduction</h2>\n<p>One of the key challenges of using EKS is authentication. EKS uses IAM to provide authentication to your K8s cluster. However, IAM tokens can be difficult to manage and use.</p>\n<p><a href=\"https://kubernetes.io/docs/concepts/configuration/organize-cluster-access-kubeconfig/\" target=\"_blank\" rel=\"noopener noreferrer\">Kubeconfig</a> is a configuration file that stores information about K8s clusters, including their API server endpoints, certificates, and authentication information. Kubeconfig can be used to authenticate with EKS clusters, making it a more convenient and secure option than IAM tokens. This blog post will discuss how to use kubeconfig to authenticate with EKS clusters. We will also cover the basics of kubeconfig and how it works.</p>\n<p><span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 37.05882352941176%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAAsTAAALEwEAmpwYAAAByUlEQVR42j2SzWsTQRiH+1940ZOnHAShCBUqIviFWqj1A9Go4MF6LOhFPYlaUAy9KEIrSsWD4AceFJFeJNaLpgXTNNvE7G66rJI0Zpu1bjbZ3dnH2Vl04B3mfX8zDy/vbwaEEEDMN6PHfKlLEMbEcYyIIoRIIpS5UOc4jpTW6/WpWza6ufo/Ou5vkjWQXJ564zJ6s0H23hoT0206GxFOO6KyElL4KqjVBIsLIUvFQD0yVy0yO/ay6+AJjpy8wObMEE+evUiBditg7HaT1589Pi37nMu1eF/wlOj7IcWihmFYsuOYbjdS9ZpRZ/vwIY6eucj5S5fZNnSAmdnnKbBs9Ri50eDdF48PCx6n7zZ5Of9HSgFLpRLVakUCDep1E9PUU6BuMrz/OGPZccYnrrFv9CyP/gGT7fFcl2OTDtncOlefbqg5BUGA67oSYpLP59E0TebpnL5L4JbMTgZ3j7Dn8Ck2bR3k/vRsCozCENu2efuxyqu5FcoV2YU0IgxDBfZ9H8dx8DxP5YmBbWedydwDFXemHnLl+i0Ki8UUmLis6zpGTcMyK2jlZfr9gKSeQNNfAJF0PVLOCwXudFx+/GzQaLZYa/0iFkJpfwGFMd7jLUDIiAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"Kubeconfig Diagram\" title=\"\" src=\"/static/4f530c98ecd2cb014bb56234dd64c4a3/c5bb3/Kubeconfig.png\" srcset=\"/static/4f530c98ecd2cb014bb56234dd64c4a3/04472/Kubeconfig.png 170w,\n/static/4f530c98ecd2cb014bb56234dd64c4a3/9f933/Kubeconfig.png 340w,\n/static/4f530c98ecd2cb014bb56234dd64c4a3/c5bb3/Kubeconfig.png 680w,\n/static/4f530c98ecd2cb014bb56234dd64c4a3/2c288/Kubeconfig.png 684w\" sizes=\"(max-width: 680px) 100vw, 680px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n    </span>\n          </p>\n<h2 id=\"Ô∏è-kubeconfig-a-manual-creation-guide-and-its-interplay-with-code-classlanguage-textaws-eks-get-tokencode\" style=\"position:relative;\"><a href=\"#%EF%B8%8F-kubeconfig-a-manual-creation-guide-and-its-interplay-with-code-classlanguage-textaws-eks-get-tokencode\" aria-label=\"Ô∏è kubeconfig a manual creation guide and its interplay with code classlanguage textaws eks get tokencode permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>‚ò∏Ô∏è Kubeconfig: A Manual Creation Guide and its Interplay with <code class=\"language-text\">aws eks get-token</code></h2>\n<p><a href=\"https://kubernetes.io/docs/concepts/configuration/organize-cluster-access-kubeconfig/\" target=\"_blank\" rel=\"noopener noreferrer\">Kubeconfig</a> serves as the backbone for <a href=\"https://kubernetes.io/docs/reference/kubectl/\" target=\"_blank\" rel=\"noopener noreferrer\">kubectl</a>, empowering it to locate the necessary details for cluster selection and communication with the API Server.</p>\n<p>By default, <code class=\"language-text\">kubectl</code> searches for a file named <code class=\"language-text\">config</code> within the <code class=\"language-text\">$HOME/.kube</code> directory, allowing seamless access to Kubernetes resources. In this article, we'll take a hands-on approach and walk you through the manual creation of <code class=\"language-text\">kubeconfig</code>. As we progress, we'll unravel the inner workings of this vital configuration file, exploring its synergy with <code class=\"language-text\">aws eks get-token</code>.</p>\n<p>By the end, you'll have a comprehensive understanding of how these components collaboratively enable secure and efficient interactions with AWS EKS clusters.</p>\n<h3 id=\"-prerequisites-for-this-blog\" style=\"position:relative;\"><a href=\"#-prerequisites-for-this-blog\" aria-label=\" prerequisites for this blog permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üìú Prerequisites for this Blog</h3>\n<ul>\n<li>Basic familiarity with Kubernetes concepts and operations.</li>\n<li>Understanding of Amazon Web Services (AWS) and Elastic Kubernetes Service (EKS).</li>\n<li>Familiarity with the <code class=\"language-text\">kubectl</code> command-line tool.</li>\n<li>A functional AWS EKS Kubernetes cluster, to experiment with <code class=\"language-text\">kubeconfig</code> and <code class=\"language-text\">aws eks get-token</code>.</li>\n</ul>\n<h2 id=\"Ô∏è-hands-on-lab\" style=\"position:relative;\"><a href=\"#%EF%B8%8F-hands-on-lab\" aria-label=\"Ô∏è hands on lab permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üõ†Ô∏è Hands-on Lab</h2>\n<p>In this part, we'll walk through each step, from creating the <code class=\"language-text\">kubeconfig</code> file to leveraging <code class=\"language-text\">aws eks get-token</code>, all while exploring the vital components that facilitate secure authentication and communication with your Kubernetes cluster.</p>\n<h3 id=\"step-1-remove-existing-kubeconfig-folder-Ô∏è\" style=\"position:relative;\"><a href=\"#step-1-remove-existing-kubeconfig-folder-%EF%B8%8F\" aria-label=\"step 1 remove existing kubeconfig folder Ô∏è permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Step 1: Remove Existing Kubeconfig Folder ‚öôÔ∏è</h3>\n<p>Delete the existing <code class=\"language-text\">~/.kube</code> folder created by <code class=\"language-text\">eksctl</code> to ensure a clean slate for <code class=\"language-text\">kubeconfig</code> setup.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">rm</span> <span class=\"token parameter variable\">-r</span> ~/.kube</code></pre></div>\n<h3 id=\"step-2-set-environment-variables-\" style=\"position:relative;\"><a href=\"#step-2-set-environment-variables-\" aria-label=\"step 2 set environment variables  permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Step 2: Set Environment Variables üåç</h3>\n<p>Define <code class=\"language-text\">region</code>, <code class=\"language-text\">cluster_name</code>, and <code class=\"language-text\">account_id</code> as environment variables to simplify subsequent commands.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token builtin class-name\">export</span> <span class=\"token assign-left variable\">region_code</span><span class=\"token operator\">=</span><span class=\"token string\">\"eu-west-1\"</span>\n<span class=\"token builtin class-name\">export</span> <span class=\"token assign-left variable\">cluster_name</span><span class=\"token operator\">=</span><span class=\"token string\">\"poc-cluster\"</span>\n<span class=\"token builtin class-name\">export</span> <span class=\"token assign-left variable\">account_id</span><span class=\"token operator\">=</span><span class=\"token string\">\"account_id\"</span></code></pre></div>\n<h3 id=\"step-3-retrieve-cluster-endpoint-\" style=\"position:relative;\"><a href=\"#step-3-retrieve-cluster-endpoint-\" aria-label=\"step 3 retrieve cluster endpoint  permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Step 3: Retrieve Cluster Endpoint üîó</h3>\n<p>Obtain the cluster endpoint URL required for communication with the Kubernetes API server.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token assign-left variable\">cluster_endpoint</span><span class=\"token operator\">=</span><span class=\"token variable\"><span class=\"token variable\">$(</span>aws eks describe-cluster <span class=\"token punctuation\">\\</span>\n<span class=\"token parameter variable\">--region</span> $region_code <span class=\"token punctuation\">\\</span>\n<span class=\"token parameter variable\">--name</span> $cluster_name <span class=\"token punctuation\">\\</span>\n<span class=\"token parameter variable\">--query</span> <span class=\"token string\">\"cluster.endpoint\"</span> <span class=\"token punctuation\">\\</span>\n<span class=\"token parameter variable\">--output</span> text<span class=\"token variable\">)</span></span></code></pre></div>\n<h3 id=\"step-4-get-certificate-authority-data-\" style=\"position:relative;\"><a href=\"#step-4-get-certificate-authority-data-\" aria-label=\"step 4 get certificate authority data  permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Step 4: Get Certificate Authority Data üîê</h3>\n<p>Acquire the base64-encoded Certificate Authority (CA) Certificate data, essential for secure communication with the cluster.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token assign-left variable\">certificate_data</span><span class=\"token operator\">=</span><span class=\"token punctuation\">$(</span>aws eks describe-cluster <span class=\"token punctuation\">\\</span>\n<span class=\"token parameter variable\">--region</span> <span class=\"token variable\">$region_code</span> <span class=\"token punctuation\">\\</span>\n<span class=\"token parameter variable\">--name</span> <span class=\"token variable\">$cluster_name</span> <span class=\"token punctuation\">\\</span>\n<span class=\"token parameter variable\">--query</span> <span class=\"token string\">\"cluster.certificateAuthority.data\"</span> <span class=\"token punctuation\">\\</span>\n<span class=\"token parameter variable\">--output</span>\naws eks describe-cluster <span class=\"token parameter variable\">--name</span> <span class=\"token variable\">$cluster_name</span> <span class=\"token punctuation\">\\</span>\n<span class=\"token parameter variable\">--query</span> <span class=\"token string\">\"cluster.certificateAuthority.data\"</span> <span class=\"token punctuation\">\\</span>\n<span class=\"token parameter variable\">--output</span> text <span class=\"token operator\">|</span> base64 <span class=\"token parameter variable\">--decode</span> <span class=\"token operator\">></span> eks.crt</code></pre></div>\n<p>Additionally, you can inspect the certificate details using OpenSSL to verify its authenticity:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">openssl x509 <span class=\"token parameter variable\">-in</span> eks.crt <span class=\"token parameter variable\">-text</span> <span class=\"token parameter variable\">-noout</span></code></pre></div>\n<p>Here, the <code class=\"language-text\">Issuer: CN=kubernetes</code> and <code class=\"language-text\">Subject: CN=kubernetes</code> indicate a self-signed certificate issued by EKS.</p>\n<h3 id=\"step-5-create-kubeconfig-directory-\" style=\"position:relative;\"><a href=\"#step-5-create-kubeconfig-directory-\" aria-label=\"step 5 create kubeconfig directory  permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Step 5: Create Kubeconfig Directory üìÇ</h3>\n<p>Prepare the necessary <code class=\"language-text\">~/.kube</code> directory to store the <code class=\"language-text\">kubeconfig</code> file and other Kubernetes configuration files.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">mkdir</span> <span class=\"token parameter variable\">-p</span> ~/.kube</code></pre></div>\n<h3 id=\"step-6-create-kubeconfig-file-\" style=\"position:relative;\"><a href=\"#step-6-create-kubeconfig-file-\" aria-label=\"step 6 create kubeconfig file  permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Step 6. Create Kubeconfig File üìù</h3>\n<p>Generate a configuration file using the following command, which creates the file <code class=\"language-text\">~/.kube/config</code> and automatically fills in all the necessary fields.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token shebang important\">#!/bin/bash</span>\n<span class=\"token builtin class-name\">read</span> <span class=\"token parameter variable\">-r</span> <span class=\"token parameter variable\">-d</span> <span class=\"token string\">''</span> KUBECONFIG <span class=\"token operator\">&lt;&lt;</span><span class=\"token string\">EOF\napiVersion: v1\nclusters:\n- cluster:\n    certificate-authority-data: <span class=\"token variable\">$certificate_data</span>\n    server: <span class=\"token variable\">$cluster_endpoint</span>\n  name: arn:aws:eks:<span class=\"token variable\">$region_code</span>:<span class=\"token variable\">$account_id</span>:cluster/<span class=\"token variable\">$cluster_name</span>\ncontexts:\n- context:\n    cluster: arn:aws:eks:<span class=\"token variable\">$region_code</span>:<span class=\"token variable\">$account_id</span>:cluster/<span class=\"token variable\">$cluster_name</span>\n    user: arn:aws:eks:<span class=\"token variable\">$region_code</span>:<span class=\"token variable\">$account_id</span>:cluster/<span class=\"token variable\">$cluster_name</span>\n  name: arn:aws:eks:<span class=\"token variable\">$region_code</span>:<span class=\"token variable\">$account_id</span>:cluster/<span class=\"token variable\">$cluster_name</span>\ncurrent-context: arn:aws:eks:<span class=\"token variable\">$region_code</span>:<span class=\"token variable\">$account_id</span>:cluster/<span class=\"token variable\">$cluster_name</span>\nkind: Config\npreferences: {}\nusers:\n- name: arn:aws:eks:<span class=\"token variable\">$region_code</span>:<span class=\"token variable\">$account_id</span>:cluster/<span class=\"token variable\">$cluster_name</span>\n  user:\n    exec:\n      apiVersion: client.authentication.k8s.io/v1beta1\n      command: aws\n      args:\n        - --region\n        - <span class=\"token variable\">$region_code</span>\n        - eks\n        - get-token\n        - --cluster-name\n        - <span class=\"token variable\">$cluster_name</span>\n        # - \"-r\"\n        # - \"arn:aws:iam::<span class=\"token variable\">$account_id</span>:role/my-role\"\n      # env:\n        # - name: \"AWS_PROFILE\"\n        #   value: \"aws-profile\"\nEOF</span>\n<span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"<span class=\"token variable\">${KUBECONFIG}</span>\"</span> <span class=\"token operator\">></span> ~/.kube/config</code></pre></div>\n<p>The client token, essential for authentication, will be obtained using the AWS CLI.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">aws eks get-token --cluster-name <span class=\"token variable\">$cluster_name</span></code></pre></div>\n<p>This command provides an <code class=\"language-text\">ExecCredential</code> object containing the required token for authentication.</p>\n<p>The token generated by <code class=\"language-text\">aws eks get-token</code> is a JSON Web Token (JWT) that follows a specific format. Each token begins with the prefix <code class=\"language-text\">k8s-aws-v1.</code>, followed by a base64-encoded string containing JSON data. When decoded, the token should resemble the following structure:</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\n  <span class=\"token property\">\"kind\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"ExecCredential\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"apiVersion\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"client.authentication.k8s.io/v1beta1\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"status\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"expirationTimestamp\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"2023-08-06T12:09:00Z\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"token\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"base64_encoded_jwt_token_here\"</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>With the configuration file created and the client token obtained, our kubeconfig setup is complete.</p>\n<h3 id=\"step-7-verify-cluster-access-\" style=\"position:relative;\"><a href=\"#step-7-verify-cluster-access-\" aria-label=\"step 7 verify cluster access  permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Step 7. Verify Cluster Access üßë‚Äçüíª</h3>\n<p>Now that our kubeconfig is set up and the client token is obtained, let's validate the cluster access and ensure that everything is functioning correctly. We'll use the <code class=\"language-text\">kubectl</code> command-line tool to interact with the cluster.</p>\n<p>First, check the services available in the cluster:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">kubectl get svc</code></pre></div>\n<p>Next, verify the list of nodes in the cluster:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">kubectl get nodes</code></pre></div>\n<p>These commands will provide an overview of the services and nodes within the cluster, confirming successful access and interaction with your AWS EKS cluster. If everything is configured properly, you should see a list of services and nodes, indicating that you have established a successful connection to the Kubernetes cluster on AWS EKS.</p>\n<h3 id=\"step-8-understanding-the-mechanism-‚ìúÔ∏è\" style=\"position:relative;\"><a href=\"#step-8-understanding-the-mechanism-%E2%93%9C%EF%B8%8F\" aria-label=\"step 8 understanding the mechanism ‚ìúÔ∏è permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Step 8. Understanding the Mechanism ‚ìÇÔ∏è</h3>\n<p>Now that we have the IAM user details and the kubeconfig set up, let's explore how the Kubernetes cluster verifies RBAC permissions for these users. Kubernetes checks the IAM user or role credentials obtained earlier against its Role-Based Access Control (RBAC) system.</p>\n<p>To confirm the IAM users or roles added to the cluster's RBAC permissions, we'll examine the <code class=\"language-text\">aws-auth</code> ConfigMap. The ConfigMap stores the mappings between IAM entities and their corresponding Kubernetes roles and groups, defining the access levels for AWS users within the cluster.</p>\n<p>To view the contents of the <code class=\"language-text\">aws-auth</code> ConfigMap, run the following command:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">kubectl describe configmap aws-auth <span class=\"token parameter variable\">-n</span> kube-system</code></pre></div>\n<p>This command will display detailed information about the <code class=\"language-text\">aws-auth</code> ConfigMap, shedding light on the IAM users and roles granted permissions in the Kubernetes cluster.</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">Name</span><span class=\"token punctuation\">:</span>         aws<span class=\"token punctuation\">-</span>auth\n<span class=\"token key atrule\">Namespace</span><span class=\"token punctuation\">:</span>    kube<span class=\"token punctuation\">-</span>system\n<span class=\"token key atrule\">Labels</span><span class=\"token punctuation\">:</span>       &lt;none<span class=\"token punctuation\">></span>\n<span class=\"token key atrule\">Annotations</span><span class=\"token punctuation\">:</span>  &lt;none<span class=\"token punctuation\">></span>\n<span class=\"token key atrule\">API Version</span><span class=\"token punctuation\">:</span>  v1\n<span class=\"token key atrule\">Kind</span><span class=\"token punctuation\">:</span>         ConfigMap\n<span class=\"token key atrule\">Data</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">mapRoles</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">rolearn</span><span class=\"token punctuation\">:</span> arn<span class=\"token punctuation\">:</span>aws<span class=\"token punctuation\">:</span>iam<span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span>123456789012<span class=\"token punctuation\">:</span>role/MyEKSWorkerRole\n      <span class=\"token key atrule\">username</span><span class=\"token punctuation\">:</span> system<span class=\"token punctuation\">:</span>node<span class=\"token punctuation\">:</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span>EC2PrivateDNSName<span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\n      <span class=\"token key atrule\">groups</span><span class=\"token punctuation\">:</span>\n        <span class=\"token punctuation\">-</span> system<span class=\"token punctuation\">:</span>bootstrappers\n        <span class=\"token punctuation\">-</span> system<span class=\"token punctuation\">:</span>nodes\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">rolearn</span><span class=\"token punctuation\">:</span> arn<span class=\"token punctuation\">:</span>aws<span class=\"token punctuation\">:</span>iam<span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span>123456789012<span class=\"token punctuation\">:</span>user/xxxx\n      <span class=\"token key atrule\">username</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"system:node:{{EC2PrivateDNSName}}\"</span>\n      <span class=\"token key atrule\">groups</span><span class=\"token punctuation\">:</span>\n        <span class=\"token punctuation\">-</span> system<span class=\"token punctuation\">:</span>masters</code></pre></div>\n<p>In our exploration, we encountered an intriguing situation where a specific IAM entity had the ability to access the Amazon EKS cluster despite not having a corresponding entry in the <code class=\"language-text\">aws-auth</code> ConfigMap. This enigma led us to uncover an interesting mechanism provided by AWS.</p>\n<p>When you create an Amazon EKS cluster, the AWS Identity and Access Management (IAM) entity user or role, such as a federated user that creates the cluster, is automatically granted <code class=\"language-text\">system:masters</code> permissions in the cluster's role-based access control (RBAC) configuration in the Amazon EKS control plane. This IAM entity doesn't appear in any visible configuration, so make sure to keep track of which IAM entity originally created the cluster.</p>\n<p>However, this automated privilege assignment applies only to the IAM entity that initiated the cluster creation process. For additional users or roles requiring access, corresponding entries must be explicitly defined in the <code class=\"language-text\">aws-auth</code> ConfigMap.</p>\n<p>In our scenario, we observed that the identity of the user who obtained the token via the <code class=\"language-text\">kubectl</code> command (using <code class=\"language-text\">aws eks get-token</code> specified in the kubeconfig) did not have visible RBAC entries in the <code class=\"language-text\">aws-auth</code> ConfigMap. Nonetheless, AWS documentation clarified that this user had already been granted <code class=\"language-text\">system:masters</code> permissions by default, albeit in a concealed manner.</p>\n<h2 id=\"Ô∏è-conclusion\" style=\"position:relative;\"><a href=\"#%EF%B8%8F-conclusion\" aria-label=\"Ô∏è conclusion permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üíÅüèª‚Äç‚ôÇÔ∏è Conclusion</h2>\n<p>This phenomenon highlights a control aspect that we must relinquish when using managed Kubernetes platforms like EKS. Understanding this behavior is essential for assessing the security posture of your Kubernetes cluster, even when certain aspects may not be immediately apparent in the configuration.</p>\n<p>By exploring these intricacies, we gain valuable insights into the underlying mechanics of <a href=\"https://aws.amazon.com/eks/\" target=\"_blank\" rel=\"noopener noreferrer\">AWS EKS</a>, which enables us to make informed decisions to enhance the security and management of our Kubernetes clusters.</p>\n<p>We hope that you have found this blog post helpful. If you have any other tips or tricks that you would like to share, please leave a comment below.</p>\n<br>\n<p><strong><em>Until next time, „Å§„Å•„Åè üéâ</em></strong></p>\n<blockquote>\n<p>üí° Thank you for Reading !! üôåüèªüòÅüìÉ, see you in the next blog.ü§ò  <em><strong>Until next time üéâ</strong></em></p>\n</blockquote>\n<p>üöÄ Thank you for sticking up till the end. If you have any questions/feedback regarding this blog feel free to connect with me:</p>\n<p><strong>‚ôªÔ∏è LinkedIn:</strong> <a href=\"https://www.linkedin.com/in/rajhi-saif/\" target=\"_blank\" rel=\"noopener noreferrer\">https://www.linkedin.com/in/rajhi-saif/</a></p>\n<p><strong>‚ôªÔ∏è X/Twitter:</strong> <a href=\"https://x.com/rajhisaifeddine\" target=\"_blank\" rel=\"noopener noreferrer\">https://x.com/rajhisaifeddine</a></p>\n<p><strong>The end ‚úåüèª</strong></p>\n<h1 align=\"center\">üî∞ Keep Learning !! Keep Sharing !! üî∞</h1>\n<p><strong>üìÖ Stay updated</strong></p>\n<p>Subscribe to our newsletter for more insights on AWS cloud computing and containers.</p>"}}},"staticQueryHashes":["1271460761","1321585977"],"slicesMap":{}}