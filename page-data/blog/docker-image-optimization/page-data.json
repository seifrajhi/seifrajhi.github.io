{"componentChunkName":"component---src-templates-blog-template-js","path":"/blog/docker-image-optimization/","result":{"data":{"markdownRemark":{"html":"<blockquote>\n<p><strong>A Toolbox of Simple Tricks for Docker Image Optimization</strong></p>\n</blockquote>\n<h2 id=\"-introduction\" style=\"position:relative;\"><a href=\"#-introduction\" aria-label=\" introduction permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>‚ò∏ Introduction</h2>\n<p>Docker has revolutionized the way we package and deploy applications, but often, images can become bloated and resource-consuming. Fear not! We have curated a collection of handy tricks that will help you optimize your Docker images without compromising functionality.</p>\n<p>Whether you're a seasoned Docker user or just getting started, join us on this journey to discover the secrets of maximizing efficiency and minimizing image size. Get ready to supercharge your Docker workflow with our toolbox of simple but powerful optimization tricks.</p>\n<p><span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 56.470588235294116%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAABYlAAAWJQFJUiTwAAACgElEQVR42mWTS2tTURSF808E/QUVHDpyoKIjEQUpgvgHxDoRwYEgOHAsoiJiVRCLWrGVNjW2jXmZJn2mTW/uo48k955zX0lj60T83DdxIDpY7LP3WWftvRf3prTWBJHCFwSxQod/zn9q/52F44cDXoIk79fkzlOKlFYBa2VFfVn1o1FTbK4M8rrE9YqgqthYlHxJUVtQmOvCWx3UE6wUBvx2WwR9P2A5r6jOKUpTyQMtuU/6haYoeXZcU5jUcqfJTQg+KsoZ4UmjmjT5NjNAUms1E8HAJ+gooq5gL4mabi9kvRSznI2opGOW5mPWChH1SsTibMRCJqDXieDnHvzaZ/8gFA0PpfsT+mjt43oyskDLxO2Wi9mwcJxtLNvGMGws08GxtyRuEcvD4rLD7ac57j2ZxLCaxHFM2/VItV2XbC6PaVl9U5MGpmmSTqeplPLk5zIU5jPMzX5hajpNuZhldMbk0OUxzt4cZ+jCXY6cHCFXqopoRMp2HN5PfGK9vslmo4Fl2UShrBCETFS2eJV3GPsmk4o/kdjTdH2O3apx/52F7YW0ogNOXLzO6Us36PW6g5VdzyMQkbWNDRqmEG2LnWaLOx82GX5YYvjBV8r1XX7shVQMzdDtHQzvB9eeF3iZa/D42WsOHz0jHuqBYLJqIqrlHEbStd0WQZdQt+mGHvuCxJ+EsyufxvH7HUazIaviZ7nucPr8VU6du0Lve49UEAR9wb9FA+k0U6wy8ugNX4slnGqWxx/Fw+IiqrXN9FLI54UGY+/eyn2RyelZMvN5Op3OP4KC5M9JUFmtMZUtUDcMmtsOueoKKxsGrVYL393lezdmW2wxbYeDg/3+ZslAvwF+aQB1A4WhUAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"alt text\" title=\"\" src=\"/static/1f9f5105c650a5cabc0f2872736831a0/c5bb3/image.png\" srcset=\"/static/1f9f5105c650a5cabc0f2872736831a0/04472/image.png 170w,\n/static/1f9f5105c650a5cabc0f2872736831a0/9f933/image.png 340w,\n/static/1f9f5105c650a5cabc0f2872736831a0/c5bb3/image.png 680w,\n/static/1f9f5105c650a5cabc0f2872736831a0/b12f7/image.png 1020w,\n/static/1f9f5105c650a5cabc0f2872736831a0/b5a09/image.png 1360w,\n/static/1f9f5105c650a5cabc0f2872736831a0/47f6c/image.png 2206w\" sizes=\"(max-width: 680px) 100vw, 680px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n    </span>\n          \n<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 55.294117647058826%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAABYlAAAWJQFJUiTwAAACc0lEQVR42m2RSWtUURCF81P8A/4AA4I7VxGCC5fixkVWIjigEFRciKAbIS7E4EKzkaiJRDBjmx6SzuBL0vPw+vWQl/fufUMnnaFxET+rh5CNi8OtOrfqUKdqwFUK7Sv8UOF1EPQhse6/fnjOndV0es44v9mrVVoz4AWaallTSClKWYVZUJRzvbdSFC6jKKaFy/fiDqxS77/bI3nO6NV2BYPQw8x6JGcVyTmFsazZimsinzWJGUXsuyI6rVmb09038UOxPq/IbCi2VxWr0tep24z0BbX2xJJHcCCj73fG1xy2fSrZJsZSyMZsk1Rc4kiTwlbITixkc8nnIAjhtMXf0yMOj32x7p4JarTn4boKx3FxlUYJTNPqoWJRKJiUihUqZpVyySKQvceMCqPvo7z68BOzahMEAY7wA74EWzsp1jY2RUh14TgOv5aXWUtEMVajrMcWiccizM4vsL6yzMfFMhduTjL8eIqL159y8doD0tk8YRiKoO8TTax0YVWrpDPZ7oStZshCqsHYQpl3kQrbpiNcgO16XH6S482MRd4OqPtHXBoa4fa9l7Tbx2JZ7HZseyJcbzTI5fNUazXsRo3JtTp3JwxGxleIbFv8ORQ3cuHB5zZG7YSHE0m+rps8evaaK0O3OD4+Ohd03M7+5CiyAk/yasPGqtdoenu0/Qa7tuSN3e46ht/uMx7RpItFNrJlBq/e4P7oC5nwpC/YOYqIncGXPJ0vcmfsE9+W4tSNKBOzUSYjSVy7JlNqjJzFl+kp4skkxk6GQskkCIP/C3qSm9Uav1NpCuVK9/rZUpmiXH1vz0G7Ngf7oawpYE/+Wq1WX0PzD5nWBLxRpg+hAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"alt text\" title=\"\" src=\"/static/c97da10d99b01b00879bae63901163ac/c5bb3/image-1.png\" srcset=\"/static/c97da10d99b01b00879bae63901163ac/04472/image-1.png 170w,\n/static/c97da10d99b01b00879bae63901163ac/9f933/image-1.png 340w,\n/static/c97da10d99b01b00879bae63901163ac/c5bb3/image-1.png 680w,\n/static/c97da10d99b01b00879bae63901163ac/b12f7/image-1.png 1020w,\n/static/c97da10d99b01b00879bae63901163ac/b5a09/image-1.png 1360w,\n/static/c97da10d99b01b00879bae63901163ac/0ddab/image-1.png 2220w\" sizes=\"(max-width: 680px) 100vw, 680px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n    </span>\n          </p>\n<h2 id=\"-goals--objectives\" style=\"position:relative;\"><a href=\"#-goals--objectives\" aria-label=\" goals  objectives permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üéØ Goals &#x26; Objectives</h2>\n<p>In this article, we will explore a variety of straightforward techniques that will empower you to create smaller and more efficient Docker images.</p>\n<p>Let's dive in! <strong>HAPPY LEARNING üíª</strong></p>\n<h3 id=\"proven-strategies-for-minimizing-docker-image-size\" style=\"position:relative;\"><a href=\"#proven-strategies-for-minimizing-docker-image-size\" aria-label=\"proven strategies for minimizing docker image size permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Proven Strategies for Minimizing Docker Image Size</h3>\n<p>Building smaller Docker containers should be a top priority in your containerization journey. The significance lies in the fact that smaller images, which leverage shared layers, offer enhanced transfer and deployment speeds. However, managing image size becomes challenging as each <code class=\"language-text\">RUN</code> statement generates a new layer, and intermediate artifacts are often necessary before the image is fully prepared.</p>\n<p>If you've come across various Dockerfiles in the community, you might have observed peculiar techniques like the following:</p>\n<p><span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 17.058823529411764%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAYAAACTWi8uAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAdklEQVR42o3NzQ6EIAwE4ILuD0UqiAYSsu//jhvJLOpljYfdw5ceZtrSS7r3KKoarartVeVuQydxMHWypnXokn3b9ilptRZ+IkWP7B0WZ9GCw03v2hOwpjZ/o+xlLXNAjgHl3u/yNCIFwewYyQsWGRD4AfPH0Q94f0FHlNpAOgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"latest\" title=\"\" src=\"/static/5177b83f2d63ae75efcdbda7782c66f7/c5bb3/latest.png\" srcset=\"/static/5177b83f2d63ae75efcdbda7782c66f7/04472/latest.png 170w,\n/static/5177b83f2d63ae75efcdbda7782c66f7/9f933/latest.png 340w,\n/static/5177b83f2d63ae75efcdbda7782c66f7/c5bb3/latest.png 680w,\n/static/5177b83f2d63ae75efcdbda7782c66f7/b12f7/latest.png 1020w,\n/static/5177b83f2d63ae75efcdbda7782c66f7/b5a09/latest.png 1360w,\n/static/5177b83f2d63ae75efcdbda7782c66f7/29007/latest.png 1600w\" sizes=\"(max-width: 680px) 100vw, 680px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n    </span>\n          </p>\n<p>What is the reason behind using the <code class=\"language-text\">&amp;&amp;</code> symbol in Dockerfiles instead of running two separate <code class=\"language-text\">RUN</code> statements? How does this peculiar approach simplify the build process and unlock the potential for smaller and more efficient Docker images?</p>\n<p><span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 21.764705882352942%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAc0lEQVR42p2OwQ6DIBiDC3IYCPwgZOqI7/+SLJ0ePLllyw5femjzpdii6RIVrVJ0wwEuFO84eUur8bY/GY0i7kBv7sa5JC45soq/DA/RN9kJHhp9S4FryWw175k+Pv1JuGo8mwQuk3BOcX8prMHRG/2X8AVHCFZmb5mc9AAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"runs\" title=\"\" src=\"/static/379e083859522cea28f4b7c2c0975bf9/c5bb3/runs.png\" srcset=\"/static/379e083859522cea28f4b7c2c0975bf9/04472/runs.png 170w,\n/static/379e083859522cea28f4b7c2c0975bf9/9f933/runs.png 340w,\n/static/379e083859522cea28f4b7c2c0975bf9/c5bb3/runs.png 680w,\n/static/379e083859522cea28f4b7c2c0975bf9/b12f7/runs.png 1020w,\n/static/379e083859522cea28f4b7c2c0975bf9/b5a09/runs.png 1360w,\n/static/379e083859522cea28f4b7c2c0975bf9/29007/runs.png 1600w\" sizes=\"(max-width: 680px) 100vw, 680px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n    </span>\n          </p>\n<p>Well, the answer is obvious: when a Docker image is built, each <code class=\"language-text\">RUN</code> statement creates a new layer. These layers consume disk space and can make the resulting image larger. However, by chaining commands with <code class=\"language-text\">&amp;&amp;</code>, you can execute them within a single <code class=\"language-text\">RUN</code> statement, thereby reducing the number of layers generated.</p>\n<p>Using separate <code class=\"language-text\">RUN</code> statements instead of <code class=\"language-text\">&amp;&amp;</code> may seem logical, but it comes with a drawback: each <code class=\"language-text\">RUN</code> statement creates an additional layer, potentially leading to larger image sizes. By utilizing <code class=\"language-text\">&amp;&amp;</code>, you optimize the Docker build process, resulting in smaller and more efficient images. In the previous example, two layers were created instead of consolidating them into a single layer.</p>\n<p><span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 25.882352941176467%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAAAsTAAALEwEAmpwYAAABlklEQVR42iWO7ysDARjHr5QXXvgHvFvxhpdSoniHE4n2glKKeCFJe+GlV5ISZYWRi5HVNcqvYXM0h7vbHduIQ8xm7vyYzbW529pue9zxqW9P3+fFpy9iNptLMAwrxnG8yOFwFDpouhA3GvPIkGTA36HZLgJKfAK68QkNSxeB3j3vTSmiAW98LUSum0C8QSF6j775DrsFhuhABEGQksnkjxYpkUj8RKVYIGTfMYzyZ6bqBxfU+HfUdp6ASu+WWnXnhDGeGtSFIez86WPuAsIWKhuep3JhMwXBhdMIEovF0qCR1dCvosjR44PHMpIZN22f1MO6qzGzT/bl7M46dZusB5KdGt7ioIBdW3zmLJPArcxm2dW5HDM7AZwNiyDaqgz88yfMpNNfLg9puHJSJt5GgNe6p/Kbbrhc2lX1fkuwQ/pCGzfwZGGbYJntyVrZ3twMjcIa1x9BJElaSKVSmKIoi7IsW+Px+PTIiDFfFFNtr0GgxRdwvb/CkRCCQy2U/teFXX6Pr4Jxp1v99HeLj5bKGbfc6fcEfgHsHSEseuMStAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"layers\" title=\"\" src=\"/static/c266a7e069ce7db01575db346dc5b05c/c5bb3/layers.png\" srcset=\"/static/c266a7e069ce7db01575db346dc5b05c/04472/layers.png 170w,\n/static/c266a7e069ce7db01575db346dc5b05c/9f933/layers.png 340w,\n/static/c266a7e069ce7db01575db346dc5b05c/c5bb3/layers.png 680w,\n/static/c266a7e069ce7db01575db346dc5b05c/b12f7/layers.png 1020w,\n/static/c266a7e069ce7db01575db346dc5b05c/f680b/layers.png 1108w\" sizes=\"(max-width: 680px) 100vw, 680px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n    </span>\n          </p>\n<p>Docker layers function akin to Git commits: capturing the modifications between the previous and current image versions. These layers prove beneficial when sharing with other repositories or images, mirroring Git commits' usefulness in sharing code. When fetching an image from a registry, solely the layers absent in your possession are downloaded. This method vastly improves the efficiency of image sharing.</p>\n<p>Nevertheless, layers come at a cost üòø. Layers occupy storage space, and the final image grows heavier with each additional layer. Git repositories exhibit a similar behavior‚Ää‚Äî‚Äärepository size increases in proportion to the number of layers, as Git must retain all changes between commits.</p>\n<p>In the past, it was recommended to consolidate multiple <code class=\"language-text\">RUN</code> statements into a single line, resembling the initial example. However, this practice is no longer advisable. üëå</p>\n<h3 id=\"condense-multiple-layers-into-one-using-multi-stage-docker-builds\" style=\"position:relative;\"><a href=\"#condense-multiple-layers-into-one-using-multi-stage-docker-builds\" aria-label=\"condense multiple layers into one using multi stage docker builds permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Condense Multiple Layers into One Using Multi-Stage Docker Builds</h3>\n<p>Just as you can opt to merge the history of a Git repository into a single commit to simplify it, a similar approach can be applied in Docker through multi-stage builds. In the following scenario, we'll construct a Node.js container. To begin, let's consider an <code class=\"language-text\">index.js</code> file:</p>\n<p><span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 49.411764705882355%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsTAAALEwEAmpwYAAABF0lEQVR42pWSW47DIAxFu4bW2BgIJOn0b/a/O3TnQjpPqdX04wgEysXHzun9pl2b4HIOkCAQCZPLRSYighDCvzkV1V6j4VoUxSPSEpHJVhNuW0JO/lpgM+tvKeKNAbUlrHtGLgkWFckNZvpaoEroxo0qPyTKgJ/Kv5CD8KQNp7xYX5rDqVtY6ZIMNVO7FDgZd3vLuLL660qLUb3Z40Aq9Ug9DQrTgEhsMqo1jDunuseBznXaPAr0ZD06B8KXW6rsXWSIz4/Od9Wv9XzsQ3iinIr1ujnqmqnWcNsrtlao5lioPtbRgtGOvfqc/tMKY4w9Zaqxd6wW6zJCDkZgKweFd+1+/lzZvX/+zPJnoiLfk537+/mjsPHQB251/SFdmqysAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"src\" title=\"\" src=\"/static/64021f4752eb605ffba48dd4de4d96d9/c5bb3/src.png\" srcset=\"/static/64021f4752eb605ffba48dd4de4d96d9/04472/src.png 170w,\n/static/64021f4752eb605ffba48dd4de4d96d9/9f933/src.png 340w,\n/static/64021f4752eb605ffba48dd4de4d96d9/c5bb3/src.png 680w,\n/static/64021f4752eb605ffba48dd4de4d96d9/b12f7/src.png 1020w,\n/static/64021f4752eb605ffba48dd4de4d96d9/b5a09/src.png 1360w,\n/static/64021f4752eb605ffba48dd4de4d96d9/29007/src.png 1600w\" sizes=\"(max-width: 680px) 100vw, 680px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n    </span>\n          </p>\n<p>and <code class=\"language-text\">package.json</code>:</p>\n<p><span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 64.70588235294117%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA+0lEQVR42qWTy27DIBBFh7cHDMFO0rRVd/3/D6wEmg4OlaLGUi26OCukw50LA58X85UWUVBACRqKV8/cciovp1hQ7p8/Asmp4iVQY2Kww4cPiA78CXgjCyZDJ5T0ugDd8p2gjwmehGhExWzJR0PnKOjjCpRxTNYTsjBZipzwfQV6WwTNVuyMfVRoWbjcE8asKAd9uK99oQJOqAlXlnpNlyjpmlqHg8LZyBqMJO/kliw5oMX/R2hVDZyMR6fZKHLcnRUw3iH+jMwPs3J/5xk21gB8wYAwaFm9U4ST2r5L66/RpCNjQ7S6hvaqfUNc35hJDI7chKNf5Ddtu74BJTMTaFDLIf4AAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"json\" title=\"\" src=\"/static/7a6cfbec59bd010a9d6d90ea7dfd716a/c5bb3/json.png\" srcset=\"/static/7a6cfbec59bd010a9d6d90ea7dfd716a/04472/json.png 170w,\n/static/7a6cfbec59bd010a9d6d90ea7dfd716a/9f933/json.png 340w,\n/static/7a6cfbec59bd010a9d6d90ea7dfd716a/c5bb3/json.png 680w,\n/static/7a6cfbec59bd010a9d6d90ea7dfd716a/b12f7/json.png 1020w,\n/static/7a6cfbec59bd010a9d6d90ea7dfd716a/b5a09/json.png 1360w,\n/static/7a6cfbec59bd010a9d6d90ea7dfd716a/29007/json.png 1600w\" sizes=\"(max-width: 680px) 100vw, 680px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n    </span>\n          </p>\n<p>You can package this application with the following Dockerfile:</p>\n<p><span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 49.411764705882355%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAwklEQVR42q2Ryw6CMBBFpw+gtPQBKIK60P//xuY6JdGVRkUXN7OZnMy5Q9dJZ+sJDRGsep5DCpiSRytf79xDJ0n57C3mMb1d/iTkFWVfK5T8BXhg4KwlJuvhlPgdeGHglbuZY0BoqrVLI+ijvp4CF+5wsQbLrsc+dBg7iyl6pLZGV8nvgeUpxz7itB+w8GOCqZBsw9dquC3AwMrRFEC9pim6vygPSuShFaxIiIZYWWxSfQB3WubRiRVUoGU6vQ3otMANwNfVS8KesK4AAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"multi\" title=\"\" src=\"/static/be78467734cef9045d4836b9de29fc74/c5bb3/multi.png\" srcset=\"/static/be78467734cef9045d4836b9de29fc74/04472/multi.png 170w,\n/static/be78467734cef9045d4836b9de29fc74/9f933/multi.png 340w,\n/static/be78467734cef9045d4836b9de29fc74/c5bb3/multi.png 680w,\n/static/be78467734cef9045d4836b9de29fc74/b12f7/multi.png 1020w,\n/static/be78467734cef9045d4836b9de29fc74/b5a09/multi.png 1360w,\n/static/be78467734cef9045d4836b9de29fc74/29007/multi.png 1600w\" sizes=\"(max-width: 680px) 100vw, 680px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n    </span>\n          </p>\n<p>You can build the image with:</p>\n<div class=\"gatsby-highlight\" data-language=\"sh\"><pre class=\"language-sh\"><code class=\"language-sh\"><span class=\"token function\">docker</span> build <span class=\"token parameter variable\">-t</span> node-multi-layers <span class=\"token builtin class-name\">.</span></code></pre></div>\n<p>And you can test that it works correctly with:</p>\n<p><span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 38.82352941176471%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA00lEQVR42pWR24rDMAxE8//fWOgG2sSOr/IteZtaooaFJen24eDIJsOMZlL+hrw3tNZwHIew77vMA54HPNdaT5myfcJZK/zc75jnGeu6IsYI5xxsv1dKYVkWwRhzLVhLRs4FuZQuQkgp9TnLI58M3xGRMN5OBUt0aNGiBo3aT9sdsCtmxPsd/2PkZJ5QywNWr8gUussgcUMIlz+eO8wE52OPk2Tpo5RR0CdHf3dIDokivPcSk4vgb0ZrDepuvxGdqlcI1mDbmE0w7z1K2z36fwW5sBeeomXVpW2KqgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"test\" title=\"\" src=\"/static/a082371fa81660e9a09cae517d1bdd19/c5bb3/test.png\" srcset=\"/static/a082371fa81660e9a09cae517d1bdd19/04472/test.png 170w,\n/static/a082371fa81660e9a09cae517d1bdd19/9f933/test.png 340w,\n/static/a082371fa81660e9a09cae517d1bdd19/c5bb3/test.png 680w,\n/static/a082371fa81660e9a09cae517d1bdd19/b12f7/test.png 1020w,\n/static/a082371fa81660e9a09cae517d1bdd19/b5a09/test.png 1360w,\n/static/a082371fa81660e9a09cae517d1bdd19/29007/test.png 1600w\" sizes=\"(max-width: 680px) 100vw, 680px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n    </span>\n          </p>\n<p>Upon visiting <a href=\"http://localhost:3000\" target=\"_blank\" rel=\"noopener noreferrer\">http://localhost:3000</a>, you will be warmly greeted with the message \"Hello World!\"</p>\n<p>In the Dockerfile, you will notice the presence of both <code class=\"language-text\">COPY</code> and <code class=\"language-text\">RUN</code> statements. As a result, anticipate the addition of at least two additional layers beyond the base image. However, the resulting image will surprisingly contain more new layers, corresponding to each statement in the Dockerfile.</p>\n<p>Let's explore the multi-stage Docker build approach. For this purpose, we will use the same Dockerfile as mentioned earlier, but we will employ it twice:</p>\n<p><span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 69.41176470588235%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAAAsTAAALEwEAmpwYAAABAklEQVR42qWTS27DMAxEfZZY1s+S9bdboPc/VQiWlBMUXZZdDAh78aAZDpevop4mP3B9KFSbwm3bUKl7aq3/rCXU9qznhb13bK1hzBkrzxhF0EUb+7TOorUWnXNoSc77+S17YRsQzw/MpaAn0Lqu0zJLBNxrgzJOvK6LrFbMZLm9LPOLBcAOjYDnGDhIDOGX8jTGSDI0MLOzd468iLdEll3KcFB+OSVMZFdi8xfQeA8hHhhCmOKf0oVMoN0DGLLq9x2P45jLYEnyexW7Q2wdP3vFWioGgiWyLwbGcUIadCWFN3tDuItiyy5EcJ6uI1Bddie+kJ/aaA2zIpumquh/wTimb3GQmWfQjY/0AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"dockerfile\" title=\"\" src=\"/static/bf220f93f039d6b7663a33aa20754deb/c5bb3/dockerfile.png\" srcset=\"/static/bf220f93f039d6b7663a33aa20754deb/04472/dockerfile.png 170w,\n/static/bf220f93f039d6b7663a33aa20754deb/9f933/dockerfile.png 340w,\n/static/bf220f93f039d6b7663a33aa20754deb/c5bb3/dockerfile.png 680w,\n/static/bf220f93f039d6b7663a33aa20754deb/b12f7/dockerfile.png 1020w,\n/static/bf220f93f039d6b7663a33aa20754deb/b5a09/dockerfile.png 1360w,\n/static/bf220f93f039d6b7663a33aa20754deb/29007/dockerfile.png 1600w\" sizes=\"(max-width: 680px) 100vw, 680px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n    </span>\n          </p>\n<p>The first part of the Dockerfile creates three layers. The layers are then merged and copied across to the second and final stage. Two more layers are added on top of the image for a total of 3 layers.</p>\n<p>Feel free to validate the Docker configuration. Begin by building the container using the following steps:</p>\n<div class=\"gatsby-highlight\" data-language=\"sh\"><pre class=\"language-sh\"><code class=\"language-sh\"><span class=\"token function\">docker</span> build <span class=\"token parameter variable\">-t</span> node-stages <span class=\"token builtin class-name\">.</span></code></pre></div>\n<p>And now inspect the history:</p>\n<p><span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 59.411764705882355%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAAsTAAALEwEAmpwYAAABsklEQVR42pWTx3aEMAxFbcDGcsG0GWZSN/n/P+QoTwamZZWFjgXIV08F9TObtcuaSSn21YvV/zflY7NSbJg6w3L6ZIqJHx4Cw25/IC+JVTvaAiwf2oppbplGyxSQRCsmBFH1bAeIrGYHIb55AE7Rr3507LIpwNg7KLTcA3hONU+h5hkJT8VqHqgqFwWcXcVjau5JBBgiFI6bKo+A1DkOwfIA4LU3BfY52WILLju9weTsET8jYavv7VDo3UoTgL0A6w0YN+Cla3iBXaH+DNjbYEqSDyQ/4TkZje+mQA+VG3Cw7NA7TwDm9gZ8A0hUyaXL7kuZUnbX6KJQ2pKap5IBzJYDJhuQMWUpGb6vOaPchPMUHc9IFmBR1stAEeITziGgOrw/pq0igB7A6LY1KQoB7KBwADDjfM/EFxkK2rJ4vIeVGCtDMuwg5KYwpnb1CIyiCmWkXnqI7AKYHC/Z84CejbCvk+HvBYoTpksyZc3v0+bfeogyVg8VEQMpCyxg+IT+bL2ksmsOqkaAll5BoeK5QzVW8TkrHsMjsK5Wr+8bTw+/3rHIYX92+7rQ7ku8rMzhS4W/FO8GL5NQYgIAAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"hist\" title=\"\" src=\"/static/b81fe041163c7836bf0cead639255ad0/c5bb3/history.png\" srcset=\"/static/b81fe041163c7836bf0cead639255ad0/04472/history.png 170w,\n/static/b81fe041163c7836bf0cead639255ad0/9f933/history.png 340w,\n/static/b81fe041163c7836bf0cead639255ad0/c5bb3/history.png 680w,\n/static/b81fe041163c7836bf0cead639255ad0/b12f7/history.png 1020w,\n/static/b81fe041163c7836bf0cead639255ad0/b5a09/history.png 1360w,\n/static/b81fe041163c7836bf0cead639255ad0/29007/history.png 1600w\" sizes=\"(max-width: 680px) 100vw, 680px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n    </span>\n          </p>\n<p>Congratulations! Now let's check if there has been any change in the file size.</p>\n<p><span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 28.82352941176471%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAs0lEQVR42pWQXQ6DIBCEPUlFRBTkTxGtbVp7/0tNEWv6WPrwZZfNZnaYQjqBS6lASI8qoRI1NaCVTvXsf7HvFY1xMPoaWaHkDGtWaLXEhUOYlMeRHMGdovUenfEQPqTqzA0hbPDjAy0fMbg7VD8n4SxB7kbsLpm0oLVODsP0xDK/0MsQ+y3NsgVZa1G3MScWcyo1OB8gxATReTTMJpe8GbK+ve8UlMTHyWdIym92/2TIaos3teKvrtH58O4AAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"size\" title=\"\" src=\"/static/2becbf5ed0a41a160dae3922ba91b188/c5bb3/size.png\" srcset=\"/static/2becbf5ed0a41a160dae3922ba91b188/04472/size.png 170w,\n/static/2becbf5ed0a41a160dae3922ba91b188/9f933/size.png 340w,\n/static/2becbf5ed0a41a160dae3922ba91b188/c5bb3/size.png 680w,\n/static/2becbf5ed0a41a160dae3922ba91b188/b12f7/size.png 1020w,\n/static/2becbf5ed0a41a160dae3922ba91b188/b5a09/size.png 1360w,\n/static/2becbf5ed0a41a160dae3922ba91b188/29007/size.png 1600w\" sizes=\"(max-width: 680px) 100vw, 680px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n    </span>\n          </p>\n<p>Great job on achieving a slightly smaller file size for the last image! Although you've already optimized the application to a certain extent, it seems that the image size can still be further improved. But fret not, there are additional measures you can take to make it even smaller. Let's explore further techniques to further minimize the image size.</p>\n<hr>\n<h3 id=\"streamline-your-container-by-eliminating-unnecessary-components-with-distroless\" style=\"position:relative;\"><a href=\"#streamline-your-container-by-eliminating-unnecessary-components-with-distroless\" aria-label=\"streamline your container by eliminating unnecessary components with distroless permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Streamline Your Container by Eliminating Unnecessary Components with Distroless</h3>\n<p>The current Docker image includes a plethora of binaries and utilities, including Node.js, yarn, npm, bash, and even an entire Ubuntu operating system. However, when running your container, you only require Node.js as the essential dependency.</p>\n<p>Docker containers should encapsulate a single process, containing only the bare minimum required for its execution. The inclusion of a complete operating system is unnecessary.</p>\n<p>Thankfully, Google has recognized this and introduced <a href=\"https://github.com/GoogleContainerTools/distroless\" target=\"_blank\" rel=\"noopener noreferrer\">GoogleCloudPlatform/distroless</a>, a solution that aligns perfectly with your needs. As described in the repository, \"Distroless\" images exclusively consist of your application and its essential runtime dependencies. They omit package managers, shells, and other programs typically found in a standard Linux distribution.</p>\n<p>This precisely matches your requirements! By adjusting the Dockerfile, you can harness the power of this new base image, resulting in the following configuration:</p>\n<p><span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 69.41176470588235%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAAAsTAAALEwEAmpwYAAABGElEQVR42qWUS5KFIAxF3Ui3PwQEI+D/PesNev9bkroNOOqh9CAVi8GpnJuUxUbqaoYe5deAqtKoq9DLuzc1Pa7C8e1a6IS1b5jxBRIrDL3QyyULWrT1eLHWgjGDjll04ZuHzlqTOaHY/SrCZHoH5w7lt0rKVZmpbPnmJ/3CPH0wBtVBb0k9KnfM5GS4+8mccC6UPZM271woi7YZczIk36X8TMrt1tXZmy6oWzzJDVLOGNSWlGONdEDw6TG04I31SsxJU/C7pJig+jW9PQbK1nkWspLCJUiExYqgLOW4FCcO2PEHNMTtztBBPWchCTiLw886At9B9z6TeIs5sFuZOS+4hVIUpjNZt/cH2DTk7x8ChczoX7AY0y8coJef5hI8UAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"distroless\" title=\"\" src=\"/static/c2d84c4285b8f4516b3c951ed8ddfece/c5bb3/distroless.png\" srcset=\"/static/c2d84c4285b8f4516b3c951ed8ddfece/04472/distroless.png 170w,\n/static/c2d84c4285b8f4516b3c951ed8ddfece/9f933/distroless.png 340w,\n/static/c2d84c4285b8f4516b3c951ed8ddfece/c5bb3/distroless.png 680w,\n/static/c2d84c4285b8f4516b3c951ed8ddfece/b12f7/distroless.png 1020w,\n/static/c2d84c4285b8f4516b3c951ed8ddfece/b5a09/distroless.png 1360w,\n/static/c2d84c4285b8f4516b3c951ed8ddfece/29007/distroless.png 1600w\" sizes=\"(max-width: 680px) 100vw, 680px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n    </span>\n          </p>\n<p>And you can compile the image as usual with:</p>\n<div class=\"gatsby-highlight\" data-language=\"sh\"><pre class=\"language-sh\"><code class=\"language-sh\"><span class=\"token function\">docker</span> build <span class=\"token parameter variable\">-t</span> node-distroless <span class=\"token builtin class-name\">.</span></code></pre></div>\n<p>The application should run as normal. To verify that this is still the case, you could run the container like this:</p>\n<div class=\"gatsby-highlight\" data-language=\"sh\"><pre class=\"language-sh\"><code class=\"language-sh\"><span class=\"token function\">docker</span> run <span class=\"token parameter variable\">-p</span> <span class=\"token number\">3000</span>:3000 <span class=\"token parameter variable\">-ti</span> <span class=\"token parameter variable\">--rm</span> <span class=\"token parameter variable\">--init</span> node-distroless</code></pre></div>\n<p>And visit the page at <a href=\"http://localhost:3000\" target=\"_blank\" rel=\"noopener noreferrer\">http://localhost:3000</a>.</p>\n<p>Is the image without all the extra binaries smaller?</p>\n<p><span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 23.52941176470588%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAmElEQVR42o2PWw7CIBBFWUkLVEopMC2Uqo3W/S+K5ErVGOMXHyfzSObkDtNkctPYzNvxj/dO8DFL4aroJGWmaMbkN5C9wNkzyF8/bJhogxkSBHeQwlfB+jnCUIIJCYOJWOKONT0Qw63IllLvsONaLWUnPUEqj04TZOdh9PJKpfuA8gKGMvcq1AslL80PxyFv3Vdw1FrZEeAJ+qSRt9aICuIAAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"smaller\" title=\"\" src=\"/static/0b6cdbff241844b240531065fa1d1911/c5bb3/smaller.png\" srcset=\"/static/0b6cdbff241844b240531065fa1d1911/04472/smaller.png 170w,\n/static/0b6cdbff241844b240531065fa1d1911/9f933/smaller.png 340w,\n/static/0b6cdbff241844b240531065fa1d1911/c5bb3/smaller.png 680w,\n/static/0b6cdbff241844b240531065fa1d1911/b12f7/smaller.png 1020w,\n/static/0b6cdbff241844b240531065fa1d1911/b5a09/smaller.png 1360w,\n/static/0b6cdbff241844b240531065fa1d1911/29007/smaller.png 1600w\" sizes=\"(max-width: 680px) 100vw, 680px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n    </span>\n          </p>\n<p>Impressive! The size of the new image is just 76.7MB, a remarkable reduction of 600MB compared to the previous version.</p>\n<p>This is fantastic news! However, there is an important consideration to keep in mind when working with distroless. If you need to inspect a running container, you can attach to it using the following command:</p>\n<p><span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 18.823529411764707%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAa0lEQVR42o3PSQ6AIAwF0DowqAyioka9/zW/QCRuTGTx0t9Fm5aOvQZnhK4KaoLMqjeLkPvmX5yna52wjhqL7jENEpsz8Fbh9DO8USkfiytaGJERDJo3iQqMaBMrWar66YsXxjOzfPaX0pdvMolVs1gAgtMAAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"exec\" title=\"\" src=\"/static/d1c7fa32ca33d3f1faf7839a0d654797/c5bb3/exec.png\" srcset=\"/static/d1c7fa32ca33d3f1faf7839a0d654797/04472/exec.png 170w,\n/static/d1c7fa32ca33d3f1faf7839a0d654797/9f933/exec.png 340w,\n/static/d1c7fa32ca33d3f1faf7839a0d654797/c5bb3/exec.png 680w,\n/static/d1c7fa32ca33d3f1faf7839a0d654797/b12f7/exec.png 1020w,\n/static/d1c7fa32ca33d3f1faf7839a0d654797/b5a09/exec.png 1360w,\n/static/d1c7fa32ca33d3f1faf7839a0d654797/29007/exec.png 1600w\" sizes=\"(max-width: 680px) 100vw, 680px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n    </span>\n          </p>\n<p>The process of attaching to a running container and running a shell, such as a bash, resembles establishing an SSH session. However, in the case of distroless, being a minimalist version of the original operating system, it lacks additional binaries and utilities, including a shell. As a result, it is not possible to attach to a running container without a shell.</p>\n<p>This limitation has both good and bad implications. On the one hand, it prevents executing any binaries other than Node.js within the container. On the other hand, it reinforces the container's purpose of encapsulating a single process, such as running Node.js applications:</p>\n<p><span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 13.529411764705882%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAYAAACTWi8uAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAYUlEQVR42o2NSw6AIAxEixosFeRnlPufk2QsrlyyeEk7bd5QuU23hros1N0P1ox/s6xzUKsnahBk2VEOxh09Lt1bSajefbcnR+jzFJSFkZzFuW8ISlLxkA/ZyCPbr2hW+AIymUCbG1zyGgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"exec2\" title=\"\" src=\"/static/8b2316630fc11419fa6047c87fbd87b3/c5bb3/exec2.png\" srcset=\"/static/8b2316630fc11419fa6047c87fbd87b3/04472/exec2.png 170w,\n/static/8b2316630fc11419fa6047c87fbd87b3/9f933/exec2.png 340w,\n/static/8b2316630fc11419fa6047c87fbd87b3/c5bb3/exec2.png 680w,\n/static/8b2316630fc11419fa6047c87fbd87b3/b12f7/exec2.png 1020w,\n/static/8b2316630fc11419fa6047c87fbd87b3/b5a09/exec2.png 1360w,\n/static/8b2316630fc11419fa6047c87fbd87b3/29007/exec2.png 1600w\" sizes=\"(max-width: 680px) 100vw, 680px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n    </span>\n          </p>\n<p>Indeed, the absence of a shell in a distroless container can be considered good news from a security perspective. In the event of an attacker compromising your application and gaining access to the container, their ability to cause significant damage is limited without a shell. This reduction in available binaries contributes to smaller image sizes and enhances security. However, it can introduce challenges when it comes to debugging.</p>\n<p>It is important to note that attaching to and debugging containers in a production environment is generally not recommended. Instead, relying on comprehensive logging and monitoring practices is advisable.</p>\n<h3 id=\"-optimize-image-size-with-alpine-choosing-a-compact-base-image\" style=\"position:relative;\"><a href=\"#-optimize-image-size-with-alpine-choosing-a-compact-base-image\" aria-label=\" optimize image size with alpine choosing a compact base image permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üêã Optimize Image Size with Alpine: Choosing a Compact Base Image</h3>\n<p><span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 64.70588235294117%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAAsTAAALEwEAmpwYAAABD0lEQVR42qWT226DMBBEfeFmbIwdExogitT//8JIoOnYqvoe92G1CJmjOctafC/t2wZ59kKcgxKnUb9di3OsKHHw46czeKSIr9uMe9/gMTtEO4Bw8NBHJSyBrtWYugYTYb6R8OyuVR/DCnDX4npJgWUaCWrR85nKpaqAmxLXMQ441oQ1eCze4kH1yHeu0xUJCdzDhG25YUuh6Pqh5Qg0LPU/Bk5U9pyfyzMkJKuaSt0CvDPhajqkyeJmTVGuSfYHDAQmKkbCAsF5duYfKUWgssurYlomHDBnKHttyrI2W6NxxAXr7BGYMHGFbFO5h08lr5dR2GfDPyypTF0t65VTo644KmqKArt7iXxzamB5TD9PvBXXspXekAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"alpine\" title=\"\" src=\"/static/82d3dd3877a217cacabbf7bc7c2ea318/c5bb3/alpine.png\" srcset=\"/static/82d3dd3877a217cacabbf7bc7c2ea318/04472/alpine.png 170w,\n/static/82d3dd3877a217cacabbf7bc7c2ea318/9f933/alpine.png 340w,\n/static/82d3dd3877a217cacabbf7bc7c2ea318/c5bb3/alpine.png 680w,\n/static/82d3dd3877a217cacabbf7bc7c2ea318/b12f7/alpine.png 1020w,\n/static/82d3dd3877a217cacabbf7bc7c2ea318/b5a09/alpine.png 1360w,\n/static/82d3dd3877a217cacabbf7bc7c2ea318/29007/alpine.png 1600w\" sizes=\"(max-width: 680px) 100vw, 680px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n    </span>\n          </p>\n<p>Consider replacing the distroless base image with an Alpine-based image for further size reduction. Alpine Linux is a security-focused, lightweight Linux distribution built upon musl libc and busybox. In essence, it offers a smaller footprint while prioritizing security.</p>\n<p>However, it is prudent not to solely rely on claims. Let's verify whether the Alpine-based image is indeed smaller. To achieve this, modify the Dockerfile and employ the <code class=\"language-text\">node:8-alpine</code> base image:</p>\n<p>You can build the image with:</p>\n<div class=\"gatsby-highlight\" data-language=\"sh\"><pre class=\"language-sh\"><code class=\"language-sh\"><span class=\"token function\">docker</span> build <span class=\"token parameter variable\">-t</span> node-alpine <span class=\"token builtin class-name\">.</span></code></pre></div>\n<p>And you can check the size with:</p>\n<div class=\"gatsby-highlight\" data-language=\"sh\"><pre class=\"language-sh\"><code class=\"language-sh\"><span class=\"token function\">docker</span> images <span class=\"token operator\">|</span> <span class=\"token function\">grep</span> node-alpine</code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"plaintext\"><pre class=\"language-plaintext\"><code class=\"language-plaintext\">node-alpine   aa1f85f8e724   69.7MB</code></pre></div>\n<p>69.7MB! Even smaller than the distroless image!</p>\n<p>Can you attach to a running container, unlike distroless? It's time to find out. Let's start the container first:</p>\n<p><span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 18.823529411764707%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAgElEQVR42n2PWQrDMAwFfY7WNt6EV8X3P91rLEIwheRjeKBlkNSYX3ycgTUWWusba+3NXv/v7RhjoJgzEiWklNB7x5xTMoSAGKNkzhm1Vowx0FqDc+5Rqo6jnUMFpRQRMbMsLclK5iEC773IF08yERJF0HXhumhn1YhIXtl5e/kH/B5vQ08aF0wAAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"run\" title=\"\" src=\"/static/a6b6d88feee8d68f26ef15391da5fee7/c5bb3/run.png\" srcset=\"/static/a6b6d88feee8d68f26ef15391da5fee7/04472/run.png 170w,\n/static/a6b6d88feee8d68f26ef15391da5fee7/9f933/run.png 340w,\n/static/a6b6d88feee8d68f26ef15391da5fee7/c5bb3/run.png 680w,\n/static/a6b6d88feee8d68f26ef15391da5fee7/b12f7/run.png 1020w,\n/static/a6b6d88feee8d68f26ef15391da5fee7/b5a09/run.png 1360w,\n/static/a6b6d88feee8d68f26ef15391da5fee7/29007/run.png 1600w\" sizes=\"(max-width: 680px) 100vw, 680px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n    </span>\n          </p>\n<p>You can attach to the running container with:</p>\n<p><span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 13.529411764705882%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAYAAACTWi8uAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAVUlEQVR42pXMMQ4AIQhEUc+hQOKKmKx4/8uRsEqxvcVrJpOfeGXLgEaIBgBWSvnh3ojoSnpVXES8teZjDFfVMOd0ZvZ9upKYn4jVWiNw4r33cLbb4Ad4ilH7d6ITLQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"exec3\" title=\"\" src=\"/static/11830baec2d062e3922857eb418163db/c5bb3/exec3.png\" srcset=\"/static/11830baec2d062e3922857eb418163db/04472/exec3.png 170w,\n/static/11830baec2d062e3922857eb418163db/9f933/exec3.png 340w,\n/static/11830baec2d062e3922857eb418163db/c5bb3/exec3.png 680w,\n/static/11830baec2d062e3922857eb418163db/b12f7/exec3.png 1020w,\n/static/11830baec2d062e3922857eb418163db/b5a09/exec3.png 1360w,\n/static/11830baec2d062e3922857eb418163db/29007/exec3.png 1600w\" sizes=\"(max-width: 680px) 100vw, 680px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n    </span>\n          </p>\n<p>Absolutely! You can still connect to a running container, and you'll have a more compact image overall.</p>\n<p>However, there's an important consideration to keep in mind. Alpine-based images utilize muslc, an alternative C standard library. On the other hand, widely used Linux distributions like Ubuntu, Debian, and CentOS rely on glibc, which is more prevalent and faster.</p>\n<p>Both libraries aim to implement the same kernel interface but with different objectives. While glibc prioritizes widespread usage and performance, muslc focuses on minimal space consumption and enhanced security. When an application is compiled, it is typically linked to a specific libc. If you want to use it with another libc, recompilation is necessary.</p>\n<p>Consequently, building your containers with Alpine images might introduce unexpected behavior due to the variance in the standard C library. You might encounter discrepancies, especially when dealing with precompiled binaries such as Node.js C++ extensions. For instance, the prebuilt package for PhantomJS doesn't function correctly on Alpine.</p>\n<h3 id=\"-summary\" style=\"position:relative;\"><a href=\"#-summary\" aria-label=\" summary permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üìù Summary</h3>\n<p>‚û°Ô∏è In summary, the choice of base image for Docker containers depends on your priorities.</p>\n<ul>\n<li><strong>Distroless images</strong> prioritize security by reducing the attack surface area and minimizing the number of binaries.</li>\n<li><strong>Alpine-based images</strong> prioritize size optimization but may have compatibility issues due to the different C library.</li>\n<li><strong>Vanilla base images</strong> are suitable for testing and development, providing a familiar environment with access to a wide range of binaries.</li>\n</ul>\n<p>Consider your requirements for security, size, and development environment when selecting the appropriate base image for your Docker containers.</p>\n<h2 id=\"conclusion-\" style=\"position:relative;\"><a href=\"#conclusion-\" aria-label=\"conclusion  permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üåüConclusion üåü</h2>\n<p>Optimizing Docker images is crucial for efficient deployment. Techniques such as layer squashing, using distroless images for enhanced security, and considering Alpine-based images for size reduction provide valuable tools to streamline containerization and improve overall performance.</p>\n<p><strong>Thank You üñ§</strong></p>\n<br>\n<p><strong><em>Until next time, „Å§„Å•„Åè üéâ</em></strong></p>\n<blockquote>\n<p>üí° Thank you for Reading !! üôåüèªüòÅüìÉ, see you in the next blog.ü§ò  <strong><em>Until next time üéâ</em></strong></p>\n</blockquote>\n<p>üöÄ Thank you for sticking up till the end. If you have any questions/feedback regarding this blog feel free to connect with me:</p>\n<p><strong>‚ôªÔ∏è LinkedIn:</strong> <a href=\"https://www.linkedin.com/in/rajhi-saif/\" target=\"_blank\" rel=\"noopener noreferrer\">https://www.linkedin.com/in/rajhi-saif/</a></p>\n<p><strong>‚ôªÔ∏è X/Twitter:</strong> <a href=\"https://x.com/rajhisaifeddine\" target=\"_blank\" rel=\"noopener noreferrer\">https://x.com/rajhisaifeddine</a></p>\n<p><strong>The end ‚úåüèª</strong></p>\n<h1 align=\"center\">üî∞ Keep Learning !! Keep Sharing !! üî∞</h1>\n<p><strong>üìÖ Stay updated</strong></p>\n<p>Subscribe to our newsletter for more insights on AWS cloud computing and containers.</p>","timeToRead":7,"rawMarkdownBody":"\n> **A Toolbox of Simple Tricks for Docker Image Optimization**\n\n## ‚ò∏ Introduction\n\nDocker has revolutionized the way we package and deploy applications, but often, images can become bloated and resource-consuming. Fear not! We have curated a collection of handy tricks that will help you optimize your Docker images without compromising functionality.\n\nWhether you're a seasoned Docker user or just getting started, join us on this journey to discover the secrets of maximizing efficiency and minimizing image size. Get ready to supercharge your Docker workflow with our toolbox of simple but powerful optimization tricks.\n\n![alt text](image.png)\n![alt text](image-1.png)\n\n## üéØ Goals & Objectives\n\nIn this article, we will explore a variety of straightforward techniques that will empower you to create smaller and more efficient Docker images.\n\nLet's dive in! **HAPPY LEARNING üíª**\n\n### Proven Strategies for Minimizing Docker Image Size\n\nBuilding smaller Docker containers should be a top priority in your containerization journey. The significance lies in the fact that smaller images, which leverage shared layers, offer enhanced transfer and deployment speeds. However, managing image size becomes challenging as each `RUN` statement generates a new layer, and intermediate artifacts are often necessary before the image is fully prepared.\n\nIf you've come across various Dockerfiles in the community, you might have observed peculiar techniques like the following:\n\n![latest](./latest.png)\n\nWhat is the reason behind using the `&&` symbol in Dockerfiles instead of running two separate `RUN` statements? How does this peculiar approach simplify the build process and unlock the potential for smaller and more efficient Docker images?\n\n![runs](./runs.png)\n\nWell, the answer is obvious: when a Docker image is built, each `RUN` statement creates a new layer. These layers consume disk space and can make the resulting image larger. However, by chaining commands with `&&`, you can execute them within a single `RUN` statement, thereby reducing the number of layers generated.\n\nUsing separate `RUN` statements instead of `&&` may seem logical, but it comes with a drawback: each `RUN` statement creates an additional layer, potentially leading to larger image sizes. By utilizing `&&`, you optimize the Docker build process, resulting in smaller and more efficient images. In the previous example, two layers were created instead of consolidating them into a single layer.\n\n![layers](./layers.png)\n\nDocker layers function akin to Git commits: capturing the modifications between the previous and current image versions. These layers prove beneficial when sharing with other repositories or images, mirroring Git commits' usefulness in sharing code. When fetching an image from a registry, solely the layers absent in your possession are downloaded. This method vastly improves the efficiency of image sharing.\n\nNevertheless, layers come at a cost üòø. Layers occupy storage space, and the final image grows heavier with each additional layer. Git repositories exhibit a similar behavior‚Ää‚Äî‚Äärepository size increases in proportion to the number of layers, as Git must retain all changes between commits.\n\nIn the past, it was recommended to consolidate multiple `RUN` statements into a single line, resembling the initial example. However, this practice is no longer advisable. üëå\n\n### Condense Multiple Layers into One Using Multi-Stage Docker Builds\n\nJust as you can opt to merge the history of a Git repository into a single commit to simplify it, a similar approach can be applied in Docker through multi-stage builds. In the following scenario, we'll construct a Node.js container. To begin, let's consider an `index.js` file:\n\n![src](./src.png)\n\nand `package.json`:\n\n![json](./json.png)\n\nYou can package this application with the following Dockerfile:\n\n![multi](./multi.png)\n\nYou can build the image with:\n\n```sh\ndocker build -t node-multi-layers .\n```\n\nAnd you can test that it works correctly with:\n\n![test](./test.png)\n\nUpon visiting [http://localhost:3000](http://localhost:3000), you will be warmly greeted with the message \"Hello World!\"\n\nIn the Dockerfile, you will notice the presence of both `COPY` and `RUN` statements. As a result, anticipate the addition of at least two additional layers beyond the base image. However, the resulting image will surprisingly contain more new layers, corresponding to each statement in the Dockerfile.\n\nLet's explore the multi-stage Docker build approach. For this purpose, we will use the same Dockerfile as mentioned earlier, but we will employ it twice:\n\n![dockerfile](./dockerfile.png)\n\nThe first part of the Dockerfile creates three layers. The layers are then merged and copied across to the second and final stage. Two more layers are added on top of the image for a total of 3 layers.\n\nFeel free to validate the Docker configuration. Begin by building the container using the following steps:\n\n```sh\ndocker build -t node-stages .\n```\n\nAnd now inspect the history:\n\n![hist](./history.png)\n\nCongratulations! Now let's check if there has been any change in the file size.\n\n![size](./size.png)\n\nGreat job on achieving a slightly smaller file size for the last image! Although you've already optimized the application to a certain extent, it seems that the image size can still be further improved. But fret not, there are additional measures you can take to make it even smaller. Let's explore further techniques to further minimize the image size.\n\n---\n\n### Streamline Your Container by Eliminating Unnecessary Components with Distroless\n\nThe current Docker image includes a plethora of binaries and utilities, including Node.js, yarn, npm, bash, and even an entire Ubuntu operating system. However, when running your container, you only require Node.js as the essential dependency.\n\nDocker containers should encapsulate a single process, containing only the bare minimum required for its execution. The inclusion of a complete operating system is unnecessary.\n\nThankfully, Google has recognized this and introduced [GoogleCloudPlatform/distroless](https://github.com/GoogleContainerTools/distroless), a solution that aligns perfectly with your needs. As described in the repository, \"Distroless\" images exclusively consist of your application and its essential runtime dependencies. They omit package managers, shells, and other programs typically found in a standard Linux distribution.\n\nThis precisely matches your requirements! By adjusting the Dockerfile, you can harness the power of this new base image, resulting in the following configuration:\n\n![distroless](./distroless.png)\n\nAnd you can compile the image as usual with:\n\n```sh\ndocker build -t node-distroless .\n```\n\nThe application should run as normal. To verify that this is still the case, you could run the container like this:\n\n```sh\ndocker run -p 3000:3000 -ti --rm --init node-distroless\n```\n\nAnd visit the page at [http://localhost:3000](http://localhost:3000).\n\nIs the image without all the extra binaries smaller?\n\n![smaller](./smaller.png)\n\nImpressive! The size of the new image is just 76.7MB, a remarkable reduction of 600MB compared to the previous version.\n\nThis is fantastic news! However, there is an important consideration to keep in mind when working with distroless. If you need to inspect a running container, you can attach to it using the following command:\n\n![exec](./exec.png)\n\nThe process of attaching to a running container and running a shell, such as a bash, resembles establishing an SSH session. However, in the case of distroless, being a minimalist version of the original operating system, it lacks additional binaries and utilities, including a shell. As a result, it is not possible to attach to a running container without a shell.\n\nThis limitation has both good and bad implications. On the one hand, it prevents executing any binaries other than Node.js within the container. On the other hand, it reinforces the container's purpose of encapsulating a single process, such as running Node.js applications:\n\n![exec2](./exec2.png)\n\nIndeed, the absence of a shell in a distroless container can be considered good news from a security perspective. In the event of an attacker compromising your application and gaining access to the container, their ability to cause significant damage is limited without a shell. This reduction in available binaries contributes to smaller image sizes and enhances security. However, it can introduce challenges when it comes to debugging.\n\nIt is important to note that attaching to and debugging containers in a production environment is generally not recommended. Instead, relying on comprehensive logging and monitoring practices is advisable.\n\n### üêã Optimize Image Size with Alpine: Choosing a Compact Base Image\n\n![alpine](./alpine.png)\n\nConsider replacing the distroless base image with an Alpine-based image for further size reduction. Alpine Linux is a security-focused, lightweight Linux distribution built upon musl libc and busybox. In essence, it offers a smaller footprint while prioritizing security.\n\nHowever, it is prudent not to solely rely on claims. Let's verify whether the Alpine-based image is indeed smaller. To achieve this, modify the Dockerfile and employ the `node:8-alpine` base image:\n\nYou can build the image with:\n\n```sh\ndocker build -t node-alpine .\n```\n\nAnd you can check the size with:\n\n```sh\ndocker images | grep node-alpine\n```\n\n```plaintext\nnode-alpine   aa1f85f8e724   69.7MB\n```\n\n69.7MB! Even smaller than the distroless image!\n\nCan you attach to a running container, unlike distroless? It's time to find out. Let's start the container first:\n\n![run](./run.png)\n\nYou can attach to the running container with:\n\n![exec3](./exec3.png)\n\nAbsolutely! You can still connect to a running container, and you'll have a more compact image overall.\n\nHowever, there's an important consideration to keep in mind. Alpine-based images utilize muslc, an alternative C standard library. On the other hand, widely used Linux distributions like Ubuntu, Debian, and CentOS rely on glibc, which is more prevalent and faster.\n\nBoth libraries aim to implement the same kernel interface but with different objectives. While glibc prioritizes widespread usage and performance, muslc focuses on minimal space consumption and enhanced security. When an application is compiled, it is typically linked to a specific libc. If you want to use it with another libc, recompilation is necessary.\n\nConsequently, building your containers with Alpine images might introduce unexpected behavior due to the variance in the standard C library. You might encounter discrepancies, especially when dealing with precompiled binaries such as Node.js C++ extensions. For instance, the prebuilt package for PhantomJS doesn't function correctly on Alpine.\n\n### üìù Summary\n\n‚û°Ô∏è In summary, the choice of base image for Docker containers depends on your priorities.\n\n- **Distroless images** prioritize security by reducing the attack surface area and minimizing the number of binaries.\n- **Alpine-based images** prioritize size optimization but may have compatibility issues due to the different C library.\n- **Vanilla base images** are suitable for testing and development, providing a familiar environment with access to a wide range of binaries.\n\nConsider your requirements for security, size, and development environment when selecting the appropriate base image for your Docker containers.\n\n## üåüConclusion üåü\n\nOptimizing Docker images is crucial for efficient deployment. Techniques such as layer squashing, using distroless images for enhanced security, and considering Alpine-based images for size reduction provide valuable tools to streamline containerization and improve overall performance.\n\n**Thank You üñ§**\n\n<br>\n\n**_Until next time, „Å§„Å•„Åè üéâ_**\n\n> üí° Thank you for Reading !! üôåüèªüòÅüìÉ, see you in the next blog.ü§ò  **_Until next time üéâ_**\n\nüöÄ Thank you for sticking up till the end. If you have any questions/feedback regarding this blog feel free to connect with me:\n\n**‚ôªÔ∏è LinkedIn:** https://www.linkedin.com/in/rajhi-saif/\n\n**‚ôªÔ∏è X/Twitter:** https://x.com/rajhisaifeddine\n\n**The end ‚úåüèª**\n\n<h1 align=\"center\">üî∞ Keep Learning !! Keep Sharing !! üî∞</h1>\n\n**üìÖ Stay updated**\n\nSubscribe to our newsletter for more insights on AWS cloud computing and containers.\n","wordCount":{"words":1715},"frontmatter":{"id":"822433fef2cdef0d610bdabf","path":"/blog/docker-image-optimization/","humanDate":"Oct 29, 2024","fullDate":"2024-10-29","title":"Docker Image Optimization: A Toolbox of efficient Tricks","keywords":["Docker","image optimization","k8s","SRE","DevOps"],"excerpt":"Discover simple yet effective tricks to optimize your Docker images, reducing size and improving performance for your containerized applications.","cover":{"childImageSharp":{"gatsbyImageData":{"layout":"fullWidth","placeholder":{"fallback":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAABYlAAAWJQFJUiTwAAACc0lEQVR42m2RSWtUURCF81P8A/4AA4I7VxGCC5fixkVWIjigEFRciKAbIS7E4EKzkaiJRDBjmx6SzuBL0vPw+vWQl/fufUMnnaFxET+rh5CNi8OtOrfqUKdqwFUK7Sv8UOF1EPQhse6/fnjOndV0es44v9mrVVoz4AWaallTSClKWYVZUJRzvbdSFC6jKKaFy/fiDqxS77/bI3nO6NV2BYPQw8x6JGcVyTmFsazZimsinzWJGUXsuyI6rVmb09038UOxPq/IbCi2VxWr0tep24z0BbX2xJJHcCCj73fG1xy2fSrZJsZSyMZsk1Rc4kiTwlbITixkc8nnIAjhtMXf0yMOj32x7p4JarTn4boKx3FxlUYJTNPqoWJRKJiUihUqZpVyySKQvceMCqPvo7z68BOzahMEAY7wA74EWzsp1jY2RUh14TgOv5aXWUtEMVajrMcWiccizM4vsL6yzMfFMhduTjL8eIqL159y8doD0tk8YRiKoO8TTax0YVWrpDPZ7oStZshCqsHYQpl3kQrbpiNcgO16XH6S482MRd4OqPtHXBoa4fa9l7Tbx2JZ7HZseyJcbzTI5fNUazXsRo3JtTp3JwxGxleIbFv8ORQ3cuHB5zZG7YSHE0m+rps8evaaK0O3OD4+Ohd03M7+5CiyAk/yasPGqtdoenu0/Qa7tuSN3e46ht/uMx7RpItFNrJlBq/e4P7oC5nwpC/YOYqIncGXPJ0vcmfsE9+W4tSNKBOzUSYjSVy7JlNqjJzFl+kp4skkxk6GQskkCIP/C3qSm9Uav1NpCuVK9/rZUpmiXH1vz0G7Ngf7oawpYE/+Wq1WX0PzD5nWBLxRpg+hAAAAAElFTkSuQmCC"},"images":{"fallback":{"src":"/static/c97da10d99b01b00879bae63901163ac/f610b/image-1.png","srcSet":"/static/c97da10d99b01b00879bae63901163ac/ba276/image-1.png 750w,\n/static/c97da10d99b01b00879bae63901163ac/87bd8/image-1.png 1080w,\n/static/c97da10d99b01b00879bae63901163ac/dc894/image-1.png 1366w,\n/static/c97da10d99b01b00879bae63901163ac/f610b/image-1.png 1920w","sizes":"100vw"},"sources":[{"srcSet":"/static/c97da10d99b01b00879bae63901163ac/5436b/image-1.webp 750w,\n/static/c97da10d99b01b00879bae63901163ac/e1011/image-1.webp 1080w,\n/static/c97da10d99b01b00879bae63901163ac/906fd/image-1.webp 1366w,\n/static/c97da10d99b01b00879bae63901163ac/b97d3/image-1.webp 1920w","type":"image/webp","sizes":"100vw"}]},"width":1,"height":0.553125}}},"coverCredits":"Photo by Saifeddine Rajhi"}}},"pageContext":{"prevThought":{"frontmatter":{"path":"/blog/prometheus-manage-memory-overload/","title":"Prometheus Restart Troubles: Managing Memory Overload üß†","date":"2024-10-29 19:00:00"},"excerpt":"When Prometheus Can't Keep Up with the WAL üìà üìó Introduction Have you ever had Prometheus crash due to an out-of-memory error while trying‚Ä¶"},"nextThought":{"frontmatter":{"path":"/blog/flagger-progressive-delivery-kubernetes/","title":"Flagger: Progressive Delivery for Kubernetes with GitOps, FluxCD, and Istio üöÄ","date":"2024-10-29 18:06:00"},"excerpt":"Key to Safer Application Releases üöÄ üåï Introduction If you are looking for a way to make the release process for your applications running‚Ä¶"}}},"staticQueryHashes":["1271460761","1321585977"],"slicesMap":{}}