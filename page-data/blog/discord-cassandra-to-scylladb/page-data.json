{"componentChunkName":"component---src-templates-blog-template-js","path":"/blog/discord-cassandra-to-scylladb/","result":{"data":{"markdownRemark":{"html":"<blockquote>\n<p><strong>An Epic Journey from Cassandra to ScyllaDB with Rusty Reinforcements üöÄ</strong></p>\n</blockquote>\n<h2 id=\"-overview\" style=\"position:relative;\"><a href=\"#-overview\" aria-label=\" overview permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üî∞ Overview</h2>\n<p>In the world of messaging platforms, <a href=\"https://discord.com/\" target=\"_blank\" rel=\"noopener noreferrer\">Discord</a> stands as a leader, connecting millions of users worldwide.</p>\n<p>However, as the user base expanded, Discord encountered a daunting challenge: handling trillions of messages efficiently ü§î.</p>\n<p>The existing database system, Cassandra, struggled with hot partitions, causing slowdowns and hindering performance.</p>\n<p>Discord's solution? Starting on a transformative journey, migrating to <a href=\"https://www.scylladb.com/\" target=\"_blank\" rel=\"noopener noreferrer\">ScyllaDB</a>, and leveraging the power of Rust.</p>\n<h2 id=\"-goals--objectives\" style=\"position:relative;\"><a href=\"#-goals--objectives\" aria-label=\" goals  objectives permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üéØ Goals &#x26; Objectives</h2>\n<p>This blog dives into Discord's pursuit of scalability, exploring the situation, the complications faced, and the resolute path taken to revolutionize message storage at an unprecedented scale, inspired by <a href=\"https://discord.com/blog/how-discord-stores-trillions-of-messages\" target=\"_blank\" rel=\"noopener noreferrer\">Bo Ingram's post</a>.</p>\n<h2 id=\"-from-mongodb-to-scylladb-discords-evolutionary-messaging-storage\" style=\"position:relative;\"><a href=\"#-from-mongodb-to-scylladb-discords-evolutionary-messaging-storage\" aria-label=\" from mongodb to scylladb discords evolutionary messaging storage permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üìà From MongoDB to ScyllaDB: Discord's Evolutionary Messaging Storage</h2>\n<p>The diagram below shows the evolution of message storage at Discord:</p>\n<p><strong>MongoDB ‚û°Ô∏è Cassandra ‚û°Ô∏è ScyllaDB üéâ</strong></p>\n<p>In the early days of Discord's inception in 2015, the platform relied on a single MongoDB replica for message storage. However, as the number of messages grew to 100 million by November 2015, the limitations of MongoDB became apparent. The data and index became too large for the available RAM, resulting in unpredictable latency. It became necessary to migrate message storage to a more suitable database solution, and Cassandra was selected.</p>\n<p>By 2017, Discord had transitioned to Cassandra, employing a cluster of 12 nodes to store billions of messages. As the platform continued to experience exponential growth, by the start of 2022, Discord's message count had skyrocketed into the trillions, necessitating a substantial increase in infrastructure. With 177 nodes at this stage, latency became increasingly unpredictable, and the cost of maintenance operations became prohibitively expensive.</p>\n<p><span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 540px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 149.41176470588235%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAeABQDASIAAhEBAxEB/8QAGgAAAgIDAAAAAAAAAAAAAAAAAAUBAwIEBv/EABUBAQEAAAAAAAAAAAAAAAAAAAAB/9oADAMBAAIQAxAAAAFpCSU6UWCr6GNRuGBH/8QAGRAAAwEBAQAAAAAAAAAAAAAAAQIDEhEA/9oACAEBAAEFAg2jsaHqNxw3pV6tJkEa7KJUWkxNZPQxm6r/AP/EABQRAQAAAAAAAAAAAAAAAAAAACD/2gAIAQMBAT8BH//EABQRAQAAAAAAAAAAAAAAAAAAACD/2gAIAQIBAT8BH//EAB4QAAMAAQUBAQAAAAAAAAAAAAABEQISITFhgRCh/9oACAEBAAY/AsknwS7/ADN65Wcnp224aaPtm0LMV6R5fp//xAAdEAACAgIDAQAAAAAAAAAAAAABEQAhMWFBUZHB/9oACAEBAAE/IQPImjqJfsDiAVBhCZw7hkDf2Orwk422tuAYpurx7KdCYLjeVCSL3MjHIBH5DFi+0//aAAwDAQACAAMAAAAQPA0+/8QAGBEAAwEBAAAAAAAAAAAAAAAAAAERECH/2gAIAQMBAT8Q7lqKz//EABURAQEAAAAAAAAAAAAAAAAAABAx/9oACAECAQE/ECH/xAAfEAEAAwACAgMBAAAAAAAAAAABABEhMVFBYXGBsdH/2gAIAQEAAT8QYjUopbqLV84LOfcOmo7rcWBCzwO8dQund00fKS/2ehxhFSnsqHf3GejYqoN5+oNbGouIfyU814sq7HiOwNXYD5YHguNJRQdep//Z'); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"Cassandra\" title=\"\" src=\"/static/3540d420b1cfa09df19596f9e600e3c7/09d21/cassandra.jpg\" srcset=\"/static/3540d420b1cfa09df19596f9e600e3c7/651be/cassandra.jpg 170w,\n/static/3540d420b1cfa09df19596f9e600e3c7/d30a3/cassandra.jpg 340w,\n/static/3540d420b1cfa09df19596f9e600e3c7/09d21/cassandra.jpg 540w\" sizes=\"(max-width: 540px) 100vw, 540px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n    </span>\n          </p>\n<p><strong>Cassandra</strong> is a distributed database system designed for scalability and fault-tolerance, capable of handling massive amounts of data across multiple servers or nodes.</p>\n<h3 id=\"discords-issue-with-cassandra\" style=\"position:relative;\"><a href=\"#discords-issue-with-cassandra\" aria-label=\"discords issue with cassandra permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Discord's Issue with Cassandra</h3>\n<p>Discord faced problems with hot partitions in Cassandra, where a particular part of the database became overloaded with requests, causing slow performance for the entire application.</p>\n<p>The issue at hand can be attributed to several factors:</p>\n<ul>\n<li>Cassandra's internal data structure utilizes the LSM tree, which makes reads more expensive than writes. Concurrent reads from numerous users on a single server can lead to hotspots and performance degradation.</li>\n<li>Maintenance tasks, such as SSTable compaction, have an impact on overall performance, adding to the challenges faced.</li>\n<li>Latency spikes can be attributed to garbage collection pauses, further exacerbating the problem.</li>\n</ul>\n<p>In response, Discord undertook a redesign of its architecture, incorporating various components. This included a monolithic API, a data service implemented in Rust, and a storage system based on ScyllaDB, a Cassandra-compatible database developed in C++.</p>\n<p><span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 66.47058823529413%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAANABQDASIAAhEBAxEB/8QAGQAAAgMBAAAAAAAAAAAAAAAAAAMBAgQF/8QAFgEBAQEAAAAAAAAAAAAAAAAAAwEC/9oADAMBAAIQAxAAAAHTKaZRZ1Cn/8QAHBABAQABBQEAAAAAAAAAAAAAAgMBAAQREyIj/9oACAEBAAEFAu3I01zRTazuPFEvpOYc/wD/xAAXEQEBAQEAAAAAAAAAAAAAAAABABEC/9oACAEDAQE/AXnAbb//xAAVEQEBAAAAAAAAAAAAAAAAAAAAEf/aAAgBAgEBPwFH/8QAGhAAAgIDAAAAAAAAAAAAAAAAAAERIQIxcf/aAAgBAQAGPwLRckrEo4JtH//EABwQAQEAAgIDAAAAAAAAAAAAAAERACExQVFxof/aAAgBAQABPyECXYvXWNsCbCZPl94KHDxlFSwHzN61M//aAAwDAQACAAMAAAAQDN//xAAVEQEBAAAAAAAAAAAAAAAAAAAQYf/aAAgBAwEBPxCyj//EABcRAAMBAAAAAAAAAAAAAAAAAAABESH/2gAIAQIBAT8QSpg//8QAGxABAAIDAQEAAAAAAAAAAAAAAREhADFxQVH/2gAIAQEAAT8QJ2tn0ElruU7nEsEOu5erlsW+zzJwSiReYgpl87CRgjNi59z/2Q=='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"choice\" title=\"\" src=\"/static/43c045713dbd2c06cf74a0f78c1a4db5/7bf67/choice.jpg\" srcset=\"/static/43c045713dbd2c06cf74a0f78c1a4db5/651be/choice.jpg 170w,\n/static/43c045713dbd2c06cf74a0f78c1a4db5/d30a3/choice.jpg 340w,\n/static/43c045713dbd2c06cf74a0f78c1a4db5/7bf67/choice.jpg 680w,\n/static/43c045713dbd2c06cf74a0f78c1a4db5/990cb/choice.jpg 1020w,\n/static/43c045713dbd2c06cf74a0f78c1a4db5/72e01/choice.jpg 1024w\" sizes=\"(max-width: 680px) 100vw, 680px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n    </span>\n          </p>\n<p><strong>ScyllaDB</strong>: ScyllaDB is a high-performance distributed NoSQL database similar to Cassandra. It uses a shared-nothing architecture and offers more efficient storage and query capabilities, reducing the occurrence of hot partitions.</p>\n<p>The adoption of ScyllaDB brought significant improvements. The p99 (99th percentile) read latency in ScyllaDB reduced to 15ms, compared to 40‚Äì125ms in Cassandra. Likewise, the p99 write latency decreased to 5ms, compared to 5‚Äì70ms in Cassandra. These enhancements in latency highlight the positive impact of transitioning to ScyllaDB.</p>\n<p><span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 100.58823529411765%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAUABQDASIAAhEBAxEB/8QAGQABAAMBAQAAAAAAAAAAAAAAAAECBQME/8QAGAEAAgMAAAAAAAAAAAAAAAAAAQIAAwT/2gAMAwEAAhADEAAAAfTOdUXajJK8dBNNRD//xAAZEAEBAAMBAAAAAAAAAAAAAAACAQAQESH/2gAIAQEAAQUCQVqCuSeC9PNTf//EABsRAAIBBQAAAAAAAAAAAAAAAAABAgMQERNh/9oACAEDAQE/AaUMs0dFb//EABgRAAIDAAAAAAAAAAAAAAAAAAACEBIh/9oACAECAQE/AWbC0//EABoQAAICAwAAAAAAAAAAAAAAAAABESECICL/2gAIAQEABj8CrKBdFkNbf//EABsQAQADAAMBAAAAAAAAAAAAAAEAETEgIVFx/9oACAEBAAE/IbnQ+wimCt2OAVvtwtgyp1E4f//aAAwDAQACAAMAAAAQU/D+/8QAGREBAAIDAAAAAAAAAAAAAAAAAQAREDGh/9oACAEDAQE/EFVGkjZt4mmP/8QAGREBAAIDAAAAAAAAAAAAAAAAAQAQETFh/9oACAECAQE/EMgHUOI1/8QAHhABAAIBBAMAAAAAAAAAAAAAAQARMSFRYZFBgfD/2gAIAQEAAT8QxzIUEJoHt6hq3YLAsoayhFBG+PjuJHIHO8Aapnhyy2+5n1P/2Q=='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"rust\" title=\"\" src=\"/static/3f27468168e1aa6c78f60874d03c3dc1/7bf67/rust.jpg\" srcset=\"/static/3f27468168e1aa6c78f60874d03c3dc1/651be/rust.jpg 170w,\n/static/3f27468168e1aa6c78f60874d03c3dc1/d30a3/rust.jpg 340w,\n/static/3f27468168e1aa6c78f60874d03c3dc1/7bf67/rust.jpg 680w,\n/static/3f27468168e1aa6c78f60874d03c3dc1/4b190/rust.jpg 800w\" sizes=\"(max-width: 680px) 100vw, 680px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n    </span>\n          </p>\n<p>Discord engineers wrote data services in Rust, using its fearless concurrency feature to control concurrent traffic to hot partitions. Rust's libraries and ability to write safe concurrent code were well-suited to Discord's needs. The data services acted as intermediary services between the API monolith and database clusters, providing request coalescing to minimize multiple queries to the database.</p>\n<h2 id=\"-how-discord-stores-trillions-of-messages\" style=\"position:relative;\"><a href=\"#-how-discord-stores-trillions-of-messages\" aria-label=\" how discord stores trillions of messages permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üîπ How Discord Stores Trillions Of Messages</h2>\n<p>Overall, Discord's migration to ScyllaDB and the use of Rust for controlling concurrent traffic were key steps in addressing the challenges they faced with storing trillions of messages and improving database performance.</p>\n<p><span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 84.70588235294117%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAARABQDASIAAhEBAxEB/8QAGAABAQEBAQAAAAAAAAAAAAAAAAECAwX/xAAUAQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIQAxAAAAH27cG0HTIAf//EABkQAAIDAQAAAAAAAAAAAAAAAAARAhAgMf/aAAgBAQABBQJHKRLP/8QAFBEBAAAAAAAAAAAAAAAAAAAAIP/aAAgBAwEBPwEf/8QAFBEBAAAAAAAAAAAAAAAAAAAAIP/aAAgBAgEBPwEf/8QAFBABAAAAAAAAAAAAAAAAAAAAMP/aAAgBAQAGPwIf/8QAHBAAAgICAwAAAAAAAAAAAAAAAAERITFRIEHh/9oACAEBAAE/IavweiyXpERJd9Cxw//aAAwDAQACAAMAAAAQ4McA/8QAFBEBAAAAAAAAAAAAAAAAAAAAIP/aAAgBAwEBPxAf/8QAFBEBAAAAAAAAAAAAAAAAAAAAIP/aAAgBAgEBPxAf/8QAHBABAQACAwEBAAAAAAAAAAAAAREAIRAxQVHB/9oACAEBAAE/EGD2vxkgO5uFwj8HFtlEaNcD4tunLiy+64e+P//Z'); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"performance\" title=\"\" src=\"/static/ff17549fcaeb944e26e28d5dc14d5583/7bf67/performance.jpg\" srcset=\"/static/ff17549fcaeb944e26e28d5dc14d5583/651be/performance.jpg 170w,\n/static/ff17549fcaeb944e26e28d5dc14d5583/d30a3/performance.jpg 340w,\n/static/ff17549fcaeb944e26e28d5dc14d5583/7bf67/performance.jpg 680w,\n/static/ff17549fcaeb944e26e28d5dc14d5583/4b190/performance.jpg 800w\" sizes=\"(max-width: 680px) 100vw, 680px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n    </span>\n          </p>\n<div class=\"image-title\">Image creds: ByteByteGo</div>\n<h2 id=\"-references\" style=\"position:relative;\"><a href=\"#-references\" aria-label=\" references permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üìö References</h2>\n<ul>\n<li><a href=\"https://discord.com/blog\" target=\"_blank\" rel=\"noopener noreferrer\">Discord Blog</a></li>\n<li><a href=\"https://www.youtube.com/watch?v=some-video\" target=\"_blank\" rel=\"noopener noreferrer\">Cassandra Video</a></li>\n<li><a href=\"https://www.youtube.com/channel/UCsome-channel\" target=\"_blank\" rel=\"noopener noreferrer\">ScyllaDB YouTube Channel</a></li>\n<li><a href=\"https://bytebytego.com/\" target=\"_blank\" rel=\"noopener noreferrer\">ByteByteGo</a></li>\n</ul>\n<h2 id=\"-wrapping-up\" style=\"position:relative;\"><a href=\"#-wrapping-up\" aria-label=\" wrapping up permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üëè Wrapping Up</h2>\n<p>Discord embarked on an extraordinary journey, transitioning from Cassandra to ScyllaDB, and leveraging the power of Rust to scale trillions of messages. This migration showcases the effectiveness of Rust in developing resilient solutions üóí</p>\n<br>\n<p><strong><em>Until next time, „Å§„Å•„Åè üéâ</em></strong></p>\n<blockquote>\n<p>üí° Thank you for Reading !! üôåüèªüòÅüìÉ, see you in the next blog.ü§ò  <em><strong>Until next time üéâ</strong></em></p>\n</blockquote>\n<p>üöÄ Thank you for sticking up till the end. If you have any questions/feedback regarding this blog feel free to connect with me:</p>\n<p><strong>‚ôªÔ∏è LinkedIn:</strong> <a href=\"https://www.linkedin.com/in/rajhi-saif/\" target=\"_blank\" rel=\"noopener noreferrer\">https://www.linkedin.com/in/rajhi-saif/</a></p>\n<p><strong>‚ôªÔ∏è X/Twitter:</strong> <a href=\"https://x.com/rajhisaifeddine\" target=\"_blank\" rel=\"noopener noreferrer\">https://x.com/rajhisaifeddine</a></p>\n<p><strong>The end ‚úåüèª</strong></p>\n<h1 align=\"center\">üî∞ Keep Learning !! Keep Sharing !! üî∞</h1>\n<p><strong>üìÖ Stay updated</strong></p>\n<p>Subscribe to our newsletter for more insights on AWS cloud computing and containers.</p>","timeToRead":3,"rawMarkdownBody":"\n> **An Epic Journey from Cassandra to ScyllaDB with Rusty Reinforcements üöÄ**\n\n## üî∞ Overview\n\nIn the world of messaging platforms, [Discord](https://discord.com/) stands as a leader, connecting millions of users worldwide.\n\nHowever, as the user base expanded, Discord encountered a daunting challenge: handling trillions of messages efficiently ü§î.\n\nThe existing database system, Cassandra, struggled with hot partitions, causing slowdowns and hindering performance.\n\nDiscord's solution? Starting on a transformative journey, migrating to [ScyllaDB](https://www.scylladb.com/), and leveraging the power of Rust.\n\n## üéØ Goals & Objectives\n\nThis blog dives into Discord's pursuit of scalability, exploring the situation, the complications faced, and the resolute path taken to revolutionize message storage at an unprecedented scale, inspired by [Bo Ingram's post](https://discord.com/blog/how-discord-stores-trillions-of-messages).\n\n## üìà From MongoDB to ScyllaDB: Discord's Evolutionary Messaging Storage\n\nThe diagram below shows the evolution of message storage at Discord:\n\n**MongoDB ‚û°Ô∏è Cassandra ‚û°Ô∏è ScyllaDB üéâ**\n\nIn the early days of Discord's inception in 2015, the platform relied on a single MongoDB replica for message storage. However, as the number of messages grew to 100 million by November 2015, the limitations of MongoDB became apparent. The data and index became too large for the available RAM, resulting in unpredictable latency. It became necessary to migrate message storage to a more suitable database solution, and Cassandra was selected.\n\nBy 2017, Discord had transitioned to Cassandra, employing a cluster of 12 nodes to store billions of messages. As the platform continued to experience exponential growth, by the start of 2022, Discord's message count had skyrocketed into the trillions, necessitating a substantial increase in infrastructure. With 177 nodes at this stage, latency became increasingly unpredictable, and the cost of maintenance operations became prohibitively expensive.\n\n![Cassandra](./cassandra.jpg)\n\n**Cassandra** is a distributed database system designed for scalability and fault-tolerance, capable of handling massive amounts of data across multiple servers or nodes.\n\n### Discord's Issue with Cassandra\n\nDiscord faced problems with hot partitions in Cassandra, where a particular part of the database became overloaded with requests, causing slow performance for the entire application.\n\nThe issue at hand can be attributed to several factors:\n\n- Cassandra's internal data structure utilizes the LSM tree, which makes reads more expensive than writes. Concurrent reads from numerous users on a single server can lead to hotspots and performance degradation.\n- Maintenance tasks, such as SSTable compaction, have an impact on overall performance, adding to the challenges faced.\n- Latency spikes can be attributed to garbage collection pauses, further exacerbating the problem.\n\nIn response, Discord undertook a redesign of its architecture, incorporating various components. This included a monolithic API, a data service implemented in Rust, and a storage system based on ScyllaDB, a Cassandra-compatible database developed in C++.\n\n![choice](./choice.jpg)\n\n**ScyllaDB**: ScyllaDB is a high-performance distributed NoSQL database similar to Cassandra. It uses a shared-nothing architecture and offers more efficient storage and query capabilities, reducing the occurrence of hot partitions.\n\nThe adoption of ScyllaDB brought significant improvements. The p99 (99th percentile) read latency in ScyllaDB reduced to 15ms, compared to 40‚Äì125ms in Cassandra. Likewise, the p99 write latency decreased to 5ms, compared to 5‚Äì70ms in Cassandra. These enhancements in latency highlight the positive impact of transitioning to ScyllaDB.\n\n![rust](./rust.jpg)\n\nDiscord engineers wrote data services in Rust, using its fearless concurrency feature to control concurrent traffic to hot partitions. Rust's libraries and ability to write safe concurrent code were well-suited to Discord's needs. The data services acted as intermediary services between the API monolith and database clusters, providing request coalescing to minimize multiple queries to the database.\n\n## üîπ How Discord Stores Trillions Of Messages\n\nOverall, Discord's migration to ScyllaDB and the use of Rust for controlling concurrent traffic were key steps in addressing the challenges they faced with storing trillions of messages and improving database performance.\n\n![performance](./performance.jpg)\n<div class=\"image-title\">Image creds: ByteByteGo</div>\n\n## üìö References\n\n- [Discord Blog](https://discord.com/blog)\n- [Cassandra Video](https://www.youtube.com/watch?v=some-video)\n- [ScyllaDB YouTube Channel](https://www.youtube.com/channel/UCsome-channel)\n- [ByteByteGo](https://bytebytego.com/)\n\n## üëè Wrapping Up\n\nDiscord embarked on an extraordinary journey, transitioning from Cassandra to ScyllaDB, and leveraging the power of Rust to scale trillions of messages. This migration showcases the effectiveness of Rust in developing resilient solutions üóí\n\n<br>\n\n**_Until next time, „Å§„Å•„Åè üéâ_**\n\n> üí° Thank you for Reading !! üôåüèªüòÅüìÉ, see you in the next blog.ü§ò  _**Until next time üéâ**_\n\nüöÄ Thank you for sticking up till the end. If you have any questions/feedback regarding this blog feel free to connect with me:\n\n**‚ôªÔ∏è LinkedIn:** https://www.linkedin.com/in/rajhi-saif/\n\n**‚ôªÔ∏è X/Twitter:** https://x.com/rajhisaifeddine\n\n**The end ‚úåüèª**\n\n<h1 align=\"center\">üî∞ Keep Learning !! Keep Sharing !! üî∞</h1>\n\n**üìÖ Stay updated**\n\nSubscribe to our newsletter for more insights on AWS cloud computing and containers.\n","wordCount":{"words":718},"frontmatter":{"id":"ab448b6a68a01a0040479fa2","path":"/blog/discord-cassandra-to-scylladb/","humanDate":"Nov 1, 2024","fullDate":"2024-11-01","title":"Scaling Trillions of Messages: Discord's Journey from Cassandra to ScyllaDB with Rust-Powered Solutions üöÄ","keywords":["Discord","Cassandra","ScyllaDB","Rust","SRE","DevOps"],"excerpt":"An epic journey from Cassandra to ScyllaDB with Rusty reinforcements, detailing how Discord scaled to handle trillions of messages.","cover":{"childImageSharp":{"gatsbyImageData":{"layout":"fullWidth","placeholder":{"fallback":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAABYlAAAWJQFJUiTwAAACYUlEQVR42n1SS09TURBm78qdS6PQQO8txd62YluLkjRRpNDX7W17a6EtbQBFEhMDWooPXEAgIRGh9P2i4gM0RUpiYoyGmLhT/4B/5XPOrUjVxMWXc745M9/MmZk2XSAPXsxA481C7Umjy52GuhXM5mnelTdPRrEpJ3EWq5VyUDk2MXjrBdpaBc3hCi7FqrBEK7gcr6FvbAum0TL6YluwRqvEq7gYZagovlbiLJ7FMsFrR4LMwFHGqze2EZ6vYyRZh3yvjtD8W0izbxBM7iHycB+xhQPIiTqu/+KjD/ahlwv/CvJiFhqqUh2ooie6C0NsR6nEHC7DEqko996RkgJ9sEi2qlI1A09iR18+rpDEuqQCgp4ZNAZ53B2SoWYJyPmMcxPi7GuE7u/BPEatmKihf/IZjOESVC7qK0Hjz5Ng6k/BTm8RHuccVu1XsOwSYZBS0EUKULmfIpH+jLWdrwgvNDC5/A53nnyAe3YfQrwMa+IlBF8aHX8PpVvKQxfawGnXKk7ZFmEKrWN69xBTqQPoHY9gFFdgiechlz+iO7AOg8mP+GIFc99/wDqew1l7CoPTrYL0vejOF5gml3DipAqdthkEGt8wnHkPo9EOoW8C/dJjiOVDGEIFnL8QhsW/BHv+EwT6fsfQRqtgcyjCzW1ogzm025LgHGvQj9dwTk5DO7CCbuolR0HccAoaZwa8uwDeQXtIvdN6ssd72OPLKYvKsSGwIDftpK9EPPubc968wtlE2cl8OZFiGCdopCzaKdHA1HO09YaK0PlzEKhSQW5CFzjiheb5P5C/gfx42mPn7Vf4CV2Q5r90efC9AAAAAElFTkSuQmCC"},"images":{"fallback":{"src":"/static/0c2b092cc9e4f72240fc8c80a60169b4/61fb6/discord-scylladb-cover.png","srcSet":"/static/0c2b092cc9e4f72240fc8c80a60169b4/27806/discord-scylladb-cover.png 750w,\n/static/0c2b092cc9e4f72240fc8c80a60169b4/1af68/discord-scylladb-cover.png 1080w,\n/static/0c2b092cc9e4f72240fc8c80a60169b4/eff31/discord-scylladb-cover.png 1366w,\n/static/0c2b092cc9e4f72240fc8c80a60169b4/61fb6/discord-scylladb-cover.png 1920w","sizes":"100vw"},"sources":[{"srcSet":"/static/0c2b092cc9e4f72240fc8c80a60169b4/81950/discord-scylladb-cover.webp 750w,\n/static/0c2b092cc9e4f72240fc8c80a60169b4/86e93/discord-scylladb-cover.webp 1080w,\n/static/0c2b092cc9e4f72240fc8c80a60169b4/51b5c/discord-scylladb-cover.webp 1366w,\n/static/0c2b092cc9e4f72240fc8c80a60169b4/a518e/discord-scylladb-cover.webp 1920w","type":"image/webp","sizes":"100vw"}]},"width":1,"height":0.5572916666666666}}},"coverCredits":"Photo by Saifeddine Rajhi"}}},"pageContext":{"prevThought":{"frontmatter":{"path":"/blog/in-memory-databases-comparison/","title":"A Battle of Lightning-Fast In-Memory Databases in the Real World ‚ö°","date":"2024-11-01 18:30:00"},"excerpt":"Redis, KeyDB, Dragonfly, Skytable as examples‚ö° ‚ÑπÔ∏è Introduction In today's world, businesses need fast ways to store and access their data‚Ä¶"},"nextThought":{"frontmatter":{"path":"/blog/eks-upgrade-guide/","title":"EKS cluster upgrades: A Step-by-Step guide to a secure Process","date":"2024-10-31 21:30:00"},"excerpt":"A Step-by-Step upgrade handbook üìö Introduction The cloud computing landscape is constantly evolving, and it can be difficult to keep up‚Ä¶"}}},"staticQueryHashes":["1271460761","1321585977"],"slicesMap":{}}