{"componentChunkName":"component---src-templates-blog-template-js","path":"/blog/kubernetes-rbac-privilege-escalation-mitigation/","result":{"data":{"markdownRemark":{"html":"<blockquote>\n<p><strong>RBAC: Mapping Out Privilege Escalation Routes üîí</strong></p>\n</blockquote>\n<h2 id=\"-introduction\" style=\"position:relative;\"><a href=\"#-introduction\" aria-label=\" introduction permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üéë Introduction</h2>\n<p>Kubernetes, the open-source container orchestration system, has revolutionized the world of container management. Its RBAC module ensures that only authorized entities can access cluster resources. However, as with any complex system, there are nuances to be explored, and certain permissions can inadvertently pave the way for privilege escalation.</p>\n<p>In this blog post, we will explore seven distinct privilege escalation threat vectors, empowered by specific permissions, including:</p>\n<ul>\n<li>Creating Pods</li>\n<li>Reading Secrets</li>\n<li>Binding Roles</li>\n<li>Escalating Existing Roles</li>\n<li>Impersonating Entities in the Cluster</li>\n</ul>\n<p>For each threat vector, we will provide a detailed explanation of how the exploit can be executed and discuss potential mitigations.</p>\n<div style=\"width:100%;height:0;padding-bottom:89%;position:relative;\"><iframe src=\"https://giphy.com/embed/ul1omlrGG6kpO\" width=\"100%\" height=\"100%\" style=\"position:absolute\" frameborder=\"0\" class=\"giphy-embed\" allowfullscreen></iframe></div>\n<h2 id=\"Ô∏è-pod-creation\" style=\"position:relative;\"><a href=\"#%EF%B8%8F-pod-creation\" aria-label=\"Ô∏è pod creation permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>‚ñ∂Ô∏è Pod Creation</h2>\n<p>Pods are the basic building blocks of Kubernetes clusters. Each pod contains at least one container, which runs an application. In other words, if you're using Kubernetes, you're using pods.</p>\n<p>While RBAC ensures that only authorized users can create pods, it doesn't control what they can put in their pod definitions. Without proper <a href=\"https://kubernetes.io/docs/reference/access-authn-authz/admission-controllers/\" target=\"_blank\" rel=\"noopener noreferrer\">admission control</a>, authorized users can create pods with arbitrary images, which can contain arbitrary privileges and configurations. This can lead to privilege escalation attacks.</p>\n<p><strong>Examples of Exploitation:</strong></p>\n<ul>\n<li>An attacker can create a pod with a malicious image that has root privileges, allowing them to gain root access to the Kubernetes node where the pod is running.</li>\n<li>An attacker can create a pod with an image that has the ability to escape the container and run arbitrary code on the Kubernetes node.</li>\n<li>An attacker can create a pod with an image that can exploit a vulnerability in the Kubernetes cluster, potentially gaining access to sensitive data or resources.</li>\n</ul>\n<p><strong>Mitigation Strategies:</strong></p>\n<ul>\n<li>Use <a href=\"https://kubernetes.io/docs/reference/access-authn-authz/admission-controllers/\" target=\"_blank\" rel=\"noopener noreferrer\">admission control</a> to restrict the types of pods that can be created.</li>\n<li>Implement security policies to restrict the privileges of pods.</li>\n<li>Scan container images for vulnerabilities before running them in production.</li>\n<li>Monitor your Kubernetes cluster for suspicious activity.</li>\n</ul>\n<h2 id=\"Ô∏è-mounting-a-service-account-token\" style=\"position:relative;\"><a href=\"#%EF%B8%8F-mounting-a-service-account-token\" aria-label=\"Ô∏è mounting a service account token permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>‚ñ∂Ô∏è Mounting a Service Account Token</h2>\n<p>Pods can be configured to <a href=\"https://kubernetes.io/docs/tasks/configure-pod-container/configure-service-account/#use-the-default-service-account-to-access-the-api-server\" target=\"_blank\" rel=\"noopener noreferrer\">mount the authorization token</a> for a service account within the same namespace. This means that an attacker could create a pod with a malicious image that steals the token from a high-privileged service account. The attacker could then use this token to perform API actions and escalate their privileges.</p>\n<p><strong>Mitigation Strategies:</strong></p>\n<ul>\n<li>Only mount service account tokens to pods that need them.</li>\n<li>Use security policies to restrict the privileges of pods.</li>\n</ul>\n<h2 id=\"Ô∏è-unauthorized-cluster-node-access-risks-and-mitigations\" style=\"position:relative;\"><a href=\"#%EF%B8%8F-unauthorized-cluster-node-access-risks-and-mitigations\" aria-label=\"Ô∏è unauthorized cluster node access risks and mitigations permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>‚ñ∂Ô∏è Unauthorized Cluster Node Access: Risks and Mitigations</h2>\n<p>If you allow entities to create highly privileged containers without comprehensive admission control, you are creating security vulnerabilities. This can result in the creation of vulnerable Pods that enable attackers to gain access to the corresponding container and potentially infiltrate the Cluster's underlying node.</p>\n<p><strong>Risks of Unauthorized Cluster Node Access:</strong></p>\n<ul>\n<li>An attacker typically follows a two-step process: gaining access to the container and then executing traditional container escape techniques. Such an attack can have severe consequences within Kubernetes environments.</li>\n<li>Access to any Cluster node is a significant breach. With node access, an attacker can leverage the container engine to access ServiceAccount tokens from other Pods on the same node, potentially compromising the security of the entire Cluster.</li>\n<li>Additionally, the attacker can search for application data and configuration files on the node, exposing critical parts of the Cluster. They can also identify and target unrelated network hosts and services like DNS Servers.</li>\n</ul>\n<p><strong>Mitigation Strategies:</strong></p>\n<ul>\n<li>Implement strict admission control.</li>\n<li>Continuous monitoring and auditing.</li>\n<li>Network segmentation and access control lists.</li>\n</ul>\n<h2 id=\"Ô∏è-secret-access-in-kubernetes-risks-and-mitigations\" style=\"position:relative;\"><a href=\"#%EF%B8%8F-secret-access-in-kubernetes-risks-and-mitigations\" aria-label=\"Ô∏è secret access in kubernetes risks and mitigations permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>‚ñ∂Ô∏è Secret Access in Kubernetes: Risks and Mitigations</h2>\n<p>It is important to grant the permission to read Secrets with caution, as it is a very powerful permission. In Kubernetes, Secrets can be used to store application-critical configuration data, as well as authorization tokens for ServiceAccounts.</p>\n<p><strong>Risks of Unauthorized Secret Access:</strong></p>\n<ul>\n<li>If an attacker is able to read Secrets, they could steal authorization tokens and essentially take over the corresponding ServiceAccounts. This could give them access to sensitive data, the ability to launch attacks against other nodes in the cluster, or disrupt the cluster's operations.</li>\n</ul>\n<p><strong>Mitigation Strategies:</strong></p>\n<ul>\n<li>Implement strict Role-Based Access Control (RBAC) policies to restrict who can read Secrets.</li>\n<li>Use a secrets management tool to encrypt Secrets at rest and in transit.</li>\n<li>Monitor for suspicious activity, such as a large number of failed attempts to read Secrets.</li>\n</ul>\n<h2 id=\"Ô∏è-impersonation-in-kubernetes\" style=\"position:relative;\"><a href=\"#%EF%B8%8F-impersonation-in-kubernetes\" aria-label=\"Ô∏è impersonation in kubernetes permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>‚ñ∂Ô∏è Impersonation in Kubernetes</h2>\n<p>Impersonation in Kubernetes is a mechanism that allows an entity to act as another entity while performing API requests. This can be useful for administrators to test configurations or troubleshoot problems. However, attackers can also use impersonation to gain unauthorized access to the Kubernetes cluster or its resources.</p>\n<p><strong>How Impersonation Works:</strong></p>\n<ul>\n<li>Impersonation is done by adding the <code class=\"language-text\">Impersonate-User</code> header to the API request. The value of the header is the name of the entity that the user wants to impersonate. Kubernetes first checks whether impersonation is allowed for the target entity. If it is, Kubernetes proceeds as if the impersonated entity made the request.</li>\n</ul>\n<p><strong>Impersonating Service Accounts:</strong></p>\n<ul>\n<li>To impersonate a service account, the <code class=\"language-text\">Impersonate-User</code> header must be set to the following value:\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">Impersonate-User: system:serviceaccount:&lt;namespace>:&lt;service-account-name></code></pre></div>\nFor example, to impersonate the default service account in the default namespace, the header would be set to:\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">Impersonate-User: system:serviceaccount:default:default</code></pre></div>\n</li>\n</ul>\n<p><strong>Risks of Impersonation:</strong></p>\n<ul>\n<li>Impersonation can be a very powerful tool for attackers. If an attacker is able to impersonate a privileged entity, they could gain access to sensitive data, delete resources, or disrupt the operation of the Kubernetes cluster.</li>\n</ul>\n<p><strong>Mitigation Strategies:</strong></p>\n<ul>\n<li>Implement strict Role-Based Access Control (RBAC) policies to restrict who can impersonate entities.</li>\n<li>Monitor for suspicious activity, such as a large number of failed attempts to impersonate entities.</li>\n<li>Educate users about the risks of impersonation and how to avoid them.</li>\n</ul>\n<h2 id=\"Ô∏è-rolebinding-permissions-in-kubernetes-implications-and-safeguards\" style=\"position:relative;\"><a href=\"#%EF%B8%8F-rolebinding-permissions-in-kubernetes-implications-and-safeguards\" aria-label=\"Ô∏è rolebinding permissions in kubernetes implications and safeguards permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>‚ñ∂Ô∏è Rolebinding Permissions in Kubernetes: Implications and Safeguards</h2>\n<p>The <code class=\"language-text\">bind</code> verb in Kubernetes allows an entity to assign a Role or ClusterRole to a subject (e.g., a user, group, or service account). This is a powerful permission, as it allows the entity to grant itself new permissions.</p>\n<p><strong>Binding Roles:</strong></p>\n<ul>\n<li>If an entity has the permission to create RoleBindings and the permission to bind Roles, it can assign arbitrary Roles to itself and elevate its privileges depending on the Roles available in the namespace in which these permissions are available.</li>\n</ul>\n<p><strong>Binding ClusterRoles within a Namespace:</strong></p>\n<ul>\n<li>If an entity has the permission to create RoleBindings and the permission to bind ClusterRoles, it can bind the permissions of a ClusterRole to the respective namespace. This is generally a greater privilege escalation than the first variant, as it allows the entity to gain the permissions of any ClusterRole, regardless of which namespace it is defined in.</li>\n</ul>\n<p><strong>Binding ClusterRoles Cluster-wide:</strong></p>\n<ul>\n<li>Finally, if an entity has the permission to create ClusterRoleBindings and the permission to bind ClusterRoles, it can gain the highest possible permissions within the Cluster by binding the permissions of the most privileged entities within the <code class=\"language-text\">kube-system</code> namespace to itself.</li>\n</ul>\n<p><strong>Risks of Binding Roles and ClusterRoles:</strong></p>\n<ul>\n<li>If an attacker gains the permission to bind Roles or ClusterRoles, they could elevate their privileges and gain access to sensitive data or disrupt the operation of the Kubernetes cluster.</li>\n</ul>\n<h2 id=\"mitigation-strategies\" style=\"position:relative;\"><a href=\"#mitigation-strategies\" aria-label=\"mitigation strategies permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Mitigation Strategies</h2>\n<ul>\n<li>Implement strict Role-Based Access Control (RBAC) policies to restrict who can bind Roles and ClusterRoles.</li>\n<li>Monitor for suspicious activity, such as a large number of attempts to bind Roles or ClusterRoles.</li>\n<li>Educate users about the risks of binding Roles and ClusterRoles and how to avoid them.</li>\n</ul>\n<p>üìí <strong>Privilege Escalation Prevention and Bootstrapping</strong></p>\n<p>The RBAC API prevents users from escalating privileges by editing roles or role bindings. Because this is enforced at the API level, it applies even when the RBAC authorizer is not in use.</p>\n<p>üìí <strong>Restrictions on Role Creation or Update</strong></p>\n<p>You can only create/update a role if at least one of the following conditions is true:</p>\n<ul>\n<li><strong>You already have all the permissions contained in the role</strong>, at the same scope as the object being modified (cluster-wide for a ClusterRole, within the same namespace or cluster-wide for a Role).</li>\n<li><strong>You are granted explicit permission</strong> to perform the <code class=\"language-text\">escalate</code> verb on the roles or clusterroles resource in the <code class=\"language-text\">rbac.authorization.k8s.io</code> API group.</li>\n</ul>\n<p>For example, if <code class=\"language-text\">user-1</code> does not have the ability to list Secrets cluster-wide, they cannot create a ClusterRole containing that permission. To allow a user to create/update roles:</p>\n<ol>\n<li><strong>Grant them a role</strong> that allows them to create/update Role or ClusterRole objects, as desired.</li>\n<li><strong>Grant them permission</strong> to include specific permissions in the roles they create/update:\n<ul>\n<li><strong>Implicitly</strong>, by giving them those permissions (if they attempt to create or modify a Role or ClusterRole with permissions they themselves have not been granted, the API request will be forbidden).</li>\n<li><strong>Explicitly</strong>, by giving them permission to perform the <code class=\"language-text\">escalate</code> verb on roles or clusterroles resources in the <code class=\"language-text\">rbac.authorization.k8s.io</code> API group.</li>\n</ul>\n</li>\n</ol>\n<p>For more details, refer to the <a href=\"https://kubernetes.io/docs/reference/access-authn-authz/rbac/\" target=\"_blank\" rel=\"noopener noreferrer\">Kubernetes RBAC documentation</a>.</p>\n<p>üìí <strong>Restrictions on Role Binding Creation or Update</strong></p>\n<p>You can only create/update a role binding if you already have all the permissions contained in the referenced role (at the same scope as the role binding) or if you have been authorized to perform the <code class=\"language-text\">bind</code> verb on the referenced role.</p>\n<p>For example, if <code class=\"language-text\">user-1</code> does not have the ability to list Secrets cluster-wide, they cannot create a <code class=\"language-text\">ClusterRoleBinding</code> to a role that grants that permission.</p>\n<p>To allow a user to create/update role bindings:</p>\n<ol>\n<li><strong>Grant them a role</strong> that allows them to create/update <code class=\"language-text\">RoleBinding</code> or <code class=\"language-text\">ClusterRoleBinding</code> objects, as desired.</li>\n<li><strong>Grant them permissions needed to bind a particular role:</strong>\n<ul>\n<li><strong>Implicitly</strong>, by giving them the permissions contained in the role.</li>\n<li><strong>Explicitly</strong>, by giving them permission to perform the <code class=\"language-text\">bind</code> verb on the particular Role (or ClusterRole).</li>\n</ul>\n</li>\n</ol>\n<p>For more details, refer to the <a href=\"https://kubernetes.io/docs/reference/access-authn-authz/rbac/\" target=\"_blank\" rel=\"noopener noreferrer\">Kubernetes RBAC documentation</a>.</p>\n<p>For example, this ClusterRole and RoleBinding would allow user-1 to grant other users the admin, edit, and view roles in the namespace user-1-namespace:</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> rbac.authorization.k8s.io/v1\n<span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> ClusterRole\n<span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> role<span class=\"token punctuation\">-</span>grantor\n<span class=\"token key atrule\">rules</span><span class=\"token punctuation\">:</span>\n<span class=\"token punctuation\">-</span> <span class=\"token key atrule\">apiGroups</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"rbac.authorization.k8s.io\"</span><span class=\"token punctuation\">]</span>\n  <span class=\"token key atrule\">resources</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"rolebindings\"</span><span class=\"token punctuation\">]</span>\n  <span class=\"token key atrule\">verbs</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"create\"</span><span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">-</span> <span class=\"token key atrule\">apiGroups</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"rbac.authorization.k8s.io\"</span><span class=\"token punctuation\">]</span>\n  <span class=\"token key atrule\">resources</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"clusterroles\"</span><span class=\"token punctuation\">]</span>\n  <span class=\"token key atrule\">verbs</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"bind\"</span><span class=\"token punctuation\">]</span>\n  <span class=\"token comment\"># omit resourceNames to allow binding any ClusterRole</span>\n  <span class=\"token key atrule\">resourceNames</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"admin\"</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"edit\"</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"view\"</span><span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">---</span>\n<span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> rbac.authorization.k8s.io/v1\n<span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> RoleBinding\n<span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> role<span class=\"token punctuation\">-</span>grantor<span class=\"token punctuation\">-</span>binding\n  <span class=\"token key atrule\">namespace</span><span class=\"token punctuation\">:</span> user<span class=\"token punctuation\">-</span>1<span class=\"token punctuation\">-</span>namespace\n<span class=\"token key atrule\">roleRef</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">apiGroup</span><span class=\"token punctuation\">:</span> rbac.authorization.k8s.io\n  <span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> ClusterRole\n  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> role<span class=\"token punctuation\">-</span>grantor\n<span class=\"token key atrule\">subjects</span><span class=\"token punctuation\">:</span>\n<span class=\"token punctuation\">-</span> <span class=\"token key atrule\">apiGroup</span><span class=\"token punctuation\">:</span> rbac.authorization.k8s.io\n  <span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> User\n  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> user<span class=\"token punctuation\">-</span><span class=\"token number\">1</span></code></pre></div>\n<p><strong>üìú Bootstrapping Initial Roles and Role Bindings</strong></p>\n<p>When bootstrapping the first roles and role bindings, it is necessary for the initial user to grant permissions they do not yet have. To bootstrap initial roles and role bindings:</p>\n<ul>\n<li><strong>Use a credential with the <code class=\"language-text\">system:masters</code> group</strong>, which is bound to the <code class=\"language-text\">cluster-admin</code> super-user role by the default bindings.</li>\n</ul>\n<p>For more details, refer to the <a href=\"https://kubernetes.io/docs/reference/access-authn-authz/rbac/\" target=\"_blank\" rel=\"noopener noreferrer\">Kubernetes RBAC documentation</a>.</p>\n<h2 id=\"-conclusion\" style=\"position:relative;\"><a href=\"#-conclusion\" aria-label=\" conclusion permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üèÅ Conclusion</h2>\n<p>In this blog post, we have discussed three of the most common security threats to Kubernetes environments:</p>\n<ul>\n<li><strong>Unauthorized access to Cluster nodes</strong></li>\n<li><strong>Impersonation</strong></li>\n<li><strong>Binding Roles and ClusterRoles</strong></li>\n</ul>\n<p>We have also provided some recommendations on how to mitigate these risks.</p>\n<p>üîê <strong>Key Takeaway:</strong> Security is a continuous process. There is no single solution that will protect your Kubernetes cluster from all threats. However, by implementing a layered security approach and following the recommendations in this blog post, you can help to reduce your risk and protect your Kubernetes environment.</p>\n<p>For further reading, check out the <a href=\"https://kubernetes.io/docs/concepts/security/overview/\" target=\"_blank\" rel=\"noopener noreferrer\">Kubernetes Security Best Practices</a>.</p>","timeToRead":7,"rawMarkdownBody":"\n> **RBAC: Mapping Out Privilege Escalation Routes üîí**\n\n## üéë Introduction\n\nKubernetes, the open-source container orchestration system, has revolutionized the world of container management. Its RBAC module ensures that only authorized entities can access cluster resources. However, as with any complex system, there are nuances to be explored, and certain permissions can inadvertently pave the way for privilege escalation.\n\nIn this blog post, we will explore seven distinct privilege escalation threat vectors, empowered by specific permissions, including:\n\n- Creating Pods\n- Reading Secrets\n- Binding Roles\n- Escalating Existing Roles\n- Impersonating Entities in the Cluster\n\nFor each threat vector, we will provide a detailed explanation of how the exploit can be executed and discuss potential mitigations.\n\n\nhttps://giphy.com/gifs/super-saiyan-ul1omlrGG6kpO\n\n\n## ‚ñ∂Ô∏è Pod Creation\n\nPods are the basic building blocks of Kubernetes clusters. Each pod contains at least one container, which runs an application. In other words, if you're using Kubernetes, you're using pods.\n\nWhile RBAC ensures that only authorized users can create pods, it doesn't control what they can put in their pod definitions. Without proper [admission control](https://kubernetes.io/docs/reference/access-authn-authz/admission-controllers/), authorized users can create pods with arbitrary images, which can contain arbitrary privileges and configurations. This can lead to privilege escalation attacks.\n\n**Examples of Exploitation:**\n\n- An attacker can create a pod with a malicious image that has root privileges, allowing them to gain root access to the Kubernetes node where the pod is running.\n- An attacker can create a pod with an image that has the ability to escape the container and run arbitrary code on the Kubernetes node.\n- An attacker can create a pod with an image that can exploit a vulnerability in the Kubernetes cluster, potentially gaining access to sensitive data or resources.\n\n**Mitigation Strategies:**\n\n- Use [admission control](https://kubernetes.io/docs/reference/access-authn-authz/admission-controllers/) to restrict the types of pods that can be created.\n- Implement security policies to restrict the privileges of pods.\n- Scan container images for vulnerabilities before running them in production.\n- Monitor your Kubernetes cluster for suspicious activity.\n\n## ‚ñ∂Ô∏è Mounting a Service Account Token\n\nPods can be configured to [mount the authorization token](https://kubernetes.io/docs/tasks/configure-pod-container/configure-service-account/#use-the-default-service-account-to-access-the-api-server) for a service account within the same namespace. This means that an attacker could create a pod with a malicious image that steals the token from a high-privileged service account. The attacker could then use this token to perform API actions and escalate their privileges.\n\n**Mitigation Strategies:**\n\n- Only mount service account tokens to pods that need them.\n- Use security policies to restrict the privileges of pods.\n\n## ‚ñ∂Ô∏è Unauthorized Cluster Node Access: Risks and Mitigations\n\nIf you allow entities to create highly privileged containers without comprehensive admission control, you are creating security vulnerabilities. This can result in the creation of vulnerable Pods that enable attackers to gain access to the corresponding container and potentially infiltrate the Cluster's underlying node.\n\n**Risks of Unauthorized Cluster Node Access:**\n\n- An attacker typically follows a two-step process: gaining access to the container and then executing traditional container escape techniques. Such an attack can have severe consequences within Kubernetes environments.\n- Access to any Cluster node is a significant breach. With node access, an attacker can leverage the container engine to access ServiceAccount tokens from other Pods on the same node, potentially compromising the security of the entire Cluster.\n- Additionally, the attacker can search for application data and configuration files on the node, exposing critical parts of the Cluster. They can also identify and target unrelated network hosts and services like DNS Servers.\n\n**Mitigation Strategies:**\n\n- Implement strict admission control.\n- Continuous monitoring and auditing.\n- Network segmentation and access control lists.\n\n## ‚ñ∂Ô∏è Secret Access in Kubernetes: Risks and Mitigations\n\nIt is important to grant the permission to read Secrets with caution, as it is a very powerful permission. In Kubernetes, Secrets can be used to store application-critical configuration data, as well as authorization tokens for ServiceAccounts.\n\n**Risks of Unauthorized Secret Access:**\n\n- If an attacker is able to read Secrets, they could steal authorization tokens and essentially take over the corresponding ServiceAccounts. This could give them access to sensitive data, the ability to launch attacks against other nodes in the cluster, or disrupt the cluster's operations.\n\n**Mitigation Strategies:**\n\n- Implement strict Role-Based Access Control (RBAC) policies to restrict who can read Secrets.\n- Use a secrets management tool to encrypt Secrets at rest and in transit.\n- Monitor for suspicious activity, such as a large number of failed attempts to read Secrets.\n\n## ‚ñ∂Ô∏è Impersonation in Kubernetes\n\nImpersonation in Kubernetes is a mechanism that allows an entity to act as another entity while performing API requests. This can be useful for administrators to test configurations or troubleshoot problems. However, attackers can also use impersonation to gain unauthorized access to the Kubernetes cluster or its resources.\n\n**How Impersonation Works:**\n\n- Impersonation is done by adding the `Impersonate-User` header to the API request. The value of the header is the name of the entity that the user wants to impersonate. Kubernetes first checks whether impersonation is allowed for the target entity. If it is, Kubernetes proceeds as if the impersonated entity made the request.\n\n**Impersonating Service Accounts:**\n\n- To impersonate a service account, the `Impersonate-User` header must be set to the following value:\n    ```\n    Impersonate-User: system:serviceaccount:<namespace>:<service-account-name>\n    ```\n    For example, to impersonate the default service account in the default namespace, the header would be set to:\n    ```\n    Impersonate-User: system:serviceaccount:default:default\n    ```\n\n**Risks of Impersonation:**\n\n- Impersonation can be a very powerful tool for attackers. If an attacker is able to impersonate a privileged entity, they could gain access to sensitive data, delete resources, or disrupt the operation of the Kubernetes cluster.\n\n**Mitigation Strategies:**\n\n- Implement strict Role-Based Access Control (RBAC) policies to restrict who can impersonate entities.\n- Monitor for suspicious activity, such as a large number of failed attempts to impersonate entities.\n- Educate users about the risks of impersonation and how to avoid them.\n\n## ‚ñ∂Ô∏è Rolebinding Permissions in Kubernetes: Implications and Safeguards\n\nThe `bind` verb in Kubernetes allows an entity to assign a Role or ClusterRole to a subject (e.g., a user, group, or service account). This is a powerful permission, as it allows the entity to grant itself new permissions.\n\n**Binding Roles:**\n\n- If an entity has the permission to create RoleBindings and the permission to bind Roles, it can assign arbitrary Roles to itself and elevate its privileges depending on the Roles available in the namespace in which these permissions are available.\n\n**Binding ClusterRoles within a Namespace:**\n\n- If an entity has the permission to create RoleBindings and the permission to bind ClusterRoles, it can bind the permissions of a ClusterRole to the respective namespace. This is generally a greater privilege escalation than the first variant, as it allows the entity to gain the permissions of any ClusterRole, regardless of which namespace it is defined in.\n\n**Binding ClusterRoles Cluster-wide:**\n\n- Finally, if an entity has the permission to create ClusterRoleBindings and the permission to bind ClusterRoles, it can gain the highest possible permissions within the Cluster by binding the permissions of the most privileged entities within the `kube-system` namespace to itself.\n\n**Risks of Binding Roles and ClusterRoles:**\n\n- If an attacker gains the permission to bind Roles or ClusterRoles, they could elevate their privileges and gain access to sensitive data or disrupt the operation of the Kubernetes cluster.\n\n## Mitigation Strategies\n\n- Implement strict Role-Based Access Control (RBAC) policies to restrict who can bind Roles and ClusterRoles.\n- Monitor for suspicious activity, such as a large number of attempts to bind Roles or ClusterRoles.\n- Educate users about the risks of binding Roles and ClusterRoles and how to avoid them.\n\nüìí **Privilege Escalation Prevention and Bootstrapping**\n\nThe RBAC API prevents users from escalating privileges by editing roles or role bindings. Because this is enforced at the API level, it applies even when the RBAC authorizer is not in use.\n\nüìí **Restrictions on Role Creation or Update**\n\nYou can only create/update a role if at least one of the following conditions is true:\n\n- **You already have all the permissions contained in the role**, at the same scope as the object being modified (cluster-wide for a ClusterRole, within the same namespace or cluster-wide for a Role).\n- **You are granted explicit permission** to perform the `escalate` verb on the roles or clusterroles resource in the `rbac.authorization.k8s.io` API group.\n\nFor example, if `user-1` does not have the ability to list Secrets cluster-wide, they cannot create a ClusterRole containing that permission. To allow a user to create/update roles:\n\n1. **Grant them a role** that allows them to create/update Role or ClusterRole objects, as desired.\n2. **Grant them permission** to include specific permissions in the roles they create/update:\n    - **Implicitly**, by giving them those permissions (if they attempt to create or modify a Role or ClusterRole with permissions they themselves have not been granted, the API request will be forbidden).\n    - **Explicitly**, by giving them permission to perform the `escalate` verb on roles or clusterroles resources in the `rbac.authorization.k8s.io` API group.\n\nFor more details, refer to the [Kubernetes RBAC documentation](https://kubernetes.io/docs/reference/access-authn-authz/rbac/).\n\n\nüìí **Restrictions on Role Binding Creation or Update**\n\nYou can only create/update a role binding if you already have all the permissions contained in the referenced role (at the same scope as the role binding) or if you have been authorized to perform the `bind` verb on the referenced role. \n\nFor example, if `user-1` does not have the ability to list Secrets cluster-wide, they cannot create a `ClusterRoleBinding` to a role that grants that permission. \n\nTo allow a user to create/update role bindings:\n\n1. **Grant them a role** that allows them to create/update `RoleBinding` or `ClusterRoleBinding` objects, as desired.\n2. **Grant them permissions needed to bind a particular role:**\n    - **Implicitly**, by giving them the permissions contained in the role.\n    - **Explicitly**, by giving them permission to perform the `bind` verb on the particular Role (or ClusterRole).\n\nFor more details, refer to the [Kubernetes RBAC documentation](https://kubernetes.io/docs/reference/access-authn-authz/rbac/).\n\nFor example, this ClusterRole and RoleBinding would allow user-1 to grant other users the admin, edit, and view roles in the namespace user-1-namespace:\n\n\n```yaml\napiVersion: rbac.authorization.k8s.io/v1\nkind: ClusterRole\nmetadata:\n  name: role-grantor\nrules:\n- apiGroups: [\"rbac.authorization.k8s.io\"]\n  resources: [\"rolebindings\"]\n  verbs: [\"create\"]\n- apiGroups: [\"rbac.authorization.k8s.io\"]\n  resources: [\"clusterroles\"]\n  verbs: [\"bind\"]\n  # omit resourceNames to allow binding any ClusterRole\n  resourceNames: [\"admin\",\"edit\",\"view\"]\n---\napiVersion: rbac.authorization.k8s.io/v1\nkind: RoleBinding\nmetadata:\n  name: role-grantor-binding\n  namespace: user-1-namespace\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: role-grantor\nsubjects:\n- apiGroup: rbac.authorization.k8s.io\n  kind: User\n  name: user-1\n```\n\n**üìú Bootstrapping Initial Roles and Role Bindings**\n\nWhen bootstrapping the first roles and role bindings, it is necessary for the initial user to grant permissions they do not yet have. To bootstrap initial roles and role bindings:\n\n- **Use a credential with the `system:masters` group**, which is bound to the `cluster-admin` super-user role by the default bindings.\n\nFor more details, refer to the [Kubernetes RBAC documentation](https://kubernetes.io/docs/reference/access-authn-authz/rbac/).\n\n## üèÅ Conclusion\n\nIn this blog post, we have discussed three of the most common security threats to Kubernetes environments:\n\n- **Unauthorized access to Cluster nodes**\n- **Impersonation**\n- **Binding Roles and ClusterRoles**\n\nWe have also provided some recommendations on how to mitigate these risks.\n\nüîê **Key Takeaway:** Security is a continuous process. There is no single solution that will protect your Kubernetes cluster from all threats. However, by implementing a layered security approach and following the recommendations in this blog post, you can help to reduce your risk and protect your Kubernetes environment.\n\nFor further reading, check out the [Kubernetes Security Best Practices](https://kubernetes.io/docs/concepts/security/overview/).\n\n","wordCount":{"words":1758},"frontmatter":{"id":"ee470f115f4237fc9cac1b1c","path":"/blog/kubernetes-rbac-privilege-escalation-mitigation/","humanDate":"Oct 29, 2024","fullDate":"2024-10-29","title":"Kubernetes RBAC: Privilege Escalation Exploits and Mitigations üîí","keywords":["Kubernetes","RBAC","Privilege Escalation","Security","k8s","DevOps"],"excerpt":"Understand the risks of privilege escalation in Kubernetes RBAC and learn effective mitigation strategies to secure your cluster.","cover":{"childImageSharp":{"gatsbyImageData":{"layout":"fullWidth","placeholder":{"fallback":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAsTAAALEwEAmpwYAAADF0lEQVR42p2US2gTURSGUxVtfRCt4gNBpaALidRSrLEzk9HmTprJTJrJpAltFdT6QFyICNqVRHClrly50bXa4rPaKiLduBRf4EpFqGCapNVm0o5pMpnfOxNTtBgfOXDmPuB8/OecOdfhqMIAR80v57hjnqNaQ//WpRhpXG7vH7nrKXwe7q9bjNvLVlalCsONmzC8/YS9H2q6iGe9yzCwMoSBVXLVqeJJ0wMMN/dj2JVC/5o7uFX/AoP166tINzrfXgebL+NREzCwNoHrK0zcqH+OEX5Bpbia38Lofbn4GHXX4UODEyPO5XjucFLltX+C1cyFUpgNSgjCkqzqvaIp3qdZxXdfC5HBdDs7NOZjLmQUb6WmlNKaC/u4n6+dipA76BaBWHvRjLUjp/DQg5yByB5MSOyt2aB4PG4HsR2HOzm597VHOrDZvudLdYEFi3rvocuPrErymtJmpAOskRRbjVSgtZAMMOZXmZ3Q1T0bS5qiJVW7laOXfN2nwCvH5PL9aNRdN6UKd6GKyASFghb2Ii2xpgX74fnpoAeazL3/QJqdvwCpuggbPPTZKx1ssM6vaM10VbiHvX7ofWxBP8khHeAsWFHv8IC6aa3jAWZ6TGR6fhqdUspcx5GHXPAwXB4lbp21TmEQMaosRArG1RbkbzaZ6SBTnJI9SIvMuUSA3TkusWRMYhvKfwL9wO5oNB5f2OLb97KR9KBlt3odsbZr6A5AC5PCzHkGmb4Wc/Ko2/imepDw7+qbBcwRZZseJRu0sHDzXQfJvw358EkRZoyYYGSCxNSP89DO7jBThDGmRR5JkT1jA2jDQEtl+9zHQe8kj9EjIa8SIx8hyEWIqamkaDUgJbNmykdhtFZJqQQb4StPhQP7wqtznT6NBhsZCplUZ2FmSmKLtFaGHqI1k7nTZRgqTJNtQ37/okLU9wZdIrJhb3GaKqTTgHGZs7pnWsrSgdbTf1X2s2UjxEtVfaTAGS3clqOdy9FfgzpTTP4vrCwfhDhnwoJrQuJdCWGX64vo3pYR2S1W9+Kl8av592eJBlWqy/8+798BTNavZONe4hgAAAAASUVORK5CYII="},"images":{"fallback":{"src":"/static/e344476e6f1f8ea2b35d1bf7c3ae8327/acb7c/kubernetes-rbac-cover.png","srcSet":"/static/e344476e6f1f8ea2b35d1bf7c3ae8327/acb7c/kubernetes-rbac-cover.png 256w","sizes":"100vw"},"sources":[{"srcSet":"/static/e344476e6f1f8ea2b35d1bf7c3ae8327/22bfc/kubernetes-rbac-cover.webp 256w","type":"image/webp","sizes":"100vw"}]},"width":1,"height":1}}},"coverCredits":"Photo by Saifeddine Rajhi"}}},"pageContext":{"nextThought":{"frontmatter":{"path":"/blog/hidden-gems-kubernetes/","title":"Hidden Gems: A Few Things You Might Not Know About Kubernetes üíé","date":"2024-10-29 20:30:00"},"excerpt":"Lesser-Known Aspects of Kubernetes üíé Overview üëÄ Kubernetes has revolutionized the way we manage containerized applications, but it's‚Ä¶","html":"<blockquote>\n<p><strong>Lesser-Known Aspects of Kubernetes üíé</strong></p>\n</blockquote>\n<h2 id=\"overview-\" style=\"position:relative;\"><a href=\"#overview-\" aria-label=\"overview  permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Overview üëÄ</h2>\n<p>Kubernetes has revolutionized the way we manage containerized applications, but it's packed with hidden features that even experienced users might not be aware of.</p>\n<p>Let's dive into a few of these hidden gems and discover the lesser-known capabilities of Kubernetes.</p>\n<p>I hope this blog post has been helpful.</p>\n<h2 id=\"sorting-and-organizing-your-pods-\" style=\"position:relative;\"><a href=\"#sorting-and-organizing-your-pods-\" aria-label=\"sorting and organizing your pods  permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Sorting and Organizing Your Pods üìã</h2>\n<p>Ever wished you could organize your pod list in a more meaningful way? With Kubernetes, you can! Simply use the <code class=\"language-text\">--sort-by</code> flag along with the <code class=\"language-text\">kubectl get pods</code> command to sort your pods by various criteria, such as pod name or creation time.</p>\n<p>Running <code class=\"language-text\">kubectl get pods --sort-by=.metadata.name</code> might just save you from endless scrolling through your pod list. Let's sort the pods in descending order, i.e., with the newest pods appearing first:</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">kubectl get pods --sort-by<span class=\"token operator\">=</span>.metadata.creationTimestamp --no-headers <span class=\"token operator\">|</span> <span class=\"token function\">tail</span> <span class=\"token parameter variable\">-r</span>\nubuntu-pod-3             <span class=\"token number\">2</span>/2     Running   <span class=\"token number\">0</span>          5m17s\nubuntu-pod-2             <span class=\"token number\">2</span>/2     Running   <span class=\"token number\">0</span>          13m7s\nubuntu-pod-1             <span class=\"token number\">2</span>/2     Running   <span class=\"token number\">0</span>          26m</code></pre></div>\n<h2 id=\"listing-all-object-types-\" style=\"position:relative;\"><a href=\"#listing-all-object-types-\" aria-label=\"listing all object types  permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Listing All Object Types üìú</h2>\n<p>Did you know you can list all the object types that your cluster supports? Use the <code class=\"language-text\">kubectl api-resources</code> command:</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">kubectl api-resources</code></pre></div>\n<p>When we want a more encompassing list of all resources in a namespace, we can combine the <code class=\"language-text\">kubectl api-resources</code> command with <code class=\"language-text\">kubectl get</code>:</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">kubectl api-resources <span class=\"token parameter variable\">--verbs</span><span class=\"token operator\">=</span>list <span class=\"token parameter variable\">--namespaced</span> <span class=\"token parameter variable\">-o</span> name <span class=\"token operator\">|</span> <span class=\"token function\">xargs</span> <span class=\"token parameter variable\">-n</span> <span class=\"token number\">1</span> kubectl get --ignore-not-found --show-kind <span class=\"token parameter variable\">-n</span> <span class=\"token operator\">&lt;</span>namespace<span class=\"token operator\">></span></code></pre></div>\n<p><code class=\"language-text\">kubectl api-resources --verbs=list --namespaced -o name</code> retrieves all namespaced API resource types that support the list API verb. Then it outputs their names. Those names are then redirected to <code class=\"language-text\">xargs</code> as standard input.</p>\n<p><a href=\"https://www.baeldung.com/linux/xargs-multiple-arguments\" target=\"_blank\" rel=\"noopener noreferrer\"><code class=\"language-text\">xargs -n 1</code></a> singly passes each of those names as initial arguments to <code class=\"language-text\">kubectl get --ignore-not-found --show-kind -n &lt;namespace></code>. Then, the <code class=\"language-text\">kubectl get</code> command returns a list of resources belonging to each resource type in the specified namespace.</p>\n<h2 id=\"default-resources-and-limits-with-limitrange-and-resourcequotas-\" style=\"position:relative;\"><a href=\"#default-resources-and-limits-with-limitrange-and-resourcequotas-\" aria-label=\"default resources and limits with limitrange and resourcequotas  permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Default Resources and Limits with LimitRange and ResourceQuotas üö¶</h2>\n<p>In Kubernetes, namespaces provide a mechanism for isolating groups of resources within a single cluster. Namespaces are a way to divide cluster resources into groups for multiple users (via resource-quota). Each namespace will have one or multiple containers running inside it.</p>\n<p>After creating a namespace for each team within the cluster, consider that what if one team, i.e., namespace, consumes more resources from the cluster like CPU and memory, and other teams' resources starve for resources as the cluster has a very limited amount of available hardware resources. This creates a noisy neighbor problem within the cluster.</p>\n<p>To avoid this, as an administrator, first, you create a namespace within the cluster, and then you can use ResourceQuota and LimitRange to assign resource quotas on namespaces and set limits for containers running inside any namespace.</p>\n<h3 id=\"resource-quotas\" style=\"position:relative;\"><a href=\"#resource-quotas\" aria-label=\"resource quotas permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Resource Quotas</h3>\n<p>After creating namespaces, we can use the ResourceQuota object to limit the total amount of resources used by the namespace. We can use ResourceQuota to set limits for different object types that can be created within a namespace along with setting quotas for resources like CPU and memory.</p>\n<p>A ResourceQuota for setting a quota on resources looks like this:</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> v1\n<span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> ResourceQuota\n<span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> teamx<span class=\"token punctuation\">-</span>resource<span class=\"token punctuation\">-</span>quota\n    <span class=\"token key atrule\">namespace</span><span class=\"token punctuation\">:</span> teamx\n<span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">hard</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">limits.cpu</span><span class=\"token punctuation\">:</span> 150m\n        <span class=\"token key atrule\">limits.memory</span><span class=\"token punctuation\">:</span> 600Mi\n        <span class=\"token key atrule\">requests.cpu</span><span class=\"token punctuation\">:</span> 150m\n        <span class=\"token key atrule\">requests.memory</span><span class=\"token punctuation\">:</span> 600Mi</code></pre></div>\n<ul>\n<li><code class=\"language-text\">limits.cpu</code> is the maximum CPU limit for all the containers in the Namespace, i.e., the entire namespace.</li>\n<li><code class=\"language-text\">limits.memory</code> is the maximum Memory limit for all containers in the Namespace, i.e., the entire namespace.</li>\n<li><code class=\"language-text\">requests.cpu</code> is the maximum CPU requests for all the containers in the Namespace. As per the above YAML, the total requested CPU in the Namespace should be less than 150m.</li>\n<li><code class=\"language-text\">requests.memory</code> is the maximum Memory requests for all the containers in the Namespace. As per the above YAML, the total requested memory in the namespace should be less than 600Mi.</li>\n</ul>\n<h3 id=\"limitrange-for-containers\" style=\"position:relative;\"><a href=\"#limitrange-for-containers\" aria-label=\"limitrange for containers permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>LimitRange for Containers</h3>\n<p>We can create a LimitRange object in our Namespace which can be used to set limits on resources on containers running within the namespace. This is used to provide default limit values for Pods which do not specify this value themselves to equally distribute resources within a namespace.</p>\n<p>A LimitRange provides constraints that can:</p>\n<ul>\n<li>Apply minimum and maximum CPU resources usage limit per Pod or Container in a namespace.</li>\n<li>Apply minimum and maximum memory request limit per PersistentVolumeClaim in a namespace.</li>\n<li>Apply minimum and maximum CPU resources usage limit per Pod or Container in a namespace.</li>\n<li>Set default request/limit for resources within a namespace and then automatically set the limits to Containers at runtime.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> v1\n<span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> LimitRange\n<span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> teamx<span class=\"token punctuation\">-</span>limit<span class=\"token punctuation\">-</span>range\n<span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">limits</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">default</span><span class=\"token punctuation\">:</span>\n            <span class=\"token key atrule\">memory</span><span class=\"token punctuation\">:</span> 200Mi\n            <span class=\"token key atrule\">cpu</span><span class=\"token punctuation\">:</span> 50m\n        <span class=\"token key atrule\">defaultRequest</span><span class=\"token punctuation\">:</span>\n            <span class=\"token key atrule\">memory</span><span class=\"token punctuation\">:</span> 200Mi\n            <span class=\"token key atrule\">cpu</span><span class=\"token punctuation\">:</span> 50m\n        <span class=\"token key atrule\">max</span><span class=\"token punctuation\">:</span>\n            <span class=\"token key atrule\">memory</span><span class=\"token punctuation\">:</span> 200Mi\n            <span class=\"token key atrule\">cpu</span><span class=\"token punctuation\">:</span> 50m\n        <span class=\"token key atrule\">min</span><span class=\"token punctuation\">:</span>\n            <span class=\"token key atrule\">memory</span><span class=\"token punctuation\">:</span> 200Mi\n            <span class=\"token key atrule\">cpu</span><span class=\"token punctuation\">:</span> 50m\n        <span class=\"token key atrule\">type</span><span class=\"token punctuation\">:</span> Container</code></pre></div>\n<p>The above YAML file has 4 sections: <code class=\"language-text\">max</code>, <code class=\"language-text\">min</code>, <code class=\"language-text\">default</code>, and <code class=\"language-text\">defaultRequest</code>.</p>\n<ul>\n<li>The <code class=\"language-text\">default</code> section will set up the default limits for a container in a pod. Any container with no limits defined will get these values assigned as default.</li>\n<li>The <code class=\"language-text\">defaultRequest</code> section will set up the default requests for a container in a pod. Any container with no requests defined will get these values assigned as default.</li>\n<li>The <code class=\"language-text\">max</code> section will set up the maximum limits that a container in a Pod can set. The value specified in the <code class=\"language-text\">default</code> section cannot be higher than this value.</li>\n<li>The <code class=\"language-text\">min</code> section will set up the minimum requests that a container in a Pod can set. The value specified in the <code class=\"language-text\">defaultRequest</code> section cannot be lower than this value.</li>\n</ul>\n<h2 id=\"kubectl-debug\" style=\"position:relative;\"><a href=\"#kubectl-debug\" aria-label=\"kubectl debug permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>kubectl debug</h2>\n<p>One of the most forgotten but powerful <code class=\"language-text\">kubectl</code> commands is <code class=\"language-text\">debug</code>. It allows you to create a sidecar container on any pod, copy a pod to a new instance for debugging, and even access the pod's filesystem.</p>\n<h3 id=\"debugging-a-node-Ô∏è\" style=\"position:relative;\"><a href=\"#debugging-a-node-%EF%B8%8F\" aria-label=\"debugging a node Ô∏è permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Debugging a Node üñ•Ô∏è</h3>\n<p>Use the <code class=\"language-text\">kubectl debug node</code> command to deploy a Pod to a Node that you want to troubleshoot. This command is helpful in scenarios where you can't access your Node by using an SSH connection. When the Pod is created, the Pod opens an interactive shell on the Node. To create an interactive shell on a Node named <code class=\"language-text\">mynode</code>, run:</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">kubectl debug node/mynode <span class=\"token parameter variable\">-ti</span> <span class=\"token parameter variable\">--image</span><span class=\"token operator\">=</span>ubuntu -- <span class=\"token function\">chroot</span> /host <span class=\"token function\">bash</span></code></pre></div>\n<h3 id=\"adding-ephemeral-containers-\" style=\"position:relative;\"><a href=\"#adding-ephemeral-containers-\" aria-label=\"adding ephemeral containers  permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Adding Ephemeral Containers üê≥</h3>\n<p>You can also use the <code class=\"language-text\">kubectl debug</code> command to add ephemeral containers to a running Pod for debugging.</p>\n<p>First, create a pod for the example:</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">kubectl run ephemeral-demo <span class=\"token parameter variable\">--image</span><span class=\"token operator\">=</span>registry.k8s.io/pause:3.1 <span class=\"token parameter variable\">--restart</span><span class=\"token operator\">=</span>Never</code></pre></div>\n<p>The examples in this section use the <a href=\"https://registry.k8s.io/pause:3.1\" target=\"_blank\" rel=\"noopener noreferrer\">pause container image</a> because it does not contain debugging utilities, but this method works with all container images. If you attempt to use <code class=\"language-text\">kubectl exec</code> to create a shell, you will see an error because there is no shell in this container image.</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">kubectl <span class=\"token builtin class-name\">exec</span> <span class=\"token parameter variable\">-it</span> ephemeral-demo -- <span class=\"token function\">sh</span>\nOCI runtime <span class=\"token builtin class-name\">exec</span> failed: <span class=\"token builtin class-name\">exec</span> failed: container_linux.go:346: starting container process caused <span class=\"token string\">\"exec: <span class=\"token entity\" title=\"\\&quot;\">\\\"</span>sh<span class=\"token entity\" title=\"\\&quot;\">\\\"</span>: executable file not found in <span class=\"token environment constant\">$PATH</span>\"</span><span class=\"token builtin class-name\">:</span> unknown</code></pre></div>\n<p>You can instead add a debugging container using <code class=\"language-text\">kubectl debug</code>. If you specify the <code class=\"language-text\">-i/--interactive</code> argument, <code class=\"language-text\">kubectl</code> will automatically attach to the console of the Ephemeral Container.</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">kubectl debug <span class=\"token parameter variable\">-it</span> ephemeral-demo <span class=\"token parameter variable\">--image</span><span class=\"token operator\">=</span>busybox:1.28 <span class=\"token parameter variable\">--target</span><span class=\"token operator\">=</span>ephemeral-demo\nDefaulting debug container name to debugger-8xzrl.\nIf you don't see a <span class=\"token builtin class-name\">command</span> prompt, try pressing enter.\n/ <span class=\"token comment\">#</span></code></pre></div>\n<p>This command adds a new <code class=\"language-text\">busybox</code> container and attaches to it. The <code class=\"language-text\">--target</code> parameter targets the process namespace of another container. It's necessary here because <code class=\"language-text\">kubectl run</code> does not enable process namespace sharing in the pod it creates.</p>\n<h2 id=\"krew-the-plugin-marketplace-\" style=\"position:relative;\"><a href=\"#krew-the-plugin-marketplace-\" aria-label=\"krew the plugin marketplace  permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Krew: The Plugin Marketplace üöÄ</h2>\n<p>There's a massive marketplace of Kubectl plugins that can extend its functionality and make your life easier. Meet <a href=\"https://krew.sigs.k8s.io/docs/user-guide/setup/install/\" target=\"_blank\" rel=\"noopener noreferrer\">Krew</a>:</p>\n<p>Krew is the plugin manager for the <code class=\"language-text\">kubectl</code> command-line tool.</p>\n<p>Krew helps you:</p>\n<ul>\n<li>Discover <a href=\"https://kubernetes.io/docs/tasks/extend-kubectl/kubectl-plugins/\" target=\"_blank\" rel=\"noopener noreferrer\">kubectl plugins</a>,</li>\n<li>Install them on your machine,</li>\n<li>And keep the installed plugins up-to-date.</li>\n</ul>\n<p>There are 225 kubectl plugins currently distributed on Krew. Krew works across all major platforms, like macOS, Linux, and Windows.</p>\n<h2 id=\"prow-cicd-for-kubernetes-Ô∏è\" style=\"position:relative;\"><a href=\"#prow-cicd-for-kubernetes-%EF%B8%8F\" aria-label=\"prow cicd for kubernetes Ô∏è permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Prow: CI/CD for Kubernetes ‚öôÔ∏è</h2>\n<p>Kubernetes' Project CI/CD is powered by <a href=\"http://prow.k8s.io\" target=\"_blank\" rel=\"noopener noreferrer\">Prow</a>, an open-source CI system that can scale to hundreds of thousands of jobs.</p>\n<p>The Kubernetes Testing SIG describes Prow as \"a CI/CD system built on Kubernetes for Kubernetes that executes jobs for building, testing, publishing, and deploying.\" However, that description does not highlight perhaps the most important inferred capability of Prow‚Ää‚Äî‚Ääa capability that is at the heart of best-of-breed CI/CD automation tools‚Ää‚Äî‚Ääthat capability is automation that starts with code commits. In the case of Prow, it starts with a scalable stateless microservice called <a href=\"https://github.com/kubernetes/test-infra/blob/master/prow/cmd/README.md#core-components\" target=\"_blank\" rel=\"noopener noreferrer\">hook</a> that triggers native K8s CI/CD jobs (among a number of things that hook does via <a href=\"https://github.com/kubernetes/test-infra/tree/master/prow/plugins\" target=\"_blank\" rel=\"noopener noreferrer\">plugins</a>).</p>\n<p>It is this GitHub automation capability that has been one of the key reasons why other K8s projects have adopted Prow for their own CI/CD. But Prow is more than just GitHub webhook automation and CI/CD job execution. Prow is also:</p>\n<ul>\n<li><strong>Comprehensive GitHub Automation</strong></li>\n<li><strong>ChatOps</strong> <a href=\"https://prow.k8s.io/command-help\" target=\"_blank\" rel=\"noopener noreferrer\">via simple /foo commands</a></li>\n<li><strong>Fine-grained GitHub policy and permission management</strong> via <a href=\"https://github.com/kubernetes/community/blob/master/contributors/guide/owners.md\" target=\"_blank\" rel=\"noopener noreferrer\">OWNERS files</a></li>\n<li><strong>GitHub PR/merge automation</strong>‚Ää‚Äî‚Ää<a href=\"https://github.com/kubernetes/test-infra/tree/master/prow/cmd/tide\" target=\"_blank\" rel=\"noopener noreferrer\">tide</a></li>\n<li><strong>GitHub API request cache</strong> to minimize the impact of GitHub API limits‚Ää‚Äî‚Ää<a href=\"https://github.com/kubernetes/test-infra/tree/master/ghproxy\" target=\"_blank\" rel=\"noopener noreferrer\">ghProxy</a></li>\n<li><strong>GitHub Organization and repository membership and permissions management</strong>‚Ää‚Äî‚Ää<a href=\"https://github.com/kubernetes/test-infra/tree/master/prow/cmd/peribolos\" target=\"_blank\" rel=\"noopener noreferrer\">peribolos</a></li>\n<li><strong>GitHub labels management</strong>‚Ää‚Äî‚Ää<a href=\"https://github.com/kubernetes/test-infra/tree/master/prow/plugins/label\" target=\"_blank\" rel=\"noopener noreferrer\">label plugin</a></li>\n<li><strong>GitHub branch protection configuration</strong>‚Ää‚Äî‚Ää<a href=\"https://github.com/kubernetes/test-infra/tree/master/prow/cmd/branchprotector\" target=\"_blank\" rel=\"noopener noreferrer\">branchprotector</a></li>\n<li><strong>GitHub release notes management</strong>‚Ää‚Äî‚Ää<a href=\"https://github.com/kubernetes/test-infra/tree/master/prow/plugins/releasenote\" target=\"_blank\" rel=\"noopener noreferrer\">releasenote</a></li>\n<li><strong>Scalable, cacheable</strong> <a href=\"https://github.com/kubernetes/test-infra/blob/master/prow/scaling.md#github-api-cache\" target=\"_blank\" rel=\"noopener noreferrer\">GitHub API cache</a></li>\n<li><strong>GitHub bot</strong> with <a href=\"https://github.com/k8s-ci-robot\" target=\"_blank\" rel=\"noopener noreferrer\">Prow's bot being an active GitHub user since 2016</a></li>\n<li><strong>Multi-engine CI/CD Job Execution</strong>‚Ää‚Äî‚Ää<a href=\"https://github.com/kubernetes/test-infra/tree/master/prow/cmd/plank\" target=\"_blank\" rel=\"noopener noreferrer\">plank</a></li>\n<li><strong>CI/CD Reporting</strong>‚Ää‚Äî‚Ää<a href=\"https://github.com/kubernetes/test-infra/tree/master/prow/cmd/crier\" target=\"_blank\" rel=\"noopener noreferrer\">crier</a></li>\n<li><strong>CI/CD Dashboards</strong> for viewing job history, merge status, and more‚Ää‚Äî‚Ää<a href=\"https://github.com/kubernetes/test-infra/tree/master/prow/cmd/deck\" target=\"_blank\" rel=\"noopener noreferrer\">deck</a></li>\n<li><strong>Pluggable Artifact Viewer</strong>‚Ää‚Äî‚Ää<a href=\"https://github.com/kubernetes/test-infra/tree/master/prow/spyglass\" target=\"_blank\" rel=\"noopener noreferrer\">Spyglass</a></li>\n<li><strong>Prometheus Metrics</strong> for monitoring and alerting‚Ää‚Äî‚Ää<a href=\"https://github.com/kubernetes/test-infra/tree/master/prow/metrics\" target=\"_blank\" rel=\"noopener noreferrer\">metrics</a></li>\n<li><strong>Config-as-Code for Its Own Configuration</strong>‚Ää‚Äî‚Ää<a href=\"https://github.com/kubernetes/test-infra/tree/master/prow/plugins/updateconfig\" target=\"_blank\" rel=\"noopener noreferrer\">updateconfig</a></li>\n</ul>\n<p>And I am sure I am still missing a bunch of things‚Ää‚Äî‚Äälike <a href=\"https://github.com/kubernetes/test-infra/tree/master/prow/plugins/cat\" target=\"_blank\" rel=\"noopener noreferrer\">cats</a> and <a href=\"https://github.com/kubernetes/test-infra/tree/master/prow/plugins/dog\" target=\"_blank\" rel=\"noopener noreferrer\">dogs</a>.</p>\n<h2 id=\"extending-kubernetes-api-\" style=\"position:relative;\"><a href=\"#extending-kubernetes-api-\" aria-label=\"extending kubernetes api  permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Extending Kubernetes API üöÄ</h2>\n<p>Did you know you can extend the Kubernetes API itself? Meet the <a href=\"https://kubernetes.io/docs/concepts/extend-kubernetes/api-extension/apiserver-aggregation/\" target=\"_blank\" rel=\"noopener noreferrer\">Kubernetes API Aggregator Layer</a>, a powerful tool for introducing subresources or aggregating them, like the custom metrics server.</p>\n<p>The aggregation layer enables installing additional Kubernetes-style APIs in your cluster. These can either be pre-built, existing 3rd party solutions, such as <a href=\"https://github.com/kubernetes-incubator/service-catalog/blob/master/README.md\" target=\"_blank\" rel=\"noopener noreferrer\">service-catalog</a>, or user-created APIs like <a href=\"https://github.com/kubernetes-incubator/apiserver-builder/blob/master/README.md\" target=\"_blank\" rel=\"noopener noreferrer\">apiserver-builder</a>, which can get you started.</p>\n<h2 id=\"auto-provisioning-namespaces-Ô∏è\" style=\"position:relative;\"><a href=\"#auto-provisioning-namespaces-%EF%B8%8F\" aria-label=\"auto provisioning namespaces Ô∏è permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Auto-Provisioning Namespaces üõ†Ô∏è</h2>\n<p>There's an easy way to auto-provision namespaces without giving extra permissions to your users. Use the <a href=\"https://kubernetes.io/docs/reference/access-authn-authz/admission-controllers/#namespaceautoprovision\" target=\"_blank\" rel=\"noopener noreferrer\">NamespaceAutoProvision Admission controller</a>.</p>\n<p>This admission controller examines all incoming requests on namespaced resources and checks if the referenced namespace exists. It creates a namespace if it cannot be found. This admission controller is useful in deployments that do not want to restrict the creation of a namespace prior to its usage.</p>\n<h2 id=\"enforcing-customrules\" style=\"position:relative;\"><a href=\"#enforcing-customrules\" aria-label=\"enforcing customrules permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Enforcing Custom¬†Rules</h2>\n<p>Kubernetes offers a simple way to intercept and validate requests with ValidatingAdmissionWebhooks and MutatingAdmissionWebhooks.</p>\n<p><a href=\"https://github.com/slackhq/simple-kubernetes-webhook\" target=\"_blank\" rel=\"noopener noreferrer\">This</a> is a simple <a href=\"https://kubernetes.io/docs/reference/access-authn-authz/extensible-admission-controllers/\" target=\"_blank\" rel=\"noopener noreferrer\">Kubernetes admission webhook</a>. It is meant to be used as a validating and mutating admission webhook only and does not support any controller logic.</p>\n<p>It has been developed as a simple Go web service without using any framework or <code class=\"language-text\">boilerplate</code> such as <code class=\"language-text\">kubebuilder</code>.</p>\n<p>This project is aimed at illustrating how to build a fully functioning admission webhook in the simplest way possible. Most existing examples found on the web rely on heavy machinery using powerful frameworks, yet fail to illustrate how to implement a lightweight webhook that can do much-needed actions such as rejecting a pod for compliance reasons or injecting helpful environment variables.</p>\n<h2 id=\"dynamic-resource-allocation-\" style=\"position:relative;\"><a href=\"#dynamic-resource-allocation-\" aria-label=\"dynamic resource allocation  permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Dynamic Resource Allocation üöÄ</h2>\n<p>Allocate resources outside your cluster with Dynamic <a href=\"https://kubernetes.io/blog/2022/12/15/dynamic-resource-allocation/\" target=\"_blank\" rel=\"noopener noreferrer\">Resource Allocation</a>. Since K8s v1.26, use <strong>ResourceClass</strong> and <strong>ResourceClaims</strong> to extend offerings beyond the cluster.</p>\n<p>In contrast to native resources (such as CPU or RAM) and <a href=\"https://kubernetes.io/docs/concepts/configuration/manage-resources-containers/#extended-resources\" target=\"_blank\" rel=\"noopener noreferrer\">extended resources</a> (managed by a device plugin, advertised by kubelet), the scheduler has no knowledge of what dynamic resources are available in a cluster or how they could be split up to satisfy the requirements of a specific ResourceClaim. Resource drivers are responsible for that.</p>\n<p>Drivers mark <strong>ResourceClaims</strong> as allocated once resources for it are reserved. This also then tells the scheduler where in the cluster a claimed resource is actually available.</p>\n<p><strong>ResourceClaims</strong> can get resources allocated as soon as the ResourceClaim is created (immediate allocation), without considering which Pods will use the resource. The default (wait for first consumer) is to delay allocation until a Pod that relies on the ResourceClaim becomes eligible for scheduling. This design with two allocation options is similar to how Kubernetes handles storage provisioning with PersistentVolumes and PersistentVolumeClaims.</p>\n<h2 id=\"managing-requests-in-the-kubernetes-api-\" style=\"position:relative;\"><a href=\"#managing-requests-in-the-kubernetes-api-\" aria-label=\"managing requests in the kubernetes api  permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Managing Requests in the Kubernetes API üìú</h2>\n<p>In Kubernetes, request queue management is handled by <a href=\"https://kubernetes.io/docs/concepts/cluster-administration/flow-control\" target=\"_blank\" rel=\"noopener noreferrer\">API Priority and Fairness (APF)</a>. It is enabled by default in Kubernetes 1.20 and beyond. The API server also provides two parameters, <code class=\"language-text\">--max-requests-inflight</code> (default is 400) and <code class=\"language-text\">--max-mutating-requests-inflight</code> (default is 200), for limiting the number of requests. If APF is enabled, both of these parameters are summed up‚Ää‚Äî‚Ääand that's how the API server's total concurrency limit is defined.</p>\n<p>That said, there are some finer details to account for:</p>\n<ul>\n<li>Long-running API requests (e.g., viewing logs or executing commands in a pod) are not subject to APF limits, and neither are WATCH requests.</li>\n<li>There is also a special predefined priority level called exempt. Requests from this level are processed immediately.</li>\n</ul>\n<p>So you can fine-tune how the Kubernetes API server queues and handles requests to prioritize essential requests and manage latency effectively.</p>\n<h3 id=\"api-priority-with-code-classlanguage-textkubectlcode\" style=\"position:relative;\"><a href=\"#api-priority-with-code-classlanguage-textkubectlcode\" aria-label=\"api priority with code classlanguage textkubectlcode permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>API Priority with <code class=\"language-text\">kubectl</code></h3>\n<p>You can explore how busy your Kubernetes API server is by examining the Priority Level queue. With the APIPriorityAndFairness feature enabled, the kube-apiserver serves the following additional paths at its HTTP(S) ports. You need to ensure you have permissions to access these endpoints. You don't have to do anything if you are using admin. Permissions can be granted if needed following the RBAC doc to access <code class=\"language-text\">/debug/api_priority_and_fairness/</code> by specifying nonResourceURLs.</p>\n<ul>\n<li>\n<p><code class=\"language-text\">/debug/api_priority_and_fairness/dump_priority_levels</code> - a listing of all the priority levels and the current state of each. You can fetch like this:</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">kubectl get <span class=\"token parameter variable\">--raw</span> /debug/api_priority_and_fairness/dump_priority_levels</code></pre></div>\n<p>The output will be in CSV and similar to this:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">PriorityLevelName, ActiveQueues, IsIdle, IsQuiescing, WaitingRequests, ExecutingRequests, DispatchedRequests, RejectedRequests, TimedoutRequests, CancelledRequests\ncatch-all,         0,            true,   false,       0,               0,                 1,                  0,                0,                0\nexempt,            0,            true,   false,       0,               0,                 0,                  0,                0,                0\nglobal-default,    0,            true,   false,       0,               0,                 46,                 0,                0,                0\nleader-election,   0,            true,   false,       0,               0,                 4,                  0,                0,                0\nnode-high,         0,            true,   false,       0,               0,                 34,                 0,                0,                0\nsystem,            0,            true,   false,       0,               0,                 48,                 0,                0,                0\nworkload-high,     0,            true,   false,       0,               0,                 500,                0,                0,                0\nworkload-low,      0,            true,   false,       0,               0,                 0,                  0,                0,                0</code></pre></div>\n</li>\n<li>\n<p><code class=\"language-text\">/debug/api_priority_and_fairness/dump_queues</code> - a listing of all the queues and their current state. You can fetch like this:</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">kubectl get <span class=\"token parameter variable\">--raw</span> /debug/api_priority_and_fairness/dump_queues</code></pre></div>\n<p>The output will be in CSV and similar to this:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">PriorityLevelName, Index,  PendingRequests, ExecutingRequests, SeatsInUse, NextDispatchR,   InitialSeatsSum, MaxSeatsSum, TotalWorkSum\nworkload-low,      14,     27,              0,                 0,          77.64342019ss,   270,             270,         0.81000000ss\nworkload-low,      74,     26,              0,                 0,          76.95387841ss,   260,             260,         0.78000000ss\n...\nleader-election,   0,      0,               0,                 0,          5088.87053833ss, 0,               0,           0.00000000ss\nleader-election,   1,      0,               0,                 0,          0.00000000ss,    0,               0,           0.00000000ss\n...\nworkload-high,     0,      0,               0,                 0,          0.00000000ss,    0,               0,           0.00000000ss\nworkload-high,     1,      0,               0,                 0,          1119.44936475ss, 0,               0,           0.00000000ss</code></pre></div>\n</li>\n<li>\n<p><code class=\"language-text\">/debug/api_priority_and_fairness/dump_requests</code> - a listing of all the requests including requests waiting in a queue and requests being executed. You can fetch like this:</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">kubectl get <span class=\"token parameter variable\">--raw</span> /debug/api_priority_and_fairness/dump_requests</code></pre></div>\n<p>The output will be in CSV and similar to this:</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">PriorityLevelName, FlowSchemaName,   QueueIndex, RequestIndexInQueue, FlowDistingsher,                        ArriveTime,                     InitialSeats, FinalSeats, AdditionalLatency, StartTime\nexempt,            exempt,           -1,         -1,                  ,                                       <span class=\"token number\">2023</span>-07-15T04:51:25.596404345Z, <span class=\"token number\">1</span>,            <span class=\"token number\">0</span>,          0s,                <span class=\"token number\">2023</span>-07-15T04:51:25.596404345Z\nworkload-low,      service-accounts, <span class=\"token number\">14</span>,         <span class=\"token number\">0</span>,                   system:serviceaccount:default:loadtest, <span class=\"token number\">2023</span>-07-18T00:12:51.386556253Z, <span class=\"token number\">10</span>,           <span class=\"token number\">0</span>,          0s,                0001-01-01T00:00:00Z\nworkload-low,      service-accounts, <span class=\"token number\">14</span>,         <span class=\"token number\">1</span>,                   system:serviceaccount:default:loadtest, <span class=\"token number\">2023</span>-07-18T00:12:51.487092539Z, <span class=\"token number\">10</span>,           <span class=\"token number\">0</span>,          0s,                0001-01-01T00:00:00Z</code></pre></div>\n</li>\n</ul>\n<h2 id=\"manually-triggering-pod-evictions-\" style=\"position:relative;\"><a href=\"#manually-triggering-pod-evictions-\" aria-label=\"manually triggering pod evictions  permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Manually Triggering Pod Evictions üö®</h2>\n<p>A safer alternative to deleting pods is using evictions, because they respect pod disruption budgets and other termination policies. You can manually trigger a pod eviction using the Kubernetes eviction API.</p>\n<p>Create a file called <code class=\"language-text\">eviction.json</code> with content similar to this:</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"apiVersion\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"policy/v1\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"kind\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Eviction\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"metadata\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token property\">\"name\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"pod-name-here\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token property\">\"namespace\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"default\"</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>And run this command:</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token function\">curl</span> <span class=\"token parameter variable\">-v</span> <span class=\"token parameter variable\">-H</span> <span class=\"token string\">'Content-type: application/json'</span> https://your-cluster-api-endpoint.example/api/v1/namespaces/default/pods/pod-name-here/eviction <span class=\"token parameter variable\">-d</span> @eviction.json</code></pre></div>\n<h2 id=\"pod-overhead-Ô∏èÔ∏è\" style=\"position:relative;\"><a href=\"#pod-overhead-%EF%B8%8F%EF%B8%8F\" aria-label=\"pod overhead Ô∏èÔ∏è permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Pod Overhead üèãÔ∏è‚Äç‚ôÇÔ∏è</h2>\n<p>When you run a Pod on a Node, the Pod itself takes an amount of system resources. These resources are additional to the resources needed to run the container(s) inside the Pod. In Kubernetes, Pod Overhead is a way to account for the resources consumed by the Pod infrastructure on top of the container requests &#x26; limits.</p>\n<p>In Kubernetes, the Pod's overhead is set at <a href=\"https://kubernetes.io/docs/reference/access-authn-authz/extensible-admission-controllers/#what-are-admission-webhooks\" target=\"_blank\" rel=\"noopener noreferrer\">admission</a> time according to the overhead associated with the Pod's <a href=\"https://kubernetes.io/docs/concepts/containers/runtime-class/\" target=\"_blank\" rel=\"noopener noreferrer\">RuntimeClass</a>.</p>\n<p>A pod's overhead is considered in addition to the sum of container resource requests when scheduling a Pod. Similarly, the kubelet will include the Pod overhead when sizing the Pod cgroup, and when carrying out Pod eviction ranking. You need to make sure a RuntimeClass is utilized which defines the overhead field.</p>\n<p>To work with Pod overhead, you need a RuntimeClass that defines the overhead field. As an example, you could use the following RuntimeClass definition with a virtualization container runtime that uses around 120MiB per Pod for the virtual machine and the guest OS:</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> node.k8s.io/v1\n<span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> RuntimeClass\n<span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> kata<span class=\"token punctuation\">-</span>fc\n<span class=\"token key atrule\">handler</span><span class=\"token punctuation\">:</span> kata<span class=\"token punctuation\">-</span>fc\n<span class=\"token key atrule\">overhead</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">podFixed</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">memory</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"120Mi\"</span>\n        <span class=\"token key atrule\">cpu</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"250m\"</span></code></pre></div>\n<p>Workloads which are created which specify the kata-fc RuntimeClass handler will take the memory and cpu overheads into account for resource quota calculations, node scheduling, as well as Pod cgroup sizing.</p>\n<p>Consider running the given example workload, <code class=\"language-text\">test-pod</code>:</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> v1\n<span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> Pod\n<span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> test<span class=\"token punctuation\">-</span>pod\n<span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">runtimeClassName</span><span class=\"token punctuation\">:</span> kata<span class=\"token punctuation\">-</span>fc\n    <span class=\"token key atrule\">containers</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> busybox<span class=\"token punctuation\">-</span>ctr\n        <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> busybox<span class=\"token punctuation\">:</span><span class=\"token number\">1.28</span>\n        <span class=\"token key atrule\">stdin</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span>\n        <span class=\"token key atrule\">tty</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span>\n        <span class=\"token key atrule\">resources</span><span class=\"token punctuation\">:</span>\n            <span class=\"token key atrule\">limits</span><span class=\"token punctuation\">:</span>\n                <span class=\"token key atrule\">cpu</span><span class=\"token punctuation\">:</span> 500m\n                <span class=\"token key atrule\">memory</span><span class=\"token punctuation\">:</span> 100Mi\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> nginx<span class=\"token punctuation\">-</span>ctr\n        <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> nginx\n        <span class=\"token key atrule\">resources</span><span class=\"token punctuation\">:</span>\n            <span class=\"token key atrule\">limits</span><span class=\"token punctuation\">:</span>\n                <span class=\"token key atrule\">cpu</span><span class=\"token punctuation\">:</span> 1500m\n                <span class=\"token key atrule\">memory</span><span class=\"token punctuation\">:</span> 100Mi</code></pre></div>\n<p>At admission time the RuntimeClass admission controller updates the workload's PodSpec to include the overhead as described in the RuntimeClass. If the PodSpec already has this field defined, the Pod will be rejected. In the given example, since only the RuntimeClass name is specified, the admission controller mutates the Pod to include an overhead.</p>\n<p>After the RuntimeClass admission controller has made modifications, you can check the updated Pod overhead value:</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">kubectl get pod test-pod <span class=\"token parameter variable\">-o</span> <span class=\"token assign-left variable\">jsonpath</span><span class=\"token operator\">=</span><span class=\"token string\">'{.spec.overhead}'</span></code></pre></div>\n<p>The output is:</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\">map<span class=\"token punctuation\">[</span>cpu<span class=\"token operator\">:</span>250m memory<span class=\"token operator\">:</span>120Mi<span class=\"token punctuation\">]</span></code></pre></div>\n<h2 id=\"future-enhancements-\" style=\"position:relative;\"><a href=\"#future-enhancements-\" aria-label=\"future enhancements  permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Future Enhancements üîÆ</h2>\n<p>All the future enhancements to the Kubernetes-adjacent projects are publicly available and maintained in git. You can find it <a href=\"https://github.com/kubernetes/enhancements/tree/master/keps\" target=\"_blank\" rel=\"noopener noreferrer\">here</a>. If you have any good idea (and the resources to make it a reality), you can even submit your own!</p>\n<br>\n<p><strong><em>Until next time, „Å§„Å•„Åè üéâ</em></strong></p>\n<blockquote>\n<p>üí° Thank you for Reading !! üôåüèªüòÅüìÉ, see you in the next blog.ü§ò  <strong><em>Until next time üéâ</em></strong></p>\n</blockquote>\n<p>üöÄ Thank you for sticking up till the end. If you have any questions/feedback regarding this blog feel free to connect with me:</p>\n<p><strong>‚ôªÔ∏è LinkedIn:</strong> <a href=\"https://www.linkedin.com/in/rajhi-saif/\" target=\"_blank\" rel=\"noopener noreferrer\">https://www.linkedin.com/in/rajhi-saif/</a></p>\n<p><strong>‚ôªÔ∏è X/Twitter:</strong> <a href=\"https://x.com/rajhisaifeddine\" target=\"_blank\" rel=\"noopener noreferrer\">https://x.com/rajhisaifeddine</a></p>\n<p><strong>The end ‚úåüèª</strong></p>\n<h1 align=\"center\">üî∞ Keep Learning !! Keep Sharing !! üî∞</h1>\n<p><strong>üìÖ Stay updated</strong></p>\n<p>Subscribe to our newsletter for more insights on AWS cloud computing and containers.</p>"}}},"staticQueryHashes":["1271460761","1321585977"],"slicesMap":{}}