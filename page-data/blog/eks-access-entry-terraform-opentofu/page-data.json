{"componentChunkName":"component---src-templates-blog-template-js","path":"/blog/eks-access-entry-terraform-opentofu/","result":{"data":{"markdownRemark":{"html":"<blockquote>\n<p><strong>Setting up EKS authentication and authorization using Infrastructure as Code</strong></p>\n</blockquote>\n<h2 id=\"-introduction\" style=\"position:relative;\"><a href=\"#-introduction\" aria-label=\" introduction permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üìö Introduction</h2>\n<p>Managing who can access your AWS EKS clusters can be tricky, especially in big companies. Usually, the person who creates the EKS cluster has full control. But this can be a problem for security and management. AWS EKS has new controls called access entries to help manage who can access your Kubernetes clusters more easily.</p>\n<p>In this blog, we will show you how to use Terraform and OpenTofu to set up access entries for your AWS EKS clusters. We will explain what access entries are, the different options you can use, and how this new method makes it easier to manage who can access your clusters.</p>\n<h2 id=\"the-need-for-eks-access-entries\" style=\"position:relative;\"><a href=\"#the-need-for-eks-access-entries\" aria-label=\"the need for eks access entries permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>The Need for EKS access entries</h2>\n<p>Traditionally, we used a special <code class=\"language-text\">aws-auth</code> <a href=\"https://docs.aws.amazon.com/eks/latest/userguide/auth-configmap.html\" target=\"_blank\" rel=\"noopener noreferrer\">ConfigMap</a> to define the IAM roles for worker nodes, users, roles, and groups. This method required manual updates and was prone to errors, making it difficult to manage access at scale.</p>\n<p>With the introduction of Access Entries, AWS has provided a more streamlined and efficient way to manage access to EKS clusters. Now, we can manage access directly through the <a href=\"https://awscli.amazonaws.com/v2/documentation/api/latest/reference/eks/index.html\" target=\"_blank\" rel=\"noopener noreferrer\">EKS API</a> using AWS IAM as an authenticator. This means that when a user logs in to AWS, AWS handles the authentication, verifying the user's identity. When the user connects to Kubernetes, Kubernetes handles the authorization, checking the user's permissions within the cluster.</p>\n<p>This new approach integrates seamlessly with <a href=\"https://kubernetes.io/docs/reference/access-authn-authz/rbac/\" target=\"_blank\" rel=\"noopener noreferrer\">Kubernetes' RBAC</a> (Role-Based Access Control), providing a more robust and flexible access management system. One significant improvement is the ability to remove the \"default root user\" ‚Äì the hidden cluster administrator created by default. Previously, this user could not be seen or changed, which sometimes caused issues.</p>\n<p>By moving access control to a dedicated infrastructure as code, we can manage access more easily and with less risk. In the old system, there was a chance you would lose cluster access if you deleted the cluster owner. Now, other users can add IAM principals to access the cluster through APIs, making it easier to manage access with <a href=\"https://aws.amazon.com/what-is/iac/#:~:text=Infrastructure%20as%20code%20(IaC)%20is%20used%20for%20infrastructure%20automation%20to,to%20set%20up%20infrastructure%20environments.\" target=\"_blank\" rel=\"noopener noreferrer\">Infrastructure as Code (IaC) tools</a> like <a href=\"https://opentofu.org/\" target=\"_blank\" rel=\"noopener noreferrer\">OpenTofu</a>, <a href=\"https://www.terraform.io/\" target=\"_blank\" rel=\"noopener noreferrer\">Terraform</a>, <a href=\"https://www.pulumi.com/\" target=\"_blank\" rel=\"noopener noreferrer\">Pulumi</a>, <a href=\"https://docs.ansible.com/ansible-core/devel/getting_started/index.html\" target=\"_blank\" rel=\"noopener noreferrer\">Ansible</a>, and <a href=\"https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/Welcome.html\" target=\"_blank\" rel=\"noopener noreferrer\">CloudFormation</a>.</p>\n<div class=\"note\">\n    <p><strong>üîµ Note:</strong></p>\n    <p>Access Entries also provide predefined access policies that can be assigned to IAM principals outside the cluster through EKS APIs. This allows users to access cluster resources without needing to define RBAC resources inside the Kubernetes cluster, simplifying the management process and enhancing security.</p>\n</div>\n<h2 id=\"Ô∏è-legacy-access-management-iam-and-aws-auth-configmaps\" style=\"position:relative;\"><a href=\"#%EF%B8%8F-legacy-access-management-iam-and-aws-auth-configmaps\" aria-label=\"Ô∏è legacy access management iam and aws auth configmaps permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>‚öõÔ∏è Legacy access management: IAM and aws-auth ConfigMaps</h2>\n<div class=\"caution\">\n    <p><strong>üö´ Caution:</strong></p>\n    <p>The aws-auth ConfigMap is deprecated.</p>\n</div>\n<p>In the early days of AWS EKS, managing access to Kubernetes clusters was primarily done through AWS IAM roles and the <code class=\"language-text\">aws-auth</code> ConfigMap. This method involved mapping IAM users and roles to Kubernetes RBAC (Role-Based Access Control) roles and groups. The <code class=\"language-text\">aws-auth</code> ConfigMap was a critical component in this setup, serving as the bridge between AWS IAM and Kubernetes RBAC.</p>\n<h3 id=\"detailed-explanation-of-the-aws-auth-configmap\" style=\"position:relative;\"><a href=\"#detailed-explanation-of-the-aws-auth-configmap\" aria-label=\"detailed explanation of the aws auth configmap permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Detailed explanation of the aws-auth ConfigMap</h3>\n<p>The <code class=\"language-text\">aws-auth</code> ConfigMap is a Kubernetes configuration map that resides in the <code class=\"language-text\">kube-system</code> namespace of an EKS cluster. It contains mappings that associate AWS IAM roles and users with Kubernetes RBAC roles and groups.</p>\n<p>Here is an example of what the <code class=\"language-text\">aws-auth</code> ConfigMap might look like:</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> v1\n<span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> ConfigMap\n<span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> aws<span class=\"token punctuation\">-</span>auth\n  <span class=\"token key atrule\">namespace</span><span class=\"token punctuation\">:</span> kube<span class=\"token punctuation\">-</span>system\n<span class=\"token key atrule\">data</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">mapRoles</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">|</span><span class=\"token scalar string\">\n    - rolearn: arn:aws:iam::123456789012:role/EKS-NodeInstanceRole\n      username: system:node:{{EC2PrivateDNSName}}\n      groups:\n        - system:bootstrappers\n        - system:nodes</span>\n  <span class=\"token key atrule\">mapUsers</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">|</span><span class=\"token scalar string\">\n    - userarn: arn:aws:iam::123456789012:user/admin\n      username: admin\n      groups:\n        - system:masters</span>\n  <span class=\"token key atrule\">mapAccounts</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">|</span><span class=\"token scalar string\">\n    - \"123456789012\"</span></code></pre></div>\n<p><strong>Components of the aws-auth ConfigMap</strong></p>\n<ol>\n<li><strong>mapRoles</strong>: This section maps IAM roles to Kubernetes usernames and groups. For example, the <code class=\"language-text\">EKS-NodeInstanceRole</code> is mapped to the <code class=\"language-text\">system:nodes</code> group, which grants the necessary permissions for node operations.</li>\n<li><strong>mapUsers</strong>: This section maps IAM users to Kubernetes usernames and groups. For instance, the <code class=\"language-text\">admin</code> user is mapped to the <code class=\"language-text\">system:masters</code> group, granting cluster admin privileges.</li>\n<li><strong>mapAccounts</strong>: This optional section allows specifying AWS account IDs that are trusted to authenticate to the cluster.</li>\n</ol>\n<h3 id=\"issues-and-challenges-with-using-iam-and-configmap-for-access-management\" style=\"position:relative;\"><a href=\"#issues-and-challenges-with-using-iam-and-configmap-for-access-management\" aria-label=\"issues and challenges with using iam and configmap for access management permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Issues and Challenges with Using IAM and ConfigMap for Access Management</h3>\n<p>While the <code class=\"language-text\">aws-auth</code> ConfigMap provided a way to manage access, it came with several challenges:</p>\n<ol>\n<li><strong>Manual updates</strong>: Any changes to access control required manual updates to the <code class=\"language-text\">aws-auth</code> ConfigMap. This process was error-prone and could lead to misconfigurations.</li>\n<li><strong>Scalability</strong>: Managing access for a large number of users and roles became cumbersome. Each change required editing the ConfigMap, which was not scalable in large environments.</li>\n<li><strong>Risk of misconfiguration</strong>: A single mistake in the ConfigMap could break access control, potentially locking out users or granting unintended permissions.</li>\n<li><strong>Lack of visibility</strong>: The <code class=\"language-text\">aws-auth</code> ConfigMap did not provide a clear way to audit or track changes, making it difficult to maintain security and compliance.</li>\n<li><strong>Cluster owner issues</strong>: The default cluster creator had full admin rights, and there was no straightforward way to change the cluster owner. Deleting the cluster owner could result in losing access to the cluster.</li>\n</ol>\n<h3 id=\"a-real-world-scenario\" style=\"position:relative;\"><a href=\"#a-real-world-scenario\" aria-label=\"a real world scenario permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>A real world scenario</h3>\n<p>Consider a scenario where you need to add a new IAM user to the <code class=\"language-text\">system:masters</code> group for admin access. You would need to manually edit the <code class=\"language-text\">aws-auth</code> ConfigMap as follows:</p>\n<ol>\n<li>\n<p>Retrieve the current <code class=\"language-text\">aws-auth</code> ConfigMap:</p>\n</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">    kubectl get configmap aws-auth <span class=\"token parameter variable\">-n</span> kube-system <span class=\"token parameter variable\">-o</span> yaml <span class=\"token operator\">></span> aws-auth.yaml</code></pre></div>\n<ol start=\"2\">\n<li>Edit the <code class=\"language-text\">aws-auth.yaml</code> file to add the new user:</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\">    <span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> v1\n    <span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> ConfigMap\n    <span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> aws<span class=\"token punctuation\">-</span>auth\n      <span class=\"token key atrule\">namespace</span><span class=\"token punctuation\">:</span> kube<span class=\"token punctuation\">-</span>system\n    <span class=\"token key atrule\">data</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">mapRoles</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">|</span><span class=\"token scalar string\">\n        - rolearn: arn:aws:iam::123456789012:role/EKS-NodeInstanceRole\n          username: system:node:{{EC2PrivateDNSName}}\n          groups:\n            - system:bootstrappers\n            - system:nodes</span>\n      <span class=\"token key atrule\">mapUsers</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">|</span><span class=\"token scalar string\">\n        - userarn: arn:aws:iam::123456789012:user/admin\n          username: admin\n          groups:\n            - system:masters\n        - userarn: arn:aws:iam::123456789012:user/new-admin\n          username: new-admin\n          groups:\n            - system:masters</span>\n      <span class=\"token key atrule\">mapAccounts</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">|</span><span class=\"token scalar string\">\n        - \"123456789012\"</span></code></pre></div>\n<ol start=\"3\">\n<li>\n<p>Apply the updated ConfigMap:</p>\n</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">    kubectl apply <span class=\"token parameter variable\">-f</span> aws-auth.yaml</code></pre></div>\n<p>This manual process is prone to errors and does not scale well, highlighting the need for a more efficient access management solution.</p>\n<h2 id=\"eks-api-the-new-way-of-granting-access\" style=\"position:relative;\"><a href=\"#eks-api-the-new-way-of-granting-access\" aria-label=\"eks api the new way of granting access permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>EKS API: The New Way of Granting Access</h2>\n<p>AWS has introduced a new way to manage access to EKS clusters using the EKS API. This method allows you to manage access entries directly through the API, making use of AWS IAM for authentication. This new approach simplifies the process of managing who can access your Kubernetes clusters and integrates seamlessly with Kubernetes' RBAC (Role-Based Access Control).</p>\n<h3 id=\"enabling-access-entries\" style=\"position:relative;\"><a href=\"#enabling-access-entries\" aria-label=\"enabling access entries permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Enabling Access entries</h3>\n<p>To enable Access Entries on new or existing clusters, you need to use the latest version of the AWS CLI, which includes the <code class=\"language-text\">--access-config</code> option in the EKS create/update commands. Here‚Äôs how you can enable Access Entries:</p>\n<h4 id=\"creating-a-new-cluster-with-access-entries\" style=\"position:relative;\"><a href=\"#creating-a-new-cluster-with-access-entries\" aria-label=\"creating a new cluster with access entries permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Creating a New cluster with Access entries</h4>\n<div class=\"gatsby-highlight\" data-language=\"sh\"><pre class=\"language-sh\"><code class=\"language-sh\">aws eks create-cluster <span class=\"token punctuation\">\\</span>\n   <span class=\"token parameter variable\">--name</span> <span class=\"token operator\">&lt;</span>CLUSTER_NAME<span class=\"token operator\">></span> <span class=\"token punctuation\">\\</span>\n   --role-arn <span class=\"token operator\">&lt;</span>CLUSTER_ROLE_ARN<span class=\"token operator\">></span> <span class=\"token punctuation\">\\</span>\n   --resources-vpc-config <span class=\"token assign-left variable\">subnetIds</span><span class=\"token operator\">=</span><span class=\"token operator\">&lt;</span>value<span class=\"token operator\">></span>,endpointPublicAccess<span class=\"token operator\">=</span>true <span class=\"token punctuation\">\\</span>\n   <span class=\"token parameter variable\">--logging</span> <span class=\"token string\">'{\"clusterLogging\":[{\"types\":[\"api\",\"audit\",\"authenticator\",\"controllerManager\",\"scheduler\"],\"enabled\":true}]}'</span> <span class=\"token punctuation\">\\</span>\n   --access-config <span class=\"token assign-left variable\">authenticationMode</span><span class=\"token operator\">=</span>API_AND_CONFIG_MAP</code></pre></div>\n<p><strong>Updating an existing cluster to use Access entries</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"sh\"><pre class=\"language-sh\"><code class=\"language-sh\">aws eks update-cluster-config <span class=\"token punctuation\">\\</span>\n   <span class=\"token parameter variable\">--name</span> <span class=\"token operator\">&lt;</span>CLUSTER_NAME<span class=\"token operator\">></span> <span class=\"token punctuation\">\\</span>\n   --access-config <span class=\"token assign-left variable\">authenticationMode</span><span class=\"token operator\">=</span>API</code></pre></div>\n<h3 id=\"comparison-between-the-new-api-and-the-old-configmap-method\" style=\"position:relative;\"><a href=\"#comparison-between-the-new-api-and-the-old-configmap-method\" aria-label=\"comparison between the new api and the old configmap method permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Comparison Between the New API and the Old ConfigMap Method</h3>\n<table>\n<thead>\n<tr>\n<th><strong>Old Method: aws-auth ConfigMap</strong></th>\n<th><strong>New Method: EKS API</strong></th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>Manual Updates</strong>: Required manual editing of the <code class=\"language-text\">aws-auth</code> ConfigMap to manage access.</td>\n<td><strong>Automated Management</strong>: Access entries can be managed programmatically through the EKS API.</td>\n</tr>\n<tr>\n<td><strong>Scalability Issues</strong>: Difficult to manage access for a large number of users and roles.</td>\n<td><strong>Scalable</strong>: Easier to manage access for a large number of users and roles.</td>\n</tr>\n<tr>\n<td><strong>Risk of Misconfiguration</strong>: Errors in the ConfigMap could break access control.</td>\n<td><strong>Reduced Risk</strong>: Less prone to errors compared to manual ConfigMap updates.</td>\n</tr>\n<tr>\n<td><strong>Cluster Owner Issues</strong>: The default cluster creator had full admin rights, and deleting this user could result in losing access to the cluster.</td>\n<td><strong>Flexible Ownership</strong>: Allows changing the cluster owner and adding IAM principals by other users.</td>\n</tr>\n</tbody>\n</table>\n<h3 id=\"advantages-of-using-the-eks-api\" style=\"position:relative;\"><a href=\"#advantages-of-using-the-eks-api\" aria-label=\"advantages of using the eks api permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Advantages of using the EKS API</h3>\n<ol>\n<li><strong>Simplified access management</strong>: The EKS API allows you to manage access entries directly, reducing the complexity and risk associated with manual ConfigMap updates.</li>\n<li><strong>Integration with IAM and RBAC</strong>: Combines AWS IAM for authentication and Kubernetes RBAC for authorization, providing a robust and flexible access control system.</li>\n<li><strong>Predefined Access Policies</strong>: AWS provides predefined access policies similar to Kubernetes ClusterRoles:\n<ul>\n<li><strong>AmazonEKSClusterAdminPolicy</strong> ‚Äì cluster-admin</li>\n<li><strong>AmazonEKSAdminPolicy</strong> ‚Äì admin</li>\n<li><strong>AmazonEKSEditPolicy</strong> ‚Äì edit</li>\n<li><strong>AmazonEKSViewPolicy</strong> ‚Äì view</li>\n</ul>\n</li>\n<li><strong>Enhanced security</strong>: By managing access through the EKS API, you can ensure that only authorized users have access to your clusters, improving overall security.</li>\n<li><strong>Infrastructure as Code (IaC)</strong>: Easily manage access entries using IaC tools like Terraform, OpenTofu, Pulumi, Ansible, and CloudFormation.</li>\n</ol>\n<h3 id=\"example-aws-cli-commands\" style=\"position:relative;\"><a href=\"#example-aws-cli-commands\" aria-label=\"example aws cli commands permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Example AWS CLI commands</h3>\n<p><strong>Listing Existing Access Entries</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"sh\"><pre class=\"language-sh\"><code class=\"language-sh\">aws eks list-access-entries --cluster-name <span class=\"token operator\">&lt;</span>CLUSTER_NAME<span class=\"token operator\">></span></code></pre></div>\n<p><strong>Creating a Cluster Access Entry</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"sh\"><pre class=\"language-sh\"><code class=\"language-sh\">aws eks create-access-entry --cluster-name <span class=\"token operator\">&lt;</span>CLUSTER_NAME<span class=\"token operator\">></span> <span class=\"token punctuation\">\\</span>\n  --principal-arn <span class=\"token operator\">&lt;</span>IAM_PRINCIPAL_ARN<span class=\"token operator\">></span></code></pre></div>\n<p><strong>Associating an Access Policy to an Access Entry</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"sh\"><pre class=\"language-sh\"><code class=\"language-sh\">aws eks associate-access-policy --cluster-name <span class=\"token operator\">&lt;</span>CLUSTER_NAME<span class=\"token operator\">></span> <span class=\"token punctuation\">\\</span>\n  --principal-arn <span class=\"token operator\">&lt;</span>IAM_PRINCIPAL_ARN<span class=\"token operator\">></span> <span class=\"token punctuation\">\\</span>\n  --policy-arn arn:aws:eks::aws:cluster-access-policy/AmazonEKSClusterAdminPolicy <span class=\"token punctuation\">\\</span>\n  --access-scope <span class=\"token assign-left variable\">type</span><span class=\"token operator\">=</span>cluster</code></pre></div>\n<div class=\"important\">\n    <p><strong>‚ùó Important:</strong></p>\n    <p>Changing the <b>authentication_mode</b> is a one-way operation. You can switch from <b>CONFIG_MAP</b> to <b>API_AND_CONFIG_MAP</b>, and then to <b>API</b>, but you cannot revert these changes.</p>\n</div>\n<h3 id=\"combining-eks-api-with-kubernetes-rbac\" style=\"position:relative;\"><a href=\"#combining-eks-api-with-kubernetes-rbac\" aria-label=\"combining eks api with kubernetes rbac permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Combining EKS API with Kubernetes RBAC</h3>\n<p>The EKS API does not replace Kubernetes RBAC but works alongside it. For example, you can create a cluster access entry and then use Kubernetes RBAC to assign permissions:</p>\n<p><strong>1- Creating a Cluster Access Entry</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"sh\"><pre class=\"language-sh\"><code class=\"language-sh\">aws eks create-access-entry --cluster-name <span class=\"token operator\">&lt;</span>CLUSTER_NAME<span class=\"token operator\">></span> <span class=\"token punctuation\">\\</span>\n  --principal-arn <span class=\"token operator\">&lt;</span>IAM_PRINCIPAL_ARN<span class=\"token operator\">></span> <span class=\"token punctuation\">\\</span>\n  --kubernetes-groups eks-admins</code></pre></div>\n<p><strong>2- Applying a Cluster Role Binding</strong></p>\n<p>Create a <code class=\"language-text\">crb.yaml</code> file with the following content:</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> rbac.authorization.k8s.io/v1\n<span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> ClusterRoleBinding\n<span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> cluster<span class=\"token punctuation\">-</span>admin<span class=\"token punctuation\">-</span>ae\n<span class=\"token key atrule\">roleRef</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">apiGroup</span><span class=\"token punctuation\">:</span> rbac.authorization.k8s.io\n  <span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> ClusterRole\n  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> cluster<span class=\"token punctuation\">-</span>admin\n<span class=\"token key atrule\">subjects</span><span class=\"token punctuation\">:</span>\n<span class=\"token punctuation\">-</span> <span class=\"token key atrule\">apiGroup</span><span class=\"token punctuation\">:</span> rbac.authorization.k8s.io\n  <span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> Group\n  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> eks<span class=\"token punctuation\">-</span>admins</code></pre></div>\n<p>Apply the Cluster Role Binding:</p>\n<div class=\"gatsby-highlight\" data-language=\"sh\"><pre class=\"language-sh\"><code class=\"language-sh\">kubectl apply <span class=\"token parameter variable\">-f</span> crb.yaml</code></pre></div>\n<h3 id=\"managing-eks-access-policies-with-terraform-and-opentofu\" style=\"position:relative;\"><a href=\"#managing-eks-access-policies-with-terraform-and-opentofu\" aria-label=\"managing eks access policies with terraform and opentofu permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Managing EKS Access Policies with Terraform and OpenTofu</h3>\n<h4 id=\"prerequisites\" style=\"position:relative;\"><a href=\"#prerequisites\" aria-label=\"prerequisites permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Prerequisites</h4>\n<ul>\n<li><strong>AWS Account</strong>: Ensure you have an AWS account and the necessary permissions to create the required resources.</li>\n<li><strong>Terraform</strong>: Install Terraform on your machine.</li>\n<li><strong>OpenTofu</strong>: Ensure OpenTofu is installed on your machine.</li>\n</ul>\n<h4 id=\"iac-configuration\" style=\"position:relative;\"><a href=\"#iac-configuration\" aria-label=\"iac configuration permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>IAC Configuration</h4>\n<p>Here is an example  configuration to set up an EKS cluster with access entries:</p>\n<div class=\"gatsby-highlight\" data-language=\"hcl\"><pre class=\"language-hcl\"><code class=\"language-hcl\"><span class=\"token keyword\">module<span class=\"token type variable\"> \"eks\" </span></span><span class=\"token punctuation\">{</span>\n  <span class=\"token property\">source</span>  <span class=\"token punctuation\">=</span> <span class=\"token string\">\"terraform-aws-modules/eks/aws\"</span>\n  <span class=\"token property\">version</span> <span class=\"token punctuation\">=</span> <span class=\"token string\">\"~> 20.0\"</span>\n\n  <span class=\"token property\">cluster_name</span>    <span class=\"token punctuation\">=</span> <span class=\"token string\">\"my-cluster\"</span>\n  <span class=\"token property\">cluster_version</span> <span class=\"token punctuation\">=</span> <span class=\"token string\">\"1.30\"</span>\n\n  <span class=\"token property\">cluster_endpoint_public_access</span>  <span class=\"token punctuation\">=</span> <span class=\"token boolean\">true</span>\n\n  <span class=\"token property\">cluster_addons</span> <span class=\"token punctuation\">=</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">coredns</span>                <span class=\"token punctuation\">=</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n    <span class=\"token property\">eks-pod-identity-agent</span> <span class=\"token punctuation\">=</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n    <span class=\"token property\">kube-proxy</span>             <span class=\"token punctuation\">=</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n    <span class=\"token property\">vpc-cni</span>                <span class=\"token punctuation\">=</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token property\">vpc_id</span>                   <span class=\"token punctuation\">=</span> <span class=\"token string\">\"vpc-1234556abcdef\"</span>\n  <span class=\"token property\">subnet_ids</span>               <span class=\"token punctuation\">=</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"subnet-abcde012\"</span>, <span class=\"token string\">\"subnet-bcde012a\"</span>, <span class=\"token string\">\"subnet-fghi345a\"</span><span class=\"token punctuation\">]</span>\n  <span class=\"token property\">control_plane_subnet_ids</span> <span class=\"token punctuation\">=</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"subnet-xyzde987\"</span>, <span class=\"token string\">\"subnet-slkjf456\"</span>, <span class=\"token string\">\"subnet-qeiru789\"</span><span class=\"token punctuation\">]</span>\n\n  <span class=\"token comment\"># EKS Managed Node Group(s)</span>\n  <span class=\"token property\">eks_managed_node_group_defaults</span> <span class=\"token punctuation\">=</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">instance_types</span> <span class=\"token punctuation\">=</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"m6i.large\"</span>, <span class=\"token string\">\"m5.large\"</span>, <span class=\"token string\">\"m5n.large\"</span>, <span class=\"token string\">\"m5zn.large\"</span><span class=\"token punctuation\">]</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token property\">eks_managed_node_groups</span> <span class=\"token punctuation\">=</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">example</span> <span class=\"token punctuation\">=</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token comment\"># Starting on 1.30, AL2023 is the default AMI type for EKS managed node groups</span>\n      <span class=\"token property\">ami_type</span>       <span class=\"token punctuation\">=</span> <span class=\"token string\">\"AL2023_x86_64_STANDARD\"</span>\n      <span class=\"token property\">instance_types</span> <span class=\"token punctuation\">=</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"m5.xlarge\"</span><span class=\"token punctuation\">]</span>\n\n      <span class=\"token property\">min_size</span>     <span class=\"token punctuation\">=</span> <span class=\"token number\">2</span>\n      <span class=\"token property\">max_size</span>     <span class=\"token punctuation\">=</span> <span class=\"token number\">10</span>\n      <span class=\"token property\">desired_size</span> <span class=\"token punctuation\">=</span> <span class=\"token number\">2</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token comment\"># Cluster access entry</span>\n  <span class=\"token comment\"># To add the current caller identity as an administrator</span>\n  <span class=\"token property\">enable_cluster_creator_admin_permissions</span> <span class=\"token punctuation\">=</span> <span class=\"token boolean\">true</span>\n\n  <span class=\"token property\">access_entries</span> <span class=\"token punctuation\">=</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\"># One access entry with a policy associated</span>\n    <span class=\"token property\">example</span> <span class=\"token punctuation\">=</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token property\">kubernetes_groups</span> <span class=\"token punctuation\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\n      <span class=\"token property\">principal_arn</span>     <span class=\"token punctuation\">=</span> <span class=\"token string\">\"arn:aws:iam::123456789012:role/something\"</span>\n\n      <span class=\"token property\">policy_associations</span> <span class=\"token punctuation\">=</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token property\">example</span> <span class=\"token punctuation\">=</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token property\">policy_arn</span> <span class=\"token punctuation\">=</span> <span class=\"token string\">\"arn:aws:eks::aws:cluster-access-policy/AmazonEKSViewPolicy\"</span>\n          <span class=\"token property\">access_scope</span> <span class=\"token punctuation\">=</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token property\">namespaces</span> <span class=\"token punctuation\">=</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"default\"</span><span class=\"token punctuation\">]</span>\n            <span class=\"token property\">type</span>       <span class=\"token punctuation\">=</span> <span class=\"token string\">\"namespace\"</span>\n          <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token property\">tags</span> <span class=\"token punctuation\">=</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">Environment</span> <span class=\"token punctuation\">=</span> <span class=\"token string\">\"dev\"</span>\n    <span class=\"token property\">Terraform</span>   <span class=\"token punctuation\">=</span> <span class=\"token string\">\"true\"</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h3 id=\"explanation-of-the-code\" style=\"position:relative;\"><a href=\"#explanation-of-the-code\" aria-label=\"explanation of the code permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Explanation of the Code</h3>\n<p>This Terraform configuration sets up an AWS EKS cluster with the following components:</p>\n<ol>\n<li><strong>EKS Cluster</strong>: Creates an EKS cluster named \"my-cluster\" with version 1.30.</li>\n<li><strong>Cluster Endpoint</strong>: Enables public access to the cluster endpoint.</li>\n<li><strong>Cluster Addons</strong>: Installs essential Kubernetes addons such as CoreDNS, EKS Pod Identity Agent, Kube-Proxy, and VPC CNI.</li>\n<li><strong>VPC Configuration</strong>: Specifies the VPC and subnets for the EKS cluster.</li>\n<li><strong>Managed Node Groups</strong>: Configures managed node groups with specified instance types and sizes.</li>\n<li><strong>Access Entries</strong>:\n<ul>\n<li><strong>Cluster Creator Admin Permissions</strong>: Enables the current caller identity as an administrator.</li>\n<li><strong>Example Access Entry</strong>: Creates an access entry for an IAM role with the ARN <code class=\"language-text\">arn:aws:iam::123456789012:role/something</code>. This entry is associated with the <code class=\"language-text\">AmazonEKSViewPolicy</code>, granting view permissions within the \"default\" namespace.</li>\n</ul>\n</li>\n</ol>\n<h3 id=\"applying-the-configuration\" style=\"position:relative;\"><a href=\"#applying-the-configuration\" aria-label=\"applying the configuration permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Applying the Configuration</h3>\n<ol>\n<li><strong>Initialize Terraform</strong>:</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">    terraform init</code></pre></div>\n<ol start=\"2\">\n<li><strong>Plan the Deployment</strong>:</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">    terraform plan</code></pre></div>\n<ol start=\"3\">\n<li><strong>Apply the Configuration</strong>:</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">    terraform apply</code></pre></div>\n<p>Alternatively, if you are using OpenTofu:</p>\n<ol>\n<li><strong>Initialize OpenTofu</strong>:</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">    tofu init</code></pre></div>\n<ol start=\"2\">\n<li><strong>Plan the Deployment</strong>:</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">    tofu plan</code></pre></div>\n<ol start=\"3\">\n<li><strong>Apply the Configuration</strong>:</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">    tofu apply</code></pre></div>\n<p>This  configuration automates the setup of an AWS EKS cluster, including the creation of access entries and the association of IAM policies. Specifically, it creates the following:</p>\n<ul>\n<li>\n<p><strong>Access entries</strong>:</p>\n<ul>\n<li><strong>Example Access Entry</strong>: Associates the IAM role <code class=\"language-text\">arn:aws:iam::123456789012:role/something</code> with the <code class=\"language-text\">AmazonEKSViewPolicy</code>, granting view permissions within the \"default\" namespace.</li>\n</ul>\n</li>\n<li>\n<p><strong>IAM Policies</strong>:</p>\n<ul>\n<li><strong>AmazonEKSClusterPolicy</strong>: Attached to the EKS cluster IAM role.</li>\n<li><strong>AmazonEKSVPCResourceController</strong>: Attached to the EKS cluster IAM role.</li>\n<li><strong>AmazonEKSViewPolicy</strong>: Associated with the example access entry.</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"checking-access-entries-and-iam-policies\" style=\"position:relative;\"><a href=\"#checking-access-entries-and-iam-policies\" aria-label=\"checking access entries and iam policies permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Checking Access Entries and IAM Policies</h3>\n<p>After the creation is complete, you can verify the access entries and IAM policies using the AWS CLI:</p>\n<h4 id=\"list-access-entries\" style=\"position:relative;\"><a href=\"#list-access-entries\" aria-label=\"list access entries permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>List access entries</h4>\n<p>To list the access entries for your EKS cluster, use the following command:</p>\n<div class=\"gatsby-highlight\" data-language=\"sh\"><pre class=\"language-sh\"><code class=\"language-sh\">aws eks list-access-entries --cluster-name my-cluster</code></pre></div>\n<p>This command will output the access entries associated with your cluster, including the IAM role and the policies attached.</p>\n<h4 id=\"describe-iam-role\" style=\"position:relative;\"><a href=\"#describe-iam-role\" aria-label=\"describe iam role permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Describe IAM Role</h4>\n<p>To check the IAM policies attached to the EKS cluster IAM role, use the following command:</p>\n<div class=\"gatsby-highlight\" data-language=\"sh\"><pre class=\"language-sh\"><code class=\"language-sh\">aws iam list-attached-role-policies --role-name <span class=\"token operator\">&lt;</span>IAM_ROLE_NAME<span class=\"token operator\">></span></code></pre></div>\n<p>Replace <code class=\"language-text\">&lt;IAM_ROLE_NAME></code> with the name of your IAM role. This command will list all the policies attached to the specified IAM role.</p>\n<h3 id=\"closing-statement\" style=\"position:relative;\"><a href=\"#closing-statement\" aria-label=\"closing statement permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Closing statement</h3>\n<p>Managing AWS EKS access policies using Terraform and OpenTofu simplifies the process of setting up and maintaining your Kubernetes clusters. By using both AWS IAM policies and Kubernetes RBAC, you can achieve a resilient and flexible access control system. This approach allows you to centrally manage permissions through AWS while also providing fine-grained control within the Kubernetes cluster.</p>\n<p><strong>Until next time üéâ</strong></p>\n<p><br><br></p>\n<blockquote>\n<p>üí° Thank you for Reading !! üôåüèªüòÅüìÉ, see you in the next blog.ü§ò  <em><strong>Until next time üéâ</strong></em></p>\n</blockquote>\n<p>üöÄ Thank you for sticking up till the end. If you have any questions/feedback regarding this blog feel free to connect with me:</p>\n<p><strong>‚ôªÔ∏è LinkedIn:</strong> <a href=\"https://www.linkedin.com/in/rajhi-saif/\" target=\"_blank\" rel=\"noopener noreferrer\">https://www.linkedin.com/in/rajhi-saif/</a></p>\n<p><strong>‚ôªÔ∏è X/Twitter:</strong> <a href=\"https://x.com/rajhisaifeddine\" target=\"_blank\" rel=\"noopener noreferrer\">https://x.com/rajhisaifeddine</a></p>\n<p><strong>The end ‚úåüèª</strong></p>\n<h1 align=\"center\">üî∞ Keep Learning !! Keep Sharing !! üî∞</h1>\n<p><strong>üìö References:</strong></p>\n<ul>\n<li><a href=\"https://docs.aws.amazon.com/eks/latest/userguide/access-entries.html\" target=\"_blank\" rel=\"noopener noreferrer\">https://docs.aws.amazon.com/eks/latest/userguide/access-entries.html</a></li>\n<li><a href=\"https://aws.amazon.com/blogs/containers/a-deep-dive-into-simplified-amazon-eks-access-management-controls/\" target=\"_blank\" rel=\"noopener noreferrer\">https://aws.amazon.com/blogs/containers/a-deep-dive-into-simplified-amazon-eks-access-management-controls/</a></li>\n<li><a href=\"https://kubedemy.io/aws-eks-part-20-authentication-and-authorization-with-access-entries\" target=\"_blank\" rel=\"noopener noreferrer\">https://kubedemy.io/aws-eks-part-20-authentication-and-authorization-with-access-entries</a></li>\n<li><a href=\"https://securitylabs.datadoghq.com/articles/eks-cluster-access-management-deep-dive/\" target=\"_blank\" rel=\"noopener noreferrer\">https://securitylabs.datadoghq.com/articles/eks-cluster-access-management-deep-dive/</a></li>\n<li><a href=\"https://community.aws/content/2aWo77epP0lbfrWhnqTpWzSSXyu/simplified-eks-cluster-access-management-directly-using-amazon-eks-apis?lang=en\" target=\"_blank\" rel=\"noopener noreferrer\">https://community.aws/content/2aWo77epP0lbfrWhnqTpWzSSXyu/simplified-eks-cluster-access-management-directly-using-amazon-eks-apis?lang=en</a></li>\n</ul>\n<p><strong>üìÖ Stay updated</strong></p>\n<p>Subscribe to our newsletter for more insights on AWS cloud computing and containers.</p>","timeToRead":10,"rawMarkdownBody":"\n> **Setting up EKS authentication and authorization using Infrastructure as Code**\n\n## üìö Introduction\n\nManaging who can access your AWS EKS clusters can be tricky, especially in big companies. Usually, the person who creates the EKS cluster has full control. But this can be a problem for security and management. AWS EKS has new controls called access entries to help manage who can access your Kubernetes clusters more easily.\n\nIn this blog, we will show you how to use Terraform and OpenTofu to set up access entries for your AWS EKS clusters. We will explain what access entries are, the different options you can use, and how this new method makes it easier to manage who can access your clusters.\n\n\n## The Need for EKS access entries\n\nTraditionally, we used a special `aws-auth` [ConfigMap](https://docs.aws.amazon.com/eks/latest/userguide/auth-configmap.html) to define the IAM roles for worker nodes, users, roles, and groups. This method required manual updates and was prone to errors, making it difficult to manage access at scale.\n\nWith the introduction of Access Entries, AWS has provided a more streamlined and efficient way to manage access to EKS clusters. Now, we can manage access directly through the [EKS API](https://awscli.amazonaws.com/v2/documentation/api/latest/reference/eks/index.html) using AWS IAM as an authenticator. This means that when a user logs in to AWS, AWS handles the authentication, verifying the user's identity. When the user connects to Kubernetes, Kubernetes handles the authorization, checking the user's permissions within the cluster.\n\nThis new approach integrates seamlessly with [Kubernetes' RBAC](https://kubernetes.io/docs/reference/access-authn-authz/rbac/) (Role-Based Access Control), providing a more robust and flexible access management system. One significant improvement is the ability to remove the \"default root user\" ‚Äì the hidden cluster administrator created by default. Previously, this user could not be seen or changed, which sometimes caused issues.\n\nBy moving access control to a dedicated infrastructure as code, we can manage access more easily and with less risk. In the old system, there was a chance you would lose cluster access if you deleted the cluster owner. Now, other users can add IAM principals to access the cluster through APIs, making it easier to manage access with [Infrastructure as Code (IaC) tools](https://aws.amazon.com/what-is/iac/#:~:text=Infrastructure%20as%20code%20(IaC)%20is%20used%20for%20infrastructure%20automation%20to,to%20set%20up%20infrastructure%20environments.) like [OpenTofu](https://opentofu.org/), [Terraform](https://www.terraform.io/), [Pulumi](https://www.pulumi.com/), [Ansible](https://docs.ansible.com/ansible-core/devel/getting_started/index.html), and [CloudFormation](https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/Welcome.html).\n\n<div class=\"note\">\n    <p><strong>üîµ Note:</strong></p>\n    <p>Access Entries also provide predefined access policies that can be assigned to IAM principals outside the cluster through EKS APIs. This allows users to access cluster resources without needing to define RBAC resources inside the Kubernetes cluster, simplifying the management process and enhancing security.</p>\n</div>\n\n## ‚öõÔ∏è Legacy access management: IAM and aws-auth ConfigMaps\n<div class=\"caution\">\n    <p><strong>üö´ Caution:</strong></p>\n    <p>The aws-auth ConfigMap is deprecated.</p>\n</div>\n\nIn the early days of AWS EKS, managing access to Kubernetes clusters was primarily done through AWS IAM roles and the `aws-auth` ConfigMap. This method involved mapping IAM users and roles to Kubernetes RBAC (Role-Based Access Control) roles and groups. The `aws-auth` ConfigMap was a critical component in this setup, serving as the bridge between AWS IAM and Kubernetes RBAC.\n\n### Detailed explanation of the aws-auth ConfigMap\n\nThe `aws-auth` ConfigMap is a Kubernetes configuration map that resides in the `kube-system` namespace of an EKS cluster. It contains mappings that associate AWS IAM roles and users with Kubernetes RBAC roles and groups.\n\nHere is an example of what the `aws-auth` ConfigMap might look like:\n\n```yaml\napiVersion: v1\nkind: ConfigMap\nmetadata:\n  name: aws-auth\n  namespace: kube-system\ndata:\n  mapRoles: |\n    - rolearn: arn:aws:iam::123456789012:role/EKS-NodeInstanceRole\n      username: system:node:{{EC2PrivateDNSName}}\n      groups:\n        - system:bootstrappers\n        - system:nodes\n  mapUsers: |\n    - userarn: arn:aws:iam::123456789012:user/admin\n      username: admin\n      groups:\n        - system:masters\n  mapAccounts: |\n    - \"123456789012\"\n```\n\n**Components of the aws-auth ConfigMap**\n\n1. **mapRoles**: This section maps IAM roles to Kubernetes usernames and groups. For example, the `EKS-NodeInstanceRole` is mapped to the `system:nodes` group, which grants the necessary permissions for node operations.\n2. **mapUsers**: This section maps IAM users to Kubernetes usernames and groups. For instance, the `admin` user is mapped to the `system:masters` group, granting cluster admin privileges.\n3. **mapAccounts**: This optional section allows specifying AWS account IDs that are trusted to authenticate to the cluster.\n\n### Issues and Challenges with Using IAM and ConfigMap for Access Management\n\nWhile the `aws-auth` ConfigMap provided a way to manage access, it came with several challenges:\n\n1. **Manual updates**: Any changes to access control required manual updates to the `aws-auth` ConfigMap. This process was error-prone and could lead to misconfigurations.\n2. **Scalability**: Managing access for a large number of users and roles became cumbersome. Each change required editing the ConfigMap, which was not scalable in large environments.\n3. **Risk of misconfiguration**: A single mistake in the ConfigMap could break access control, potentially locking out users or granting unintended permissions.\n4. **Lack of visibility**: The `aws-auth` ConfigMap did not provide a clear way to audit or track changes, making it difficult to maintain security and compliance.\n5. **Cluster owner issues**: The default cluster creator had full admin rights, and there was no straightforward way to change the cluster owner. Deleting the cluster owner could result in losing access to the cluster.\n\n### A real world scenario\n\nConsider a scenario where you need to add a new IAM user to the `system:masters` group for admin access. You would need to manually edit the `aws-auth` ConfigMap as follows:\n\n1. Retrieve the current `aws-auth` ConfigMap:\n\n \n```Shell\n    kubectl get configmap aws-auth -n kube-system -o yaml > aws-auth.yaml\n```\n\n2. Edit the `aws-auth.yaml` file to add the new user:\n\n```yaml\n    apiVersion: v1\n    kind: ConfigMap\n    metadata:\n      name: aws-auth\n      namespace: kube-system\n    data:\n      mapRoles: |\n        - rolearn: arn:aws:iam::123456789012:role/EKS-NodeInstanceRole\n          username: system:node:{{EC2PrivateDNSName}}\n          groups:\n            - system:bootstrappers\n            - system:nodes\n      mapUsers: |\n        - userarn: arn:aws:iam::123456789012:user/admin\n          username: admin\n          groups:\n            - system:masters\n        - userarn: arn:aws:iam::123456789012:user/new-admin\n          username: new-admin\n          groups:\n            - system:masters\n      mapAccounts: |\n        - \"123456789012\"\n```\n\n3. Apply the updated ConfigMap:\n\n \n```Shell\n    kubectl apply -f aws-auth.yaml\n```\n\nThis manual process is prone to errors and does not scale well, highlighting the need for a more efficient access management solution.\n\n## EKS API: The New Way of Granting Access\n\nAWS has introduced a new way to manage access to EKS clusters using the EKS API. This method allows you to manage access entries directly through the API, making use of AWS IAM for authentication. This new approach simplifies the process of managing who can access your Kubernetes clusters and integrates seamlessly with Kubernetes' RBAC (Role-Based Access Control).\n\n### Enabling Access entries\n\nTo enable Access Entries on new or existing clusters, you need to use the latest version of the AWS CLI, which includes the `--access-config` option in the EKS create/update commands. Here‚Äôs how you can enable Access Entries:\n\n#### Creating a New cluster with Access entries\n\n```sh\naws eks create-cluster \\\n   --name <CLUSTER_NAME> \\\n   --role-arn <CLUSTER_ROLE_ARN> \\\n   --resources-vpc-config subnetIds=<value>,endpointPublicAccess=true \\\n   --logging '{\"clusterLogging\":[{\"types\":[\"api\",\"audit\",\"authenticator\",\"controllerManager\",\"scheduler\"],\"enabled\":true}]}' \\\n   --access-config authenticationMode=API_AND_CONFIG_MAP\n```\n\n**Updating an existing cluster to use Access entries**\n\n```sh\naws eks update-cluster-config \\\n   --name <CLUSTER_NAME> \\\n   --access-config authenticationMode=API\n```\n\n### Comparison Between the New API and the Old ConfigMap Method\n\n| **Old Method: aws-auth ConfigMap** | **New Method: EKS API** |\n|------------------------------------|-------------------------|\n| **Manual Updates**: Required manual editing of the `aws-auth` ConfigMap to manage access. | **Automated Management**: Access entries can be managed programmatically through the EKS API. |\n| **Scalability Issues**: Difficult to manage access for a large number of users and roles. | **Scalable**: Easier to manage access for a large number of users and roles. |\n| **Risk of Misconfiguration**: Errors in the ConfigMap could break access control. | **Reduced Risk**: Less prone to errors compared to manual ConfigMap updates. |\n| **Cluster Owner Issues**: The default cluster creator had full admin rights, and deleting this user could result in losing access to the cluster. | **Flexible Ownership**: Allows changing the cluster owner and adding IAM principals by other users. |\n\n### Advantages of using the EKS API\n\n1. **Simplified access management**: The EKS API allows you to manage access entries directly, reducing the complexity and risk associated with manual ConfigMap updates.\n2. **Integration with IAM and RBAC**: Combines AWS IAM for authentication and Kubernetes RBAC for authorization, providing a robust and flexible access control system.\n3. **Predefined Access Policies**: AWS provides predefined access policies similar to Kubernetes ClusterRoles:\n   - **AmazonEKSClusterAdminPolicy** ‚Äì cluster-admin\n   - **AmazonEKSAdminPolicy** ‚Äì admin\n   - **AmazonEKSEditPolicy** ‚Äì edit\n   - **AmazonEKSViewPolicy** ‚Äì view\n4. **Enhanced security**: By managing access through the EKS API, you can ensure that only authorized users have access to your clusters, improving overall security.\n5. **Infrastructure as Code (IaC)**: Easily manage access entries using IaC tools like Terraform, OpenTofu, Pulumi, Ansible, and CloudFormation.\n\n### Example AWS CLI commands\n\n**Listing Existing Access Entries**\n\n```sh\naws eks list-access-entries --cluster-name <CLUSTER_NAME>\n```\n\n**Creating a Cluster Access Entry**\n\n```sh\naws eks create-access-entry --cluster-name <CLUSTER_NAME> \\\n  --principal-arn <IAM_PRINCIPAL_ARN>\n```\n\n**Associating an Access Policy to an Access Entry**\n\n```sh\naws eks associate-access-policy --cluster-name <CLUSTER_NAME> \\\n  --principal-arn <IAM_PRINCIPAL_ARN> \\\n  --policy-arn arn:aws:eks::aws:cluster-access-policy/AmazonEKSClusterAdminPolicy \\\n  --access-scope type=cluster\n```\n\n<div class=\"important\">\n    <p><strong>‚ùó Important:</strong></p>\n    <p>Changing the <b>authentication_mode</b> is a one-way operation. You can switch from <b>CONFIG_MAP</b> to <b>API_AND_CONFIG_MAP</b>, and then to <b>API</b>, but you cannot revert these changes.</p>\n</div>\n\n### Combining EKS API with Kubernetes RBAC\n\nThe EKS API does not replace Kubernetes RBAC but works alongside it. For example, you can create a cluster access entry and then use Kubernetes RBAC to assign permissions:\n\n**1- Creating a Cluster Access Entry**\n\n```sh\naws eks create-access-entry --cluster-name <CLUSTER_NAME> \\\n  --principal-arn <IAM_PRINCIPAL_ARN> \\\n  --kubernetes-groups eks-admins\n```\n\n**2- Applying a Cluster Role Binding**\n\nCreate a `crb.yaml` file with the following content:\n\n```yaml\napiVersion: rbac.authorization.k8s.io/v1\nkind: ClusterRoleBinding\nmetadata:\n  name: cluster-admin-ae\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: cluster-admin\nsubjects:\n- apiGroup: rbac.authorization.k8s.io\n  kind: Group\n  name: eks-admins\n```\n\nApply the Cluster Role Binding:\n\n```sh\nkubectl apply -f crb.yaml\n```\n\n### Managing EKS Access Policies with Terraform and OpenTofu\n\n#### Prerequisites\n\n- **AWS Account**: Ensure you have an AWS account and the necessary permissions to create the required resources.\n- **Terraform**: Install Terraform on your machine.\n- **OpenTofu**: Ensure OpenTofu is installed on your machine.\n\n#### IAC Configuration\n\nHere is an example  configuration to set up an EKS cluster with access entries:\n\n```hcl\nmodule \"eks\" {\n  source  = \"terraform-aws-modules/eks/aws\"\n  version = \"~> 20.0\"\n\n  cluster_name    = \"my-cluster\"\n  cluster_version = \"1.30\"\n\n  cluster_endpoint_public_access  = true\n\n  cluster_addons = {\n    coredns                = {}\n    eks-pod-identity-agent = {}\n    kube-proxy             = {}\n    vpc-cni                = {}\n  }\n\n  vpc_id                   = \"vpc-1234556abcdef\"\n  subnet_ids               = [\"subnet-abcde012\", \"subnet-bcde012a\", \"subnet-fghi345a\"]\n  control_plane_subnet_ids = [\"subnet-xyzde987\", \"subnet-slkjf456\", \"subnet-qeiru789\"]\n\n  # EKS Managed Node Group(s)\n  eks_managed_node_group_defaults = {\n    instance_types = [\"m6i.large\", \"m5.large\", \"m5n.large\", \"m5zn.large\"]\n  }\n\n  eks_managed_node_groups = {\n    example = {\n      # Starting on 1.30, AL2023 is the default AMI type for EKS managed node groups\n      ami_type       = \"AL2023_x86_64_STANDARD\"\n      instance_types = [\"m5.xlarge\"]\n\n      min_size     = 2\n      max_size     = 10\n      desired_size = 2\n    }\n  }\n\n  # Cluster access entry\n  # To add the current caller identity as an administrator\n  enable_cluster_creator_admin_permissions = true\n\n  access_entries = {\n    # One access entry with a policy associated\n    example = {\n      kubernetes_groups = []\n      principal_arn     = \"arn:aws:iam::123456789012:role/something\"\n\n      policy_associations = {\n        example = {\n          policy_arn = \"arn:aws:eks::aws:cluster-access-policy/AmazonEKSViewPolicy\"\n          access_scope = {\n            namespaces = [\"default\"]\n            type       = \"namespace\"\n          }\n        }\n      }\n    }\n  }\n\n  tags = {\n    Environment = \"dev\"\n    Terraform   = \"true\"\n  }\n}\n```\n\n### Explanation of the Code\n\nThis Terraform configuration sets up an AWS EKS cluster with the following components:\n\n1. **EKS Cluster**: Creates an EKS cluster named \"my-cluster\" with version 1.30.\n2. **Cluster Endpoint**: Enables public access to the cluster endpoint.\n3. **Cluster Addons**: Installs essential Kubernetes addons such as CoreDNS, EKS Pod Identity Agent, Kube-Proxy, and VPC CNI.\n4. **VPC Configuration**: Specifies the VPC and subnets for the EKS cluster.\n5. **Managed Node Groups**: Configures managed node groups with specified instance types and sizes.\n6. **Access Entries**: \n   - **Cluster Creator Admin Permissions**: Enables the current caller identity as an administrator.\n   - **Example Access Entry**: Creates an access entry for an IAM role with the ARN `arn:aws:iam::123456789012:role/something`. This entry is associated with the `AmazonEKSViewPolicy`, granting view permissions within the \"default\" namespace.\n\n### Applying the Configuration\n\n1. **Initialize Terraform**:\n \n```Shell\n    terraform init\n```\n\n2. **Plan the Deployment**:\n \n```Shell\n    terraform plan\n```\n\n3. **Apply the Configuration**:\n \n```Shell\n    terraform apply\n```\n\nAlternatively, if you are using OpenTofu:\n\n1. **Initialize OpenTofu**:\n \n```Shell\n    tofu init\n```\n\n2. **Plan the Deployment**:\n \n```Shell\n    tofu plan\n```\n\n3. **Apply the Configuration**:\n \n```Shell\n    tofu apply\n```\n\nThis  configuration automates the setup of an AWS EKS cluster, including the creation of access entries and the association of IAM policies. Specifically, it creates the following:\n\n- **Access entries**:\n  - **Example Access Entry**: Associates the IAM role `arn:aws:iam::123456789012:role/something` with the `AmazonEKSViewPolicy`, granting view permissions within the \"default\" namespace.\n\n- **IAM Policies**:\n  - **AmazonEKSClusterPolicy**: Attached to the EKS cluster IAM role.\n  - **AmazonEKSVPCResourceController**: Attached to the EKS cluster IAM role.\n  - **AmazonEKSViewPolicy**: Associated with the example access entry.\n\n### Checking Access Entries and IAM Policies\n\nAfter the creation is complete, you can verify the access entries and IAM policies using the AWS CLI:\n\n#### List access entries\n\nTo list the access entries for your EKS cluster, use the following command:\n\n```sh\naws eks list-access-entries --cluster-name my-cluster\n```\n\nThis command will output the access entries associated with your cluster, including the IAM role and the policies attached.\n\n#### Describe IAM Role\n\nTo check the IAM policies attached to the EKS cluster IAM role, use the following command:\n\n```sh\naws iam list-attached-role-policies --role-name <IAM_ROLE_NAME>\n```\n\nReplace `<IAM_ROLE_NAME>` with the name of your IAM role. This command will list all the policies attached to the specified IAM role.\n\n### Closing statement\n\nManaging AWS EKS access policies using Terraform and OpenTofu simplifies the process of setting up and maintaining your Kubernetes clusters. By using both AWS IAM policies and Kubernetes RBAC, you can achieve a resilient and flexible access control system. This approach allows you to centrally manage permissions through AWS while also providing fine-grained control within the Kubernetes cluster.\n\n**Until next time üéâ**\n\n<br><br>\n\n> üí° Thank you for Reading !! üôåüèªüòÅüìÉ, see you in the next blog.ü§ò  _**Until next time üéâ**_\n\nüöÄ Thank you for sticking up till the end. If you have any questions/feedback regarding this blog feel free to connect with me:\n\n**‚ôªÔ∏è LinkedIn:** https://www.linkedin.com/in/rajhi-saif/\n\n**‚ôªÔ∏è X/Twitter:** https://x.com/rajhisaifeddine\n\n**The end ‚úåüèª**\n\n<h1 align=\"center\">üî∞ Keep Learning !! Keep Sharing !! üî∞</h1>\n\n**üìö References:**\n\n- https://docs.aws.amazon.com/eks/latest/userguide/access-entries.html\n- https://aws.amazon.com/blogs/containers/a-deep-dive-into-simplified-amazon-eks-access-management-controls/\n- https://kubedemy.io/aws-eks-part-20-authentication-and-authorization-with-access-entries\n- https://securitylabs.datadoghq.com/articles/eks-cluster-access-management-deep-dive/\n- https://community.aws/content/2aWo77epP0lbfrWhnqTpWzSSXyu/simplified-eks-cluster-access-management-directly-using-amazon-eks-apis?lang=en\n\n\n\n**üìÖ Stay updated**\n\nSubscribe to our newsletter for more insights on AWS cloud computing and containers.\n","wordCount":{"words":1727},"frontmatter":{"id":"cd1b36776850115800db9c16","path":"/blog/eks-access-entry-terraform-opentofu/","humanDate":"Oct 2, 2024","fullDate":"2024-10-02","title":"Managing AWS EKS access entries with Terraform and OpenTofu","keywords":["EKS Access Entries","Kubernetes","Terraform","OpenTofu","Authentication"],"excerpt":"EKS Access Entries, Terraform, OpenTofu, Kubernetes, Authentication","cover":{"childImageSharp":{"gatsbyImageData":{"layout":"fullWidth","placeholder":{"fallback":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAABYlAAAWJQFJUiTwAAACcklEQVR42k1Sy4oTURDNP4gMiK7ElW7cjBvFjQtxI64HQVy7VRjcuRERQZAZJTKCi0wnmTw6j8678046j+70O53uZDqJIn7Gse7NILOorltVt845VX0jK7cKS4nD00Qs9Dyc8Rn3rpqBbxYxV7MwBwIWRgHuNA1bSfK6T7FHnp29WY7fPffqiLAPS9ijJAezhnHeyIBYnp1ZjjWwujtJc3BnnOI9LGYkgV26AFw0sJpXiYlYjCJWboUuJ0lxlhsD2anOwSPV7iR1QZhBQCTMPKoxnP8KQ1/Gcl7DwqrAM8swid0gVmtK445S0PoCzIvYJjMUIlFpRXYVPtkmaCIkHA64pB0GdgWWmsekfwZ1mIY2ykIbZzGmeNAS0JNP0Sc/aAu7upLBdJCm+0mYU5FAK2TlHeBMSaMvx6CPMtCGpIYaDAKbjVgjxWYBkwlTRuOyXWt5zA0JBuVcvQDfKpMY2rVexNKtIWJrBSqK3FQCVIcJzuqZEljN+v4ZTvIbbKNDI9NKrBJ8p0I7q8OaSXxsBiiJUbBpIxOSnoh/RS57grhwBKV7il9hl+Q3sN50sHn2Ar/fHULuqBDjebRqJxh1k1gSaFU8wrQXQzf3BS+fPiCVEtthjQ4l+iFlYqZ9OjVsC2+x1WI4D9roKSIUVcLKK8O18uSrlJexDTv4syzh77qBcTWK48PnUDoC+8ukxG8gXDAv07OpQRc/wBnGsA5a6AxEDMcFGqcMXUth7hShN6OQhI9oN37i+NMbPLl/F/t3buHRw3u7Z3PZVvM6fK+JgIDDS3lOuJD5ewttCYkf7/H61QEOHu/j9s3ruHFtD3tXr+Af3o7GJZISVo4AAAAASUVORK5CYII="},"images":{"fallback":{"src":"/static/e4939971a4dca815ae199c22a047da00/11ec7/eks-entries-cover.png","srcSet":"/static/e4939971a4dca815ae199c22a047da00/596c0/eks-entries-cover.png 750w,\n/static/e4939971a4dca815ae199c22a047da00/a324d/eks-entries-cover.png 1080w,\n/static/e4939971a4dca815ae199c22a047da00/3147f/eks-entries-cover.png 1366w,\n/static/e4939971a4dca815ae199c22a047da00/11ec7/eks-entries-cover.png 1920w","sizes":"100vw"},"sources":[{"srcSet":"/static/e4939971a4dca815ae199c22a047da00/4c8c9/eks-entries-cover.webp 750w,\n/static/e4939971a4dca815ae199c22a047da00/a04f2/eks-entries-cover.webp 1080w,\n/static/e4939971a4dca815ae199c22a047da00/eff6d/eks-entries-cover.webp 1366w,\n/static/e4939971a4dca815ae199c22a047da00/6ed78/eks-entries-cover.webp 1920w","type":"image/webp","sizes":"100vw"}]},"width":1,"height":0.5723958333333333}}},"coverCredits":"Photo by Saifeddine Rajhi"}}},"pageContext":{"prevThought":{"frontmatter":{"path":"/blog/aws-pod-id-agent-boto3-python/","title":"Simplify AWS resource access with EKS Pod Identity Agent and Python SDK","date":"2024-10-02 13:34:00"},"excerpt":"Boto3 inside a Pod with Pod identities üìö Introduction In this blog post, we will guide you through the process of using the AWS EKS Pod‚Ä¶","html":"<blockquote>\n<p><strong>Boto3 inside a Pod with Pod identities</strong></p>\n</blockquote>\n<h2 id=\"-introduction\" style=\"position:relative;\"><a href=\"#-introduction\" aria-label=\" introduction permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üìö Introduction</h2>\n<p>In this blog post, we will guide you through the process of using the <a href=\"https://docs.aws.amazon.com/eks/latest/userguide/pod-identities.html\" target=\"_blank\" rel=\"noopener noreferrer\">AWS EKS Pod Identity Agent</a> with the Python <a href=\"https://aws.amazon.com/fr/what-is/sdk/\" target=\"_blank\" rel=\"noopener noreferrer\">SDK</a> to manage AWS resources.</p>\n<p><a href=\"https://boto3.amazonaws.com/v1/documentation/api/latest/index.html\" target=\"_blank\" rel=\"noopener noreferrer\">Boto3</a> is the name of the Python SDK for AWS. It allows you to directly manage AWS resources from your Python code. We will see in the hands-on.</p>\n<p>To connect to AWS APIs in Python, you typically use the boto3 library, which is the Amazon Web Services (AWS) SDK for Python. It allows Python developers to write software that makes use of services like Amazon S3 and Amazon EC2.</p>\n<p>We will take you step-by-step through setting up the EKS cluster, creating the IAM role, and writing a Python script to access AWS resources.</p>\n<h2 id=\"-eks-pod-identity\" style=\"position:relative;\"><a href=\"#-eks-pod-identity\" aria-label=\" eks pod identity permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üîë EKS Pod Identity</h2>\n<p><a href=\"https://aws.amazon.com/blogs/aws/amazon-eks-pod-identity-simplifies-iam-permissions-for-applications-on-amazon-eks-clusters/\" target=\"_blank\" rel=\"noopener noreferrer\"><strong>Pod Identity</strong></a> is a mechanism that allows Kubernetes pods to assume specific identities, enabling them to access cloud resources securely. Applications running in a pod's containers can use an AWS SDK or the AWS CLI to make API requests to AWS services using AWS IAM permissions. These applications must sign their AWS API requests with AWS credentials.</p>\n<p><strong>EKS Pod Identities</strong> provide the ability to manage credentials for your applications, similar to how <a href=\"https://docs.aws.amazon.com/IAM/latest/UserGuide/id_roles_use_switch-role-ec2_instance-profiles.html\" target=\"_blank\" rel=\"noopener noreferrer\">Amazon EC2 instance profiles</a>provide credentials to Amazon EC2 instances. Instead of creating and distributing your AWS credentials to the containers or using the Amazon EC2 instance's role, you associate an IAM role with a <a href=\"https://kubernetes.io/docs/concepts/security/service-accounts/\" target=\"_blank\" rel=\"noopener noreferrer\">Kubernetes service account</a> and configure your pods to use the service account.</p>\n<h3 id=\"-how-it-works-in-amazon-eks\" style=\"position:relative;\"><a href=\"#-how-it-works-in-amazon-eks\" aria-label=\" how it works in amazon eks permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üÜî How It Works in Amazon EKS</h3>\n<p>In Amazon EKS, Pod Identity is implemented using IAM roles. When a pod needs to access AWS resources, it can assume an IAM role that grants the necessary permissions. This is achieved through the AWS <a href=\"https://github.com/aws/eks-pod-identity-agent\" target=\"_blank\" rel=\"noopener noreferrer\">EKS Pod Identity Agent</a>, which manages the association between Kubernetes service accounts and IAM roles. The agent ensures that the pods receive temporary credentials to access AWS services securely.</p>\n<ul>\n<li><strong>üîí Secure connection</strong>: EKS Pod Identity allows secure connections between Amazon EKS clusters and AWS services like S3.</li>\n<li><strong>üîÑ Simplified IAM roles</strong>: It simplifies the use of IAM roles with Kubernetes pods, reducing operational overhead compared to <a href=\"https://docs.aws.amazon.com/eks/latest/userguide/iam-roles-for-service-accounts.html\" target=\"_blank\" rel=\"noopener noreferrer\">IRSA</a>.</li>\n<li><strong>üí° Backward compatibility</strong>: Pod Identity is backward compatible with IAM Roles for Service Accounts IRSA.</li>\n<li><strong>üîë RBAC authorization</strong>: Kubernetes authorizes users using RBAC with cluster roles and namespace roles.</li>\n<li><strong>üÜî Service accounts</strong>: Service accounts within Kubernetes are used to authorize workloads accessing the Kubernetes API.</li>\n<li><strong>üîÑ IAM Role association</strong>: Pod Identity allows Kubernetes workloads to access AWS services by associating IAM roles with pods.</li>\n<li><strong>üí° No OIDC Providers needed</strong>: With EKS Pod Identity, there's no need to create <a href=\"https://docs.aws.amazon.com/eks/latest/userguide/enable-iam-roles-for-service-accounts.html\" target=\"_blank\" rel=\"noopener noreferrer\">OIDC providers</a> for each cluster, unlike IRSA.</li>\n<li><strong>üîë ABAC</strong>: Pod Identity uses attribute-based access control <a href=\"https://docs.aws.amazon.com/IAM/latest/UserGuide/introduction_attribute-based-access-control.html\" target=\"_blank\" rel=\"noopener noreferrer\">ABAC</a> for more flexible role management.</li>\n<li><strong>üÜî Pod Identity Agent</strong>: The Pod Identity agent, deployable as an <a href=\"https://docs.aws.amazon.com/eks/latest/userguide/eks-add-ons.html\" target=\"_blank\" rel=\"noopener noreferrer\">EKS add-on</a>, handles pod identity management with minimal operational overhead.</li>\n<li><strong>üîí Secure Access</strong>: Pod Identity ensures that Kubernetes workloads running in EKS securely access external AWS services like S3 using the right IAM roles.</li>\n</ul>\n<h3 id=\"-the-feauture-state-eks-pod-identities\" style=\"position:relative;\"><a href=\"#-the-feauture-state-eks-pod-identities\" aria-label=\" the feauture state eks pod identities permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üí° The f(ea)uture state: EKS Pod Identities</h3>\n<p>Before this enhancement, we used the IAM Roles for Service Accounts (IRSA) model. To give a pod access to, for example, S3, we had to:</p>\n<ol>\n<li>Create an IAM Role with the appropriate IAM Policy.</li>\n<li>Configure its Trust Policy to allow <code class=\"language-text\">AssumeRole</code> and <code class=\"language-text\">TagSession</code> to be executed only from the appropriate cluster.</li>\n<li>Create a Kubernetes ServiceAccount with the ARN of this role in its annotations.</li>\n</ol>\n<h4 id=\"common-issues-with-the-previous-model\" style=\"position:relative;\"><a href=\"#common-issues-with-the-previous-model\" aria-label=\"common issues with the previous model permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Common Issues with the Previous Model:</h4>\n<ul>\n<li><strong>Trust Policy Errors</strong>: Often errors occurred in the Trust Policy, where it was necessary to specify the cluster OIDC.</li>\n<li><strong>ServiceAccount Errors</strong>: Mistakes could be made in the ARN of the role within the ServiceAccount annotations.</li>\n</ul>\n<h3 id=\"-enhanced-mechanism-pod-identity-association\" style=\"position:relative;\"><a href=\"#-enhanced-mechanism-pod-identity-association\" aria-label=\" enhanced mechanism pod identity association permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üîÑ Enhanced mechanism: Pod Identity association</h3>\n<p>AWS EKS has introduced a new enhanced mechanism called <strong>Pod Identity Association</strong> for cluster administrators to configure Kubernetes applications to receive IAM permissions required to connect with AWS services outside of the cluster. Pod Identity Association makes use of IRSA, but it makes it configurable directly through the EKS API, eliminating the need for using the IAM API altogether.</p>\n<p>As a result, IAM roles no longer need to reference an OIDC provider and hence won't be tied to a single cluster anymore. This means IAM roles can now be used across multiple EKS clusters without the need to update the role trust policy each time a new cluster is created. This, in turn, eliminates the need for role duplication and simplifies the process of automating IRSA altogether.</p>\n<h3 id=\"-how-eks-pod-identities-simplify-the-process\" style=\"position:relative;\"><a href=\"#-how-eks-pod-identities-simplify-the-process\" aria-label=\" how eks pod identities simplify the process permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üÜî How EKS Pod Identities Simplify the Process</h3>\n<ol>\n<li><strong>Add a New Controller</strong>: Introduce the Amazon EKS Pod Identity Agent add-on.</li>\n<li><strong>Create an IAM Role</strong>: In the Trust Policy, use <code class=\"language-text\">Principal: pods.eks.amazonaws.com</code>.</li>\n<li><strong>Connect the Role</strong>: Use the AWS CLI, AWS Console, or AWS API to connect this role directly to the desired ServiceAccount.</li>\n</ol>\n<h3 id=\"-pod-identity-vs-iam-roles-for-service-accounts-irsa\" style=\"position:relative;\"><a href=\"#-pod-identity-vs-iam-roles-for-service-accounts-irsa\" aria-label=\" pod identity vs iam roles for service accounts irsa permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üîÑ Pod Identity vs. IAM Roles for Service Accounts (IRSA)</h3>\n<p><span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 52.94117647058824%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAACsElEQVR42jVSTUwTURCelrb0l7Zsa7vYdEPT2LJCURehEPAFpFJq5UeziYhNY00aRcEgwQuHdzIRqRIvEoMN8Scc0HgyBg/Gi5povEnUmKghSiqIiuHgsb7Zdl8ymTczb775ZuaBXSAOfpfkEhqJw84kHN7PDUnE1eBvcIIoG6B0KsqiFYRGh8TiAU9gB8/zZgCii/qipiVZeauF/kRsD0kvGIOjTyr55C2zlC3qAYraQLds5zK3bQKhRkwMBoOVKB6Px8ISTexehQDx9vpIsqthH1ZVCqze9DvRKAJoUBc6OmrX4kdOp2pqOGBgob5JmyiCyhTa5VH3pevPdodCIRszNcUVMPwYJtGtvuNNzK5U3wGjjC3B+9buw6u9/e9+cpwNsm/1Akk7JAA9Ic91GE/l1nsuzv8tZHMfXVnmR99qZ/d04VDvsgI0s7jZApRqVWBkulSaF4h0xcC1ZWyx2IQlSdf86MtMf7AN0M/NsrxUoeaMD02TqcGpLoXhhbnf3whdt0KpZV2aLhjf3D1T7wVwm8M9PCacvPwpNpnf2pavlEARTBRFAyFUYT2W314+l/93X0HvHHkpMF4aZUPYOqWGL5mEQHdW+wY7GGA0apJHHntP5TaS8vgrk9JFUXkPuCSOA1ti5EFLPLO41w1gVVlrMFiqSnQy0+iktKirjg9XSeVZsaN3u91W3LQgCMbyEjTlmEHZ/NnZzbr0wlej0wl2v99fy4THhNT8gbrMw4wAfNaMyYSBo2biDQR4P9MOLJC605k4/2igGREjkYgFxuZ+/cnmvh9EhyRJ5jhjirM8dqP1dTofm0E/IQobdSyKVttOzja/ODHfflVZIhGtkLq2kSB0xQvsU3smnlpQquP3quon25okejSMn5znwVxmZ/T5fCZV0OYl3iUQu0ON/Qf6aLVy/lfVSgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\" alt text\" title=\"\" src=\"/static/c2145156100e69a819951589546b091d/c5bb3/irsa-vs-pia.png\" srcset=\"/static/c2145156100e69a819951589546b091d/04472/irsa-vs-pia.png 170w,\n/static/c2145156100e69a819951589546b091d/9f933/irsa-vs-pia.png 340w,\n/static/c2145156100e69a819951589546b091d/c5bb3/irsa-vs-pia.png 680w,\n/static/c2145156100e69a819951589546b091d/a2b88/irsa-vs-pia.png 908w\" sizes=\"(max-width: 680px) 100vw, 680px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n    </span>\n          </p>\n<ul>\n<li>\n<p><strong>Pod Identity</strong>: This method involves assigning IAM roles directly to Kubernetes pods. It provides fine-grained control over which pods can access specific AWS resources. The AWS EKS Pod Identity Agent handles the credential management, ensuring that pods receive the necessary permissions.</p>\n</li>\n<li>\n<p><strong>IAM Roles for Service Accounts IRSA</strong>: IRSA is a feature that allows you to associate IAM roles with Kubernetes service accounts. When a pod uses a service account, it inherits the permissions of the associated IAM role. This method simplifies the management of permissions at the service account level rather than the individual pod level.</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>Feature</th>\n<th>EKS Pod Identity</th>\n<th>IRSA</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>Role Extensibility</strong></td>\n<td>No need to update the role's trust policy for each new cluster.</td>\n<td>Need to update role's trust policy with new EKS cluster OIDC provider endpoint.</td>\n</tr>\n<tr>\n<td><strong>Cluster Scalability</strong></td>\n<td>No need to setup IAM OIDC provider.</td>\n<td>Need to setup IAM OIDC provider. Default global limit of 100 OIDC providers for AWS account applies.</td>\n</tr>\n<tr>\n<td><strong>Role Scalability</strong></td>\n<td>No need to define trust relationship between IAM role and service account in the trust policy.</td>\n<td>Need to define trust relationship between IAM role and service account in the trust policy. Max of 8 trust relationships within a single trust policy applies due to limit on trust policy size.</td>\n</tr>\n<tr>\n<td><strong>Role Reusability</strong></td>\n<td>AWS STS temporary credentials supplied by EKS Pod Identity include role session tags, such as cluster name, namespace, service account name.</td>\n<td>AWS STS session tags are not supported. You can reuse a role between clusters but every pod receives all of the permissions of the role.</td>\n</tr>\n<tr>\n<td><strong>Environments Supported</strong></td>\n<td>Only available on Amazon EKS.</td>\n<td>IRSA can be used with Amazon EKS, Amazon EKS Anywhere, Red Hat OpenShift Service on AWS, and self-managed Kubernetes clusters on Amazon EC2 instances.</td>\n</tr>\n<tr>\n<td><strong>EKS Versions Supported</strong></td>\n<td>EKS Kubernetes versions 1.24 or later.</td>\n<td>All of the supported EKS cluster versions.</td>\n</tr>\n</tbody>\n</table>\n<h4 id=\"use-cases-for-each-method\" style=\"position:relative;\"><a href=\"#use-cases-for-each-method\" aria-label=\"use cases for each method permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Use cases for each method</h4>\n<ul>\n<li>\n<p><strong>Pod Identity</strong>: Ideal for scenarios where you need granular control over individual pod permissions. It is useful when different pods within the same application require different levels of access to AWS resources.</p>\n</li>\n<li>\n<p><strong>IRSA</strong>: Suitable for managing permissions at a higher level, such as for a group of pods that share the same service account. It simplifies the setup and is easier to manage when multiple pods need the same permissions.</p>\n</li>\n</ul>\n<h3 id=\"technical-details-and-benefits\" style=\"position:relative;\"><a href=\"#technical-details-and-benefits\" aria-label=\"technical details and benefits permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Technical Details and Benefits</h3>\n<ul>\n<li>\n<p><strong>Applications in Pods</strong>: Applications in a pod's containers can use an AWS SDK or the AWS CLI to make API requests to AWS services using IAM permissions. These applications must sign their AWS API requests with AWS credentials.</p>\n</li>\n<li>\n<p><strong>Credential Management</strong>: EKS Pod Identities manage credentials for your applications, similar to how Amazon EC2 instance profiles provide credentials to Amazon EC2 instances.</p>\n</li>\n<li>\n<p><strong>IAM Role Association</strong>: Instead of creating and distributing your AWS credentials to the containers or using the Amazon EC2 instance's role, you associate an IAM role with a Kubernetes service account and configure your pods to use the service account.</p>\n</li>\n<li>\n<p><strong>Pod Identity Agent</strong>: The Pod Identity agent, deployable as an EKS add-on, handles pod identity management with minimal operational overhead.</p>\n</li>\n<li>\n<p><strong>ABAC</strong>: Pod Identity uses attribute-based access control ABAC for more flexible role management.</p>\n</li>\n</ul>\n<h3 id=\"-introduction-to-boto3\" style=\"position:relative;\"><a href=\"#-introduction-to-boto3\" aria-label=\" introduction to boto3 permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üí° Introduction to Boto3</h3>\n<p><a href=\"https://boto3.amazonaws.com/v1/documentation/api/latest/index.html\" target=\"_blank\" rel=\"noopener noreferrer\"><strong>Boto3</strong></a>  is the Amazon Web Services (AWS) SDK for Python. It allows Python developers to write software that makes use of services like Amazon S3 and Amazon EC2. Boto3 provides an easy-to-use, object-oriented API as well as low-level access to AWS services.</p>\n<h4 id=\"benefits-of-using-boto3-for-aws-resource-management\" style=\"position:relative;\"><a href=\"#benefits-of-using-boto3-for-aws-resource-management\" aria-label=\"benefits of using boto3 for aws resource management permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Benefits of Using Boto3 for AWS Resource Management</h4>\n<ul>\n<li><strong>Ease of use</strong>: Boto3 simplifies the process of interacting with AWS services by providing a high-level, Pythonic interface.</li>\n<li><strong>Comprehensive coverage</strong>: It supports a wide range of AWS services, allowing you to manage everything from S3 buckets to EC2 instances.</li>\n<li><strong>Integration</strong>: Boto3 integrates seamlessly with other Python libraries and frameworks, making it a versatile tool for AWS resource management.</li>\n<li><strong>Automation</strong>: With Boto3, you can automate repetitive tasks, such as creating and managing AWS resources, which improves efficiency and reduces the risk of human error.</li>\n<li><strong>Community and support</strong>: As a widely-used SDK, Boto3 has a large community and extensive documentation, making it easier to find help and resources.</li>\n</ul>\n<h3 id=\"-takeaways\" style=\"position:relative;\"><a href=\"#-takeaways\" aria-label=\" takeaways permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üîÑ Takeaways</h3>\n<ul>\n<li><strong>EKS Pod Identity</strong> simplifies the process of granting AWS permissions to Kubernetes pods.</li>\n<li><strong>Pod Identity Association</strong> eliminates the need for OIDC providers and allows IAM roles to be used across multiple clusters.</li>\n<li><strong>Pod Identity</strong> provides fine-grained control over pod permissions, while <strong>IRSA</strong> simplifies permission management at the service account level.</li>\n<li><strong>Boto3</strong> is a great tool for managing AWS resources programmatically with Python.</li>\n</ul>\n<h2 id=\"setting-up-eks-pod-identity\" style=\"position:relative;\"><a href=\"#setting-up-eks-pod-identity\" aria-label=\"setting up eks pod identity permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Setting Up EKS Pod Identity</h2>\n<p>We can create an EKS cluster using <code class=\"language-text\">eksctl</code> with the following configuration:</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token comment\"># cluster.yaml</span>\n<span class=\"token punctuation\">---</span>\n<span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> eksctl.io/v1alpha5\n<span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> ClusterConfig\n\n<span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> eks<span class=\"token punctuation\">-</span>pod<span class=\"token punctuation\">-</span>identity<span class=\"token punctuation\">-</span>boto3\n  <span class=\"token key atrule\">region</span><span class=\"token punctuation\">:</span> eu<span class=\"token punctuation\">-</span>west<span class=\"token punctuation\">-</span><span class=\"token number\">1</span>\n\n<span class=\"token key atrule\">managedNodeGroups</span><span class=\"token punctuation\">:</span>\n  <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> managed<span class=\"token punctuation\">-</span>nodes\n    <span class=\"token key atrule\">instanceType</span><span class=\"token punctuation\">:</span> m5.large\n    <span class=\"token key atrule\">minSize</span><span class=\"token punctuation\">:</span> <span class=\"token number\">2</span>\n    <span class=\"token key atrule\">desiredCapacity</span><span class=\"token punctuation\">:</span> <span class=\"token number\">3</span>\n    <span class=\"token key atrule\">maxSize</span><span class=\"token punctuation\">:</span> <span class=\"token number\">4</span>\n    <span class=\"token key atrule\">availabilityZones</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"eu-west-1a\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"eu-west-1b\"</span><span class=\"token punctuation\">]</span>\n    <span class=\"token key atrule\">volumeSize</span><span class=\"token punctuation\">:</span> <span class=\"token number\">20</span>\n    <span class=\"token key atrule\">updateConfig</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">maxUnavailable</span><span class=\"token punctuation\">:</span> <span class=\"token number\">3</span> \n    <span class=\"token key atrule\">securityGroups</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">attachIDs</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"sg-1\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"sg-2\"</span><span class=\"token punctuation\">]</span></code></pre></div>\n<p>Create the cluster with:</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">$ eksctl create cluster <span class=\"token parameter variable\">-f</span> cluster.yaml</code></pre></div>\n<h3 id=\"step-by-step-guide-to-creating-an-iam-role\" style=\"position:relative;\"><a href=\"#step-by-step-guide-to-creating-an-iam-role\" aria-label=\"step by step guide to creating an iam role permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Step-by-Step Guide to Creating an IAM Role</h3>\n<ol>\n<li>\n<p><strong>Create an IAM Role</strong>:</p>\n<ul>\n<li>Go to the IAM console.</li>\n<li>Click on <strong>Roles</strong> and then <strong>Create role</strong>.</li>\n<li>Select <strong>EKS</strong> as the trusted entity and choose <strong>EKS - Pod</strong>.</li>\n<li>Attach the necessary policies (e.g., <code class=\"language-text\">AmazonS3ReadOnlyAccess</code> for S3 access).</li>\n<li>Name the role (e.g., <code class=\"language-text\">EKS-S3-Access-Role</code>) and create it.</li>\n</ul>\n</li>\n<li>\n<p><strong>Update the Trust Policy</strong>:</p>\n<ul>\n<li>Go to the IAM role you just created.</li>\n<li>Under the <strong>Trust relationships</strong> tab, click <strong>Edit trust relationship</strong>.</li>\n<li>Update the trust policy to allow the <code class=\"language-text\">pods.eks.amazonaws.com</code> principal.</li>\n</ul>\n</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\n  <span class=\"token property\">\"Version\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"2012-10-17\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"Statement\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n    <span class=\"token punctuation\">{</span>\n      <span class=\"token property\">\"Effect\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Allow\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"Principal\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token property\">\"Service\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"eks.amazonaws.com\"</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"Action\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"sts:AssumeRole\"</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"sts:TagSession\"</span><span class=\"token punctuation\">]</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h3 id=\"associating-the-iam-role-with-a-kubernetes-service-account\" style=\"position:relative;\"><a href=\"#associating-the-iam-role-with-a-kubernetes-service-account\" aria-label=\"associating the iam role with a kubernetes service account permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Associating the IAM Role with a Kubernetes Service Account</h3>\n<blockquote>\n<p><strong>Note</strong>: Unlike IAM roles for service accounts, EKS Pod Identity doesn't use an annotation on the service account.</p>\n</blockquote>\n<h4 id=\"create-a-kubernetes-service-account\" style=\"position:relative;\"><a href=\"#create-a-kubernetes-service-account\" aria-label=\"create a kubernetes service account permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Create a Kubernetes Service Account</h4>\n<p>Create a service account in your Kubernetes cluster.</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> v1\n<span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> ServiceAccount\n<span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> s3<span class=\"token punctuation\">-</span>access<span class=\"token punctuation\">-</span>sa\n  <span class=\"token key atrule\">namespace</span><span class=\"token punctuation\">:</span> default</code></pre></div>\n<h4 id=\"apply-the-service-account\" style=\"position:relative;\"><a href=\"#apply-the-service-account\" aria-label=\"apply the service account permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Apply the Service Account</h4>\n<p>Apply the service account configuration to your cluster.</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">$ kubectl apply <span class=\"token parameter variable\">-f</span> service-account.yaml</code></pre></div>\n<h3 id=\"installing-the-pod-identity-agent\" style=\"position:relative;\"><a href=\"#installing-the-pod-identity-agent\" aria-label=\"installing the pod identity agent permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Installing the Pod Identity Agent</h3>\n<h4 id=\"install-the-pod-identity-agent\" style=\"position:relative;\"><a href=\"#install-the-pod-identity-agent\" aria-label=\"install the pod identity agent permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Install the Pod Identity Agent</h4>\n<p>Use the AWS CLI to install the Pod Identity Agent as an EKS add-on.</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">$ aws eks create-addon --cluster-name eks-pod-identity-boto3 --addon-name eks-pod-identity-agent --addon-version v1.0.0-eksbuild.1</code></pre></div>\n<p>Confirm that the EKS Pod Identity Agent pods are running on your cluster.</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">$ kubectl get pods <span class=\"token parameter variable\">-n</span> kube-system <span class=\"token operator\">|</span> <span class=\"token function\">grep</span> <span class=\"token string\">'eks-pod-identity-agent'</span></code></pre></div>\n<h3 id=\"creating-a-pod-identity-association\" style=\"position:relative;\"><a href=\"#creating-a-pod-identity-association\" aria-label=\"creating a pod identity association permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Creating a Pod Identity Association</h3>\n<p>Create a pod identity association using the AWS CLI:</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">$ aws eks create-pod-identity-association <span class=\"token punctuation\">\\</span>\n  --cluster-name eks-pod-identity-boto3 <span class=\"token punctuation\">\\</span>\n  <span class=\"token parameter variable\">--namespace</span> default <span class=\"token punctuation\">\\</span>\n  --service-account s3-access-sa <span class=\"token punctuation\">\\</span>\n  --role-arn arn:aws:iam::012345678901:role/EKS-S3-Access-Role</code></pre></div>\n<p>Ensure the IAM role has the following trust policy:</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\n  <span class=\"token property\">\"Version\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"2012-10-17\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"Statement\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"Effect\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Allow\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"Principal\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token property\">\"Service\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"pods.eks.amazonaws.com\"</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"Action\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"sts:AssumeRole\"</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"sts:TagSession\"</span><span class=\"token punctuation\">]</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h2 id=\"deploying-a-test-pod\" style=\"position:relative;\"><a href=\"#deploying-a-test-pod\" aria-label=\"deploying a test pod permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Deploying a test Pod</h2>\n<h3 id=\"creating-a-kubernetes-pod-spec\" style=\"position:relative;\"><a href=\"#creating-a-kubernetes-pod-spec\" aria-label=\"creating a kubernetes pod spec permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Creating a Kubernetes Pod Spec</h3>\n<p>Create a Kubernetes pod specification that uses the service account with the IAM role.</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> v1\n<span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> Pod\n<span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> s3<span class=\"token punctuation\">-</span>list<span class=\"token punctuation\">-</span>pod\n  <span class=\"token key atrule\">namespace</span><span class=\"token punctuation\">:</span> default\n<span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">serviceAccountName</span><span class=\"token punctuation\">:</span> s3<span class=\"token punctuation\">-</span>access<span class=\"token punctuation\">-</span>sa\n  <span class=\"token key atrule\">containers</span><span class=\"token punctuation\">:</span>\n  <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> s3<span class=\"token punctuation\">-</span>list<span class=\"token punctuation\">-</span>container\n    <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> amazonlinux\n    <span class=\"token key atrule\">command</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"/bin/sh\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"-c\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"while true; do sleep 30; done;\"</span><span class=\"token punctuation\">]</span></code></pre></div>\n<p>Save this specification to a file named <code class=\"language-text\">pod-spec.yaml</code>.</p>\n<h3 id=\"deploying-the-pod-with-the-service-account\" style=\"position:relative;\"><a href=\"#deploying-the-pod-with-the-service-account\" aria-label=\"deploying the pod with the service account permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Deploying the Pod with the Service Account</h3>\n<p>Apply the pod specification to your Kubernetes cluster.</p>\n<div class=\"gatsby-highlight\" data-language=\"sh\"><pre class=\"language-sh\"><code class=\"language-sh\">kubectl apply <span class=\"token parameter variable\">-f</span> pod-spec.yaml</code></pre></div>\n<p>Verify that the pod is running.</p>\n<div class=\"gatsby-highlight\" data-language=\"sh\"><pre class=\"language-sh\"><code class=\"language-sh\">kubectl get pods <span class=\"token parameter variable\">-n</span> default</code></pre></div>\n<h2 id=\"using-boto3-inside-the-pod\" style=\"position:relative;\"><a href=\"#using-boto3-inside-the-pod\" aria-label=\"using boto3 inside the pod permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Using Boto3 Inside the Pod</h2>\n<h3 id=\"accessing-the-pod-and-installing-boto3\" style=\"position:relative;\"><a href=\"#accessing-the-pod-and-installing-boto3\" aria-label=\"accessing the pod and installing boto3 permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Accessing the Pod and Installing Boto3</h3>\n<p>Use <code class=\"language-text\">kubectl exec</code> to access the pod.</p>\n<div class=\"gatsby-highlight\" data-language=\"sh\"><pre class=\"language-sh\"><code class=\"language-sh\">kubectl <span class=\"token builtin class-name\">exec</span> <span class=\"token parameter variable\">-it</span> s3-list-pod -- /bin/bash</code></pre></div>\n<p>Inside the pod, install Boto3 using pip.</p>\n<div class=\"gatsby-highlight\" data-language=\"sh\"><pre class=\"language-sh\"><code class=\"language-sh\">yum <span class=\"token function\">install</span> <span class=\"token parameter variable\">-y</span> python3-pip\npip3 <span class=\"token function\">install</span> boto3</code></pre></div>\n<h3 id=\"writing-a-python-script-to-list-s3-bucket-objects\" style=\"position:relative;\"><a href=\"#writing-a-python-script-to-list-s3-bucket-objects\" aria-label=\"writing a python script to list s3 bucket objects permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Writing a Python Script to List S3 Bucket Objects</h3>\n<p>Create a Python script to list objects in an S3 bucket. Save this script as <code class=\"language-text\">list_s3_objects.py</code>.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">import</span> boto3\n\n<span class=\"token comment\"># Create a session using the default credentials chain</span>\nsession <span class=\"token operator\">=</span> boto3<span class=\"token punctuation\">.</span>Session<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\"># Create an S3 client</span>\ns3 <span class=\"token operator\">=</span> session<span class=\"token punctuation\">.</span>client<span class=\"token punctuation\">(</span><span class=\"token string\">'s3'</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\"># List all buckets</span>\nresponse <span class=\"token operator\">=</span> s3<span class=\"token punctuation\">.</span>list_buckets<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\"># Print bucket names</span>\n<span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Buckets:\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">for</span> bucket <span class=\"token keyword\">in</span> response<span class=\"token punctuation\">[</span><span class=\"token string\">'Buckets'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string-interpolation\"><span class=\"token string\">f\"  </span><span class=\"token interpolation\"><span class=\"token punctuation\">{</span>bucket<span class=\"token punctuation\">[</span><span class=\"token string\">'Name'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">}</span></span><span class=\"token string\">\"</span></span><span class=\"token punctuation\">)</span></code></pre></div>\n<h3 id=\"running-the-script-and-verifying-access\" style=\"position:relative;\"><a href=\"#running-the-script-and-verifying-access\" aria-label=\"running the script and verifying access permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Running the Script and Verifying Access</h3>\n<p>Run the Python script inside the pod.</p>\n<div class=\"gatsby-highlight\" data-language=\"sh\"><pre class=\"language-sh\"><code class=\"language-sh\">python3 list_s3_objects.py</code></pre></div>\n<p>Check the output to verify that the script lists the S3 buckets.</p>\n<div class=\"gatsby-highlight\" data-language=\"sh\"><pre class=\"language-sh\"><code class=\"language-sh\">kubectl logs s3-list-pod</code></pre></div>\n<h2 id=\"conclusion\" style=\"position:relative;\"><a href=\"#conclusion\" aria-label=\"conclusion permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Conclusion</h2>\n<p>In this blog post, we explored how to securely manage AWS resources using the AWS EKS Pod Identity Agent and Boto3. We began by understanding the importance of managing AWS resources securely and introduced the concept of Pod Identity in Kubernetes, highlighting its implementation in Amazon EKS.</p>\n<p>We then provided a detailed, step-by-step guide to setting up EKS Pod Identity, including creating an IAM role, associating it with a Kubernetes service account, and installing the Pod Identity Agent. Following this, we demonstrated how to deploy a test pod and use Boto3 inside the pod to list S3 bucket objects.</p>\n<p>By using these tools, you can enhance security, simplify management, and increase the flexibility and scalability of your AWS resource management.</p>\n<h2 id=\"-additional-resources\" style=\"position:relative;\"><a href=\"#-additional-resources\" aria-label=\" additional resources permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üìªüß° Additional Resources</h2>\n<ul>\n<li><a href=\"https://docs.aws.amazon.com/eks/latest/userguide/pod-id-how-it-works.html\" target=\"_blank\" rel=\"noopener noreferrer\">AWS EKS Pod Identity agent documentation</a></li>\n<li><a href=\"https://boto3.amazonaws.com/v1/documentation/api/latest/index.html\" target=\"_blank\" rel=\"noopener noreferrer\">Boto3 documentation</a></li>\n<li><a href=\"https://kubernetes.io/docs/concepts/security/service-accounts/\" target=\"_blank\" rel=\"noopener noreferrer\">Kubernetes Service accounts</a></li>\n<li><a href=\"https://docs.aws.amazon.com/eks/latest/userguide/iam-roles-for-service-accounts.html\" target=\"_blank\" rel=\"noopener noreferrer\">IAM Roles for Service Accounts (IRSA)</a></li>\n<li><a href=\"https://docs.aws.amazon.com/eks/latest/userguide/what-is-eks.html\" target=\"_blank\" rel=\"noopener noreferrer\">Amazon EKS documentation</a></li>\n<li><a href=\"https://kubernetes.io/docs/reference/access-authn-authz/rbac/\" target=\"_blank\" rel=\"noopener noreferrer\">Kubernetes RBAC</a></li>\n<li><a href=\"https://docs.aws.amazon.com/IAM/latest/UserGuide/introduction_attribute-based-access-control.html\" target=\"_blank\" rel=\"noopener noreferrer\">AWS ABAC</a></li>\n</ul>\n<p>Further reading on Kubernetes, EKS, and Boto3:</p>\n<ul>\n<li><a href=\"https://kubernetes.io/docs/concepts/\" target=\"_blank\" rel=\"noopener noreferrer\">Kubernetes documentation</a></li>\n<li><a href=\"https://aws.github.io/aws-eks-best-practices/\" target=\"_blank\" rel=\"noopener noreferrer\">Amazon EKS best practices Guide</a></li>\n<li><a href=\"https://github.com/boto/boto3\" target=\"_blank\" rel=\"noopener noreferrer\">Boto3 GitHub repository</a></li>\n<li><a href=\"https://github.com/aws/eks-pod-identity-agent\" target=\"_blank\" rel=\"noopener noreferrer\">Pod Agent GitHub repository</a></li>\n<li><a href=\"https://github.com/aws-ia/terraform-aws-eks-blueprints-addons\" target=\"_blank\" rel=\"noopener noreferrer\">EKS addons GitHub repository</a></li>\n</ul>\n<br>\n<br>\n<blockquote>\n<p>üí° Thank you for Reading !! üôåüèªüòÅüìÉ, see you in the next blog.ü§ò  <em><strong>Until next time üéâ</strong></em></p>\n</blockquote>\n<p>üöÄ Thank you for sticking up till the end. If you have any questions/feedback regarding this blog feel free to connect with me:</p>\n<p><strong>‚ôªÔ∏è LinkedIn:</strong> <a href=\"https://www.linkedin.com/in/rajhi-saif/\" target=\"_blank\" rel=\"noopener noreferrer\">https://www.linkedin.com/in/rajhi-saif/</a></p>\n<p><strong>‚ôªÔ∏è X/Twitter:</strong> <a href=\"https://x.com/rajhisaifeddine\" target=\"_blank\" rel=\"noopener noreferrer\">https://x.com/rajhisaifeddine</a></p>\n<p><strong>The end ‚úåüèª</strong></p>\n<h1 align=\"center\">üî∞ Keep Learning !! Keep Sharing !! üî∞</h1>\n<p><strong>üìÖ Stay updated</strong></p>\n<p>Subscribe to our newsletter for more insights on AWS cloud computing and containers.</p>"},"nextThought":{"frontmatter":{"path":"/blog/ai-and-kubernetes/","title":"AI and Kubernetes: Open Source Tools powered by AI/OpenAI for Kubernetes","date":"2024-10-01 13:34:00"},"excerpt":"Kubernetes & AI team-up üìö Introduction AI is generating a lot of buzz these days, and the Kubernetes-powered DevOps world is no exception‚Ä¶","html":"<blockquote>\n<p><strong>Kubernetes &#x26; AI team-up</strong></p>\n</blockquote>\n<h2 id=\"-introduction\" style=\"position:relative;\"><a href=\"#-introduction\" aria-label=\" introduction permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üìö Introduction</h2>\n<p>AI is generating a lot of buzz these days, and the Kubernetes-powered DevOps world is no exception. Software engineers are huge automation enthusiasts, so it‚Äôs natural that AI-powered tools for Kubernetes operators are starting to pop up.</p>\n<p>Most of these tools are designed for terminal (CLI) usage. Kubernetes is the go-to platform for container orchestration, but its complexity can be daunting. AI-powered tools can help you master Kubernetes by automating tasks, improving reliability, and providing insights.</p>\n<p>One of the most promising AI platforms for Kubernetes AIOps is OpenAI. OpenAI provides a suite of open-source tools that can be used to build AI-powered solutions for Kubernetes.</p>\n<p><span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 58.235294117647065%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAABYlAAAWJQFJUiTwAAADYklEQVR42hXS6U8bBACG8X73k4lfjV/VqdHplmyOsXHohi0boQy2QSmlpcegLbR00BMYtByldLDCBhTWja5ydgxoC24Nh7CBEJwcoi6dibqYuCwmmqgYfax/wfPml1fQ/GAWw/IGNZt76AIBqsdGqJua5ObUp4Se7OGOxbi9t8Ojp5t0zsdpnF+kd+cLhkZMNMYncC0/wvFwDfvSMor4CoLwr8+YfvEzdxNfE6hXMjkzRtNomDKzBY3ThVhr5JyulguVVk5JK5E5molMeJitT2dmOczqi6eM//acO89/pOOHnxDM/gOr3z/mUk2yaNaxcj+C1eXisCqF42WZvJ93nLTCLN4UfsjLH7xNVqmCla1Nlk1VJIwVbO7Os/jXPrH9vxn5cx/BL8D61jryqgrUDS4W5qYZCA2Tqs0kTfsJhy6eJFsr5mBBCq8cfQuxRs/WV2v0ebqwlVSzEenlWbyVuUA72/+CwBsM4PAHOWawoVKXsD1oIxSZ5XXhMd4RHeW1jMMcEJ3g1bT3eOndNzgtlRF2VyEsLeZghQ1zXS1ttiJsWj3x3QSCI9lnEZebOCOTY67UEPXXs7Rwn9bu6zRc68HU0s4RUS4WbzcVTje3xyewa4tQX9aRJVORr7OSKSlDqLATjCwiOFtSjMziJEsiIadMT5Oznm/mBhmdCNPS2kw0vkRPeIXhUBC/x8G3iQT1fe2MDoixGlLRqeVIpAXJxZep659A8PH5cwhl5dSYlFiMSqYHWtj6bpf+0C3sknTuztzDF9um3+fGKD7J2s4GcyNdzF/V45afQC+9iEUhIb3QgKw1iCAjLx+19hIPvOU4LEam5xeY/CxG12yU05kpyaoff083apuVImkhAV8TyuFxOn1yXM05DN4KEw0+5LyikaLeUQQiWRld648xNTUQcavY/nKN4YFOLK5O2oJRyl39uK0Gqg3lNLW10+e1Mea3472Ry9SYktWBDu61WhCV1CINxRAonR3oJ1ewXu9hyF5KsaqEa8kLOL03sN+M03B1EHuS4lCuhNQ8CaU2M9YaFc6KPO50FNBs9mFUjZCRNFREP0fgDvaj7R6is1ZKmyYbzYVT2OUi+q6oqJLn47Go8DnkyCU51Gr+9zpDjSobvURIj03MR1UGDnimuPIkgef3P/gPykxwuhHsDkwAAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"AI photo\" title=\"\" src=\"/static/52788c73b6cd9c0756a021afb85d4dc3/c5bb3/overview.png\" srcset=\"/static/52788c73b6cd9c0756a021afb85d4dc3/04472/overview.png 170w,\n/static/52788c73b6cd9c0756a021afb85d4dc3/9f933/overview.png 340w,\n/static/52788c73b6cd9c0756a021afb85d4dc3/c5bb3/overview.png 680w,\n/static/52788c73b6cd9c0756a021afb85d4dc3/b12f7/overview.png 1020w,\n/static/52788c73b6cd9c0756a021afb85d4dc3/4e814/overview.png 1335w\" sizes=\"(max-width: 680px) 100vw, 680px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n    </span>\n          </p>\n<h2 id=\"overview\" style=\"position:relative;\"><a href=\"#overview\" aria-label=\"overview permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Overview</h2>\n<p>Kubernetes users inevitably encounter cluster issues that require debugging and fixing to keep their pods and services running smoothly. Whether you are new to Kubernetes or managing large and complex environments, debugging in-cluster processes can be challenging and time-consuming.</p>\n<p>Cloud-native DevOps involves a lot of complexity in managing containers, microservices and autoscaling capabilities. Generative AI could help troubleshoot and perform some of the operational tasks associated with platforms like Kubernetes. This could involve using natural language prompts to spin up, roll back or get visibility into clusters.</p>\n<p>For example, at <a href=\"https://thenewstack.io/kubiya-launches-first-generative-ai-for-platform-engineering/\" target=\"_blank\" rel=\"noopener noreferrer\">KubeCon + CloudNativeCon 2023</a>, Kubiya debuted a generative AI workflow engine that's able to interpret such commands from within Slack. Extending natural language processing might aid platform teams in creating new workflows that abstract the complexity of working <a href=\"https://cloudnativenow.com/features/2023-marks-the-rise-of-cloud-native-platforms/\" target=\"_blank\" rel=\"noopener noreferrer\">with cloud-native platforms</a>.</p>\n<h2 id=\"-k8sgpt\" style=\"position:relative;\"><a href=\"#-k8sgpt\" aria-label=\" k8sgpt permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>‚ú® k8sgpt</h2>\n<p><a href=\"https://github.com/k8sgpt-ai/k8sgpt\" target=\"_blank\" rel=\"noopener noreferrer\">K8sGPT</a> is a relatively new open source project that uses AI models to explain Kubernetes error messages and provide cluster insights. It is already used by two organizations in production and has applied to become a CNCF sandbox project.</p>\n<p>K8sGPT Features:</p>\n<ul>\n<li>Provides detailed and contextualized explanations of Kubernetes error messages.</li>\n<li>Provides cluster insights.</li>\n<li>Supports multiple installation options.</li>\n<li>Supports different AI backends.</li>\n</ul>\n<p>K8sgpt is the most well-known and widely used project of its kind. Launched by <a href=\"https://x.com/AlexJonesax\" target=\"_blank\" rel=\"noopener noreferrer\">Alex Jones</a>, it is marketed as a way to \"give Kubernetes superpowers to everyone.\"</p>\n<p>K8sgpt is a CLI tool with a primary command, <code class=\"language-text\">k8sgpt analyze</code>, which is designed to reveal problems in your Kubernetes cluster. It does this by using \"analyzers,\" which define the logic for each Kubernetes object and the possible problems it may be encountering. For example, an analyzer for Kubernetes Services will check whether a particular Service exists and has endpoints, and whether its endpoints are ready.</p>\n<p>Identifying such an issue is not a big deal in and of itself, but the magic happens when you ask k8sgpt to explain what you can do about it. To do this, you run the command <code class=\"language-text\">k8sgpt analyze --explain</code>. This will ask the AI for instructions for your specific case and display them for you.</p>\n<p>The instructions will include the actions to take to troubleshoot the problem, including specific kubectl commands that you can execute by simply copying and pasting them. This is made possible by the fact that the names of your Kubernetes resources are already in place.</p>\n<p><img src=\"/1e235c7f3630387594e2e75858e3f862/k8sgpt-analyse.gif\" alt=\"AI photo\" loading=\"lazy\">\n          </p>\n<h3 id=\"installation\" style=\"position:relative;\"><a href=\"#installation\" aria-label=\"installation permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Installation</h3>\n<p>There are several installation options available depending on your preferences and Operating system. You can find the different options in <a href=\"https://docs.k8sgpt.ai/getting-started/installation/\" target=\"_blank\" rel=\"noopener noreferrer\">the installation section of the documentation</a>.\nThe prerequisite for installing K8sGPT as mentioned below is to have <a href=\"https://brew.sh\" target=\"_blank\" rel=\"noopener noreferrer\">Homebrew</a> installed either on your Mac or WSL on your Windows machine.</p>\n<p>Next, you can run the following commands:</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">brew tap k8sgpt-ai/k8sgpt\nbrew <span class=\"token function\">install</span> k8sgpt</code></pre></div>\n<p>To view all the commands provided by K8sGPT, used the <code class=\"language-text\">--help</code> flag:</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">k8sgpt <span class=\"token parameter variable\">--help</span></code></pre></div>\n<p>You can see an overview of the different commands also <a href=\"https://docs.k8sgpt.ai/reference\" target=\"_blank\" rel=\"noopener noreferrer\">on the documentation</a>.</p>\n<p>Next, we will have to authorise an AI backend. In this video, we will use OpenAI.</p>\n<h3 id=\"prerequisites\" style=\"position:relative;\"><a href=\"#prerequisites\" aria-label=\"prerequisites permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Prerequisites</h3>\n<p>The prerequisites to follow the next sections is to have an OpneAI account and a running Kubernetes cluster; any cluster, such as microk8s or minikube will be sufficient.\nOnce you have the OpneAI account, you want to go to the following site to generate a new <a href=\"https://platform.openai.com/account/api-keys\" target=\"_blank\" rel=\"noopener noreferrer\">API key</a>.\nAlternatively, you can run the following command and K8sGPT will open the same site in your default Browser:</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">k8sgpt generate</code></pre></div>\n<p>This key is needed for K8sGPT to interact with OpenAI. Authorise K8sGPT with the newly created API key/token:</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">k8sgpt auth <span class=\"token function\">add</span> openai\nEnter openai Key: openai added to the AI backend provider list</code></pre></div>\n<p>You can list your backends with the following command:</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">k8sgpt auth list\nDefault:\n<span class=\"token operator\">></span> openai\nActive:\n<span class=\"token operator\">></span> openai\nUnused:\n<span class=\"token operator\">></span> localai\n<span class=\"token operator\">></span> azureopenai\n<span class=\"token operator\">></span> noopai</code></pre></div>\n<p>Again, <a href=\"https://docs.k8sgpt.ai/reference/providers/backend/?ref=anaisurl.com\" target=\"_blank\" rel=\"noopener noreferrer\">our documentation</a> provides further information on the different AI backends available.</p>\n<p>Next, we will install a malicious Deployment into our Kubernetes cluster. The pod will go into CrashLoopBackOff. Here is the YAML:</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> apps/v1\n<span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> Deployment\n<span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> nginx<span class=\"token punctuation\">-</span>deployment\n  <span class=\"token key atrule\">labels</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">app</span><span class=\"token punctuation\">:</span> nginx\n<span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">replicas</span><span class=\"token punctuation\">:</span> <span class=\"token number\">3</span>\n  <span class=\"token key atrule\">selector</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">matchLabels</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">app</span><span class=\"token punctuation\">:</span> nginx\n  <span class=\"token key atrule\">template</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">labels</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">app</span><span class=\"token punctuation\">:</span> nginx\n    <span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">containers</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> nginx\n        <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> nginx<span class=\"token punctuation\">:</span>1.14.2\n        <span class=\"token key atrule\">ports</span><span class=\"token punctuation\">:</span>\n        <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">containerPort</span><span class=\"token punctuation\">:</span> <span class=\"token number\">80</span>\n        <span class=\"token key atrule\">securityContext</span><span class=\"token punctuation\">:</span>\n          <span class=\"token key atrule\">readOnlyRootFilesystem</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span></code></pre></div>\n<p>Next, we will create a dedicated namespace for our example application and install the Deployment:</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">kubectl create ns demo\nnamespace/demo created</code></pre></div>\n<p>Then we apply the manifest:</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">kubectl apply <span class=\"token parameter variable\">-f</span> ./deployment.yaml <span class=\"token parameter variable\">-n</span> demo\ndeployment.apps/nginx-deployment created</code></pre></div>\n<p>Now you will see the pods in our demo namespace throwing errors:</p>\n<p><span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 20.58823529411765%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA8ElEQVR42h2M206EMBRFKw0wMHTacitTOgMoCFETjf6A8Ybxwfj/H3O2TB9Wstc+F7ZOGt9Dgs8uxteQ4s2FeD9Fng9PiJ9Z42/O8btIrNuOn50vxN5fLfe+9glYf3YotISMOZaxw3zTYewsmpRDcIY9v4KrNJKAoSkUJlejihj6toYzBabe4XY4obc1jmUOZu6eIWoLHkYw9y8oxgcIOyCtHSKhEEQxxLEDYwzCtMiH2WfdTVDuGtXyuPHk/WDPYNK0tNclhbuUZNOS2hCVoYOxW19QwDklUtH2hHZCUlbUPmd5SanK/c2FLK8olZr+AZYQZgH4K6Q+AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"Errors in demo namespace\" title=\"\" src=\"/static/bed8b921d9c084b0f8c4e750dea427f3/c5bb3/errors.png\" srcset=\"/static/bed8b921d9c084b0f8c4e750dea427f3/04472/errors.png 170w,\n/static/bed8b921d9c084b0f8c4e750dea427f3/9f933/errors.png 340w,\n/static/bed8b921d9c084b0f8c4e750dea427f3/c5bb3/errors.png 680w,\n/static/bed8b921d9c084b0f8c4e750dea427f3/b12f7/errors.png 1020w,\n/static/bed8b921d9c084b0f8c4e750dea427f3/b5a09/errors.png 1360w,\n/static/bed8b921d9c084b0f8c4e750dea427f3/29007/errors.png 1600w\" sizes=\"(max-width: 680px) 100vw, 680px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n    </span>\n          </p>\n<p>If we look at the events for one of the pods, we will not become much smarter:</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">Warning  BackOff\t3s <span class=\"token punctuation\">(</span>x8 over 87s<span class=\"token punctuation\">)</span>  kubelet        \tBack-off restarting failed container</code></pre></div>\n<p>So what we can do instead to access more details on why these pods are erroring, we can run a K8sGPT command:</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">k8sgpt analyse</code></pre></div>\n<p>This will show us the problems that k8sGPT found inside our cluster:</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">AI Provider: openai</code></pre></div>\n<p>To receive further information as well as recommendations on how to fix the issues, we can use the --explain flag:</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">k8sgpt analyse <span class=\"token parameter variable\">--explain</span>\n<span class=\"token number\">0</span> demo/nginx-deployment-5f4c7db77b-hq74n<span class=\"token punctuation\">(</span>Deployment/nginx-deployment<span class=\"token punctuation\">)</span>\n- Error: back-off 1m20s restarting failed <span class=\"token assign-left variable\">container</span><span class=\"token operator\">=</span>nginx <span class=\"token assign-left variable\">pod</span><span class=\"token operator\">=</span>nginx-deployment-5f4c7db77b-hq74n_demo<span class=\"token punctuation\">(</span>7854b793-21b7-4f81-86e5-dbb4113f64f4<span class=\"token punctuation\">)</span>\n<span class=\"token number\">1</span> demo/nginx-deployment-5f4c7db77b-phbq8<span class=\"token punctuation\">(</span>Deployment/nginx-deployment<span class=\"token punctuation\">)</span>\n- Error: back-off 1m20s restarting failed <span class=\"token assign-left variable\">container</span><span class=\"token operator\">=</span>nginx <span class=\"token assign-left variable\">pod</span><span class=\"token operator\">=</span>nginx-deployment-5f4c7db77b-phbq8_demo<span class=\"token punctuation\">(</span><span class=\"token number\">74038531</span>-e362-45a6-a436-cf1a6ea46d8a<span class=\"token punctuation\">)</span>\n<span class=\"token number\">2</span> demo/nginx-deployment-5f4c7db77b-shkw6<span class=\"token punctuation\">(</span>Deployment/nginx-deployment<span class=\"token punctuation\">)</span>\n- Error: back-off 1m20s restarting failed <span class=\"token assign-left variable\">container</span><span class=\"token operator\">=</span>nginx <span class=\"token assign-left variable\">pod</span><span class=\"token operator\">=</span>nginx-deployment-5f4c7db77b-shkw6_demo<span class=\"token punctuation\">(</span>2603f332-3e1c-45da-8080-e34dd6d956ad<span class=\"token punctuation\">)</span></code></pre></div>\n<h2 id=\"-kubectl-ai-project\" style=\"position:relative;\"><a href=\"#-kubectl-ai-project\" aria-label=\" kubectl ai project permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>‚ú® kubectl-ai project</h2>\n<p><a href=\"https://github.com/sozercan/kubectl-ai\" target=\"_blank\" rel=\"noopener noreferrer\">This project</a> is a kubectl plugin to generate and apply Kubernetes manifests using OpenAI GPT. To make it more interesting and understand in a visualized way, we will make use of Kubectl + OpenAI plugin.</p>\n<h3 id=\"installation-1\" style=\"position:relative;\"><a href=\"#installation-1\" aria-label=\"installation 1 permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Installation</h3>\n<p><strong>Homebrew:</strong></p>\n<p>Add to brew tap and install with:</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">brew tap sozercan/kubectl-ai https://github.com/sozercan/kubectl-ai\nbrew <span class=\"token function\">install</span> kubectl-ai</code></pre></div>\n<p><strong>Krew:</strong>\nAdd to krew index and install with:</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">kubectl krew index <span class=\"token function\">add</span> kubectl-ai https://github.com/sozercan/kubectl-ai\nkubectl krew <span class=\"token function\">install</span> kubectl-ai/kubectl-ai</code></pre></div>\n<h3 id=\"usage\" style=\"position:relative;\"><a href=\"#usage\" aria-label=\"usage permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Usage</h3>\n<p><strong>Prerequisites:</strong></p>\n<p>kubectl-ai requires a valid Kubernetes configuration and one of the following:</p>\n<ul>\n<li><a href=\"https://platform.openai.com/overview\" target=\"_blank\" rel=\"noopener noreferrer\">OpenAI API key</a></li>\n<li><a href=\"https://aka.ms/azure-openai\" target=\"_blank\" rel=\"noopener noreferrer\">Azure OpenAI Service API key and endpoint</a></li>\n<li><a href=\"https://github.com/go-skynet/LocalAI\" target=\"_blank\" rel=\"noopener noreferrer\">Local AI</a> (see <a href=\"https://localai.io/basics/getting_started/index.html\" target=\"_blank\" rel=\"noopener noreferrer\">getting started</a>)</li>\n</ul>\n<p>For OpenAI, Azure OpenAI or LocalAI, you can use the following environment variables:</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token builtin class-name\">export</span> <span class=\"token assign-left variable\">OPENAI_API_KEY</span><span class=\"token operator\">=</span><span class=\"token operator\">&lt;</span>your OpenAI key<span class=\"token operator\">></span>\n<span class=\"token builtin class-name\">export</span> <span class=\"token assign-left variable\">OPENAI_DEPLOYMENT_NAME</span><span class=\"token operator\">=</span><span class=\"token operator\">&lt;</span>your OpenAI deployment/model name. defaults to <span class=\"token string\">\"gpt-3.5-turbo-0301\"</span><span class=\"token operator\">></span>\n<span class=\"token builtin class-name\">export</span> <span class=\"token assign-left variable\">OPENAI_ENDPOINT</span><span class=\"token operator\">=</span><span class=\"token operator\">&lt;</span>your OpenAI endpoint, like <span class=\"token string\">\"https://my-aoi-endpoint.openai.azure.com\"</span> or <span class=\"token string\">\"http://localhost:8080/v1\"</span><span class=\"token operator\">></span></code></pre></div>\n<p>If <code class=\"language-text\">OPENAI_ENDPOINT</code> variable is set, then it will use the endpoint. Otherwise, it will use OpenAI API.</p>\n<p>Azure OpenAI service does not allow certain characters, such as¬†., in the deployment name. Consequently, kubectl-ai will automatically replace <code class=\"language-text\">gpt-3</code>.<code class=\"language-text\">5-turbo</code> to <code class=\"language-text\">gpt-35-turbo</code> for Azure. However, if you use an Azure OpenAI deployment name completely different from the model name, you can set <code class=\"language-text\">AZURE_OPENAI_MAP</code> environment variable to map the model name to the <strong>Azure OpenAI</strong> deployment name. For example:</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token builtin class-name\">export</span> <span class=\"token assign-left variable\">AZURE_OPENAI_MAP</span><span class=\"token operator\">=</span><span class=\"token string\">\"gpt-3.5-turbo=my-deployment\"</span></code></pre></div>\n<h3 id=\"demo\" style=\"position:relative;\"><a href=\"#demo\" aria-label=\"demo permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Demo</h3>\n<p><strong>Nginx Pod:</strong></p>\n<p>Run the below command:</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">kubectl ai <span class=\"token string\">\"create an nginx pod\"</span>\nkubectl ai <span class=\"token string\">\"create an nginx pod\"</span>\n‚ú® Attempting to apply the following manifest:\napiVersion: v1\nkind: Pod\nmetadata:\n  name: nginx-pod\nspec:\n  containers:\n  - name: nginx\n    image: nginx\n    ports:\n    - containerPort: <span class=\"token number\">80</span>\nUse the arrow keys to navigate: ‚Üì ‚Üë ‚Üí ‚Üê \n? Would you like to apply this? <span class=\"token punctuation\">[</span>Reprompt/Apply/Don<span class=\"token string\">'t Apply]: \n+   Reprompt\n  ‚ñ∏ Apply\n    Don'</span>t Apply</code></pre></div>\n<p><strong>Deployment:</strong></p>\n<p>Select <code class=\"language-text\">Reprompt</code> and type \"make this into deployment\"</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">Reprompt: <span class=\"token function\">make</span> this into deployment\n‚ú® Attempting to apply the following manifest:\napiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: nginx-deployment\nspec:\n  replicas: <span class=\"token number\">1</span>\n  selector:\n    matchLabels:\n      app: nginx\n  template:\n    metadata:\n      labels:\n        app: nginx\n    spec:\n      containers:\n      - name: nginx\n        image: nginx:1.7.9\n        ports:\n        - containerPort: <span class=\"token number\">80</span></code></pre></div>\n<p><strong>ReplicaSet:</strong></p>\n<p>Reprompt: Scale to 3 replicas</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">Reprompt: Scale to <span class=\"token number\">3</span> replicas\n‚ú® Attempting to apply the following manifest:\napiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: nginx-deployment\nspec:\n  replicas: <span class=\"token number\">3</span>\n  selector:\n    matchLabels:\n      app: nginx\n  template:\n    metadata:\n      labels:\n        app: nginx\n    spec:\n      containers:\n      - name: nginx\n        image: nginx\n        ports:\n        - containerPort: <span class=\"token number\">80</span></code></pre></div>\n<h2 id=\"-kopylot-ai-powered-kubernetes-assistant-\" style=\"position:relative;\"><a href=\"#-kopylot-ai-powered-kubernetes-assistant-\" aria-label=\" kopylot ai powered kubernetes assistant  permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>‚ú® KoPylot: AI-Powered Kubernetes Assistant ü§ñ</h2>\n<p><a href=\"https://github.com/avsthiago/kopylot\" target=\"_blank\" rel=\"noopener noreferrer\">KoPylot</a> is an open-source AI-powered Kubernetes assistant. Its goal is to help developers and DevOps engineers to easily manage and monitor their Kubernetes clusters.\n<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 55.294117647058826%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAABb0lEQVR42oVSy07CUBAtLUIjIRTKI5DWFqg8EtJQi7aBmpQm/QGXbk2Mbt1o4sJEXRl3/Iaf4xf4F66OmSkkoC0uTnrnzszpnHNHEAQBWcjlchBFkUHn7Vyn00EURQjDELVaje8sy6JvNmEWSqUSJpMJhsMhbNvGeDxGs9mEpmnZhLIsw/d9xHGMIAgwn8+ZgO6LxSJ6vR5c1+Wa2WyG6XSKfr+fTShJEksYDAYMOrfbbZ6O8hsrKKYcTToajdIJyS/yRVEUNBoNllOv19FqtRiFQuFPfblc5jrht9kb5PN5VKtVGIaBbrfLEo8Mk+Vu96T0ZyZ2mvbld/p1XedJtteEzqdxiIfVG5ww4PjgUIVxdgW5oieNWT/wPA+LxQKqqiZmSwnh3fsrvvCN2+dHjo+DG3x8At7Fy/pRpHRCx3F4j5bLJT87eUcJO/Bx/XSPk+g82T3VwvnlCormrtWI6YSmaYJk06ISKpXKv57uww/TyggrsSPGCgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"KoPylot\" title=\"\" src=\"/static/e7aeb68cc7b09d61e6cda4156fec5da9/c5bb3/KoPylot.png\" srcset=\"/static/e7aeb68cc7b09d61e6cda4156fec5da9/04472/KoPylot.png 170w,\n/static/e7aeb68cc7b09d61e6cda4156fec5da9/9f933/KoPylot.png 340w,\n/static/e7aeb68cc7b09d61e6cda4156fec5da9/c5bb3/KoPylot.png 680w,\n/static/e7aeb68cc7b09d61e6cda4156fec5da9/b12f7/KoPylot.png 1020w,\n/static/e7aeb68cc7b09d61e6cda4156fec5da9/e996b/KoPylot.png 1050w\" sizes=\"(max-width: 680px) 100vw, 680px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n    </span>\n          </p>\n<h3 id=\"kopylot-features\" style=\"position:relative;\"><a href=\"#kopylot-features\" aria-label=\"kopylot features permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>KoPylot features</h3>\n<p>At the current version, KoPylot has four main features. These features can be translated into subcommands for the kopylot CLI. The subcommands are Audit, Chat, Ctl, and Diagnose. Let's dive into these commands now.\n<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 66.47058823529413%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAAsTAAALEwEAmpwYAAACLElEQVR42p1S227aQBC1DbbX9ysY2xgVkoqHtKpECCFCUaq+9iPyCUFqPy7/kT60r03wTyTr6ZkVSUnVlxbpaGa9M2fPmUE71U7Nzx/X12ebiy+L9+c3i8V6u/ywUljscbm+Aj5tl8v1drXcvML5cnOzWlx83ZxdXmvaVV97N50WR7M3D0mZ02x61BVFSVk2oDTJKOeY5jTIh5TEKQVBRFEYU4gYhi+5jKqGoqK89zRtqOFXx7G9yxKBxvwpCgJZDAYyy1JZVZUcqDyTuq5L1P4NjwDh/t5xnIoJK+H77WA+p6CqO8sPyApDMgyDi8i2bbIsi4QQL/kz+BsgDdT1e72d67qlIrSDoI1BmMznXXpyQt5oRPwqkxZFQWVZ0mw2U/lwOFTnuq4J6imKIun7Pj+wQ48irE3bbkWWsaKOifYWFNBASZIoIibgPE1TpY4fZNsce4cKBRRGeB0fOoAjeZ6HJQQqslXMR5HwHefPsd/vS4BM0/xN6JdlK0AoLKtrJhNsOVNgiyPYj+NY2czzXJ35bjweq3MYhpKJXyuM4taENdf3u7fHxzQBKdvDlhUR50zQNI1SDRLiuXEO9UohcLgU/4Fn6IXh06RpZIBXcSnRIGGZhy5ZCS8AaiRvliPXAI8ORgLCn4oQA64t4bSmbWFebne4kD/zw/MBpA7Lhm3vHIjTYCkXnn9rOuI7lNyh6RuK/gV3uuv+0IW4RW/Glg0g5b8P2/9P1HsO4xfjBfTRaPWtugAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"KoPylot-feat\" title=\"\" src=\"/static/fff5b19ba8552d8d8c391c94786b5735/c5bb3/KoPylot-features.png\" srcset=\"/static/fff5b19ba8552d8d8c391c94786b5735/04472/KoPylot-features.png 170w,\n/static/fff5b19ba8552d8d8c391c94786b5735/9f933/KoPylot-features.png 340w,\n/static/fff5b19ba8552d8d8c391c94786b5735/c5bb3/KoPylot-features.png 680w,\n/static/fff5b19ba8552d8d8c391c94786b5735/b12f7/KoPylot-features.png 1020w,\n/static/fff5b19ba8552d8d8c391c94786b5735/e996b/KoPylot-features.png 1050w\" sizes=\"(max-width: 680px) 100vw, 680px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n    </span>\n          </p>\n<p><strong>üîç Audit:</strong></p>\n<p>Audit resources, such as pods, deployments, and services. KoPylot will take a single resource and look for vulnerabilities based on its manifest file.</p>\n<p><span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 65.29411764705883%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAAsTAAALEwEAmpwYAAAB7ElEQVR42nVS2W7bMBDUf1iHLVEXZVmWRFqXZRRFkAQI+v+fM91hQsN96MNgeezOzh5BVCmEOscpzXC5XBzO5zPatoXWGk3TIIoihGH4RBzH/0UQHQ6II3EUHMLDM/iYpqiFsCgKVFXliJmgrmscj0ckSeJAEsZGSeRsYAaLsTOwnYUR24g6BreidDQG4zjier1iGAYHI2/89+j7HsttQ38xGPoBwX294317x8f+gbftDdZYFzSOgyNjAK211oGkt9vNnTtJau0Nf35/4uv+C8u0IGC/tn3DvM6YlgnLsjzxeDyw77tL0HWdU8qyeWbc6XSCygu0OsWoQznnCBrdYBxGl5lqGERwOAx8BUvkH88k1rpGmskwZaimTpALecAP78Ssr6SehBPnnX9MRMUcDhWSsC4zVCqCUvl3yewHnaZpcpZgMN99/2gJ+vj14gaksm7zrLE/SlR1KSWLAk/om+2b/5ponmd3X9fVVeJLLstKkleSLJf1EkJmohOxbdtTEcm9Yg6IhH5Y/GMc95N963slvqkoVt89pBo/iEx6Qiil/kEqi/76zjt7yLJVUSFOMjn/lMx++Z75BWYCKuGZw6FSP3kqp78R/6oskTYl4rMQSz8DTotO3pnWT9VPmuCb9/F/fMtl95zKH+V/AVVYjPW9me7hAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"audit\" title=\"\" src=\"/static/941665452212785b4322257a463ecfa2/c5bb3/Audit.png\" srcset=\"/static/941665452212785b4322257a463ecfa2/04472/Audit.png 170w,\n/static/941665452212785b4322257a463ecfa2/9f933/Audit.png 340w,\n/static/941665452212785b4322257a463ecfa2/c5bb3/Audit.png 680w,\n/static/941665452212785b4322257a463ecfa2/b12f7/Audit.png 1020w,\n/static/941665452212785b4322257a463ecfa2/e996b/Audit.png 1050w\" sizes=\"(max-width: 680px) 100vw, 680px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n    </span>\n          </p>\n<p><strong>üí¨ Chat:</strong></p>\n<p>Ask KoPylot in plain English to generate kubectl commands. You will be able to review the command before running it üòâ.</p>\n<p><span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 64.70588235294117%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAAsTAAALEwEAmpwYAAABr0lEQVR42pWSWY7bMBBEdYkgyIiLSGrnJlLLwDPOLB++/5EqLSWIDSRB7I8CmwL02FXdRdd1WLcVOWdM04SUEgZn8c03YLmHMgb9MGJZMmmGtSNymlBVEoyVEIJDcI6n8gucekXR1DXsOKInsLMWwYej1qaFbi2UaqAbC9M61CTdjDAdnfUA0weouqO7h2hrhOYTRd13GFNEHx38muHyhPPHJ8yaUKUM+bLCbBl6nSE/zlCnZ2gXoEOAiQmaGtBjANcCvn5H8aTlAZy3DT1ZDQRMFIHLAS555NdnWCfR9hLxtNE3i9mXiF5gDgyDr1BqhZIse02WTdug9SOGKaALFnGjnHI8Xq76HrIxYEaBkyqqZU1q1G9xkqgIyL8S8IzCO4f3tzfEENG1LdKUMA4DpCFYZcBLdoS+izP+qxY/78cpIIW8Ag1NcaShaKWhtaYh0MuSLFLn+ymE+K+kqK7AfW0CBeyo02VZsFGWMUZcLhfUtAGMsceAnFrff+KHhWt9D+ivwHt/egh4m9Ve35vdPyyTRbJ3a/URu38Afdqwnr7TukQMtC7e+2NIj3R5C/wB2oVxJZQIJKQAAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"chat\" title=\"\" src=\"/static/ba970d727e692c194a8e87e0671aeed6/c5bb3/chat.png\" srcset=\"/static/ba970d727e692c194a8e87e0671aeed6/04472/chat.png 170w,\n/static/ba970d727e692c194a8e87e0671aeed6/9f933/chat.png 340w,\n/static/ba970d727e692c194a8e87e0671aeed6/c5bb3/chat.png 680w,\n/static/ba970d727e692c194a8e87e0671aeed6/b12f7/chat.png 1020w,\n/static/ba970d727e692c194a8e87e0671aeed6/e996b/chat.png 1050w\" sizes=\"(max-width: 680px) 100vw, 680px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n    </span>\n          </p>\n<p><strong>ü©∫ Diagnose:</strong></p>\n<p>You can use the diagnose tool to help you debug the different components of your application, such as pods, deployments, and services. The diagnose command will list for you possible fixes for the broken resource.</p>\n<p><span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 35.29411764705882%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAAsTAAALEwEAmpwYAAAA/UlEQVR42pWRzU7DMBCE8x6Nf9ZeJ3GcNimQFpUfcQAER97/YYbdhAOIFonDJ3tl73hnXDkmuEhIMaHkHn2/UkoBM8NsalhjYOtvGHuRSsVcG2HYo1ZMjY1gRIRzB5oyfMfwmUFDAz+0sORhw3kqvZyeb4QZzdsR/LgH5QQqDcIug3YtfC+1CHkRdBxgrYN1v9HhKieq/HSF5v0W6WVG93GP9HpAvBtFfEI4bhEPA/hhAu3z2mztWVSrct4hXPeIp3FpDnNZJlptyipxqF21qvslz78EtTFITrRtJS/JbOzkgH42LoF/1TLARdSyJfGeApbfVnSvHyWv/RcV/QSndcU026klhgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"KoPylot\" title=\"\" src=\"/static/f4204a76cb5dd59bc2f6a6c24cf4f1e6/c5bb3/diagnose.png\" srcset=\"/static/f4204a76cb5dd59bc2f6a6c24cf4f1e6/04472/diagnose.png 170w,\n/static/f4204a76cb5dd59bc2f6a6c24cf4f1e6/9f933/diagnose.png 340w,\n/static/f4204a76cb5dd59bc2f6a6c24cf4f1e6/c5bb3/diagnose.png 680w,\n/static/f4204a76cb5dd59bc2f6a6c24cf4f1e6/b12f7/diagnose.png 1020w,\n/static/f4204a76cb5dd59bc2f6a6c24cf4f1e6/e996b/diagnose.png 1050w\" sizes=\"(max-width: 680px) 100vw, 680px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n    </span>\n          </p>\n<p><strong>‚ò∏Ô∏è Ctl:</strong></p>\n<p>A wrapper around kubectl. All the arguments passed to the ctl subcommand are interpreted by kubectl.</p>\n<p><span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 15.294117647058824%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAYAAACTWi8uAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAW0lEQVR42pXMsQ3AIAxEUfbAxtARjECGiv0HuwQmCMXpFyc9V0eHWoPZwFoLc85TM0POGTFGhBB+z5WmeHrF+EBVPUhKCSKCUso9SIGxJxLBzPCeTvdJRFfYBl9OIVOrLoacIgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"ctl\" title=\"\" src=\"/static/027a2e2620b844478857da2c7e8b2cb4/c5bb3/ctl.png\" srcset=\"/static/027a2e2620b844478857da2c7e8b2cb4/04472/ctl.png 170w,\n/static/027a2e2620b844478857da2c7e8b2cb4/9f933/ctl.png 340w,\n/static/027a2e2620b844478857da2c7e8b2cb4/c5bb3/ctl.png 680w,\n/static/027a2e2620b844478857da2c7e8b2cb4/b12f7/ctl.png 1020w,\n/static/027a2e2620b844478857da2c7e8b2cb4/e996b/ctl.png 1050w\" sizes=\"(max-width: 680px) 100vw, 680px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n    </span>\n          </p>\n<h3 id=\"how-does-kopylotwork\" style=\"position:relative;\"><a href=\"#how-does-kopylotwork\" aria-label=\"how does kopylotwork permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>How does KoPylot¬†work?</h3>\n<p>At the moment, KoPylot works by extracting information from the Kubernetes resource description <em>(kubectl describe ‚Ä¶)</em> or manifest and feeding it into <a href=\"https://platform.openai.com/docs/models/overview\" target=\"_blank\" rel=\"noopener noreferrer\">OpenAI's Davinci model</a> together with a prompt. The prompt tells the model what to do with the Kubernetes resource.</p>\n<p>The prompt is also responsible for guiding how the model should structure the output. For example, the prompt used for<a href=\"https://github.com/avsthiago/kopylot/blob/main/kopylot/prompts.py#L15\" target=\"_blank\" rel=\"noopener noreferrer\">the Audit command</a> asks the model to output the results as a two-column JSON containing the vulnerabilities and their Severities.</p>\n<h3 id=\"how-good-are-theoutputs\" style=\"position:relative;\"><a href=\"#how-good-are-theoutputs\" aria-label=\"how good are theoutputs permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>How good are the¬†outputs?</h3>\n<p>I tested KoPylot on a dummy cluster with some broken pods, some with vulnerabilities and others without. What I noticed is that the Davinci model can give good directions when diagnosing a broken pod. Sometimes the advice will be too short for one to understand, but by running the diagnose command 2‚Äì3 times, it is possible to pinpoint the issue.</p>\n<h2 id=\"-kopilot-Ô∏è-ai-kubernetes-expert\" style=\"position:relative;\"><a href=\"#-kopilot-%EF%B8%8F-ai-kubernetes-expert\" aria-label=\" kopilot Ô∏è ai kubernetes expert permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>‚ú® Kopilot üßë‚Äç‚úàÔ∏è: AI Kubernetes Expert</h2>\n<p><a href=\"https://github.com/knight42/kopilot\" target=\"_blank\" rel=\"noopener noreferrer\">Kopilot</a> is the only one out of these projects written in Go. It covers two functions, troubleshooting and auditing. So what do they do?</p>\n<h3 id=\"installation-guide\" style=\"position:relative;\"><a href=\"#installation-guide\" aria-label=\"installation guide permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Installation guide</h3>\n<p><strong>macOS:</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">brew <span class=\"token function\">install</span> knight42/tap/kopilot</code></pre></div>\n<p>Krew:</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">kubectl krew <span class=\"token function\">install</span> kopilot</code></pre></div>\n<h3 id=\"usage-guide\" style=\"position:relative;\"><a href=\"#usage-guide\" aria-label=\"usage guide permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Usage guide</h3>\n<p>Currently, you need to set two ENVs to run Kopilot:</p>\n<ul>\n<li>Set <code class=\"language-text\">KOPILOT_TOKEN</code> to specify your token.</li>\n<li>Set KOPILOT_LANG to specify the language, defaults to English. Valid options are <code class=\"language-text\">Chinese</code>, <code class=\"language-text\">French</code>, <code class=\"language-text\">Spain</code>, etc.</li>\n<li><code class=\"language-text\">KOPILOT_TOKEN_TYPE</code> will be available soon to let you specify AI services other than ChatGPT. Please stay tuned.</li>\n</ul>\n<h3 id=\"highlight\" style=\"position:relative;\"><a href=\"#highlight\" aria-label=\"highlight permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Highlight</h3>\n<ul>\n<li>Diagnose any unhealthy workload in your cluster and tell you what might be the cause</li>\n</ul>\n<p><img src=\"/05fced4b6ad91235621fceb80a979ae3/Kopilot.gif\" alt=\"Kopylot\" loading=\"lazy\">\n          </p>\n<ul>\n<li>Audit Kubernetes resource and find the security misconfigurations</li>\n</ul>\n<p><img src=\"/692eedb507938331dda290e91f31e887/Audits.gif\" alt=\"Audits\" loading=\"lazy\">\n          </p>\n<p>Imagine you have a Pod that is stuck in Pending or CrashLoopBackOff. This is when the kopilot diagnose command will come in handy. It will reach AI for help and print you its answer with possible explanations as to why this has happened.</p>\n<p><span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 39.411764705882355%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsTAAALEwEAmpwYAAABHElEQVR42k2RWY7CQAxE+x5JOgskZIcsLEJ8cP9L1eRZMpqPkstut8tLGJta27vStBQaxlb7tmuepwOz+r7X9XrVNE1miQE4b7fbTeu6ats2LctieSHGTDFPlcVESZIoxmjI81xpmhrPsuwXd/8/yHWEsqo0DOOhOJjiOI7quk5N0xzxQefz2fy2bXW5XH5xYoB8hGkGG0i43+82Cm0DH5PkdV2077vFfQ0IU5Q8QB4+ogHCDk6nk6qjW1DXtcE5lnfE4XQNpwDcOyc34FCQLlF7vV4G/Ofzqc/nYz6dAQozKhzLf3/DD6jwmaKPx8Ou5tdjVPfhfPKLMxkroAicsW1kAuwH60ch0T9S0GO+W8S/368JcPWiKFSWpdk/lgjuAI5r4BEAAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"kopilot-diagnose\" title=\"\" src=\"/static/06b222488f49ccc432e1e49d36ca3401/c5bb3/kopilot-diagnose.png\" srcset=\"/static/06b222488f49ccc432e1e49d36ca3401/04472/kopilot-diagnose.png 170w,\n/static/06b222488f49ccc432e1e49d36ca3401/9f933/kopilot-diagnose.png 340w,\n/static/06b222488f49ccc432e1e49d36ca3401/c5bb3/kopilot-diagnose.png 680w,\n/static/06b222488f49ccc432e1e49d36ca3401/31198/kopilot-diagnose.png 694w\" sizes=\"(max-width: 680px) 100vw, 680px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n    </span>\n          </p>\n<p>Not sure if your Deployment is good enough? The kopilot audit command, using a similar approach, will check it against the well-known best practices and possible security misconfigurations.</p>\n<p>This tool will use your OpenAI API token and the human language of your choice for the answers. The README also hints that there will be an option to use other AI services in the future.</p>\n<p>Sadly, the project hasn't seen any commits since the beginning of April, raising obvious concerns.</p>\n<h2 id=\"-kubectl-gpt\" style=\"position:relative;\"><a href=\"#-kubectl-gpt\" aria-label=\" kubectl gpt permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>‚ú® Kubectl-GPT</h2>\n<p><a href=\"https://github.com/devinjeon/kubectl-gpt\" target=\"_blank\" rel=\"noopener noreferrer\">Kubectl-GPT</a> is a kubectl plugin to generate kubectl commands from natural language input by using GPT model.</p>\n<p>This plugin introduces the <code class=\"language-text\">kubectl gpt</code> command, whose sole mission is to make your wishes‚Ää-‚Ääi.e. requests stated in human language‚Ää-‚Ääcome true in your Kubernetes cluster. Here are examples of what you can expect from this plugin as outlined in its documentation:</p>\n<h3 id=\"installation-2\" style=\"position:relative;\"><a href=\"#installation-2\" aria-label=\"installation 2 permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Installation</h3>\n<p><strong>Homebrew:</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token comment\"># Install Homebrew: https://brew.sh/</span>\nbrew tap devinjeon/kubectl-gpt https://github.com/devinjeon/kubectl-gpt\nbrew <span class=\"token function\">install</span> kubectl-gpt</code></pre></div>\n<p><strong>Krew:</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token comment\"># Install Krew: https://krew.sigs.k8s.io/docs/user-guide/setup/install/</span>\nkubectl krew index <span class=\"token function\">add</span> devinjeon https://github.com/devinjeon/kubectl-gpt\nkubectl krew <span class=\"token function\">install</span> devinjeon/gpt</code></pre></div>\n<h3 id=\"usage-mode\" style=\"position:relative;\"><a href=\"#usage-mode\" aria-label=\"usage mode permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Usage mode</h3>\n<p>Run the command line tool with your natural language input to generate a kubectl command.</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">kubectl gpt <span class=\"token string\">\"&lt;WHAT-YOU-WANT-TO-DO>\"</span></code></pre></div>\n<p>Commands generated by the GPT model may not always be perfect, please verify them before execution.</p>\n<p><strong>Prerequisites:</strong></p>\n<p>Before you start, make sure to set your OpenAI API key as an environment variable named <code class=\"language-text\">OPENAI_API_KEY</code>. You can get a key for using the OpenAI API <a href=\"https://platform.openai.com/account/api-keys\" target=\"_blank\" rel=\"noopener noreferrer\">here</a>.</p>\n<p>You can add the following line to your¬†<code class=\"language-text\">.zshrc</code> or¬†<code class=\"language-text\">.bashrc</code> file:</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token builtin class-name\">export</span> <span class=\"token assign-left variable\">OPENAI_API_KEY</span><span class=\"token operator\">=</span><span class=\"token operator\">&lt;</span>your-key<span class=\"token operator\">></span></code></pre></div>\n<h3 id=\"examples\" style=\"position:relative;\"><a href=\"#examples\" aria-label=\"examples permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Examples</h3>\n<p>It depends on the languages supported by the OpenAI GPT API.</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token comment\"># English</span>\nkubectl gpt <span class=\"token string\">\"Print the creation time and pod name of all pods in all namespaces.\"</span>\nkubectl gpt <span class=\"token string\">\"Print the memory limit and request of all pods\"</span>\nkubectl gpt <span class=\"token string\">\"Increase the replica count of the coredns deployment to 2\"</span>\nkubectl gpt <span class=\"token string\">\"Switch context to the kube-system namespace\"</span>\n<span class=\"token comment\"># Korean</span>\nkubectl gpt <span class=\"token string\">\"ÌòÑÏû¨ namespaceÏóêÏÑú Í∞Å pod Î≥Ñ ÏÉùÏÑ±ÏãúÍ∞Ñ Ï∂úÎ†•\"</span>\nkubectl gpt <span class=\"token string\">\"coredns deploymentÏùò replicaÎ•º 2Î°ú Ï¶ùÍ∞Ä\"</span></code></pre></div>\n<p>This project is developed by a solitary enthusiast and hasn't seen any updates since the end of May.</p>\n<h2 id=\"-kube-copilot\" style=\"position:relative;\"><a href=\"#-kube-copilot\" aria-label=\" kube copilot permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>‚ú® kube-copilot</h2>\n<p><a href=\"https://github.com/feiskyer/kube-copilot\" target=\"_blank\" rel=\"noopener noreferrer\">Kubernetes Copilot</a> powered by OpenAI.</p>\n<p>Features:</p>\n<ul>\n<li>Automate Kubernetes cluster operations using ChatGPT (GPT-4 or GPT-3.5).</li>\n<li>Diagnose and analyze the potential issues for Kubernetes workloads.</li>\n<li>Generate the Kubernetes manifests based on the provided prompt instructions.</li>\n<li>Utilize native kubectl and trivy commands for Kubernetes cluster access and security vulnerability scanning.</li>\n<li>Access the web and perform Google searches without leaving the terminal.</li>\n</ul>\n<p><strong>Install:</strong></p>\n<p><em>Run in Kubernetes:</em></p>\n<ul>\n<li>Option 1: Web UI with Helm (recommended)</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token comment\"># Option 1: OpenAI</span>\n<span class=\"token builtin class-name\">export</span> <span class=\"token assign-left variable\">OPENAI_API_KEY</span><span class=\"token operator\">=</span><span class=\"token string\">\"&lt;replace-this>\"</span>\nhelm <span class=\"token function\">install</span> kube-copilot kube-copilot <span class=\"token punctuation\">\\</span>\n  <span class=\"token parameter variable\">--repo</span> https://feisky.xyz/kube-copilot <span class=\"token punctuation\">\\</span>\n  <span class=\"token parameter variable\">--set</span> <span class=\"token assign-left variable\">openai.apiModel</span><span class=\"token operator\">=</span>gpt-4 <span class=\"token punctuation\">\\</span>\n  <span class=\"token parameter variable\">--set</span> <span class=\"token assign-left variable\">openai.apiKey</span><span class=\"token operator\">=</span><span class=\"token variable\">$OPENAI_API_KEY</span>\n\n<span class=\"token comment\"># Option 2: Azure OpenAI Service</span>\n<span class=\"token builtin class-name\">export</span> <span class=\"token assign-left variable\">OPENAI_API_KEY</span><span class=\"token operator\">=</span><span class=\"token string\">\"&lt;replace-this>\"</span>\n<span class=\"token builtin class-name\">export</span> <span class=\"token assign-left variable\">OPENAI_API_BASE</span><span class=\"token operator\">=</span><span class=\"token string\">\"&lt;replace-this>\"</span>\nhelm <span class=\"token function\">install</span> kube-copilot kube-copilot <span class=\"token punctuation\">\\</span>\n  <span class=\"token parameter variable\">--repo</span> https://feisky.xyz/kube-copilot <span class=\"token punctuation\">\\</span>\n  <span class=\"token parameter variable\">--set</span> <span class=\"token assign-left variable\">openai.apiModel</span><span class=\"token operator\">=</span>gpt-4 <span class=\"token punctuation\">\\</span>\n  <span class=\"token parameter variable\">--set</span> <span class=\"token assign-left variable\">openai.apiKey</span><span class=\"token operator\">=</span><span class=\"token variable\">$OPENAI_API_KEY</span> <span class=\"token punctuation\">\\</span>\n  <span class=\"token parameter variable\">--set</span> <span class=\"token assign-left variable\">openai.apiBase</span><span class=\"token operator\">=</span><span class=\"token variable\">$OPENAI_API_BASE</span>\n<span class=\"token comment\"># Forwarding requests to the service</span>\nkubectl port-forward service/kube-copilot <span class=\"token number\">8080</span>:80\n<span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"Visit http://127.0.0.1:8080 to use the copilot\"</span></code></pre></div>\n<p><em>Option 2: CLI with kubectl</em></p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">kubectl run <span class=\"token parameter variable\">-it</span> <span class=\"token parameter variable\">--rm</span> copilot <span class=\"token punctuation\">\\</span>\n  <span class=\"token parameter variable\">--env</span><span class=\"token operator\">=</span><span class=\"token string\">\"OPENAI_API_KEY=<span class=\"token variable\">$OPENAI_API_KEY</span>\"</span> <span class=\"token punctuation\">\\</span>\n  <span class=\"token parameter variable\">--restart</span><span class=\"token operator\">=</span>Never <span class=\"token punctuation\">\\</span>\n  <span class=\"token parameter variable\">--image</span><span class=\"token operator\">=</span>ghcr.io/feiskyer/kube-copilot <span class=\"token punctuation\">\\</span>\n  <span class=\"token parameter variable\">--execute</span> <span class=\"token parameter variable\">--verbose</span> <span class=\"token string\">'What Pods are using max memory in the cluster'</span></code></pre></div>\n<p><strong>Local Install:</strong></p>\n<p>Install the copilot with pip command below:</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\">pip install kube<span class=\"token operator\">-</span>copilot</code></pre></div>\n<p><strong>Setup:</strong></p>\n<ul>\n<li>Ensure <a href=\"https://kubernetes.io/docs/tasks/tools/install-kubectl-linux/\" target=\"_blank\" rel=\"noopener noreferrer\">kubectl</a> is installed on the local machine and the kubeconfig file is configured for Kubernetes cluster access.</li>\n<li>Install <a href=\"https://github.com/aquasecurity/trivy\" target=\"_blank\" rel=\"noopener noreferrer\">trivy</a> to assess container image security issues (for the audit command).</li>\n<li>Set the <a href=\"https://platform.openai.com/account/api-keys\" target=\"_blank\" rel=\"noopener noreferrer\">OpenAI API key</a> as the <code class=\"language-text\">OPENAI_API_KEY</code> environment variable to enable ChatGPT functionality.</li>\n<li>For <a href=\"https://learn.microsoft.com/en-us/azure/cognitive-services/openai/quickstart?tabs=command-line&#x26;pivots=rest-api#retrieve-key-and-endpoint\" target=\"_blank\" rel=\"noopener noreferrer\">Azure OpenAI service</a>, also set <code class=\"language-text\">OPENAI_API_TYPE=azure</code> and <code class=\"language-text\">OPENAI_API_BASE=https://&lt;replace-this>.openai.azure.com/</code>.</li>\n<li>Google search is disabled by default. To enable it, set <code class=\"language-text\">GOOGLE_API_KEY</code> and <code class=\"language-text\">GOOGLE_CSE_ID</code> (obtain <a href=\"https://cloud.google.com/docs/authentication/api-keys?visit_id=638154888929258210-4085587461\" target=\"_blank\" rel=\"noopener noreferrer\">from</a> here and <a href=\"http://www.google.com/cse/\" target=\"_blank\" rel=\"noopener noreferrer\">here</a>).</li>\n</ul>\n<p><strong>How to use web UI:</strong>\n<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 66.47058823529413%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAANABQDASIAAhEBAxEB/8QAFgABAQEAAAAAAAAAAAAAAAAAAAEF/8QAFAEBAAAAAAAAAAAAAAAAAAAAAP/aAAwDAQACEAMQAAAB3KoUf//EABQQAQAAAAAAAAAAAAAAAAAAACD/2gAIAQEAAQUCX//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8BP//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8BP//EABYQAAMAAAAAAAAAAAAAAAAAAAAgMf/aAAgBAQAGPwIq/wD/xAAYEAADAQEAAAAAAAAAAAAAAAAAARARIf/aAAgBAQABPyHpjhGT/9oADAMBAAIAAwAAABATz//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8QP//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8QP//EAB0QAAMAAgIDAAAAAAAAAAAAAAABESFRMUFhkaH/2gAIAQEAAT8QULmN9w8v0hPCuXsSuFb+EP/Z'); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"web ui\" title=\"\" src=\"/static/b3f908d5baf0517b38e212dab9ef885b/7bf67/web-ui.jpg\" srcset=\"/static/b3f908d5baf0517b38e212dab9ef885b/651be/web-ui.jpg 170w,\n/static/b3f908d5baf0517b38e212dab9ef885b/d30a3/web-ui.jpg 340w,\n/static/b3f908d5baf0517b38e212dab9ef885b/7bf67/web-ui.jpg 680w,\n/static/b3f908d5baf0517b38e212dab9ef885b/2ec65/web-ui.jpg 979w\" sizes=\"(max-width: 680px) 100vw, 680px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n    </span>\n          </p>\n<p><strong>How to use CLI:</strong></p>\n<p>Running directly in the terminal:</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">Usage: kube-copilot <span class=\"token punctuation\">[</span>OPTIONS<span class=\"token punctuation\">]</span> COMMAND <span class=\"token punctuation\">[</span>ARGS<span class=\"token punctuation\">]</span><span class=\"token punctuation\">..</span>.\nKubernetes Copilot powered by OpenAI\nOptions:\n  <span class=\"token parameter variable\">--version</span>  Show the version and exit.\n  <span class=\"token parameter variable\">--help</span>     Show this message and exit.\nCommands:\n  analyze   analyze issues <span class=\"token keyword\">for</span> a given resource\n  audit     audit security issues <span class=\"token keyword\">for</span> a Pod\n  diagnose  diagnose problems <span class=\"token keyword\">for</span> a Pod\n  execute   execute operations based on prompt instructions\n  generate  generate Kubernetes manifests</code></pre></div>\n<p><strong>Audit Security Issues for Pod:</strong></p>\n<p><code class=\"language-text\">kube-copilot audit POD [NAMESPACE]</code> will audit security issues for a Pod:</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">Usage: kube-copilot audit <span class=\"token punctuation\">[</span>OPTIONS<span class=\"token punctuation\">]</span> POD <span class=\"token punctuation\">[</span>NAMESPACE<span class=\"token punctuation\">]</span>\n audit security issues <span class=\"token keyword\">for</span> a Pod\nOptions:\n  <span class=\"token parameter variable\">--verbose</span>      Enable verbose information of copilot execution steps\n  <span class=\"token parameter variable\">--model</span> MODEL  OpenAI model to use <span class=\"token keyword\">for</span> copilot execution, default is gpt-4\n  <span class=\"token parameter variable\">--help</span>         Show this message and exit.</code></pre></div>\n<p><strong>Diagnose Problems for Pod:</strong></p>\n<p><code class=\"language-text\">kube-copilot diagnose POD [NAMESPACE]</code> will diagnose problems for a Pod:</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">Usage: kube-copilot diagnose <span class=\"token punctuation\">[</span>OPTIONS<span class=\"token punctuation\">]</span> POD <span class=\"token punctuation\">[</span>NAMESPACE<span class=\"token punctuation\">]</span>\n diagnose problems <span class=\"token keyword\">for</span> a Pod\nOptions:\n  <span class=\"token parameter variable\">--verbose</span>      Enable verbose information of copilot execution steps\n  <span class=\"token parameter variable\">--model</span> MODEL  OpenAI model to use <span class=\"token keyword\">for</span> copilot execution, default is gpt-4\n  <span class=\"token parameter variable\">--help</span>         Show this message and exit.</code></pre></div>\n<p><strong>Analyze Potential Issues for k8s Object:</strong></p>\n<p><code class=\"language-text\">kube-copilot analyze RESOURCE NAME [NAMESPACE]</code> will analyze potential issues for the given resource object:</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">Usage: kube-copilot analyze <span class=\"token punctuation\">[</span>OPTIONS<span class=\"token punctuation\">]</span> RESOURCE NAME <span class=\"token punctuation\">[</span>NAMESPACE<span class=\"token punctuation\">]</span>\n  analyze issues <span class=\"token keyword\">for</span> a given resource\nOptions:\n  <span class=\"token parameter variable\">--verbose</span>     Enable verbose information of copilot execution steps\n  <span class=\"token parameter variable\">--model</span> TEXT  OpenAI model to use <span class=\"token keyword\">for</span> copilot execution, default is gpt-4\n  <span class=\"token parameter variable\">--help</span>        Show this message and exit.</code></pre></div>\n<p><strong>Execute Operations Based on Prompt Instructions:</strong></p>\n<p><code class=\"language-text\">kube-copilot execute INSTRUCTIONS</code> will execute operations based on prompt instructions. It could also be used to ask any questions.</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">Usage: kube-copilot execute <span class=\"token punctuation\">[</span>OPTIONS<span class=\"token punctuation\">]</span> INSTRUCTIONS\nexecute operations based on prompt instructions\nOptions:\n  <span class=\"token parameter variable\">--verbose</span>      Enable verbose information of copilot execution steps\n  <span class=\"token parameter variable\">--model</span> MODEL  OpenAI model to use <span class=\"token keyword\">for</span> copilot execution, default is gpt-4\n  <span class=\"token parameter variable\">--help</span>         Show this message and exit.</code></pre></div>\n<p><strong>Generate Kubernetes Manifests:</strong></p>\n<p>Use the <code class=\"language-text\">kube-copilot generate</code> command to create Kubernetes manifests based on the provided prompt instructions.\nAfter generating the manifests, you will be prompted to confirm whether you want to apply them.</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">Usage: kube-copilot generate <span class=\"token punctuation\">[</span>OPTIONS<span class=\"token punctuation\">]</span> INSTRUCTIONS\ngenerate Kubernetes manifests\nOptions:\n  <span class=\"token parameter variable\">--verbose</span>     Enable verbose information of copilot execution steps\n  <span class=\"token parameter variable\">--model</span> TEXT  OpenAI model to use <span class=\"token keyword\">for</span> copilot execution, default is gpt-4\n  <span class=\"token parameter variable\">--help</span>        Show this message and exit.</code></pre></div>\n<h2 id=\"--holmes-gpt\" style=\"position:relative;\"><a href=\"#--holmes-gpt\" aria-label=\"  holmes gpt permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>‚ú®  holmes GPT</h2>\n<p>A <a href=\"https://github.com/robusta-dev/holmesgpt\" target=\"_blank\" rel=\"noopener noreferrer\">ChatGPT</a> bot for Kubernetes issues. Ask the AI how to solve your Prometheus alerts, get pithy responses.\nNo more solving alerts alone in the darkness‚Ää-‚Ääthe internet has your back.</p>\n<p><img src=\"/f7715b954eeb7ce18d1b19db73b935a6/HolmesGPT.gif\" alt=\"HolmesGPT\" loading=\"lazy\">\n          </p>\n<h3 id=\"what-can-holmesgpt-do\" style=\"position:relative;\"><a href=\"#what-can-holmesgpt-do\" aria-label=\"what can holmesgpt do permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>What Can HolmesGPT Do?</h3>\n<ul>\n<li><strong>Investigate Incidents (AIOps)</strong> from PagerDuty/OpsGenie/Prometheus/Jira/more</li>\n<li><strong>Bidirectional Integrations</strong> see investigation results inside your existing ticketing/incident management system</li>\n<li><strong>Automated Triage:</strong> Use HolmesGPT as a first responder. Flag critical alerts and prioritize them for your team to look at</li>\n<li><strong>Alert Enrichment:</strong> Automatically add context to alerts - like logs and microservice health info - to find root causes faster</li>\n<li><strong>Identify Cloud Problems</strong> by asking HolmesGPT questions about unhealthy infrastructure</li>\n<li><strong>Runbook Automation in Plain English:</strong> Speed up your response to known issues by investigating according to runbooks you provide</li>\n</ul>\n<h3 id=\"see-it-in-action\" style=\"position:relative;\"><a href=\"#see-it-in-action\" aria-label=\"see it in action permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>See it in Action</h3>\n<p><img src=\"/f7715b954eeb7ce18d1b19db73b935a6/holmesgptdemo.gif\" alt=\"AI Alert Analysis\" loading=\"lazy\">\n          </p>\n<p><strong>Examples</strong></p>\n<ul>\n<li>Kubernetes Troubleshooting</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">holmes ask <span class=\"token string\">\"what pods are unhealthy in my cluster and why?\"</span></code></pre></div>\n<ul>\n<li>Prometheus Alert RCA (root cause analysis)</li>\n</ul>\n<p>Investigate Prometheus alerts right from Slack with the official <a href=\"https://docs.robusta.dev/holmes_chart_dependency/configuration/ai-analysis.html\" target=\"_blank\" rel=\"noopener noreferrer\">Robusta integration</a>.</p>\n<p><img src=\"https://github.com/robusta-dev/holmesgpt/assets/494087/fd2451b0-b951-4798-af62-f69affac831e\" alt=\"342708962-e0c9ccde-299e-41d7-84e3-c201277a9ccb (1)\" loading=\"lazy\">\n          </p>\n<p>Or run HolmesGPT from the cli:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">kubectl port-forward alertmanager-robusta-kube-prometheus-st-alertmanager-0 <span class=\"token number\">9093</span>:9093 <span class=\"token operator\">&amp;</span>\nholmes investigate alertmanager --alertmanager-url http://localhost:9093</code></pre></div>\n<p>Note - if on Mac OS and using the Docker image, you will need to use <code class=\"language-text\">http://docker.for.mac.localhost:9093</code> instead of <code class=\"language-text\">http://localhost:9093</code></p>\n<h3 id=\"key-features\" style=\"position:relative;\"><a href=\"#key-features\" aria-label=\"key features permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Key Features</h3>\n<ul>\n<li><strong>Connects to Existing Observability Data:</strong> Find correlations you didn‚Äôt know about. No need to gather new data or add instrumentation.</li>\n<li><strong>Compliance Friendly:</strong> Can be run on-premise with your own LLM (or in the cloud with OpenAI/Azure/AWS)</li>\n<li><strong>Transparent Results:</strong> See a log of the AI‚Äôs actions and what data it gathered to understand how it reached conclusions</li>\n<li><strong>Extensible Data Sources:</strong> Connect the AI to custom data by providing your own tool definitions</li>\n<li><strong>Runbook Automation:</strong> Optionally provide runbooks in plain English and the AI will follow them automatically</li>\n<li><strong>Integrates with Existing Workflows:</strong> Connect Slack and Jira to get results inside your existing tools</li>\n</ul>\n<h1 align=\"center\">üî∞ Keep Learning !! Keep Sharing !! üî∞</h1>\n<p><em><strong>üìöResources:üìö</strong></em></p>\n<p><a href=\"https://k8sgpt.ai/\" target=\"_blank\" rel=\"noopener noreferrer\">k8sgpt website</a></p>\n<p><a href=\"https://docs.k8sgpt.ai/\" target=\"_blank\" rel=\"noopener noreferrer\">k8sgpt documentation</a></p>\n<p><a href=\"https://k8sgpt.slack.com/join/shared_invite/zt-1rwe5fpzq-VNtJK8DmYbbm~iWL1H34nw?ref=anaisurl.com#/shared-invite/email\" target=\"_blank\" rel=\"noopener noreferrer\">k8sgpt Slack workspace</a></p>\n<p><a href=\"https://github.com/k8sgpt-ai\" target=\"_blank\" rel=\"noopener noreferrer\">k8sgpt GitHub Organisation</a></p>\n<p><a href=\"https://anaisurl.com/k8sgpt-full-tutorial/\" target=\"_blank\" rel=\"noopener noreferrer\">https://anaisurl.com/k8sgpt-full-tutorial/</a></p>\n<p><a href=\"https://github.com/sozercan/kubectl-ai\" target=\"_blank\" rel=\"noopener noreferrer\">https://github.com/sozercan/kubectl-ai</a></p>\n<p><a href=\"https://collabnix.com/the-rise-of-kubernetes-and-ai-kubectl-openai-plugin/\" target=\"_blank\" rel=\"noopener noreferrer\">https://collabnix.com/the-rise-of-kubernetes-and-ai-kubectl-openai-plugin/</a></p>\n<p><a href=\"https://medium.com/@thiagoalves/introducing-kopylot-a-kubernetes-ai-assistant-264cff0e7846\" target=\"_blank\" rel=\"noopener noreferrer\">https://medium.com/@thiagoalves/introducing-kopylot-a-kubernetes-ai-assistant-264cff0e7846</a></p>\n<p><a href=\"https://github.com/knight42/kopilot\" target=\"_blank\" rel=\"noopener noreferrer\">https://github.com/knight42/kopilot</a></p>\n<p><a href=\"https://github.com/devinjeon/kubectl-gpt\" target=\"_blank\" rel=\"noopener noreferrer\">https://github.com/devinjeon/kubectl-gpt</a></p>\n<p><a href=\"https://github.com/robusta-dev/holmesgpt\" target=\"_blank\" rel=\"noopener noreferrer\">https://github.com/robusta-dev/holmesgpt</a></p>\n<p><strong>üìÖ Stay updated</strong></p>\n<p>Subscribe to our newsletter for more insights on AWS cloud computing and containers.</p>"}}},"staticQueryHashes":["1271460761","1321585977"],"slicesMap":{}}