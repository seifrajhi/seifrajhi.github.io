{"componentChunkName":"component---src-templates-blog-template-js","path":"/blog/opentelemtry/","result":{"data":{"markdownRemark":{"html":"<p>OpenTelemetry is an observability framework and an active <a href=\"https://www.cncf.io/projects/opentelemetry/\" target=\"_blank\" rel=\"noopener noreferrer\">CNCF project</a> that provides a vendor-neutral and tool-agnostic way to collect observability signals across your heterogeneous system.</p>\n<p>In this blog post series, we will dig into two big questions:</p>\n<ul>\n<li>how OpenTelemetry instrumentation works on the application side taking <a href=\"https://github.com/open-telemetry/opentelemetry-python/\" target=\"_blank\" rel=\"noopener noreferrer\">Python's SDK</a> as an example. We will touch traces, metrics, logs and context propagation across services.</li>\n<li>how OpenTelemetry Collector works under the hood and some of the interesting engineering decisions made there (see <a href=\"./-sdk/\">the OTel Collector blog post</a>)</li>\n</ul>\n<p>Gotta be fun ðŸ™Œ</p>\n<h2 id=\"the-problem\" style=\"position:relative;\"><a href=\"#the-problem\" aria-label=\"the problem permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>The Problem</h2>\n<p>With the rise of the open source community, people and organizations donâ€™t really want to invest in proprietary protocols and standards anymore. Instead, it's mainstream to pick a widely-recognized open source project as a basis to build on top of it.</p>\n<p>In the observability domain, there are enough open source protocols that cover some of the three key pillars:</p>\n<ul>\n<li><code class=\"language-text\">Logs</code> - stdout and stderr streams your services or application outputs while running in the container.</li>\n<li><code class=\"language-text\">Metrics</code> - aggregations of some measurements over a period of time</li>\n<li><code class=\"language-text\">Traces</code> - a visualization of the steps or the execution path that your workflow passed</li>\n</ul>\n<p><span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 48.8235294117647%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsTAAALEwEAmpwYAAAB60lEQVR42n2S70/TYBDH+/+/VJNFgTEGLvLD4AuJhuALMRDYurIVVOaoY6OjT7uuY2XK1q79eHQEJEaafNK7791zd8mdxhOf4zhYloVSikajQRAEmZ6m6X/faGF4zTAM/+FW7/cDKapwPQ/luvR8n/Ba8odDIXzE1dWQ0WiEJv2kbsLDX0gTkmR6p/09TUoynUp4lnOfL6SSPxgM0E7bLpWmQm92hUsMy+X43KPV9cR3qAqVhp3FKsKF8jFbLvqZm/kZYpstxSDooy3vtcgZY/L1CXkzZr4esXDosVVu8PzgisLXhPxxzOLJlBeHITvGGfl9mzlzyoI5ET3mZS1mpezQU5doG9UuKz8gXwnI7dqUxH5tBHzUm5Ic8Wrf4dmORV4PpHjMpyOLkq5Y/p6S+2KT+9xhSfTNk4C+p9De6F0WT6EgneaMEctNsXWfD4bF/HHEkugLtRuK3xLxY7ZlwmJFUZTGi2YkTCg0YK3uy4QO2la1xarhsSnCptln46jH20qb3foZhb0O67U+q0c+a0LxoMv+SYt35Z+sVV3Wq05GqXzJe/0cv+fOtjyNI9le/IBsLJFNxlEksfiOmX17g6nkTMY3jH//uieajGdbvpa7CrO7e8ztrT2lO8ql3bE5b1/Qsbt0LuzsVv8AF6nbTtxw5bwAAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"The Three Pillars of Observability\" title=\"\" src=\"/static/7928c038b5d0d9bbe6a835771d957b9d/c5bb3/observability-pillars.png\" srcset=\"/static/7928c038b5d0d9bbe6a835771d957b9d/04472/observability-pillars.png 170w,\n/static/7928c038b5d0d9bbe6a835771d957b9d/9f933/observability-pillars.png 340w,\n/static/7928c038b5d0d9bbe6a835771d957b9d/c5bb3/observability-pillars.png 680w,\n/static/7928c038b5d0d9bbe6a835771d957b9d/b12f7/observability-pillars.png 1020w,\n/static/7928c038b5d0d9bbe6a835771d957b9d/b5a09/observability-pillars.png 1360w,\n/static/7928c038b5d0d9bbe6a835771d957b9d/10d53/observability-pillars.png 1724w\" sizes=\"(max-width: 680px) 100vw, 680px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n    </span>\n          </p>\n<div class=\"image-title\">The Three Pillars of Observability</div>\n<p>When you think about metrics, <a href=\"https://prometheus.io/\" target=\"_blank\" rel=\"noopener noreferrer\">Prometheus</a> and <a href=\"https://github.com/statsd/statsd\" target=\"_blank\" rel=\"noopener noreferrer\">statsd</a> may come to your mind.\nOn the traces side, there are <a href=\"https://www.jaegertracing.io/\" target=\"_blank\" rel=\"noopener noreferrer\">Jaeger</a> and <a href=\"https://zipkin.io/\" target=\"_blank\" rel=\"noopener noreferrer\">Zipkin</a>.\nThere are also various beats that could scrap your logs like <a href=\"https://www.fluentd.org/\" target=\"_blank\" rel=\"noopener noreferrer\">fluentd</a> or <a href=\"https://grafana.com/oss/loki/\" target=\"_blank\" rel=\"noopener noreferrer\">Grafana Loki</a>.</p>\n<p>Now if you want to cover all three pillars, you need to pick a combination of collectors/protocols to cover each one (well, some are capable of covering a few pillars).\nHowever, there are still a few problems left:</p>\n<ul>\n<li>even though the protocols are open source, they may still tightly connect your application to the underlying collector or storage, so it won't be that easy to switch gears and use something else</li>\n<li>we have divided observability into three pieces, but in reality, they are three different signals or points of view on the application work, so we may get the whole picture and max value out of them when they are well connected and correlated for us</li>\n</ul>\n<p><span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 57.64705882352942%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAAsTAAALEwEAmpwYAAABsElEQVR42pVTy07CUBDt/3+CiRsXblzCRoySyMaYKFGUpCqW3vb2Rcu70AdwvOeaNkRwQZPpnTuPM2emUwNHnqIo8DUYQHo+bFto3RoOlQgMrCGSJNFxu93uINc4BphlGcLA1/p2WyKdT5BnK31P0xSj0eg0wG2Z4/bxDc33MTp9ieueh9aLwF3fR+NpCMdxTgNUiGh2nnHW/kDjwcTFTRdX9z1ctl9x3urC97z/AWncl982t3CFDd+xEUcB7O9PhJ6LROlSWJjP5zXgXzlgSLDFYoGyLGsb50b7/n21Wh1ladBBWa/XOjAMQ8xmM61XiXEc6yLUl8ulPieTCcbjMap8xtJncEVoIMhArUfFZrPZaHue59peJdPH4ixgWRZM06yLcBSGlFIrZBYEakbqziJsmV+TOyeE0D7btnVbZMzVqWy8M4ZFDAJxDmyBrAhAVgSNoqhmQxtByJAx9NNGH/MIPp1OYVBhoqdWgbql/oSiKFGqILbkuq5mQbZkweJskUQ4Bo6KJ4voGfJFI4UVHFeq4AixCgiCEELd+QtK6cFVZzSKESiwRIFwVFUucQj6A48slXBkEjj1AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"Observability signals are unconnected\" title=\"\" src=\"/static/377a9f18c7ec9379f33c422d2486b7a1/c5bb3/observability-signals-unconnected.png\" srcset=\"/static/377a9f18c7ec9379f33c422d2486b7a1/04472/observability-signals-unconnected.png 170w,\n/static/377a9f18c7ec9379f33c422d2486b7a1/9f933/observability-signals-unconnected.png 340w,\n/static/377a9f18c7ec9379f33c422d2486b7a1/c5bb3/observability-signals-unconnected.png 680w,\n/static/377a9f18c7ec9379f33c422d2486b7a1/b12f7/observability-signals-unconnected.png 1020w,\n/static/377a9f18c7ec9379f33c422d2486b7a1/b5a09/observability-signals-unconnected.png 1360w,\n/static/377a9f18c7ec9379f33c422d2486b7a1/b5c8e/observability-signals-unconnected.png 2194w\" sizes=\"(max-width: 680px) 100vw, 680px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n    </span>\n          </p>\n<div class=\"image-title\">The observability signals are unconnected when you use separate highly specialized protocols</div>\n<p>To sum it up, we want to have:</p>\n<ul>\n<li>one open source vendor-lock-free protocol to rule all observability signals</li>\n<li>a stable abstraction for us for the underlying observability storage(s) without a need to migrate our service every time that storage changes</li>\n<li>a coverage of popular programming languages, not to be limited in what our tech stack looks like</li>\n</ul>\n<p><span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 84.70588235294117%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAARCAYAAADdRIy+AAAACXBIWXMAAAsTAAALEwEAmpwYAAACX0lEQVR42pVT2Y7aQBD052/eouxLfiBCWSEUkYgHIOIhWgXQil1uFgw2YGxO2/jgNFSmBrEiUVCCpdbMeLqrq3q6FVz5NpsNVFWFaZoYjUbS2h0VareHZquFw+Hw1zjlGmAYhrAsS+7XqxX8pYvtdivPBN/v97cDmiJw6oZo6GPUugaagykWXojZdHo74Gq1ht5TkShqePetgbtEEXepFjLPPYxHAwEY3QZIBuPxGEPDRLurodZ4ReO1g66mYzgc4ng83gYoPxl0QBRtYfR7CD0Xq8AT5VhdDVGu4ohvMreRKpv4ImR/ylXw9XmI7zVLlOMEePx/wJOrOrBwXwzw4aeL+7yL93kPH/MLOI7zm98/AVnwKNrDcT28aDP8qOpIF5sodCxU9Cl2u52kx14k6HmVgNxcGvWGQpLn+7AFk8BfIvQ9sXrYbzeihj48z0NfPEx/MIBpjWEYozfWyiX1SwmcFAZGIjsZ+SLB+fVd18VisZCNTjVco+jURgov1+u1LDRXgrBdJpMJgiCQNp/P5dTwjv4EoPE//zEuDANJQiHVer2Ox8dHJJNJpFIplEolmc0wDGQyGcTjcSQSCWSzWbTEHJMxGeXzecRiMXx+eJB+uVwOCoe/3W5LK5fL6Pf7SKfTMmAqRsy2bcxmM8m0Wq3i6enpbTSZcLlcSvlcGadw0HkgdbKl9EKhIIMonVIZSPBmswld1yVDyiMJ3nFyNE1DpVI5SWYtmIV7S4CcH4AsFoIh68akPLN253sCXxrbRyEQHSlJ0hcAtu0ImfOTiWSO40ofsmcJzoB/NjbPvwDLaQ4dT7tq9AAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"Observability signals with OTel\" title=\"\" src=\"/static/661cd7278251d290b05c3a8d8f0ce959/c5bb3/otel-observability-signals.png\" srcset=\"/static/661cd7278251d290b05c3a8d8f0ce959/04472/otel-observability-signals.png 170w,\n/static/661cd7278251d290b05c3a8d8f0ce959/9f933/otel-observability-signals.png 340w,\n/static/661cd7278251d290b05c3a8d8f0ce959/c5bb3/otel-observability-signals.png 680w,\n/static/661cd7278251d290b05c3a8d8f0ce959/b12f7/otel-observability-signals.png 1020w,\n/static/661cd7278251d290b05c3a8d8f0ce959/b5a09/otel-observability-signals.png 1360w,\n/static/661cd7278251d290b05c3a8d8f0ce959/a303f/otel-observability-signals.png 1733w\" sizes=\"(max-width: 680px) 100vw, 680px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n    </span>\n          </p>\n<div class=\"image-title\">Observability signals with OTel</div>\n<br>\n<div class=\"info\" style='background-color:#d9edf7; color:#31708f; border-left: solid #bce8f1 12px; border-radius: 33px; padding: 1.7em;'>\n<span>\n<p style='margin-top:1em; text-align:center'>\n<b>The OTEL Origin</b>\n</p>\n<p style='margin-left:1em;'>This ubiquitous open protocol idea is so compelling that at some point there were two projects, <a href=\"https://opentracing.io/\" style=\"color:#31708f\">OpenTracing</a> and <a href=\"https://opencensus.io/\" style=\"color:#31708f\">OpenCensus</a>, that were trying to fill the gap.<br><br>\nThey were trying to compete with each other, but there was not the right context to do that, so it didn't make sense to try to conquer some market shares, but rather to consolidate their effort and come there much quicker shaping the space.\nThat's what happened. Both projects were merged into one known as <a href=\"https://opentelemetry.io/\" style=\"color:#31708f\">OpenTelemetry</a> (aka OTel).\n</p>\n</span>\n</div>\n<br>\n<h2 id=\"the-sdk\" style=\"position:relative;\"><a href=\"#the-sdk\" aria-label=\"the sdk permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>The SDK</h2>\n<p>Collecting logs, metrics and traces in a unified way across services implemented in different technical stacks is the central task of OpenTelemetry.\nTo get there, OpenTelemetry provides:</p>\n<ul>\n<li>SDKs for <a href=\"https://opentelemetry.io/docs/instrumentation/\" target=\"_blank\" rel=\"noopener noreferrer\">11+ of the most popular languages</a> (like Python, Go, NodeJS, Rust, Java, etc) that inits OTel core components</li>\n<li>library-specific instrumentations that provide tool/framework-specific signals and context automagically (e.g. <a href=\"https://www.starlette.io/\" target=\"_blank\" rel=\"noopener noreferrer\">Starlette</a>, <a href=\"https://www.python-httpx.org/\" target=\"_blank\" rel=\"noopener noreferrer\">HTTPX</a>, <a href=\"https://aio-pika.readthedocs.io/en/latest/\" target=\"_blank\" rel=\"noopener noreferrer\">aiopika</a> instrumentations, and so on)</li>\n</ul>\n<p>The third thing you could do is to further instrument your codebase with business logic specific traces and metrics.</p>\n<p>This process is generally known as codebase <em>instrumentation</em>.</p>\n<p>There are two ways to setup OTel in your application:</p>\n<ul>\n<li>automatic - when you run some agent before the main application entry point that configures OpenTelemetry (but not all languages support it, for example, Golang doesn't)</li>\n<li>manual - when you configure OpenTelemetry yourself to start collecting your observability signals.</li>\n</ul>\n<p>To understand how OpenTelemetry SDK is designed and implemented, we will delve into the manual setup.</p>\n<p>This is what it takes you to manually setup Python's service:</p>\n<div class=\"gatsby-highlight has-highlighted-lines\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">from</span> opentelemetry <span class=\"token keyword\">import</span> metrics<span class=\"token punctuation\">,</span> trace\n<span class=\"token keyword\">from</span> opentelemetry<span class=\"token punctuation\">.</span>sdk<span class=\"token punctuation\">.</span>metrics <span class=\"token keyword\">import</span> MeterProvider\n<span class=\"token keyword\">from</span> opentelemetry<span class=\"token punctuation\">.</span>sdk<span class=\"token punctuation\">.</span>metrics<span class=\"token punctuation\">.</span>export <span class=\"token keyword\">import</span> <span class=\"token punctuation\">(</span>\n    ConsoleMetricExporter<span class=\"token punctuation\">,</span>\n    PeriodicExportingMetricReader<span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">from</span> opentelemetry<span class=\"token punctuation\">.</span>sdk<span class=\"token punctuation\">.</span>resources <span class=\"token keyword\">import</span> SERVICE_NAME<span class=\"token punctuation\">,</span> SERVICE_VERSION<span class=\"token punctuation\">,</span> Resource\n<span class=\"token keyword\">from</span> opentelemetry<span class=\"token punctuation\">.</span>sdk<span class=\"token punctuation\">.</span>trace <span class=\"token keyword\">import</span> TracerProvider\n<span class=\"token keyword\">from</span> opentelemetry<span class=\"token punctuation\">.</span>sdk<span class=\"token punctuation\">.</span>trace<span class=\"token punctuation\">.</span>export <span class=\"token keyword\">import</span> BatchSpanProcessor<span class=\"token punctuation\">,</span> ConsoleSpanExporter\n\n<span class=\"gatsby-highlight-code-line\">span_processor <span class=\"token operator\">=</span> BatchSpanProcessor<span class=\"token punctuation\">(</span>ConsoleSpanExporter<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></span><span class=\"gatsby-highlight-code-line\">metric_reader <span class=\"token operator\">=</span> PeriodicExportingMetricReader<span class=\"token punctuation\">(</span>ConsoleMetricExporter<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></span>\nresource <span class=\"token operator\">=</span> Resource<span class=\"token punctuation\">(</span>\n    attributes<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>\n        SERVICE_NAME<span class=\"token punctuation\">:</span> <span class=\"token string\">\"notifications\"</span><span class=\"token punctuation\">,</span>\n        SERVICE_VERSION<span class=\"token punctuation\">:</span> <span class=\"token string\">\"v42\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">)</span>\n\n<span class=\"gatsby-highlight-code-line\">trace_provider <span class=\"token operator\">=</span> TracerProvider<span class=\"token punctuation\">(</span>resource<span class=\"token operator\">=</span>resource<span class=\"token punctuation\">)</span></span><span class=\"gatsby-highlight-code-line\">metrics_provider <span class=\"token operator\">=</span> MeterProvider<span class=\"token punctuation\">(</span>metric_readers<span class=\"token operator\">=</span><span class=\"token punctuation\">[</span>metric_reader<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span></span>\n<span class=\"gatsby-highlight-code-line\">trace_provider<span class=\"token punctuation\">.</span>add_span_processor<span class=\"token punctuation\">(</span>span_processor<span class=\"token punctuation\">)</span></span>\n<span class=\"token comment\"># Sets the global default providers</span>\n<span class=\"gatsby-highlight-code-line\">trace<span class=\"token punctuation\">.</span>set_tracer_provider<span class=\"token punctuation\">(</span>trace_provider<span class=\"token punctuation\">)</span></span>metrics<span class=\"token punctuation\">.</span>set_meter_provider<span class=\"token punctuation\">(</span>metrics_provider<span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\"># Creates a custom tracer from the global provider</span>\ntracer <span class=\"token operator\">=</span> trace<span class=\"token punctuation\">.</span>get_tracer<span class=\"token punctuation\">(</span><span class=\"token string\">\"users\"</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\"># Creates a custom meter from the global provider</span>\nmeter <span class=\"token operator\">=</span> metrics<span class=\"token punctuation\">.</span>get_meter<span class=\"token punctuation\">(</span><span class=\"token string\">\"users\"</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>Let's try to unpack what's going on there.</p>\n<h3 id=\"resources\" style=\"position:relative;\"><a href=\"#resources\" aria-label=\"resources permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Resources</h3>\n<p>First of all, let's pay attention to the <code class=\"language-text\">Resource{:.entity.name}</code>. It is an abstraction around entities that could generate signals:</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">from</span> opentelemetry<span class=\"token punctuation\">.</span>sdk<span class=\"token punctuation\">.</span>resources <span class=\"token keyword\">import</span> SERVICE_NAME<span class=\"token punctuation\">,</span> SERVICE_VERSION<span class=\"token punctuation\">,</span> Resource\n\nresource <span class=\"token operator\">=</span> Resource<span class=\"token punctuation\">(</span>\n    attributes<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>\n        SERVICE_NAME<span class=\"token punctuation\">:</span> <span class=\"token string\">\"notifications\"</span><span class=\"token punctuation\">,</span>\n        SERVICE_VERSION<span class=\"token punctuation\">:</span> <span class=\"token string\">\"v42\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">)</span></code></pre></div>\n<p>Right off the bat, <code class=\"language-text\">Resource{:.entity.name}</code> illustrates a few important concepts in the observability domain.</p>\n<p>Most context in the observability signals are going to be conveyed via <code class=\"language-text\">attributes{:.variable.parameter}</code> or tags which are essentially key-value pairs. Then, the observability backend could do some processing of these values to correlate various pieces of information.</p>\n<p>OTel strives to standardize the attribute names to keep them consistent across your system. That's why they come as constants.\nIn practice, this is an extremely daunting and challenging task, especially when multiple teams are working on different services in parallel.</p>\n<h3 id=\"providers\" style=\"position:relative;\"><a href=\"#providers\" aria-label=\"providers permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Providers</h3>\n<p>Python's SDK comes with two modules called <code class=\"language-text\">trace{:python}</code> and <code class=\"language-text\">metrics{:python}</code>.\nBoth modules contain a global variable that holds the current provider and a setter method like <code class=\"language-text\">set_tracer_provider(){:.entity.name.function}</code> to configure it.</p>\n<p>If you don't want to configure a real provider, there are also <code class=\"language-text\">NoOpTracerProvider{:.entity.name.class}</code> or <code class=\"language-text\">NoOpMeterProvider{:.entity.name.class}</code> that are helpful to keep all custom instrumentations in place without a need for guarding them via <code class=\"language-text\">if{:python}</code>s, for example.</p>\n<br>\n<div class=\"info\" style='background-color:#d9edf7; color:#31708f; border-left: solid #bce8f1 4px; border-radius: 4px; padding:0.7em;'>\n    <span>\n        <p style='margin-top:1em; text-align:center'>\n            <b>Design Patterns in Wild</b>\n        </p>\n        <p style='margin-left:1em;'>\n            All providers have NoOp implementations which is a great example of <a href=\"https://refactoring.guru/introduce-null-object\" style=\"color:#31708f\">the null object pattern</a>. Since telemetry could spread across codebase, it would be disastrous to have `if` statements everywhere we had it in case we have no proper observability setup under some circumstances like during automated testing.\n        </p>\n    </span>\n</div>\n<br>\n<p>Then, the rest of the codebase refers to the global providers when it needs to create traces or metrics.</p>\n<p><span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 84.11764705882354%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAARCAYAAADdRIy+AAAACXBIWXMAAAsTAAALEwEAmpwYAAACPUlEQVR42oWUWa/aMBCF8///FI/cPrQqvRJihyws2chGAgHC1N8gp9zeByIdxR57jufMjO3Im+92u4nneeL7vlRV9W67OEEQSBzHiiiKJAxDORwOst/ve2w2G8V2u+3X+LMXH5Akidqd3W4n1+tVTz+dTj3KspS6rjW6+Xwuy+VSVquV2pum0T34WMABsXM8HqUoin4ji0rW1AbPOetFUaodpGlq7Ga/ORAfa8/zXBxCxRhHsWLrB/L551MCz5c4NCk4hBopKUmzXNauLz9//Zbl2pV9lEhs/MkzEROcw0Yr7VBEsj56EuQ7WaWuGbvihb4s5guV051MepKpdKUrbTKTNh5LtPclyws5n8//CGGniicjs2oqqc9GRl3K/XFX6dPpVItwv57lfMrlYtYuDRXvJMueKftG6Lqu5kELYjZERm57ac24VEIqXNeNFGVlIspNHo9Gameqm34lRAqSqSROtm0+fnzIaDSSyWSiLYMC8m3XB4OBDIdDrTz+oCekklQOA3+qNR6P1ZnTmWdZpmv8UTWbzXRu1+HoJROulQuoOv3JmJNtz/HHmWgtiW2Xtm2fhMjAsF6vNSKqTRMDbIvFQv9shpCbdblctFVoZsCcSHtCTsGJqCgOpHaM3ZJDRv5w7Lquv7+M+z60jQ0pBMiBkELYR8Hmme/xeHwh+0ZopRA20pmT+NdkQwL+/+ydZx+B4edQKRLP5PVxeL349q6+AjuvC2lAGcVVQvoIdvsskTtAT76DfcIAHBD/BWpFBfC2rKDbAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"The Tracer &amp; Meter Registries\" title=\"\" src=\"/static/a7abcb42e06919377828d647272bad9d/c5bb3/opentelemetry-registries.png\" srcset=\"/static/a7abcb42e06919377828d647272bad9d/04472/opentelemetry-registries.png 170w,\n/static/a7abcb42e06919377828d647272bad9d/9f933/opentelemetry-registries.png 340w,\n/static/a7abcb42e06919377828d647272bad9d/c5bb3/opentelemetry-registries.png 680w,\n/static/a7abcb42e06919377828d647272bad9d/b12f7/opentelemetry-registries.png 1020w,\n/static/a7abcb42e06919377828d647272bad9d/b5a09/opentelemetry-registries.png 1360w,\n/static/a7abcb42e06919377828d647272bad9d/5c263/opentelemetry-registries.png 1636w\" sizes=\"(max-width: 680px) 100vw, 680px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n    </span>\n          </p>\n<div class=\"image-title\">The Tracer & Meter Registries</div>\n<h2 id=\"traces\" style=\"position:relative;\"><a href=\"#traces\" aria-label=\"traces permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Traces</h2>\n<p>The <code class=\"language-text\">TracerProvider{:.entity.name.class}</code> is basically a factory that creates <code class=\"language-text\">Tracer{:.entity.name.class}</code>s and passes most of its params down to a <code class=\"language-text\">Tracer{:.entity.name}</code>.\n<code class=\"language-text\">Tracer{:.entity.name}</code>s represent the specific <code class=\"language-text\">trace</code> that could contain many <code class=\"language-text\">spans</code>.</p>\n<p>Conceptually, <code class=\"language-text\">traces</code> are connected to the specific workflow or operation in the system.\nThat's why their names should be the same for the same processes e.g. <code class=\"language-text\">GET /users/{user_id}/</code> may represent all requests to an API that returns user's data.</p>\n<p>Then, <code class=\"language-text\">spans</code> may represent some steps in your workflow. For instance, to get the user information, you may need to perform a request to your database.\nThat action may be wrapped into a <code class=\"language-text\">span</code>. Additional <code class=\"language-text\">attributes{:.variable.parameter}</code> could be added to the span to record some events, action result statuses, etc.\nIn the end, all <code class=\"language-text\">spans</code> form a hierarchical tree that could be viewed in the observability backend.</p>\n<p><span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 36.47058823529412%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAAsTAAALEwEAmpwYAAABBUlEQVR42nWQa0/DIBRA+/9/lx+0cYnRpJmPxdS5rY/NvigUaDnSbrqluktODnDJhUuwKTVZYyaS2pB6p6InaXqiVBIliudMTY52kqV3dspv66NHdn6+LgxB1xa0n/fIzYJ2fYdMnpBdj5A9jUeoM1L3KDPQ2QFlj75EewIGA10B6uD9xaAqyryf2K408bIjiY1fD4hyYArH1QjmG84fNsqRF5bwVXAT1dy+NIRvgs1e/yngxuFO+BGcr7yEqaVMWPatJffOpeWQKoqVoHwXvzY+f/nq4N93u1lbp7muDPWHpIrbiTqWNFVLaWsq3SCtvFLwp6abMWt1jL3/9zB7YJE/ksiMb6fEH0JQA64tAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"An example of trace\" title=\"\" src=\"/static/d4fa410953bc03d36a554a71b39b7edb/c5bb3/traces-example.png\" srcset=\"/static/d4fa410953bc03d36a554a71b39b7edb/04472/traces-example.png 170w,\n/static/d4fa410953bc03d36a554a71b39b7edb/9f933/traces-example.png 340w,\n/static/d4fa410953bc03d36a554a71b39b7edb/c5bb3/traces-example.png 680w,\n/static/d4fa410953bc03d36a554a71b39b7edb/b12f7/traces-example.png 1020w,\n/static/d4fa410953bc03d36a554a71b39b7edb/b5a09/traces-example.png 1360w,\n/static/d4fa410953bc03d36a554a71b39b7edb/7e318/traces-example.png 1892w\" sizes=\"(max-width: 680px) 100vw, 680px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n    </span>\n          </p>\n<div class=\"image-title\">An example of trace</div>\n<p>Using <a href=\"#the-sdk\">the tracer inited above</a>, we can create a new trace via:</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token comment\"># the root span</span>\n<span class=\"token keyword\">with</span> tracer<span class=\"token punctuation\">.</span>start_as_current_span<span class=\"token punctuation\">(</span><span class=\"token string\">\"users:get-info\"</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">as</span> span<span class=\"token punctuation\">:</span>\n    span<span class=\"token punctuation\">.</span>set_attribute<span class=\"token punctuation\">(</span><span class=\"token string\">\"user_id\"</span><span class=\"token punctuation\">,</span> <span class=\"token builtin\">str</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\n    <span class=\"token comment\"># nested/child span</span>\n    <span class=\"token keyword\">with</span> tracer<span class=\"token punctuation\">.</span>start_as_current_span<span class=\"token punctuation\">(</span><span class=\"token string\">\"users:get-info:check-permissions\"</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">as</span> span<span class=\"token punctuation\">:</span>\n        <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span></code></pre></div>\n<h3 id=\"spans\" style=\"position:relative;\"><a href=\"#spans\" aria-label=\"spans permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Spans</h3>\n<p>In OTel protocol, <code class=\"language-text\">traces</code> are rather virtual entities that hold some execution context. The real data points that are being collected, processed and exported are <code class=\"language-text\">spans</code>.</p>\n<p>The <code class=\"language-text\">Span{:.entity.name.class}</code> consists of:</p>\n<ul>\n<li>name - the human-friendly title of the step</li>\n<li>kind like internal, server, client, producer, consumer</li>\n<li>status like <code class=\"language-text\">not set</code>, <code class=\"language-text\">ok</code>, <code class=\"language-text\">error</code></li>\n<li>the span context</li>\n<li>the parent span context</li>\n<li>the resource context</li>\n<li>the trace or instrumentation scope</li>\n<li>span <code class=\"language-text\">attributes{:.variable.parameter}</code></li>\n<li>span events - special entities with the name, timestamp and own set of <code class=\"language-text\">attributes{:.variable.parameter}</code></li>\n<li>span links to other spans that have caused the current span</li>\n<li>start_time &#x26; end_time as <code class=\"language-text\">time.time_ns(){:python}</code></li>\n</ul>\n<p>The <code class=\"language-text\">Span{:.entity.name.class}</code> class is also a <a href=\"https://book.pythontips.com/en/latest/context_managers.html#context-managers\" target=\"_blank\" rel=\"noopener noreferrer\">context manager</a>, so when it starts and exits, the span signals the <code class=\"language-text\">SpanProcessor</code> about that.</p>\n<h3 id=\"span-sampling\" style=\"position:relative;\"><a href=\"#span-sampling\" aria-label=\"span sampling permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Span Sampling</h3>\n<p>There is also an optional opportunity to configure a span sampler.</p>\n<p>Sampling is a way to filter out some spans or other data points if they match some specific criteria or just randomly.\nThe major reasons to sample are:</p>\n<ul>\n<li>to optimize the cost of ingesting and storing observability signals</li>\n<li>filter out boring regular data and mostly keep interesting one e.g. spans with errors, that took more than the threshold</li>\n<li>merely filter based on the presence or absence of <code class=\"language-text\">attributes{:.variable.parameter}</code></li>\n</ul>\n<p>Sampling on the SDK side could allow filtering as soon as possible in the pipeline (or the head sampling).</p>\n<p>OTel comes with a few span samplers out of the box:</p>\n<ul>\n<li><code class=\"language-text\">StaticSampler{:.entity.name.class}</code> that always or never drops spans</li>\n<li><code class=\"language-text\">TraceIdRatio{:.entity.name.class}</code> that probabilistically drops a given portion of spans</li>\n</ul>\n<p><span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 25.294117647058822%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAyUlEQVR42oVQ2QqDMBDM/39c+9R6xKJVUxTvGzU6dQJCKYUOLNnsTHY2K/CBfd+htcayLCZf1xVpkkDFMdI0MZzWK8ZxxDzP+AWxbZsR8syyDFVVoSgKdF2HsiwhvQdc6SFSLwzDYPhTx8Z8xwEY7CMoIpHnOaSUiGIFPwgRRjGUOnI/wO1u4RmGRkMTgg1o3Pf9MX1qgibi/CpBkpPRgEZN3cCybVyuVziOa+qMaZrQtp05CU55hvjeAYs0OPdZ1zWSY4905/0f3nr7gaRrNamLAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"OTel SDK Span Pipeline\" title=\"\" src=\"/static/ad6a5407e664f64a485dc7096d755d37/c5bb3/otel-traces-pipeline.png\" srcset=\"/static/ad6a5407e664f64a485dc7096d755d37/04472/otel-traces-pipeline.png 170w,\n/static/ad6a5407e664f64a485dc7096d755d37/9f933/otel-traces-pipeline.png 340w,\n/static/ad6a5407e664f64a485dc7096d755d37/c5bb3/otel-traces-pipeline.png 680w,\n/static/ad6a5407e664f64a485dc7096d755d37/b12f7/otel-traces-pipeline.png 1020w,\n/static/ad6a5407e664f64a485dc7096d755d37/b5a09/otel-traces-pipeline.png 1360w,\n/static/ad6a5407e664f64a485dc7096d755d37/a368f/otel-traces-pipeline.png 4529w\" sizes=\"(max-width: 680px) 100vw, 680px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n    </span>\n          </p>\n<div class=\"image-title\">OTel SDK Span Pipeline</div>\n<p>These two samplers could be also configured to respect parent span decisions, so if the parent span was dropped, all its children spans would be eliminated, too.</p>\n<div class=\"info\" style='background-color:#d9edf7; color:#31708f; border-left: solid #bce8f1 4px; border-radius: 4px; padding:0.7em;'>\n    <span>\n        <p style='margin-top:1em; text-align:center'>\n            <b>Design Patterns in Wild</b>\n        </p>\n        <p style='margin-left:1em;'>\n            Parent span aware sampling is implemented using <a href=\"https://refactoring.guru/design-patterns/composite\" style=\"color:#31708f\">the composite design pattern</a>.<br><br>\n            The parent-based sampler wraps the static or ratio-based sampler mentioned above and adds a logic to propagate the parent span's sampling decision.\n        </p>\n    </span>\n</div>\n<h3 id=\"span-processors\" style=\"position:relative;\"><a href=\"#span-processors\" aria-label=\"span processors permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Span Processors</h3>\n<p>When spans end, they come to span processors. Span processing is the last stage of span's lifecycle before it's exported outside of the service. OpenTelemetry uses it to batch spans and multiplex them to multiple exporters.</p>\n<p>The <code class=\"language-text\">BatchSpanProcessor</code> collects spans and exports them on schedule or when its queue is full. For that, it maintains a separate daemon thread where this logic is executed. The processor waits until a batch is collected or a timeout is reached.\n<a href=\"https://docs.python.org/3/library/threading.html#condition-objects\" target=\"_blank\" rel=\"noopener noreferrer\">Threading.condition</a> is used to implement this elegantly.</p>\n<p><span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 91.1764705882353%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAASCAYAAABb0P4QAAAACXBIWXMAAAsTAAALEwEAmpwYAAACNElEQVR42pVU+2/SUBjlj9efjImJi/wyo4mbEuNjPn5xgwS3BdGADpiMWmihhfJsoTxbXseeb0JmpgltcvnuvV977vnO+S4RBM96vcbAHcEZDPGroqPdtdFz+vDnc4R9IvyZTSd4klTwKG3j7qtv2Pts4t5JFRdqXV5ardbhAOdzHx9Tl3h+WkL06AzPEjk8Pf4Ord66BlyHBJxOJtiPXwqzO7FzPExU8OBTCSXN/MNwJbL8b9wC9D0Pb8/yeHFaxN7LYxzEf+AgcQHD6mCjcSiG3myGw+RPPD6v4f7rFPaTZUTjCkpVC16gr+u6cBwH/X5f5r1eT9adTkf2bjP0Pbz7quIwbSD6PoXYFx2xdA261cVqucB0OpUxGo22cTweYzgcyvovQN/3Jek6Nsaugw9Hb1BWroJ5H6PgAy+QI1TblMtlWJaFWs1Aw2ogm81CDfbMeh2maULTNClzo+VNI/5pSqVSkQlZtttt0YcAjUZD2Nm2LQfuak4kk8mg2+2i1WrJh2REoSk4D1AURXI7A+ZyOSwWi6DkGlRVRbValQMoOFlvJNkZkJqxcclqMBhsW2TjYGhAlkytyIqgzWZTwK7byZeSubczYKFQECZkRoaT4BqSIXuNkQxDAeq6juVyuW1esmKcBbeH2tIcOk4w5ubBXxorYuT65uB+JJ/PC4t60HeM7D26ahiGOE6zmNtcM0pD99lOZM53ObjHfEQLGBavSigWrySyLwlCt8mewDx915vyGwLsWsj3Xb0LAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"A Batch Queue with Timeout\" title=\"\" src=\"/static/4fef94e00abdfbb5293a6536a776c7f5/c5bb3/otel-batch-queue-with-timeout.png\" srcset=\"/static/4fef94e00abdfbb5293a6536a776c7f5/04472/otel-batch-queue-with-timeout.png 170w,\n/static/4fef94e00abdfbb5293a6536a776c7f5/9f933/otel-batch-queue-with-timeout.png 340w,\n/static/4fef94e00abdfbb5293a6536a776c7f5/c5bb3/otel-batch-queue-with-timeout.png 680w,\n/static/4fef94e00abdfbb5293a6536a776c7f5/b12f7/otel-batch-queue-with-timeout.png 1020w,\n/static/4fef94e00abdfbb5293a6536a776c7f5/77abb/otel-batch-queue-with-timeout.png 1305w\" sizes=\"(max-width: 680px) 100vw, 680px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n    </span>\n          </p>\n<div class=\"image-title\">A Batch Queue with Timeout</div>\n<p>There are also two <code class=\"language-text\">MultiSpanProcessors</code> that operate on a list of span processors and dispatch them sequentially or concurrently.</p>\n<p>The concurrent span processing happens via <a href=\"https://docs.python.org/3/library/concurrent.futures.html#threadpoolexecutor\" target=\"_blank\" rel=\"noopener noreferrer\">ThreadPoolExecutor</a>.</p>\n<h2 id=\"ctx-propagation\" style=\"position:relative;\"><a href=\"#ctx-propagation\" aria-label=\"ctx propagation permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Ctx Propagation</h2>\n<p>So far we have been talking about trace spans processing in the scope of one services,\nbut the real value of traces unlocks when multiple microservices take part in a workflow and you could connect what they were doing there into one coherent picture.</p>\n<p>In order to do that, OpenTelemetry needs to propagate some context during cross-service communication,\nso the next microservice in the flow would know that all spans it was going to create should be attached to the parent trace created at the start of the workflow.</p>\n<p><span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 37.05882352941176%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAAsTAAALEwEAmpwYAAABPklEQVR42l1R2W6DMBDk//+wjZo0JDGHbXyADwgw3V0pLx1ptGu01wyNNRaTndDeW9yuV4zjCGstYow4jgP7ztwl/yCEgGmapO7e3nFrb+h1D2MMmsvvD7owQPkeYYmotUqTDJ6c0NDCnAu294bzPKG1xnnsWNKMMRp01Pt0Cg/1RNO+HvA5YHQjfPJyDYObRm3gfICmgf2oJRZaaOj7QYPfVFu3Feu2wQcP5xwaY7QMsKHgpQPsXBHLDqU6eO+xLIvIn+eZrswi9ev7AhMLBpehfYGlPMRZ6hrWLb7MCcoV9C4hl0oXGpFf15W2RyG/2UullOR9qHi5ikz5RlemlNCwNEYpBSYk8rHgTV7xoo98BnvHZAzDIM0LMdIhmSLXsopGdQo9FfDWnvKOIv8QlvYZ8B/slXhMdR/ym3v+AF2lGDv66eWeAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"The Context Propagation in a Distributed Workflow\" title=\"\" src=\"/static/5ae49fc56c264f7827b5482ce153c221/c5bb3/otel-context-propagation.png\" srcset=\"/static/5ae49fc56c264f7827b5482ce153c221/04472/otel-context-propagation.png 170w,\n/static/5ae49fc56c264f7827b5482ce153c221/9f933/otel-context-propagation.png 340w,\n/static/5ae49fc56c264f7827b5482ce153c221/c5bb3/otel-context-propagation.png 680w,\n/static/5ae49fc56c264f7827b5482ce153c221/b12f7/otel-context-propagation.png 1020w,\n/static/5ae49fc56c264f7827b5482ce153c221/b5a09/otel-context-propagation.png 1360w,\n/static/5ae49fc56c264f7827b5482ce153c221/31fce/otel-context-propagation.png 2229w\" sizes=\"(max-width: 680px) 100vw, 680px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n    </span>\n          </p>\n<div class=\"image-title\">The Context Propagation in a Distributed Workflow</div>\n<p>OTel holds propagatable information in the <span class=\"green\">runtime context</span>.\nIn Python's SDK, it's implemented using the convenient <a href=\"https://docs.python.org/3/library/contextvars.html\" target=\"_blank\" rel=\"noopener noreferrer\">contextvars</a> standard library which is a perfect mechanism to have scoped \"global\" variables on the level of asyncio.Task-s, for example.</p>\n<p>By default, OTel defines two context vars:</p>\n<ul>\n<li>the <span class=\"green\">current span</span> - holds a reference to the currently active OTel trace span</li>\n<li>the <span class=\"green\">baggage</span> - holds arbitrary key-value information that should be propagated as an additional context for every microservice involved</li>\n</ul>\n<p>Another important thing here is the actual <span class=\"blue\">context propagation</span> which incurs context serialization and deserialization.</p>\n<p>In the realm of HTTP-based communication, OpenTelemetry propagates the context via HTTP headers according to <a href=\"https://www.w3.org/TR/trace-context/\" target=\"_blank\" rel=\"noopener noreferrer\">the W3C Trace Context specification</a>. According to the specification, the current span context is propagated as two headers:</p>\n<ul>\n<li><code class=\"language-text\">traceparent</code> - with trace span ID, parent span ID and parent span flags (e.g. trace was marked as sampled or not)</li>\n<li><code class=\"language-text\">tracestate</code> - arbitrary vendor-specific trace context or identifiers</li>\n</ul>\n<p>The <span class=\"green\">baggage</span> context doesn't seem to be outlined in the specification, but OTel shares it as one more identically named HTTP header.</p>\n<p>The microservice that receives such requests should be aware of context information in the headers, extract it and set it in the local <span class=\"green\">runtime context</span>.</p>\n<p>Since OpenTelemetry is framework- or transport-protocol-agnostic, it just provides all needed functions to extract or inject context.\nTo actually propagate that information, you should instrument your clients and servers and OTel provides plenty of auto-instrumentors in <a href=\"https://opentelemetry.io/ecosystem/registry/\" target=\"_blank\" rel=\"noopener noreferrer\">their registry</a>.</p>\n<h2 id=\"metrics\" style=\"position:relative;\"><a href=\"#metrics\" aria-label=\"metrics permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Metrics</h2>\n<p>Metrics are another observability pillar we are going to review next. The mechanism of collecting metrics is a bit different to traces.</p>\n<p>In case of traces, user code actively creates trace spans and as soon as they are completed, OpenTelemetry can process and export them.\nThe metrics dynamic is much more continuous, so the collection really ends when the service shuts down.\nSince service uptime could be measured in days if not weeks, we need to take a different approach here to export all measurements in between like doing metric data aggregations periodically over a time window.</p>\n<p>Just like in the case of traces, OpenTelemetry provides <span class=\"orange\">MeterProvider</span> that bridges all metrics with metric exporters.\n<span class=\"orange\">MeterProvider</span> creates new instances of <code class=\"language-text\">Meter{:.entity.name.class}</code>.\nMeters are instrumentation-specific measurement components. Each OTel instrumentation library creates its own meter (e.g. HTTP client or server meters).\nWhen you do your custom measurements it's alright to have one global meter per service (but you certainly could have more).</p>\n<p>Using <a href=\"#the-sdk\">the meter inited above</a>, you can measure a custom metric like that:</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token comment\"># globally defined custom metric</span>\nuser_info_cache_miss_counter <span class=\"token operator\">=</span> meter<span class=\"token punctuation\">.</span>create_counter<span class=\"token punctuation\">(</span>\n    <span class=\"token string\">\"users.cache.miss\"</span><span class=\"token punctuation\">,</span>\n    description<span class=\"token operator\">=</span><span class=\"token string\">\"The number of cache misses when fetching user's info\"</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\"># later on, you can import the metric and measure what you need</span>\nuser_info_cache_miss_counter<span class=\"token punctuation\">.</span>add<span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span><span class=\"token string\">\"user.org_id\"</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre></div>\n<h3 id=\"metric-instruments\" style=\"position:relative;\"><a href=\"#metric-instruments\" aria-label=\"metric instruments permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Metric Instruments</h3>\n<p>Now, having a meter, you could create specific metrics (a.k.a. metric instruments) that you want to measure or observe. Generally, OTel divides metrics into two categories:</p>\n<ul>\n<li><code class=\"language-text\">Synchronous metrics</code> - there are metrics that you measure directly right in your service workflows, so you observe them as soon as the event happens (e.g. a service increases a counter metric in the user login workflow)</li>\n<li><code class=\"language-text\">Asynchronous (or observable) metrics</code> - these metrics are read from \"external\" sources, so you just observe an aggregated or in-time statistics instead of measuring the value directly (e.g. number of items in a queue given that you cannot instrument the queue directly and you could just read its size property)</li>\n</ul>\n<p>OpenTelemetry supports the following metric types:</p>\n<ul>\n<li><span class=\"green\">Counter</span> (and <span class=\"green\">Observable Counter</span>) - an ever-growing (or monotonically increasing) value (for example, the number of requests processed by service)</li>\n<li><span class=\"green\">UpDownCounter</span> (and <span class=\"green\">Observable UpDownCounter</span>) - a value that could grow or fall (for example, the number of in-flight requests)</li>\n<li><span class=\"green\">Histogram</span> (and <span class=\"green\">Observable Histogram</span>) - suitable for measurements on which you want to calculate statistics (for example, request latency)</li>\n<li><span class=\"green\">Gauge</span> - just like the observable <span class=\"green\">UpDownCounter</span>, but each measurement is treated as a separate data point, so they are not summed up (for example, CPU or RAM utilizations)</li>\n</ul>\n<h3 id=\"views--aggregations\" style=\"position:relative;\"><a href=\"#views--aggregations\" aria-label=\"views  aggregations permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Views &#x26; Aggregations</h3>\n<p>With our metrics defined, we could start measuring, aggregating and collecting actual values.</p>\n<p>Metric instruments don't collect data directly but rather send it to <code class=\"language-text\">MeasurementConsumer{:.entity.name.class}</code> which is a global component initiated on the <span class=\"orange\">MeterProvider's</span> level.\n<code class=\"language-text\">MeasurementConsumer{:.entity.name.class}</code> collects data for each and all <code class=\"language-text\">MetricReader{:.entity.name.class}</code>s configured on the provider.</p>\n<p><span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 38.82352941176471%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsTAAALEwEAmpwYAAABZElEQVR42n2SXWvUQBSG89P9Bd4KgiAFtbJQ7JU3gqB4oZa19KIrrdlE2Y8kM0lmspnJ5+7Tydqt3W7xhQPnzBwezns4nlle0lYFgzabzTZ22qWBMDz/Knl5ljKTBe8nuatTwqSgqSyRbpCrhrpd45lvz1hFv/YJt/D1+m/9O7UcnUnejFP+JDmfgxUnE8tSVa5xTeVAA6zrN3gyPKerDW3fkZvchXIf3d2kfd/Tti1xIhAy3b61TUddt3tudvJkrikLwyT86aY45tWPEfNojhCC2XxGGIZorVFKYY2hLCvi6TuiqxfoPN75+Qe0pkRlCn8+5fX3EW/HJ0QiRuWKxXJBEAQkIiHLMnThwLokCj8Q+yMKlTwCtHZb67LgOvG5Fj5VXd01DHYbF4P1YadNY4ln5yymn6hLcQjkP9rb0W1uy4yLL08Zf3yCjCYHfd5DwGOLvj9F7U5senmKf3FMLoOD67gB6Fxipmj/2ugAAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"The Architecture of OTel Metrics\" title=\"\" src=\"/static/5e850c2e48c5ff45838ec4dcc327fa77/c5bb3/otel-metrics-architecture.png\" srcset=\"/static/5e850c2e48c5ff45838ec4dcc327fa77/04472/otel-metrics-architecture.png 170w,\n/static/5e850c2e48c5ff45838ec4dcc327fa77/9f933/otel-metrics-architecture.png 340w,\n/static/5e850c2e48c5ff45838ec4dcc327fa77/c5bb3/otel-metrics-architecture.png 680w,\n/static/5e850c2e48c5ff45838ec4dcc327fa77/b12f7/otel-metrics-architecture.png 1020w,\n/static/5e850c2e48c5ff45838ec4dcc327fa77/b5a09/otel-metrics-architecture.png 1360w,\n/static/5e850c2e48c5ff45838ec4dcc327fa77/89b99/otel-metrics-architecture.png 4741w\" sizes=\"(max-width: 680px) 100vw, 680px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n    </span>\n          </p>\n<div class=\"image-title\">The Architecture of OTel Metrics</div>\n<p>Thinking about our source metrics data, it's just arrays of numbers with attributes (or one number at the time in the case of observable instruments), so there are multiple options possible how they could be aggregated.\nOpenTelemetry provides great flexibility there.</p>\n<p><span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 35.29411764705882%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAAsTAAALEwEAmpwYAAABR0lEQVR42nWRzUrDUBBG8/6PoAsVF1U3giCCUqiIYtGKtqZqa2vbNPbHJE1yb9J4b5JjrF0okg8GhmGYmW+OwW/lMPNG3I6uaQwucdzBTznPKVP+K75lTIeXTN6qjN/qLDyfMJwzdHpYziuuayOEJMsy0jRD6xSdpqu8TIY3a7GY3jG1TaSIcBbvNMcPtKwGvm+vhsw/HI5aHgePEXuPktNnD60+SbUmiBQT/xORFIuyHGPwcsxrc59h54QkingaNdm42mG7vkvP7qAShTUeU7lfsHUfs9mQHBbDpRBIKfFEwlwoXKkIYo3hztrMrBs+JibLeEmy9PDlO0E4YinnhIVlpRQyTggKB14gCGVcbnkyvKDXqmD3z1eWpwWIWrdKrXNG3zLJy9+1BvYXjNHpdrm6rmOa7XVDVkDQxeP1Kv9HM/+Jsgu/ABbAE9G1EJ1uAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"OTel Metrics, Views, Aggregations\" title=\"\" src=\"/static/22515c44b0ce08ec183f72acbb5b224a/c5bb3/otel-metrics-logical-structure.png\" srcset=\"/static/22515c44b0ce08ec183f72acbb5b224a/04472/otel-metrics-logical-structure.png 170w,\n/static/22515c44b0ce08ec183f72acbb5b224a/9f933/otel-metrics-logical-structure.png 340w,\n/static/22515c44b0ce08ec183f72acbb5b224a/c5bb3/otel-metrics-logical-structure.png 680w,\n/static/22515c44b0ce08ec183f72acbb5b224a/b12f7/otel-metrics-logical-structure.png 1020w,\n/static/22515c44b0ce08ec183f72acbb5b224a/b5a09/otel-metrics-logical-structure.png 1360w,\n/static/22515c44b0ce08ec183f72acbb5b224a/ebb58/otel-metrics-logical-structure.png 3575w\" sizes=\"(max-width: 680px) 100vw, 680px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n    </span>\n          </p>\n<div class=\"image-title\">OTel Metrics, Views, Aggregations</div>\n<p>First of all, aggregations could be configured on the metric exporter side. Maybe, you are an observability backend vendor like DataDog or Chronosphere and you come up with a better or specific way to deal with metric data points. This would be an opportunity for you to adjust exported data.</p>\n<p>Then, you could leverage a concept of <span class=\"yellow\">views</span> to override the config further. <span class=\"yellow\">Views</span> effectively allow to specify the aggregation strategy per metric instrument and its metadata (e.g. name, attributes).</p>\n<p>By default, OTel implements the following aggregations:</p>\n<ul>\n<li><span class=\"yellow\">Drop Aggregation</span> - a way to drop metric collection completely.</li>\n<li><span class=\"yellow\">Last Value Aggregation</span> - keeps the last aggregated value until it's collected (used by gauges).</li>\n<li><span class=\"yellow\">Sum Aggregation</span> - arithmetic sum of provided data points (used by counters).</li>\n<li><span class=\"yellow\">Explicit Bucket Histogram Aggregation</span> - assigns collected data points to one of 15 predefined buckets. Besides that, it collects sum, count, min and max across given data.</li>\n<li><span class=\"yellow\">Exponential Bucket Histogram Aggregation</span> - similar to the explicit bucket aggregation, but buckets are generated dynamically by the exponentially growing size of the next bucket and much more fine grained (by default, there are 150 buckets).</li>\n</ul>\n<p>The sum and histogram aggregations may collect data between probes as:</p>\n<ul>\n<li><span class=\"yellow\">deltas</span> e.g. differences between the previous aggregated stats (e.g. sums, counts) and the current ones.</li>\n<li><span class=\"yellow\">cumulative data</span> e.g. the previous and the current stats are summed up (so the values keep increasing over time).</li>\n</ul>\n<p>This is called <span class=\"yellow\">aggregation temporality</span>.</p>\n<p><span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 51.17647058823529%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsTAAALEwEAmpwYAAABcUlEQVR42pVSyUoDQRSc7/boRcjBg+hBPPkpHlREowwqaDTGZJaeFSezZ5mUrxpbRvEQGx7Fa7qr61W1hS3WYrFAURTbHIX1e6MoSpRVjVyQ9ZHN4Xg+fN8X4lYTs+bzua6mabDZbHRpwuVyCdZ6vUbTthiN3/HyNsPZ5RDn1zYGB8fY2R3Avn+UyzWUUvpsFEWaJM9z3XOxt6qqQlmW+iXWxPEwdRUubmxc3T7g8OQUe/tHGN7ZiOMIr+MxsizDZDJBmqZwHEcjVXfd5ufIXdeBD1ApyVvBVvyjAjMJ/VytVhr7vVFpmfmNB38tXqzrWj/471AMOS+b13MZh2Nxn0qMor6yb0Jz2RwOwhhhnMIPIgRRDF+FcD0Fx3VRiddhGGpbkiTRgTDp/nQ6FBrKYCr5Ls+S8swL8CQ4FRx99VGcaE+ZMhdTpkIGZPxcSm/1/eOm6weiMBFUojKUP6gQRon8Q6VT5n+kKiJtIDGRxJz0EyQ6ACDJjMl4AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"Aggregation Temporalities\" title=\"\" src=\"/static/f164b8bdcc536352f6468a1b83819da1/c5bb3/opentelemetry-temporalities.png\" srcset=\"/static/f164b8bdcc536352f6468a1b83819da1/04472/opentelemetry-temporalities.png 170w,\n/static/f164b8bdcc536352f6468a1b83819da1/9f933/opentelemetry-temporalities.png 340w,\n/static/f164b8bdcc536352f6468a1b83819da1/c5bb3/opentelemetry-temporalities.png 680w,\n/static/f164b8bdcc536352f6468a1b83819da1/b12f7/opentelemetry-temporalities.png 1020w,\n/static/f164b8bdcc536352f6468a1b83819da1/b5a09/opentelemetry-temporalities.png 1360w,\n/static/f164b8bdcc536352f6468a1b83819da1/3a793/opentelemetry-temporalities.png 2973w\" sizes=\"(max-width: 680px) 100vw, 680px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n    </span>\n          </p>\n<div class=\"image-title\">Aggregation Temporalities</div>\n<h3 id=\"metric-readers\" style=\"position:relative;\"><a href=\"#metric-readers\" aria-label=\"metric readers permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Metric Readers</h3>\n<p>As we briefly have mentioned, metrics are collected on schedule by <span class=\"blue\">MetricReader</span> like <span class=\"blue\">PeriodicExportingMetricReader</span> which holds a ticker in a separate thread.\nThe ticker initiates the metrics collection process that creates exportable data according to <span class=\"yellow\">metrics aggregation temporalities</span>.</p>\n<h2 id=\"logs\" style=\"position:relative;\"><a href=\"#logs\" aria-label=\"logs permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Logs</h2>\n<p>Finally, we get to logs. They are the most wide-spread among the signals and have the longest record of being used for diagnosing how code works.</p>\n<p>Logs are simple to operate. You could just write them to a standard output or a file, and then dredge them when you need. No need to have special viewers like you would need in case of traces or metrics.\nThat's why pretty much all languages have their off-the-shelf logging libraries to use.</p>\n<p>Ironically, logs have gotten the last into OpenTelemetry. The integration is either in the experimental stage or doesn't exist for most languages at the moment.</p>\n<p><span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 24.705882352941178%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAAAsTAAALEwEAmpwYAAABF0lEQVR42lWQX0vDMBRH+/2fffBb7E3xZTJBh8JERAYqG2ttl65/TdOmabr2GOdEdy+BQG4u5/y8yFd8rBS6tozjgOlaOmvo+x5re4zpkFKSpglxHNM0zfHNYlpN13Xu38hvefPLmtnELV1LZCW5n8YsZhlZVpNGd+Src5TcEgQhy+WS1XpNJT+ZPGw4u95w8xKgG0WmLLmD8hZTzfxCk0Q/ZI+3IU9zQaUMMn+lDK9om4K6boiiEN/32TvC56Bk9l7yFmYM+55+Px6OV8kWWbb0dnD4hrxIyIqdU3IqrkvZUJQSpdRBXQhxovitPwzDnzL/SmuN2Ap2u4SqqtywdXfhshPkee5yTB1l5HI1h3x1axx5fbLwC7LPetz5bu2TAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"The OTel Log Adapter in Python\" title=\"\" src=\"/static/e10f598585f611a5a600f8ecab0cc8f8/c5bb3/opentelemetry-logs.png\" srcset=\"/static/e10f598585f611a5a600f8ecab0cc8f8/04472/opentelemetry-logs.png 170w,\n/static/e10f598585f611a5a600f8ecab0cc8f8/9f933/opentelemetry-logs.png 340w,\n/static/e10f598585f611a5a600f8ecab0cc8f8/c5bb3/opentelemetry-logs.png 680w,\n/static/e10f598585f611a5a600f8ecab0cc8f8/b12f7/opentelemetry-logs.png 1020w,\n/static/e10f598585f611a5a600f8ecab0cc8f8/b5a09/opentelemetry-logs.png 1360w,\n/static/e10f598585f611a5a600f8ecab0cc8f8/281b3/opentelemetry-logs.png 4441w\" sizes=\"(max-width: 680px) 100vw, 680px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n    </span>\n          </p>\n<div class=\"image-title\">The Log Bridge in Python</div>\n<p>OpenTelemetry bridges into the existing logging libraries to integrate logs seamlessly for applications. In Python's world, there is the standard <a href=\"https://docs.python.org/3/library/logging.html\" target=\"_blank\" rel=\"noopener noreferrer\">logging</a> package.\nOTel comes with a <code class=\"language-text\">LoggingHandler</code> that plugs the rest of components into the logging system. The LoggingHandler also translates logging.LogRecord into OTel's LogRecord data class.</p>\n<div class=\"info\" style='background-color:#d9edf7; color:#31708f; border-left: solid #bce8f1 4px; border-radius: 4px; padding:0.7em;'>\n    <span>\n        <p style='margin-top:1em; text-align:center'>\n            <b>Design Patterns in Wild</b>\n        </p>\n        <p style='margin-left:1em;'>\n            The OTel's <code>LoggingHandler</code> is a good example of applying <a href=\"https://refactoring.guru/design-patterns/adapter\" style=\"color:#31708f\">the adapter pattern</a> that allowed OpenTelemetry to have its own architecture despite a variety of logging libraries it needed to support.\n        </p>\n    </span>\n</div>\n<p>The remaining architecture resembles what we have reviewed in <a href=\"#span-processors\">the trace part</a>.\nThere is a dedicated LoggerProvider that holds log processors and exporters attached to the processors.\nThe processors send logs to exporters for further saving in observability backends.</p>\n<h2 id=\"semconv\" style=\"position:relative;\"><a href=\"#semconv\" aria-label=\"semconv permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>SemConv</h2>\n<p>Before wrapping up, we need to touch on another important topic that is tangentially connected to service instrumentations and metrics.</p>\n<p>Imagine you have three teams in a company that run different subsystems.\nNow let's ask them to define golden signal metrics for their services and see what metric names they come up with.\nChances are we would get three different sets of names for semantically the same metrics. That's even more likely if they work with different tech stacks with different conventions and naming standards.</p>\n<p>Such a lack of consistency would create a lot of mess and hinder reuse of common dashboards, alerts, etc.\nThe same situations can happen in traces when we instrument database queries, object storage access, etc.</p>\n<p>OTel recognized this problem and <a href=\"https://opentelemetry.io/docs/specs/semconv/\" target=\"_blank\" rel=\"noopener noreferrer\">came up with a set of common names for common operations across all three signals</a>.\nSo if you use it, you can come up with a very unified view of the whole system when looking at it through an observability lens.</p>\n<h2 id=\"conclusion\" style=\"position:relative;\"><a href=\"#conclusion\" aria-label=\"conclusion permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Conclusion</h2>\n<p>In this article, we have reviewed OpenTelemetry integration from the service development perspective by looking into the internals of the SDK.</p>\n<p>In the next part, we will see what happens with logs when they come to the OTel Collector.</p>\n<h2 id=\"references\" style=\"position:relative;\"><a href=\"#references\" aria-label=\"references permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>References</h2>\n<ul>\n<li><a href=\"https://opentelemetry.io/docs/concepts/signals/\" target=\"_blank\" rel=\"noopener noreferrer\">[OpenTelemetry] Signals</a></li>\n<li><a href=\"https://opentelemetry.io/docs/instrumentation/python/\" target=\"_blank\" rel=\"noopener noreferrer\">[OpenTelemetry] Python SDK</a></li>\n<li><a href=\"https://opentelemetry.io/docs/concepts/signals/baggage/\" target=\"_blank\" rel=\"noopener noreferrer\">[OpenTelemetry] Baggage</a></li>\n<li><a href=\"https://opentelemetry.io/docs/concepts/sampling/\" target=\"_blank\" rel=\"noopener noreferrer\">[OpenTelemetry] Sampling</a></li>\n<li><a href=\"https://opentelemetry.io/docs/concepts/signals/logs/\" target=\"_blank\" rel=\"noopener noreferrer\">[OpenTelemetry] Logs</a></li>\n<li><a href=\"https://opentelemetry.io/docs/languages/python/cookbook/\" target=\"_blank\" rel=\"noopener noreferrer\">[OpenTelemetry] Python Cookbook</a></li>\n<li><a href=\"https://opentelemetry.io/docs/specs/semconv/\" target=\"_blank\" rel=\"noopener noreferrer\">[OpenTelemetry] Semantic Conventions</a></li>\n</ul>","timeToRead":13,"rawMarkdownBody":"OpenTelemetry is an observability framework and an active [CNCF project](https://www.cncf.io/projects/opentelemetry/) that provides a vendor-neutral and tool-agnostic way to collect observability signals across your heterogeneous system.\n\nIn this blog post series, we will dig into two big questions:\n\n- how OpenTelemetry instrumentation works on the application side taking [Python's SDK](https://github.com/open-telemetry/opentelemetry-python/) as an example. We will touch traces, metrics, logs and context propagation across services.\n- how OpenTelemetry Collector works under the hood and some of the interesting engineering decisions made there (see [the OTel Collector blog post](./-sdk/))\n\nGotta be fun ðŸ™Œ\n\n## The Problem\n\nWith the rise of the open source community, people and organizations donâ€™t really want to invest in proprietary protocols and standards anymore. Instead, it's mainstream to pick a widely-recognized open source project as a basis to build on top of it.\n\nIn the observability domain, there are enough open source protocols that cover some of the three key pillars:\n\n- `Logs` - stdout and stderr streams your services or application outputs while running in the container.\n- `Metrics` - aggregations of some measurements over a period of time\n- `Traces` - a visualization of the steps or the execution path that your workflow passed\n\n![The Three Pillars of Observability](./observability-pillars.png \"The Three Pillars of Observability\")\n<div class=\"image-title\">The Three Pillars of Observability</div>\n\nWhen you think about metrics, [Prometheus](https://prometheus.io/) and [statsd](https://github.com/statsd/statsd) may come to your mind.\nOn the traces side, there are [Jaeger](https://www.jaegertracing.io/) and [Zipkin](https://zipkin.io/).\nThere are also various beats that could scrap your logs like [fluentd](https://www.fluentd.org/) or [Grafana Loki](https://grafana.com/oss/loki/).\n\nNow if you want to cover all three pillars, you need to pick a combination of collectors/protocols to cover each one (well, some are capable of covering a few pillars).\nHowever, there are still a few problems left:\n\n- even though the protocols are open source, they may still tightly connect your application to the underlying collector or storage, so it won't be that easy to switch gears and use something else\n- we have divided observability into three pieces, but in reality, they are three different signals or points of view on the application work, so we may get the whole picture and max value out of them when they are well connected and correlated for us\n\n![Observability signals are unconnected](./observability-signals-unconnected.png \"The observability signals are unconnected\")\n<div class=\"image-title\">The observability signals are unconnected when you use separate highly specialized protocols</div>\n\nTo sum it up, we want to have:\n\n- one open source vendor-lock-free protocol to rule all observability signals\n- a stable abstraction for us for the underlying observability storage(s) without a need to migrate our service every time that storage changes\n- a coverage of popular programming languages, not to be limited in what our tech stack looks like\n\n![Observability signals with OTel](./otel-observability-signals.png \"Observability signals with OTel\")\n<div class=\"image-title\">Observability signals with OTel</div>\n\n<br>\n<div class=\"info\" style='background-color:#d9edf7; color:#31708f; border-left: solid #bce8f1 12px; border-radius: 33px; padding: 1.7em;'>\n<span>\n<p style='margin-top:1em; text-align:center'>\n<b>The OTEL Origin</b>\n</p>\n<p style='margin-left:1em;'>This ubiquitous open protocol idea is so compelling that at some point there were two projects, <a href=\"https://opentracing.io/\" style=\"color:#31708f\">OpenTracing</a> and <a href=\"https://opencensus.io/\" style=\"color:#31708f\">OpenCensus</a>, that were trying to fill the gap.<br><br>\nThey were trying to compete with each other, but there was not the right context to do that, so it didn't make sense to try to conquer some market shares, but rather to consolidate their effort and come there much quicker shaping the space.\nThat's what happened. Both projects were merged into one known as <a href=\"https://opentelemetry.io/\" style=\"color:#31708f\">OpenTelemetry</a> (aka OTel).\n</p>\n</span>\n</div>\n<br>\n\n\n\n\n## The SDK\n\n\n\n\nCollecting logs, metrics and traces in a unified way across services implemented in different technical stacks is the central task of OpenTelemetry.\nTo get there, OpenTelemetry provides:\n\n- SDKs for [11+ of the most popular languages](https://opentelemetry.io/docs/instrumentation/) (like Python, Go, NodeJS, Rust, Java, etc) that inits OTel core components\n- library-specific instrumentations that provide tool/framework-specific signals and context automagically (e.g. [Starlette](https://www.starlette.io/), [HTTPX](https://www.python-httpx.org/), [aiopika](https://aio-pika.readthedocs.io/en/latest/) instrumentations, and so on)\n\nThe third thing you could do is to further instrument your codebase with business logic specific traces and metrics.\n\nThis process is generally known as codebase *instrumentation*.\n\nThere are two ways to setup OTel in your application:\n\n- automatic - when you run some agent before the main application entry point that configures OpenTelemetry (but not all languages support it, for example, Golang doesn't)\n- manual - when you configure OpenTelemetry yourself to start collecting your observability signals.\n\nTo understand how OpenTelemetry SDK is designed and implemented, we will delve into the manual setup.\n\nThis is what it takes you to manually setup Python's service:\n\n```python {11-12,21-22,24,27}\nfrom opentelemetry import metrics, trace\nfrom opentelemetry.sdk.metrics import MeterProvider\nfrom opentelemetry.sdk.metrics.export import (\n    ConsoleMetricExporter,\n    PeriodicExportingMetricReader,\n)\nfrom opentelemetry.sdk.resources import SERVICE_NAME, SERVICE_VERSION, Resource\nfrom opentelemetry.sdk.trace import TracerProvider\nfrom opentelemetry.sdk.trace.export import BatchSpanProcessor, ConsoleSpanExporter\n\nspan_processor = BatchSpanProcessor(ConsoleSpanExporter())\nmetric_reader = PeriodicExportingMetricReader(ConsoleMetricExporter())\n\nresource = Resource(\n    attributes={\n        SERVICE_NAME: \"notifications\",\n        SERVICE_VERSION: \"v42\",\n    }\n)\n\ntrace_provider = TracerProvider(resource=resource)\nmetrics_provider = MeterProvider(metric_readers=[metric_reader])\n\ntrace_provider.add_span_processor(span_processor)\n\n# Sets the global default providers\ntrace.set_tracer_provider(trace_provider)\nmetrics.set_meter_provider(metrics_provider)\n\n# Creates a custom tracer from the global provider\ntracer = trace.get_tracer(\"users\")\n\n# Creates a custom meter from the global provider\nmeter = metrics.get_meter(\"users\")\n```\n\nLet's try to unpack what's going on there.\n\n### Resources\n\nFirst of all, let's pay attention to the `Resource{:.entity.name}`. It is an abstraction around entities that could generate signals:\n\n```python\nfrom opentelemetry.sdk.resources import SERVICE_NAME, SERVICE_VERSION, Resource\n\nresource = Resource(\n    attributes={\n        SERVICE_NAME: \"notifications\",\n        SERVICE_VERSION: \"v42\",\n    }\n)\n```\n\nRight off the bat, `Resource{:.entity.name}` illustrates a few important concepts in the observability domain.\n\nMost context in the observability signals are going to be conveyed via `attributes{:.variable.parameter}` or tags which are essentially key-value pairs. Then, the observability backend could do some processing of these values to correlate various pieces of information.\n\nOTel strives to standardize the attribute names to keep them consistent across your system. That's why they come as constants.\nIn practice, this is an extremely daunting and challenging task, especially when multiple teams are working on different services in parallel.\n\n### Providers\n\nPython's SDK comes with two modules called `trace{:python}` and `metrics{:python}`.\nBoth modules contain a global variable that holds the current provider and a setter method like `set_tracer_provider(){:.entity.name.function}` to configure it.\n\nIf you don't want to configure a real provider, there are also `NoOpTracerProvider{:.entity.name.class}` or `NoOpMeterProvider{:.entity.name.class}` that are helpful to keep all custom instrumentations in place without a need for guarding them via `if{:python}`s, for example.\n\n<br>\n<div class=\"info\" style='background-color:#d9edf7; color:#31708f; border-left: solid #bce8f1 4px; border-radius: 4px; padding:0.7em;'>\n    <span>\n        <p style='margin-top:1em; text-align:center'>\n            <b>Design Patterns in Wild</b>\n        </p>\n        <p style='margin-left:1em;'>\n            All providers have NoOp implementations which is a great example of <a href=\"https://refactoring.guru/introduce-null-object\" style=\"color:#31708f\">the null object pattern</a>. Since telemetry could spread across codebase, it would be disastrous to have `if` statements everywhere we had it in case we have no proper observability setup under some circumstances like during automated testing.\n        </p>\n    </span>\n</div>\n\n<br>\n\nThen, the rest of the codebase refers to the global providers when it needs to create traces or metrics.\n\n![The Tracer & Meter Registries](./opentelemetry-registries.png \"The Tracer & Meter Registries\")\n<div class=\"image-title\">The Tracer & Meter Registries</div>\n\n## Traces\n\nThe `TracerProvider{:.entity.name.class}` is basically a factory that creates `Tracer{:.entity.name.class}`s and passes most of its params down to a `Tracer{:.entity.name}`.\n`Tracer{:.entity.name}`s represent the specific `trace` that could contain many `spans`.\n\nConceptually, `traces` are connected to the specific workflow or operation in the system.\nThat's why their names should be the same for the same processes e.g. `GET /users/{user_id}/` may represent all requests to an API that returns user's data.\n\nThen, `spans` may represent some steps in your workflow. For instance, to get the user information, you may need to perform a request to your database.\nThat action may be wrapped into a `span`. Additional `attributes{:.variable.parameter}` could be added to the span to record some events, action result statuses, etc.\nIn the end, all `spans` form a hierarchical tree that could be viewed in the observability backend.\n\n![An example of trace](./traces-example.png \"An example of trace\")\n<div class=\"image-title\">An example of trace</div>\n\nUsing [the tracer inited above](#the-sdk), we can create a new trace via:\n\n```python\n# the root span\nwith tracer.start_as_current_span(\"users:get-info\") as span:\n    span.set_attribute(\"user_id\", str(...))\n\n    # nested/child span\n    with tracer.start_as_current_span(\"users:get-info:check-permissions\") as span:\n        ...\n```\n\n### Spans\n\nIn OTel protocol, `traces` are rather virtual entities that hold some execution context. The real data points that are being collected, processed and exported are `spans`.\n\nThe `Span{:.entity.name.class}` consists of:\n\n- name - the human-friendly title of the step\n- kind like internal, server, client, producer, consumer\n- status like `not set`, `ok`, `error`\n- the span context\n- the parent span context\n- the resource context\n- the trace or instrumentation scope\n- span `attributes{:.variable.parameter}`\n- span events - special entities with the name, timestamp and own set of `attributes{:.variable.parameter}`\n- span links to other spans that have caused the current span\n- start_time & end_time as `time.time_ns(){:python}`\n\nThe `Span{:.entity.name.class}` class is also a [context manager](https://book.pythontips.com/en/latest/context_managers.html#context-managers), so when it starts and exits, the span signals the `SpanProcessor` about that.\n\n### Span Sampling\n\nThere is also an optional opportunity to configure a span sampler.\n\nSampling is a way to filter out some spans or other data points if they match some specific criteria or just randomly.\nThe major reasons to sample are:\n\n- to optimize the cost of ingesting and storing observability signals\n- filter out boring regular data and mostly keep interesting one e.g. spans with errors, that took more than the threshold\n- merely filter based on the presence or absence of `attributes{:.variable.parameter}`\n\nSampling on the SDK side could allow filtering as soon as possible in the pipeline (or the head sampling).\n\nOTel comes with a few span samplers out of the box:\n\n- `StaticSampler{:.entity.name.class}` that always or never drops spans\n- `TraceIdRatio{:.entity.name.class}` that probabilistically drops a given portion of spans\n\n![OTel SDK Span Pipeline](./otel-traces-pipeline.png \"OTEL SDK Span Pipeline\")\n<div class=\"image-title\">OTel SDK Span Pipeline</div>\n\nThese two samplers could be also configured to respect parent span decisions, so if the parent span was dropped, all its children spans would be eliminated, too.\n\n<div class=\"info\" style='background-color:#d9edf7; color:#31708f; border-left: solid #bce8f1 4px; border-radius: 4px; padding:0.7em;'>\n    <span>\n        <p style='margin-top:1em; text-align:center'>\n            <b>Design Patterns in Wild</b>\n        </p>\n        <p style='margin-left:1em;'>\n            Parent span aware sampling is implemented using <a href=\"https://refactoring.guru/design-patterns/composite\" style=\"color:#31708f\">the composite design pattern</a>.<br><br>\n            The parent-based sampler wraps the static or ratio-based sampler mentioned above and adds a logic to propagate the parent span's sampling decision.\n        </p>\n    </span>\n</div>\n\n\n### Span Processors\n\nWhen spans end, they come to span processors. Span processing is the last stage of span's lifecycle before it's exported outside of the service. OpenTelemetry uses it to batch spans and multiplex them to multiple exporters.\n\nThe `BatchSpanProcessor` collects spans and exports them on schedule or when its queue is full. For that, it maintains a separate daemon thread where this logic is executed. The processor waits until a batch is collected or a timeout is reached.\n[Threading.condition](https://docs.python.org/3/library/threading.html#condition-objects) is used to implement this elegantly.\n\n![A Batch Queue with Timeout](./otel-batch-queue-with-timeout.png \"A Batch Queue with Timeout\")\n<div class=\"image-title\">A Batch Queue with Timeout</div>\n\nThere are also two `MultiSpanProcessors` that operate on a list of span processors and dispatch them sequentially or concurrently.\n\nThe concurrent span processing happens via [ThreadPoolExecutor](https://docs.python.org/3/library/concurrent.futures.html#threadpoolexecutor).\n\n## Ctx Propagation\n\nSo far we have been talking about trace spans processing in the scope of one services,\nbut the real value of traces unlocks when multiple microservices take part in a workflow and you could connect what they were doing there into one coherent picture.\n\nIn order to do that, OpenTelemetry needs to propagate some context during cross-service communication,\nso the next microservice in the flow would know that all spans it was going to create should be attached to the parent trace created at the start of the workflow.\n\n![The Context Propagation in a Distributed Workflow](./otel-context-propagation.png \"The Context Propagation in a Distributed Workflow\")\n<div class=\"image-title\">The Context Propagation in a Distributed Workflow</div>\n\nOTel holds propagatable information in the <span class=\"green\">runtime context</span>.\nIn Python's SDK, it's implemented using the convenient [contextvars](https://docs.python.org/3/library/contextvars.html) standard library which is a perfect mechanism to have scoped \"global\" variables on the level of asyncio.Task-s, for example.\n\nBy default, OTel defines two context vars:\n\n- the <span class=\"green\">current span</span> - holds a reference to the currently active OTel trace span\n- the <span class=\"green\">baggage</span> - holds arbitrary key-value information that should be propagated as an additional context for every microservice involved\n\nAnother important thing here is the actual <span class=\"blue\">context propagation</span> which incurs context serialization and deserialization.\n\nIn the realm of HTTP-based communication, OpenTelemetry propagates the context via HTTP headers according to [the W3C Trace Context specification](https://www.w3.org/TR/trace-context/). According to the specification, the current span context is propagated as two headers:\n\n- `traceparent` - with trace span ID, parent span ID and parent span flags (e.g. trace was marked as sampled or not)\n- `tracestate` - arbitrary vendor-specific trace context or identifiers\n\nThe <span class=\"green\">baggage</span> context doesn't seem to be outlined in the specification, but OTel shares it as one more identically named HTTP header.\n\nThe microservice that receives such requests should be aware of context information in the headers, extract it and set it in the local <span class=\"green\">runtime context</span>.\n\nSince OpenTelemetry is framework- or transport-protocol-agnostic, it just provides all needed functions to extract or inject context.\nTo actually propagate that information, you should instrument your clients and servers and OTel provides plenty of auto-instrumentors in [their registry](https://opentelemetry.io/ecosystem/registry/).\n\n## Metrics\n\nMetrics are another observability pillar we are going to review next. The mechanism of collecting metrics is a bit different to traces.\n\nIn case of traces, user code actively creates trace spans and as soon as they are completed, OpenTelemetry can process and export them.\nThe metrics dynamic is much more continuous, so the collection really ends when the service shuts down.\nSince service uptime could be measured in days if not weeks, we need to take a different approach here to export all measurements in between like doing metric data aggregations periodically over a time window.\n\nJust like in the case of traces, OpenTelemetry provides <span class=\"orange\">MeterProvider</span> that bridges all metrics with metric exporters.\n<span class=\"orange\">MeterProvider</span> creates new instances of `Meter{:.entity.name.class}`.\nMeters are instrumentation-specific measurement components. Each OTel instrumentation library creates its own meter (e.g. HTTP client or server meters).\nWhen you do your custom measurements it's alright to have one global meter per service (but you certainly could have more).\n\nUsing [the meter inited above](#the-sdk), you can measure a custom metric like that:\n\n```python\n# globally defined custom metric\nuser_info_cache_miss_counter = meter.create_counter(\n    \"users.cache.miss\",\n    description=\"The number of cache misses when fetching user's info\",\n)\n\n# later on, you can import the metric and measure what you need\nuser_info_cache_miss_counter.add(1, {\"user.org_id\": ...})\n```\n\n### Metric Instruments\n\nNow, having a meter, you could create specific metrics (a.k.a. metric instruments) that you want to measure or observe. Generally, OTel divides metrics into two categories:\n\n- `Synchronous metrics` - there are metrics that you measure directly right in your service workflows, so you observe them as soon as the event happens (e.g. a service increases a counter metric in the user login workflow)\n- `Asynchronous (or observable) metrics` - these metrics are read from \"external\" sources, so you just observe an aggregated or in-time statistics instead of measuring the value directly (e.g. number of items in a queue given that you cannot instrument the queue directly and you could just read its size property)\n\nOpenTelemetry supports the following metric types:\n\n- <span class=\"green\">Counter</span> (and <span class=\"green\">Observable Counter</span>) - an ever-growing (or monotonically increasing) value (for example, the number of requests processed by service)\n- <span class=\"green\">UpDownCounter</span> (and <span class=\"green\">Observable UpDownCounter</span>) - a value that could grow or fall (for example, the number of in-flight requests)\n- <span class=\"green\">Histogram</span> (and <span class=\"green\">Observable Histogram</span>) - suitable for measurements on which you want to calculate statistics (for example, request latency)\n- <span class=\"green\">Gauge</span> - just like the observable <span class=\"green\">UpDownCounter</span>, but each measurement is treated as a separate data point, so they are not summed up (for example, CPU or RAM utilizations)\n\n### Views & Aggregations\n\nWith our metrics defined, we could start measuring, aggregating and collecting actual values.\n\nMetric instruments don't collect data directly but rather send it to `MeasurementConsumer{:.entity.name.class}` which is a global component initiated on the <span class=\"orange\">MeterProvider's</span> level.\n`MeasurementConsumer{:.entity.name.class}` collects data for each and all `MetricReader{:.entity.name.class}`s configured on the provider.\n\n![The Architecture of OTel Metrics](./otel-metrics-architecture.png \"The Architecture of OTel Metrics\")\n<div class=\"image-title\">The Architecture of OTel Metrics</div>\n\nThinking about our source metrics data, it's just arrays of numbers with attributes (or one number at the time in the case of observable instruments), so there are multiple options possible how they could be aggregated.\nOpenTelemetry provides great flexibility there.\n\n![OTel Metrics, Views, Aggregations](./otel-metrics-logical-structure.png \"OTel Metrics, Views, Aggregations\")\n<div class=\"image-title\">OTel Metrics, Views, Aggregations</div>\n\nFirst of all, aggregations could be configured on the metric exporter side. Maybe, you are an observability backend vendor like DataDog or Chronosphere and you come up with a better or specific way to deal with metric data points. This would be an opportunity for you to adjust exported data.\n\nThen, you could leverage a concept of <span class=\"yellow\">views</span> to override the config further. <span class=\"yellow\">Views</span> effectively allow to specify the aggregation strategy per metric instrument and its metadata (e.g. name, attributes).\n\nBy default, OTel implements the following aggregations:\n\n- <span class=\"yellow\">Drop Aggregation</span> - a way to drop metric collection completely.\n- <span class=\"yellow\">Last Value Aggregation</span> - keeps the last aggregated value until it's collected (used by gauges).\n- <span class=\"yellow\">Sum Aggregation</span> - arithmetic sum of provided data points (used by counters).\n- <span class=\"yellow\">Explicit Bucket Histogram Aggregation</span> - assigns collected data points to one of 15 predefined buckets. Besides that, it collects sum, count, min and max across given data.\n- <span class=\"yellow\">Exponential Bucket Histogram Aggregation</span> - similar to the explicit bucket aggregation, but buckets are generated dynamically by the exponentially growing size of the next bucket and much more fine grained (by default, there are 150 buckets).\n\nThe sum and histogram aggregations may collect data between probes as:\n\n- <span class=\"yellow\">deltas</span> e.g. differences between the previous aggregated stats (e.g. sums, counts) and the current ones.\n- <span class=\"yellow\">cumulative data</span> e.g. the previous and the current stats are summed up (so the values keep increasing over time).\n\nThis is called <span class=\"yellow\">aggregation temporality</span>.\n\n![Aggregation Temporalities](./opentelemetry-temporalities.png \"Aggregation Temporalities\")\n<div class=\"image-title\">Aggregation Temporalities</div>\n\n### Metric Readers\n\nAs we briefly have mentioned, metrics are collected on schedule by <span class=\"blue\">MetricReader</span> like <span class=\"blue\">PeriodicExportingMetricReader</span> which holds a ticker in a separate thread.\nThe ticker initiates the metrics collection process that creates exportable data according to <span class=\"yellow\">metrics aggregation temporalities</span>.\n\n## Logs\n\nFinally, we get to logs. They are the most wide-spread among the signals and have the longest record of being used for diagnosing how code works.\n\nLogs are simple to operate. You could just write them to a standard output or a file, and then dredge them when you need. No need to have special viewers like you would need in case of traces or metrics.\nThat's why pretty much all languages have their off-the-shelf logging libraries to use.\n\nIronically, logs have gotten the last into OpenTelemetry. The integration is either in the experimental stage or doesn't exist for most languages at the moment.\n\n![The OTel Log Adapter in Python](./opentelemetry-logs.png \"The OTel Log Adapter in Python\")\n<div class=\"image-title\">The Log Bridge in Python</div>\n\nOpenTelemetry bridges into the existing logging libraries to integrate logs seamlessly for applications. In Python's world, there is the standard [logging](https://docs.python.org/3/library/logging.html) package.\nOTel comes with a `LoggingHandler` that plugs the rest of components into the logging system. The LoggingHandler also translates logging.LogRecord into OTel's LogRecord data class.\n\n\n<div class=\"info\" style='background-color:#d9edf7; color:#31708f; border-left: solid #bce8f1 4px; border-radius: 4px; padding:0.7em;'>\n    <span>\n        <p style='margin-top:1em; text-align:center'>\n            <b>Design Patterns in Wild</b>\n        </p>\n        <p style='margin-left:1em;'>\n            The OTel's <code>LoggingHandler</code> is a good example of applying <a href=\"https://refactoring.guru/design-patterns/adapter\" style=\"color:#31708f\">the adapter pattern</a> that allowed OpenTelemetry to have its own architecture despite a variety of logging libraries it needed to support.\n        </p>\n    </span>\n</div>\n\n\nThe remaining architecture resembles what we have reviewed in [the trace part](#span-processors).\nThere is a dedicated LoggerProvider that holds log processors and exporters attached to the processors.\nThe processors send logs to exporters for further saving in observability backends.\n\n## SemConv\n\nBefore wrapping up, we need to touch on another important topic that is tangentially connected to service instrumentations and metrics.\n\nImagine you have three teams in a company that run different subsystems.\nNow let's ask them to define golden signal metrics for their services and see what metric names they come up with.\nChances are we would get three different sets of names for semantically the same metrics. That's even more likely if they work with different tech stacks with different conventions and naming standards.\n\nSuch a lack of consistency would create a lot of mess and hinder reuse of common dashboards, alerts, etc.\nThe same situations can happen in traces when we instrument database queries, object storage access, etc.\n\nOTel recognized this problem and [came up with a set of common names for common operations across all three signals](https://opentelemetry.io/docs/specs/semconv/).\nSo if you use it, you can come up with a very unified view of the whole system when looking at it through an observability lens.\n\n## Conclusion\n\nIn this article, we have reviewed OpenTelemetry integration from the service development perspective by looking into the internals of the SDK.\n\nIn the next part, we will see what happens with logs when they come to the OTel Collector.\n\n## References\n\n- [[OpenTelemetry] Signals](https://opentelemetry.io/docs/concepts/signals/)\n- [[OpenTelemetry] Python SDK](https://opentelemetry.io/docs/instrumentation/python/)\n- [[OpenTelemetry] Baggage](https://opentelemetry.io/docs/concepts/signals/baggage/)\n- [[OpenTelemetry] Sampling](https://opentelemetry.io/docs/concepts/sampling/)\n- [[OpenTelemetry] Logs](https://opentelemetry.io/docs/concepts/signals/logs/)\n- [[OpenTelemetry] Python Cookbook](https://opentelemetry.io/docs/languages/python/cookbook/)\n- [[OpenTelemetry] Semantic Conventions](https://opentelemetry.io/docs/specs/semconv/)\n","wordCount":{"words":2785},"frontmatter":{"id":"54e37b96a690de61cbad4dca","path":"/blog/opentelemtry/","humanDate":"Sep 26, 2024","fullDate":"2024-09-26","title":"Get Started with OpenTelemetry SDKs","keywords":["Open source","Architecture","Observability","Python","Cloud native"],"excerpt":"Logs, metrics, traces collection in OTel SDK","cover":{"childImageSharp":{"gatsbyImageData":{"layout":"fullWidth","placeholder":{"fallback":"data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAPABQDASIAAhEBAxEB/8QAFwABAQEBAAAAAAAAAAAAAAAAAwAEBf/EABUBAQEAAAAAAAAAAAAAAAAAAAIB/9oADAMBAAIQAxAAAAHn7AZlJI3/xAAcEAABBAMBAAAAAAAAAAAAAAADAAECExESFDH/2gAIAQEAAQUCb3TKqVgZMIwxx6gr/8QAFREBAQAAAAAAAAAAAAAAAAAAABL/2gAIAQMBAT8BlL//xAAXEQEAAwAAAAAAAAAAAAAAAAAAERJh/9oACAECAQE/AZWx/8QAHBAAAQMFAAAAAAAAAAAAAAAAAAIRQRIhIjFx/9oACAEBAAY/AoOWNGSRlVOSf//EABoQAQADAQEBAAAAAAAAAAAAAAEAETEhYfD/2gAIAQEAAT8hAbBYU6w0rXVZGrDUJ5yBEdCzSfEn/9oADAMBAAIAAwAAABDU/wD/xAAZEQABBQAAAAAAAAAAAAAAAAAAAREhQVH/2gAIAQMBAT8QrI/UP//EABcRAAMBAAAAAAAAAAAAAAAAAAABESH/2gAIAQIBAT8QzXCR/8QAHRABAAICAgMAAAAAAAAAAAAAAQARIUEQMVFxgf/aAAgBAQABPxA2Jm4j4JUAnpKYM3mnJ6ipl2Mj73EjBEwNa4v/2Q=="},"images":{"fallback":{"src":"/static/2f2b99fde24246114829499e2f8fabc8/82a09/otel-sdk.jpg","srcSet":"/static/2f2b99fde24246114829499e2f8fabc8/e861d/otel-sdk.jpg 750w,\n/static/2f2b99fde24246114829499e2f8fabc8/6bd9b/otel-sdk.jpg 1080w,\n/static/2f2b99fde24246114829499e2f8fabc8/43e8f/otel-sdk.jpg 1366w,\n/static/2f2b99fde24246114829499e2f8fabc8/82a09/otel-sdk.jpg 1408w","sizes":"100vw"},"sources":[{"srcSet":"/static/2f2b99fde24246114829499e2f8fabc8/3c28e/otel-sdk.webp 750w,\n/static/2f2b99fde24246114829499e2f8fabc8/2795f/otel-sdk.webp 1080w,\n/static/2f2b99fde24246114829499e2f8fabc8/94836/otel-sdk.webp 1366w,\n/static/2f2b99fde24246114829499e2f8fabc8/4c7ac/otel-sdk.webp 1408w","type":"image/webp","sizes":"100vw"}]},"width":1,"height":0.7272727272727273}}},"coverCredits":"Photo by <a href=\"https://lumigo.io/opentelemetry/opentelemetry-and-python-benefits-and-a-quick-tutorial/\">Lumigo opentelemetry blog series</a> on <a href=\"https://lumigo.io/opentelemetry/\">Lumigo</a>"}}},"pageContext":{"prevThought":{"frontmatter":{"path":"/blog/data-on-kubernetes-8/","title":"Data on Kubernetes: Part 8â€Š-â€ŠExploring TiDB, a cloud-native database","date":"2024-09-27 13:06:00"},"excerpt":"TiDB: A Cloud-Native Database for hybrid workloads ðŸ“š Introduction The idea of a Kubernetes-native database like TiDB came up to solve theâ€¦","html":"<blockquote>\n<p><strong>TiDB: A Cloud-Native Database for hybrid workloads</strong></p>\n</blockquote>\n<h2 id=\"-introduction\" style=\"position:relative;\"><a href=\"#-introduction\" aria-label=\" introduction permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>ðŸ“š Introduction</h2>\n<p>The idea of a Kubernetes-native database like TiDB came up to solve the problems of running traditional databases on Kubernetes. Databases like MySQL and Cassandra have been around for a long time and work well, but they can be hard to manage on Kubernetes.Â </p>\n<p><a href=\"https://docs.pingcap.com/tidb/stable\" target=\"_blank\" rel=\"noopener noreferrer\">TiDB</a>, created by PingCAP, is built from the start to work well with Kubernetes. It can handle both <a href=\"https://www.fivetran.com/blog/databases-demystified-analytical-vs-transactional\" target=\"_blank\" rel=\"noopener noreferrer\">transactional and analytical workloads</a> without needing a separate ETL process. This makes TiDB a very useful  for managing data on Kubernetes.</p>\n<p>Traditional databases often face challenges when adapted to Kubernetes, such as managing multiple nodes and integrating with Kubernetes storage. TiDB addresses these issues by being designed as a cloud-native database from day one.Â </p>\n<p>It makes use of Kubernetes resources like Pods, StatefulSets, and PersistentVolumes, and is managed by an operator, making deployment and scaling easier. With TiDB, you get the benefits of both transactional and analytical processing in one system, simplifying your data management tasks.</p>\n<h2 id=\"ï¸-history-and-development-oftidb\" style=\"position:relative;\"><a href=\"#%EF%B8%8F-history-and-development-oftidb\" aria-label=\"ï¸ history and development oftidb permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>âœï¸ History and development ofÂ TiDB</h2>\n<p>TiDB, <a href=\"https://docs.pingcap.com/tidb/stable/overview\" target=\"_blank\" rel=\"noopener noreferrer\">short for \"Titanium Database,\"</a> is an open-source, MySQL-compatible database developed by PingCAP. The development of TiDB began in 2015 with the goal of creating a database that could handle both transactional and analytical workloads efficiently. The inspiration for TiDB came from Google's F1 project, which built on top of Spanner, a globally distributed database.</p>\n<p>TiDB was designed to address the limitations of traditional databases, such as scalability and flexibility, by making use of a cloud-native architecture.</p>\n<h3 id=\"overview-of-pingcap-and-their-role-in-the-development-oftidb\" style=\"position:relative;\"><a href=\"#overview-of-pingcap-and-their-role-in-the-development-oftidb\" aria-label=\"overview of pingcap and their role in the development oftidb permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Overview of PingCAP and their role in the development ofÂ TiDB</h3>\n<p>PingCAP, the company behind TiDB, was founded by a group of engineers with extensive experience in database systems and distributed computing. Their mission was to build a database that could meet the demands of modern applications, which require both high availability and the ability to process large volumes of data in real-time.</p>\n<p>PingCAP has been the primary contributor to TiDB, continuously improving its features and performance. They have also fostered a strong community around TiDB, encouraging collaboration and contributions from developers worldwide.</p>\n<h3 id=\"key-features-oftidb\" style=\"position:relative;\"><a href=\"#key-features-oftidb\" aria-label=\"key features oftidb permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Key Features ofÂ TiDB</h3>\n<p><strong><em>âœ… Hybrid Transactional and Analytical Processing (HTAP):</em></strong></p>\n<p>One of the standout features of TiDB is its support for Hybrid Transactional and Analytical Processing (HTAP). This means TiDB can handle both transactional (OLTP) and analytical (OLAP) workloads without the need for a separate ETL process. TiDB achieves this by using two different storage engines: TiKV for transactional workloads and TiFlash for analytical workloads. This dual-engine approach allows TiDB to provide real-time analytics on fresh transactional data, making it highly efficient for applications that require both types of operations.</p>\n<p><strong><em>âœ… MySQL compatibility:</em></strong></p>\n<p>TiDB is fully compatible with MySQL, which means it can be used as a drop-in replacement for MySQL databases. This compatibility extends to MySQL protocols and SQL syntax, making it easy for developers to migrate their applications to TiDB without significant changes. This feature also allows TiDB to integrate seamlessly with existing MySQL tools and ecosystems.</p>\n<p><strong><em>âœ… Scalability and flexibility:</em></strong></p>\n<p>TiDB is designed to scale horizontally, which means it can handle increasing amounts of data and traffic by adding more nodes to the cluster. This scalability is achieved through a distributed architecture where data is automatically sharded and balanced across multiple nodes. TiDB's flexibility allows it to run on various environments, including on-premises data centers, public clouds, and Kubernetes clusters. This makes TiDB a versatile solution for different deployment scenarios.</p>\n<p><strong><em>âœ… High availability and fault tolerance:</em></strong></p>\n<p>TiDB ensures high availability and fault tolerance through its distributed architecture. Data is replicated across multiple nodes, typically with at least three replicas, to provide redundancy. In the event of a node failure, TiDB can automatically failover to another replica, ensuring continuous availability. The Placement Driver (PD) component of TiDB manages metadata and coordinates data placement, further enhancing the system's resilience and ability to recover from failures.</p>\n<h2 id=\"tidb-architecture\" style=\"position:relative;\"><a href=\"#tidb-architecture\" aria-label=\"tidb architecture permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>TiDB Architecture</h2>\n<p>TiDB's architecture is designed for high performance, scalability, and flexibility by separating compute and storage into distinct, independently scalable components.</p>\n<p>Let's look at each component:</p>\n<p><strong><em>âŽ TiDB:</em></strong></p>\n<p>Each TiDB instance is a stateless service exposing a MySQL endpoint. It parses SQL requests, uses metadata from the Placement Driver to create execution plans, and queries TiKV and TiFlash nodes. Results are assembled and returned to the client. A proxy typically provides load balancing for the TiDB cluster.</p>\n<p><strong><em>âŽ TiKV:</em></strong></p>\n<p>TiKV is an open-source, distributed key-value database for transactional workloads. It uses RocksDB and provides a custom Distributed SQL API. TiKV ensures high availability and fault tolerance by storing multiple replicas of data across nodes, supporting automatic failover. It is a CNCF Graduated project recognized for its reliability.</p>\n<p><strong><em>âŽ TiFlash:</em></strong></p>\n<p>TiFlash is a columnar storage engine for analytical workloads, based on ClickHouse. Data is replicated from TiKV to TiFlash in real-time, enabling analytical queries on fresh transactional data without a separate ETL process. Columnar storage offers significant performance advantages for analytical queries.</p>\n<p><strong><em>âŽ TiSpark:</em></strong></p>\n<p>TiSpark is a library for Apache Spark, supporting complex analytical (OLAP) queries. It integrates with Spark to ingest data from TiFlash using the Distributed SQL API, leveraging Spark's data processing capabilities for large-scale analytics.</p>\n<p><strong><em>âŽ Placement Driver (PD):</em></strong></p>\n<p>The PD manages metadata for TiDB, deployed in a cluster of at least three nodes. It uses range-based sharding to divide table keys into regions, assigning them to TiKV nodes. PD monitors data amounts, splitting large regions to scale up and merging smaller ones to scale down.</p>\n<p><strong><em>âŽ TiDB Operator:</em></strong></p>\n<p>The TiDB Operator automates deployment, management, and scaling of TiDB clusters on Kubernetes. It handles tasks like deployment, scaling, upgrades, monitoring, and backup/restore operations, leveraging Kubernetes resources like Pods, StatefulSets, and PersistentVolumes.</p>\n<h3 id=\"how-tidb-uses-kubernetes-resources\" style=\"position:relative;\"><a href=\"#how-tidb-uses-kubernetes-resources\" aria-label=\"how tidb uses kubernetes resources permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>How TiDB uses Kubernetes resources</h3>\n<p>TiDB integrates seamlessly with Kubernetes, using its resources to manage and scale efficiently:</p>\n<ul>\n<li><strong><em>Pods:</em></strong> Each TiDB instance runs as a stateless service in a Pod, easily scalable based on demand.</li>\n<li><strong><em>StatefulSets:</em></strong> TiKV and TiFlash nodes are deployed using StatefulSets, ensuring stable network identities and persistent storage.</li>\n<li><strong><em>PersistentVolumes (PVs) and PersistentVolumeClaims (PVCs):</em></strong> TiDB uses PVs for durable storage and PVCs for specific storage requests.</li>\n</ul>\n<h3 id=\"role-of-the-tidb-operator-in-managing-the-databases\" style=\"position:relative;\"><a href=\"#role-of-the-tidb-operator-in-managing-the-databases\" aria-label=\"role of the tidb operator in managing the databases permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Role of the TiDB operator in managing the databases:</h3>\n<p>The TiDB Operator simplifies running TiDB on Kubernetes by automating:</p>\n<ul>\n<li><strong><em>Deployment:</em></strong> Automates deployment of TiDB components using Kubernetes resources.</li>\n<li><strong><em>Scaling:</em></strong> Automatically scales TiDB clusters based on resource usage and demand.</li>\n<li><strong>Upgrades:</strong> Manages rolling upgrades, minimizing downtime.</li>\n<li><strong><em>Monitoring and alerts:</em></strong> Integrates with Prometheus and Grafana for metrics and alerts.</li>\n<li><strong><em>Backup and restore:</em></strong> Supports backup and restore operations for data durability and recovery.</li>\n</ul>\n<h2 id=\"deploy-tidb-oneks\" style=\"position:relative;\"><a href=\"#deploy-tidb-oneks\" aria-label=\"deploy tidb oneks permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Deploy TiDB onÂ EKS</h2>\n<p>Deploying TiDB on AWS Elastic Kubernetes Service EKS involves several steps to ensure a smooth and efficient setup. Below is a guide to help you through the process.</p>\n<p><span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 54.11764705882353%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAACC0lEQVR42mNgYGBgRMIoQEtLi01fXl8AyOTJ8sqS31q4dW6mc6YSkM9tbGzMyoAP/P8PMXTt2gLJ5cuz/GfNSvTRs1QSA4rBNf6v/88SGhrKzBC6inlCeZpcc2641a7pNao3NvWIQMz4z8iQu20iu3NsgLBHtIcMyCWrFmba795evPTE4eqO0FAnaS0ZLSF3Y1vJ+vh4DqA806pVQAOBYEVzUvS2/pxFe6YXzFvenpQPN7BoV1ZV7trk+UU7suaUrEl1OZpZWr4+NW/ZzsziZXuLikJ3FM8s3pA3Ye+2oinbjmRPtuw9c0x3/pEjC2fsO7Bs5rHDUbOmXfCZPf3M9CXzr0xdNPuSK0PZge1lhdvWTqg8vKe3fO9Wp/8MDOxnZvaIHGqtFN1UX8+1v34Kz/36+QLH6lcJ/a/fz1I+cyZ/94YNWn0bN2pXTpgtPnlDY2DPsurJPcur+yesrnVmKNlzOLD6yKnwikMnYot37teBO50AgKlZtr81ZNr6sr7ZW6u7Fu9tc8OmlvE/ZqzDxMCgvr6eCURPnDiR/djkEwXbWvf07us53HVkyvFUYIStYoZhmEISAGPrsnmuVdMnZdXNmZ7avHCuDQOloL5/jl1J86T06o5ZyWUd080oNrCnY6ZNU/20tAndi+N72ucYkmUINBMwzJwZLXn8eObc7dvjl+7dm7T4yLGsqQBg8uNIePtjBgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\" alt text\" title=\"\" src=\"/static/bfa9f3f9d874c5d9e5e293a116ad888c/c5bb3/tidb-eks-steps.png\" srcset=\"/static/bfa9f3f9d874c5d9e5e293a116ad888c/04472/tidb-eks-steps.png 170w,\n/static/bfa9f3f9d874c5d9e5e293a116ad888c/9f933/tidb-eks-steps.png 340w,\n/static/bfa9f3f9d874c5d9e5e293a116ad888c/c5bb3/tidb-eks-steps.png 680w,\n/static/bfa9f3f9d874c5d9e5e293a116ad888c/b12f7/tidb-eks-steps.png 1020w,\n/static/bfa9f3f9d874c5d9e5e293a116ad888c/b5a09/tidb-eks-steps.png 1360w,\n/static/bfa9f3f9d874c5d9e5e293a116ad888c/65781/tidb-eks-steps.png 2778w\" sizes=\"(max-width: 680px) 100vw, 680px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n    </span>\n          </p>\n<p>Before deploying a TiDB cluster on EKS, make sure the below requirements are satisfied:</p>\n<ul>\n<li><a href=\"https://helm.sh/docs/intro/install/\" target=\"_blank\" rel=\"noopener noreferrer\">Install Helm 3</a>: used for deploying TiDB Operator.</li>\n<li><a href=\"https://docs.aws.amazon.com/eks/latest/userguide/getting-started-eksctl.html\" target=\"_blank\" rel=\"noopener noreferrer\">Complete all operations in Getting started with eksctl</a>. The guide includes the steps to install and configure <code class=\"language-text\">awscli</code>, <code class=\"language-text\">eksctl</code> used for creating Kubernetes clusters and <code class=\"language-text\">kubectl</code>.</li>\n</ul>\n<h3 id=\"create-eks-cluster-and-nodepool\" style=\"position:relative;\"><a href=\"#create-eks-cluster-and-nodepool\" aria-label=\"create eks cluster and nodepool permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Create EKS Cluster and NodeÂ Pool</h3>\n<p>The Recommended instance types and storage are:\nInstance types: to gain better performance, the following is recommended:</p>\n<ul>\n<li><strong><em>PD nodes:</em></strong> <code class=\"language-text\">c7g.xlarge</code></li>\n<li><strong><em>TiDB nodes:</em></strong> <code class=\"language-text\">c7g.4xlarge</code></li>\n<li><strong><em>TiKV or TiFlash nodes:</em></strong> <code class=\"language-text\">m7g.4xlarge</code></li>\n<li><strong><em>Storage:</em></strong> Because AWS supports the EBS <code class=\"language-text\">gp3</code> volume type, it is recommended to use <code class=\"language-text\">EBS gp3</code>. For gp3 provisioning, the following is recommended:</li>\n<li><strong><em>TiKV:</em></strong> 400 MiB/s, 4000 IOPS</li>\n<li><strong><em>TiFlash:</em></strong> 625 MiB/s, 6000 IOPS</li>\n<li><strong><em>AMI type:</em></strong> <code class=\"language-text\">Amazon Linux 2</code></li>\n</ul>\n<p><strong>Create EKS Cluster:</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> eksctl.io/v1alpha5\n<span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> ClusterConfig\n<span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> tidb<span class=\"token punctuation\">-</span>eks<span class=\"token punctuation\">-</span>demo\n  <span class=\"token key atrule\">region</span><span class=\"token punctuation\">:</span> eu<span class=\"token punctuation\">-</span>west<span class=\"token punctuation\">-</span><span class=\"token number\">1</span>\n<span class=\"token key atrule\">addons</span><span class=\"token punctuation\">:</span>\n  <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> aws<span class=\"token punctuation\">-</span>ebs<span class=\"token punctuation\">-</span>csi<span class=\"token punctuation\">-</span>driver\n\n<span class=\"token key atrule\">nodeGroups</span><span class=\"token punctuation\">:</span>\n  <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> admin\n    <span class=\"token key atrule\">desiredCapacity</span><span class=\"token punctuation\">:</span> <span class=\"token number\">1</span>\n    <span class=\"token key atrule\">privateNetworking</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span>\n    <span class=\"token key atrule\">labels</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">dedicated</span><span class=\"token punctuation\">:</span> admin\n    <span class=\"token key atrule\">iam</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">withAddonPolicies</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">ebs</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span>\n  <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> tidb<span class=\"token punctuation\">-</span>1a\n    <span class=\"token key atrule\">desiredCapacity</span><span class=\"token punctuation\">:</span> <span class=\"token number\">1</span>\n    <span class=\"token key atrule\">privateNetworking</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span>\n    <span class=\"token key atrule\">availabilityZones</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"eu-west-1a\"</span><span class=\"token punctuation\">]</span>\n    <span class=\"token key atrule\">instanceType</span><span class=\"token punctuation\">:</span> c5.2xlarge\n    <span class=\"token key atrule\">labels</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">dedicated</span><span class=\"token punctuation\">:</span> tidb\n    <span class=\"token key atrule\">taints</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">dedicated</span><span class=\"token punctuation\">:</span> tidb<span class=\"token punctuation\">:</span>NoSchedule\n    <span class=\"token key atrule\">iam</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">withAddonPolicies</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">ebs</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span>\n  <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> tidb<span class=\"token punctuation\">-</span>1b\n    <span class=\"token key atrule\">desiredCapacity</span><span class=\"token punctuation\">:</span> <span class=\"token number\">0</span>\n    <span class=\"token key atrule\">privateNetworking</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span>\n    <span class=\"token key atrule\">availabilityZones</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"eu-west-1b\"</span><span class=\"token punctuation\">]</span>\n    <span class=\"token key atrule\">instanceType</span><span class=\"token punctuation\">:</span> c5.2xlarge\n    <span class=\"token key atrule\">labels</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">dedicated</span><span class=\"token punctuation\">:</span> tidb\n    <span class=\"token key atrule\">taints</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">dedicated</span><span class=\"token punctuation\">:</span> tidb<span class=\"token punctuation\">:</span>NoSchedule\n    <span class=\"token key atrule\">iam</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">withAddonPolicies</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">ebs</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span>\n  <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> tidb<span class=\"token punctuation\">-</span>1c\n    <span class=\"token key atrule\">desiredCapacity</span><span class=\"token punctuation\">:</span> <span class=\"token number\">1</span>\n    <span class=\"token key atrule\">privateNetworking</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span>\n    <span class=\"token key atrule\">availabilityZones</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"eu-west-1c\"</span><span class=\"token punctuation\">]</span>\n    <span class=\"token key atrule\">instanceType</span><span class=\"token punctuation\">:</span> c5.2xlarge\n    <span class=\"token key atrule\">labels</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">dedicated</span><span class=\"token punctuation\">:</span> tidb\n    <span class=\"token key atrule\">taints</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">dedicated</span><span class=\"token punctuation\">:</span> tidb<span class=\"token punctuation\">:</span>NoSchedule\n    <span class=\"token key atrule\">iam</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">withAddonPolicies</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">ebs</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span>\n  <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> pd<span class=\"token punctuation\">-</span>1a\n    <span class=\"token key atrule\">desiredCapacity</span><span class=\"token punctuation\">:</span> <span class=\"token number\">1</span>\n    <span class=\"token key atrule\">privateNetworking</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span>\n    <span class=\"token key atrule\">availabilityZones</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"eu-west-1a\"</span><span class=\"token punctuation\">]</span>\n    <span class=\"token key atrule\">instanceType</span><span class=\"token punctuation\">:</span> c7g.xlarge\n    <span class=\"token key atrule\">labels</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">dedicated</span><span class=\"token punctuation\">:</span> pd\n    <span class=\"token key atrule\">taints</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">dedicated</span><span class=\"token punctuation\">:</span> pd<span class=\"token punctuation\">:</span>NoSchedule\n    <span class=\"token key atrule\">iam</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">withAddonPolicies</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">ebs</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span>\n  <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> pd<span class=\"token punctuation\">-</span>1b\n    <span class=\"token key atrule\">desiredCapacity</span><span class=\"token punctuation\">:</span> <span class=\"token number\">1</span>\n    <span class=\"token key atrule\">privateNetworking</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span>\n    <span class=\"token key atrule\">availabilityZones</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"eu-west-1b\"</span><span class=\"token punctuation\">]</span>\n    <span class=\"token key atrule\">instanceType</span><span class=\"token punctuation\">:</span> c7g.xlarge\n    <span class=\"token key atrule\">labels</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">dedicated</span><span class=\"token punctuation\">:</span> pd\n    <span class=\"token key atrule\">taints</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">dedicated</span><span class=\"token punctuation\">:</span> pd<span class=\"token punctuation\">:</span>NoSchedule\n    <span class=\"token key atrule\">iam</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">withAddonPolicies</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">ebs</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span>\n  <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> pd<span class=\"token punctuation\">-</span>1c\n    <span class=\"token key atrule\">desiredCapacity</span><span class=\"token punctuation\">:</span> <span class=\"token number\">1</span>\n    <span class=\"token key atrule\">privateNetworking</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span>\n    <span class=\"token key atrule\">availabilityZones</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"eu-west-1c\"</span><span class=\"token punctuation\">]</span>\n    <span class=\"token key atrule\">instanceType</span><span class=\"token punctuation\">:</span> c7g.xlarge\n    <span class=\"token key atrule\">labels</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">dedicated</span><span class=\"token punctuation\">:</span> pd\n    <span class=\"token key atrule\">taints</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">dedicated</span><span class=\"token punctuation\">:</span> pd<span class=\"token punctuation\">:</span>NoSchedule\n    <span class=\"token key atrule\">iam</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">withAddonPolicies</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">ebs</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span>\n  <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> tikv<span class=\"token punctuation\">-</span>1a\n    <span class=\"token key atrule\">desiredCapacity</span><span class=\"token punctuation\">:</span> <span class=\"token number\">1</span>\n    <span class=\"token key atrule\">privateNetworking</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span>\n    <span class=\"token key atrule\">availabilityZones</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"eu-west-1a\"</span><span class=\"token punctuation\">]</span>\n    <span class=\"token key atrule\">instanceType</span><span class=\"token punctuation\">:</span> r5b.2xlarge\n    <span class=\"token key atrule\">labels</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">dedicated</span><span class=\"token punctuation\">:</span> tikv\n    <span class=\"token key atrule\">taints</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">dedicated</span><span class=\"token punctuation\">:</span> tikv<span class=\"token punctuation\">:</span>NoSchedule\n    <span class=\"token key atrule\">iam</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">withAddonPolicies</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">ebs</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span>\n  <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> tikv<span class=\"token punctuation\">-</span>1b\n    <span class=\"token key atrule\">desiredCapacity</span><span class=\"token punctuation\">:</span> <span class=\"token number\">1</span>\n    <span class=\"token key atrule\">privateNetworking</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span>\n    <span class=\"token key atrule\">availabilityZones</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"eu-west-1b\"</span><span class=\"token punctuation\">]</span>\n    <span class=\"token key atrule\">instanceType</span><span class=\"token punctuation\">:</span> r5b.2xlarge\n    <span class=\"token key atrule\">labels</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">dedicated</span><span class=\"token punctuation\">:</span> tikv\n    <span class=\"token key atrule\">taints</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">dedicated</span><span class=\"token punctuation\">:</span> tikv<span class=\"token punctuation\">:</span>NoSchedule\n    <span class=\"token key atrule\">iam</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">withAddonPolicies</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">ebs</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span>\n  <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> tikv<span class=\"token punctuation\">-</span>1c\n    <span class=\"token key atrule\">desiredCapacity</span><span class=\"token punctuation\">:</span> <span class=\"token number\">1</span>\n    <span class=\"token key atrule\">privateNetworking</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span>\n    <span class=\"token key atrule\">availabilityZones</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"eu-west-1c\"</span><span class=\"token punctuation\">]</span>\n    <span class=\"token key atrule\">instanceType</span><span class=\"token punctuation\">:</span> r5b.2xlarge\n    <span class=\"token key atrule\">labels</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">dedicated</span><span class=\"token punctuation\">:</span> tikv\n    <span class=\"token key atrule\">taints</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">dedicated</span><span class=\"token punctuation\">:</span> tikv<span class=\"token punctuation\">:</span>NoSchedule\n    <span class=\"token key atrule\">iam</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">withAddonPolicies</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">ebs</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span></code></pre></div>\n<p>By default, only two TiDB nodes are required, so you can set the desiredCapacity of the <code class=\"language-text\">tidb-1b</code> node group to 0. You can scale out this node group any time if necessary.</p>\n<p>Execute the following command to create the cluster:</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">$ eksctl create cluster <span class=\"token parameter variable\">-f</span> cluster.yaml</code></pre></div>\n<h3 id=\"configure-storage\" style=\"position:relative;\"><a href=\"#configure-storage\" aria-label=\"configure storage permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Configure Storage</h3>\n<p>**Deploy AWS EBS CSI Driver: **</p>\n<p>If you are using the gp3 storage type, deploy the AWS EBS Container Storage Interface (CSI) driver.</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">$ kubectl patch <span class=\"token parameter variable\">-n</span> kube-system ds ebs-csi-node <span class=\"token parameter variable\">-p</span> <span class=\"token string\">'{\"spec\":{\"template\":{\"spec\":{\"tolerations\":[{\"operator\":\"Exists\"}]}}}}'</span></code></pre></div>\n<p>Expected output:</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">$ daemonset.apps/ebs-csi-node patched</code></pre></div>\n<p><strong>Create StorageClass for gp3:</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">kind: StorageClass\napiVersion: storage.k8s.io/v1\nmetadata:\n  name: gp3\nprovisioner: ebs.csi.aws.com\nallowVolumeExpansion: <span class=\"token boolean\">true</span>\nvolumeBindingMode: WaitForFirstConsumer\nparameters:\n  type: gp3\n  fsType: ext4\n  iops: <span class=\"token string\">\"4000\"</span>\n  throughput: <span class=\"token string\">\"400\"</span>\nmountOptions:\n  - nodelalloc\n  - noatime</code></pre></div>\n<h3 id=\"deploy-tidb-operator\" style=\"position:relative;\"><a href=\"#deploy-tidb-operator\" aria-label=\"deploy tidb operator permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Deploy TiDB Operator</h3>\n<p>To deploy TiDB Operator in the EKS cluster, follow the below steps.</p>\n<p><strong>Install TiDB Operator CRDs:</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">$ kubectl create <span class=\"token parameter variable\">-f</span> https://raw.githubusercontent.com/pingcap/tidb-operator/v1.6.0/manifests/crd.yaml</code></pre></div>\n<p><strong>Install TiDB Operator:</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">$ helm repo <span class=\"token function\">add</span> pingcap https://charts.pingcap.org/ \n$ kubectl create namespace tidb-admin \n$ helm <span class=\"token function\">install</span> <span class=\"token parameter variable\">--namespace</span> tidb-admin tidb-operator pingcap/tidb-operator <span class=\"token parameter variable\">--version</span> v1.6.0</code></pre></div>\n<p><strong>Confirm TiDB Operator Components:</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">$ kubectl get pods <span class=\"token parameter variable\">--namespace</span> tidb-admin <span class=\"token parameter variable\">-l</span> app.kubernetes.io/instance<span class=\"token operator\">=</span>tidb-operator</code></pre></div>\n<h3 id=\"deploy-tidb-cluster-and-monitoring-component\" style=\"position:relative;\"><a href=\"#deploy-tidb-cluster-and-monitoring-component\" aria-label=\"deploy tidb cluster and monitoring component permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Deploy TiDB Cluster and Monitoring Component:</h3>\n<p><strong>Create Namespace:</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">$ kubectl create namespace tidb-cluster</code></pre></div>\n<p><strong>Deploy TiDB Cluster and Monitor:</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">$ <span class=\"token function\">curl</span> <span class=\"token parameter variable\">-O</span> https://raw.githubusercontent.com/pingcap/tidb-operator/v1.6.0/examples/aws/tidb-cluster.yaml\n$ <span class=\"token function\">curl</span> <span class=\"token parameter variable\">-O</span> https://raw.githubusercontent.com/pingcap/tidb-operator/v1.6.0/examples/aws/tidb-monitor.yaml\n$ <span class=\"token function\">curl</span> <span class=\"token parameter variable\">-O</span> https://raw.githubusercontent.com/pingcap/tidb-operator/v1.6.0/examples/aws/tidb-dashboard.yaml\n$ kubectl apply <span class=\"token parameter variable\">-f</span> tidb-cluster.yaml <span class=\"token parameter variable\">-n</span> tidb-cluster\n$ kubectl apply <span class=\"token parameter variable\">-f</span> tidb-monitor.yaml <span class=\"token parameter variable\">-n</span> tidb-cluster\n$ kubectl apply <span class=\"token parameter variable\">-f</span> tidb-dashboard.yaml <span class=\"token parameter variable\">-n</span> tidb-cluster</code></pre></div>\n<p><strong>View Cluster Status:</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">$ kubectl get pods <span class=\"token parameter variable\">-n</span> tidb-cluster</code></pre></div>\n<p>When all the Pods are in the Running or Ready state, the TiDB cluster is successfully started.</p>\n<p><strong>It's your turn to set up TiDB. Good luck and have fun! ðŸ˜„</strong></p>\n<h2 id=\"-closing-thoughts\" style=\"position:relative;\"><a href=\"#-closing-thoughts\" aria-label=\" closing thoughts permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>ðŸ”š Closing thoughts</h2>\n<p>TiDB offers a modern solution to the challenges of running traditional databases on Kubernetes. By being designed as a cloud-native database from the start, TiDB seamlessly integrates with Kubernetes resources, making deployment and scaling straightforward. It efficiently handles both transactional and analytical workloads, eliminating the need for separate ETL processes.</p>\n<br>\n<br>\n<blockquote>\n<p>ðŸ’¡ Thank you for Reading !! ðŸ™ŒðŸ»ðŸ˜ðŸ“ƒ, see you in the next blog.ðŸ¤˜  <em><strong>Until next time ðŸŽ‰</strong></em></p>\n</blockquote>\n<p>ðŸš€ Thank you for sticking up till the end. If you have any questions/feedback regarding this blog feel free to connect with me:</p>\n<p><strong>â™»ï¸ LinkedIn:</strong> <a href=\"https://www.linkedin.com/in/rajhi-saif/\" target=\"_blank\" rel=\"noopener noreferrer\">https://www.linkedin.com/in/rajhi-saif/</a></p>\n<p><strong>â™»ï¸ X/Twitter:</strong> <a href=\"https://x.com/rajhisaifeddine\" target=\"_blank\" rel=\"noopener noreferrer\">https://x.com/rajhisaifeddine</a></p>\n<p><strong>The end âœŒðŸ»</strong></p>\n<p><em><strong>Keep Learning !! Keep Sharing !! ðŸ”°</strong></em></p>\n<p><strong>ðŸ“»ðŸ§¡ References:</strong></p>\n<ul>\n<li><a href=\"https://docs.pingcap.com/tidb/stable\" target=\"_blank\" rel=\"noopener noreferrer\">https://docs.pingcap.com/tidb/stable</a></li>\n<li><a href=\"https://docs.pingcap.com/tidb-in-kubernetes/stable/deploy-on-aws-eks\" target=\"_blank\" rel=\"noopener noreferrer\">https://docs.pingcap.com/tidb-in-kubernetes/stable/deploy-on-aws-eks</a></li>\n<li><a href=\"https://docs.pingcap.com/tidb/stable/tidb-in-kubernetes\" target=\"_blank\" rel=\"noopener noreferrer\">https://docs.pingcap.com/tidb/stable/tidb-in-kubernetes</a></li>\n<li><a href=\"https://github.com/pingcap/tidb-operator\" target=\"_blank\" rel=\"noopener noreferrer\">https://github.com/pingcap/tidb-operator</a></li>\n<li>\n<iframe width=\"100%\" height=\"315\" src=\"https://www.youtube-nocookie.com/embed/FqMcwv_FL7Q?rel=0\" frameborder=\"0\" allow=\"accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture\" allowfullscreen></iframe>\n</li>\n<li><a href=\"https://surrealdb.com/docs/surrealdb/deployment/amazon\" target=\"_blank\" rel=\"noopener noreferrer\">https://surrealdb.com/docs/surrealdb/deployment/amazon</a></li>\n</ul>\n<p><strong>ðŸ“… Stay updated</strong></p>\n<p>Subscribe to our newsletter for more insights on AWS cloud coomputing and containers.</p>"},"nextThought":{"frontmatter":{"path":"/blog/communicate-through-code/","title":"Communicate Through Code","date":"2024-08-30 13:06:00"},"excerpt":"I had been a technical lead for more than 3 years. One of my responsibilities was to make sure that my teams produced quality eCommerceâ€¦","html":"<p>I had been a technical lead for more than 3 years. One of my responsibilities was to make sure that my teams produced quality eCommerce solutions. During code reviews, I frequently saw one particular problem which did a great job at <strong>killing software maintainability</strong>. This problem is better known by the people management area, but, believe me, it's vitally important for software development as well. The problem is called <strong>\"poorly communicated intent\"</strong>.</p>\n<h2 id=\"code-lifecycle\" style=\"position:relative;\"><a href=\"#code-lifecycle\" aria-label=\"code lifecycle permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Code Lifecycle</h2>\n<p>When you write code, there is a problem you want to solve. So you do research and brainstorm possible approaches. You evaluate them and stick to one solution that you finally implement.</p>\n<p>This is actually where the hardest part starts.</p>\n<p>Your solution becomes <strong>a part of a bigger codebase</strong>. A whole team of several people may maintain it. They will read your code, analyze it and <strong>build on top of it</strong>. They may also <strong>evolve that piece of code</strong> to keep up with <strong>ever-changing requirements</strong>.</p>\n<p>At the same time, it's <strong>unlikely</strong> you are around all the time to ask you about your code. You may switch the team or change the company you work at. Perhaps, new members may join your team and they have not heard your cool story on why you had to solve that problem the way you had done.</p>\n<p>\n\t\t<video\n\t\t\tsrc=https://media.giphy.com/media/F7yLXA5fJ5sLC/giphy.mp4\n\t\t\twidth=\"100%\"\n\t\t\theight=\"auto\"\n\t\t\tpreload=\"auto\"\n\t\t\tmuted=\"true\"\n\t\t\ttitle=\"Be ready to support your code\"\n\t\t\tautoplay\n\t\t\tplaysinline\n\t\t\tcontrols\n\t\t\tloop\n\t\t></video>\n\t</p>\n<p>Being always around is a synchronous communication and it <strong>doesn't scale</strong> well.</p>\n<p>In the worse case, when the code owner is not available, you can still review all places that consume the code and make sure your changes will not break them. This rather tedious process significantly slows down the progress of the application development and frequently slips your deadlines.</p>\n<p>When you adjust code that you don't understand completely, there is a constant fear that there is a subtle use case which you may miss and which eventually will break. Those situations turn codebase maintenance and evolution into a desperately painful task.</p>\n<p>Poorly written code is extremely contingent and over time there will be even more code like that. One day technical debt will make you hate every Monday when you have to return to work.</p>\n<p>This is not a way to go.</p>\n<h2 id=\"intention-in-code\" style=\"position:relative;\"><a href=\"#intention-in-code\" aria-label=\"intention in code permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Intention in Code</h2>\n<p>The root of the problem is that people don't always realize that they actually <strong>communicate their intent when they do coding</strong>. Think for a moment. It's called \"programing language\", hence, it must have something <strong>in common with natural languages</strong>. Just like natural languages are useful for communicating your ideas, programing languages inherit pretty much the same idea, but <strong>language expressions</strong> are slightly different. If so, then each expression exists to convey some information, meaning and intention.</p>\n<p>Problems start when you try to <strong>misuse</strong> those expressions. This leads to implementations that are hard to read, understand, maintain and change.</p>\n<h2 id=\"complexity\" style=\"position:relative;\"><a href=\"#complexity\" aria-label=\"complexity permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Complexity</h2>\n<p>This is how we can get <strong>a complex solution</strong>, but why it's actually complex?</p>\n<p>Primarily, there are two sources of complexity:</p>\n<ul>\n<li><strong>domain complexity</strong> - implementation is complex because the problem it solves is complex (e.g. plane's runway scheduling)</li>\n<li><strong>accidental complexity</strong> - implementation could be simpler but we have implemented it in an unmaintainable way</li>\n</ul>\n<p>Domain complexity is something we can't do much about. We just need to deal with it and there are a few approaches like <a href=\"https://www.amazon.com/Domain-Driven-Design-Tackling-Complexity-Software/dp/0321125215\" target=\"_blank\" rel=\"noopener noreferrer\">domain-driven design</a>.</p>\n<p>At the same time, accidental complexity is something we <strong>can and should avoid</strong>. Let's take a look at the following real-world example:</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\">\n<span class=\"token comment\"># bad code below, don't copy-paste it</span>\n\n<span class=\"token keyword\">def</span> <span class=\"token function\">remove_duplicates</span><span class=\"token punctuation\">(</span>clean_tokens<span class=\"token punctuation\">:</span> <span class=\"token builtin\">list</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    clean_dict <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">for</span> tok <span class=\"token keyword\">in</span> clean_tokens<span class=\"token punctuation\">:</span>\n        <span class=\"token keyword\">if</span> tok<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>isalnum<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n            <span class=\"token keyword\">if</span> tok<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span> <span class=\"token keyword\">in</span> clean_dict<span class=\"token punctuation\">:</span>\n                clean_dict<span class=\"token punctuation\">[</span>tok<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">+=</span> tok<span class=\"token punctuation\">[</span><span class=\"token number\">2</span><span class=\"token punctuation\">]</span>\n            <span class=\"token keyword\">else</span><span class=\"token punctuation\">:</span>\n                clean_dict<span class=\"token punctuation\">[</span>tok<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> tok<span class=\"token punctuation\">[</span><span class=\"token number\">2</span><span class=\"token punctuation\">]</span>\n\n    result <span class=\"token operator\">=</span> <span class=\"token builtin\">list</span><span class=\"token punctuation\">(</span><span class=\"token builtin\">map</span><span class=\"token punctuation\">(</span><span class=\"token builtin\">list</span><span class=\"token punctuation\">,</span> clean_dict<span class=\"token punctuation\">.</span>items<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\n    <span class=\"token keyword\">return</span> result</code></pre></div>\n<p>Try to read this function a few times. What are your impressions?</p>\n<ul>\n<li>the function is called <code class=\"language-text\">remove_duplicates()</code> but it seems to omit only non-alpha-numerical values, not duplicated values</li>\n<li>what values are inside <code class=\"language-text\">tok[0]</code> and <code class=\"language-text\">tok[2]</code> items? How many items are there in each <code class=\"language-text\">tok</code> array?</li>\n<li>what's the meaning of <code class=\"language-text\">tok[2]</code> sum for each <code class=\"language-text\">tok[0]</code>?</li>\n</ul>\n<p>I can say without doubts that this piece of code is complex and it's hard to understand. However, this piece is not about launching a SpaceX shuttle (hopefully). It does something very simple, but what exactly it does was highly obscured by a poor choice of language expressions. This is what <strong>accidental complexity</strong> really means.</p>\n<h2 id=\"communication-tools\" style=\"position:relative;\"><a href=\"#communication-tools\" aria-label=\"communication tools permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Communication Tools</h2>\n<p>I hope that at this point you are already eager to know how to improve your \"communicate through code\" skills.</p>\n<p>There are two main ways to communicate your intent better:</p>\n<ul>\n<li>via programing language expressions and idioms</li>\n<li>via comments</li>\n</ul>\n<p>Each of them deserves a detailed view, so let's dive into it.</p>\n<h2 id=\"language-expressions\" style=\"position:relative;\"><a href=\"#language-expressions\" aria-label=\"language expressions permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Language Expressions</h2>\n<h3 id=\"python-vs-php\" style=\"position:relative;\"><a href=\"#python-vs-php\" aria-label=\"python vs php permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Python vs PHP</h3>\n<p>Surprisingly, let's talk about PHP for a second.</p>\n<p>I started delving into Python after I had spent quite a few years dealing with PHP.\nAfter looking at Python, my first question was: \"Why does Python have so many data structures?\". There are lists, tuples, sets, frozen sets, dicts and this are just a few to name.</p>\n<p>In the PHP world, there are arrays and associative arrays (counterparts of Python's lists and dicts). That's it. Interestingly, there are PHP's <a href=\"https://www.php.net/manual/en/book.spl.php\" target=\"_blank\" rel=\"noopener noreferrer\">SPL</a> and <a href=\"https://www.php.net/manual/en/book.ds.php\" target=\"_blank\" rel=\"noopener noreferrer\">Data Structures</a>, but, to be honest, I have hardly ever seen them in use in the wild.</p>\n<p>So I was really curious. The understanding has come to me later.</p>\n<p>It's all about communication of your intent. Python provides many more expressions, built-in functions and approaches that should be used in specific cases to <strong>offload meaning</strong> that each of them should deliver. Conversely, in PHP people often get arrays <strong>overloaded</strong> in terms of the meaning arrays should convey which makes code harder to grasp.</p>\n<p>Let's review a few examples.</p>\n<h3 id=\"types-and-collections\" style=\"position:relative;\"><a href=\"#types-and-collections\" aria-label=\"types and collections permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Types and Collections</h3>\n<p>Python has many data types and a good part of them are covered by syntax sugar to make them easier to use. Remaining data types can be found in the <code class=\"language-text\">collections</code> package.</p>\n<h4 id=\"mutable-and-unmutable\" style=\"position:relative;\"><a href=\"#mutable-and-unmutable\" aria-label=\"mutable and unmutable permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Mutable and Unmutable</h4>\n<p><strong>Lists</strong> and <strong>sets</strong> are among the basic data structures that are built-in into Python's syntax.</p>\n<p>Lists are <strong>mutable</strong> containers for items. Their items should not be necessarily the same type. Lists may contain duplicates. It's rare to see someone accesses items from the middle of the list. Sets are <strong>mutable</strong> containers with no <strong>duplicates</strong> or <strong>a specific order</strong>.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\">langs<span class=\"token punctuation\">:</span> <span class=\"token builtin\">list</span><span class=\"token punctuation\">[</span><span class=\"token builtin\">str</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span>\n    <span class=\"token string\">\"Python\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">\"Golang\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">\"PHP\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">\"R\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">\"Julia\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">\"JavaScript\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">\"Python\"</span>\n<span class=\"token punctuation\">]</span>\n\n<span class=\"token keyword\">for</span> lang <span class=\"token keyword\">in</span> langs<span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>lang<span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\"># Outputs:</span>\n<span class=\"token comment\"># Python</span>\n<span class=\"token comment\"># Golang</span>\n<span class=\"token comment\"># PHP</span>\n<span class=\"token comment\"># R</span>\n<span class=\"token comment\"># ...</span>\n<span class=\"token comment\"># Python</span></code></pre></div>\n<p>Lists and sets have their <strong>immutable</strong> counterparts which are <strong>tuples</strong> and <strong>frozen sets</strong>. Tuples and frozen sets cannot be modified after creation. They can be used to say that it doesn't make sense to change them because they represent constants or some well-defined structure where each item has a special meaning like a database row.</p>\n<p>Python goes even further and lets you name each item in the tuples via the <code class=\"language-text\">NamedTuple</code> class:</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">from</span> typing <span class=\"token keyword\">import</span> NamedTuple\n\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">Student</span><span class=\"token punctuation\">(</span>NamedTuple<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    name<span class=\"token punctuation\">:</span> <span class=\"token builtin\">str</span>\n    score<span class=\"token punctuation\">:</span> <span class=\"token builtin\">float</span>\n\n\nstudent <span class=\"token operator\">=</span> Student<span class=\"token punctuation\">(</span><span class=\"token string\">\"Roma\"</span><span class=\"token punctuation\">,</span> <span class=\"token number\">10.4</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>student<span class=\"token punctuation\">.</span>score<span class=\"token punctuation\">)</span>\n<span class=\"token comment\"># 10.4</span>\n\n<span class=\"token comment\"># equivalent to:</span>\n<span class=\"token comment\"># print(student[1])</span>\n<span class=\"token comment\"># but a way more readable</span></code></pre></div>\n<h4 id=\"dicts\" style=\"position:relative;\"><a href=\"#dicts\" aria-label=\"dicts permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Dicts</h4>\n<p>Dicts are the members of the royal family in Python. The whole Python language is based on them. Essentially, <strong>dicts</strong> are <strong>mutable</strong> mappings of <strong>unique keys</strong> to corresponding values. Dicts are typically iterated over or accesses by keys:</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\">lang_mascots<span class=\"token punctuation\">:</span> <span class=\"token builtin\">dict</span><span class=\"token punctuation\">[</span><span class=\"token builtin\">str</span><span class=\"token punctuation\">,</span> <span class=\"token builtin\">str</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token string\">\"python\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"ðŸ\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">\"rust\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"ðŸ¦€\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">\"golang\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"ðŸ¹\"</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>lang_mascots<span class=\"token punctuation\">[</span><span class=\"token string\">\"python\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n<span class=\"token comment\"># ðŸ</span>\n\n<span class=\"token keyword\">for</span> lang<span class=\"token punctuation\">,</span> mascot <span class=\"token keyword\">in</span> lang_mascots<span class=\"token punctuation\">.</span>items<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string-interpolation\"><span class=\"token string\">f\"</span><span class=\"token interpolation\"><span class=\"token punctuation\">{</span>lang<span class=\"token punctuation\">}</span></span><span class=\"token string\"> -> </span><span class=\"token interpolation\"><span class=\"token punctuation\">{</span>mascot<span class=\"token punctuation\">}</span></span><span class=\"token string\">\"</span></span><span class=\"token punctuation\">)</span>\n<span class=\"token comment\"># python -> ðŸ</span>\n<span class=\"token comment\"># rust -> ðŸ¦€</span>\n<span class=\"token comment\"># golang -> ðŸ¹</span></code></pre></div>\n<p>Even though dicts have <a href=\"https://stackoverflow.com/questions/39980323/are-dictionaries-ordered-in-python-3-6\" target=\"_blank\" rel=\"noopener noreferrer\">become ordered recently (remembers order of adding keys)</a>, you may still want to consider them unordered and use a whole another <code class=\"language-text\">OrderedDict</code> class as a means of emphasizing that you need key ordering.</p>\n<p>You can be even more specific if your values are the same type. The <code class=\"language-text\">defaultdict</code> class will help you to automatically init all non-existing keys:</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">from</span> collections <span class=\"token keyword\">import</span> defaultdict\n\n\nPokemonList <span class=\"token operator\">=</span> <span class=\"token builtin\">list</span><span class=\"token punctuation\">[</span><span class=\"token builtin\">str</span><span class=\"token punctuation\">]</span>\n\npokemons_by_owner<span class=\"token punctuation\">:</span> <span class=\"token builtin\">dict</span><span class=\"token punctuation\">[</span><span class=\"token builtin\">str</span><span class=\"token punctuation\">,</span> PokemonList<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\npokemons_by_owner_safe<span class=\"token punctuation\">:</span> <span class=\"token builtin\">dict</span><span class=\"token punctuation\">[</span><span class=\"token builtin\">str</span><span class=\"token punctuation\">,</span> PokemonList<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> defaultdict<span class=\"token punctuation\">(</span><span class=\"token builtin\">list</span><span class=\"token punctuation\">)</span>  <span class=\"token comment\"># list is a factory of empty values</span>\n\npokemons_by_owner<span class=\"token punctuation\">[</span><span class=\"token string\">\"Ash\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>append<span class=\"token punctuation\">(</span><span class=\"token string\">\"Pikachu\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token comment\"># KeyError :(</span>\n\npokemons_by_owner_safe<span class=\"token punctuation\">.</span>append<span class=\"token punctuation\">(</span><span class=\"token string\">\"Pikachu\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token comment\"># all good, one more pokemon has been added</span></code></pre></div>\n<h4 id=\"counters\" style=\"position:relative;\"><a href=\"#counters\" aria-label=\"counters permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Counters</h4>\n<p>Often we need to count how many times each item occurs in the list or dict or to sum up items' weights. I'm sure we could do that via dicts, but Python has a better way to achieve that via the Counter class:</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">from</span> collections <span class=\"token keyword\">import</span> Counter\n\n\nlangs<span class=\"token punctuation\">:</span> <span class=\"token builtin\">list</span><span class=\"token punctuation\">[</span><span class=\"token builtin\">str</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span>\n    <span class=\"token string\">\"Python\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">\"Golang\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">\"PHP\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">\"Python\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">\"Golang\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">\"PHP\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">\"Python\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">\"Fortran\"</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">]</span>\n\nlang_popularity<span class=\"token punctuation\">:</span> Counter <span class=\"token operator\">=</span> Counter<span class=\"token punctuation\">(</span>langs<span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>lang_popularity<span class=\"token punctuation\">.</span>most_common<span class=\"token punctuation\">(</span><span class=\"token number\">3</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n<span class=\"token comment\"># [('Python', 2), ('Golang', 2), ('PHP', 2)]</span></code></pre></div>\n<p>Now let's compare this implementation with a dict-based:</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">from</span> collections <span class=\"token keyword\">import</span> defaultdict\n<span class=\"token keyword\">from</span> typing <span class=\"token keyword\">import</span> Dict<span class=\"token punctuation\">,</span> List\n\n\nlangs<span class=\"token punctuation\">:</span> <span class=\"token builtin\">list</span><span class=\"token punctuation\">[</span><span class=\"token builtin\">str</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span>\n    <span class=\"token string\">\"Python\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">\"Golang\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">\"PHP\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">\"Python\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">\"Golang\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">\"PHP\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">\"Python\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">\"Fortran\"</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">]</span>\n\ncounter<span class=\"token punctuation\">:</span> <span class=\"token builtin\">dict</span><span class=\"token punctuation\">[</span><span class=\"token builtin\">str</span><span class=\"token punctuation\">,</span> <span class=\"token builtin\">int</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> defaultdict<span class=\"token punctuation\">(</span><span class=\"token builtin\">int</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">for</span> lang <span class=\"token keyword\">in</span> langs<span class=\"token punctuation\">:</span>\n    counter<span class=\"token punctuation\">[</span>lang<span class=\"token punctuation\">]</span> <span class=\"token operator\">+=</span> <span class=\"token number\">1</span>\n\nmost_common <span class=\"token operator\">=</span> <span class=\"token builtin\">sorted</span><span class=\"token punctuation\">(</span>counter<span class=\"token punctuation\">.</span>items<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> key<span class=\"token operator\">=</span><span class=\"token keyword\">lambda</span> item<span class=\"token punctuation\">:</span> item<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> reverse<span class=\"token operator\">=</span><span class=\"token boolean\">True</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>most_common<span class=\"token punctuation\">[</span><span class=\"token punctuation\">:</span><span class=\"token number\">3</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n<span class=\"token comment\"># [('Python', 2), ('Golang', 2), ('PHP', 2)]</span></code></pre></div>\n<p>As we can see, the dict-based implementation has much more cognitive burden and it's harder and longer to realize that we were just looking for the three most popular languages.</p>\n<h3 id=\"looping\" style=\"position:relative;\"><a href=\"#looping\" aria-label=\"looping permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Looping</h3>\n<p>Data structures are not the only way to express your intention in code. Loops are good examples of another abstraction that is commonly used and sometimes misused.</p>\n<h4 id=\"for-and-while-loops\" style=\"position:relative;\"><a href=\"#for-and-while-loops\" aria-label=\"for and while loops permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>For and While loops</h4>\n<p>The for loop is the most frequently used loop in Python. It helps to iterate through the collection or its range and perform some actions on each item.</p>\n<p>The while loop is used less frequently and it's aimed to iterate until some condition holds true and we usually don't know the exact number of iterations to take.</p>\n<p>Consequently, we can explain why using the while loop for iterating through a collection bloats our cognitive burden:</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\">\n<span class=\"token comment\"># bad code below, don't copy-paste it</span>\n\npets<span class=\"token punctuation\">:</span> <span class=\"token builtin\">list</span><span class=\"token punctuation\">[</span><span class=\"token builtin\">str</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"dog\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"cat\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"parrot\"</span><span class=\"token punctuation\">]</span>\ni<span class=\"token punctuation\">:</span> <span class=\"token builtin\">int</span>  <span class=\"token operator\">=</span> <span class=\"token number\">0</span>\n\n<span class=\"token keyword\">while</span> i <span class=\"token operator\">&lt;</span> <span class=\"token builtin\">len</span><span class=\"token punctuation\">(</span>pets<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>pets<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n    i <span class=\"token operator\">+=</span> <span class=\"token number\">1</span></code></pre></div>\n<p>In such cases, we need to pay attention to the condition and analyze how it changes with every iteration. This is a lot to think about when we just want to check every item in collections. The \"for\" loop hides this complexity and focuses us on the item processing part:</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\">pets<span class=\"token punctuation\">:</span> <span class=\"token builtin\">list</span><span class=\"token punctuation\">[</span><span class=\"token builtin\">str</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"dog\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"cat\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"parrot\"</span><span class=\"token punctuation\">]</span>\n\n<span class=\"token keyword\">for</span> pet <span class=\"token keyword\">in</span> pets<span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>pet<span class=\"token punctuation\">)</span></code></pre></div>\n<h4 id=\"comprehensions\" style=\"position:relative;\"><a href=\"#comprehensions\" aria-label=\"comprehensions permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Comprehensions</h4>\n<p>Often we need to keep data from collection <strong>unmodified</strong>, but just to change its output format. For example, we may have a plain list of JSON strings and we need to convert them to the list of dicts. In such cases, there are no side effects to the data itself, we just convert <strong>one collection into another</strong>. Python has brilliant constructions called list/dict/set comprehensions that are designed to be helpful here:</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\">raw_orders<span class=\"token punctuation\">:</span> <span class=\"token builtin\">list</span><span class=\"token punctuation\">[</span><span class=\"token builtin\">str</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"{...}\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"{...}\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"{...}\"</span><span class=\"token punctuation\">]</span>  <span class=\"token comment\"># each item is a JSON string that contains order information</span>\n\norders<span class=\"token punctuation\">:</span> <span class=\"token builtin\">list</span><span class=\"token punctuation\">[</span>Order<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span>Order<span class=\"token punctuation\">(</span>raw_order_info<span class=\"token punctuation\">)</span> <span class=\"token keyword\">for</span> raw_order_info <span class=\"token keyword\">in</span> raw_orders<span class=\"token punctuation\">]</span></code></pre></div>\n<p>However, if there is a need for side effects during enumeration, it's recommended to fallback into good old loops.</p>\n<h3 id=\"exceptions-and-assertions\" style=\"position:relative;\"><a href=\"#exceptions-and-assertions\" aria-label=\"exceptions and assertions permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Exceptions and Assertions</h3>\n<p>Exceptions have a special place in Python. They are used to control code flows and to implement <a href=\"https://devblogs.microsoft.com/python/idiomatic-python-eafp-versus-lbyl/\" target=\"_blank\" rel=\"noopener noreferrer\">the EAFP pattern</a> (which stands for \"itâ€™s easier to ask for forgiveness than permission\"). Python code developers spent some time optimizing performance of exception raising. In fact, they are now even using exceptions internally to handle things like <a href=\"https://peps.python.org/pep-0234/\" target=\"_blank\" rel=\"noopener noreferrer\">ending the iteration process by raising the StopIteration exception</a>.</p>\n<p>In our case, we can use exceptions in the following way:</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">from</span> os <span class=\"token keyword\">import</span> PathLike\n\n<span class=\"token keyword\">import</span> yaml\n\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">InvalidConfigFormat</span><span class=\"token punctuation\">(</span>RuntimeError<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>  <span class=\"token comment\"># a custom exception</span>\n    <span class=\"token triple-quoted-string string\">\"\"\"\n    Occurs when config file is not in the valid YAML format\n    \"\"\"</span>\n\n\n<span class=\"token keyword\">def</span> <span class=\"token function\">get_config</span><span class=\"token punctuation\">(</span>config_path<span class=\"token punctuation\">:</span> PathLike<span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span><span class=\"token operator\">></span> <span class=\"token builtin\">dict</span><span class=\"token punctuation\">[</span><span class=\"token builtin\">str</span><span class=\"token punctuation\">,</span> <span class=\"token builtin\">str</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">:</span>\n    <span class=\"token triple-quoted-string string\">\"\"\"\n    Loads the application configurations\n    \"\"\"</span>\n    <span class=\"token keyword\">try</span><span class=\"token punctuation\">:</span>\n        <span class=\"token keyword\">return</span> yaml<span class=\"token punctuation\">.</span>safe_load<span class=\"token punctuation\">(</span><span class=\"token builtin\">open</span><span class=\"token punctuation\">(</span>config_path<span class=\"token punctuation\">,</span> <span class=\"token string\">\"r\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">except</span> FileNotFoundError<span class=\"token punctuation\">:</span>\n        yaml<span class=\"token punctuation\">.</span>safe_dump<span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token builtin\">open</span><span class=\"token punctuation\">(</span>config_path<span class=\"token punctuation\">,</span> <span class=\"token string\">\"w\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">except</span> yaml<span class=\"token punctuation\">.</span>YAMLError <span class=\"token keyword\">as</span> e<span class=\"token punctuation\">:</span>\n        <span class=\"token keyword\">raise</span> InvalidConfigFormat<span class=\"token punctuation\">(</span>\n            <span class=\"token string-interpolation\"><span class=\"token string\">f\"Oh no, </span><span class=\"token interpolation\"><span class=\"token punctuation\">{</span>config_path<span class=\"token conversion-option punctuation\">!r</span><span class=\"token punctuation\">}</span></span><span class=\"token string\"> doesn't seem to be a valid config file: </span><span class=\"token interpolation\"><span class=\"token punctuation\">{</span>e<span class=\"token conversion-option punctuation\">!r</span><span class=\"token punctuation\">}</span></span><span class=\"token string\">\"</span></span>\n            <span class=\"token string\">\"Please, double check the file content\"</span>\n        <span class=\"token punctuation\">)</span> <span class=\"token keyword\">from</span> e\n</code></pre></div>\n<p>Pay attention to how exceptions helped us to separate different scenarios in the get_config() function:</p>\n<ul>\n<li>the main \"success path\" case (between try and the first except statements)</li>\n<li>the no config file case (the content of the FileNotFoundError handler)</li>\n<li>the wrong config format case (the YAMLError handler)</li>\n</ul>\n<p>That separation improves the readability of the code compared to retrieving some flags or status codes like in the Linux system programing.</p>\n<p>With heavy use of exceptions, it becomes important to create a custom one, so it's going to be easier to perform the granular error handling. The snippet above introduces a new InvalidConfigFormat exception that they can be caught by consumer code. It's also a common practice to reraise a custom exception that makes more sense for the concrete application and then connects it with the initial exception via the <a href=\"https://docs.python.org/3/tutorial/errors.html#exception-chaining\" target=\"_blank\" rel=\"noopener noreferrer\">raise from</a> expression.</p>\n<p>Another useful case to know is how to ignore some specific exceptions if you are okay that they can happen:</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">from</span> contextlib <span class=\"token keyword\">import</span> suppress\n\n\n<span class=\"token keyword\">with</span> suppress<span class=\"token punctuation\">(</span>ImportError<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token comment\"># I'm fine with no pandas installed in the project</span>\n    <span class=\"token keyword\">import</span> pandas</code></pre></div>\n<p>It's also useful to know about <code class=\"language-text\">assert</code> and <code class=\"language-text\">AssertionError</code>s. Usually, you will see assert expression is being used in tests, but that's not the only use. <code class=\"language-text\">assert</code>'s may be also used to <a href=\"https://realpython.com/python-assert-statement/\" target=\"_blank\" rel=\"noopener noreferrer\">dump some assumptions about the code that has to be true</a> in the 95% of the cases but which may still be violated accidentally during the refactoring or other code adjustments. So having such sanity checks could reduce the ripple effect of the error and help to find the cause quicker:</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">def</span> <span class=\"token function\">get_discount</span><span class=\"token punctuation\">(</span>price<span class=\"token punctuation\">:</span> <span class=\"token builtin\">float</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span><span class=\"token operator\">></span> <span class=\"token builtin\">float</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">assert</span> price <span class=\"token operator\">></span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token string-interpolation\"><span class=\"token string\">f\"Price cannot be less than zero (</span><span class=\"token interpolation\"><span class=\"token punctuation\">{</span>price<span class=\"token punctuation\">}</span></span><span class=\"token string\"> was given)\"</span></span>\n\n    <span class=\"token keyword\">return</span> price <span class=\"token operator\">*</span> <span class=\"token number\">0.005</span></code></pre></div>\n<p>In order to let <code class=\"language-text\">assert</code>'s work, you should not catch any <code class=\"language-text\">AssertionError</code> and let them fail as soon as possible in your development flow.</p>\n<h3 id=\"decorators\" style=\"position:relative;\"><a href=\"#decorators\" aria-label=\"decorators permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Decorators</h3>\n<p>Most likely you have heard about the decorator design pattern that is a part of <a href=\"https://en.wikipedia.org/wiki/Design_Patterns\" target=\"_blank\" rel=\"noopener noreferrer\">the GoF's design patterns</a>. The pattern is all about wrapping a function or a method into a code that will be running before or after the original one, or even replacing the original code under needed conditions. It's a transparent way to extend the code without modifying it.</p>\n<p>Python took this idea to the next level. It has <a href=\"https://peps.python.org/pep-0318/\" target=\"_blank\" rel=\"noopener noreferrer\">a dedicated syntax to register decorators</a> in a declarative way:</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">import</span> functools\n<span class=\"token keyword\">from</span> collections <span class=\"token keyword\">import</span> Callable\n<span class=\"token keyword\">from</span> typing <span class=\"token keyword\">import</span> TypeVar<span class=\"token punctuation\">,</span> cast<span class=\"token punctuation\">,</span> Any\n\n\ntasks<span class=\"token punctuation\">:</span> <span class=\"token builtin\">dict</span><span class=\"token punctuation\">[</span><span class=\"token builtin\">str</span><span class=\"token punctuation\">,</span> Callable<span class=\"token punctuation\">[</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">,</span> Any<span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n\nT <span class=\"token operator\">=</span> TypeVar<span class=\"token punctuation\">(</span><span class=\"token string\">\"T\"</span><span class=\"token punctuation\">,</span> bound<span class=\"token operator\">=</span>Callable<span class=\"token punctuation\">[</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">,</span> Any<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">def</span> <span class=\"token function\">register_task</span><span class=\"token punctuation\">(</span>func<span class=\"token punctuation\">:</span> T<span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span><span class=\"token operator\">></span> T<span class=\"token punctuation\">:</span>\n    <span class=\"token triple-quoted-string string\">\"\"\"\n    Registers a task function into the task registry\n    \"\"\"</span>\n    tasks<span class=\"token punctuation\">[</span>func<span class=\"token punctuation\">.</span>__name__<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> func\n\n    <span class=\"token decorator annotation punctuation\">@functools<span class=\"token punctuation\">.</span>wraps</span><span class=\"token punctuation\">(</span>func<span class=\"token punctuation\">)</span>  <span class=\"token comment\"># BTW this is a built-in decorator</span>\n    <span class=\"token keyword\">def</span> <span class=\"token function\">wrapper</span><span class=\"token punctuation\">(</span><span class=\"token operator\">*</span>args<span class=\"token punctuation\">,</span> <span class=\"token operator\">**</span>kwargs<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        <span class=\"token comment\"># modify behavior of the original function</span>\n        <span class=\"token keyword\">return</span> func<span class=\"token punctuation\">(</span><span class=\"token operator\">*</span>args<span class=\"token punctuation\">,</span> <span class=\"token operator\">**</span>kwargs<span class=\"token punctuation\">,</span> decorated<span class=\"token operator\">=</span><span class=\"token boolean\">True</span><span class=\"token punctuation\">)</span>\n\n    <span class=\"token keyword\">return</span> cast<span class=\"token punctuation\">(</span>T<span class=\"token punctuation\">,</span> wrapper<span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\"># Usage of the decorator</span>\n\n<span class=\"token decorator annotation punctuation\">@register_task</span>\n<span class=\"token keyword\">def</span> <span class=\"token function\">sample_task</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Sample task has been executed\"</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>To give you a better idea of how decorators are used in the wild, let's go through just a few very common problems that can be solved with decorators:</p>\n<ul>\n<li>register a new item in some registry. Let's say, you want to give an elegant way to extend a list webapp routes that you don't know beforehand. The example above illustrates the \"register\" pattern you can use to achieve that. Many Python web frameworks use decorators for that purpose like <a href=\"https://flask.palletsprojects.com/en/1.0.x/tutorial/layout/\" target=\"_blank\" rel=\"noopener noreferrer\">Flask</a>, <a href=\"https://bottlepy.org/docs/dev/\" target=\"_blank\" rel=\"noopener noreferrer\">Bottle</a>, <a href=\"https://fastapi.tiangolo.com/tutorial/first-steps/\" target=\"_blank\" rel=\"noopener noreferrer\">FastAPI</a> and others. Another example is <a href=\"https://python-socketio.readthedocs.io/en/latest/intro.html#client-examples\" target=\"_blank\" rel=\"noopener noreferrer\">Python's Socket.io client</a> which uses decorators to register handlers to some events. Yet another example is <a href=\"https://docs.celeryq.dev/en/stable/getting-started/first-steps-with-celery.html#application\" target=\"_blank\" rel=\"noopener noreferrer\">Celery</a> which uses decorators to register their tasks.</li>\n<li>do caching of some function results without modifying the function code. The built-in <code class=\"language-text\">functools</code> package contains <code class=\"language-text\">lru_cache</code> decorator that can be used to cache the output of any function.</li>\n<li>add some markers to the function for the following processing. Tensorflow, for example, has a <a href=\"https://github.com/tensorflow/tensorflow/blob/299cb76dd913e7bb0349a13c1165459dac4ea81e/tensorflow/tools/docs/doc_controls.py#L46\" target=\"_blank\" rel=\"noopener noreferrer\"><code class=\"language-text\">do_not_generate_docs()</code></a> decorator that marks functions that should not be exposed in its documentation.</li>\n<li>mark route as one that requires authorization. <a href=\"https://docs.djangoproject.com/en/4.0/ref/contrib/admin/#the-staff-member-required-decorator\" target=\"_blank\" rel=\"noopener noreferrer\">Django</a> and many Flask extensions use decorators to mark webapp routes as ones that require authorization.</li>\n<li>parametrize a test function. <a href=\"https://docs.pytest.org/en/6.2.x/example/parametrize.html\" target=\"_blank\" rel=\"noopener noreferrer\">Pytest</a> uses decorators heavily and one of the use cases is to pass a few test cases to the same test function.</li>\n<li>MANY more...</li>\n</ul>\n<h3 id=\"context-managers\" style=\"position:relative;\"><a href=\"#context-managers\" aria-label=\"context managers permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Context Managers</h3>\n<p>Finally, let's review another case where Python has a concise solution.</p>\n<p>You have probably noticed that quite a few components in programming require us to do three steps:</p>\n<ul>\n<li>initialization (beginning of a context)</li>\n<li>the actual business logic</li>\n<li>clean up (end of the context)</li>\n</ul>\n<p>You can think about working with database, acquiring locks, working with files, mocking something in tests and so on.\nThose initialization and cleanup stages create some kind of context where you can perform some business logic.</p>\n<p>This pattern is so common that Python has got separate support on the language level to write those things in a readable way. It's called context manager. Here is an example:</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">from</span> contextlib <span class=\"token keyword\">import</span> contextmanager\n<span class=\"token keyword\">import</span> time\n\n\n<span class=\"token decorator annotation punctuation\">@contextmanager</span>\n<span class=\"token keyword\">def</span> <span class=\"token function\">timer</span><span class=\"token punctuation\">(</span>label<span class=\"token punctuation\">:</span> <span class=\"token builtin\">str</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span><span class=\"token operator\">></span> Generator<span class=\"token punctuation\">[</span><span class=\"token boolean\">None</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">None</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">None</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">:</span>\n    <span class=\"token triple-quoted-string string\">\"\"\"\n    Timer Context Manager\n    \"\"\"</span>\n    <span class=\"token keyword\">try</span><span class=\"token punctuation\">:</span>\n        <span class=\"token comment\"># initialization</span>\n        start <span class=\"token operator\">=</span> time<span class=\"token punctuation\">.</span>perf_counter<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        <span class=\"token comment\"># business logic part is decoupled from the context management</span>\n        <span class=\"token keyword\">yield</span>\n    <span class=\"token keyword\">finally</span><span class=\"token punctuation\">:</span>\n        <span class=\"token comment\"># clean up</span>\n        end <span class=\"token operator\">=</span> time<span class=\"token punctuation\">.</span>perf_counter<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string-interpolation\"><span class=\"token string\">f\"</span><span class=\"token interpolation\"><span class=\"token punctuation\">{</span>label<span class=\"token punctuation\">}</span></span><span class=\"token string\">: </span><span class=\"token interpolation\"><span class=\"token punctuation\">{</span>end <span class=\"token operator\">-</span> start<span class=\"token punctuation\">:</span><span class=\"token format-spec\">0.4f</span><span class=\"token punctuation\">}</span></span><span class=\"token string\"> seconds\"</span></span><span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">with</span> timer<span class=\"token punctuation\">(</span><span class=\"token string\">\"factorial\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token comment\"># business logic</span>\n    factorial<span class=\"token punctuation\">(</span><span class=\"token number\">1e3</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>Context managers help to decouple business logic from the context creation. That makes the usage of contexts more cleaner without the unnecessary burden that initialization/cleanup code could bring to the code.</p>\n<p>Here are just a few examples of using context managers in the wild:</p>\n<ul>\n<li>work with files. Python vanilla <a href=\"https://docs.python.org/3/library/functions.html#open\" target=\"_blank\" rel=\"noopener noreferrer\"><code class=\"language-text\">open()</code></a> function is implemented as a context manager.</li>\n<li>create a request context. <a href=\"https://www.python-httpx.org/async/\" target=\"_blank\" rel=\"noopener noreferrer\">HTTPX</a> uses an async context manager to create a request session.</li>\n<li>mock objects for testing purposes. <a href=\"https://docs.python.org/3/library/unittest.mock.html\" target=\"_blank\" rel=\"noopener noreferrer\">Python's mock object library</a> uses a context manager to create a context where some object is going to be mocked for the sake of unit testing.</li>\n<li>control over backpropagation. <a href=\"https://keras.io/getting_started/intro_to_keras_for_researchers/\" target=\"_blank\" rel=\"noopener noreferrer\">Tensorflow and Keras</a> use a context manager to give fine-grained control over DNN backprogation gradients.</li>\n<li>define event emitting scope. I have used context managers to elaborate the scope to which you want to emit Socket.io events in <a href=\"https://github.com/seifrajhi/socket.io-redis-emitter\" target=\"_blank\" rel=\"noopener noreferrer\">the socket.io-redis-emitter project</a></li>\n<li>etc.</li>\n</ul>\n<h2 id=\"comments\" style=\"position:relative;\"><a href=\"#comments\" aria-label=\"comments permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Comments</h2>\n<p>Knowing the full context of the solution will help other contributors to evolve it. Some solutions are suboptimal because the code owner did not know a better way to implement them. So someone can understand the context and refactor the code.</p>\n<p>More frequently there are external requirements and conditions that prompt us to write suboptimal code. We need to specify them in order to let everyone know in the team. There is probably no better place for that than a comment near the code it belongs to.</p>\n<p>In other situations, we may place a summary of the solutions you considered during the research. This may save a lot of time for other people and open a door for new solutions in the future when someone comes up with even smarter ideas.</p>\n<p>In all these cases, <strong>comments are a great tool to convey your intention</strong>. They serve best when you specify:</p>\n<ul>\n<li><strong>why</strong> do you need this code</li>\n<li>and <strong>what</strong> it's intended to do</li>\n</ul>\n<p>Make sure you <strong>don't describe self-obvious details</strong> that may be easily figured out by reading the code.</p>\n<p>\n\t\t<video\n\t\t\tsrc=https://media.giphy.com/media/R2Rn1PLeMUsyTwj7wa/giphy.mp4\n\t\t\twidth=\"100%\"\n\t\t\theight=\"auto\"\n\t\t\tpreload=\"auto\"\n\t\t\tmuted=\"true\"\n\t\t\ttitle=\"Obvious comments looks like this\"\n\t\t\tautoplay\n\t\t\tplaysinline\n\t\t\tcontrols\n\t\t\tloop\n\t\t></video>\n\t</p>\n<p>The following example should be a good illustration:</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">import</span> requests\n\n<span class=\"token keyword\">from</span> somelib <span class=\"token keyword\">import</span> client\n\n<span class=\"token keyword\">def</span> <span class=\"token function\">get_books</span><span class=\"token punctuation\">(</span>page<span class=\"token punctuation\">:</span> <span class=\"token builtin\">int</span> <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> count<span class=\"token punctuation\">:</span> <span class=\"token builtin\">int</span> <span class=\"token operator\">=</span> <span class=\"token number\">10</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span><span class=\"token operator\">></span> List<span class=\"token punctuation\">[</span>Book<span class=\"token punctuation\">]</span><span class=\"token punctuation\">:</span>\n    <span class=\"token triple-quoted-string string\">\"\"\"\n    Retrieve a list of available books\n    \"\"\"</span>\n    <span class=\"token keyword\">return</span> client<span class=\"token punctuation\">.</span>get_books<span class=\"token punctuation\">(</span>page<span class=\"token operator\">=</span>page<span class=\"token punctuation\">,</span> count<span class=\"token operator\">=</span>count<span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">def</span> <span class=\"token function\">search_books</span><span class=\"token punctuation\">(</span>keywords<span class=\"token punctuation\">:</span> <span class=\"token builtin\">str</span><span class=\"token punctuation\">,</span> page<span class=\"token punctuation\">:</span> <span class=\"token builtin\">int</span> <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> count<span class=\"token punctuation\">:</span> <span class=\"token builtin\">int</span> <span class=\"token operator\">=</span> <span class=\"token number\">10</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span><span class=\"token operator\">></span> List<span class=\"token punctuation\">[</span>Book<span class=\"token punctuation\">]</span><span class=\"token punctuation\">:</span>\n    <span class=\"token triple-quoted-string string\">\"\"\"\n    Search books by keywords\n    \"\"\"</span>\n    response <span class=\"token operator\">=</span> requests<span class=\"token punctuation\">.</span>get<span class=\"token punctuation\">(</span>\n        <span class=\"token string-interpolation\"><span class=\"token string\">f\"/api/v1/books/search?p=</span><span class=\"token interpolation\"><span class=\"token punctuation\">{</span>page<span class=\"token punctuation\">}</span></span><span class=\"token string\">&amp;c=</span><span class=\"token interpolation\"><span class=\"token punctuation\">{</span>count<span class=\"token punctuation\">}</span></span><span class=\"token string\">\"</span></span><span class=\"token punctuation\">,</span>\n        json<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>\n            <span class=\"token string\">\"keywords\"</span><span class=\"token punctuation\">:</span> keywords<span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">)</span>\n\n    <span class=\"token comment\"># process edge cases</span>\n    <span class=\"token comment\"># ...</span>\n\n    <span class=\"token keyword\">return</span> response<span class=\"token punctuation\">.</span>json<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>It's not clear why <code class=\"language-text\">search_books()</code> method doesn't use <code class=\"language-text\">somelib.client</code> for the search request and it falls back to low level <code class=\"language-text\">requests</code> calls. This question will be raised many times. In order to make this piece of code better, we should have left a comment explaining the astonishing part:</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">def</span> <span class=\"token function\">search_books</span><span class=\"token punctuation\">(</span>keywords<span class=\"token punctuation\">:</span> <span class=\"token builtin\">str</span><span class=\"token punctuation\">,</span> page<span class=\"token punctuation\">:</span> <span class=\"token builtin\">int</span> <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> count<span class=\"token punctuation\">:</span> <span class=\"token builtin\">int</span> <span class=\"token operator\">=</span> <span class=\"token number\">10</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span><span class=\"token operator\">></span> List<span class=\"token punctuation\">[</span>Book<span class=\"token punctuation\">]</span><span class=\"token punctuation\">:</span>\n    <span class=\"token triple-quoted-string string\">\"\"\"\n    Search books by keywords\n\n    somelib.client doesn't support search APIs at this point. We had to use requests to access them.\n    \"\"\"</span>\n\n    <span class=\"token comment\"># ...</span></code></pre></div>\n<p>This little comment answers all our questions and it also provides additional clues on how to refactor it (e.g. looking at release notes of the somelib to find the search method implemented).</p>\n<p>Code comments are far from being the only tool to convey your intention, but it's one of the most obvious one. The code itself should be expressive and <strong>language constructions</strong> are your best friends on this way.</p>\n<h2 id=\"dont-make-me-read-twice\" style=\"position:relative;\"><a href=\"#dont-make-me-read-twice\" aria-label=\"dont make me read twice permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Don't Make Me Read Twice</h2>\n<p>Finally, how can we identify spots in our codebase that don't communicate their intend well?</p>\n<p>One of the <a href=\"https://en.wikipedia.org/wiki/Zen_of_Python\" target=\"_blank\" rel=\"noopener noreferrer\">Python's Zens</a> is \"there should be one and only one way to do things\". The obvious and expected approaches should be preferably used to solve problems. The approaches don't surprise you when you read the code. That would reduce the mental burden and significantly improve codebase maintenance. All code pieces that can not be described that way should be on the list of candidates to be refactored or revisited.</p>\n<p>This rule from the Python Zen is related to another famous rule which is <a href=\"https://en.wikipedia.org/wiki/Principle_of_least_astonishment\" target=\"_blank\" rel=\"noopener noreferrer\">the rule of the least surprise</a>. Your code should not astonish its readers and it should make them read it twice to understand.</p>\n<p>In the real life, it may be harder to achieve high brevity of the code. After all, it's all about trade-offs. However, you should always remember about your best friends on this way: language idioms and comments, because using them does take you closer to that goal.</p>\n<h2 id=\"references\" style=\"position:relative;\"><a href=\"#references\" aria-label=\"references permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>References</h2>\n<ul>\n<li><a href=\"https://www.oreilly.com/library/view/robust-python/9781098100650/\">Robust Python by Patrick Viafore</a></li>\n</ul>"}}},"staticQueryHashes":["1271460761","1321585977"],"slicesMap":{}}