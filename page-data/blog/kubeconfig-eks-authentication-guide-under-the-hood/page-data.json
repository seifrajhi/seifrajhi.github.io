{"componentChunkName":"component---src-templates-blog-template-js","path":"/blog/kubeconfig-eks-authentication-guide-under-the-hood/","result":{"data":{"markdownRemark":{"html":"<blockquote>\n<p><strong>AWS EKS-Kubeconfig Connection üêã</strong></p>\n</blockquote>\n<h2 id=\"-introduction\" style=\"position:relative;\"><a href=\"#-introduction\" aria-label=\" introduction permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üìå Introduction</h2>\n<p>One of the key challenges of using EKS is authentication. EKS uses IAM to provide authentication to your K8s cluster. However, IAM tokens can be difficult to manage and use.</p>\n<p><a href=\"https://kubernetes.io/docs/concepts/configuration/organize-cluster-access-kubeconfig/\" target=\"_blank\" rel=\"noopener noreferrer\">Kubeconfig</a> is a configuration file that stores information about K8s clusters, including their API server endpoints, certificates, and authentication information. Kubeconfig can be used to authenticate with EKS clusters, making it a more convenient and secure option than IAM tokens. This blog post will discuss how to use kubeconfig to authenticate with EKS clusters. We will also cover the basics of kubeconfig and how it works.</p>\n<p><span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 37.05882352941176%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAAsTAAALEwEAmpwYAAAByUlEQVR42j2SzWsTQRiH+1940ZOnHAShCBUqIviFWqj1A9Go4MF6LOhFPYlaUAy9KEIrSsWD4AceFJFeJNaLpgXTNNvE7G66rJI0Zpu1bjbZ3dnH2Vl04B3mfX8zDy/vbwaEEEDMN6PHfKlLEMbEcYyIIoRIIpS5UOc4jpTW6/WpWza6ufo/Ou5vkjWQXJ564zJ6s0H23hoT0206GxFOO6KyElL4KqjVBIsLIUvFQD0yVy0yO/ay6+AJjpy8wObMEE+evUiBditg7HaT1589Pi37nMu1eF/wlOj7IcWihmFYsuOYbjdS9ZpRZ/vwIY6eucj5S5fZNnSAmdnnKbBs9Ri50eDdF48PCx6n7zZ5Of9HSgFLpRLVakUCDep1E9PUU6BuMrz/OGPZccYnrrFv9CyP/gGT7fFcl2OTDtncOlefbqg5BUGA67oSYpLP59E0TebpnL5L4JbMTgZ3j7Dn8Ck2bR3k/vRsCozCENu2efuxyqu5FcoV2YU0IgxDBfZ9H8dx8DxP5YmBbWedydwDFXemHnLl+i0Ki8UUmLis6zpGTcMyK2jlZfr9gKSeQNNfAJF0PVLOCwXudFx+/GzQaLZYa/0iFkJpfwGFMd7jLUDIiAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"Kubeconfig Diagram\" title=\"\" src=\"/static/4f530c98ecd2cb014bb56234dd64c4a3/c5bb3/Kubeconfig.png\" srcset=\"/static/4f530c98ecd2cb014bb56234dd64c4a3/04472/Kubeconfig.png 170w,\n/static/4f530c98ecd2cb014bb56234dd64c4a3/9f933/Kubeconfig.png 340w,\n/static/4f530c98ecd2cb014bb56234dd64c4a3/c5bb3/Kubeconfig.png 680w,\n/static/4f530c98ecd2cb014bb56234dd64c4a3/2c288/Kubeconfig.png 684w\" sizes=\"(max-width: 680px) 100vw, 680px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n    </span>\n          </p>\n<h2 id=\"Ô∏è-kubeconfig-a-manual-creation-guide-and-its-interplay-with-code-classlanguage-textaws-eks-get-tokencode\" style=\"position:relative;\"><a href=\"#%EF%B8%8F-kubeconfig-a-manual-creation-guide-and-its-interplay-with-code-classlanguage-textaws-eks-get-tokencode\" aria-label=\"Ô∏è kubeconfig a manual creation guide and its interplay with code classlanguage textaws eks get tokencode permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>‚ò∏Ô∏è Kubeconfig: A Manual Creation Guide and its Interplay with <code class=\"language-text\">aws eks get-token</code></h2>\n<p><a href=\"https://kubernetes.io/docs/concepts/configuration/organize-cluster-access-kubeconfig/\" target=\"_blank\" rel=\"noopener noreferrer\">Kubeconfig</a> serves as the backbone for <a href=\"https://kubernetes.io/docs/reference/kubectl/\" target=\"_blank\" rel=\"noopener noreferrer\">kubectl</a>, empowering it to locate the necessary details for cluster selection and communication with the API Server.</p>\n<p>By default, <code class=\"language-text\">kubectl</code> searches for a file named <code class=\"language-text\">config</code> within the <code class=\"language-text\">$HOME/.kube</code> directory, allowing seamless access to Kubernetes resources. In this article, we'll take a hands-on approach and walk you through the manual creation of <code class=\"language-text\">kubeconfig</code>. As we progress, we'll unravel the inner workings of this vital configuration file, exploring its synergy with <code class=\"language-text\">aws eks get-token</code>.</p>\n<p>By the end, you'll have a comprehensive understanding of how these components collaboratively enable secure and efficient interactions with AWS EKS clusters.</p>\n<h3 id=\"-prerequisites-for-this-blog\" style=\"position:relative;\"><a href=\"#-prerequisites-for-this-blog\" aria-label=\" prerequisites for this blog permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üìú Prerequisites for this Blog</h3>\n<ul>\n<li>Basic familiarity with Kubernetes concepts and operations.</li>\n<li>Understanding of Amazon Web Services (AWS) and Elastic Kubernetes Service (EKS).</li>\n<li>Familiarity with the <code class=\"language-text\">kubectl</code> command-line tool.</li>\n<li>A functional AWS EKS Kubernetes cluster, to experiment with <code class=\"language-text\">kubeconfig</code> and <code class=\"language-text\">aws eks get-token</code>.</li>\n</ul>\n<h2 id=\"Ô∏è-hands-on-lab\" style=\"position:relative;\"><a href=\"#%EF%B8%8F-hands-on-lab\" aria-label=\"Ô∏è hands on lab permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üõ†Ô∏è Hands-on Lab</h2>\n<p>In this part, we'll walk through each step, from creating the <code class=\"language-text\">kubeconfig</code> file to leveraging <code class=\"language-text\">aws eks get-token</code>, all while exploring the vital components that facilitate secure authentication and communication with your Kubernetes cluster.</p>\n<h3 id=\"step-1-remove-existing-kubeconfig-folder-Ô∏è\" style=\"position:relative;\"><a href=\"#step-1-remove-existing-kubeconfig-folder-%EF%B8%8F\" aria-label=\"step 1 remove existing kubeconfig folder Ô∏è permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Step 1: Remove Existing Kubeconfig Folder ‚öôÔ∏è</h3>\n<p>Delete the existing <code class=\"language-text\">~/.kube</code> folder created by <code class=\"language-text\">eksctl</code> to ensure a clean slate for <code class=\"language-text\">kubeconfig</code> setup.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">rm</span> <span class=\"token parameter variable\">-r</span> ~/.kube</code></pre></div>\n<h3 id=\"step-2-set-environment-variables-\" style=\"position:relative;\"><a href=\"#step-2-set-environment-variables-\" aria-label=\"step 2 set environment variables  permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Step 2: Set Environment Variables üåç</h3>\n<p>Define <code class=\"language-text\">region</code>, <code class=\"language-text\">cluster_name</code>, and <code class=\"language-text\">account_id</code> as environment variables to simplify subsequent commands.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token builtin class-name\">export</span> <span class=\"token assign-left variable\">region_code</span><span class=\"token operator\">=</span><span class=\"token string\">\"eu-west-1\"</span>\n<span class=\"token builtin class-name\">export</span> <span class=\"token assign-left variable\">cluster_name</span><span class=\"token operator\">=</span><span class=\"token string\">\"poc-cluster\"</span>\n<span class=\"token builtin class-name\">export</span> <span class=\"token assign-left variable\">account_id</span><span class=\"token operator\">=</span><span class=\"token string\">\"account_id\"</span></code></pre></div>\n<h3 id=\"step-3-retrieve-cluster-endpoint-\" style=\"position:relative;\"><a href=\"#step-3-retrieve-cluster-endpoint-\" aria-label=\"step 3 retrieve cluster endpoint  permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Step 3: Retrieve Cluster Endpoint üîó</h3>\n<p>Obtain the cluster endpoint URL required for communication with the Kubernetes API server.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token assign-left variable\">cluster_endpoint</span><span class=\"token operator\">=</span><span class=\"token variable\"><span class=\"token variable\">$(</span>aws eks describe-cluster <span class=\"token punctuation\">\\</span>\n<span class=\"token parameter variable\">--region</span> $region_code <span class=\"token punctuation\">\\</span>\n<span class=\"token parameter variable\">--name</span> $cluster_name <span class=\"token punctuation\">\\</span>\n<span class=\"token parameter variable\">--query</span> <span class=\"token string\">\"cluster.endpoint\"</span> <span class=\"token punctuation\">\\</span>\n<span class=\"token parameter variable\">--output</span> text<span class=\"token variable\">)</span></span></code></pre></div>\n<h3 id=\"step-4-get-certificate-authority-data-\" style=\"position:relative;\"><a href=\"#step-4-get-certificate-authority-data-\" aria-label=\"step 4 get certificate authority data  permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Step 4: Get Certificate Authority Data üîê</h3>\n<p>Acquire the base64-encoded Certificate Authority (CA) Certificate data, essential for secure communication with the cluster.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token assign-left variable\">certificate_data</span><span class=\"token operator\">=</span><span class=\"token punctuation\">$(</span>aws eks describe-cluster <span class=\"token punctuation\">\\</span>\n<span class=\"token parameter variable\">--region</span> <span class=\"token variable\">$region_code</span> <span class=\"token punctuation\">\\</span>\n<span class=\"token parameter variable\">--name</span> <span class=\"token variable\">$cluster_name</span> <span class=\"token punctuation\">\\</span>\n<span class=\"token parameter variable\">--query</span> <span class=\"token string\">\"cluster.certificateAuthority.data\"</span> <span class=\"token punctuation\">\\</span>\n<span class=\"token parameter variable\">--output</span>\naws eks describe-cluster <span class=\"token parameter variable\">--name</span> <span class=\"token variable\">$cluster_name</span> <span class=\"token punctuation\">\\</span>\n<span class=\"token parameter variable\">--query</span> <span class=\"token string\">\"cluster.certificateAuthority.data\"</span> <span class=\"token punctuation\">\\</span>\n<span class=\"token parameter variable\">--output</span> text <span class=\"token operator\">|</span> base64 <span class=\"token parameter variable\">--decode</span> <span class=\"token operator\">></span> eks.crt</code></pre></div>\n<p>Additionally, you can inspect the certificate details using OpenSSL to verify its authenticity:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">openssl x509 <span class=\"token parameter variable\">-in</span> eks.crt <span class=\"token parameter variable\">-text</span> <span class=\"token parameter variable\">-noout</span></code></pre></div>\n<p>Here, the <code class=\"language-text\">Issuer: CN=kubernetes</code> and <code class=\"language-text\">Subject: CN=kubernetes</code> indicate a self-signed certificate issued by EKS.</p>\n<h3 id=\"step-5-create-kubeconfig-directory-\" style=\"position:relative;\"><a href=\"#step-5-create-kubeconfig-directory-\" aria-label=\"step 5 create kubeconfig directory  permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Step 5: Create Kubeconfig Directory üìÇ</h3>\n<p>Prepare the necessary <code class=\"language-text\">~/.kube</code> directory to store the <code class=\"language-text\">kubeconfig</code> file and other Kubernetes configuration files.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">mkdir</span> <span class=\"token parameter variable\">-p</span> ~/.kube</code></pre></div>\n<h3 id=\"step-6-create-kubeconfig-file-\" style=\"position:relative;\"><a href=\"#step-6-create-kubeconfig-file-\" aria-label=\"step 6 create kubeconfig file  permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Step 6. Create Kubeconfig File üìù</h3>\n<p>Generate a configuration file using the following command, which creates the file <code class=\"language-text\">~/.kube/config</code> and automatically fills in all the necessary fields.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token shebang important\">#!/bin/bash</span>\n<span class=\"token builtin class-name\">read</span> <span class=\"token parameter variable\">-r</span> <span class=\"token parameter variable\">-d</span> <span class=\"token string\">''</span> KUBECONFIG <span class=\"token operator\">&lt;&lt;</span><span class=\"token string\">EOF\napiVersion: v1\nclusters:\n- cluster:\n    certificate-authority-data: <span class=\"token variable\">$certificate_data</span>\n    server: <span class=\"token variable\">$cluster_endpoint</span>\n  name: arn:aws:eks:<span class=\"token variable\">$region_code</span>:<span class=\"token variable\">$account_id</span>:cluster/<span class=\"token variable\">$cluster_name</span>\ncontexts:\n- context:\n    cluster: arn:aws:eks:<span class=\"token variable\">$region_code</span>:<span class=\"token variable\">$account_id</span>:cluster/<span class=\"token variable\">$cluster_name</span>\n    user: arn:aws:eks:<span class=\"token variable\">$region_code</span>:<span class=\"token variable\">$account_id</span>:cluster/<span class=\"token variable\">$cluster_name</span>\n  name: arn:aws:eks:<span class=\"token variable\">$region_code</span>:<span class=\"token variable\">$account_id</span>:cluster/<span class=\"token variable\">$cluster_name</span>\ncurrent-context: arn:aws:eks:<span class=\"token variable\">$region_code</span>:<span class=\"token variable\">$account_id</span>:cluster/<span class=\"token variable\">$cluster_name</span>\nkind: Config\npreferences: {}\nusers:\n- name: arn:aws:eks:<span class=\"token variable\">$region_code</span>:<span class=\"token variable\">$account_id</span>:cluster/<span class=\"token variable\">$cluster_name</span>\n  user:\n    exec:\n      apiVersion: client.authentication.k8s.io/v1beta1\n      command: aws\n      args:\n        - --region\n        - <span class=\"token variable\">$region_code</span>\n        - eks\n        - get-token\n        - --cluster-name\n        - <span class=\"token variable\">$cluster_name</span>\n        # - \"-r\"\n        # - \"arn:aws:iam::<span class=\"token variable\">$account_id</span>:role/my-role\"\n      # env:\n        # - name: \"AWS_PROFILE\"\n        #   value: \"aws-profile\"\nEOF</span>\n<span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"<span class=\"token variable\">${KUBECONFIG}</span>\"</span> <span class=\"token operator\">></span> ~/.kube/config</code></pre></div>\n<p>The client token, essential for authentication, will be obtained using the AWS CLI.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">aws eks get-token --cluster-name <span class=\"token variable\">$cluster_name</span></code></pre></div>\n<p>This command provides an <code class=\"language-text\">ExecCredential</code> object containing the required token for authentication.</p>\n<p>The token generated by <code class=\"language-text\">aws eks get-token</code> is a JSON Web Token (JWT) that follows a specific format. Each token begins with the prefix <code class=\"language-text\">k8s-aws-v1.</code>, followed by a base64-encoded string containing JSON data. When decoded, the token should resemble the following structure:</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\n  <span class=\"token property\">\"kind\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"ExecCredential\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"apiVersion\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"client.authentication.k8s.io/v1beta1\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"status\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"expirationTimestamp\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"2023-08-06T12:09:00Z\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"token\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"base64_encoded_jwt_token_here\"</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>With the configuration file created and the client token obtained, our kubeconfig setup is complete.</p>\n<h3 id=\"step-7-verify-cluster-access-\" style=\"position:relative;\"><a href=\"#step-7-verify-cluster-access-\" aria-label=\"step 7 verify cluster access  permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Step 7. Verify Cluster Access üßë‚Äçüíª</h3>\n<p>Now that our kubeconfig is set up and the client token is obtained, let's validate the cluster access and ensure that everything is functioning correctly. We'll use the <code class=\"language-text\">kubectl</code> command-line tool to interact with the cluster.</p>\n<p>First, check the services available in the cluster:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">kubectl get svc</code></pre></div>\n<p>Next, verify the list of nodes in the cluster:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">kubectl get nodes</code></pre></div>\n<p>These commands will provide an overview of the services and nodes within the cluster, confirming successful access and interaction with your AWS EKS cluster. If everything is configured properly, you should see a list of services and nodes, indicating that you have established a successful connection to the Kubernetes cluster on AWS EKS.</p>\n<h3 id=\"step-8-understanding-the-mechanism-‚ìúÔ∏è\" style=\"position:relative;\"><a href=\"#step-8-understanding-the-mechanism-%E2%93%9C%EF%B8%8F\" aria-label=\"step 8 understanding the mechanism ‚ìúÔ∏è permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Step 8. Understanding the Mechanism ‚ìÇÔ∏è</h3>\n<p>Now that we have the IAM user details and the kubeconfig set up, let's explore how the Kubernetes cluster verifies RBAC permissions for these users. Kubernetes checks the IAM user or role credentials obtained earlier against its Role-Based Access Control (RBAC) system.</p>\n<p>To confirm the IAM users or roles added to the cluster's RBAC permissions, we'll examine the <code class=\"language-text\">aws-auth</code> ConfigMap. The ConfigMap stores the mappings between IAM entities and their corresponding Kubernetes roles and groups, defining the access levels for AWS users within the cluster.</p>\n<p>To view the contents of the <code class=\"language-text\">aws-auth</code> ConfigMap, run the following command:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">kubectl describe configmap aws-auth <span class=\"token parameter variable\">-n</span> kube-system</code></pre></div>\n<p>This command will display detailed information about the <code class=\"language-text\">aws-auth</code> ConfigMap, shedding light on the IAM users and roles granted permissions in the Kubernetes cluster.</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">Name</span><span class=\"token punctuation\">:</span>         aws<span class=\"token punctuation\">-</span>auth\n<span class=\"token key atrule\">Namespace</span><span class=\"token punctuation\">:</span>    kube<span class=\"token punctuation\">-</span>system\n<span class=\"token key atrule\">Labels</span><span class=\"token punctuation\">:</span>       &lt;none<span class=\"token punctuation\">></span>\n<span class=\"token key atrule\">Annotations</span><span class=\"token punctuation\">:</span>  &lt;none<span class=\"token punctuation\">></span>\n<span class=\"token key atrule\">API Version</span><span class=\"token punctuation\">:</span>  v1\n<span class=\"token key atrule\">Kind</span><span class=\"token punctuation\">:</span>         ConfigMap\n<span class=\"token key atrule\">Data</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">mapRoles</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">rolearn</span><span class=\"token punctuation\">:</span> arn<span class=\"token punctuation\">:</span>aws<span class=\"token punctuation\">:</span>iam<span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span>123456789012<span class=\"token punctuation\">:</span>role/MyEKSWorkerRole\n      <span class=\"token key atrule\">username</span><span class=\"token punctuation\">:</span> system<span class=\"token punctuation\">:</span>node<span class=\"token punctuation\">:</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span>EC2PrivateDNSName<span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\n      <span class=\"token key atrule\">groups</span><span class=\"token punctuation\">:</span>\n        <span class=\"token punctuation\">-</span> system<span class=\"token punctuation\">:</span>bootstrappers\n        <span class=\"token punctuation\">-</span> system<span class=\"token punctuation\">:</span>nodes\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">rolearn</span><span class=\"token punctuation\">:</span> arn<span class=\"token punctuation\">:</span>aws<span class=\"token punctuation\">:</span>iam<span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span>123456789012<span class=\"token punctuation\">:</span>user/xxxx\n      <span class=\"token key atrule\">username</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"system:node:{{EC2PrivateDNSName}}\"</span>\n      <span class=\"token key atrule\">groups</span><span class=\"token punctuation\">:</span>\n        <span class=\"token punctuation\">-</span> system<span class=\"token punctuation\">:</span>masters</code></pre></div>\n<p>In our exploration, we encountered an intriguing situation where a specific IAM entity had the ability to access the Amazon EKS cluster despite not having a corresponding entry in the <code class=\"language-text\">aws-auth</code> ConfigMap. This enigma led us to uncover an interesting mechanism provided by AWS.</p>\n<p>When you create an Amazon EKS cluster, the AWS Identity and Access Management (IAM) entity user or role, such as a federated user that creates the cluster, is automatically granted <code class=\"language-text\">system:masters</code> permissions in the cluster's role-based access control (RBAC) configuration in the Amazon EKS control plane. This IAM entity doesn't appear in any visible configuration, so make sure to keep track of which IAM entity originally created the cluster.</p>\n<p>However, this automated privilege assignment applies only to the IAM entity that initiated the cluster creation process. For additional users or roles requiring access, corresponding entries must be explicitly defined in the <code class=\"language-text\">aws-auth</code> ConfigMap.</p>\n<p>In our scenario, we observed that the identity of the user who obtained the token via the <code class=\"language-text\">kubectl</code> command (using <code class=\"language-text\">aws eks get-token</code> specified in the kubeconfig) did not have visible RBAC entries in the <code class=\"language-text\">aws-auth</code> ConfigMap. Nonetheless, AWS documentation clarified that this user had already been granted <code class=\"language-text\">system:masters</code> permissions by default, albeit in a concealed manner.</p>\n<h2 id=\"Ô∏è-conclusion\" style=\"position:relative;\"><a href=\"#%EF%B8%8F-conclusion\" aria-label=\"Ô∏è conclusion permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üíÅüèª‚Äç‚ôÇÔ∏è Conclusion</h2>\n<p>This phenomenon highlights a control aspect that we must relinquish when using managed Kubernetes platforms like EKS. Understanding this behavior is essential for assessing the security posture of your Kubernetes cluster, even when certain aspects may not be immediately apparent in the configuration.</p>\n<p>By exploring these intricacies, we gain valuable insights into the underlying mechanics of <a href=\"https://aws.amazon.com/eks/\" target=\"_blank\" rel=\"noopener noreferrer\">AWS EKS</a>, which enables us to make informed decisions to enhance the security and management of our Kubernetes clusters.</p>\n<p>We hope that you have found this blog post helpful. If you have any other tips or tricks that you would like to share, please leave a comment below.</p>\n<br>\n<p><strong><em>Until next time, „Å§„Å•„Åè üéâ</em></strong></p>\n<blockquote>\n<p>üí° Thank you for Reading !! üôåüèªüòÅüìÉ, see you in the next blog.ü§ò  <em><strong>Until next time üéâ</strong></em></p>\n</blockquote>\n<p>üöÄ Thank you for sticking up till the end. If you have any questions/feedback regarding this blog feel free to connect with me:</p>\n<p><strong>‚ôªÔ∏è LinkedIn:</strong> <a href=\"https://www.linkedin.com/in/rajhi-saif/\" target=\"_blank\" rel=\"noopener noreferrer\">https://www.linkedin.com/in/rajhi-saif/</a></p>\n<p><strong>‚ôªÔ∏è X/Twitter:</strong> <a href=\"https://x.com/rajhisaifeddine\" target=\"_blank\" rel=\"noopener noreferrer\">https://x.com/rajhisaifeddine</a></p>\n<p><strong>The end ‚úåüèª</strong></p>\n<h1 align=\"center\">üî∞ Keep Learning !! Keep Sharing !! üî∞</h1>\n<p><strong>üìÖ Stay updated</strong></p>\n<p>Subscribe to our newsletter for more insights on AWS cloud computing and containers.</p>","timeToRead":6,"rawMarkdownBody":"\n> **AWS EKS-Kubeconfig Connection üêã**\n\n## üìå Introduction\n\nOne of the key challenges of using EKS is authentication. EKS uses IAM to provide authentication to your K8s cluster. However, IAM tokens can be difficult to manage and use.\n\n[Kubeconfig](https://kubernetes.io/docs/concepts/configuration/organize-cluster-access-kubeconfig/) is a configuration file that stores information about K8s clusters, including their API server endpoints, certificates, and authentication information. Kubeconfig can be used to authenticate with EKS clusters, making it a more convenient and secure option than IAM tokens. This blog post will discuss how to use kubeconfig to authenticate with EKS clusters. We will also cover the basics of kubeconfig and how it works.\n\n![Kubeconfig Diagram](./Kubeconfig.png)\n\n## ‚ò∏Ô∏è Kubeconfig: A Manual Creation Guide and its Interplay with `aws eks get-token`\n\n[Kubeconfig](https://kubernetes.io/docs/concepts/configuration/organize-cluster-access-kubeconfig/) serves as the backbone for [kubectl](https://kubernetes.io/docs/reference/kubectl/), empowering it to locate the necessary details for cluster selection and communication with the API Server.\n\nBy default, `kubectl` searches for a file named `config` within the `$HOME/.kube` directory, allowing seamless access to Kubernetes resources. In this article, we'll take a hands-on approach and walk you through the manual creation of `kubeconfig`. As we progress, we'll unravel the inner workings of this vital configuration file, exploring its synergy with `aws eks get-token`.\n\nBy the end, you'll have a comprehensive understanding of how these components collaboratively enable secure and efficient interactions with AWS EKS clusters.\n\n### üìú Prerequisites for this Blog\n\n- Basic familiarity with Kubernetes concepts and operations.\n- Understanding of Amazon Web Services (AWS) and Elastic Kubernetes Service (EKS).\n- Familiarity with the `kubectl` command-line tool.\n- A functional AWS EKS Kubernetes cluster, to experiment with `kubeconfig` and `aws eks get-token`.\n\n## üõ†Ô∏è Hands-on Lab\n\nIn this part, we'll walk through each step, from creating the `kubeconfig` file to leveraging `aws eks get-token`, all while exploring the vital components that facilitate secure authentication and communication with your Kubernetes cluster.\n\n### Step 1: Remove Existing Kubeconfig Folder ‚öôÔ∏è\n\nDelete the existing `~/.kube` folder created by `eksctl` to ensure a clean slate for `kubeconfig` setup.\n\n```bash\nrm -r ~/.kube\n```\n\n### Step 2: Set Environment Variables üåç\n\nDefine `region`, `cluster_name`, and `account_id` as environment variables to simplify subsequent commands.\n\n```bash\nexport region_code=\"eu-west-1\"\nexport cluster_name=\"poc-cluster\"\nexport account_id=\"account_id\"\n```\n\n### Step 3: Retrieve Cluster Endpoint üîó\n\nObtain the cluster endpoint URL required for communication with the Kubernetes API server.\n\n```bash\ncluster_endpoint=$(aws eks describe-cluster \\\n--region $region_code \\\n--name $cluster_name \\\n--query \"cluster.endpoint\" \\\n--output text)\n```\n\n### Step 4: Get Certificate Authority Data üîê\n\nAcquire the base64-encoded Certificate Authority (CA) Certificate data, essential for secure communication with the cluster.\n\n```bash\ncertificate_data=$(aws eks describe-cluster \\\n--region $region_code \\\n--name $cluster_name \\\n--query \"cluster.certificateAuthority.data\" \\\n--output\naws eks describe-cluster --name $cluster_name \\\n--query \"cluster.certificateAuthority.data\" \\\n--output text | base64 --decode > eks.crt\n```\n\nAdditionally, you can inspect the certificate details using OpenSSL to verify its authenticity:\n\n```bash\nopenssl x509 -in eks.crt -text -noout\n```\n\nHere, the `Issuer: CN=kubernetes` and `Subject: CN=kubernetes` indicate a self-signed certificate issued by EKS.\n\n### Step 5: Create Kubeconfig Directory üìÇ\n\nPrepare the necessary `~/.kube` directory to store the `kubeconfig` file and other Kubernetes configuration files.\n\n```bash\nmkdir -p ~/.kube\n```\n\n### Step 6. Create Kubeconfig File üìù\n\nGenerate a configuration file using the following command, which creates the file `~/.kube/config` and automatically fills in all the necessary fields.\n\n```bash\n#!/bin/bash\nread -r -d '' KUBECONFIG <<EOF\napiVersion: v1\nclusters:\n- cluster:\n    certificate-authority-data: $certificate_data\n    server: $cluster_endpoint\n  name: arn:aws:eks:$region_code:$account_id:cluster/$cluster_name\ncontexts:\n- context:\n    cluster: arn:aws:eks:$region_code:$account_id:cluster/$cluster_name\n    user: arn:aws:eks:$region_code:$account_id:cluster/$cluster_name\n  name: arn:aws:eks:$region_code:$account_id:cluster/$cluster_name\ncurrent-context: arn:aws:eks:$region_code:$account_id:cluster/$cluster_name\nkind: Config\npreferences: {}\nusers:\n- name: arn:aws:eks:$region_code:$account_id:cluster/$cluster_name\n  user:\n    exec:\n      apiVersion: client.authentication.k8s.io/v1beta1\n      command: aws\n      args:\n        - --region\n        - $region_code\n        - eks\n        - get-token\n        - --cluster-name\n        - $cluster_name\n        # - \"-r\"\n        # - \"arn:aws:iam::$account_id:role/my-role\"\n      # env:\n        # - name: \"AWS_PROFILE\"\n        #   value: \"aws-profile\"\nEOF\necho \"${KUBECONFIG}\" > ~/.kube/config\n```\n\nThe client token, essential for authentication, will be obtained using the AWS CLI.\n\n```bash\naws eks get-token --cluster-name $cluster_name\n```\n\nThis command provides an `ExecCredential` object containing the required token for authentication.\n\nThe token generated by `aws eks get-token` is a JSON Web Token (JWT) that follows a specific format. Each token begins with the prefix `k8s-aws-v1.`, followed by a base64-encoded string containing JSON data. When decoded, the token should resemble the following structure:\n\n```json\n{\n  \"kind\": \"ExecCredential\",\n  \"apiVersion\": \"client.authentication.k8s.io/v1beta1\",\n  \"status\": {\n    \"expirationTimestamp\": \"2023-08-06T12:09:00Z\",\n    \"token\": \"base64_encoded_jwt_token_here\"\n  }\n}\n```\n\nWith the configuration file created and the client token obtained, our kubeconfig setup is complete.\n\n### Step 7. Verify Cluster Access üßë‚Äçüíª\n\nNow that our kubeconfig is set up and the client token is obtained, let's validate the cluster access and ensure that everything is functioning correctly. We'll use the `kubectl` command-line tool to interact with the cluster.\n\nFirst, check the services available in the cluster:\n\n```bash\nkubectl get svc\n```\n\nNext, verify the list of nodes in the cluster:\n\n```bash\nkubectl get nodes\n```\n\nThese commands will provide an overview of the services and nodes within the cluster, confirming successful access and interaction with your AWS EKS cluster. If everything is configured properly, you should see a list of services and nodes, indicating that you have established a successful connection to the Kubernetes cluster on AWS EKS.\n\n### Step 8. Understanding the Mechanism ‚ìÇÔ∏è\n\nNow that we have the IAM user details and the kubeconfig set up, let's explore how the Kubernetes cluster verifies RBAC permissions for these users. Kubernetes checks the IAM user or role credentials obtained earlier against its Role-Based Access Control (RBAC) system.\n\nTo confirm the IAM users or roles added to the cluster's RBAC permissions, we'll examine the `aws-auth` ConfigMap. The ConfigMap stores the mappings between IAM entities and their corresponding Kubernetes roles and groups, defining the access levels for AWS users within the cluster.\n\nTo view the contents of the `aws-auth` ConfigMap, run the following command:\n\n```bash\nkubectl describe configmap aws-auth -n kube-system\n```\n\nThis command will display detailed information about the `aws-auth` ConfigMap, shedding light on the IAM users and roles granted permissions in the Kubernetes cluster.\n\n```yaml\nName:         aws-auth\nNamespace:    kube-system\nLabels:       <none>\nAnnotations:  <none>\nAPI Version:  v1\nKind:         ConfigMap\nData:\n  mapRoles:\n    - rolearn: arn:aws:iam::123456789012:role/MyEKSWorkerRole\n      username: system:node:{{EC2PrivateDNSName}}\n      groups:\n        - system:bootstrappers\n        - system:nodes\n    - rolearn: arn:aws:iam::123456789012:user/xxxx\n      username: \"system:node:{{EC2PrivateDNSName}}\"\n      groups:\n        - system:masters\n```\n\nIn our exploration, we encountered an intriguing situation where a specific IAM entity had the ability to access the Amazon EKS cluster despite not having a corresponding entry in the `aws-auth` ConfigMap. This enigma led us to uncover an interesting mechanism provided by AWS.\n\nWhen you create an Amazon EKS cluster, the AWS Identity and Access Management (IAM) entity user or role, such as a federated user that creates the cluster, is automatically granted `system:masters` permissions in the cluster's role-based access control (RBAC) configuration in the Amazon EKS control plane. This IAM entity doesn't appear in any visible configuration, so make sure to keep track of which IAM entity originally created the cluster.\n\nHowever, this automated privilege assignment applies only to the IAM entity that initiated the cluster creation process. For additional users or roles requiring access, corresponding entries must be explicitly defined in the `aws-auth` ConfigMap.\n\nIn our scenario, we observed that the identity of the user who obtained the token via the `kubectl` command (using `aws eks get-token` specified in the kubeconfig) did not have visible RBAC entries in the `aws-auth` ConfigMap. Nonetheless, AWS documentation clarified that this user had already been granted `system:masters` permissions by default, albeit in a concealed manner.\n\n## üíÅüèª‚Äç‚ôÇÔ∏è Conclusion\n\nThis phenomenon highlights a control aspect that we must relinquish when using managed Kubernetes platforms like EKS. Understanding this behavior is essential for assessing the security posture of your Kubernetes cluster, even when certain aspects may not be immediately apparent in the configuration.\n\nBy exploring these intricacies, we gain valuable insights into the underlying mechanics of [AWS EKS](https://aws.amazon.com/eks/), which enables us to make informed decisions to enhance the security and management of our Kubernetes clusters.\n\nWe hope that you have found this blog post helpful. If you have any other tips or tricks that you would like to share, please leave a comment below.\n\n<br>\n\n**_Until next time, „Å§„Å•„Åè üéâ_**\n\n> üí° Thank you for Reading !! üôåüèªüòÅüìÉ, see you in the next blog.ü§ò  _**Until next time üéâ**_\n\nüöÄ Thank you for sticking up till the end. If you have any questions/feedback regarding this blog feel free to connect with me:\n\n**‚ôªÔ∏è LinkedIn:** https://www.linkedin.com/in/rajhi-saif/\n\n**‚ôªÔ∏è X/Twitter:** https://x.com/rajhisaifeddine\n\n**The end ‚úåüèª**\n\n<h1 align=\"center\">üî∞ Keep Learning !! Keep Sharing !! üî∞</h1>\n\n**üìÖ Stay updated**\n\nSubscribe to our newsletter for more insights on AWS cloud computing and containers.\n","wordCount":{"words":1096},"frontmatter":{"id":"0ff148ada0db87ce5e2eaccf","path":"/blog/kubeconfig-eks-authentication-guide-under-the-hood/","humanDate":"Oct 19, 2024","fullDate":"2024-10-19","title":"Discover Kubeconfig: A guide to EKS authentication with AWS ü§î","keywords":["Kubeconfig","EKS Authentication","AWS","Kubernetes","Cloud Security"],"excerpt":"Get to know the secrets of Kubeconfig and EKS authentication with AWS","cover":{"childImageSharp":{"gatsbyImageData":{"layout":"fullWidth","placeholder":{"fallback":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAIAAAAC64paAAAACXBIWXMAAAsTAAALEwEAmpwYAAADlklEQVR42nVU+1MaVxTmX+t/0MkPnc500l86rTZNWhunaR7Ux5hEa9q8ZqydPCoREVQeQSOgAsKgCAgCFVgg6IIsu4C4C/uAXVjWnmVJnGaSO3funp093957vu+7R3X+bkjnEsz3ryRf38GCW3kvzpYlSfpojur8/6PT7RzXC3bUNZfQW48cGwX3XMJgeWtL1TJ8h/8g+QJMC0ykHF9KW18llzbzXozFm3yLYbkznvRhgYWUUZcy7pZCtRZ5AVYOwXWaBsSiT1vitWSdbyjndO/6n+sNEHS7Xa7dRMis5cg2d6jHWUIpQaXkxaspHWKkW0ytRinZsDo83qeaVxCIoghrvU7TDLuOOp15bx+sPFYyq3t4GOKfJ+76QvsNml5+s35j8veBW2rNiin872GlVvthZDRfwIpcCTZvCEy/5hMaA3pqzTOIIenroeEfx8bzGGa02R8+f9ni+Zl57WdffuUNhiBB6Ah6xALs9MEbqMd27FIkwMuVyZnZK+qRRDbrDQSf6fS8INy4PzX51+wbl1uRK0REl9KvRUlUAT2ahAHkUQicN5mRXI7luJE/Hw3cunN5aPjXqelgNAafZuYXiGoVAqpVn+tBVAE8YsyutTvtdZdba7ZcHRnTGE3r7u3rE/e+uHIN9rz03aB1c8tkd9ye/mNy5m+jzXFG1j3Y7mpuQwU8yWCxA4CXhuWfxie0Jsua0zU8cf/zbwev/jZ6aeD71S0n1D/+5OnY4ydmu4Mk675SwJK1qShePgPaOJHLkaRZrY5mWRBl7NHjwdvqy0PXb049CBxE4at92xNHEFkzntYklt5SxzJhDtQNUyGsUMKLBHFNPRqIxXf2w2ASmuW++eXmTjSKskxLkB0aLseB8Ha3I4NhW+CMbMn2IClqxe/fispb2dzbD5+9gOCoWHSEI7F8XjZMVzSkX+8T0b5UXakL1IfKBxAP3723F4tH6qSjgK7FooYdX+S06iNKOEOrpx+gBQxr4mAS0Kjn7Z49DyqHi2kzxzdPe/YUpW6RZVZTyYXwfpI8o3unpShgo2nPuzZRT09v+WLIYKbN6hDTcsaaojKMwCp/9Pj3Xiz2LwYvCkeNPBj7n8NFjCEuvK0Mim+A5ouIWZtc8RT9leZpk+dphqOERhCP6BHzfHJ5+2SXYCvSp5qBIAoZMmfNOaAwG+p0nfhASGNmLVZNsG3uk83ggxZT4U5dBZ/t2FmgMWD0o23oP/yV+JyiFRaHAAAAAElFTkSuQmCC"},"images":{"fallback":{"src":"/static/ef4819fc74935dd769469ad81e2b06b3/c7240/kubeconfig-cover.png","srcSet":"/static/ef4819fc74935dd769469ad81e2b06b3/c7240/kubeconfig-cover.png 600w","sizes":"100vw"},"sources":[{"srcSet":"/static/ef4819fc74935dd769469ad81e2b06b3/6d09e/kubeconfig-cover.webp 600w","type":"image/webp","sizes":"100vw"}]},"width":1,"height":1}}},"coverCredits":"Photo by Saifeddine Rajhi"}}},"pageContext":{"prevThought":{"frontmatter":{"path":"/blog/aws-eks-open-source-monitoring-stack-guide/","title":"AWS EKS Monitoring Stack: Grafana, Prometheus, AlertManager, Promtail, and Loki","date":"2024-10-19 11:00:00"},"excerpt":"Monitoring AWS EKS with performant open source tools üîñ Introduction Amazon Elastic Kubernetes Service (EKS) is a managed Kubernetes service‚Ä¶","html":"<blockquote>\n<p><strong>Monitoring AWS EKS with performant open source tools</strong></p>\n</blockquote>\n<h2 id=\"-introduction\" style=\"position:relative;\"><a href=\"#-introduction\" aria-label=\" introduction permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üîñ Introduction</h2>\n<p>Amazon Elastic Kubernetes Service (EKS) is a managed Kubernetes service that makes it easy to run Kubernetes on AWS. However, EKS doesn't come with a built-in monitoring solution. This means that you need to set up your own monitoring stack if you want to track the health and performance of your EKS cluster.</p>\n<p>In this article, we will show you how to create a monitoring stack for AWS EKS using <strong>Grafana</strong>, <strong>Prometheus</strong>, <strong>AlertManager</strong>, <strong>Promtail</strong>, and <strong>Loki</strong>. These open source tools provide a comprehensive monitoring solution that can help you track all aspects of your EKS cluster, from metrics to logs.</p>\n<p>We will walk you through the steps of installing and configuring these tools, and we will show you how to create dashboards in Grafana to visualize your data. By the end of this article, you will have a solid understanding of how to monitor your AWS EKS cluster using open source tools.</p>\n<p><span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 60.58823529411765%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAAsTAAALEwEAmpwYAAACGElEQVR42o1SW0/UQBTmB/nsgxp/gG/y6JNvGi9ECEZJjDExPhiNyaIE0GgCSohEBTUYjW5EIqvIqgiuySKIuCyb3W23a2/TaTvz2Zlply364ElPz8y5fD3nO+1ALP7qV5D5LDhx8L/CbRPcsSK1xU36OsTLmhhE9fgBNK72oNbdCWY14wounpS2/MyHM5mBOXQ6stfBqasAxVfKnbvgZB9JhzhbD2+pwjBI6tvAmDTeu7Eorw9efgzOiysINpcVIDMNVA7vgzvzBEFlI+rwIMyoYyksxHzRw8mBOk4NafjygwqnDNHvd+EtXgMjBHRlHLQ4sj2y+WAYRqYP9vQ96BePwm9oMjg1Z2NvTxln7+joGqxjf+8Wsp/VaIFVgr9+AWGtH/7GJYTGx21AuZSfRdDCApggOvaJrnpvash9I5hddnHsRh3nRxuKDUFDWAJ3F8D9tYSPBJC3rY637ocuV2V3cwUiVXR5JFOP01LEprfcAmKKHxbnvS142N21iRMDCmhPdxlL67Qth6fA0oA7/7E4R3B25raOcyONaHQvFfuXSMDVrQC6yaT+qgWwXAYtOleNEJ6vqkWs1gxR0gIYFoNhK63oIepNBpvEIwsz/cHF+GsLUzkHz/MuJnM2nr53kF+h6H/8O1oIweIaxfAzM8qzcf+NjZefCCZm1Xn0lYWZJZIeOeFY0JiMJKwfcBCqHEH497h8h/0DILp1p6X4WIsAAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"Grafana and Prometheus\" title=\"\" src=\"/static/aa73b94cec6b832e7e484005aa23ff4a/c5bb3/gr-prom.png\" srcset=\"/static/aa73b94cec6b832e7e484005aa23ff4a/04472/gr-prom.png 170w,\n/static/aa73b94cec6b832e7e484005aa23ff4a/9f933/gr-prom.png 340w,\n/static/aa73b94cec6b832e7e484005aa23ff4a/c5bb3/gr-prom.png 680w,\n/static/aa73b94cec6b832e7e484005aa23ff4a/5a190/gr-prom.png 800w\" sizes=\"(max-width: 680px) 100vw, 680px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n    </span>\n          </p>\n<h3 id=\"-goals--objectives\" style=\"position:relative;\"><a href=\"#-goals--objectives\" aria-label=\" goals  objectives permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üéØ Goals &#x26; Objectives</h3>\n<p>If you are looking for a comprehensive and cost-effective monitoring solution for your AWS EKS cluster, then this monitoring stack is a great option. So, roll your sleeves and let's get cracking! üî•</p>\n<h3 id=\"-prerequisites\" style=\"position:relative;\"><a href=\"#-prerequisites\" aria-label=\" prerequisites permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üìã Prerequisites</h3>\n<ul>\n<li>Knowledge of Kubernetes.</li>\n<li>AWS EKS cluster.</li>\n<li><a href=\"https://helm.sh/docs/intro/install/\" target=\"_blank\" rel=\"noopener noreferrer\">Helm</a>.</li>\n</ul>\n<h2 id=\"Ô∏è-kube-prometheus-stack-an-effective-way-to-monitor-aws-eks-cluster\" style=\"position:relative;\"><a href=\"#%EF%B8%8F-kube-prometheus-stack-an-effective-way-to-monitor-aws-eks-cluster\" aria-label=\"Ô∏è kube prometheus stack an effective way to monitor aws eks cluster permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üõ†Ô∏è Kube-Prometheus-Stack: An Effective Way to Monitor AWS EKS Cluster</h2>\n<p><a href=\"https://github.com/prometheus-community/helm-charts/tree/main/charts/kube-prometheus-stack\" target=\"_blank\" rel=\"noopener noreferrer\"><strong>Kube-Prometheus-stack</strong></a>, also known as <strong>Prometheus Operator</strong>, is a popular open-source project providing complete monitoring and alerting solutions for Kubernetes clusters. It combines tools and components to create a monitoring stack for Kubernetes environments.</p>\n<p>We will use the official Helm Chart <a href=\"https://artifacthub.io/packages/helm/prometheus-community/kube-prometheus-stack\" target=\"_blank\" rel=\"noopener noreferrer\"><strong>Kube-Prometheus-stack</strong></a>, with a customized value file.</p>\n<h4 id=\"steps-to-deploy-the-monitoring-stack\" style=\"position:relative;\"><a href=\"#steps-to-deploy-the-monitoring-stack\" aria-label=\"steps to deploy the monitoring stack permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Steps to Deploy the Monitoring Stack</h4>\n<ol>\n<li>\n<p><strong>Creating Namespace called monitoring</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"sh\"><pre class=\"language-sh\"><code class=\"language-sh\">kubectl create namespace monitoring</code></pre></div>\n</li>\n<li>\n<p><strong>Add a new Helm Repository</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"sh\"><pre class=\"language-sh\"><code class=\"language-sh\">helm repo <span class=\"token function\">add</span> prometheus-community https://prometheus-community.github.io/helm-charts\nhelm repo update</code></pre></div>\n</li>\n<li>\n<p><strong>Edit the Values</strong></p>\n<p>These settings indicate that the selectors mentioned (rule, service monitor, pod monitor, and scrape config) will have independent configurations and will not be based on Helm graphic values.</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">prometheus</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">enabled</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span>\n  <span class=\"token key atrule\">agentMode</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">false</span>\n  <span class=\"token key atrule\">annotations</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n  <span class=\"token key atrule\">networkPolicy</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">enabled</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">false</span>\n    <span class=\"token key atrule\">flavor</span><span class=\"token punctuation\">:</span> kubernetes\n  <span class=\"token key atrule\">serviceAccount</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">create</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span>\n    <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"\"</span>\n    <span class=\"token key atrule\">annotations</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n  <span class=\"token key atrule\">serviceMonitor</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">interval</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"\"</span>\n    <span class=\"token key atrule\">selfMonitor</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span>\n    <span class=\"token key atrule\">sampleLimit</span><span class=\"token punctuation\">:</span> <span class=\"token number\">0</span>\n    <span class=\"token key atrule\">targetLimit</span><span class=\"token punctuation\">:</span> <span class=\"token number\">0</span>\n    <span class=\"token key atrule\">labelLimit</span><span class=\"token punctuation\">:</span> <span class=\"token number\">0</span>\n    <span class=\"token key atrule\">labelNameLengthLimit</span><span class=\"token punctuation\">:</span> <span class=\"token number\">0</span>\n    <span class=\"token key atrule\">labelValueLengthLimit</span><span class=\"token punctuation\">:</span> <span class=\"token number\">0</span>\n    <span class=\"token key atrule\">scheme</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"\"</span>\n    <span class=\"token key atrule\">tlsConfig</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n    <span class=\"token key atrule\">bearerTokenFile</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">metricRelabelings</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\n    <span class=\"token key atrule\">relabelings</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\n  <span class=\"token key atrule\">prometheusSpec</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">disableCompaction</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">false</span>\n    <span class=\"token key atrule\">enableRemoteWriteReceiver</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">false</span>\n    <span class=\"token key atrule\">replicaExternalLabelName</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"\"</span>\n    <span class=\"token key atrule\">replicaExternalLabelNameClear</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">false</span>\n    <span class=\"token key atrule\">prometheusExternalLabelName</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"\"</span>\n    <span class=\"token key atrule\">prometheusExternalLabelNameClear</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">false</span>\n    <span class=\"token key atrule\">externalUrl</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"\"</span>\n    <span class=\"token key atrule\">nodeSelector</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n    <span class=\"token key atrule\">secrets</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\n    <span class=\"token key atrule\">configMaps</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\n    <span class=\"token key atrule\">query</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n    <span class=\"token key atrule\">ruleNamespaceSelector</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n    <span class=\"token key atrule\">ruleSelectorNilUsesHelmValues</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span>\n    <span class=\"token key atrule\">ruleSelector</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n    <span class=\"token key atrule\">serviceMonitorSelectorNilUsesHelmValues</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span>\n    <span class=\"token key atrule\">serviceMonitorSelector</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n    <span class=\"token key atrule\">serviceMonitorNamespaceSelector</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n    <span class=\"token key atrule\">podMonitorSelectorNilUsesHelmValues</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span>\n    <span class=\"token key atrule\">podMonitorSelector</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n    <span class=\"token key atrule\">podMonitorNamespaceSelector</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n    <span class=\"token key atrule\">probeSelectorNilUsesHelmValues</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span>\n    <span class=\"token key atrule\">probeSelector</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n    <span class=\"token key atrule\">probeNamespaceSelector</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n    <span class=\"token key atrule\">scrapeConfigSelectorNilUsesHelmValues</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span>\n    <span class=\"token key atrule\">scrapeConfigSelector</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n    <span class=\"token key atrule\">scrapeConfigNamespaceSelector</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n    <span class=\"token key atrule\">retention</span><span class=\"token punctuation\">:</span> 10d\n    <span class=\"token key atrule\">retentionSize</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"\"</span>\n    <span class=\"token key atrule\">tsdb</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">outOfOrderTimeWindow</span><span class=\"token punctuation\">:</span> 0s\n    <span class=\"token key atrule\">walCompression</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span>\n    <span class=\"token key atrule\">paused</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">false</span>\n    <span class=\"token key atrule\">replicas</span><span class=\"token punctuation\">:</span> <span class=\"token number\">1</span>\n    <span class=\"token key atrule\">shards</span><span class=\"token punctuation\">:</span> <span class=\"token number\">1</span>\n    <span class=\"token key atrule\">logLevel</span><span class=\"token punctuation\">:</span> info\n    <span class=\"token key atrule\">logFormat</span><span class=\"token punctuation\">:</span> logfmt\n    <span class=\"token key atrule\">routePrefix</span><span class=\"token punctuation\">:</span> /\n    <span class=\"token key atrule\">podMetadata</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n    <span class=\"token key atrule\">podAntiAffinity</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"\"</span>\n    <span class=\"token key atrule\">podAntiAffinityTopologyKey</span><span class=\"token punctuation\">:</span> kubernetes.io/hostname\n    <span class=\"token key atrule\">affinity</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n    <span class=\"token key atrule\">remoteRead</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\n    <span class=\"token key atrule\">additionalRemoteRead</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\n    <span class=\"token key atrule\">remoteWrite</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\n    <span class=\"token key atrule\">additionalRemoteWrite</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\n    <span class=\"token key atrule\">remoteWriteDashboards</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">false</span>\n    <span class=\"token key atrule\">resources</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n    <span class=\"token key atrule\">storageSpec</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n    <span class=\"token key atrule\">volumes</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\n    <span class=\"token key atrule\">volumeMounts</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\n    <span class=\"token key atrule\">additionalScrapeConfigs</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\n    <span class=\"token key atrule\">additionalScrapeConfigsSecret</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n    <span class=\"token key atrule\">additionalPrometheusSecretsAnnotations</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n    <span class=\"token key atrule\">additionalAlertManagerConfigs</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\n    <span class=\"token key atrule\">additionalAlertManagerConfigsSecret</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n    <span class=\"token key atrule\">additionalAlertRelabelConfigs</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\n    <span class=\"token key atrule\">additionalAlertRelabelConfigsSecret</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n    <span class=\"token key atrule\">arbitraryFSAccessThroughSMs</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">false</span>\n    <span class=\"token key atrule\">overrideHonorLabels</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">false</span>\n    <span class=\"token key atrule\">overrideHonorTimestamps</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">false</span>\n    <span class=\"token key atrule\">ignoreNamespaceSelectors</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">false</span>\n    <span class=\"token key atrule\">enforcedNamespaceLabel</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"\"</span>\n    <span class=\"token key atrule\">prometheusRulesExcludedFromEnforce</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\n    <span class=\"token key atrule\">excludedFromEnforcement</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\n    <span class=\"token key atrule\">queryLogFile</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">false</span>\n    <span class=\"token key atrule\">enforcedSampleLimit</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">false</span>\n    <span class=\"token key atrule\">enforcedTargetLimit</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">false</span>\n    <span class=\"token key atrule\">enforcedLabelLimit</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">false</span>\n    <span class=\"token key atrule\">enforcedLabelNameLengthLimit</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">false</span>\n    <span class=\"token key atrule\">enforcedLabelValueLengthLimit</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">false</span>\n    <span class=\"token key atrule\">allowOverlappingBlocks</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">false</span>\n    <span class=\"token key atrule\">minReadySeconds</span><span class=\"token punctuation\">:</span> <span class=\"token number\">0</span>\n    <span class=\"token key atrule\">hostNetwork</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">false</span>\n    <span class=\"token key atrule\">hostAliases</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\n    <span class=\"token key atrule\">tracingConfig</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span></code></pre></div>\n</li>\n<li>\n<p><strong>Run the Helm Deployment Command</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"sh\"><pre class=\"language-sh\"><code class=\"language-sh\">helm upgrade <span class=\"token parameter variable\">--install</span> <span class=\"token parameter variable\">-f</span> values.yaml kube-prometheus-stack prometheus-community/kube-prometheus-stack <span class=\"token parameter variable\">-n</span> monitoring</code></pre></div>\n</li>\n</ol>\n<p>After we deploy the Kube-Prometheus stack, we get:</p>\n<ul>\n<li><strong>Grafana</strong></li>\n<li><strong>Prometheus</strong></li>\n<li><strong>AlertManager</strong></li>\n</ul>\n<h2 id=\"-testing\" style=\"position:relative;\"><a href=\"#-testing\" aria-label=\" testing permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üß™ Testing</h2>\n<p>To check if everything is working, you can use the following commands:</p>\n<h3 id=\"prometheus-dashboard\" style=\"position:relative;\"><a href=\"#prometheus-dashboard\" aria-label=\"prometheus dashboard permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Prometheus Dashboard</h3>\n<div class=\"gatsby-highlight\" data-language=\"sh\"><pre class=\"language-sh\"><code class=\"language-sh\">kubectl port-forward svc/prometheus-operated <span class=\"token number\">9090</span>:9090 <span class=\"token parameter variable\">-n</span> monitoring</code></pre></div>\n<p>You can access the Prometheus dashboard at <a href=\"http://localhost:9090\" target=\"_blank\" rel=\"noopener noreferrer\">http://localhost:9090</a>.</p>\n<h3 id=\"grafana-dashboard\" style=\"position:relative;\"><a href=\"#grafana-dashboard\" aria-label=\"grafana dashboard permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Grafana Dashboard</h3>\n<div class=\"gatsby-highlight\" data-language=\"sh\"><pre class=\"language-sh\"><code class=\"language-sh\">kubectl port-forward svc/kube-prometheus-stack-grafana <span class=\"token number\">3000</span>:3000 <span class=\"token parameter variable\">-n</span> monitoring</code></pre></div>\n<p>You can access the Grafana dashboard at <a href=\"http://localhost:3000\" target=\"_blank\" rel=\"noopener noreferrer\">http://localhost:3000</a>.</p>\n<h3 id=\"check-running-pods\" style=\"position:relative;\"><a href=\"#check-running-pods\" aria-label=\"check running pods permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Check Running Pods</h3>\n<p>To ensure all pods are running, use the following command:</p>\n<div class=\"gatsby-highlight\" data-language=\"sh\"><pre class=\"language-sh\"><code class=\"language-sh\">kubectl get pods <span class=\"token parameter variable\">--namespace</span> monitoring</code></pre></div>\n<h2 id=\"Ô∏è-create-a-servicemonitor\" style=\"position:relative;\"><a href=\"#%EF%B8%8F-create-a-servicemonitor\" aria-label=\"Ô∏è create a servicemonitor permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üõ°Ô∏è Create a ServiceMonitor</h2>\n<p>Prometheus Operator uses ServiceMonitors to auto-detect target pods based on label selectors and associate them with Prometheus instances. The ServiceMonitor defines an application that scrapes metrics from Kubernetes.</p>\n<p>Below is an example manifest for a ServiceMonitor:</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> monitoring.coreos.com/v1\n<span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> ServiceMonitor\n<span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> prometheus<span class=\"token punctuation\">-</span>self\n    <span class=\"token key atrule\">labels</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">app</span><span class=\"token punctuation\">:</span> kube<span class=\"token punctuation\">-</span>prometheus<span class=\"token punctuation\">-</span>stack<span class=\"token punctuation\">-</span>prometheus\n<span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">endpoints</span><span class=\"token punctuation\">:</span>\n        <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">interval</span><span class=\"token punctuation\">:</span> 30s\n            <span class=\"token key atrule\">port</span><span class=\"token punctuation\">:</span> web\n    <span class=\"token key atrule\">selector</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">matchLabels</span><span class=\"token punctuation\">:</span>\n            <span class=\"token key atrule\">app</span><span class=\"token punctuation\">:</span> kube<span class=\"token punctuation\">-</span>prometheus<span class=\"token punctuation\">-</span>stack<span class=\"token punctuation\">-</span>prometheus</code></pre></div>\n<p>The ServiceMonitor defined above will select pods labeled <code class=\"language-text\">app: kube-prometheus-stack-prometheus</code> using the <code class=\"language-text\">spec.selector.matchLabels</code> field.</p>\n<p>To apply the ServiceMonitor manifest, run the following command:</p>\n<div class=\"gatsby-highlight\" data-language=\"sh\"><pre class=\"language-sh\"><code class=\"language-sh\">kubectl apply <span class=\"token parameter variable\">-f</span> servicemonitor.yaml <span class=\"token parameter variable\">-n</span> monitoring</code></pre></div>\n<h2 id=\"-integration-of-promtail-and-loki-to-grafana\" style=\"position:relative;\"><a href=\"#-integration-of-promtail-and-loki-to-grafana\" aria-label=\" integration of promtail and loki to grafana permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üîó Integration of Promtail and Loki to Grafana</h2>\n<p>Promtail is a log agent that ships logs to Loki, a horizontally scalable, highly available, and efficient log store. Loki can be integrated with Grafana to create dashboards that visualize your logs and metrics. This integration provides a powerful way to monitor your applications and infrastructure.</p>\n<h3 id=\"-intro-to-loki\" style=\"position:relative;\"><a href=\"#-intro-to-loki\" aria-label=\" intro to loki permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üìú Intro to Loki</h3>\n<p>Loki uses Promtail as its primary log collector, but it can also accept log flows from other sources, such as Syslog or other log senders. It offers high uptime and supports data replication across multiple replicas for durability and fault tolerance. Loki is tightly integrated with Grafana, allowing you to visualize log metrics. Think of Loki as Prometheus, but for logs.</p>\n<p><span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 76.47058823529412%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAAAsTAAALEwEAmpwYAAADdUlEQVR42mWU628bRRTF/e+CBF8ACcQHEFVbqUICJKo0rXgVNVHURiGpQnDtJjFpHk7qJk1iZ9cOjh3ba3tt79P79No/rh2KkFjt1WhGc88998yZSflRQtQpE3XLxMmEOIro6F1KRYVOp0s8ivF9n9FoJOsdTkundPU+kewLAh/b9bEcH8P2cJwhqa4+oF4uoJVW0bQmQ3dIGHp4TZfQ9WaAYRhKoRHDwMLw20yigGQUMnBCDst99ksa+0oXteWS0rQ2aqXCVa1GvV7HtXWG6iO65/M4pe8IWgeEY4hNFav8s6w/4uz0T5o9n54V8LI44OVbjRcnbY7+ckglo4hkPJEYIz+RsNGP52hlvkDPfUzQyDFCAK0GtZ1PUbc/oJi5zUBv0HNGLLxqMP+HytyGyquLAalCpYfVVPDb5/i9Cn4grTp1olaVhmbSsGPisSd6GfiGytA4o9lsYg+lsBnyNN/hl61Lfty6Yle1SC1tlqg++5zW0nuUsu/T9lTs46/Q9z6S+SdUStuEwtDs5+m//oze0Yesri9SvDKwhjHLeY2FnTq/5mrsqYZo2OnRLebQzzcZXOZxIpvWdQb9dB3nZJ3EqTERwHEcodXT6NU1asprbMdFtyKy5wNywixTNDi8FIZxFBJJRjTVaTJhFIuNZLRlxfUTEp/Z5098/NkuZgWYjOlKy0sHGj9kFObTCruKScrzPHxvSOB7hOKrqb9G0xBG/tjBsU28oYs3sYXmhHEimsaxjCMBDLifrXN7rcKtlTLZsz6pqWmnEQTBjd/im4QkGWN5Axpmlau+Stu5pu90bgqKyRMBNNxItLvi69ULvnmucFAe/MPwP4DThEhkQCxUqO+ycvyYjZNnPH+7wPbF71iWPQOMpWBoNNDVAzpKHl05wGld/B/wXZDAcX2PxcM5FvcfsnT08AbQtGZyiNTi0QKDwydoh8v08osMlTSpoeg3jX9Bg5AgDJhIQqG2x3LhJ1aPnvDbm8fkLjaEoTW77/IE4FV3MV/coZu+xyB9B/fkKSnTM+T424Q9ubOxgAmgL4czZbijprm/eYuH2Xs82LrL2psFTMOU2xQQiSTu+Tp2+ks62w8wM3exd+dIdbwmvW6XftWgdl3Dtu0Zw+lj0NBrbEpS+nRFTnCNS02RDiIJ6UR6dmWub31Pa3OOdvZbTCXH3+D1Qwt2M2GrAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"Promtail\" title=\"\" src=\"/static/e34799ae75e169ae345722b568a24cc9/c5bb3/promtail.png\" srcset=\"/static/e34799ae75e169ae345722b568a24cc9/04472/promtail.png 170w,\n/static/e34799ae75e169ae345722b568a24cc9/9f933/promtail.png 340w,\n/static/e34799ae75e169ae345722b568a24cc9/c5bb3/promtail.png 680w,\n/static/e34799ae75e169ae345722b568a24cc9/f8067/promtail.png 726w\" sizes=\"(max-width: 680px) 100vw, 680px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n    </span>\n          </p>\n<h3 id=\"-add-a-new-helm-repository\" style=\"position:relative;\"><a href=\"#-add-a-new-helm-repository\" aria-label=\" add a new helm repository permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üì• Add a New Helm Repository</h3>\n<div class=\"gatsby-highlight\" data-language=\"sh\"><pre class=\"language-sh\"><code class=\"language-sh\">helm repo <span class=\"token function\">add</span> grafana https://grafana.github.io/helm-charts\nhelm repo update</code></pre></div>\n<h3 id=\"-run-the-helm-deployment-command\" style=\"position:relative;\"><a href=\"#-run-the-helm-deployment-command\" aria-label=\" run the helm deployment command permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üöÄ Run the Helm Deployment Command</h3>\n<div class=\"gatsby-highlight\" data-language=\"sh\"><pre class=\"language-sh\"><code class=\"language-sh\">helm upgrade <span class=\"token parameter variable\">--install</span> loki grafana/loki-distributed <span class=\"token parameter variable\">-n</span> monitoring</code></pre></div>\n<p>After deploying Loki, update the Kube-Prometheus-stack values file to add additional data sources. This configuration defines a default additional data source that connects to a Loki log aggregation system. It specifies the URL for accessing Loki and sets the access method to the proxy.</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">grafana</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">additionalDataSources</span><span class=\"token punctuation\">:</span>\n        <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Loki\n            <span class=\"token key atrule\">type</span><span class=\"token punctuation\">:</span> loki\n            <span class=\"token key atrule\">url</span><span class=\"token punctuation\">:</span> http<span class=\"token punctuation\">:</span>//loki<span class=\"token punctuation\">-</span>loki<span class=\"token punctuation\">-</span>distributed<span class=\"token punctuation\">-</span>gateway.monitoring.svc.cluster.local\n            <span class=\"token key atrule\">access</span><span class=\"token punctuation\">:</span> proxy</code></pre></div>\n<p>Please refer to the <a href=\"https://github.com/grafana/helm-charts\" target=\"_blank\" rel=\"noopener noreferrer\">Helm values</a> for more details.</p>\n<h3 id=\"-intro-to-promtail\" style=\"position:relative;\"><a href=\"#-intro-to-promtail\" aria-label=\" intro to promtail permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üìú Intro to Promtail</h3>\n<p>Promtail can log files from different sources, including local files, container output streams (stdout and stderr), and systemd journals. It supports the development, filtering, and relabeling of logs before sending them to Loki.</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">clients</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">url</span><span class=\"token punctuation\">:</span> http<span class=\"token punctuation\">:</span>//loki<span class=\"token punctuation\">-</span>loki<span class=\"token punctuation\">-</span>distributed<span class=\"token punctuation\">-</span>gateway.monitoring.svc.cluster.local/loki/api/v1/push</code></pre></div>\n<p>Please refer to the <a href=\"https://github.com/grafana/helm-charts\" target=\"_blank\" rel=\"noopener noreferrer\">Helm values</a> for more details.</p>\n<h3 id=\"-run-the-helm-upgrade-command\" style=\"position:relative;\"><a href=\"#-run-the-helm-upgrade-command\" aria-label=\" run the helm upgrade command permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üöÄ Run the Helm Upgrade Command</h3>\n<div class=\"gatsby-highlight\" data-language=\"sh\"><pre class=\"language-sh\"><code class=\"language-sh\">helm upgrade <span class=\"token parameter variable\">--install</span> <span class=\"token parameter variable\">-f</span> promtail.yaml promtail grafana/promtail <span class=\"token parameter variable\">-n</span> monitoring</code></pre></div>\n<p>After deploying Promtail and Loki, two new data sources will be presented to Grafana.</p>\n<h3 id=\"-access-grafana\" style=\"position:relative;\"><a href=\"#-access-grafana\" aria-label=\" access grafana permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üîç Access Grafana</h3>\n<p>Run the following command to port-forward Grafana:</p>\n<div class=\"gatsby-highlight\" data-language=\"sh\"><pre class=\"language-sh\"><code class=\"language-sh\">kubectl port-forward svc/kube-prometheus-stack-grafana <span class=\"token number\">3000</span>:3000 <span class=\"token parameter variable\">-n</span> monitoring</code></pre></div>\n<p>Connect to Grafana by navigating to <a href=\"http://localhost:3000\" target=\"_blank\" rel=\"noopener noreferrer\">http://localhost:3000</a>, then go to <strong>Menu -> Data Sources</strong> to add the new data sources.</p>\n<h3 id=\"-summary\" style=\"position:relative;\"><a href=\"#-summary\" aria-label=\" summary permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üìù Summary</h3>\n<p>Setting up a monitoring stack for Kubernetes is a complex task, but it is essential for ensuring the health and performance of your applications. The steps outlined in this article provide a good starting point, but they are just the beginning. In most cases, workloads will not be limited to Kubernetes pods and containers. There will also be a need to monitor virtual machines and other infrastructure components. A unified logging mechanism based on the same tools is essential for getting a complete view of your system.</p>\n<br>\n<p><strong><em>Until next time, „Å§„Å•„Åè üéâ</em></strong></p>\n<blockquote>\n<p>üí° Thank you for Reading !! üôåüèªüòÅüìÉ, see you in the next blog.ü§ò  <strong><em>Until next time üéâ</em></strong></p>\n</blockquote>\n<p>üöÄ Thank you for sticking up till the end. If you have any questions/feedback regarding this blog feel free to connect with me:</p>\n<p><strong>‚ôªÔ∏è LinkedIn:</strong> <a href=\"https://www.linkedin.com/in/rajhi-saif/\" target=\"_blank\" rel=\"noopener noreferrer\">https://www.linkedin.com/in/rajhi-saif/</a></p>\n<p><strong>‚ôªÔ∏è X/Twitter:</strong> <a href=\"https://x.com/rajhisaifeddine\" target=\"_blank\" rel=\"noopener noreferrer\">https://x.com/rajhisaifeddine</a></p>\n<p><strong>The end ‚úåüèª</strong></p>\n<h1 align=\"center\">üî∞ Keep Learning !! Keep Sharing !! üî∞</h1>\n<p><strong>üìÖ Stay updated</strong></p>\n<p>Subscribe to our newsletter for more insights on AWS cloud computing and containers.</p>"},"nextThought":{"frontmatter":{"path":"/blog/eks-aws-cloudwatch-container-insights/","title":"Casting light on EKS: exploring AWS CloudWatch Container Insights for kubernetes cluster metrics and logs aggregation","date":"2024-10-18 20:06:00"},"excerpt":"Proactive EKS cluster monitoring üîñ Introduction Kubernetes on AWS is a great managed container orchestration platform, but it can be‚Ä¶","html":"<blockquote>\n<p><strong>Proactive EKS cluster monitoring</strong></p>\n</blockquote>\n<h2 id=\"-introduction\" style=\"position:relative;\"><a href=\"#-introduction\" aria-label=\" introduction permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üîñ Introduction</h2>\n<p><a href=\"https://kubernetes.io/\" target=\"_blank\" rel=\"noopener noreferrer\">Kubernetes</a> on AWS is a great managed container orchestration platform, but it can be difficult to monitor. <a href=\"https://docs.aws.amazon.com/AmazonCloudWatch/latest/monitoring/ContainerInsights.html\" target=\"_blank\" rel=\"noopener noreferrer\">AWS CloudWatch Container Insights</a> makes it easy to collect, aggregate, and summarize metrics and logs from your EKS cluster. This data can be used to identify performance bottlenecks, troubleshoot problems, and ensure that your cluster is running smoothly.</p>\n<p>In this blog post, we will explore AWS CloudWatch Container Insights and show you how to use it to gain insight into your EKS cluster. By the end of this blog post, you will have a comprehensive understanding of how to use CloudWatch Container Insights to monitor your EKS cluster. You will be able to collect metrics and logs, create dashboards and alarms, and troubleshoot problems. This will help you to keep your cluster running smoothly and avoid downtime.</p>\n<p>So what are you waiting for? Start reading today!</p>\n<p><span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 5.88235294117647%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAABCAYAAADeko4lAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAL0lEQVR42mNgwAFUzP7xyVr9l5Iy+S8roPlfnl//v4K02T8ZOdv/ksJW/3lx6QMAwg0LLHUaEagAAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"Monitoring\" title=\"\" src=\"/static/201da0cff341d7b74e255a314ac9c455/c5bb3/separe.png\" srcset=\"/static/201da0cff341d7b74e255a314ac9c455/04472/separe.png 170w,\n/static/201da0cff341d7b74e255a314ac9c455/9f933/separe.png 340w,\n/static/201da0cff341d7b74e255a314ac9c455/c5bb3/separe.png 680w,\n/static/201da0cff341d7b74e255a314ac9c455/8c557/separe.png 700w\" sizes=\"(max-width: 680px) 100vw, 680px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n    </span>\n          </p>\n<br>\n<div style=\"width:100%;height:0;padding-bottom:99%;position:relative;\"><iframe src=\"https://giphy.com/embed/htwABV5tJsqDm\" width=\"100%\" height=\"100%\" style=\"position:absolute\" frameborder=\"0\" class=\"giphy-embed\" allowfullscreen></iframe></div>\n<h2 id=\"-explore-aws-cloudwatch-container-insights\" style=\"position:relative;\"><a href=\"#-explore-aws-cloudwatch-container-insights\" aria-label=\" explore aws cloudwatch container insights permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üåü Explore AWS CloudWatch Container Insights</h2>\n<p><strong>CloudWatch Container Insights</strong> is a feature-rich service that offers comprehensive monitoring for containerized applications and microservices.</p>\n<p>Available for <a href=\"https://aws.amazon.com/ecs/\" target=\"_blank\" rel=\"noopener noreferrer\">Amazon ECS</a>, <a href=\"https://aws.amazon.com/eks/\" target=\"_blank\" rel=\"noopener noreferrer\">Amazon EKS</a>, and <a href=\"https://aws.amazon.com/ec2/\" target=\"_blank\" rel=\"noopener noreferrer\">Kubernetes on Amazon EC2</a>, it automatically collects metrics, including CPU, memory, disk, and network usage, while providing diagnostic data for issue resolution.</p>\n<p>The service employs performance log events with structured JSON schema, generating aggregated metrics at various levels for easy visualization.</p>\n<p>Container Insights supports encryption with <a href=\"https://aws.amazon.com/kms/\" target=\"_blank\" rel=\"noopener noreferrer\">AWS KMS</a> key and uses a containerized CloudWatch agent for efficient performance data collection in Amazon EKS and Kubernetes environments.</p>\n<h2 id=\"Ô∏è-configuring-container-insights-on-amazon-eks-and-kubernetes\" style=\"position:relative;\"><a href=\"#%EF%B8%8F-configuring-container-insights-on-amazon-eks-and-kubernetes\" aria-label=\"Ô∏è configuring container insights on amazon eks and kubernetes permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>‚öôÔ∏è Configuring Container Insights on Amazon EKS and Kubernetes</h2>\n<p>To set up <strong>Container Insights</strong> on Amazon EKS or Kubernetes, you need to meet certain prerequisites. The support for Container Insights begins with Amazon EKS versions 1.23 and later, while the quick start method is available from versions 1.24 and later.</p>\n<h3 id=\"Ô∏è-setup-process\" style=\"position:relative;\"><a href=\"#%EF%B8%8F-setup-process\" aria-label=\"Ô∏è setup process permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üõ†Ô∏è Setup Process</h3>\n<p>The setup process involves the following steps:</p>\n<ol>\n<li><strong>Verify Prerequisites</strong>: Ensure compatibility and smooth installation.</li>\n<li><strong>Install and Configure</strong>:\n<ul>\n<li>Install and configure the <a href=\"https://docs.aws.amazon.com/AmazonCloudWatch/latest/monitoring/ContainerInsights.html\" target=\"_blank\" rel=\"noopener noreferrer\">CloudWatch agent</a> or the <a href=\"https://aws.amazon.com/otel/\" target=\"_blank\" rel=\"noopener noreferrer\">AWS Distro for OpenTelemetry</a> as a DaemonSet on your cluster. This will enable the transmission of metrics to CloudWatch.</li>\n</ul>\n</li>\n<li><strong>Implement Logging</strong>:\n<ul>\n<li>Implement <a href=\"https://fluentbit.io/\" target=\"_blank\" rel=\"noopener noreferrer\">Fluent Bit</a> or <a href=\"https://www.fluentd.org/\" target=\"_blank\" rel=\"noopener noreferrer\">Fluentd</a> to send logs to CloudWatch Logs for centralized log monitoring.</li>\n</ul>\n</li>\n</ol>\n<p>You have the option to perform these steps together as part of the quick start setup when using the CloudWatch agent, or you can choose to perform them separately.</p>\n<h3 id=\"-optional-steps\" style=\"position:relative;\"><a href=\"#-optional-steps\" aria-label=\" optional steps permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üîß Optional Steps</h3>\n<p>Additionally, there are optional steps you may consider:</p>\n<ul>\n<li><strong>EKS Control Plane Logging</strong>: Set up Amazon EKS control plane logging for further insights into the cluster.</li>\n<li><strong>StatsD Endpoint</strong>: Enable the CloudWatch agent as a StatsD endpoint on the cluster, allowing you to send StatsD metrics to CloudWatch.</li>\n<li><strong>App Mesh Logging</strong>: If using <a href=\"https://aws.amazon.com/app-mesh/\" target=\"_blank\" rel=\"noopener noreferrer\">App Mesh</a>, enable App Mesh Envoy Access Logs for enhanced monitoring.</li>\n</ul>\n<h3 id=\"-prerequisites\" style=\"position:relative;\"><a href=\"#-prerequisites\" aria-label=\" prerequisites permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üìã Prerequisites</h3>\n<p>Before installing Container Insights on Amazon EKS or Kubernetes, ensure the following prerequisites are met:</p>\n<ul>\n<li><strong>Functional Cluster</strong>: You have a fully operational Amazon EKS or Kubernetes cluster with attached nodes in a supported Region. Check the list of <a href=\"https://aws.amazon.com/about-aws/global-infrastructure/regional-product-services/\" target=\"_blank\" rel=\"noopener noreferrer\">supported Regions</a>.</li>\n<li><strong>kubectl Installed</strong>: Ensure that you have <a href=\"https://kubernetes.io/docs/tasks/tools/\" target=\"_blank\" rel=\"noopener noreferrer\">kubectl</a> installed and running on your system.</li>\n</ul>\n<p>Additional prerequisites for Kubernetes running on AWS (not using Amazon EKS):</p>\n<ul>\n<li><strong>Role-Based Access Control (RBAC)</strong>: Make sure your Kubernetes cluster has enabled RBAC for authorization.</li>\n<li><strong>Webhook Authorization Mode</strong>: Ensure that the kubelet has enabled Webhook authorization mode.</li>\n<li><strong>Docker Container Runtime</strong>.</li>\n</ul>\n<h3 id=\"-iam-permissions\" style=\"position:relative;\"><a href=\"#-iam-permissions\" aria-label=\" iam permissions permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üîë IAM Permissions</h3>\n<p>To enable your Amazon EKS worker nodes to send metrics and logs to CloudWatch, you need to grant IAM permissions. There are two methods to do this:</p>\n<ol>\n<li><strong>Attach a Policy to the IAM Role</strong>: Attach a policy to the IAM role of your worker nodes. This applies to both Amazon EKS clusters and other Kubernetes clusters.</li>\n<li><strong>Use an IAM Role for Service Accounts</strong>: Use an IAM role for service accounts for the cluster and attach the policy to this role. This method is exclusive to Amazon EKS clusters.</li>\n</ol>\n<p>The first option grants CloudWatch permissions for the entire node, while the second option gives CloudWatch access only to the appropriate daemonset pods.</p>\n<h3 id=\"Ô∏è-using-iam-service-account-role-on-amazon-eks\" style=\"position:relative;\"><a href=\"#%EF%B8%8F-using-iam-service-account-role-on-amazon-eks\" aria-label=\"Ô∏è using iam service account role on amazon eks permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üõ°Ô∏è Using IAM Service Account Role on Amazon EKS</h3>\n<p>If you choose to use an IAM service account role on an Amazon EKS cluster:</p>\n<ol>\n<li><strong>Enable IAM Roles for Service Accounts</strong>: Enable IAM roles for service accounts on your cluster.</li>\n<li><strong>Configure the Service Account</strong>: Configure the service account to use an IAM role.</li>\n<li><strong>Attach Policies</strong>: When creating the role, attach the <code class=\"language-text\">CloudWatchAgentServerPolicy</code> IAM policy in addition to any other policies you create for the role. Ensure the Kubernetes Service Account associated with this role is created in the <code class=\"language-text\">amazon-cloudwatch</code> namespace, where the CloudWatch and Fluent Bit daemonsets will be deployed in the subsequent steps.</li>\n<li><strong>Associate IAM Role</strong>: Finally, associate the IAM role with the service account in your cluster.</li>\n</ol>\n<p>Following these prerequisites will ensure a successful installation and setup of Container Insights on your Amazon EKS or Kubernetes cluster.</p>\n<h2 id=\"cloudwatch-container-insights-for-amazon-eks-clusters\" style=\"position:relative;\"><a href=\"#cloudwatch-container-insights-for-amazon-eks-clusters\" aria-label=\"cloudwatch container insights for amazon eks clusters permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>CloudWatch Container Insights for Amazon EKS Clusters</h2>\n<p>Monitoring performance metrics is always a challenge for containerized applications and microservices. When using Amazon EKS, you can use CloudWatch Container Insights for collecting, aggregating, and summarizing metrics and logs from your Kubernetes clusters.</p>\n<p>Amazon CloudWatch is a monitoring service that monitors your AWS resources and applications in real-time. You can create custom dashboards to display custom metrics that you define. Also, you can create alarms that watch those metrics and send notifications when a threshold is reached.</p>\n<p>CloudWatch Container Insights is a feature in CloudWatch that allows you to monitor your containerized applications. You can use Container Insights when using ECS (Elastic Container Service), EKS (Elastic Kubernetes Service), Kubernetes on EC2 and Fargate. CloudWatch automatically watches CPU, Memory, Disk, and Network metrics. With Container Insights, you can also collect diagnostic information from containers such as container failures, the total number of container restarts, and many more from your Kubernetes clusters.</p>\n<p>To enable Container Insights on your EKS Clusters, you need to set up CloudWatch agent as a daemonset on your cluster to send metrics to Cloudwatch, and you need to deploy FluentD as a daemonset to send logs to CloudWatch Logs.</p>\n<p>We have an example EKS Cluster set up with three EC2 Worker Nodes.</p>\n<p><span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 34.11764705882353%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAIAAACHqfpvAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA7UlEQVR42nWRS07EMAyGc3wOw5oDsOMCaGDDYjpVM83LeTnJVIU/rVrNBstyPyV2/NsV31+X4Tb6EKxzjgjwnztPt3mYlLUfr+7thT7fhZGjVHrWepJ3Oc/Uk/yz05P7EJGADtSfi2KUd58yl1Jqra0hblB36Iy4W618AEJMSWhjAr45cdkze0HK3cDMjMvt2QY+gfdi8rG2R+k922MzXFtHIcZlWZCEPaAG5xCdmQEYHtLQQFxNGQz/zGl0/HvYNMmUEmBd1/NQKezKAgZ3zQ26mtA+2ZA19XjOic13tVB4DAnu/8J7gCKVGJPmP+h5j+wimln0AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"Alt text\" title=\"\" src=\"/static/1dce639329a8efba907e13c97a5fcb6f/c5bb3/eks-nodes.png\" srcset=\"/static/1dce639329a8efba907e13c97a5fcb6f/04472/eks-nodes.png 170w,\n/static/1dce639329a8efba907e13c97a5fcb6f/9f933/eks-nodes.png 340w,\n/static/1dce639329a8efba907e13c97a5fcb6f/c5bb3/eks-nodes.png 680w,\n/static/1dce639329a8efba907e13c97a5fcb6f/5a190/eks-nodes.png 800w\" sizes=\"(max-width: 680px) 100vw, 680px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n    </span>\n          </p>\n<p>We will attach an IAM Policy to nodes' IAM Role for enabling the Worker Nodes to send metric data to CloudWatch.</p>\n<p><span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 27.647058823529413%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAIAAABM9SnKAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA4ElEQVR42mWP60rEMBCF8/5vID6F+Et8ghUEf7vadm0u26S59WKaSbJ16OJC2Y/DMHPIhDPEi+/gFaNtXddCCMYYVs651horjjHGdV0ve9BAkZfD5+vbsfrhvVKq76WU0zTlnEspKSUA2J7uSPkSoCxQyOPzx8PTe8PNupYIgFo2Qgi3ZhxH/PHfDMZNbeeZ9GTWVNBTyyU9K37urTWbdlQbXdddR+fs4J3RPVlsW1F1FPMXH09yNkMsd+AtTdPgMp5wdbDBFCT9OusnPUQ7Rkg55fvdgrGNMZj85uAyAPwBgTtUKITGUqMAAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"M\" title=\"\" src=\"/static/7f3e084e7b7fc880f9c1acc7eea1dc57/c5bb3/policy.png\" srcset=\"/static/7f3e084e7b7fc880f9c1acc7eea1dc57/04472/policy.png 170w,\n/static/7f3e084e7b7fc880f9c1acc7eea1dc57/9f933/policy.png 340w,\n/static/7f3e084e7b7fc880f9c1acc7eea1dc57/c5bb3/policy.png 680w,\n/static/7f3e084e7b7fc880f9c1acc7eea1dc57/5a190/policy.png 800w\" sizes=\"(max-width: 680px) 100vw, 680px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n    </span>\n          </p>\n<div class=\"image-title\"><a href=\"https://www.xenonstack.com/blog/generative-ai-platform\">Default Policies on Worker Node IAM Role</a></div>\n<p><span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 12.941176470588234%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAIAAAAcOLh5AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAcElEQVR42mWLUQqAIBBEvf8B60MhFLO2bFNDS1Joq6/oMczOwCwbweJip5d5DiGklLz3T/tgH95ALqVkTdNy0UnVk4wxAEBvMMLwQwihlNJac85pSYGtiLAm63fcjlLKWU7SfX845xAx5xxjpFprvQDpUaa5KZYL3QAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"M\" title=\"\" src=\"/static/acce2b847c56e63777cc2a62499662e7/c5bb3/agent-policy.png\" srcset=\"/static/acce2b847c56e63777cc2a62499662e7/04472/agent-policy.png 170w,\n/static/acce2b847c56e63777cc2a62499662e7/9f933/agent-policy.png 340w,\n/static/acce2b847c56e63777cc2a62499662e7/c5bb3/agent-policy.png 680w,\n/static/acce2b847c56e63777cc2a62499662e7/5a190/agent-policy.png 800w\" sizes=\"(max-width: 680px) 100vw, 680px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n    </span>\n          </p>\n<div class=\"image-title\"><a href=\"https://www.xenonstack.com/blog/generative-ai-platform\">CloudWatch agent policy</a></div>\n<h3 id=\"instructions-for-the-quick-start-setup-of-container-insights-on-amazon-eks-and-kubernetes\" style=\"position:relative;\"><a href=\"#instructions-for-the-quick-start-setup-of-container-insights-on-amazon-eks-and-kubernetes\" aria-label=\"instructions for the quick start setup of container insights on amazon eks and kubernetes permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Instructions for the Quick Start setup of Container Insights on Amazon EKS and Kubernetes</h3>\n<p>To quickly set up Container Insights, you can follow the instructions provided in this section. There are two configurations available for Fluent Bit: an optimized version and a version similar to Fluentd. The Quick Start configuration utilizes the optimized version. For more details about the Fluentd-compatible setup, refer to the guide on setting up Fluent Bit as a DaemonSet to send logs to CloudWatch Logs.</p>\n<p>To deploy Container Insights using the Quick Start method, execute the following command:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token assign-left variable\">ClusterName</span><span class=\"token operator\">=</span><span class=\"token operator\">&lt;</span>my-cluster-name<span class=\"token operator\">></span>\n<span class=\"token assign-left variable\">RegionName</span><span class=\"token operator\">=</span><span class=\"token operator\">&lt;</span>my-cluster-region<span class=\"token operator\">></span>\n<span class=\"token assign-left variable\">FluentBitHttpPort</span><span class=\"token operator\">=</span><span class=\"token string\">'2020'</span>\n<span class=\"token assign-left variable\">FluentBitReadFromHead</span><span class=\"token operator\">=</span><span class=\"token string\">'Off'</span>\n<span class=\"token punctuation\">[</span><span class=\"token punctuation\">[</span> <span class=\"token variable\">${FluentBitReadFromHead}</span> <span class=\"token operator\">=</span> <span class=\"token string\">'On'</span> <span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">&amp;&amp;</span> <span class=\"token assign-left variable\">FluentBitReadFromTail</span><span class=\"token operator\">=</span><span class=\"token string\">'Off'</span> <span class=\"token operator\">||</span> <span class=\"token assign-left variable\">FluentBitReadFromTail</span><span class=\"token operator\">=</span><span class=\"token string\">'On'</span>\n<span class=\"token punctuation\">[</span><span class=\"token punctuation\">[</span> <span class=\"token parameter variable\">-z</span> <span class=\"token variable\">${FluentBitHttpPort}</span> <span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">&amp;&amp;</span> <span class=\"token assign-left variable\">FluentBitHttpServer</span><span class=\"token operator\">=</span><span class=\"token string\">'Off'</span> <span class=\"token operator\">||</span> <span class=\"token assign-left variable\">FluentBitHttpServer</span><span class=\"token operator\">=</span><span class=\"token string\">'On'</span>\n<span class=\"token function\">curl</span> https://raw.githubusercontent.com/aws-samples/amazon-cloudwatch-container-insights/latest/k8s-deployment-manifest-templates/deployment-mode/daemonset/container-insights-monitoring/quickstart/cwagent-fluent-bit-quickstart.yaml <span class=\"token operator\">|</span> <span class=\"token function\">sed</span> <span class=\"token string\">'s/{{cluster_name}}/'</span><span class=\"token variable\">${ClusterName}</span><span class=\"token string\">'/;s/{{region_name}}/'</span><span class=\"token variable\">${RegionName}</span><span class=\"token string\">'/;s/{{http_server_toggle}}/\"'</span><span class=\"token variable\">${FluentBitHttpServer}</span><span class=\"token string\">'\"/;s/{{http_server_port}}/\"'</span><span class=\"token variable\">${FluentBitHttpPort}</span><span class=\"token string\">'\"/;s/{{read_from_head}}/\"'</span><span class=\"token variable\">${FluentBitReadFromHead}</span><span class=\"token string\">'\"/;s/{{read_from_tail}}/\"'</span><span class=\"token variable\">${FluentBitReadFromTail}</span><span class=\"token string\">'\"/'</span> <span class=\"token operator\">|</span> kubectl apply <span class=\"token parameter variable\">-f</span> -</code></pre></div>\n<p>Replace <code class=\"language-text\">&lt;my-cluster-name></code> with the name of your Amazon EKS or Kubernetes cluster, and <code class=\"language-text\">&lt;my-cluster-region></code> with the name of the Region where the logs are published. It is recommended to use the same Region where your cluster is deployed to minimize AWS outbound data transfer costs.</p>\n<p>Now, go to the CloudWatch dashboard under <strong>Insights</strong>, click on <strong>Container Insights</strong>.</p>\n<p><span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 502px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 242.3529411764706%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAwABQDASIAAhEBAxEB/8QAGQABAQEAAwAAAAAAAAAAAAAAAgABAwQF/8QAFQEBAQAAAAAAAAAAAAAAAAAAAAH/2gAMAwEAAhADEAAAAfbZRWwVxsVR105XZJ//xAAbEAEAAQUBAAAAAAAAAAAAAAABEAACERJBIf/aAAgBAQABBQJDJ5HY7HckLdtaq00R/8QAFhEAAwAAAAAAAAAAAAAAAAAAEBEg/9oACAEDAQE/AYY//8QAFBEBAAAAAAAAAAAAAAAAAAAAIP/aAAgBAgEBPwFf/8QAGxAAAQQDAAAAAAAAAAAAAAAAAAEQITEgMOH/2gAIAQEABj8ClEI0dLesf//EAB8QAAEEAQUBAAAAAAAAAAAAAAEAEBEhMUFRYXGxkf/aAAgBAQABPyE+x7QAIAAcMefiIOhhDtTr8ckZGEGCH1hsKVsruwGaUptv/9oADAMBAAIAAwAAABAzBgAUz//EABcRAAMBAAAAAAAAAAAAAAAAABARIFH/2gAIAQMBAT8QhMH/xAAUEQEAAAAAAAAAAAAAAAAAAAAg/9oACAECAQE/EF//xAAhEAEAAgIBBAMBAAAAAAAAAAABESEAQRAxUWHRgaGx8P/aAAgBAQABPxCRvMSxnPCQBBgJMAXrKCZHZ/jiNKNGBJmV9sgwA/P95qRG+n6ykEemzwoBwaoZMFBFujhNTHhPWEKwas9cf//Z'); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"CloudWatch Insights\" title=\"\" src=\"/static/35d2da97df42d604da367f8eb1de8fb0/6f76c/insights.jpg\" srcset=\"/static/35d2da97df42d604da367f8eb1de8fb0/651be/insights.jpg 170w,\n/static/35d2da97df42d604da367f8eb1de8fb0/d30a3/insights.jpg 340w,\n/static/35d2da97df42d604da367f8eb1de8fb0/6f76c/insights.jpg 502w\" sizes=\"(max-width: 502px) 100vw, 502px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n    </span>\n          </p>\n<p>From the drop-down, select <strong>Performance monitoring</strong> and under <strong>Select clusters</strong>, choose your EKS cluster. You will see a dashboard like this, displaying metrics such as CPU, memory utilization, and various network statistics across the EKS cluster.</p>\n<p><span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 48.8235294117647%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAKABQDASIAAhEBAxEB/8QAFgABAQEAAAAAAAAAAAAAAAAAAAEF/8QAFAEBAAAAAAAAAAAAAAAAAAAAAP/aAAwDAQACEAMQAAAB3KFQf//EABYQAAMAAAAAAAAAAAAAAAAAAAERIP/aAAgBAQABBQJCv//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8BP//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8BP//EABQQAQAAAAAAAAAAAAAAAAAAACD/2gAIAQEABj8CX//EABkQAAIDAQAAAAAAAAAAAAAAAAABEBEhQf/aAAgBAQABPyHS2tKRSH2f/9oADAMBAAIAAwAAABC0D//EABURAQEAAAAAAAAAAAAAAAAAABAR/9oACAEDAQE/EKf/xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/ED//xAAcEAACAgIDAAAAAAAAAAAAAAABIQAREEExUZH/2gAIAQEAAT8QYAGzi2PTCDioRtpZ71j/2Q=='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"Cluster Statistics\" title=\"\" src=\"/static/d9cc51a21fa50eff22f53589804933ee/7bf67/statistics.jpg\" srcset=\"/static/d9cc51a21fa50eff22f53589804933ee/651be/statistics.jpg 170w,\n/static/d9cc51a21fa50eff22f53589804933ee/d30a3/statistics.jpg 340w,\n/static/d9cc51a21fa50eff22f53589804933ee/7bf67/statistics.jpg 680w,\n/static/d9cc51a21fa50eff22f53589804933ee/4b190/statistics.jpg 800w\" sizes=\"(max-width: 680px) 100vw, 680px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n    </span>\n          </p>\n<p>From the drop-down, you can even select the metrics at the <strong>pod level</strong>:</p>\n<p><span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 56.470588235294116%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAABvElEQVR42m1T2ZKbQAzk//8xm9jY3NccMFymt1tep/KQqVIxCKnVUossfzzxLAoMk0NMCT4EVFWFPH+gbjvEJcF5j6quEecZPkazfhzR9T3mZTEL9E3OIYu8XADObUV++8I4TljXFTpbWvB83DFOExYm6bRNzZiBMZvFJYGRhMVvG7KFrHR2vrhhhN73fX/7mBTIfCYz+V7nRfal2cp4EZE//WDIlzVNg5bUXYhWsee9qGprYWBbYtez0OS8tViVlY1I7V/XhX+PAYY4Y509muppM7CZBMfEwkCP42CbJa0h0wUbi5ZFbt8+5wNsgOt+4LU4+L61qud54mDSRHZqRaEzRfG0zdo+4Tln+/Y/hlJQyupF7MRS1RNBP8rpqdmq/XcXyeYqoeSXKV75mdbhz+2G2/3OWQ2mmGOSElVMbaY1GSMlmbKy9PatP3cVNcCOINq7rusMSEJ4HwxwpKW0/hVHigpAzHTXmoipAOXzFDZTq1JWw9cRo5EAn/no2bJYpHi2SsfO+IHxnOfrZbEpaUcvK2YzLLkKSti2nWwm/Pr6DS28LS8LFvyulZEoml/DPyjE8F4zdqiOFKfnNwD8UGwlJDqlAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"Pod Level Metrics\" title=\"\" src=\"/static/d15a8051da20929823ecc31c9c7ae675/c5bb3/podlevel.png\" srcset=\"/static/d15a8051da20929823ecc31c9c7ae675/04472/podlevel.png 170w,\n/static/d15a8051da20929823ecc31c9c7ae675/9f933/podlevel.png 340w,\n/static/d15a8051da20929823ecc31c9c7ae675/c5bb3/podlevel.png 680w,\n/static/d15a8051da20929823ecc31c9c7ae675/5a190/podlevel.png 800w\" sizes=\"(max-width: 680px) 100vw, 680px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n    </span>\n          </p>\n<p>Or even at the <strong>EKS node level</strong>:</p>\n<p><span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 56.470588235294116%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAABzElEQVR42nVT2ZKjMAzk/79varfmSjKEhNPGxlwhgd5uZ5jdlxXlsmWJllqSk/M5Q1GWmOYZvuuQF0XUy6pGYwyu1yts69APY7yX/cK7ujEw1mIYx7i6vofzHskwDNi2DZIwBIw0StZtRQgB6+MR9fl2I+hfXyUwTVP0l5/kRp/EewfLSMY0EVDnpmnQdR6hf+paIXTwzEDntm0jmKCXZcFM8D1okmVnpGkKR1odKZ9OR9R1Hc91XeF4PKCqKuoBl0tG+wklqYvmnu0uEVCO67p+U+4iUEz/foPKIdvG77bMkWbUWY55nn4A9z0CKn1rRMuwRgENszNshnUW/Q9l2kg5MNiTsiXl/2TYsHYlKdWsm+dP5XcnLQO1rsU1z5+6bVExmHT5ezZiVFP+WSpDIuMXa1jVbASdAtuvbuqsMRJNRd73+/1O+suzy1wC0q7/IqAy02qdIxUXZ0u7dMOsBCJgBdBYaEzUVS0B6K4n2J5MstyXOAYySByB8rzAg/PnfRdthjXUyEgM6z2OEx5sjmzya52PY7Qwe9bQ4uPzgIzTr66maYaXX7+h+6/0jLf3D7y+veNwPDGLHml8WRVfRYfs8nxFeVFxdk1k9AezY0tMnzyFPwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"Node Level Metrics\" title=\"\" src=\"/static/5c9e0ca355ec6491a457440b5e5f8d08/c5bb3/nodelevel.png\" srcset=\"/static/5c9e0ca355ec6491a457440b5e5f8d08/04472/nodelevel.png 170w,\n/static/5c9e0ca355ec6491a457440b5e5f8d08/9f933/nodelevel.png 340w,\n/static/5c9e0ca355ec6491a457440b5e5f8d08/c5bb3/nodelevel.png 680w,\n/static/5c9e0ca355ec6491a457440b5e5f8d08/5a190/nodelevel.png 800w\" sizes=\"(max-width: 680px) 100vw, 680px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n    </span>\n          </p>\n<h2 id=\"Ô∏è-wrap-up\" style=\"position:relative;\"><a href=\"#%EF%B8%8F-wrap-up\" aria-label=\"Ô∏è wrap up permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>‚úçÔ∏è Wrap Up</h2>\n<p><strong>Container Insights</strong> is a great CloudWatch feature that offers comprehensive monitoring capabilities for ECS clusters, EKS clusters, Kubernetes clusters running on EC2 instances, and Fargate. With Container Insights, you gain access to detailed performance metrics from various components within your cluster.</p>\n<p>For those operating Kubernetes clusters on AWS, whether using EKS or running clusters on EC2 instances, and currently lacking an APM (Application Performance Monitoring) solution for cluster metrics, CloudWatch Container Insights presents a quick and effective method to monitor your cluster's performance. By leveraging Container Insights, you can proactively monitor and optimize the performance of your containerized applications, ensuring smooth operations and efficient resource utilization.</p>\n<div style=\"width:100%;height:0;padding-bottom:100%;position:relative;\"><iframe src=\"https://giphy.com/embed/BDGZ5LdDUkHCS8kS8R\" width=\"100%\" height=\"100%\" style=\"position:absolute\" frameborder=\"0\" class=\"giphy-embed\" allowfullscreen></iframe></div>\n<br>\n<p><strong><em>Until next time, „Å§„Å•„Åè üéâ</em></strong></p>\n<blockquote>\n<p>üí° Thank you for Reading !! üôåüèªüòÅüìÉ, see you in the next blog.ü§ò  <em><strong>Until next time üéâ</strong></em></p>\n</blockquote>\n<p>üöÄ Thank you for sticking up till the end. If you have any questions/feedback regarding this blog feel free to connect with me:</p>\n<p><strong>‚ôªÔ∏è LinkedIn:</strong> <a href=\"https://www.linkedin.com/in/rajhi-saif/\" target=\"_blank\" rel=\"noopener noreferrer\">https://www.linkedin.com/in/rajhi-saif/</a></p>\n<p><strong>‚ôªÔ∏è X/Twitter:</strong> <a href=\"https://x.com/rajhisaifeddine\" target=\"_blank\" rel=\"noopener noreferrer\">https://x.com/rajhisaifeddine</a></p>\n<p><strong>The end ‚úåüèª</strong></p>\n<h1 align=\"center\">üî∞ Keep Learning !! Keep Sharing !! üî∞</h1>\n<p><strong>üìÖ Stay updated</strong></p>\n<p>Subscribe to our newsletter for more insights on AWS cloud computing and containers.</p>"}}},"staticQueryHashes":["1271460761","1321585977"],"slicesMap":{}}