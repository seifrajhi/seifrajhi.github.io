{"componentChunkName":"component---src-templates-blog-template-js","path":"/blog/goldilocks-kubernetes-resource-allocation/","result":{"data":{"markdownRemark":{"html":"<blockquote>\n<p><strong>Optimizing Kubernetes Resource Allocation</strong></p>\n</blockquote>\n<h2 id=\"Ô∏è-introduction\" style=\"position:relative;\"><a href=\"#%EF%B8%8F-introduction\" aria-label=\"Ô∏è introduction permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>‚ò∏Ô∏è Introduction</h2>\n<p>Kubernetes resource requests and limits are two of the most important concepts in Kubernetes, but they can also be some of the most difficult to set correctly. If your requests are too low, your pods will be evicted and your applications will fail. If your requests are too high, you'll be wasting resources and money.</p>\n<p><a href=\"https://github.com/FairwindsOps/goldilocks\" target=\"_blank\" rel=\"noopener noreferrer\">Goldilocks</a> is a utility that can help you identify a starting point for setting your resource requests and limits. It uses the Kubernetes Vertical Pod Autoscaler (VPA) to analyze the current resource usage of your pods and provide recommendations.</p>\n<p>In this post, we'll explain what Goldilocks is and how it works. We'll also show you how to use Goldilocks to set your resource requests and limits just right.</p>\n<h3 id=\"how-can-this-help-with-resource-settings\" style=\"position:relative;\"><a href=\"#how-can-this-help-with-resource-settings\" aria-label=\"how can this help with resource settings permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>How can this help with resource settings</h3>\n<p>By using the Kubernetes <a href=\"https://github.com/kubernetes/autoscaler/tree/master/vertical-pod-autoscaler\" target=\"_blank\" rel=\"noopener noreferrer\">Vertical Pod Autoscaler</a> in recommendation mode, we can see a suggestion for resource requests on each of our apps. This tool creates a VPA for each workload in a namespace and then queries them for information.</p>\n<p>Once your VPAs are in place, you'll see recommendations appear in the Goldilocks dashboard:</p>\n<p><span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 57.05882352941176%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAABrklEQVR42pWRS2/UMBSF8///CWukClagQitYFXUqlWFaKckk2En8jjN553Dj6WvELGDxxc49xyfXN9H26w3izQPSxww85Yh/JUh2Kbr6gGWYMPfjfxH9/HCF28/fkG0f0UoHHEhwLUbdYFD+3yF/VxpE6vo9yk/vYNMYdh/Dsz1mXQFWnmUxIvCX5hTGkiPa3W/w8fsV9nmKnGdgJYM/ODRtfZa2b9B2De39qUb1RlCgqkrESoEZg9/SIifMOMFNc8DS/hkzjEhKibRU5BmP+vSkzQucFIi8EmhAHZNZu4bwEMahVAaF1KHuxle0b4NP2vrFY/sedp6PgTU9Qkd0UJAhTnMIMnHGYOnwaSB14g9I0j1KQbeqFKR2qIfhTaCoqGUyU5EVFc2SQa1f5hx104X6c2BN1xPaUmAOqSw4hWrr4fo3gd7QtejK63yYWWeoUNUNLL2vtTC/6RXuamRSBa958dC60AxpfJH5cQlx9wVeFjB8D014ydFZgdZUaPUpDWlesOAJevCUx5Vl9JdvLpFcX6B4uAfbblDs7jBUGbVcYNH8DMWTdqqvtZFn+APeEUX68Mc+NQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"goldilocks\" title=\"\" src=\"/static/f33bec6050370a9e359e76d5cc147d72/c5bb3/goldilocks.png\" srcset=\"/static/f33bec6050370a9e359e76d5cc147d72/04472/goldilocks.png 170w,\n/static/f33bec6050370a9e359e76d5cc147d72/9f933/goldilocks.png 340w,\n/static/f33bec6050370a9e359e76d5cc147d72/c5bb3/goldilocks.png 680w,\n/static/f33bec6050370a9e359e76d5cc147d72/b12f7/goldilocks.png 1020w,\n/static/f33bec6050370a9e359e76d5cc147d72/b5a09/goldilocks.png 1360w,\n/static/f33bec6050370a9e359e76d5cc147d72/29007/goldilocks.png 1600w\" sizes=\"(max-width: 680px) 100vw, 680px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n    </span>\n          </p>\n<h3 id=\"installation\" style=\"position:relative;\"><a href=\"#installation\" aria-label=\"installation permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Installation</h3>\n<h4 id=\"requirements\" style=\"position:relative;\"><a href=\"#requirements\" aria-label=\"requirements permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Requirements</h4>\n<ul>\n<li><code class=\"language-text\">kubectl</code></li>\n<li>Vertical Pod Autoscaler configured in the cluster</li>\n<li>Some workloads with pods (Goldilocks will monitor any workload controller that includes a PodSpec template (spec.template.spec.containers[] to be specific). This includes Deployments, DaemonSets, and StatefulSets among others.)</li>\n<li><code class=\"language-text\">metrics-server</code> (a requirement of VPA)</li>\n<li><code class=\"language-text\">golang 1.17+</code></li>\n</ul>\n<h4 id=\"installing-vertical-pod-autoscaler\" style=\"position:relative;\"><a href=\"#installing-vertical-pod-autoscaler\" aria-label=\"installing vertical pod autoscaler permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Installing Vertical Pod Autoscaler</h4>\n<p>There are multiple ways to install VPA for use with Goldilocks:</p>\n<ul>\n<li>Install using the <code class=\"language-text\">hack/vpa-up.sh</code> script from the <a href=\"https://github.com/kubernetes/autoscaler/blob/master/vertical-pod-autoscaler/hack/vpa-up.sh\" target=\"_blank\" rel=\"noopener noreferrer\">vertical-pod-autoscaler repository</a>.</li>\n<li>Install using the <a href=\"https://github.com/FairwindsOps/charts/tree/master/stable/vpa\" target=\"_blank\" rel=\"noopener noreferrer\">Fairwinds VPA Helm Chart</a>.</li>\n</ul>\n<blockquote>\n<p><strong>Important Note about VPA:</strong>\nThe full VPA install includes the updater and the admission webhook for VPA. Goldilocks only requires the recommender. An admission webhook can introduce unexpected results in a cluster if not planned for properly. If installing VPA using the Goldilocks chart and the VPA sub-chart, only the VPA recommender will be installed. See the <a href=\"https://github.com/FairwindsOps/charts/tree/master/stable/vpa\" target=\"_blank\" rel=\"noopener noreferrer\">VPA chart</a> and the Goldilocks <a href=\"https://github.com/FairwindsOps/charts/blob/master/stable/goldilocks/values.yaml\" target=\"_blank\" rel=\"noopener noreferrer\">values.yaml</a> for more information.\nVPA does not require the use of Prometheus, but it is supported. The use of Prometheus may provide more accurate results.</p>\n</blockquote>\n<h4 id=\"installation-1\" style=\"position:relative;\"><a href=\"#installation-1\" aria-label=\"installation 1 permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Installation</h4>\n<p>First, make sure you satisfy the requirements above.</p>\n<p><strong>Method 1‚Ää-‚ÄäHelm (preferred):</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"sh\"><pre class=\"language-sh\"><code class=\"language-sh\">helm repo <span class=\"token function\">add</span> fairwinds-stable https://charts.fairwinds.com/stable\nkubectl create namespace goldilocks\nhelm <span class=\"token function\">install</span> goldilocks <span class=\"token parameter variable\">--namespace</span> goldilocks fairwinds-stable/goldilocks</code></pre></div>\n<p><strong>Method 2‚Ää-‚ÄäManifests:</strong></p>\n<p>The <a href=\"https://github.com/FairwindsOps/goldilocks/tree/master/hack/manifests\" target=\"_blank\" rel=\"noopener noreferrer\">hack/manifests</a> directory contains collections of Kubernetes YAML definitions for installing the controller and dashboard components in cluster.</p>\n<div class=\"gatsby-highlight\" data-language=\"sh\"><pre class=\"language-sh\"><code class=\"language-sh\"><span class=\"token function\">git</span> clone https://github.com/FairwindsOps/goldilocks.git\n<span class=\"token builtin class-name\">cd</span> goldilocks\nkubectl create namespace goldilocks\nkubectl <span class=\"token parameter variable\">-n</span> goldilocks apply <span class=\"token parameter variable\">-f</span> hack/manifests/controller\nkubectl <span class=\"token parameter variable\">-n</span> goldilocks apply <span class=\"token parameter variable\">-f</span> hack/manifests/dashboard</code></pre></div>\n<h4 id=\"enable-namespace\" style=\"position:relative;\"><a href=\"#enable-namespace\" aria-label=\"enable namespace permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Enable Namespace</h4>\n<p>Pick an application namespace and label it like so in order to see some data:</p>\n<div class=\"gatsby-highlight\" data-language=\"sh\"><pre class=\"language-sh\"><code class=\"language-sh\">kubectl label ns goldilocks goldilocks.fairwinds.com/enabled<span class=\"token operator\">=</span>true</code></pre></div>\n<p>After that, you should start to see VPA objects in that namespace.</p>\n<h4 id=\"viewing-the-dashboard\" style=\"position:relative;\"><a href=\"#viewing-the-dashboard\" aria-label=\"viewing the dashboard permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Viewing the Dashboard</h4>\n<p>The default installation creates a ClusterIP service for the dashboard. You can access via port forward:</p>\n<div class=\"gatsby-highlight\" data-language=\"sh\"><pre class=\"language-sh\"><code class=\"language-sh\">kubectl <span class=\"token parameter variable\">-n</span> goldilocks port-forward svc/goldilocks-dashboard <span class=\"token number\">8080</span>:80</code></pre></div>\n<p>Then open your browser to <a href=\"http://localhost:8080\" target=\"_blank\" rel=\"noopener noreferrer\">http://localhost:8080</a>.</p>\n<h3 id=\"how-accurate-is-goldilocks\" style=\"position:relative;\"><a href=\"#how-accurate-is-goldilocks\" aria-label=\"how accurate is goldilocks permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>How Accurate is Goldilocks?</h3>\n<p>The Goldilocks open-source software is based entirely on the underlying VPA project, specifically the Recommender. In our experience, Goldilocks is a good starting point for setting your resource requests and limits. But every environment is different, and Goldilocks isn't a replacement for tuning your applications to your specific use cases.</p>\n<h2 id=\"-closing-thoughts\" style=\"position:relative;\"><a href=\"#-closing-thoughts\" aria-label=\" closing thoughts permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üìù Closing Thoughts</h2>\n<p>So this is how Goldilocks can be used by Developers, SRE, and DevOps teams to calculate the right estimates for all their workloads and also from the FinOps perspective. Please feel free to share your experience while implementing this in your clusters.</p>\n<p><strong>Thank You üñ§</strong></p>\n<br>\n<p><strong><em>Until next time, „Å§„Å•„Åè üéâ</em></strong></p>\n<blockquote>\n<p>üí° Thank you for Reading !! üôåüèªüòÅüìÉ, see you in the next blog.ü§ò  <strong><em>Until next time üéâ</em></strong></p>\n</blockquote>\n<p>üöÄ Thank you for sticking up till the end. If you have any questions/feedback regarding this blog feel free to connect with me:</p>\n<p><strong>‚ôªÔ∏è LinkedIn:</strong> <a href=\"https://www.linkedin.com/in/rajhi-saif/\" target=\"_blank\" rel=\"noopener noreferrer\">https://www.linkedin.com/in/rajhi-saif/</a></p>\n<p><strong>‚ôªÔ∏è X/Twitter:</strong> <a href=\"https://x.com/rajhisaifeddine\" target=\"_blank\" rel=\"noopener noreferrer\">https://x.com/rajhisaifeddine</a></p>\n<p><strong>The end ‚úåüèª</strong></p>\n<h1 align=\"center\">üî∞ Keep Learning !! Keep Sharing !! üî∞</h1>\n<p><strong>üìÖ Stay updated</strong></p>\n<p>Subscribe to our newsletter for more insights on AWS cloud computing and containers.</p>","timeToRead":3,"rawMarkdownBody":"\n> **Optimizing Kubernetes Resource Allocation**\n\n## ‚ò∏Ô∏è Introduction\n\nKubernetes resource requests and limits are two of the most important concepts in Kubernetes, but they can also be some of the most difficult to set correctly. If your requests are too low, your pods will be evicted and your applications will fail. If your requests are too high, you'll be wasting resources and money.\n\n[Goldilocks](https://github.com/FairwindsOps/goldilocks) is a utility that can help you identify a starting point for setting your resource requests and limits. It uses the Kubernetes Vertical Pod Autoscaler (VPA) to analyze the current resource usage of your pods and provide recommendations.\n\nIn this post, we'll explain what Goldilocks is and how it works. We'll also show you how to use Goldilocks to set your resource requests and limits just right.\n\n### How can this help with resource settings\n\nBy using the Kubernetes [Vertical Pod Autoscaler](https://github.com/kubernetes/autoscaler/tree/master/vertical-pod-autoscaler) in recommendation mode, we can see a suggestion for resource requests on each of our apps. This tool creates a VPA for each workload in a namespace and then queries them for information.\n\nOnce your VPAs are in place, you'll see recommendations appear in the Goldilocks dashboard:\n\n![goldilocks](./goldilocks.png)\n\n### Installation\n\n#### Requirements\n\n- `kubectl`\n- Vertical Pod Autoscaler configured in the cluster\n- Some workloads with pods (Goldilocks will monitor any workload controller that includes a PodSpec template (spec.template.spec.containers[] to be specific). This includes Deployments, DaemonSets, and StatefulSets among others.)\n- `metrics-server` (a requirement of VPA)\n- `golang 1.17+`\n\n#### Installing Vertical Pod Autoscaler\n\nThere are multiple ways to install VPA for use with Goldilocks:\n\n- Install using the `hack/vpa-up.sh` script from the [vertical-pod-autoscaler repository](https://github.com/kubernetes/autoscaler/blob/master/vertical-pod-autoscaler/hack/vpa-up.sh).\n- Install using the [Fairwinds VPA Helm Chart](https://github.com/FairwindsOps/charts/tree/master/stable/vpa).\n\n> **Important Note about VPA:**\n> The full VPA install includes the updater and the admission webhook for VPA. Goldilocks only requires the recommender. An admission webhook can introduce unexpected results in a cluster if not planned for properly. If installing VPA using the Goldilocks chart and the VPA sub-chart, only the VPA recommender will be installed. See the [VPA chart](https://github.com/FairwindsOps/charts/tree/master/stable/vpa) and the Goldilocks [values.yaml](https://github.com/FairwindsOps/charts/blob/master/stable/goldilocks/values.yaml) for more information.\n> VPA does not require the use of Prometheus, but it is supported. The use of Prometheus may provide more accurate results.\n\n#### Installation\n\nFirst, make sure you satisfy the requirements above.\n\n**Method 1‚Ää-‚ÄäHelm (preferred):**\n\n```sh\nhelm repo add fairwinds-stable https://charts.fairwinds.com/stable\nkubectl create namespace goldilocks\nhelm install goldilocks --namespace goldilocks fairwinds-stable/goldilocks\n```\n\n**Method 2‚Ää-‚ÄäManifests:**\n\nThe [hack/manifests](https://github.com/FairwindsOps/goldilocks/tree/master/hack/manifests) directory contains collections of Kubernetes YAML definitions for installing the controller and dashboard components in cluster.\n\n```sh\ngit clone https://github.com/FairwindsOps/goldilocks.git\ncd goldilocks\nkubectl create namespace goldilocks\nkubectl -n goldilocks apply -f hack/manifests/controller\nkubectl -n goldilocks apply -f hack/manifests/dashboard\n```\n\n#### Enable Namespace\n\nPick an application namespace and label it like so in order to see some data:\n\n```sh\nkubectl label ns goldilocks goldilocks.fairwinds.com/enabled=true\n```\n\nAfter that, you should start to see VPA objects in that namespace.\n\n#### Viewing the Dashboard\n\nThe default installation creates a ClusterIP service for the dashboard. You can access via port forward:\n\n```sh\nkubectl -n goldilocks port-forward svc/goldilocks-dashboard 8080:80\n```\n\nThen open your browser to [http://localhost:8080](http://localhost:8080).\n\n### How Accurate is Goldilocks?\n\nThe Goldilocks open-source software is based entirely on the underlying VPA project, specifically the Recommender. In our experience, Goldilocks is a good starting point for setting your resource requests and limits. But every environment is different, and Goldilocks isn't a replacement for tuning your applications to your specific use cases.\n\n## üìù Closing Thoughts\n\nSo this is how Goldilocks can be used by Developers, SRE, and DevOps teams to calculate the right estimates for all their workloads and also from the FinOps perspective. Please feel free to share your experience while implementing this in your clusters.\n\n**Thank You üñ§**\n\n<br>\n\n**_Until next time, „Å§„Å•„Åè üéâ_**\n\n> üí° Thank you for Reading !! üôåüèªüòÅüìÉ, see you in the next blog.ü§ò  **_Until next time üéâ_**\n\nüöÄ Thank you for sticking up till the end. If you have any questions/feedback regarding this blog feel free to connect with me:\n\n**‚ôªÔ∏è LinkedIn:** https://www.linkedin.com/in/rajhi-saif/\n\n**‚ôªÔ∏è X/Twitter:** https://x.com/rajhisaifeddine\n\n**The end ‚úåüèª**\n\n<h1 align=\"center\">üî∞ Keep Learning !! Keep Sharing !! üî∞</h1>\n\n**üìÖ Stay updated**\n\nSubscribe to our newsletter for more insights on AWS cloud computing and containers.\n","wordCount":{"words":607},"frontmatter":{"id":"c354d80e5365617e34f18199","path":"/blog/goldilocks-kubernetes-resource-allocation/","humanDate":"Oct 25, 2024","fullDate":"2024-10-25","title":"Goldilocks: The Secret to Setting Kubernetes Resource Requests and Limits Just Right","keywords":["Kubernetes","Resource Allocation","Goldilocks","Optimization"],"excerpt":"Learn how to optimize Kubernetes resource allocation with Goldilocks, ensuring your resource requests and limits are set just right.","cover":{"childImageSharp":{"gatsbyImageData":{"layout":"fullWidth","placeholder":{"fallback":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAAAsTAAALEwEAmpwYAAABUklEQVR42mWQXUsCYRCF9z/0I7sIuu2mu+iqCEHSoBIq0sSs8DM2QrO0rbVME81KV9b9MlNTEzX33dPuimY1MAwzDHOeORTPCUgyaXTaXXT7Gnq9Puq1JlRVhcDLECsKGvUPGKERzaztVgfNRms000azcVBHrhAyqTy2151g7ItQsizocAK0Pwr3rg/xKIuz0CXYxANeC2Xc3WQQO2dw6ovg5akE5ur+98ETdxj+4wgsiyvIzc9AcMzCYvHC5fDCYTuA75DGptUJz34AtrUdeJ1B0MEYFuaWQQcusLq0gcHga0JLFXJFk0KqyIjubcFjtaMi1HAbT+E5X4IkVM23k9dpyGIVKTYLrsiDL4s6IacTP+r2kB/CadyBquGzNzS0zJ7onhFCzNTMnvzz7G9QxpKhYCwSdQilWoMoVyFIyqQaqby9g+MFSPrMuK6NxabojIPfky2wX0iTVZgAAAAASUVORK5CYII="},"images":{"fallback":{"src":"/static/5bb8dbebc591aa36540f543214932952/32af0/cover.png","srcSet":"/static/5bb8dbebc591aa36540f543214932952/d66de/cover.png 750w,\n/static/5bb8dbebc591aa36540f543214932952/c0419/cover.png 1080w,\n/static/5bb8dbebc591aa36540f543214932952/7a307/cover.png 1366w,\n/static/5bb8dbebc591aa36540f543214932952/32af0/cover.png 1400w","sizes":"100vw"},"sources":[{"srcSet":"/static/5bb8dbebc591aa36540f543214932952/7302d/cover.webp 750w,\n/static/5bb8dbebc591aa36540f543214932952/d9efc/cover.webp 1080w,\n/static/5bb8dbebc591aa36540f543214932952/5d56f/cover.webp 1366w,\n/static/5bb8dbebc591aa36540f543214932952/e1f3a/cover.webp 1400w","type":"image/webp","sizes":"100vw"}]},"width":1,"height":0.2892857142857143}}},"coverCredits":"Photo by Saifeddine Rajhi"}}},"pageContext":{"prevThought":{"frontmatter":{"path":"/blog/finops-mayfly-kubernetes-ephemeral-resources/","title":"FinOps Best Practices: Using Mayfly Kubernetes Operator for Ephemeral Resources","date":"2024-10-25 15:34:00"},"excerpt":"Optimizing Resources Spend with the Mayfly Kubernetes Operator üìñ Introduction In the world of cloud computing, managing costs can be a‚Ä¶","html":"<blockquote>\n<p><strong>Optimizing Resources Spend with the Mayfly Kubernetes Operator</strong></p>\n</blockquote>\n<h2 id=\"-introduction\" style=\"position:relative;\"><a href=\"#-introduction\" aria-label=\" introduction permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üìñ Introduction</h2>\n<p>In the world of cloud computing, managing costs can be a challenge. One way to optimize your cloud spend is to use ephemeral resources that automatically expire after a certain period of time. Kubernetes is a popular container orchestration platform that can help manage these resources.</p>\n<p>In this blog post, we will explore the <a href=\"https://github.com/NCCloud/mayfly\" target=\"_blank\" rel=\"noopener noreferrer\">Mayfly Kubernetes operator</a>, which enables you to create temporary resources on the cluster that will expire after a certain period of time. We will discuss how to use Mayfly to implement FinOps best practices and optimize your cloud spend.</p>\n<p><span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 56.470588235294116%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAALABQDASIAAhEBAxEB/8QAFwAAAwEAAAAAAAAAAAAAAAAAAAQFAv/EABUBAQEAAAAAAAAAAAAAAAAAAAAB/9oADAMBAAIQAxAAAAEbc2RSwR//xAAbEAACAgMBAAAAAAAAAAAAAAABAwACBBETFP/aAAgBAQABBQI5DNtZcD0XnBUK6GcVz//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8BP//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8BP//EABsQAAICAwEAAAAAAAAAAAAAAAABAiERMTIS/9oACAEBAAY/AsemyLUna0XJnCLjo4R//8QAGxABAAICAwAAAAAAAAAAAAAAAQAREEFRgcH/2gAIAQEAAT8hAxQ3LDQV9TgPWDUEFFGM/9oADAMBAAIAAwAAABA7P//EABYRAAMAAAAAAAAAAAAAAAAAAAEQYf/aAAgBAwEBPxAVf//EABcRAAMBAAAAAAAAAAAAAAAAAAABEUH/2gAIAQIBAT8QcxEP/8QAHBAAAgICAwAAAAAAAAAAAAAAAREAIUFRMZHx/9oACAEBAAE/EAvwbUB4axCYyEAIIkv1UXymg0Jm7E61A6YE0BiefP/Z'); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"mayfly\" title=\"\" src=\"/static/39bcfe1514a7edad2ce14f2345af81c6/7bf67/mayfly.jpg\" srcset=\"/static/39bcfe1514a7edad2ce14f2345af81c6/651be/mayfly.jpg 170w,\n/static/39bcfe1514a7edad2ce14f2345af81c6/d30a3/mayfly.jpg 340w,\n/static/39bcfe1514a7edad2ce14f2345af81c6/7bf67/mayfly.jpg 680w,\n/static/39bcfe1514a7edad2ce14f2345af81c6/990cb/mayfly.jpg 1020w,\n/static/39bcfe1514a7edad2ce14f2345af81c6/eea4a/mayfly.jpg 1280w\" sizes=\"(max-width: 680px) 100vw, 680px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n    </span>\n          </p>\n<h2 id=\"-introduction-to-mayfly\" style=\"position:relative;\"><a href=\"#-introduction-to-mayfly\" aria-label=\" introduction to mayfly permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üìÑ Introduction to Mayfly</h2>\n<p>The <strong>Mayfly Operator</strong> is a tool that allows you to manage resources on your cluster for a temporary time. It works by deleting the resources from the cluster based on a Mayfly expiration annotation that you set to specify how long the resource should remain active. This can be useful for creating temporary resources, managing temporary accesses, or simply keeping your cluster organized and tidy. The Mayfly Operator helps in resource management by automatically cleaning up resources after a specified period, reducing clutter and improving efficiency.</p>\n<p>The Mayfly Operator is a valuable tool for managing resources in a Kubernetes cluster. By setting a Mayfly expiration annotation, you can ensure that resources are automatically deleted after a specified period, helping to keep your cluster organized and efficient. This can be useful for managing temporary resources, such as test environments or short-lived jobs, and can also help to ensure that resources are not left running unnecessarily, reducing costs and improving security.</p>\n<h2 id=\"-configuration\" style=\"position:relative;\"><a href=\"#-configuration\" aria-label=\" configuration permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üõ† Configuration</h2>\n<p>Mayfly is an easy-to-use and configurable project that uses resource watches and schedulers to delete your resources at the appropriate time. It is simple to set up and customize. To specify which resources should be monitored and cleaned up, you can set the <code class=\"language-text\">RESOURCES</code> environment variable to a comma-separated list of <code class=\"language-text\">{ApiVersion};{Kind}</code> as text. This allows you to customize which resources are targeted for cleanup.</p>\n<p><strong>Example:</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"sh\"><pre class=\"language-sh\"><code class=\"language-sh\"><span class=\"token builtin class-name\">export</span> <span class=\"token assign-left variable\">RESOURCES</span><span class=\"token operator\">=</span><span class=\"token string\">\"v1;Secret,test.com/v1alpha;MyCRD\"</span></code></pre></div>\n<h2 id=\"-usage\" style=\"position:relative;\"><a href=\"#-usage\" aria-label=\" usage permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üöÄ Usage</h2>\n<p>Once you have determined which resources you want Mayfly to monitor, you can set the <code class=\"language-text\">mayfly.cloud.namecheap.com/expire</code> annotation on those resources with a duration value. This will cause Mayfly to delete the resources once the specified duration has passed, based on the time of their creation. Keep in mind that the expiration will be calculated based on the creation time of the resource.</p>\n<p><strong>Example:</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> v1\n<span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> Pod\n<span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> my<span class=\"token punctuation\">-</span>pod\n    <span class=\"token key atrule\">annotations</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">mayfly.cloud.namecheap.com/expire</span><span class=\"token punctuation\">:</span> 30s\n<span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">containers</span><span class=\"token punctuation\">:</span>\n        <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> alpine\n            <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> alpine\n            <span class=\"token key atrule\">command</span><span class=\"token punctuation\">:</span>\n                <span class=\"token punctuation\">-</span> sleep\n                <span class=\"token punctuation\">-</span> infinity</code></pre></div>\n<h2 id=\"Ô∏è-deployment\" style=\"position:relative;\"><a href=\"#%EF%B8%8F-deployment\" aria-label=\"Ô∏è deployment permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üõ≥Ô∏è Deployment</h2>\n<p>The easiest and most recommended way to deploy the Mayfly operator to your Kubernetes cluster is by using the Helm chart. To do this, you will need to add our Helm repository and install it from there, providing the <code class=\"language-text\">RESOURCES</code> environment variable as needed. If you prefer, you can also compile the operator and install it using any method you choose.</p>\n<p><strong>Example:</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"sh\"><pre class=\"language-sh\"><code class=\"language-sh\">helm repo <span class=\"token function\">add</span> nccloud https://nccloud.github.io/charts\nhelm <span class=\"token function\">install</span> mayfly nccloud/mayfly <span class=\"token parameter variable\">--set</span> <span class=\"token assign-left variable\">RESOURCES</span><span class=\"token operator\">=</span><span class=\"token string\">\"v1;Secret\"</span> <span class=\"token comment\"># For only secrets</span></code></pre></div>\n<h2 id=\"-summary\" style=\"position:relative;\"><a href=\"#-summary\" aria-label=\" summary permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üìå Summary</h2>\n<p>In conclusion, the <strong>Mayfly Kubernetes Operator</strong> is a valuable tool for managing ephemeral resources in a Kubernetes cluster. It allows you to create temporary resources, accesses, or maintain a clean and organized cluster by automatically deleting resources after a specified period. Key points about the Mayfly Operator include:</p>\n<ul>\n<li>Mayfly enables you to create temporary resources on the cluster that will expire after a certain period of time.</li>\n<li>It helps in resource management by automatically cleaning up resources after a specified period, reducing clutter and improving efficiency.</li>\n<li>The Mayfly Operator is easy to set up and customize, with the ability to specify which resources should be monitored and cleaned up using the <code class=\"language-text\">RESOURCES</code> environment variable.</li>\n<li>To deploy the Mayfly Operator, you can use the Helm chart, which is the easiest and most recommended method.</li>\n</ul>\n<p>By using the Mayfly Kubernetes Operator, you can ensure that your Kubernetes cluster remains organized, efficient, and secure by automatically managing temporary resources and cleaning up after they are no longer needed.</p>\n<p><strong>Thank You üñ§</strong></p>\n<br>\n<p><strong><em>Until next time, „Å§„Å•„Åè üéâ</em></strong></p>\n<blockquote>\n<p>üí° Thank you for Reading !! üôåüèªüòÅüìÉ, see you in the next blog.ü§ò  <strong><em>Until next time üéâ</em></strong></p>\n</blockquote>\n<p>üöÄ Thank you for sticking up till the end. If you have any questions/feedback regarding this blog feel free to connect with me:</p>\n<p><strong>‚ôªÔ∏è LinkedIn:</strong> <a href=\"https://www.linkedin.com/in/rajhi-saif/\" target=\"_blank\" rel=\"noopener noreferrer\">https://www.linkedin.com/in/rajhi-saif/</a></p>\n<p><strong>‚ôªÔ∏è X/Twitter:</strong> <a href=\"https://x.com/rajhisaifeddine\" target=\"_blank\" rel=\"noopener noreferrer\">https://x.com/rajhisaifeddine</a></p>\n<p><strong>The end ‚úåüèª</strong></p>\n<h1 align=\"center\">üî∞ Keep Learning !! Keep Sharing !! üî∞</h1>\n<p><strong>üìÖ Stay updated</strong></p>\n<p>Subscribe to our newsletter for more insights on AWS cloud computing and containers.</p>"},"nextThought":{"frontmatter":{"path":"/blog/data-on-kubernetes-airflow-on-aws-3/","title":"Data on Kubernetes: Part 3‚Ää-‚ÄäManaging Workflows with Job Schedulers and Batch-Oriented Workflow Orchestrators","date":"2024-10-25 14:06:00"},"excerpt":"Automate and orchestrate data workflows in Kubernetes with Amazon managed Apache Airflow üî∑ Introduction Welcome back to this blog series on‚Ä¶","html":"<blockquote>\n<p><strong>Automate and orchestrate data workflows in Kubernetes with Amazon managed Apache Airflow</strong></p>\n</blockquote>\n<h2 id=\"-introduction\" style=\"position:relative;\"><a href=\"#-introduction\" aria-label=\" introduction permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üî∑ Introduction</h2>\n<p>Welcome back to this blog series on Data on Kubernetes! In this third part, we're going to focus on how to manage workflows effectively using job schedulers and orchestrators. We'll be looking at tools specifically designed for batch workloads, scientific computing, machine learning workflows, and parallel tasks.</p>\n<p>One of the tools we'll explore is <a href=\"https://docs.aws.amazon.com/mwaa/latest/userguide/what-is-mwaa.html\" target=\"_blank\" rel=\"noopener noreferrer\">Amazon Managed Workflows for Apache Airflow MWAA</a>, a great service that helps manage data pipelines, machine learning workflows, and batch processing.</p>\n<h2 id=\"deep-dive-into-job-schedulers-and-workflow-orchestrators\" style=\"position:relative;\"><a href=\"#deep-dive-into-job-schedulers-and-workflow-orchestrators\" aria-label=\"deep dive into job schedulers and workflow orchestrators permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Deep Dive into Job Schedulers and Workflow Orchestrators</h2>\n<p>Nowadays, in the modern <a href=\"https://www.forbes.com/sites/googlecloud/2020/05/20/how-the-world-became-data-driven-and-whats-next/\" target=\"_blank\" rel=\"noopener noreferrer\">data-driven IT world</a>, the management and automation of data workflows are becoming more and more important. This is where Job Schedulers and Batch-Oriented Workflow Orchestrators come into play.</p>\n<p>These platforms are designed to manage and automate various data processes in a systematic and efficient manner. Consider the example of an ETL (Extract, Transform, Load) process, a common scenario in data workflows. In this process, data is extracted from various sources, transformed into a suitable format, and then loaded into a data warehouse for further analysis. Managing this process manually can be challenging and prone to errors.</p>\n<p>This is where Job Schedulers and Workflow Orchestrators prove their worth. They automate these tasks, ensuring that the ETL process runs smoothly and efficiently. Furthermore, they enhance the portability and scalability of our workflows, which is important when dealing with large volumes of data or complex machine learning models.</p>\n<p>Apart from ETL processes, there are other scenarios where Job Schedulers and Workflow Orchestrators can be beneficial. For instance, in machine learning pipelines, where data preprocessing, model training, model evaluation, and model deployment need to be executed in a specific order. Another example could be data synchronization tasks between different systems, which require precise timing and error handling.</p>\n<p>There are several tools available that can help manage these workflows. <a href=\"https://airflow.apache.org/\" target=\"_blank\" rel=\"noopener noreferrer\">Apache Airflow</a> is a platform designed to programmatically author, schedule, and monitor workflows. <a href=\"https://www.kubeflow.org/\" target=\"_blank\" rel=\"noopener noreferrer\">Kubeflow</a> is a Kubernetes-native platform for developing, orchestrating, deploying, and running scalable and portable machine learning workloads. <a href=\"https://argoproj.github.io/workflows/\" target=\"_blank\" rel=\"noopener noreferrer\">Argo Workflows</a> is an open-source container-native workflow engine for orchestrating parallel jobs on Kubernetes.</p>\n<p>In this blog, we will focus specifically on <a href=\"https://docs.aws.amazon.com/mwaa/latest/userguide/what-is-mwaa.html\" target=\"_blank\" rel=\"noopener noreferrer\">AWS Managed Workflows for Apache Airflow MWAA</a>. This service makes it easier to set up and operate end-to-end data pipelines in the cloud at scale. Airflow is an open-source workflow management platform. Workflows are defined with <a href=\"https://en.wikipedia.org/wiki/Directed_acyclic_graph\" target=\"_blank\" rel=\"noopener noreferrer\">DAGs</a>, Configuration as code written in Python.</p>\n<p><span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 64.70588235294117%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAAsTAAALEwEAmpwYAAAByklEQVR42o1T2Y6jMBDk/79xtTvKJFzmBh+A7ZpqkyjKwMO2ZNmioVxHk+FX7auFnif41UEvM4ZhwGY1rF6wco/Bf34Q48eenQCdRpU/oCcCOQtrLZahQ9fUmLgfgDEBxBjSO8s4IGzrEzC+m1LBe4xk5UNAeK6Y+jGddzKfhh4zL3RmgRl7DHWBua0JapEJk6au4fScALdtQ1EUsM5h33csywLVNFjXNfU2AlpaYbgE3JOZnGdhuW/IREZ+v2Ps20MyGSqlEtjbpvg+U3IM4ZB9UZmY3TYKC4MwxsATyBpNOSZZEQiQpPIiRz/nrkZPiZHhvYJ4WZIAvTNQVYGwGozjyIRHzEMLVebYmWrXdbjdbmgoe5HUVYmGPVU8mL45M4TQZyCHDDlGGj7RqyM18U4sEGAZofB875X0GfBXiUeaNjjKlos8pcpKacvI8JnRGgPViEy/MTwGKIFI7wS4chTqqkLJWTT0VU8j8rxA37WYuFRVppRbMhavp6bC978/GJqSgP6Cod/SsMpIhH39kBXY251Jcq3l+DC4tnyg+P5CQ09j2M+AVxUvvJI/SFIXoPvXXzKseON/Al6V+LpxqOdeoc7vHCeVPPwBb2j4HCTKM5sAAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"DAG\" title=\"\" src=\"/static/3c64588cebd9c2c9bbdb7b2c0c2bee89/c5bb3/dag.png\" srcset=\"/static/3c64588cebd9c2c9bbdb7b2c0c2bee89/04472/dag.png 170w,\n/static/3c64588cebd9c2c9bbdb7b2c0c2bee89/9f933/dag.png 340w,\n/static/3c64588cebd9c2c9bbdb7b2c0c2bee89/c5bb3/dag.png 680w,\n/static/3c64588cebd9c2c9bbdb7b2c0c2bee89/0f67e/dag.png 921w\" sizes=\"(max-width: 680px) 100vw, 680px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n    </span>\n          </p>\n<div class=\"image-title\"><a href=\"https://medium.com/nerd-for-tech/airflow-mwaa-automating-etl-for-a-data-warehouse-f5e50d14713c\">source</a></div>\n<p>Apache Airflow at a high level has the following components talking to each other:</p>\n<p><span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 44.11764705882353%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsTAAALEwEAmpwYAAABZElEQVR42oVSTU+DQBDl/x/1bn+BSRM1UdvooZd6s/Vi22hLPzBAoS1Q2E+es4sgVhPfZkIYZt/Me4OTJAdc31whSVIYlGWJ/6C1AmMFpBQYv4zgeRsoJfE+f4MjpcTGW8M8axjSNvHpO+cMORMQRDIaP8P72EAIjiD04ZhCwcXXhdKehqh16ncDIQS41D8qDaIogrPbx+h2LxHv4ubzw2Pfdq4xm01xd38LVUoc8wyrpYsw3kOQqn6/h8nkFZKarNdLOAXj8AMf2THDkYKxnEYPEVGDNEttLkkTRHFkyQ+HPVx3gYJLqyoMA2RUZzwMtwEcpb8H325Da7YqKxFGgjH8dFnGLy5VJbSVV0pVhKeb5UKRHAXd5MtfhFnBIWmqKdnh0zJ0qW1zS1iHVNpeODs/x0Wn03Stt1yHplyaM2oqMHwaYuHOafMcqxV52J6snqJHRg8Gg4pQaztpO0yV/uN3NaSftKG2+9pbGLMAAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"AWS DAG\" title=\"\" src=\"/static/64140cea93542af0f952ab25119ad0a2/c5bb3/aws-dag.png\" srcset=\"/static/64140cea93542af0f952ab25119ad0a2/04472/aws-dag.png 170w,\n/static/64140cea93542af0f952ab25119ad0a2/9f933/aws-dag.png 340w,\n/static/64140cea93542af0f952ab25119ad0a2/c5bb3/aws-dag.png 680w,\n/static/64140cea93542af0f952ab25119ad0a2/1d69c/aws-dag.png 750w\" sizes=\"(max-width: 680px) 100vw, 680px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n    </span>\n          </p>\n<div class=\"image-title\"><a href=\"https://aws.amazon.com/blogs/machine-learning/build-end-to-end-machine-learning-workflows-with-amazon-sagemaker-and-apache-airflow/\">source</a></div>\n<h2 id=\"main-concepts-of-apache-airflow\" style=\"position:relative;\"><a href=\"#main-concepts-of-apache-airflow\" aria-label=\"main concepts of apache airflow permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Main Concepts of Apache Airflow</h2>\n<p>Before starting this demo and the operation of MWAA, it's important to refresh briefly some key Airflow concepts. For more deep dive explanations, please refer to <a href=\"https://airflow.apache.org/docs/apache-airflow/stable/index.html\" target=\"_blank\" rel=\"noopener noreferrer\">Apache Airflow official documentation</a>.</p>\n<ul>\n<li>\n<p>üåê <strong>Webserver</strong>: This provides a control interface for users and maintainers. The Airflow UI is a Flask + Gunicorn setup that lists DAGs, their run history, schedule, and pause/start options. It's a central place from where we can manage the Airflow pipelines and also handles the APIs.</p>\n</li>\n<li>\n<p>üóÑÔ∏è <strong>Metadata Database</strong>: Airflow uses a database supported by the SQLAlchemy Library, such as PostgreSQL or MySQL. This database powers the UI and acts as the backend for the worker and scheduler. It stores configurations, such as variables, connections, user information, roles, and policies. It also stores DAG-related metadata such as schedule intervals, tasks, statistics from various runs, etc.</p>\n</li>\n<li>\n<p>üï∞Ô∏è <strong>Scheduler</strong>: This is a daemon, built using the Python daemon library. It schedules &#x26; delegates tasks on the worker node via the executor. It also takes care of other housekeeping tasks like concurrency checks, dependency checks, callbacks, retries, etc. The three main components of the scheduler are:</p>\n<ul>\n<li>SchedulerJob</li>\n<li>DagFileProcessor</li>\n<li>Executor</li>\n</ul>\n</li>\n<li>\n<p>üë∑ <strong>Worker</strong>: These are the workhorses of Airflow. They are the actual nodes where tasks are executed.</p>\n</li>\n<li>\n<p>üîß <strong>Executor</strong>: Executors are the \"workstations\" for \"tasks\". The Executor acts as a middleman to handle resource allocation and distribute task completion. Executors run inside the scheduler. There are many options available in Airflow for executors, including:</p>\n<ul>\n<li>Sequential Executor: Default executor, runs one task at a time.</li>\n<li>Debug Executor: A debug tool, runs tasks by queuing them.</li>\n<li>Local Executor: Runs multiple tasks concurrently on a single machine.</li>\n<li>Dask Executor: Executes tasks concurrently across multiple machines.</li>\n<li>Celery Executor: Scales out the number of workers in parallel.</li>\n<li>Kubernetes Executor: Runs each task in its own Kubernetes pod.</li>\n</ul>\n</li>\n<li>\n<p>üì® <strong>Message Broker (optional)</strong>: A message broker is needed in distributed setups, where the CeleryExecutor is used to manage communication between the Scheduler and the Workers. The message broker, such as RabbitMQ or Redis, helps to pass task information from the Scheduler to the Workers. For MWAA, the Celery Executor is used.</p>\n</li>\n</ul>\n<h3 id=\"sequence-of-actions\" style=\"position:relative;\"><a href=\"#sequence-of-actions\" aria-label=\"sequence of actions permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Sequence of Actions</h3>\n<ol>\n<li>The scheduler initiates DAGs based on triggers, which could be scheduled or external.</li>\n<li>The scheduler loads the tasks/steps within the DAG and determines the dependencies.</li>\n<li>Tasks that are ready to run are placed in the queue by the scheduler.</li>\n<li>Workers retrieve these tasks from the queue and execute them.</li>\n<li>Upon completion of a task, a worker updates the task's status.</li>\n<li>The overall status of the DAG is determined based on the statuses of the individual tasks.</li>\n</ol>\n<p><span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 111.76470588235294%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAWCAYAAADAQbwGAAAACXBIWXMAAAsTAAALEwEAmpwYAAAE30lEQVR42j2V2W8bVRTG/cQz4pn/D/EvIJ6QQDwhlbbQAgKpCMrSJF1ok7bQNgmNsziL7dhZ7NjjZcbjmfHsm8d2fpyZ0Ix0fK/Gvt/5zrnf+Vy6vLwkj3dPkmVkswVdz2DpZItliZWzMkunW2yNzpjN5/i+h+u61+E4Dp7nFTilTABs2y6+CMOQ3aHGi/Mu1fGAF1qdpdomDySeKAccun0sy2LnsEZ/MEDp9egqCkN1SLVWYzqdUsrR9yoVKhKD4ZDycMRy84Rau81iNqPgLh/vqtBHOq1uv9gvLhfX7zVVvQLMS3CE3UQy5wwPdINnjQ6a7hHHIVEUXx1eLIp1PB5zZ22ZP442+Wb5F+48+o3fDze4/3qVmVRbWiQRs8Ul77oYZHOMIGPuwnwqPU0TgiC8ZpKzqHRP+fHVYz76/BM+/vJTHuyv09AU5kKu9Hx1jTvPV4kFdBqFWH5EmCRyMMG3IhI/FUAf0zIIBTgHvJwvcM0Jc2kJsr8UEjmjec7w1+MGd2rLhJ6FYZuYjkEc2qSRSxzZeIZNYMltTkzpU1daMyzeTywVZzKiqbZ4fPSGteN/6egKpTCwyeYRumey2t7haassUtmkYbQkayylSg+zvHZhFibEkwlRYLKYhwQirReDA27tPObG7iM2BnW55YlGlMX4scWT7jY/H71kqbnOsdmWm0gIU5sDtUFt1KQ6bHDe60orTAHTCRydt+oRT1qbPOtsceoIw/Goj+ebZLHDaNLHdFUBioRBBLMQNRpx6/ApNzaX+Hr7IX+ebxJ7gUjKx5+o7J3WuVev8sPBHtudtgDqfdRBm2G/xXDYRTVGAhgWB5gFRDOHqnnOVmufV61d3pzu0Ls4o6ec4eldVkTQH9y8x3tf/cRnr99SMg0Vc9xnrHUxxj00ayzl+9I2X27RJw4sZombDyVpYtPrnNA+r9FsHmIOWqxUj/jw7n3ev/0LX2xsUzL0IeNRD9saMNR6KCMNJw7Q5cYHSovt8ia16h76UCFyRPySwHXG5JVFvsGZaPLp4T4PK3scKxdXDDfWX/Do4QMpu03oW/iJAFo6ld0y+xLb5Q2qu/sEus1F+5hGfZ/j2h7di2YBmlcQuxqp3EPJEsDK3lvWXz9nJExV0VsQe9LDoCg5m7pFXM590qkjQBVOGod02g06AhiHExk5j0CAp6l3dSmmMcA2hwLYRzO0Qn9BYrGW67JdZrWzw99KhZXGBufjFpnvCDNLwCyZDo8sdWQw9CtAY6wSSZY0tkmiCYmszAOMSOfu0TNuvl3m9s4jvt19wq3KX1Qmp8hsMktDSRwVEstSsT5hmKU+pYlt4IYeUwGaSQZmURGzaUBX/K8+PmfvokpNPaPlKhjmmEhGMZW+TRNHzrhF2a6tCSHpoRcEIhVbMrgyiwNeNURrJ/ucqh0ysa5ZHDNPU2l8QuKGeGMRtPw2d23Pc4u9LeOoizpyuyvl1hXmbiFP01P5vvaS7w7X+EfmcpqKm4u1u56ARD6W5mOPAuI0JpHZnuVuI0++RlFU7AtAI8rwU/HBaEpPGO8oAzQxXV0sqrxb4ahWp95oytrg4KjOQNMlUYCqjaTn4gN+IBYXXAHmxpnNxQv/j9xGjYlHq92h3VVodxROzs5pXXQ5bbU5k7+GjtIr3mkCmLObTrNrR/8PKjNPvFSeA04AAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"Airflow\" title=\"\" src=\"/static/7d6f32586aff58da6a85271562123550/c5bb3/airflow.png\" srcset=\"/static/7d6f32586aff58da6a85271562123550/04472/airflow.png 170w,\n/static/7d6f32586aff58da6a85271562123550/9f933/airflow.png 340w,\n/static/7d6f32586aff58da6a85271562123550/c5bb3/airflow.png 680w,\n/static/7d6f32586aff58da6a85271562123550/b12f7/airflow.png 1020w,\n/static/7d6f32586aff58da6a85271562123550/6f2be/airflow.png 1029w\" sizes=\"(max-width: 680px) 100vw, 680px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n    </span>\n          </p>\n<h3 id=\"-more-airflow-terminology\" style=\"position:relative;\"><a href=\"#-more-airflow-terminology\" aria-label=\" more airflow terminology permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üî• More Airflow Terminology</h3>\n<ul>\n<li><strong>Operators</strong>: They are the fundamental elements of a DAG. They outline the actual work that the DAG will carry out. The nature of the task is determined by the operators. They are represented by a Python class that serves as a task type template. They are idempotent.</li>\n<li>\n<ul>\n<li>BashOperator‚Ää-‚ÄäExecutes a bash command.</li>\n<li>PythonOperator‚Ää-‚ÄäRuns a Python function.</li>\n<li>SparkSubmitOperator‚Ää-‚ÄäExecutes spark-submit.</li>\n</ul>\n</li>\n<li><strong>Task</strong>: A task is an instance of an operator or sensor.</li>\n<li><strong>Plugins</strong>: They offer a convenient way to write, share, and activate custom runtime behavior.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">__init__.py\n                <span class=\"token operator\">|</span>-- airflow_plugin.py\nhooks/\n                <span class=\"token operator\">|</span>-- __init__.py\n                <span class=\"token operator\">|</span>-- airflow_hook.py\noperators/\n                <span class=\"token operator\">|</span>-- __init__.py\n                <span class=\"token operator\">|</span>-- airflow_operator.py\nsensors/\n                <span class=\"token operator\">|</span>-- __init__.py\n                <span class=\"token operator\">|</span>-- airflow_sensor.py</code></pre></div>\n<blockquote>\n<p>Note: In MWAA, we don't have direct access to the runtime where tasks are being processed. We can use <code class=\"language-text\">requirements.txt</code> to install available Python modules. For unavailable or custom modules, we can create a zip of the packages locally, upload it to S3, and use it as needed.</p>\n</blockquote>\n<ul>\n<li><strong>Hooks</strong>: Provide a way to connect your DAG to your environment. They serve as an interface for interacting with external systems. For example, we can establish an S3 connection and use S3 Hooks to retrieve the connection information and perform our task. There are various hooks available (HTTP, Hive, Slack, MySQL), and more are continuously being added by the community.</li>\n<li><strong>Sensors</strong>: They are special operators used to monitor (or poll) long-running tasks, files, database rows, S3 keys, other DAGs/tasks, etc.</li>\n<li><strong>XComs</strong>: XComs (cross-communication) are designed to facilitate communication between tasks. We use <code class=\"language-text\">xcom_push</code> and <code class=\"language-text\">xcom_pull</code> to store and retrieve variables, respectively.</li>\n</ul>\n<p>Tasks transition from one state to another during the execution of a DAG. Initially, the Airflow scheduler determines if it's time for a task to run and whether all other dependencies for the task have been met. At this point, the task enters the scheduled state. When a task is assigned to an executor, it enters the queued state. When the executor picks up the task and a worker begins executing the task, the task enters the <strong>running</strong> state.</p>\n<p><span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 56.470588235294116%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAALABQDASIAAhEBAxEB/8QAFwABAQEBAAAAAAAAAAAAAAAAAAIBBf/EABQBAQAAAAAAAAAAAAAAAAAAAAD/2gAMAwEAAhADEAAAAe9NDQf/xAAWEAADAAAAAAAAAAAAAAAAAAAAASD/2gAIAQEAAQUCHP8A/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPwE//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPwE//8QAFBABAAAAAAAAAAAAAAAAAAAAIP/aAAgBAQAGPwJf/8QAGRAAAwEBAQAAAAAAAAAAAAAAAREhACBh/9oACAEBAAE/IXVoIYNKmHnH/9oADAMBAAIAAwAAABAwD//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8QP//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8QP//EABkQAAIDAQAAAAAAAAAAAAAAAAERACExQf/aAAgBAQABPxBh2O7DDCDmt7FRDUexlw3tqAz/2Q=='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"States\" title=\"\" src=\"/static/358174cd60668bd1771416ec0f939da5/7bf67/states.jpg\" srcset=\"/static/358174cd60668bd1771416ec0f939da5/651be/states.jpg 170w,\n/static/358174cd60668bd1771416ec0f939da5/d30a3/states.jpg 340w,\n/static/358174cd60668bd1771416ec0f939da5/7bf67/states.jpg 680w,\n/static/358174cd60668bd1771416ec0f939da5/990cb/states.jpg 1020w,\n/static/358174cd60668bd1771416ec0f939da5/c44b8/states.jpg 1360w,\n/static/358174cd60668bd1771416ec0f939da5/b17f8/states.jpg 1600w\" sizes=\"(max-width: 680px) 100vw, 680px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n    </span>\n          </p>\n<h2 id=\"-demo-mwaa-airflow-dag-on-eks\" style=\"position:relative;\"><a href=\"#-demo-mwaa-airflow-dag-on-eks\" aria-label=\" demo mwaa airflow dag on eks permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üöÄ Demo: MWAA Airflow DAG on EKS</h2>\n<p>A Directed Acyclic Graph (DAG) is a graphical representation of a workflow in Airflow. It organizes tasks in a manner that clearly illustrates the relationships and dependencies between each task. The context for executing tasks is contained within the DAGs. In MWAA, DAGs are stored in Amazon S3. When a new DAG file is introduced, it takes approximately one minute for Amazon MWAA to begin utilizing the new file.</p>\n<p>Amazon Managed Workflows for Apache Airflow MWAA is a managed service that simplifies the orchestration of Apache Airflow, making it more straightforward to establish and manage comprehensive data pipelines in the cloud at a large scale. With Managed Workflows, you have the ability to employ Airflow and Python to construct workflows, without the need to handle the underlying infrastructure required for scalability, availability, and security.</p>\n<h3 id=\"provision-the-infrastructure\" style=\"position:relative;\"><a href=\"#provision-the-infrastructure\" aria-label=\"provision the infrastructure permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Provision the Infrastructure</h3>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">git</span> clone https://github.com/seifrajhi/data-on-eks.git\n<span class=\"token builtin class-name\">cd</span> data-on-eks/schedulers/terraform/managed-airflow-mwaa\n<span class=\"token function\">chmod</span> +x install.sh\n./install.sh</code></pre></div>\n<p>The following components are provisioned in your environment:</p>\n<ul>\n<li>A VPC with 3 Private Subnets and 3 Public Subnets.</li>\n<li>Internet gateway for Public Subnets and NAT Gateway for Private Subnets.</li>\n<li>EKS Cluster with one managed node group.</li>\n<li>K8S metrics server and cluster autoscaler.</li>\n<li>A MWAA environment in version 2.2.2.</li>\n<li>A S3 bucket with DAG code.</li>\n</ul>\n<p>After a few minutes, the script will finish and you can run the below commands:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">aws eks <span class=\"token parameter variable\">--region</span> eu-west-1 update-kubeconfig <span class=\"token parameter variable\">--name</span> managed-airflow-mwaa\nkubectl get namespaces</code></pre></div>\n<p>You should see output similar to the following:</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">default           Active    8m\nemr-mwaa          Active    4m\nkube-node-lease   Active    9m\nkube-public       Active    9m\nkube-system       Active    9m\nmwaa              Active    3m</code></pre></div>\n<h3 id=\"log-into-apache-airflow-ui\" style=\"position:relative;\"><a href=\"#log-into-apache-airflow-ui\" aria-label=\"log into apache airflow ui permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Log into Apache Airflow UI</h3>\n<ol>\n<li>Open the Environments page on the Amazon MWAA console.</li>\n<li>Choose an environment.</li>\n<li>Under the Details section, click the link for the Airflow UI.</li>\n</ol>\n<h3 id=\"trigger-the-dag-workflow-to-execute-job-in-eks\" style=\"position:relative;\"><a href=\"#trigger-the-dag-workflow-to-execute-job-in-eks\" aria-label=\"trigger the dag workflow to execute job in eks permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Trigger the DAG Workflow to Execute Job in EKS</h3>\n<ol>\n<li>In the Airflow UI, enable the example DAG <code class=\"language-text\">kubernetes_pod_example</code> and then trigger it.</li>\n</ol>\n<p><span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 22.941176470588236%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAr0lEQVR42qWQSw7DIAxEc/97dlGlwQGCTfh4aqDbrGppNAPI1sPbeXoQnVMj996hquY6XfvK3fJTtdasd/Vvr/cBHyLIDs5H+EtwJUaIafpQvBgsGbVU1FpRhkpZXtfdAKmtYiNy4JQgnJDkRkg3sjBEBMzmvLIPHrv/gNyB6Ha4GIzIwZMBDToikxGOyYAi33l+8anGW9O2VtLbXIFq/0knZTKwObDbZS4Z/9aY9QWoC4fIGKiBiAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"UI\" title=\"\" src=\"/static/5eac917d55b4aa9d8d88c469ca802548/c5bb3/ui.png\" srcset=\"/static/5eac917d55b4aa9d8d88c469ca802548/04472/ui.png 170w,\n/static/5eac917d55b4aa9d8d88c469ca802548/9f933/ui.png 340w,\n/static/5eac917d55b4aa9d8d88c469ca802548/c5bb3/ui.png 680w,\n/static/5eac917d55b4aa9d8d88c469ca802548/b12f7/ui.png 1020w,\n/static/5eac917d55b4aa9d8d88c469ca802548/b5a09/ui.png 1360w,\n/static/5eac917d55b4aa9d8d88c469ca802548/29007/ui.png 1600w\" sizes=\"(max-width: 680px) 100vw, 680px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n    </span>\n          </p>\n<h3 id=\"verify-that-the-pod-was-executed-successfully\" style=\"position:relative;\"><a href=\"#verify-that-the-pod-was-executed-successfully\" aria-label=\"verify that the pod was executed successfully permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Verify that the Pod was Executed Successfully</h3>\n<p>After it runs and completes successfully, use the following command to verify the pod:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">kubectl get pods <span class=\"token parameter variable\">-n</span> mwaa</code></pre></div>\n<p>You should see output similar to the following:</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">NAME                                             READY   STATUS      RESTARTS   AGE\nmwaa-pod-test.4bed823d645844bc8e6899fd858f119d   <span class=\"token number\">0</span>/1     Completed   <span class=\"token number\">0</span>          25s</code></pre></div>\n<h2 id=\"Ô∏è-key-takeaways\" style=\"position:relative;\"><a href=\"#%EF%B8%8F-key-takeaways\" aria-label=\"Ô∏è key takeaways permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üóùÔ∏è Key Takeaways</h2>\n<p>Automating and organizing data tasks is very important for managing work and resources well in Kubernetes. This is where Job Schedulers are useful. They run jobs that are done either once or many times, making sure tasks are finished when needed. On the other hand, Batch-Oriented Workflow Orchestrators give more control. They allow for complex job scheduling, including the order of tasks and their dependencies.</p>\n<p><strong>Stay tuned for next blogs in this series üéâ</strong></p>\n<p><strong>References:</strong></p>\n<ul>\n<li><a href=\"https://docs.aws.amazon.com/mwaa/latest/userguide/mwaa-eks-example.html\" target=\"_blank\" rel=\"noopener noreferrer\">https://docs.aws.amazon.com/mwaa/latest/userguide/mwaa-eks-example.html</a></li>\n<li><a href=\"https://medium.com/apache-airflow/what-we-learned-after-running-airflow-on-kubernetes-for-2-years-0537b157acfd\" target=\"_blank\" rel=\"noopener noreferrer\">https://medium.com/apache-airflow/what-we-learned-after-running-airflow-on-kubernetes-for-2-years-0537b157acfd</a></li>\n<li><a href=\"https://medium.com/@binayalenka/airflow-architecture-667f1cc613e8\" target=\"_blank\" rel=\"noopener noreferrer\">https://medium.com/@binayalenka/airflow-architecture-667f1cc613e8</a></li>\n<li><a href=\"https://awslabs.github.io/data-on-eks/docs/blueprints/job-schedulers/aws-managed-airflow\" target=\"_blank\" rel=\"noopener noreferrer\">https://awslabs.github.io/data-on-eks/docs/blueprints/job-schedulers/aws-managed-airflow</a></li>\n</ul>\n<p><strong>Thank You üñ§</strong></p>\n<br>\n<p><strong><em>Until next time, „Å§„Å•„Åè üéâ</em></strong></p>\n<blockquote>\n<p>üí° Thank you for Reading !! üôåüèªüòÅüìÉ, see you in the next blog.ü§ò  <strong><em>Until next time üéâ</em></strong></p>\n</blockquote>\n<p>üöÄ Thank you for sticking up till the end. If you have any questions/feedback regarding this blog feel free to connect with me:</p>\n<p><strong>‚ôªÔ∏è LinkedIn:</strong> <a href=\"https://www.linkedin.com/in/rajhi-saif/\" target=\"_blank\" rel=\"noopener noreferrer\">https://www.linkedin.com/in/rajhi-saif/</a></p>\n<p><strong>‚ôªÔ∏è X/Twitter:</strong> <a href=\"https://x.com/rajhisaifeddine\" target=\"_blank\" rel=\"noopener noreferrer\">https://x.com/rajhisaifeddine</a></p>\n<p><strong>The end ‚úåüèª</strong></p>\n<h1 align=\"center\">üî∞ Keep Learning !! Keep Sharing !! üî∞</h1>\n<p><strong>üìÖ Stay updated</strong></p>\n<p>Subscribe to our newsletter for more insights on AWS cloud computing and containers.</p>"}}},"staticQueryHashes":["1271460761","1321585977"],"slicesMap":{}}