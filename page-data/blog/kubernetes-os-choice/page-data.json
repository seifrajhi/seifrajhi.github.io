{"componentChunkName":"component---src-templates-blog-template-js","path":"/blog/kubernetes-os-choice/","result":{"data":{"markdownRemark":{"html":"<blockquote>\n<p><strong>How to select the optimal OS for running your Kubernetes clusters</strong></p>\n</blockquote>\n<h2 id=\"-introduction\" style=\"position:relative;\"><a href=\"#-introduction\" aria-label=\" introduction permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>📚 Introduction</h2>\n<p>Selecting the most suitable Linux OS is important for enmeshing the OS tightly with Kubernetes, treating the entire cluster as a single computer, reducing overhead, and enhancing security.</p>\n<p>This guide aims to provide a comprehensive overview of the considerations involved in choosing the right Linux OS for Kubernetes deployments, including the distinction between general-purpose Linux OSs and container-optimized OSs, the implications of the underlying OS, and the benefits of adopting a container-specific OS for running Kubernetes.</p>\n<p>Additionally, the guide will explore different installation types and provide insights into the implications of the underlying OS for the overall performance and security of a Kubernetes cluster.</p>\n<h2 id=\"-choosing-the-most-suitable-linuxos\" style=\"position:relative;\"><a href=\"#-choosing-the-most-suitable-linuxos\" aria-label=\" choosing the most suitable linuxos permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>⫸ Choosing the most suitable Linux OS</h2>\n<p>When considering Kubernetes for container management, it's essential to understand its benefits and dependencies. Kubernetes handles workload scheduling, scaling, and automation, making system management easier. However, it relies on an underlying operating system like Linux or Windows. Despite being an application itself, Kubernetes requires a robust OS to run efficiently.</p>\n<p>While Kubernetes streamlines container management, it doesn't directly address OS maintenance. Neglecting OS updates and security can lead to issues, especially during audits. Therefore, it's crucial to choose the right Linux distribution to support Kubernetes deployments.</p>\n<p>There are two main types of Linux distributions for Kubernetes: container-optimized and general-purpose. Each has its advantages, but selecting the best one depends on your specific needs and preferences.</p>\n<div class=\"note\">\n    <p><strong>🔵 Note:</strong></p>\n    <p>Ultimately, a well-chosen Linux distribution can simplify maintenance tasks and enhance the overall performance of your Kubernetes environment.</p>\n</div>\n<h2 id=\"-managing-general-purpose-linux-os-for-kubernetes\" style=\"position:relative;\"><a href=\"#-managing-general-purpose-linux-os-for-kubernetes\" aria-label=\" managing general purpose linux os for kubernetes permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>⫸ Managing general-purpose Linux OS for Kubernetes</h2>\n<p>General-purpose Linux operating systems like <code class=\"language-text\">Ubuntu</code>, <code class=\"language-text\">Debian</code>, <code class=\"language-text\">CentOS</code>, <code class=\"language-text\">Red Hat Enterprise Linux (RHEL)</code>, and <code class=\"language-text\">Fedora</code> are commonly used as the foundation for Kubernetes clusters. While they offer familiarity and existing administration tools, they also come with certain challenges.</p>\n<p>The advantage of using a general-purpose Linux OS lies in the familiarity of system administrators with installing, updating, and securing these distributions.\nExisting tools for server setup and security management can be leveraged for Kubernetes nodes.</p>\n<p>However, administering a general-purpose Linux system entails various tasks such as user account management, patching, firewall configuration, and kernel updates. Coordinating these tasks with Kubernetes maintenance can be challenging, leading to outdated OS versions and security vulnerabilities.</p>\n<p>Ideally, automation platforms like <code class=\"language-text\">Ansible</code> or <code class=\"language-text\">Puppet</code> should synchronize with Kubernetes to manage OS updates without disrupting operations. This involves steps like cordoning and draining nodes, updating and patching, and uncordoning nodes while ensuring minimal impact on cluster workload capacity.</p>\n<p>Despite the familiarity and troubleshooting capabilities of general-purpose Linux OS, the overhead of system administration and coordination with Kubernetes updates remains a concern. It's essential to strike a balance between familiarity and the need for efficient management of Kubernetes infrastructure.</p>\n<h2 id=\"-managing-container-specific-os-fork8s\" style=\"position:relative;\"><a href=\"#-managing-container-specific-os-fork8s\" aria-label=\" managing container specific os fork8s permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>⫸ Managing container-specific OS for K8s</h2>\n<p>Container-specific operating systems offer a minimalist approach explicitly designed to run containers, with all non-essential services disabled and hardened security practices in place. This approach reduces attack surfaces and vulnerabilities, making container-specific OSs inherently more secure.</p>\n<p>According to the National Institute of Standards and Technology (NIST), container-specific OSs have smaller attack surfaces compared to general-purpose OSs, leading to fewer opportunities for attacks and compromises. As a result, organizations are encouraged to prioritize container-specific OSs for enhanced security.</p>\n<p>One key advantage of container-specific OSs - PhotonOS from VMware for instance- is their minimalistic nature, which reduces the number of running software and packages, thereby minimizing potential vulnerabilities.</p>\n<p>Additionally, these OSs often employ read-only file systems and other security measures to further mitigate the impact of vulnerabilities.</p>\n<p>Unlike general-purpose OSs, container-specific OSs typically do not support package managers or traditional configuration management tools like Chef and Puppet. Instead, complete OS images with all updates and configurations are installed in an alternate boot mechanism, allowing for easy rollback to known good configurations.</p>\n<p>Cloud-optimized versions of general-purpose Linux systems, like Ubuntu's \"cloud images,\" may still be full distributions with additional cloud-init packages for easier configuration.</p>\n<p>Current container-specific OSs prioritize minimalism, security, containerized processes, and atomic updates. Examples include:</p>\n<ul>\n<li>\n<p><a href=\"https://cloud.google.com/container-optimized-os/docs\" target=\"_blank\" rel=\"noopener noreferrer\">Google's \"Container-Optimized OS\" for GCP</a>: featuring a read-only root file system and SSH support.</p>\n</li>\n<li>\n<p><a href=\"https://github.com/rancher/os-base\" target=\"_blank\" rel=\"noopener noreferrer\">RancherOS</a>: which supports SSH and lacks a read-only file system for root protection.</p>\n</li>\n<li>\n<p><a href=\"https://github.com/rancher/elemental\" target=\"_blank\" rel=\"noopener noreferrer\">Elemental</a>: a Rancher project offering SSH support and management via Kubectl.</p>\n</li>\n<li>\n<p><a href=\"https://bottlerocket.dev/\" target=\"_blank\" rel=\"noopener noreferrer\">AWS Bottlerocket</a>: initially designed for AWS workloads, with an immutable root file system and SSH support.</p>\n</li>\n<li>\n<p><a href=\"https://www.siderolabs.com/platform/talos-os-for-kubernetes/\" target=\"_blank\" rel=\"noopener noreferrer\">Talos OS</a>: the most opinionated, removes SSH and console access, relying solely on API-driven management. It emphasizes immutable infrastructure, with all actions managed through Kubernetes.</p>\n</li>\n</ul>\n<p>Talos OS's approach improves security, reduces maintenance, and mitigates cvE impacts by enforcing API-driven management and immutable file systems. While some may question the trade-offs, its API-managed approach is well-suited for large-scale operations and management, providing consistent access to node logs and container information.</p>\n<div class=\"tip\">\n    <p><strong>💡 TIP:</strong></p>\n    <p>Talos OS pushes the boundaries of immutable infrastructure by removing SSH and console access, relying solely on API-driven management. It offers API calls for all node-related tasks, such as container inspection and network setup, while restricting actions like unmounting file systems. Talos OS also rewrites the Linux Init system to focus solely on starting Kubernetes..</p>\n</div>\n<p>Although some may question the trade-offs of relinquishing SSH access and constraining SRE actions, Talos OS follows the trend of immutable containers and offers a robust solution for large-scale operations and management. Its API-driven approach ensures consistent access to node logs and container information, regardless of scale or complexity</p>\n<h2 id=\"-conclusion\" style=\"position:relative;\"><a href=\"#-conclusion\" aria-label=\" conclusion permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>🖋 Conclusion</h2>\n<p>With many enterprises still early in their Kubernetes journey, now is the time to explore container-specific OSs. By tightly integrating the OS with Kubernetes, organizations can streamline operations, boost security, and focus on delivering value through workloads.</p>\n<p>This approach aligns with the vision of an API-driven data center, where the Kubernetes cluster acts as a cohesive unit, minimizing overhead and simplifying management.</p>\n<p><strong><em>Until next time, つづく 🎉 🇵🇸</em></strong></p>\n<p><br><br></p>\n<blockquote>\n<p>💡 Thank you for Reading !! 🙌🏻😁📃, see you in the next blog.🤘  <em><strong>Until next time 🎉</strong></em></p>\n</blockquote>\n<p>🚀 Thank you for sticking up till the end. If you have any questions/feedback regarding this blog feel free to connect with me:</p>\n<p><strong>♻️ LinkedIn:</strong> <a href=\"https://www.linkedin.com/in/rajhi-saif/\" target=\"_blank\" rel=\"noopener noreferrer\">https://www.linkedin.com/in/rajhi-saif/</a></p>\n<p><strong>♻️ X/Twitter:</strong> <a href=\"https://x.com/rajhisaifeddine\" target=\"_blank\" rel=\"noopener noreferrer\">https://x.com/rajhisaifeddine</a></p>\n<p><strong>The end ✌🏻</strong></p>\n<h1 align=\"center\">🔰 Keep Learning !! Keep Sharing !! 🔰</h1>\n<p><strong>📅 Stay updated</strong></p>\n<p>Subscribe to our newsletter for more insights on AWS cloud computing and containers.</p>","timeToRead":4,"rawMarkdownBody":"\n> **How to select the optimal OS for running your Kubernetes clusters**\n\n## 📚 Introduction\n\nSelecting the most suitable Linux OS is important for enmeshing the OS tightly with Kubernetes, treating the entire cluster as a single computer, reducing overhead, and enhancing security.\n\nThis guide aims to provide a comprehensive overview of the considerations involved in choosing the right Linux OS for Kubernetes deployments, including the distinction between general-purpose Linux OSs and container-optimized OSs, the implications of the underlying OS, and the benefits of adopting a container-specific OS for running Kubernetes.\n\nAdditionally, the guide will explore different installation types and provide insights into the implications of the underlying OS for the overall performance and security of a Kubernetes cluster.\n\n## ⫸ Choosing the most suitable Linux OS\n\nWhen considering Kubernetes for container management, it's essential to understand its benefits and dependencies. Kubernetes handles workload scheduling, scaling, and automation, making system management easier. However, it relies on an underlying operating system like Linux or Windows. Despite being an application itself, Kubernetes requires a robust OS to run efficiently.\n\nWhile Kubernetes streamlines container management, it doesn't directly address OS maintenance. Neglecting OS updates and security can lead to issues, especially during audits. Therefore, it's crucial to choose the right Linux distribution to support Kubernetes deployments.\n\nThere are two main types of Linux distributions for Kubernetes: container-optimized and general-purpose. Each has its advantages, but selecting the best one depends on your specific needs and preferences.\n\n<div class=\"note\">\n    <p><strong>🔵 Note:</strong></p>\n    <p>Ultimately, a well-chosen Linux distribution can simplify maintenance tasks and enhance the overall performance of your Kubernetes environment.</p>\n</div>\n\n## ⫸ Managing general-purpose Linux OS for Kubernetes\n\nGeneral-purpose Linux operating systems like `Ubuntu`, `Debian`, `CentOS`, `Red Hat Enterprise Linux (RHEL)`, and `Fedora` are commonly used as the foundation for Kubernetes clusters. While they offer familiarity and existing administration tools, they also come with certain challenges.\n\nThe advantage of using a general-purpose Linux OS lies in the familiarity of system administrators with installing, updating, and securing these distributions.\nExisting tools for server setup and security management can be leveraged for Kubernetes nodes.\n\nHowever, administering a general-purpose Linux system entails various tasks such as user account management, patching, firewall configuration, and kernel updates. Coordinating these tasks with Kubernetes maintenance can be challenging, leading to outdated OS versions and security vulnerabilities.\n\nIdeally, automation platforms like `Ansible` or `Puppet` should synchronize with Kubernetes to manage OS updates without disrupting operations. This involves steps like cordoning and draining nodes, updating and patching, and uncordoning nodes while ensuring minimal impact on cluster workload capacity.\n\nDespite the familiarity and troubleshooting capabilities of general-purpose Linux OS, the overhead of system administration and coordination with Kubernetes updates remains a concern. It's essential to strike a balance between familiarity and the need for efficient management of Kubernetes infrastructure.\n\n## ⫸ Managing container-specific OS for K8s\n\nContainer-specific operating systems offer a minimalist approach explicitly designed to run containers, with all non-essential services disabled and hardened security practices in place. This approach reduces attack surfaces and vulnerabilities, making container-specific OSs inherently more secure.\n\nAccording to the National Institute of Standards and Technology (NIST), container-specific OSs have smaller attack surfaces compared to general-purpose OSs, leading to fewer opportunities for attacks and compromises. As a result, organizations are encouraged to prioritize container-specific OSs for enhanced security.\n\nOne key advantage of container-specific OSs - PhotonOS from VMware for instance- is their minimalistic nature, which reduces the number of running software and packages, thereby minimizing potential vulnerabilities.\n\nAdditionally, these OSs often employ read-only file systems and other security measures to further mitigate the impact of vulnerabilities.\n\nUnlike general-purpose OSs, container-specific OSs typically do not support package managers or traditional configuration management tools like Chef and Puppet. Instead, complete OS images with all updates and configurations are installed in an alternate boot mechanism, allowing for easy rollback to known good configurations.\n\nCloud-optimized versions of general-purpose Linux systems, like Ubuntu's \"cloud images,\" may still be full distributions with additional cloud-init packages for easier configuration.\n\n\nCurrent container-specific OSs prioritize minimalism, security, containerized processes, and atomic updates. Examples include:\n\n\n- [Google's \"Container-Optimized OS\" for GCP](https://cloud.google.com/container-optimized-os/docs): featuring a read-only root file system and SSH support.\n\n- [RancherOS](https://github.com/rancher/os-base): which supports SSH and lacks a read-only file system for root protection.\n\n- [Elemental](https://github.com/rancher/elemental): a Rancher project offering SSH support and management via Kubectl.\n\n- [AWS Bottlerocket](https://bottlerocket.dev/): initially designed for AWS workloads, with an immutable root file system and SSH support.\n\n- [Talos OS](https://www.siderolabs.com/platform/talos-os-for-kubernetes/): the most opinionated, removes SSH and console access, relying solely on API-driven management. It emphasizes immutable infrastructure, with all actions managed through Kubernetes.\n\n\nTalos OS's approach improves security, reduces maintenance, and mitigates cvE impacts by enforcing API-driven management and immutable file systems. While some may question the trade-offs, its API-managed approach is well-suited for large-scale operations and management, providing consistent access to node logs and container information.\n\n<div class=\"tip\">\n    <p><strong>💡 TIP:</strong></p>\n    <p>Talos OS pushes the boundaries of immutable infrastructure by removing SSH and console access, relying solely on API-driven management. It offers API calls for all node-related tasks, such as container inspection and network setup, while restricting actions like unmounting file systems. Talos OS also rewrites the Linux Init system to focus solely on starting Kubernetes..</p>\n</div>\n\n\nAlthough some may question the trade-offs of relinquishing SSH access and constraining SRE actions, Talos OS follows the trend of immutable containers and offers a robust solution for large-scale operations and management. Its API-driven approach ensures consistent access to node logs and container information, regardless of scale or complexity\n\n## 🖋 Conclusion\n\nWith many enterprises still early in their Kubernetes journey, now is the time to explore container-specific OSs. By tightly integrating the OS with Kubernetes, organizations can streamline operations, boost security, and focus on delivering value through workloads. \n\nThis approach aligns with the vision of an API-driven data center, where the Kubernetes cluster acts as a cohesive unit, minimizing overhead and simplifying management.\n\n**_Until next time, つづく 🎉 🇵🇸_**\n\n<br><br>\n\n> 💡 Thank you for Reading !! 🙌🏻😁📃, see you in the next blog.🤘  _**Until next time 🎉**_\n\n🚀 Thank you for sticking up till the end. If you have any questions/feedback regarding this blog feel free to connect with me:\n\n**♻️ LinkedIn:** https://www.linkedin.com/in/rajhi-saif/\n\n**♻️ X/Twitter:** https://x.com/rajhisaifeddine\n\n**The end ✌🏻**\n\n<h1 align=\"center\">🔰 Keep Learning !! Keep Sharing !! 🔰</h1>\n\n**📅 Stay updated**\n\nSubscribe to our newsletter for more insights on AWS cloud computing and containers.\n","wordCount":{"words":935},"frontmatter":{"id":"aa03ffc28a80c7a5a1bc71b6","path":"/blog/kubernetes-os-choice/","humanDate":"Oct 10, 2024","fullDate":"2024-10-10","title":"Choosing the right Linux Operating System for your Kubernetes cluster","keywords":["kubernetes cluster","RancherOS","Operating system","Talos OS","AWS Bottlerocket"],"excerpt":"kubernetes cluster, Operating system, Talos OS, RancherOS, AWS Bottlerocket","cover":{"childImageSharp":{"gatsbyImageData":{"layout":"fullWidth","placeholder":{"fallback":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAADDUlEQVR42h2T60+TdxiG+4/sw/6NfZobMUSNbh2yBbCcFKwg5VRaxOLKWimltIWWIu1bsAJtKbBWYI6h6TTTbkO3lZ0ImSS6iH379sBJxS/LtR9+e5InuXPfz309qi0ZQovrVGnNlNeZqLg4QIlaR/XlQZquLXDsk3YuXltmIPaGvukC9tgu7vkM7rkXDATv0ep5QfuNXZq8Oc67cqjupg8JLj0Xy4dYx1P0+VKYPasEYmsEEs/ROx6g9/yJJbJPbyiHQSow8vW/TEwHSYy+j9/xMZorSVrGdjjvVFAlUq9JpN7QY7uFRmuhpduLtPAYvdlLjbYXQ38UaeU1/m9fCZc7dI4X8Cz8hV+ykp5RsSK9R6UhSfNojnpnFlU0WWRieRvHzTVm4z8QjP1EX/BvhkSczsF7GF33WX6UwbdY5MpEga5AnquTMl9OHTATrMY70kqj562InKV+KI+qVufg03NG6pq/wmSbRKt38pmmnbGZu3T23aS5J0D5BQunKw3oXBsYg7t0SwqWOWgwxTl1toMO6S2NLoW6I0F//BnO8BbhbzbwRtJcn1wnspzGHV5nIv47ntgWPYGnDEc36PLLdIjIarNCiSHD8W6ZGodCiy9PgzsvZlFKOHnI7bX/WPk5S6POTEObHU/oe+p1Nk5/3szY/AaLT2D+0SHDiT3KrArlFhnHnCJaz1Fi3KbakadxOI9mUJQSWt0n9mCPW3eeMbsq3Iz9gZT4h9DSJuPi+HrfJqO3i0x+t481vEPpVRl3PEsyXST5W4HqoW1O9irvBCttohT/nQMc0W2Ol+k5UXYJdVUb6ooWjqn1nNMNc6aiDd/CU8zhAy6NKHzY9RK7cHd/PcfSjwq1QrC0R+aCYLCi/0hwZY+RxA5DszLd3l+R4puCwcdcl1K4pn8hklQwTxVou1FA7y9Q3p/jI+NLWsdl6lwyH7RnqHXmqbZn+cIqo5p/+ApP4gBbJEuNfoqqJgcnNRbKtB5Kq2zYoxmsAmqdL8fl0YIAu/juI06YspwyKdQ4j/jLUSncnbXI/A/YtXWki85xQQAAAABJRU5ErkJggg=="},"images":{"fallback":{"src":"/static/b8fde21ce17b47bf06372f9d67ab9e4c/dfb4e/k8s-os.png","srcSet":"/static/b8fde21ce17b47bf06372f9d67ab9e4c/23c6c/k8s-os.png 750w,\n/static/b8fde21ce17b47bf06372f9d67ab9e4c/99aa4/k8s-os.png 1080w,\n/static/b8fde21ce17b47bf06372f9d67ab9e4c/a6044/k8s-os.png 1366w,\n/static/b8fde21ce17b47bf06372f9d67ab9e4c/dfb4e/k8s-os.png 1594w","sizes":"100vw"},"sources":[{"srcSet":"/static/b8fde21ce17b47bf06372f9d67ab9e4c/f8e3a/k8s-os.webp 750w,\n/static/b8fde21ce17b47bf06372f9d67ab9e4c/d70db/k8s-os.webp 1080w,\n/static/b8fde21ce17b47bf06372f9d67ab9e4c/d339b/k8s-os.webp 1366w,\n/static/b8fde21ce17b47bf06372f9d67ab9e4c/7c054/k8s-os.webp 1594w","type":"image/webp","sizes":"100vw"}]},"width":1,"height":0.5746549560853199}}},"coverCredits":"Photo by Saifeddine Rajhi"}}},"pageContext":{"prevThought":{"frontmatter":{"path":"/blog/eks-and-aws-secrets-manager/","title":"Manage secrets in AWS EKS with AWS Secrets Manager securely","date":"2024-10-13 07:34:00"},"excerpt":"Enhance security and simplify secrets management for K8s apps 🗯 Introduction Managing secrets like API keys and database passwords securely…","html":"<blockquote>\n<p><strong>Enhance security and simplify secrets management for K8s apps</strong></p>\n</blockquote>\n<h2 id=\"-introduction\" style=\"position:relative;\"><a href=\"#-introduction\" aria-label=\" introduction permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>🗯 Introduction</h2>\n<p>Managing secrets like API keys and database passwords securely is important to keep the applications running in Kubernetes secure.</p>\n<p>And if you're using Amazon EKS Elastic Kubernetes Service for your Kubernetes applications, AWS KMS with AWS Secrets Manager can help you handle these secrets safely and easily.</p>\n<h2 id=\"️-using-aws-secrets-manager-with-amazoneks\" style=\"position:relative;\"><a href=\"#%EF%B8%8F-using-aws-secrets-manager-with-amazoneks\" aria-label=\"️ using aws secrets manager with amazoneks permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>㊙️ Using AWS Secrets Manager with Amazon EKS</h2>\n<p><a href=\"https://docs.aws.amazon.com/secretsmanager/latest/userguide/integrating_csi_driver.html\" target=\"_blank\" rel=\"noopener noreferrer\">AWS Secrets Manager</a> can be integrated with EKS using the <a href=\"https://github.com/aws/secrets-store-csi-driver-provider-aws\" target=\"_blank\" rel=\"noopener noreferrer\">AWS Secrets and Configuration Provider ASCP</a> for the <a href=\"https://secrets-store-csi-driver.sigs.k8s.io/\" target=\"_blank\" rel=\"noopener noreferrer\">Kubernetes Secrets Store CSI Driver</a>.</p>\n<p><strong>Benefits:</strong></p>\n<ul>\n<li>Centralized secret management</li>\n<li>Fine-grained access control</li>\n<li>Seamless integration with EKS</li>\n<li>Ability to mount secrets as volumes in pods</li>\n<li>Option to sync with native Kubernetes secrets</li>\n</ul>\n<p><strong>Implementation steps:</strong></p>\n<ol>\n<li>Create secrets in AWS Secrets Manager</li>\n<li>Create an IAM policy for secret retrieval</li>\n<li>Use <a href=\"https://docs.aws.amazon.com/eks/latest/userguide/iam-roles-for-service-accounts.html\" target=\"_blank\" rel=\"noopener noreferrer\">IAM Roles for Service Accounts (IRSA)</a> to limit secret access</li>\n<li>Deploy a SecretProviderClass custom resource</li>\n<li>Configure pods to mount volumes based on the SecretProviderClass</li>\n<li>Sync mounted secrets to native Kubernetes secrets</li>\n<li>Set up environment variables in pods using specific secret keys</li>\n</ol>\n<h2 id=\"encrypting-kubernetes-secrets-in-amazoneks\" style=\"position:relative;\"><a href=\"#encrypting-kubernetes-secrets-in-amazoneks\" aria-label=\"encrypting kubernetes secrets in amazoneks permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Encrypting Kubernetes Secrets in Amazon EKS</h2>\n<p>Amazon EKS clusters (version 1.13+) support encrypting <a href=\"https://kubernetes.io/docs/concepts/configuration/secret/\" target=\"_blank\" rel=\"noopener noreferrer\">Kubernetes secrets</a> using <a href=\"https://docs.aws.amazon.com/kms/latest/developerguide/concepts.html\" target=\"_blank\" rel=\"noopener noreferrer\">AWS Key Management Service (KMS) Customer Managed Keys (CMK)</a>. This provides stronger security than the default Base64 encoding.\nKey points:</p>\n<ul>\n<li>No changes are required in how secrets are used.</li>\n<li>Encryption provider support must be enabled during EKS cluster creation</li>\n<li>Each secret write generates a unique Data Encryption Key (DEK).</li>\n<li>The DEK is encrypted with the CMK and stored in etcd.</li>\n<li>Decryption occurs when pods access the secret.</li>\n</ul>\n<h2 id=\"eks-secrets-and-secrets-manager-hands-onguide\" style=\"position:relative;\"><a href=\"#eks-secrets-and-secrets-manager-hands-onguide\" aria-label=\"eks secrets and secrets manager hands onguide permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>EKS Secrets and Secrets Manager hands-on guide</h2>\n<p>Let us start by provisioning our EKS cluster using Terraform the IAC tool.</p>\n<p>First, clone the repo:</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">$ <span class=\"token function\">git</span> clone https://github.com/seifrajhi/eks-secrets-manager-kms-demo.git</code></pre></div>\n<p>Then run the following commands:</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">$ <span class=\"token builtin class-name\">cd</span> eks-secrets-manager-kms-demo/eks-tf\n$ terraform init\n$ terraform plan\n$ terraform apply --auto-approve</code></pre></div>\n<p>This will provision the EKS cluster and VPC with the needed add-ons.</p>\n<h2 id=\"deploy-theapp\" style=\"position:relative;\"><a href=\"#deploy-theapp\" aria-label=\"deploy theapp permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Deploy the app</h2>\n<p>To deploy the app, clone the repo:</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">$ <span class=\"token function\">git</span> clone https://github.com/seifrajhi/eks-secrets-manager-kms-demo.git</code></pre></div>\n<p>For the deployment of our demo application, we have created the Helm chart and uploaded it to the <a href=\"https://github.com/seifrajhi/eks-secrets-manager-kms-demo/tree/main/helm-charts\" target=\"_blank\" rel=\"noopener noreferrer\">Git Repository</a>.</p>\n<p>Install the Helm chart:</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token builtin class-name\">cd</span> eks-secrets-manager-kms-demo/helm-charts\nhelm <span class=\"token function\">install</span> demo <span class=\"token builtin class-name\">.</span>\nNAME: demo\nLAST DEPLOYED: Sat Oct <span class=\"token number\">11</span> <span class=\"token number\">18</span>:42:20 <span class=\"token number\">2024</span>\nNAMESPACE: default\nSTATUS: deployed\nREVISION: <span class=\"token number\">1</span></code></pre></div>\n<h3 id=\"deploy-amazon-ebs-csidriver\" style=\"position:relative;\"><a href=\"#deploy-amazon-ebs-csidriver\" aria-label=\"deploy amazon ebs csidriver permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Deploy Amazon EBS CSI Driver</h3>\n<p><a href=\"https://github.com/container-storage-interface/spec/blob/master/spec.md\" target=\"_blank\" rel=\"noopener noreferrer\">The Container Storage Interface (CSI)</a> is a standard for exposing arbitrary block and file storage systems to containerized workloads on Container Orchestration Systems (COs) like Kubernetes.\nUsing CSI third-party storage providers can write and deploy plugins exposing new storage systems in Kubernetes without ever having to touch the core Kubernetes code.</p>\n<p><a href=\"https://github.com/kubernetes-sigs/aws-ebs-csi-driver\" target=\"_blank\" rel=\"noopener noreferrer\">The Amazon Elastic Block Store (Amazon EBS) Container Storage Interface (CSI) driver</a> provides a CSI interface that allows Amazon Elastic Kubernetes Service (Amazon EKS) clusters to manage the lifecycle of Amazon EBS volumes for persistent volumes.</p>\n<p>EBS was installed as part of the cluster add-ons.</p>\n<h3 id=\"define-storage-class\" style=\"position:relative;\"><a href=\"#define-storage-class\" aria-label=\"define storage class permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Define Storage Class</h3>\n<p><a href=\"https://kubernetes.io/docs/concepts/storage/dynamic-provisioning/\" target=\"_blank\" rel=\"noopener noreferrer\">Dynamic Volume Provisioning</a> allows storage volumes to be created on-demand.</p>\n<p><a href=\"https://kubernetes.io/docs/concepts/storage/storage-classes/\" target=\"_blank\" rel=\"noopener noreferrer\">StorageClass</a> should be pre-created to define which provisioner should be used and what parameters should be passed when dynamic provisioning is invoked.</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> StorageClass\n<span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> storage.k8s.io/v1\n<span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> mysql<span class=\"token punctuation\">-</span>gp3\n<span class=\"token key atrule\">provisioner</span><span class=\"token punctuation\">:</span> ebs.csi.aws.com <span class=\"token comment\"># &lt;--  Amazon EBS CSI driver</span>\n<span class=\"token key atrule\">parameters</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">type</span><span class=\"token punctuation\">:</span> gp3\n  <span class=\"token key atrule\">encrypted</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'true'</span> \n<span class=\"token key atrule\">volumeBindingMode</span><span class=\"token punctuation\">:</span> WaitForFirstConsumer\n<span class=\"token key atrule\">reclaimPolicy</span><span class=\"token punctuation\">:</span> Delete\n<span class=\"token key atrule\">mountOptions</span><span class=\"token punctuation\">:</span>\n<span class=\"token punctuation\">-</span> debug</code></pre></div>\n<p>Create storageclass <code class=\"language-text\">mysql-gp3</code> by running the following command:</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">kubectl create <span class=\"token parameter variable\">-f</span> sc-gp3-mysql.yaml</code></pre></div>\n<h3 id=\"deploy-statefulset-workload\" style=\"position:relative;\"><a href=\"#deploy-statefulset-workload\" aria-label=\"deploy statefulset workload permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Deploy StatefulSet workload</h3>\n<p>We are going to deploy a MYSQL database using StatefulSet.</p>\n<div class=\"note\">\n    <p><strong>🔵 Note:</strong></p>\n    <p>The MySQL deployment consists of a ConfigMap, two Services, a Kubernetes secret for the root password and a StatefulSet.</p>\n</div>\n<p>The <a href=\"https://kubernetes.io/docs/tasks/configure-pod-container/configure-pod-configmap/\" target=\"_blank\" rel=\"noopener noreferrer\">ConfigMap</a> allows you to decouple configuration artifacts and secrets from image content to keep containerized applications portable.</p>\n<p>The ConfigMap stores <code class=\"language-text\">source.cnf</code>, <code class=\"language-text\">replica.cnf</code> and passes them when initializing leader and follower pods defined in StatefulSet:</p>\n<ul>\n<li><strong>source.cnf:</strong> is for the MySQL leader pod which has binary log option (log-bin) to provides a record of the data changes to be sent to follower servers.</li>\n<li><strong>replica.cnf:</strong> is for follower pods which have super-read-only option.</li>\n</ul>\n<p><code class=\"language-text\">mysql-cm.yaml</code> manifest:</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> v1\n<span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> ConfigMap\n<span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> mysql<span class=\"token punctuation\">-</span>config\n  <span class=\"token key atrule\">namespace</span><span class=\"token punctuation\">:</span> workshop\n  <span class=\"token key atrule\">labels</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">app</span><span class=\"token punctuation\">:</span> mysql\n<span class=\"token key atrule\">data</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">source.cnf</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">|</span><span class=\"token scalar string\">\n    # Apply this config only on the leader.\n    [mysqld]\n    log-bin</span>\n  <span class=\"token key atrule\">replica.cnf</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">|</span><span class=\"token scalar string\">\n    # Apply this config only on followers.\n    [mysqld]\n    # super-read-only</span></code></pre></div>\n<p>Then run:</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">kubectl create <span class=\"token parameter variable\">-f</span> mysql-cm.yaml</code></pre></div>\n<p>StatefulSet requires a <a href=\"https://kubernetes.io/docs/concepts/services-networking/service/#headless-services\" target=\"_blank\" rel=\"noopener noreferrer\">Headless Service</a> to control the domain of its Pods, directly reach each Pod with stable DNS entries.</p>\n<blockquote>\n<p>The Headless Service provides a home for the DNS entries that the StatefulSet controller creates for each Pod that's part of the set. By specifying \"None\" for the clusterIP, you can create Headless Service.</p>\n<p>Because the Headless Service is named mysql, the Pods are accessible by resolving <strong><code class=\"language-text\">.mysql</code></strong> from within any other Pod in the same Kubernetes cluster and namespace.</p>\n</blockquote>\n<p>You can see the <code class=\"language-text\">mysql service</code> is for DNS resolution so that when pods are placed by StatefulSet controller, pods can be resolved using pod-name.mysql.</p>\n<p>The Client Service <code class=\"language-text\">mysql-read</code> is a normal client Service with its own cluster IP that distributes connections across all MySQL Pods that report being Ready.</p>\n<p>Create service <strong>mysql</strong> and <strong>mysql-read</strong> by running the following commands:</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">$ <span class=\"token function\">git</span> clone https://github.com/seifrajhi/eks-secrets-manager-kms-demo.git\n$ <span class=\"token builtin class-name\">cd</span> eks-secrets-manager-kms-demo/demo-app\n$ kubectl create <span class=\"token parameter variable\">-f</span> mysql-svc.yaml</code></pre></div>\n<p>StatefulSet consists of <strong>serviceName</strong>, <strong>replicas</strong>, <strong>template</strong> and <strong>volumeClaimTemplates</strong>:</p>\n<ul>\n<li>serviceName is \"mysql\", headless service we created in previous section.</li>\n<li>replicas is 2, the desired number of pod.</li>\n<li>template is the configuration of pod.</li>\n<li>volumeClaimTemplates is to claim volume for pod based on storageClassName gp3.</li>\n</ul>\n<p>Run the following command under demo-app directory:</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">$ kubectl apply <span class=\"token parameter variable\">-f</span> statefulset.yaml</code></pre></div>\n<p><strong>Populate database:</strong></p>\n<p>We are creating the database qa and products table in below command and inserting a products into the table. Later we will see how this data will show up in our application which is accessing this database.</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">$ kubectl <span class=\"token parameter variable\">-n</span> workshop run mysql-client <span class=\"token parameter variable\">--image</span><span class=\"token operator\">=</span>mysql:5.7 <span class=\"token parameter variable\">-i</span> <span class=\"token parameter variable\">--rm</span> <span class=\"token parameter variable\">--restart</span><span class=\"token operator\">=</span>Never --<span class=\"token punctuation\">\\</span>\n  mysql <span class=\"token parameter variable\">-uroot</span> <span class=\"token parameter variable\">-pdemo_ascp</span> <span class=\"token parameter variable\">-h</span> mysql-0.mysql.workshop <span class=\"token operator\">&lt;&lt;</span><span class=\"token string\">EOF\nCREATE DATABASE qa;\nCREATE TABLE qa.products (prodId VARCHAR(120), prodName VARCHAR(120));\nINSERT INTO qa.products (prodId,prodName) VALUES ('999','Mountain Bike');\nEOF</span></code></pre></div>\n<h2 id=\"kubernetes-secrets-encryption-using-aws-kms\" style=\"position:relative;\"><a href=\"#kubernetes-secrets-encryption-using-aws-kms\" aria-label=\"kubernetes secrets encryption using aws kms permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Kubernetes secrets encryption using AWS KMS</h2>\n<p>When we deployed the MySQL database, and the kubernetes secret <code class=\"language-text\">mysql-secret</code> to hold the <strong>password</strong> for the database, the EKS control plane created a <a href=\"https://docs.aws.amazon.com/sns/latest/dg/sns-server-side-encryption.html#sse-key-terms\" target=\"_blank\" rel=\"noopener noreferrer\">Data Encryption Key (DEK)</a> to encrypt the secret, saved the encrypted secret to etcd and used <a href=\"https://kubernetes.io/docs/tasks/administer-cluster/kms-provider/\" target=\"_blank\" rel=\"noopener noreferrer\">kms:encrypt</a> to encrypt DEK and cached the encrypted DEK.</p>\n<p>Let's use the Kubernetes secret <code class=\"language-text\">mysql-secret</code> created while deploying the MySQL StatefulSet in the prodcatalog service to connect to the MYSQL database and show how EKS uses KMS to decrypt the Kubernetes secret <code class=\"language-text\">mysql-secret</code>.</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">$ <span class=\"token builtin class-name\">cd</span> helm-charts\n$ helm upgrade --reuse-values <span class=\"token parameter variable\">-f</span> values-k8s-secret.yaml demo <span class=\"token builtin class-name\">.</span>\n\nRelease <span class=\"token string\">\"demo\"</span> has been upgraded. Happy Helming<span class=\"token operator\">!</span>\nNAME: demo\nLAST DEPLOYED: Sat Oct <span class=\"token number\">11</span> <span class=\"token number\">19</span>:20:20 <span class=\"token number\">2024</span>\nNAMESPACE: default\nSTATUS: deployed\nREVISION: <span class=\"token number\">3</span></code></pre></div>\n<p><strong>Validate Kubernetes Encryption using KMS:</strong></p>\n<p>Now let's validate that AWS KMS was used when we create and use the kubernetes secret.</p>\n<p>Log into console and navigate to <code class=\"language-text\">EKS → Cluster → Overview,</code> you will see the Secrets encryption as shown below:</p>\n<p><span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 10.588235294117647%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAACCAIAAADXZGvcAAAACXBIWXMAAAsTAAALEwEAmpwYAAAARklEQVR42m3JSw6AIBAEUe5/UVzIEJTP0NNDTFxp9KV2FZJIjNsuGUb7wJw0OI13rwWE1rsO9T/LPZUq5zg6ctWmWI9L8gLEjnTpS64K9gAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"alt text\" title=\"\" src=\"/static/63bafc0f58504402037c01232ad633af/c5bb3/kms-eks.png\" srcset=\"/static/63bafc0f58504402037c01232ad633af/04472/kms-eks.png 170w,\n/static/63bafc0f58504402037c01232ad633af/9f933/kms-eks.png 340w,\n/static/63bafc0f58504402037c01232ad633af/c5bb3/kms-eks.png 680w,\n/static/63bafc0f58504402037c01232ad633af/b12f7/kms-eks.png 1020w,\n/static/63bafc0f58504402037c01232ad633af/b5a09/kms-eks.png 1360w,\n/static/63bafc0f58504402037c01232ad633af/29007/kms-eks.png 1600w\" sizes=\"(max-width: 680px) 100vw, 680px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n    </span>\n          </p>\n<p>The EKS cluster was created with KMS encryption enabled and that is why your Secrets encryption is enabled.</p>\n<p><em>Make a note of the KMS key ID.</em></p>\n<p>A <strong>cloudtrail Decrypt</strong> event corresponding to this KMS key ID should be available with sourceIpAddress as <code class=\"language-text\">eks.amazonaws.com</code>.</p>\n<p>If you go to <a href=\"https://docs.aws.amazon.com/awscloudtrail/latest/userguide/cloudtrail-user-guide.html\" target=\"_blank\" rel=\"noopener noreferrer\">CloudTrail</a> you should see a record available if you search for the Event types Encrypt and Decrypt.</p>\n<h3 id=\"mount-secrets-from-aws-secretsmanager\" style=\"position:relative;\"><a href=\"#mount-secrets-from-aws-secretsmanager\" aria-label=\"mount secrets from aws secretsmanager permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Mount secrets from AWS Secrets Manager</h3>\n<p>We have the MYSQL StatefulSet deployed and now we are going to save the password for the MYSQL database in AWS Secrets Manager and sync the secrets manager secret to a Native Kubernertes secret using the <a href=\"https://secrets-store-csi-driver.sigs.k8s.io/\" target=\"_blank\" rel=\"noopener noreferrer\">Secrets Store CSI driver</a>.</p>\n<p>The Kubernetes secret created by the CSI driver will be used in the <strong>productcatalog</strong> service to connect to the MYSQL Database.</p>\n<p><strong>Install CSI Driver:</strong></p>\n<p>Prepare your cluster by installing Secrets Store CSI Secret driver and AWS Secrets and Configuration Provider (ASCP).</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">helm repo <span class=\"token function\">add</span> secrets-store-csi-driver https://kubernetes-sigs.github.io/secrets-store-csi-driver/charts</code></pre></div>\n<p>Then install the CSI driver:</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">$ helm <span class=\"token function\">install</span> <span class=\"token parameter variable\">-n</span> kube-system csi-secrets-store <span class=\"token punctuation\">\\</span>\n<span class=\"token parameter variable\">--set</span> <span class=\"token assign-left variable\">syncSecret.enabled</span><span class=\"token operator\">=</span>true <span class=\"token punctuation\">\\</span>\n<span class=\"token parameter variable\">--set</span> <span class=\"token assign-left variable\">enableSecretRotation</span><span class=\"token operator\">=</span>true <span class=\"token punctuation\">\\</span>\nsecrets-store-csi-driver/secrets-store-csi-driver</code></pre></div>\n<p>Then install AWS Secrets and Configuration <a href=\"https://docs.aws.amazon.com/secretsmanager/latest/userguide/integrating_csi_driver.html\" target=\"_blank\" rel=\"noopener noreferrer\">Provider ASCP</a>:</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">helm repo <span class=\"token function\">add</span> aws-secrets-manager https://aws.github.io/secrets-store-csi-driver-provider-aws\nhelm <span class=\"token function\">install</span> <span class=\"token parameter variable\">-n</span> kube-system secrets-provider-aws aws-secrets-manager/secrets-store-csi-driver-provider-aws</code></pre></div>\n<p><strong>Prepare Secret and IAM access:</strong></p>\n<p>Next step, create a test secret in AWS Secrets Manager:</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">$ aws secretsmanager create-secret <span class=\"token punctuation\">\\</span>\n<span class=\"token parameter variable\">--name</span> DBSecret_eksdemo <span class=\"token punctuation\">\\</span>\n<span class=\"token parameter variable\">--description</span> <span class=\"token string\">\"MYSQL DB Secret.\"</span> <span class=\"token punctuation\">\\</span>\n--secret-string <span class=\"token string\">\"{<span class=\"token entity\" title=\"\\&quot;\">\\\"</span>username<span class=\"token entity\" title=\"\\&quot;\">\\\"</span>:<span class=\"token entity\" title=\"\\&quot;\">\\\"</span>root<span class=\"token entity\" title=\"\\&quot;\">\\\"</span>,<span class=\"token entity\" title=\"\\&quot;\">\\\"</span>password<span class=\"token entity\" title=\"\\&quot;\">\\\"</span>:<span class=\"token entity\" title=\"\\&quot;\">\\\"</span>demo_ascp<span class=\"token entity\" title=\"\\&quot;\">\\\"</span>}\"</span></code></pre></div>\n<p>After that, create an IAM policy with permissions to access the secrets manager secret:</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token builtin class-name\">export</span> <span class=\"token assign-left variable\">IAM_POLICY_ARN_SECRET</span><span class=\"token operator\">=</span><span class=\"token variable\"><span class=\"token variable\">$(</span>aws iam <span class=\"token punctuation\">\\</span>\ncreate-policy <span class=\"token parameter variable\">--query</span> Policy.Arn <span class=\"token punctuation\">\\</span>\n<span class=\"token parameter variable\">--output</span> text --policy-name DBSecret_eksdemo_secrets_policy<span class=\"token punctuation\">\\</span>\n--policy-document <span class=\"token string\">'{\n\"Version\": \"2012-10-17\",\n\"Statement\": [ {\n\"Effect\": \"Allow\",\n\"Action\": [\"secretsmanager:GetSecretValue\", \"secretsmanager:DescribeSecret\"],\n\"Resource\": [\"'</span>\"$SECRET_ARN<span class=\"token string\">\"'\"</span> <span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">}</span> <span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">}</span>'<span class=\"token variable\">)</span></span>\n\n<span class=\"token builtin class-name\">echo</span> <span class=\"token variable\">$IAM_POLICY_ARN_SECRET</span> <span class=\"token operator\">|</span> <span class=\"token function\">tee</span> <span class=\"token parameter variable\">-a</span> 00_iam_policy_arn_dbsecret</code></pre></div>\n<p>Next, create an IAM Service Account IRSA to access the secrets manager secret:</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">$ eksctl create iamserviceaccount <span class=\"token punctuation\">\\</span>\n<span class=\"token parameter variable\">--name</span> <span class=\"token string\">\"catalog-deployment-sa\"</span> <span class=\"token punctuation\">\\</span>\n<span class=\"token parameter variable\">--cluster</span> <span class=\"token string\">\"demo-eks-secrets-kms-bottlerocket\"</span> <span class=\"token punctuation\">\\</span>\n--attach-policy-arn <span class=\"token string\">\"<span class=\"token variable\">$IAM_POLICY_ARN_SECRET</span>\"</span> <span class=\"token parameter variable\">--approve</span> <span class=\"token punctuation\">\\</span>\n<span class=\"token parameter variable\">--namespace</span> workshop <span class=\"token punctuation\">\\</span>\n--override-existing-serviceaccounts</code></pre></div>\n<p><strong>Sync with Native Kubernetes Secrets:</strong></p>\n<p>When all is ready, we can create a SecretProviderClass custom resource and use jmesPath field in the spec file.</p>\n<blockquote>\n<p>Use of <a href=\"https://jmespath.org/\" target=\"_blank\" rel=\"noopener noreferrer\">jmesPath</a> allows extracting specific key-value from a JSON-formatted secret. It is a provider-specific feature from ASCP.</p>\n</blockquote>\n<p><a href=\"https://secrets-store-csi-driver.sigs.k8s.io/topics/sync-as-kubernetes-secret\" target=\"_blank\" rel=\"noopener noreferrer\">secretObjects</a> spec section allows specifying the Kubernetes native secret structure synced from the objects: extracted from the JSON formatted secret using jmesPath.</p>\n<p>The feature is provided by the standard <a href=\"https://secrets-store-csi-driver.sigs.k8s.io/topics/sync-as-kubernetes-secret.html\" target=\"_blank\" rel=\"noopener noreferrer\">Secret Store CSI Driver</a>.</p>\n<p><code class=\"language-text\">SecretProviderClass.yaml</code> template:</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> secrets<span class=\"token punctuation\">-</span>store.csi.x<span class=\"token punctuation\">-</span>k8s.io/v1\n<span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> SecretProviderClass\n<span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> catalog<span class=\"token punctuation\">-</span>deployment<span class=\"token punctuation\">-</span>spc<span class=\"token punctuation\">-</span>k8s<span class=\"token punctuation\">-</span>secrets\n  <span class=\"token key atrule\">namespace</span><span class=\"token punctuation\">:</span> workshop\n<span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">provider</span><span class=\"token punctuation\">:</span> aws\n  <span class=\"token key atrule\">parameters</span><span class=\"token punctuation\">:</span> \n    <span class=\"token key atrule\">objects</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">|</span><span class=\"token scalar string\">\n      - objectName: \"DBSecret_eksworkshop\"\n        objectType: \"secretsmanager\"\n        jmesPath:\n          - path: username\n            objectAlias: dbusername\n          - path: password\n            objectAlias: dbpassword</span>\n  <span class=\"token key atrule\">secretObjects</span><span class=\"token punctuation\">:</span>                \n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">secretName</span><span class=\"token punctuation\">:</span> mysql<span class=\"token punctuation\">-</span>secret<span class=\"token punctuation\">-</span>from<span class=\"token punctuation\">-</span>secrets<span class=\"token punctuation\">-</span>manager\n      <span class=\"token key atrule\">type</span><span class=\"token punctuation\">:</span> Opaque\n      <span class=\"token key atrule\">data</span><span class=\"token punctuation\">:</span>\n        <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">objectName</span><span class=\"token punctuation\">:</span> dbusername\n          <span class=\"token key atrule\">key</span><span class=\"token punctuation\">:</span> db_username\n        <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">objectName</span><span class=\"token punctuation\">:</span> dbpassword\n          <span class=\"token key atrule\">key</span><span class=\"token punctuation\">:</span> db_password</code></pre></div>\n<p>After, run the command:</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">kubectl apply <span class=\"token parameter variable\">-f</span> SecretProviderClass.yaml</code></pre></div>\n<p><strong>Create Pod Mount Secrets Volumes and set up environment variables:</strong></p>\n<p>Now let us Configure productcatalog service pod to mount volumes for individually extracted key-value pairs from the secrets. Once the pod is created with secrets volume mounts, the Secrets Store CSI Driver then creates and syncs Kubernetes secret object mysql-secret-from-secrets-manager .\nThe pod then be able to populate Environment variables from the Kubernetes secret.</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">$ <span class=\"token builtin class-name\">cd</span> helm-charts\n$ helm upgrade --reuse-values <span class=\"token parameter variable\">-f</span> values-secrets-manager.yaml demo <span class=\"token builtin class-name\">.</span>\n\nRelease <span class=\"token string\">\"demo\"</span> has been upgraded. Happy Helming<span class=\"token operator\">!</span>\nNAME: demo\nLAST DEPLOYED: Sat Oct <span class=\"token number\">11</span> <span class=\"token number\">20</span>:11:20 <span class=\"token number\">2024</span>\nNAMESPACE: default\nSTATUS: deployed\nREVISION: <span class=\"token number\">5</span></code></pre></div>\n<p><strong>🎉 Verify the result:</strong></p>\n<p>Get a shell prompt within the product catalog pod by running the following commands. Verify the secret mounted as separate files for each extracted key-value pair and corresponding environment variables set as well.</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token builtin class-name\">export</span> <span class=\"token assign-left variable\">PROD_CATALOG</span><span class=\"token operator\">=</span><span class=\"token variable\"><span class=\"token variable\">$(</span>kubectl get pods <span class=\"token parameter variable\">-n</span> workshop <span class=\"token parameter variable\">-l</span> <span class=\"token assign-left variable\">app</span><span class=\"token operator\">=</span>prodcatalog <span class=\"token parameter variable\">-o</span> <span class=\"token assign-left variable\">jsonpath</span><span class=\"token operator\">=</span><span class=\"token string\">'{.items[].metadata.name}'</span><span class=\"token variable\">)</span></span>\nkubectl <span class=\"token parameter variable\">-n</span> workshop <span class=\"token builtin class-name\">exec</span> <span class=\"token parameter variable\">-it</span> <span class=\"token variable\">${PROD_CATALOG}</span> <span class=\"token parameter variable\">-c</span> prodcatalog <span class=\"token function\">bash</span></code></pre></div>\n<p>Wait for the root shell prompt within the pod.\nRun the following set of commands and watch the output in the pod's shell:</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token builtin class-name\">export</span> <span class=\"token assign-left variable\"><span class=\"token environment constant\">PS1</span></span><span class=\"token operator\">=</span><span class=\"token string\">'# '</span>\n<span class=\"token builtin class-name\">cd</span> /mnt/secrets\n<span class=\"token function\">ls</span> <span class=\"token parameter variable\">-l</span> <span class=\"token comment\">#--- List mounted secrets</span>\n<span class=\"token function\">cat</span> dbusername<span class=\"token punctuation\">;</span> <span class=\"token builtin class-name\">echo</span>\n<span class=\"token function\">cat</span> dbpassword<span class=\"token punctuation\">;</span> <span class=\"token builtin class-name\">echo</span>\n<span class=\"token function\">cat</span> DBSecret_eksworkshop<span class=\"token punctuation\">;</span> <span class=\"token builtin class-name\">echo</span>\n<span class=\"token function\">env</span> <span class=\"token operator\">|</span> <span class=\"token function\">grep</span> MYSQL <span class=\"token comment\">#-- Display the MYSQL_ROOT_PASSWORD ENV variables set from the secret value</span></code></pre></div>\n<p>The output shows the information as displayed below:</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token comment\"># cd /mnt/secrets</span>\n<span class=\"token comment\"># ls -l #--- List mounted secrets</span>\ntotal <span class=\"token number\">12</span>\n-rw-r--r-- <span class=\"token number\">1</span> root root <span class=\"token number\">41</span> Oct <span class=\"token number\">11</span> <span class=\"token number\">21</span>:42 DBSecret_eksworkshop\n-rw-r--r-- <span class=\"token number\">1</span> root root  <span class=\"token number\">8</span> Oct <span class=\"token number\">11</span> <span class=\"token number\">21</span>:42 dbpassword\n-rw-r--r-- <span class=\"token number\">1</span> root root  <span class=\"token number\">4</span> Oct <span class=\"token number\">11</span> <span class=\"token number\">21</span>:42 dbusername\n<span class=\"token comment\"># </span>\n<span class=\"token comment\"># cat dbusername; echo</span>\nroot\n<span class=\"token comment\"># cat dbpassword; echo</span>\ndemo_ascp\n<span class=\"token comment\"># cat DBSecret_eksworkshop; echo</span>\n<span class=\"token punctuation\">{</span><span class=\"token string\">\"username\"</span><span class=\"token builtin class-name\">:</span><span class=\"token string\">\"root\"</span>,<span class=\"token string\">\"password\"</span><span class=\"token builtin class-name\">:</span><span class=\"token string\">\"demo_ascp\"</span><span class=\"token punctuation\">}</span>\n<span class=\"token comment\"># </span>\n<span class=\"token comment\"># env | grep MYSQL #-- Display the MYSQL_ROOT_PASSWORD ENV variables set from the secret value</span>\n<span class=\"token assign-left variable\">MYSQL_ROOT_PASSWORD</span><span class=\"token operator\">=</span>demo_ascp\n<span class=\"token assign-left variable\">MYSQL_READ_PORT_3306_TCP_PORT</span><span class=\"token operator\">=</span><span class=\"token number\">3306</span>\n<span class=\"token assign-left variable\">MYSQL_READ_PORT_3306_TCP_PROTO</span><span class=\"token operator\">=</span>tcp\n<span class=\"token assign-left variable\">MYSQL_READ_PORT_3306_TCP</span><span class=\"token operator\">=</span>tcp://10.100.88.165:3306\n<span class=\"token assign-left variable\">MYSQL_READ_SERVICE_HOST</span><span class=\"token operator\">=</span><span class=\"token number\">10.100</span>.88.165\n<span class=\"token assign-left variable\">MYSQL_READ_SERVICE_PORT</span><span class=\"token operator\">=</span><span class=\"token number\">3306</span>\n<span class=\"token assign-left variable\">MYSQL_READ_SERVICE_PORT_MYSQL</span><span class=\"token operator\">=</span><span class=\"token number\">3306</span>\n<span class=\"token assign-left variable\">MYSQL_READ_PORT_3306_TCP_ADDR</span><span class=\"token operator\">=</span><span class=\"token number\">10.100</span>.88.165\n<span class=\"token assign-left variable\">MYSQL_READ_PORT</span><span class=\"token operator\">=</span>tcp://10.100.88.165:3306</code></pre></div>\n<p>Notice under the path <code class=\"language-text\">/mnt/secrets</code> key-values pairs extracted in separate files based on jmesPath specification. Files <code class=\"language-text\">dbusername</code> and <code class=\"language-text\">dbpassword</code> contains extracted values from the JSON formatted secret <code class=\"language-text\">DBSecret_eksworkshop</code></p>\n<p>The Environment variable <strong>MYSQL_ROOT_PASSWORD</strong> is set up correctly.</p>\n<p>The ENV var mapped from the Kubernetes secrets object <code class=\"language-text\">mysql-secret-from-secrets-manager</code> created automatically by the CSI driver.\nConfirm the presence of Kubernetes secrets. It was created automatically by the CSI driver during pod deployment.</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">$ kubectl describe secrets mysql-secret-from-secrets-manager <span class=\"token parameter variable\">-n</span> workshop\nName: mysql-secret-from-secrets-manager\nNamespace: workshop\nLabels: secrets-store.csi.k8s.io/managed<span class=\"token operator\">=</span>true\nAnnotations: <span class=\"token operator\">&lt;</span>none<span class=\"token operator\">></span>\nType: Opaque\nDatadb_password: <span class=\"token number\">8</span> bytes\ndb_username: <span class=\"token number\">4</span> bytes</code></pre></div>\n<h2 id=\"-key-takeaways\" style=\"position:relative;\"><a href=\"#-key-takeaways\" aria-label=\" key takeaways permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>💬 Key Takeaways</h2>\n<p>Using AWS Secrets Manager with Amazon EKS makes handling secrets in Kubernetes much safer and easier.</p>\n<p>It helps keep your sensitive information secure and makes managing secrets simpler.</p>\n<p><strong><em>Until next time, つづく 🎉 🇵🇸</em></strong></p>\n<p><br><br></p>\n<blockquote>\n<p>💡 Thank you for Reading !! 🙌🏻😁📃, see you in the next blog.🤘  <em><strong>Until next time 🎉</strong></em></p>\n</blockquote>\n<p>🚀 Thank you for sticking up till the end. If you have any questions/feedback regarding this blog feel free to connect with me:</p>\n<p><strong>♻️ LinkedIn:</strong> <a href=\"https://www.linkedin.com/in/rajhi-saif/\" target=\"_blank\" rel=\"noopener noreferrer\">https://www.linkedin.com/in/rajhi-saif/</a></p>\n<p><strong>♻️ X/Twitter:</strong> <a href=\"https://x.com/rajhisaifeddine\" target=\"_blank\" rel=\"noopener noreferrer\">https://x.com/rajhisaifeddine</a></p>\n<p><strong>The end ✌🏻</strong></p>\n<h1 align=\"center\">🔰 Keep Learning !! Keep Sharing !! 🔰</h1>\n<p><strong>References:</strong></p>\n<ul>\n<li><a href=\"https://docs.aws.amazon.com/secretsmanager/latest/userguide/integrating_csi_driver.html\" target=\"_blank\" rel=\"noopener noreferrer\">https://docs.aws.amazon.com/secretsmanager/latest/userguide/integrating_csi_driver.html</a></li>\n<li><a href=\"https://aws.amazon.com/blogs/security/how-to-use-aws-secrets-configuration-provider-with-kubernetes-secrets-store-csi-driver/\" target=\"_blank\" rel=\"noopener noreferrer\">https://aws.amazon.com/blogs/security/how-to-use-aws-secrets-configuration-provider-with-kubernetes-secrets-store-csi-driver/</a></li>\n<li><a href=\"https://catalog.workshops.aws/eks-immersionday/en-US/secrets-manager\" target=\"_blank\" rel=\"noopener noreferrer\">https://catalog.workshops.aws/eks-immersionday/en-US/secrets-manager</a></li>\n<li><a href=\"https://aws.github.io/aws-eks-best-practices/security/docs/data/\" target=\"_blank\" rel=\"noopener noreferrer\">https://aws.github.io/aws-eks-best-practices/security/docs/data/</a></li>\n<li>\n<iframe width=\"100%\" height=\"315\" src=\"https://www.youtube-nocookie.com/embed/CXbFkpugxyQ?rel=0\" frameborder=\"0\" allow=\"accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture\" allowfullscreen></iframe>\n</li>\n</ul>\n<p><strong>📅 Stay updated</strong></p>\n<p>Subscribe to our newsletter for more insights on AWS cloud computing and containers.</p>"},"nextThought":{"frontmatter":{"path":"/blog/aws-pod-id-agent-boto3-python/","title":"Simplify AWS resource access with EKS Pod Identity Agent and Python SDK","date":"2024-10-02 13:34:00"},"excerpt":"Boto3 inside a Pod with Pod identities 📚 Introduction In this blog post, we will guide you through the process of using the AWS EKS Pod…","html":"<blockquote>\n<p><strong>Boto3 inside a Pod with Pod identities</strong></p>\n</blockquote>\n<h2 id=\"-introduction\" style=\"position:relative;\"><a href=\"#-introduction\" aria-label=\" introduction permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>📚 Introduction</h2>\n<p>In this blog post, we will guide you through the process of using the <a href=\"https://docs.aws.amazon.com/eks/latest/userguide/pod-identities.html\" target=\"_blank\" rel=\"noopener noreferrer\">AWS EKS Pod Identity Agent</a> with the Python <a href=\"https://aws.amazon.com/fr/what-is/sdk/\" target=\"_blank\" rel=\"noopener noreferrer\">SDK</a> to manage AWS resources.</p>\n<p><a href=\"https://boto3.amazonaws.com/v1/documentation/api/latest/index.html\" target=\"_blank\" rel=\"noopener noreferrer\">Boto3</a> is the name of the Python SDK for AWS. It allows you to directly manage AWS resources from your Python code. We will see in the hands-on.</p>\n<p>To connect to AWS APIs in Python, you typically use the boto3 library, which is the Amazon Web Services (AWS) SDK for Python. It allows Python developers to write software that makes use of services like Amazon S3 and Amazon EC2.</p>\n<p>We will take you step-by-step through setting up the EKS cluster, creating the IAM role, and writing a Python script to access AWS resources.</p>\n<h2 id=\"-eks-pod-identity\" style=\"position:relative;\"><a href=\"#-eks-pod-identity\" aria-label=\" eks pod identity permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>🔑 EKS Pod Identity</h2>\n<p><a href=\"https://aws.amazon.com/blogs/aws/amazon-eks-pod-identity-simplifies-iam-permissions-for-applications-on-amazon-eks-clusters/\" target=\"_blank\" rel=\"noopener noreferrer\"><strong>Pod Identity</strong></a> is a mechanism that allows Kubernetes pods to assume specific identities, enabling them to access cloud resources securely. Applications running in a pod's containers can use an AWS SDK or the AWS CLI to make API requests to AWS services using AWS IAM permissions. These applications must sign their AWS API requests with AWS credentials.</p>\n<p><strong>EKS Pod Identities</strong> provide the ability to manage credentials for your applications, similar to how <a href=\"https://docs.aws.amazon.com/IAM/latest/UserGuide/id_roles_use_switch-role-ec2_instance-profiles.html\" target=\"_blank\" rel=\"noopener noreferrer\">Amazon EC2 instance profiles</a>provide credentials to Amazon EC2 instances. Instead of creating and distributing your AWS credentials to the containers or using the Amazon EC2 instance's role, you associate an IAM role with a <a href=\"https://kubernetes.io/docs/concepts/security/service-accounts/\" target=\"_blank\" rel=\"noopener noreferrer\">Kubernetes service account</a> and configure your pods to use the service account.</p>\n<h3 id=\"-how-it-works-in-amazon-eks\" style=\"position:relative;\"><a href=\"#-how-it-works-in-amazon-eks\" aria-label=\" how it works in amazon eks permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>🆔 How It Works in Amazon EKS</h3>\n<p>In Amazon EKS, Pod Identity is implemented using IAM roles. When a pod needs to access AWS resources, it can assume an IAM role that grants the necessary permissions. This is achieved through the AWS <a href=\"https://github.com/aws/eks-pod-identity-agent\" target=\"_blank\" rel=\"noopener noreferrer\">EKS Pod Identity Agent</a>, which manages the association between Kubernetes service accounts and IAM roles. The agent ensures that the pods receive temporary credentials to access AWS services securely.</p>\n<ul>\n<li><strong>🔒 Secure connection</strong>: EKS Pod Identity allows secure connections between Amazon EKS clusters and AWS services like S3.</li>\n<li><strong>🔄 Simplified IAM roles</strong>: It simplifies the use of IAM roles with Kubernetes pods, reducing operational overhead compared to <a href=\"https://docs.aws.amazon.com/eks/latest/userguide/iam-roles-for-service-accounts.html\" target=\"_blank\" rel=\"noopener noreferrer\">IRSA</a>.</li>\n<li><strong>💡 Backward compatibility</strong>: Pod Identity is backward compatible with IAM Roles for Service Accounts IRSA.</li>\n<li><strong>🔑 RBAC authorization</strong>: Kubernetes authorizes users using RBAC with cluster roles and namespace roles.</li>\n<li><strong>🆔 Service accounts</strong>: Service accounts within Kubernetes are used to authorize workloads accessing the Kubernetes API.</li>\n<li><strong>🔄 IAM Role association</strong>: Pod Identity allows Kubernetes workloads to access AWS services by associating IAM roles with pods.</li>\n<li><strong>💡 No OIDC Providers needed</strong>: With EKS Pod Identity, there's no need to create <a href=\"https://docs.aws.amazon.com/eks/latest/userguide/enable-iam-roles-for-service-accounts.html\" target=\"_blank\" rel=\"noopener noreferrer\">OIDC providers</a> for each cluster, unlike IRSA.</li>\n<li><strong>🔑 ABAC</strong>: Pod Identity uses attribute-based access control <a href=\"https://docs.aws.amazon.com/IAM/latest/UserGuide/introduction_attribute-based-access-control.html\" target=\"_blank\" rel=\"noopener noreferrer\">ABAC</a> for more flexible role management.</li>\n<li><strong>🆔 Pod Identity Agent</strong>: The Pod Identity agent, deployable as an <a href=\"https://docs.aws.amazon.com/eks/latest/userguide/eks-add-ons.html\" target=\"_blank\" rel=\"noopener noreferrer\">EKS add-on</a>, handles pod identity management with minimal operational overhead.</li>\n<li><strong>🔒 Secure Access</strong>: Pod Identity ensures that Kubernetes workloads running in EKS securely access external AWS services like S3 using the right IAM roles.</li>\n</ul>\n<h3 id=\"-the-feauture-state-eks-pod-identities\" style=\"position:relative;\"><a href=\"#-the-feauture-state-eks-pod-identities\" aria-label=\" the feauture state eks pod identities permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>💡 The f(ea)uture state: EKS Pod Identities</h3>\n<p>Before this enhancement, we used the IAM Roles for Service Accounts (IRSA) model. To give a pod access to, for example, S3, we had to:</p>\n<ol>\n<li>Create an IAM Role with the appropriate IAM Policy.</li>\n<li>Configure its Trust Policy to allow <code class=\"language-text\">AssumeRole</code> and <code class=\"language-text\">TagSession</code> to be executed only from the appropriate cluster.</li>\n<li>Create a Kubernetes ServiceAccount with the ARN of this role in its annotations.</li>\n</ol>\n<h4 id=\"common-issues-with-the-previous-model\" style=\"position:relative;\"><a href=\"#common-issues-with-the-previous-model\" aria-label=\"common issues with the previous model permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Common Issues with the Previous Model:</h4>\n<ul>\n<li><strong>Trust Policy Errors</strong>: Often errors occurred in the Trust Policy, where it was necessary to specify the cluster OIDC.</li>\n<li><strong>ServiceAccount Errors</strong>: Mistakes could be made in the ARN of the role within the ServiceAccount annotations.</li>\n</ul>\n<h3 id=\"-enhanced-mechanism-pod-identity-association\" style=\"position:relative;\"><a href=\"#-enhanced-mechanism-pod-identity-association\" aria-label=\" enhanced mechanism pod identity association permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>🔄 Enhanced mechanism: Pod Identity association</h3>\n<p>AWS EKS has introduced a new enhanced mechanism called <strong>Pod Identity Association</strong> for cluster administrators to configure Kubernetes applications to receive IAM permissions required to connect with AWS services outside of the cluster. Pod Identity Association makes use of IRSA, but it makes it configurable directly through the EKS API, eliminating the need for using the IAM API altogether.</p>\n<p>As a result, IAM roles no longer need to reference an OIDC provider and hence won't be tied to a single cluster anymore. This means IAM roles can now be used across multiple EKS clusters without the need to update the role trust policy each time a new cluster is created. This, in turn, eliminates the need for role duplication and simplifies the process of automating IRSA altogether.</p>\n<h3 id=\"-how-eks-pod-identities-simplify-the-process\" style=\"position:relative;\"><a href=\"#-how-eks-pod-identities-simplify-the-process\" aria-label=\" how eks pod identities simplify the process permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>🆔 How EKS Pod Identities Simplify the Process</h3>\n<ol>\n<li><strong>Add a New Controller</strong>: Introduce the Amazon EKS Pod Identity Agent add-on.</li>\n<li><strong>Create an IAM Role</strong>: In the Trust Policy, use <code class=\"language-text\">Principal: pods.eks.amazonaws.com</code>.</li>\n<li><strong>Connect the Role</strong>: Use the AWS CLI, AWS Console, or AWS API to connect this role directly to the desired ServiceAccount.</li>\n</ol>\n<h3 id=\"-pod-identity-vs-iam-roles-for-service-accounts-irsa\" style=\"position:relative;\"><a href=\"#-pod-identity-vs-iam-roles-for-service-accounts-irsa\" aria-label=\" pod identity vs iam roles for service accounts irsa permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>🔄 Pod Identity vs. IAM Roles for Service Accounts (IRSA)</h3>\n<p><span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 52.94117647058824%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAACsElEQVR42jVSTUwTURCelrb0l7Zsa7vYdEPT2LJCURehEPAFpFJq5UeziYhNY00aRcEgwQuHdzIRqRIvEoMN8Scc0HgyBg/Gi5povEnUmKghSiqIiuHgsb7Zdl8ymTczb775ZuaBXSAOfpfkEhqJw84kHN7PDUnE1eBvcIIoG6B0KsqiFYRGh8TiAU9gB8/zZgCii/qipiVZeauF/kRsD0kvGIOjTyr55C2zlC3qAYraQLds5zK3bQKhRkwMBoOVKB6Px8ISTexehQDx9vpIsqthH1ZVCqze9DvRKAJoUBc6OmrX4kdOp2pqOGBgob5JmyiCyhTa5VH3pevPdodCIRszNcUVMPwYJtGtvuNNzK5U3wGjjC3B+9buw6u9/e9+cpwNsm/1Akk7JAA9Ic91GE/l1nsuzv8tZHMfXVnmR99qZ/d04VDvsgI0s7jZApRqVWBkulSaF4h0xcC1ZWyx2IQlSdf86MtMf7AN0M/NsrxUoeaMD02TqcGpLoXhhbnf3whdt0KpZV2aLhjf3D1T7wVwm8M9PCacvPwpNpnf2pavlEARTBRFAyFUYT2W314+l/93X0HvHHkpMF4aZUPYOqWGL5mEQHdW+wY7GGA0apJHHntP5TaS8vgrk9JFUXkPuCSOA1ti5EFLPLO41w1gVVlrMFiqSnQy0+iktKirjg9XSeVZsaN3u91W3LQgCMbyEjTlmEHZ/NnZzbr0wlej0wl2v99fy4THhNT8gbrMw4wAfNaMyYSBo2biDQR4P9MOLJC605k4/2igGREjkYgFxuZ+/cnmvh9EhyRJ5jhjirM8dqP1dTofm0E/IQobdSyKVttOzja/ODHfflVZIhGtkLq2kSB0xQvsU3smnlpQquP3quon25okejSMn5znwVxmZ/T5fCZV0OYl3iUQu0ON/Qf6aLVy/lfVSgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\" alt text\" title=\"\" src=\"/static/c2145156100e69a819951589546b091d/c5bb3/irsa-vs-pia.png\" srcset=\"/static/c2145156100e69a819951589546b091d/04472/irsa-vs-pia.png 170w,\n/static/c2145156100e69a819951589546b091d/9f933/irsa-vs-pia.png 340w,\n/static/c2145156100e69a819951589546b091d/c5bb3/irsa-vs-pia.png 680w,\n/static/c2145156100e69a819951589546b091d/a2b88/irsa-vs-pia.png 908w\" sizes=\"(max-width: 680px) 100vw, 680px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n    </span>\n          </p>\n<ul>\n<li>\n<p><strong>Pod Identity</strong>: This method involves assigning IAM roles directly to Kubernetes pods. It provides fine-grained control over which pods can access specific AWS resources. The AWS EKS Pod Identity Agent handles the credential management, ensuring that pods receive the necessary permissions.</p>\n</li>\n<li>\n<p><strong>IAM Roles for Service Accounts IRSA</strong>: IRSA is a feature that allows you to associate IAM roles with Kubernetes service accounts. When a pod uses a service account, it inherits the permissions of the associated IAM role. This method simplifies the management of permissions at the service account level rather than the individual pod level.</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>Feature</th>\n<th>EKS Pod Identity</th>\n<th>IRSA</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>Role Extensibility</strong></td>\n<td>No need to update the role's trust policy for each new cluster.</td>\n<td>Need to update role's trust policy with new EKS cluster OIDC provider endpoint.</td>\n</tr>\n<tr>\n<td><strong>Cluster Scalability</strong></td>\n<td>No need to setup IAM OIDC provider.</td>\n<td>Need to setup IAM OIDC provider. Default global limit of 100 OIDC providers for AWS account applies.</td>\n</tr>\n<tr>\n<td><strong>Role Scalability</strong></td>\n<td>No need to define trust relationship between IAM role and service account in the trust policy.</td>\n<td>Need to define trust relationship between IAM role and service account in the trust policy. Max of 8 trust relationships within a single trust policy applies due to limit on trust policy size.</td>\n</tr>\n<tr>\n<td><strong>Role Reusability</strong></td>\n<td>AWS STS temporary credentials supplied by EKS Pod Identity include role session tags, such as cluster name, namespace, service account name.</td>\n<td>AWS STS session tags are not supported. You can reuse a role between clusters but every pod receives all of the permissions of the role.</td>\n</tr>\n<tr>\n<td><strong>Environments Supported</strong></td>\n<td>Only available on Amazon EKS.</td>\n<td>IRSA can be used with Amazon EKS, Amazon EKS Anywhere, Red Hat OpenShift Service on AWS, and self-managed Kubernetes clusters on Amazon EC2 instances.</td>\n</tr>\n<tr>\n<td><strong>EKS Versions Supported</strong></td>\n<td>EKS Kubernetes versions 1.24 or later.</td>\n<td>All of the supported EKS cluster versions.</td>\n</tr>\n</tbody>\n</table>\n<h4 id=\"use-cases-for-each-method\" style=\"position:relative;\"><a href=\"#use-cases-for-each-method\" aria-label=\"use cases for each method permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Use cases for each method</h4>\n<ul>\n<li>\n<p><strong>Pod Identity</strong>: Ideal for scenarios where you need granular control over individual pod permissions. It is useful when different pods within the same application require different levels of access to AWS resources.</p>\n</li>\n<li>\n<p><strong>IRSA</strong>: Suitable for managing permissions at a higher level, such as for a group of pods that share the same service account. It simplifies the setup and is easier to manage when multiple pods need the same permissions.</p>\n</li>\n</ul>\n<h3 id=\"technical-details-and-benefits\" style=\"position:relative;\"><a href=\"#technical-details-and-benefits\" aria-label=\"technical details and benefits permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Technical Details and Benefits</h3>\n<ul>\n<li>\n<p><strong>Applications in Pods</strong>: Applications in a pod's containers can use an AWS SDK or the AWS CLI to make API requests to AWS services using IAM permissions. These applications must sign their AWS API requests with AWS credentials.</p>\n</li>\n<li>\n<p><strong>Credential Management</strong>: EKS Pod Identities manage credentials for your applications, similar to how Amazon EC2 instance profiles provide credentials to Amazon EC2 instances.</p>\n</li>\n<li>\n<p><strong>IAM Role Association</strong>: Instead of creating and distributing your AWS credentials to the containers or using the Amazon EC2 instance's role, you associate an IAM role with a Kubernetes service account and configure your pods to use the service account.</p>\n</li>\n<li>\n<p><strong>Pod Identity Agent</strong>: The Pod Identity agent, deployable as an EKS add-on, handles pod identity management with minimal operational overhead.</p>\n</li>\n<li>\n<p><strong>ABAC</strong>: Pod Identity uses attribute-based access control ABAC for more flexible role management.</p>\n</li>\n</ul>\n<h3 id=\"-introduction-to-boto3\" style=\"position:relative;\"><a href=\"#-introduction-to-boto3\" aria-label=\" introduction to boto3 permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>💡 Introduction to Boto3</h3>\n<p><a href=\"https://boto3.amazonaws.com/v1/documentation/api/latest/index.html\" target=\"_blank\" rel=\"noopener noreferrer\"><strong>Boto3</strong></a>  is the Amazon Web Services (AWS) SDK for Python. It allows Python developers to write software that makes use of services like Amazon S3 and Amazon EC2. Boto3 provides an easy-to-use, object-oriented API as well as low-level access to AWS services.</p>\n<h4 id=\"benefits-of-using-boto3-for-aws-resource-management\" style=\"position:relative;\"><a href=\"#benefits-of-using-boto3-for-aws-resource-management\" aria-label=\"benefits of using boto3 for aws resource management permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Benefits of Using Boto3 for AWS Resource Management</h4>\n<ul>\n<li><strong>Ease of use</strong>: Boto3 simplifies the process of interacting with AWS services by providing a high-level, Pythonic interface.</li>\n<li><strong>Comprehensive coverage</strong>: It supports a wide range of AWS services, allowing you to manage everything from S3 buckets to EC2 instances.</li>\n<li><strong>Integration</strong>: Boto3 integrates seamlessly with other Python libraries and frameworks, making it a versatile tool for AWS resource management.</li>\n<li><strong>Automation</strong>: With Boto3, you can automate repetitive tasks, such as creating and managing AWS resources, which improves efficiency and reduces the risk of human error.</li>\n<li><strong>Community and support</strong>: As a widely-used SDK, Boto3 has a large community and extensive documentation, making it easier to find help and resources.</li>\n</ul>\n<h3 id=\"-takeaways\" style=\"position:relative;\"><a href=\"#-takeaways\" aria-label=\" takeaways permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>🔄 Takeaways</h3>\n<ul>\n<li><strong>EKS Pod Identity</strong> simplifies the process of granting AWS permissions to Kubernetes pods.</li>\n<li><strong>Pod Identity Association</strong> eliminates the need for OIDC providers and allows IAM roles to be used across multiple clusters.</li>\n<li><strong>Pod Identity</strong> provides fine-grained control over pod permissions, while <strong>IRSA</strong> simplifies permission management at the service account level.</li>\n<li><strong>Boto3</strong> is a great tool for managing AWS resources programmatically with Python.</li>\n</ul>\n<h2 id=\"setting-up-eks-pod-identity\" style=\"position:relative;\"><a href=\"#setting-up-eks-pod-identity\" aria-label=\"setting up eks pod identity permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Setting Up EKS Pod Identity</h2>\n<p>We can create an EKS cluster using <code class=\"language-text\">eksctl</code> with the following configuration:</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token comment\"># cluster.yaml</span>\n<span class=\"token punctuation\">---</span>\n<span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> eksctl.io/v1alpha5\n<span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> ClusterConfig\n\n<span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> eks<span class=\"token punctuation\">-</span>pod<span class=\"token punctuation\">-</span>identity<span class=\"token punctuation\">-</span>boto3\n  <span class=\"token key atrule\">region</span><span class=\"token punctuation\">:</span> eu<span class=\"token punctuation\">-</span>west<span class=\"token punctuation\">-</span><span class=\"token number\">1</span>\n\n<span class=\"token key atrule\">managedNodeGroups</span><span class=\"token punctuation\">:</span>\n  <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> managed<span class=\"token punctuation\">-</span>nodes\n    <span class=\"token key atrule\">instanceType</span><span class=\"token punctuation\">:</span> m5.large\n    <span class=\"token key atrule\">minSize</span><span class=\"token punctuation\">:</span> <span class=\"token number\">2</span>\n    <span class=\"token key atrule\">desiredCapacity</span><span class=\"token punctuation\">:</span> <span class=\"token number\">3</span>\n    <span class=\"token key atrule\">maxSize</span><span class=\"token punctuation\">:</span> <span class=\"token number\">4</span>\n    <span class=\"token key atrule\">availabilityZones</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"eu-west-1a\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"eu-west-1b\"</span><span class=\"token punctuation\">]</span>\n    <span class=\"token key atrule\">volumeSize</span><span class=\"token punctuation\">:</span> <span class=\"token number\">20</span>\n    <span class=\"token key atrule\">updateConfig</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">maxUnavailable</span><span class=\"token punctuation\">:</span> <span class=\"token number\">3</span> \n    <span class=\"token key atrule\">securityGroups</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">attachIDs</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"sg-1\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"sg-2\"</span><span class=\"token punctuation\">]</span></code></pre></div>\n<p>Create the cluster with:</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">$ eksctl create cluster <span class=\"token parameter variable\">-f</span> cluster.yaml</code></pre></div>\n<h3 id=\"step-by-step-guide-to-creating-an-iam-role\" style=\"position:relative;\"><a href=\"#step-by-step-guide-to-creating-an-iam-role\" aria-label=\"step by step guide to creating an iam role permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Step-by-Step Guide to Creating an IAM Role</h3>\n<ol>\n<li>\n<p><strong>Create an IAM Role</strong>:</p>\n<ul>\n<li>Go to the IAM console.</li>\n<li>Click on <strong>Roles</strong> and then <strong>Create role</strong>.</li>\n<li>Select <strong>EKS</strong> as the trusted entity and choose <strong>EKS - Pod</strong>.</li>\n<li>Attach the necessary policies (e.g., <code class=\"language-text\">AmazonS3ReadOnlyAccess</code> for S3 access).</li>\n<li>Name the role (e.g., <code class=\"language-text\">EKS-S3-Access-Role</code>) and create it.</li>\n</ul>\n</li>\n<li>\n<p><strong>Update the Trust Policy</strong>:</p>\n<ul>\n<li>Go to the IAM role you just created.</li>\n<li>Under the <strong>Trust relationships</strong> tab, click <strong>Edit trust relationship</strong>.</li>\n<li>Update the trust policy to allow the <code class=\"language-text\">pods.eks.amazonaws.com</code> principal.</li>\n</ul>\n</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\n  <span class=\"token property\">\"Version\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"2012-10-17\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"Statement\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n    <span class=\"token punctuation\">{</span>\n      <span class=\"token property\">\"Effect\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Allow\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"Principal\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token property\">\"Service\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"eks.amazonaws.com\"</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"Action\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"sts:AssumeRole\"</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"sts:TagSession\"</span><span class=\"token punctuation\">]</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h3 id=\"associating-the-iam-role-with-a-kubernetes-service-account\" style=\"position:relative;\"><a href=\"#associating-the-iam-role-with-a-kubernetes-service-account\" aria-label=\"associating the iam role with a kubernetes service account permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Associating the IAM Role with a Kubernetes Service Account</h3>\n<blockquote>\n<p><strong>Note</strong>: Unlike IAM roles for service accounts, EKS Pod Identity doesn't use an annotation on the service account.</p>\n</blockquote>\n<h4 id=\"create-a-kubernetes-service-account\" style=\"position:relative;\"><a href=\"#create-a-kubernetes-service-account\" aria-label=\"create a kubernetes service account permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Create a Kubernetes Service Account</h4>\n<p>Create a service account in your Kubernetes cluster.</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> v1\n<span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> ServiceAccount\n<span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> s3<span class=\"token punctuation\">-</span>access<span class=\"token punctuation\">-</span>sa\n  <span class=\"token key atrule\">namespace</span><span class=\"token punctuation\">:</span> default</code></pre></div>\n<h4 id=\"apply-the-service-account\" style=\"position:relative;\"><a href=\"#apply-the-service-account\" aria-label=\"apply the service account permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Apply the Service Account</h4>\n<p>Apply the service account configuration to your cluster.</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">$ kubectl apply <span class=\"token parameter variable\">-f</span> service-account.yaml</code></pre></div>\n<h3 id=\"installing-the-pod-identity-agent\" style=\"position:relative;\"><a href=\"#installing-the-pod-identity-agent\" aria-label=\"installing the pod identity agent permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Installing the Pod Identity Agent</h3>\n<h4 id=\"install-the-pod-identity-agent\" style=\"position:relative;\"><a href=\"#install-the-pod-identity-agent\" aria-label=\"install the pod identity agent permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Install the Pod Identity Agent</h4>\n<p>Use the AWS CLI to install the Pod Identity Agent as an EKS add-on.</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">$ aws eks create-addon --cluster-name eks-pod-identity-boto3 --addon-name eks-pod-identity-agent --addon-version v1.0.0-eksbuild.1</code></pre></div>\n<p>Confirm that the EKS Pod Identity Agent pods are running on your cluster.</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">$ kubectl get pods <span class=\"token parameter variable\">-n</span> kube-system <span class=\"token operator\">|</span> <span class=\"token function\">grep</span> <span class=\"token string\">'eks-pod-identity-agent'</span></code></pre></div>\n<h3 id=\"creating-a-pod-identity-association\" style=\"position:relative;\"><a href=\"#creating-a-pod-identity-association\" aria-label=\"creating a pod identity association permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Creating a Pod Identity Association</h3>\n<p>Create a pod identity association using the AWS CLI:</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">$ aws eks create-pod-identity-association <span class=\"token punctuation\">\\</span>\n  --cluster-name eks-pod-identity-boto3 <span class=\"token punctuation\">\\</span>\n  <span class=\"token parameter variable\">--namespace</span> default <span class=\"token punctuation\">\\</span>\n  --service-account s3-access-sa <span class=\"token punctuation\">\\</span>\n  --role-arn arn:aws:iam::012345678901:role/EKS-S3-Access-Role</code></pre></div>\n<p>Ensure the IAM role has the following trust policy:</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\n  <span class=\"token property\">\"Version\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"2012-10-17\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"Statement\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"Effect\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Allow\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"Principal\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token property\">\"Service\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"pods.eks.amazonaws.com\"</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"Action\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"sts:AssumeRole\"</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"sts:TagSession\"</span><span class=\"token punctuation\">]</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h2 id=\"deploying-a-test-pod\" style=\"position:relative;\"><a href=\"#deploying-a-test-pod\" aria-label=\"deploying a test pod permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Deploying a test Pod</h2>\n<h3 id=\"creating-a-kubernetes-pod-spec\" style=\"position:relative;\"><a href=\"#creating-a-kubernetes-pod-spec\" aria-label=\"creating a kubernetes pod spec permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Creating a Kubernetes Pod Spec</h3>\n<p>Create a Kubernetes pod specification that uses the service account with the IAM role.</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> v1\n<span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> Pod\n<span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> s3<span class=\"token punctuation\">-</span>list<span class=\"token punctuation\">-</span>pod\n  <span class=\"token key atrule\">namespace</span><span class=\"token punctuation\">:</span> default\n<span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">serviceAccountName</span><span class=\"token punctuation\">:</span> s3<span class=\"token punctuation\">-</span>access<span class=\"token punctuation\">-</span>sa\n  <span class=\"token key atrule\">containers</span><span class=\"token punctuation\">:</span>\n  <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> s3<span class=\"token punctuation\">-</span>list<span class=\"token punctuation\">-</span>container\n    <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> amazonlinux\n    <span class=\"token key atrule\">command</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"/bin/sh\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"-c\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"while true; do sleep 30; done;\"</span><span class=\"token punctuation\">]</span></code></pre></div>\n<p>Save this specification to a file named <code class=\"language-text\">pod-spec.yaml</code>.</p>\n<h3 id=\"deploying-the-pod-with-the-service-account\" style=\"position:relative;\"><a href=\"#deploying-the-pod-with-the-service-account\" aria-label=\"deploying the pod with the service account permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Deploying the Pod with the Service Account</h3>\n<p>Apply the pod specification to your Kubernetes cluster.</p>\n<div class=\"gatsby-highlight\" data-language=\"sh\"><pre class=\"language-sh\"><code class=\"language-sh\">kubectl apply <span class=\"token parameter variable\">-f</span> pod-spec.yaml</code></pre></div>\n<p>Verify that the pod is running.</p>\n<div class=\"gatsby-highlight\" data-language=\"sh\"><pre class=\"language-sh\"><code class=\"language-sh\">kubectl get pods <span class=\"token parameter variable\">-n</span> default</code></pre></div>\n<h2 id=\"using-boto3-inside-the-pod\" style=\"position:relative;\"><a href=\"#using-boto3-inside-the-pod\" aria-label=\"using boto3 inside the pod permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Using Boto3 Inside the Pod</h2>\n<h3 id=\"accessing-the-pod-and-installing-boto3\" style=\"position:relative;\"><a href=\"#accessing-the-pod-and-installing-boto3\" aria-label=\"accessing the pod and installing boto3 permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Accessing the Pod and Installing Boto3</h3>\n<p>Use <code class=\"language-text\">kubectl exec</code> to access the pod.</p>\n<div class=\"gatsby-highlight\" data-language=\"sh\"><pre class=\"language-sh\"><code class=\"language-sh\">kubectl <span class=\"token builtin class-name\">exec</span> <span class=\"token parameter variable\">-it</span> s3-list-pod -- /bin/bash</code></pre></div>\n<p>Inside the pod, install Boto3 using pip.</p>\n<div class=\"gatsby-highlight\" data-language=\"sh\"><pre class=\"language-sh\"><code class=\"language-sh\">yum <span class=\"token function\">install</span> <span class=\"token parameter variable\">-y</span> python3-pip\npip3 <span class=\"token function\">install</span> boto3</code></pre></div>\n<h3 id=\"writing-a-python-script-to-list-s3-bucket-objects\" style=\"position:relative;\"><a href=\"#writing-a-python-script-to-list-s3-bucket-objects\" aria-label=\"writing a python script to list s3 bucket objects permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Writing a Python Script to List S3 Bucket Objects</h3>\n<p>Create a Python script to list objects in an S3 bucket. Save this script as <code class=\"language-text\">list_s3_objects.py</code>.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">import</span> boto3\n\n<span class=\"token comment\"># Create a session using the default credentials chain</span>\nsession <span class=\"token operator\">=</span> boto3<span class=\"token punctuation\">.</span>Session<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\"># Create an S3 client</span>\ns3 <span class=\"token operator\">=</span> session<span class=\"token punctuation\">.</span>client<span class=\"token punctuation\">(</span><span class=\"token string\">'s3'</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\"># List all buckets</span>\nresponse <span class=\"token operator\">=</span> s3<span class=\"token punctuation\">.</span>list_buckets<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\"># Print bucket names</span>\n<span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Buckets:\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">for</span> bucket <span class=\"token keyword\">in</span> response<span class=\"token punctuation\">[</span><span class=\"token string\">'Buckets'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string-interpolation\"><span class=\"token string\">f\"  </span><span class=\"token interpolation\"><span class=\"token punctuation\">{</span>bucket<span class=\"token punctuation\">[</span><span class=\"token string\">'Name'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">}</span></span><span class=\"token string\">\"</span></span><span class=\"token punctuation\">)</span></code></pre></div>\n<h3 id=\"running-the-script-and-verifying-access\" style=\"position:relative;\"><a href=\"#running-the-script-and-verifying-access\" aria-label=\"running the script and verifying access permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Running the Script and Verifying Access</h3>\n<p>Run the Python script inside the pod.</p>\n<div class=\"gatsby-highlight\" data-language=\"sh\"><pre class=\"language-sh\"><code class=\"language-sh\">python3 list_s3_objects.py</code></pre></div>\n<p>Check the output to verify that the script lists the S3 buckets.</p>\n<div class=\"gatsby-highlight\" data-language=\"sh\"><pre class=\"language-sh\"><code class=\"language-sh\">kubectl logs s3-list-pod</code></pre></div>\n<h2 id=\"conclusion\" style=\"position:relative;\"><a href=\"#conclusion\" aria-label=\"conclusion permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Conclusion</h2>\n<p>In this blog post, we explored how to securely manage AWS resources using the AWS EKS Pod Identity Agent and Boto3. We began by understanding the importance of managing AWS resources securely and introduced the concept of Pod Identity in Kubernetes, highlighting its implementation in Amazon EKS.</p>\n<p>We then provided a detailed, step-by-step guide to setting up EKS Pod Identity, including creating an IAM role, associating it with a Kubernetes service account, and installing the Pod Identity Agent. Following this, we demonstrated how to deploy a test pod and use Boto3 inside the pod to list S3 bucket objects.</p>\n<p>By using these tools, you can enhance security, simplify management, and increase the flexibility and scalability of your AWS resource management.</p>\n<h2 id=\"-additional-resources\" style=\"position:relative;\"><a href=\"#-additional-resources\" aria-label=\" additional resources permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>📻🧡 Additional Resources</h2>\n<ul>\n<li><a href=\"https://docs.aws.amazon.com/eks/latest/userguide/pod-id-how-it-works.html\" target=\"_blank\" rel=\"noopener noreferrer\">AWS EKS Pod Identity agent documentation</a></li>\n<li><a href=\"https://boto3.amazonaws.com/v1/documentation/api/latest/index.html\" target=\"_blank\" rel=\"noopener noreferrer\">Boto3 documentation</a></li>\n<li><a href=\"https://kubernetes.io/docs/concepts/security/service-accounts/\" target=\"_blank\" rel=\"noopener noreferrer\">Kubernetes Service accounts</a></li>\n<li><a href=\"https://docs.aws.amazon.com/eks/latest/userguide/iam-roles-for-service-accounts.html\" target=\"_blank\" rel=\"noopener noreferrer\">IAM Roles for Service Accounts (IRSA)</a></li>\n<li><a href=\"https://docs.aws.amazon.com/eks/latest/userguide/what-is-eks.html\" target=\"_blank\" rel=\"noopener noreferrer\">Amazon EKS documentation</a></li>\n<li><a href=\"https://kubernetes.io/docs/reference/access-authn-authz/rbac/\" target=\"_blank\" rel=\"noopener noreferrer\">Kubernetes RBAC</a></li>\n<li><a href=\"https://docs.aws.amazon.com/IAM/latest/UserGuide/introduction_attribute-based-access-control.html\" target=\"_blank\" rel=\"noopener noreferrer\">AWS ABAC</a></li>\n</ul>\n<p>Further reading on Kubernetes, EKS, and Boto3:</p>\n<ul>\n<li><a href=\"https://kubernetes.io/docs/concepts/\" target=\"_blank\" rel=\"noopener noreferrer\">Kubernetes documentation</a></li>\n<li><a href=\"https://aws.github.io/aws-eks-best-practices/\" target=\"_blank\" rel=\"noopener noreferrer\">Amazon EKS best practices Guide</a></li>\n<li><a href=\"https://github.com/boto/boto3\" target=\"_blank\" rel=\"noopener noreferrer\">Boto3 GitHub repository</a></li>\n<li><a href=\"https://github.com/aws/eks-pod-identity-agent\" target=\"_blank\" rel=\"noopener noreferrer\">Pod Agent GitHub repository</a></li>\n<li><a href=\"https://github.com/aws-ia/terraform-aws-eks-blueprints-addons\" target=\"_blank\" rel=\"noopener noreferrer\">EKS addons GitHub repository</a></li>\n</ul>\n<br>\n<br>\n<blockquote>\n<p>💡 Thank you for Reading !! 🙌🏻😁📃, see you in the next blog.🤘  <em><strong>Until next time 🎉</strong></em></p>\n</blockquote>\n<p>🚀 Thank you for sticking up till the end. If you have any questions/feedback regarding this blog feel free to connect with me:</p>\n<p><strong>♻️ LinkedIn:</strong> <a href=\"https://www.linkedin.com/in/rajhi-saif/\" target=\"_blank\" rel=\"noopener noreferrer\">https://www.linkedin.com/in/rajhi-saif/</a></p>\n<p><strong>♻️ X/Twitter:</strong> <a href=\"https://x.com/rajhisaifeddine\" target=\"_blank\" rel=\"noopener noreferrer\">https://x.com/rajhisaifeddine</a></p>\n<p><strong>The end ✌🏻</strong></p>\n<h1 align=\"center\">🔰 Keep Learning !! Keep Sharing !! 🔰</h1>\n<p><strong>📅 Stay updated</strong></p>\n<p>Subscribe to our newsletter for more insights on AWS cloud computing and containers.</p>"}}},"staticQueryHashes":["1271460761","1321585977"],"slicesMap":{}}