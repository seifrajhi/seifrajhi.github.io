{"componentChunkName":"component---src-templates-blog-template-js","path":"/blog/istio-1-24-major-changes/","result":{"data":{"markdownRemark":{"html":"<blockquote>\n<p><strong>Istio 1.24: What's New?</strong></p>\n</blockquote>\n<h2 id=\"-introduction\" style=\"position:relative;\"><a href=\"#-introduction\" aria-label=\" introduction permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>📚 Introduction</h2>\n<p>The Istio 1.24 has just released, and it's packed with exciting new features and improvements.</p>\n<blockquote>\n<p>Istio 1.24.0 is officially supported on Kubernetes versions <code class=\"language-text\">1.28</code> to <code class=\"language-text\">1.31</code>.</p>\n</blockquote>\n<p>In this blog post, we'll discover an explore the new key features and enhancements in Istio 1.24, making it easier for you to understand and leverage these cool fewatures in your Kubernetes environment.</p>\n<p><span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 55.88235294117647%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAABYlAAAWJQFJUiTwAAACt0lEQVR42kWSWU/TURDF+6GMMUSRRcqmCEoUBVmkpSxdgCJFDIoVadmRVokICkpStpauULballoQXGIwLuFBY/RFEr/Cz3v/GHyYO3OXOffMnFGpjX5yTH70fTEaBzfR2aI0DSUw9MWp64ly6WaYis415V5ne0mNMPODV8r++r0N6nti1Iqz/KYAaoMfVZbeJwIfmvsR2pxJJanWHlXAZFxsWaakfUXZ13RH0Xa/pE7c64SXcZUAlbmS1JkG3z9AYSkaD8fK3Ryv9JBS7eHa3XVMwwkqrBs0CW8Rn2m6IkoVDb0xUnUe0usWSatdVLzEkaaS7FJrvNR2B3C6wgxPhyjr8HKnP4Fz9DX9I1uUCJbZojXSck0Bxcs8aZLVSa1bAVYA5ZLXGBLlrNI5FsEyFCTX6KGqfQmrI0LHSILzzSHSBIsCc5DMegniVcAyxFlRSwj75FsqRUWSqUou1skPjAa/4/DuYxjcRmNd4crtZczjqzQ/WUdt9HGqxsOoew+t6Ncp3SKZQoCzQojVrR9Edn7y/ssBWtFPhWGOKMFsT3JvMIn+fpT9/X2cs7s0ju3Q7f5IVU9cEefztz84F/ZIq55DrZlDI0T58PUAU39cAR6Yfv9flNbeTWyObQxdQoT+NaHiOh0T21hfbFMuxJDljnn2qLbFKCqforRsnNN6P7PLX3n36TfRN7+43B5GlSmaWtDkwzm5guPpEkOPAxSY3LTcDfJoJMRDR5iLzX4yxLvClmXyLGHSTUtcaAtQdstLVssKWnucQnOIdCHM0RzmGgMUtwaxTcTpGk/S9yyB0R4mx+AlW/RLfpyvnyfzpotU/XOutrqp75on/cYMJ7RjZAiwo8GWllHnVcoank4yOBXDObOLaSCmjMPhePjJNy5Qap4iu8FFrn6WMssk5xpdFDa7xP3h2PwF8RY+ZzWrk0kAAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"alt text\" title=\"\" src=\"/static/c4ac5299b2917eddaad2f8659b472a21/c5bb3/istio-1-24.png\" srcset=\"/static/c4ac5299b2917eddaad2f8659b472a21/04472/istio-1-24.png 170w,\n/static/c4ac5299b2917eddaad2f8659b472a21/9f933/istio-1-24.png 340w,\n/static/c4ac5299b2917eddaad2f8659b472a21/c5bb3/istio-1-24.png 680w,\n/static/c4ac5299b2917eddaad2f8659b472a21/b12f7/istio-1-24.png 1020w,\n/static/c4ac5299b2917eddaad2f8659b472a21/b5a09/istio-1-24.png 1360w,\n/static/c4ac5299b2917eddaad2f8659b472a21/fb371/istio-1-24.png 2512w\" sizes=\"(max-width: 680px) 100vw, 680px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n    </span>\n          </p>\n<h2 id=\"new-features-and-enhancements-in-istio-124\" style=\"position:relative;\"><a href=\"#new-features-and-enhancements-in-istio-124\" aria-label=\"new features and enhancements in istio 124 permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>New Features and Enhancements in Istio 1.24</h2>\n<h3 id=\"-ambient-mode-promotion-to-stable\" style=\"position:relative;\"><a href=\"#-ambient-mode-promotion-to-stable\" aria-label=\" ambient mode promotion to stable permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>🌟 Ambient Mode Promotion to Stable</h3>\n<p>Istio team has announced that Istio ambient mode has been promoted to Stable (or \"General Available\" or \"GA\")! This marks the final stage in Istio's <a href=\"https://istio.io/latest/about/feature-stages/\" target=\"_blank\" rel=\"noopener noreferrer\">feature phase progression</a>, indicating that the feature is fully ready for broad production usage.</p>\n<p>Since its <a href=\"https://istio.io/latest/blog/2022/introducing-ambient-mesh/\" target=\"_blank\" rel=\"noopener noreferrer\">announcement in 2022</a>, the community has been diligently <a href=\"https://istio.io/latest/blog/2024/inpod-traffic-redirection-ambient/\" target=\"_blank\" rel=\"noopener noreferrer\">innovating</a>, <a href=\"https://istio.io/latest/blog/2024/ambient-vs-cilium/\" target=\"_blank\" rel=\"noopener noreferrer\">scaling</a>, <a href=\"https://istio.io/latest/blog/2024/ambient-reaches-beta/\" target=\"_blank\" rel=\"noopener noreferrer\">stabilizing</a>, and tuning ambient mode to be production-ready.</p>\n<p>On top of <a href=\"https://istio.io/latest/news/releases/1.23.x/announcing-1.23/#ambient-ambient-ambient\" target=\"_blank\" rel=\"noopener noreferrer\">numerous changes since the Beta release</a>, Istio 1.24 includes several enhancements to ambient mode:</p>\n<ul>\n<li>New <code class=\"language-text\">status</code> messages are now written to various resources, including <code class=\"language-text\">Services</code> and <code class=\"language-text\">AuthorizationPolicies</code>, to help understand the current state of the object. (<a href=\"https://github.com/istio/istio/issues/52699\" target=\"_blank\" rel=\"noopener noreferrer\">Issue #52699</a>)</li>\n<li>Policies can now be attached directly to <code class=\"language-text\">ServiceEntry</code>s. Try it out with a simplified <a href=\"https://www.solo.io/blog/egress-gateways-made-easy/\" target=\"_blank\" rel=\"noopener noreferrer\">egress gateway</a>! (<a href=\"https://github.com/istio/istio/issues/52532\" target=\"_blank\" rel=\"noopener noreferrer\">Issue #52532</a>)</li>\n<li>A comprehensive <a href=\"https://github.com/istio/istio/wiki/Troubleshooting-Istio-Ambient\" target=\"_blank\" rel=\"noopener noreferrer\">troubleshooting guide</a> has been created. Fortunately, many bug fixes in Istio 1.24 make many of these troubleshooting steps unnecessary!</li>\n<li>Numerous bug fixes, particularly for edge cases around pods with multiple interfaces, GKE Intranode visibility, IPv4-only clusters, and more. (<a href=\"https://github.com/istio/istio/issues/52713\" target=\"_blank\" rel=\"noopener noreferrer\">Issue #52713</a>)</li>\n</ul>\n<h3 id=\"-improved-retries\" style=\"position:relative;\"><a href=\"#-improved-retries\" aria-label=\" improved retries permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>🔄 Improved Retries</h3>\n<p>Automatic <a href=\"https://istio.io/latest/docs/concepts/traffic-management/#retries\" target=\"_blank\" rel=\"noopener noreferrer\">retries</a> have been a core part of Istio's traffic management functionality. In Istio 1.24, this feature has been further enhanced.</p>\n<p>Previously, retries were exclusively implemented on the <em>client sidecar</em>. However, a common source of connection failures actually comes from communication between the <em>server sidecar</em> and the server application, typically from attempting to re-use a connection that the backend is closing. With the improved functionality, we can detect this case and retry on the server sidecar automatically. (<a href=\"https://github.com/istio/istio/issues/51704\" target=\"_blank\" rel=\"noopener noreferrer\">Issue #51704</a>)</p>\n<p>Additionally, the default policy of retrying <code class=\"language-text\">503</code> errors has been removed. This was initially added primarily to handle the above failure types but had some negative side effects on some applications. (<a href=\"https://github.com/istio/istio/issues/50506\" target=\"_blank\" rel=\"noopener noreferrer\">Issue #50506</a>)</p>\n<h3 id=\"-support-for-telemetry-customization\" style=\"position:relative;\"><a href=\"#-support-for-telemetry-customization\" aria-label=\" support for telemetry customization permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>📊 Support for Telemetry Customization</h3>\n<p>Telemetry in the waypoint proxy can now be customized, providing more flexibility and control over monitoring and observability. This allows for better insights and more tailored metrics collection. <a href=\"https://istio.io/latest/docs/tasks/observability/metrics/\" target=\"_blank\" rel=\"noopener noreferrer\">Learn more about Istio telemetry</a>. (<a href=\"https://github.com/istio/istio/issues/52873\" target=\"_blank\" rel=\"noopener noreferrer\">Issue #52873</a>)</p>\n<h3 id=\"-dual-stack-support\" style=\"position:relative;\"><a href=\"#-dual-stack-support\" aria-label=\" dual stack support permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>🌐 Dual-Stack Support</h3>\n<p>Dual-stack support has been promoted to Alpha, allowing better handling of services with multiple IPs. This improvement enhances network management and service reliability, making it easier to manage IPv4 and IPv6 addresses simultaneously. More information can be found in the <a href=\"https://istio.io/latest/docs/setup/additional-setup/dual-stack/\" target=\"_blank\" rel=\"noopener noreferrer\">dual-stack support documentation</a>. (<a href=\"https://github.com/istio/istio/issues/47998\" target=\"_blank\" rel=\"noopener noreferrer\">Issue #47998</a>)</p>\n<h3 id=\"-enhanced-traffic-management\" style=\"position:relative;\"><a href=\"#-enhanced-traffic-management\" aria-label=\" enhanced traffic management permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>🚦 Enhanced Traffic Management</h3>\n<p>New parameters for <code class=\"language-text\">DestinationRule</code>, such as warmup behavior controls, and improved XDS generation behavior, offer more precise traffic management capabilities. These enhancements help in fine-tuning traffic flow and improving overall service performance. For a deeper dive, see the <a href=\"https://istio.io/latest/docs/concepts/traffic-management/\" target=\"_blank\" rel=\"noopener noreferrer\">traffic management guide</a>. (<a href=\"https://github.com/istio/api/issues/3215\" target=\"_blank\" rel=\"noopener noreferrer\">Issue #3215</a>)</p>\n<h3 id=\"-improved-istiod-validation\" style=\"position:relative;\"><a href=\"#-improved-istiod-validation\" aria-label=\" improved istiod validation permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>✅ Improved Istiod Validation</h3>\n<p>Istiod’s validation webhook now accepts unknown versions, ensuring compatibility with newer CRDs and reducing upgrade friction. This change simplifies the upgrade process and ensures smoother transitions between versions. Check out the <a href=\"https://istio.io/latest/docs/reference/config/istio.operator.v1alpha1/#IstiodConfiguration\" target=\"_blank\" rel=\"noopener noreferrer\">Istiod documentation</a> for more details. (<a href=\"https://github.com/istio/istio/issues/40394\" target=\"_blank\" rel=\"noopener noreferrer\">Issue #40394</a>)</p>\n<h3 id=\"-updated-crd-handling\" style=\"position:relative;\"><a href=\"#-updated-crd-handling\" aria-label=\" updated crd handling permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>📦 Updated CRD Handling</h3>\n<p>CRDs are now templated by default and can be installed/upgraded via Helm, simplifying the upgrade process and ensuring consistency. This change makes it easier to manage CRDs and reduces the risk of errors during upgrades. <a href=\"https://istio.io/latest/docs/setup/install/helm/\" target=\"_blank\" rel=\"noopener noreferrer\">Learn more about CRD management</a>. (<a href=\"https://github.com/istio/istio/issues/43204\" target=\"_blank\" rel=\"noopener noreferrer\">Issue #43204</a>)</p>\n<h3 id=\"️-sidecar-scoping-changes\" style=\"position:relative;\"><a href=\"#%EF%B8%8F-sidecar-scoping-changes\" aria-label=\"️ sidecar scoping changes permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>🛡️ Sidecar Scoping Changes</h3>\n<p>Unified behavior for conflict resolution strategies between services with and without Sidecar resources, providing a more predictable and streamlined experience. This change ensures that services behave consistently, regardless of the presence of Sidecar resources. For more information, see the <a href=\"https://istio.io/latest/docs/reference/config/networking/sidecar/\" target=\"_blank\" rel=\"noopener noreferrer\">sidecar configuration</a>. (<a href=\"https://github.com/istio/istio/issues/52519\" target=\"_blank\" rel=\"noopener noreferrer\">Issue #52519</a>)</p>\n<h3 id=\"-standardization-of-peer-metadata-attributes\" style=\"position:relative;\"><a href=\"#-standardization-of-peer-metadata-attributes\" aria-label=\" standardization of peer metadata attributes permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>🔧 Standardization of Peer Metadata Attributes</h3>\n<p>CEL expressions in the telemetry API now use standard Envoy attributes, improving compatibility and reducing complexity. This standardization helps in creating more reliable and maintainable telemetry configurations. <a href=\"https://istio.io/latest/docs/reference/config/telemetry/\" target=\"_blank\" rel=\"noopener noreferrer\">Read more about CEL expressions</a>. (<a href=\"https://github.com/istio/istio/issues/52177\" target=\"_blank\" rel=\"noopener noreferrer\">Issue #52177</a>)</p>\n<h3 id=\"️-improved-waypoint-configuration\" style=\"position:relative;\"><a href=\"#%EF%B8%8F-improved-waypoint-configuration\" aria-label=\"️ improved waypoint configuration permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>⚙️ Improved Waypoint Configuration</h3>\n<p>Waypoint resources, pod affinity, topologySpreadConstraints, tolerations, and nodeSelector are now configurable, offering greater flexibility in deployment configurations. These improvements make it easier to optimize resource allocation and ensure high availability. For detailed configuration options, visit the <a href=\"https://istio.io/latest/docs/reference/config/telemetry/\" target=\"_blank\" rel=\"noopener noreferrer\">waypoint configuration guide</a>. (<a href=\"https://github.com/istio/istio/issues/52901\" target=\"_blank\" rel=\"noopener noreferrer\">Issue #52901</a>)</p>\n<h2 id=\"️-upgrading-to-istio-124\" style=\"position:relative;\"><a href=\"#%EF%B8%8F-upgrading-to-istio-124\" aria-label=\"️ upgrading to istio 124 permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>🛠️ Upgrading to Istio 1.24</h2>\n<p>Upgrading to Istio 1.24 is straightforward, but it's important to review the changes and update your configurations accordingly. The Istio community is eager to hear your feedback, so don't hesitate to share your experiences in the <a href=\"https://slack.istio.io/\" target=\"_blank\" rel=\"noopener noreferrer\">#release-1.24 channel on Slack</a>.</p>\n<p>Would you like to contribute directly to Istio? Find and join one of our <a href=\"https://github.com/istio/community/blob/master/WORKING-GROUPS.md\" target=\"_blank\" rel=\"noopener noreferrer\">Working Groups</a> and help us improve.</p>\n<p>Attending KubeCon North America 2024? Be sure to stop by the co-located <a href=\"https://events.linuxfoundation.org/kubecon-cloudnativecon-north-america/co-located-events/istio-day/\" target=\"_blank\" rel=\"noopener noreferrer\">Istio Day</a> to catch some <a href=\"https://events.linuxfoundation.org/kubecon-cloudnativecon-north-america/\" target=\"_blank\" rel=\"noopener noreferrer\">great talks</a>, or swing by the <a href=\"https://events.linuxfoundation.org/kubecon-cloudnativecon-north-america/venue-travel/#venue-maps\" target=\"_blank\" rel=\"noopener noreferrer\">Istio project booth</a> to chat.</p>\n<h2 id=\"-conclusion\" style=\"position:relative;\"><a href=\"#-conclusion\" aria-label=\" conclusion permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>🎉 Conclusion</h2>\n<p>Istio 1.24 brings a host of new features and improvements that enhance stability, traffic management, and customization options. Whether you're attending KubeCon North America 2024 or just exploring the latest release, these changes are sure to make a positive impact on your Kubernetes environment.</p>\n<p>Stay tuned for more updates and happy upgrading!</p>\n<p><strong>Resources:</strong></p>\n<ul>\n<li><a href=\"https://istio.io/latest/news/releases/1.24.x/announcing-1.24/\" target=\"_blank\" rel=\"noopener noreferrer\">https://istio.io/latest/news/releases/1.24.x/announcing-1.24/</a></li>\n<li><a href=\"https://istio.io/latest/news/releases/1.24.x/announcing-1.24/change-notes/\" target=\"_blank\" rel=\"noopener noreferrer\">https://istio.io/latest/news/releases/1.24.x/announcing-1.24/change-notes/</a></li>\n<li><a href=\"https://istio.io/latest/news/releases/1.24.x/announcing-1.24/upgrade-notes/\" target=\"_blank\" rel=\"noopener noreferrer\">https://istio.io/latest/news/releases/1.24.x/announcing-1.24/upgrade-notes/</a></li>\n</ul>\n<br>\n<br>\n<blockquote>\n<p>💡 Thank you for Reading !! 🙌🏻😁📃, see you in the next blog.🤘  <strong><em>Until next time 🎉</em></strong></p>\n</blockquote>\n<p>🚀 Thank you for sticking up till the end. If you have any questions/feedback regarding this blog feel free to connect with me:</p>\n<p><strong>♻️ LinkedIn:</strong> <a href=\"https://www.linkedin.com/in/rajhi-saif/\" target=\"_blank\" rel=\"noopener noreferrer\">https://www.linkedin.com/in/rajhi-saif/</a></p>\n<p><strong>♻️ X/Twitter:</strong> <a href=\"https://x.com/rajhisaifeddine\" target=\"_blank\" rel=\"noopener noreferrer\">https://x.com/rajhisaifeddine</a></p>\n<p><strong>The end ✌🏻</strong></p>\n<h1 align=\"center\">🔰 Keep Learning !! Keep Sharing !! 🔰</h1>\n<p><strong>📅 Stay updated</strong></p>\n<p>Subscribe to our newsletter for more insights on AWS cloud computing and containers.</p>","timeToRead":4,"rawMarkdownBody":"\n> **Istio 1.24: What's New?**\n\n## 📚 Introduction\n\nThe Istio 1.24 has just released, and it's packed with exciting new features and improvements.\n\n> Istio 1.24.0 is officially supported on Kubernetes versions `1.28` to `1.31`.\n\nIn this blog post, we'll discover an explore the new key features and enhancements in Istio 1.24, making it easier for you to understand and leverage these cool fewatures in your Kubernetes environment.\n\n![alt text](istio-1-24.png)\n\n## New Features and Enhancements in Istio 1.24\n\n### 🌟 Ambient Mode Promotion to Stable\n\nIstio team has announced that Istio ambient mode has been promoted to Stable (or \"General Available\" or \"GA\")! This marks the final stage in Istio's [feature phase progression](https://istio.io/latest/about/feature-stages/), indicating that the feature is fully ready for broad production usage.\n\nSince its [announcement in 2022](https://istio.io/latest/blog/2022/introducing-ambient-mesh/), the community has been diligently [innovating](https://istio.io/latest/blog/2024/inpod-traffic-redirection-ambient/), [scaling](https://istio.io/latest/blog/2024/ambient-vs-cilium/), [stabilizing](https://istio.io/latest/blog/2024/ambient-reaches-beta/), and tuning ambient mode to be production-ready.\n\nOn top of [numerous changes since the Beta release](https://istio.io/latest/news/releases/1.23.x/announcing-1.23/#ambient-ambient-ambient), Istio 1.24 includes several enhancements to ambient mode:\n\n* New `status` messages are now written to various resources, including `Services` and `AuthorizationPolicies`, to help understand the current state of the object. ([Issue #52699](https://github.com/istio/istio/issues/52699))\n* Policies can now be attached directly to `ServiceEntry`s. Try it out with a simplified [egress gateway](https://www.solo.io/blog/egress-gateways-made-easy/)! ([Issue #52532](https://github.com/istio/istio/issues/52532))\n* A comprehensive [troubleshooting guide](https://github.com/istio/istio/wiki/Troubleshooting-Istio-Ambient) has been created. Fortunately, many bug fixes in Istio 1.24 make many of these troubleshooting steps unnecessary!\n* Numerous bug fixes, particularly for edge cases around pods with multiple interfaces, GKE Intranode visibility, IPv4-only clusters, and more. ([Issue #52713](https://github.com/istio/istio/issues/52713))\n\n### 🔄 Improved Retries\n\nAutomatic [retries](https://istio.io/latest/docs/concepts/traffic-management/#retries) have been a core part of Istio's traffic management functionality. In Istio 1.24, this feature has been further enhanced.\n\nPreviously, retries were exclusively implemented on the *client sidecar*. However, a common source of connection failures actually comes from communication between the *server sidecar* and the server application, typically from attempting to re-use a connection that the backend is closing. With the improved functionality, we can detect this case and retry on the server sidecar automatically. ([Issue #51704](https://github.com/istio/istio/issues/51704))\n\nAdditionally, the default policy of retrying `503` errors has been removed. This was initially added primarily to handle the above failure types but had some negative side effects on some applications. ([Issue #50506](https://github.com/istio/istio/issues/50506))\n\n### 📊 Support for Telemetry Customization\n\nTelemetry in the waypoint proxy can now be customized, providing more flexibility and control over monitoring and observability. This allows for better insights and more tailored metrics collection. [Learn more about Istio telemetry](https://istio.io/latest/docs/tasks/observability/metrics/). ([Issue #52873](https://github.com/istio/istio/issues/52873))\n\n### 🌐 Dual-Stack Support\n\nDual-stack support has been promoted to Alpha, allowing better handling of services with multiple IPs. This improvement enhances network management and service reliability, making it easier to manage IPv4 and IPv6 addresses simultaneously. More information can be found in the [dual-stack support documentation](https://istio.io/latest/docs/setup/additional-setup/dual-stack/). ([Issue #47998](https://github.com/istio/istio/issues/47998))\n\n### 🚦 Enhanced Traffic Management\n\nNew parameters for `DestinationRule`, such as warmup behavior controls, and improved XDS generation behavior, offer more precise traffic management capabilities. These enhancements help in fine-tuning traffic flow and improving overall service performance. For a deeper dive, see the [traffic management guide](https://istio.io/latest/docs/concepts/traffic-management/). ([Issue #3215](https://github.com/istio/api/issues/3215))\n\n### ✅ Improved Istiod Validation\n\nIstiod’s validation webhook now accepts unknown versions, ensuring compatibility with newer CRDs and reducing upgrade friction. This change simplifies the upgrade process and ensures smoother transitions between versions. Check out the [Istiod documentation](https://istio.io/latest/docs/reference/config/istio.operator.v1alpha1/#IstiodConfiguration) for more details. ([Issue #40394](https://github.com/istio/istio/issues/40394))\n\n### 📦 Updated CRD Handling\n\nCRDs are now templated by default and can be installed/upgraded via Helm, simplifying the upgrade process and ensuring consistency. This change makes it easier to manage CRDs and reduces the risk of errors during upgrades. [Learn more about CRD management](https://istio.io/latest/docs/setup/install/helm/). ([Issue #43204](https://github.com/istio/istio/issues/43204))\n\n### 🛡️ Sidecar Scoping Changes\n\nUnified behavior for conflict resolution strategies between services with and without Sidecar resources, providing a more predictable and streamlined experience. This change ensures that services behave consistently, regardless of the presence of Sidecar resources. For more information, see the [sidecar configuration](https://istio.io/latest/docs/reference/config/networking/sidecar/). ([Issue #52519](https://github.com/istio/istio/issues/52519))\n\n### 🔧 Standardization of Peer Metadata Attributes\n\nCEL expressions in the telemetry API now use standard Envoy attributes, improving compatibility and reducing complexity. This standardization helps in creating more reliable and maintainable telemetry configurations. [Read more about CEL expressions](https://istio.io/latest/docs/reference/config/telemetry/). ([Issue #52177](https://github.com/istio/istio/issues/52177))\n\n### ⚙️ Improved Waypoint Configuration\n\nWaypoint resources, pod affinity, topologySpreadConstraints, tolerations, and nodeSelector are now configurable, offering greater flexibility in deployment configurations. These improvements make it easier to optimize resource allocation and ensure high availability. For detailed configuration options, visit the [waypoint configuration guide](https://istio.io/latest/docs/reference/config/telemetry/). ([Issue #52901](https://github.com/istio/istio/issues/52901))\n\n## 🛠️ Upgrading to Istio 1.24\n\nUpgrading to Istio 1.24 is straightforward, but it's important to review the changes and update your configurations accordingly. The Istio community is eager to hear your feedback, so don't hesitate to share your experiences in the [#release-1.24 channel on Slack](https://slack.istio.io/).\n\nWould you like to contribute directly to Istio? Find and join one of our [Working Groups](https://github.com/istio/community/blob/master/WORKING-GROUPS.md) and help us improve.\n\nAttending KubeCon North America 2024? Be sure to stop by the co-located [Istio Day](https://events.linuxfoundation.org/kubecon-cloudnativecon-north-america/co-located-events/istio-day/) to catch some [great talks](https://events.linuxfoundation.org/kubecon-cloudnativecon-north-america/), or swing by the [Istio project booth](https://events.linuxfoundation.org/kubecon-cloudnativecon-north-america/venue-travel/#venue-maps) to chat.\n\n## 🎉 Conclusion\n\nIstio 1.24 brings a host of new features and improvements that enhance stability, traffic management, and customization options. Whether you're attending KubeCon North America 2024 or just exploring the latest release, these changes are sure to make a positive impact on your Kubernetes environment.\n\nStay tuned for more updates and happy upgrading!\n\n**Resources:**\n\n- https://istio.io/latest/news/releases/1.24.x/announcing-1.24/\n- https://istio.io/latest/news/releases/1.24.x/announcing-1.24/change-notes/\n- https://istio.io/latest/news/releases/1.24.x/announcing-1.24/upgrade-notes/\n\n<br>\n<br>\n\n> 💡 Thank you for Reading !! 🙌🏻😁📃, see you in the next blog.🤘  **_Until next time 🎉_**\n\n\n🚀 Thank you for sticking up till the end. If you have any questions/feedback regarding this blog feel free to connect with me:\n\n**♻️ LinkedIn:** https://www.linkedin.com/in/rajhi-saif/\n\n**♻️ X/Twitter:** https://x.com/rajhisaifeddine\n\n**The end ✌🏻**\n\n<h1 align=\"center\">🔰 Keep Learning !! Keep Sharing !! 🔰</h1>\n\n**📅 Stay updated**\n\nSubscribe to our newsletter for more insights on AWS cloud computing and containers.\n","wordCount":{"words":930},"frontmatter":{"id":"03ddd5ddc7b2632ae49e2840","path":"/blog/istio-1-24-major-changes/","humanDate":"Nov 6, 2024","fullDate":"2024-11-06","title":"Upgrades!!! — Everything New with Istio 1.24","keywords":["Istio","Kubernetes","k8s","Service Mesh","Cloud Native"],"excerpt":"Discover the new features and enhancements in Istio 1.24, including ambient mode promotion, improved retries, and enhanced traffic management.","cover":{"childImageSharp":{"gatsbyImageData":{"layout":"fullWidth","placeholder":{"fallback":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAABYlAAAWJQFJUiTwAAACt0lEQVR42kWSWU/TURDF+6GMMUSRRcqmCEoUBVmkpSxdgCJFDIoVadmRVokICkpStpauULballoQXGIwLuFBY/RFEr/Cz3v/GHyYO3OXOffMnFGpjX5yTH70fTEaBzfR2aI0DSUw9MWp64ly6WaYis415V5ne0mNMPODV8r++r0N6nti1Iqz/KYAaoMfVZbeJwIfmvsR2pxJJanWHlXAZFxsWaakfUXZ13RH0Xa/pE7c64SXcZUAlbmS1JkG3z9AYSkaD8fK3Ryv9JBS7eHa3XVMwwkqrBs0CW8Rn2m6IkoVDb0xUnUe0usWSatdVLzEkaaS7FJrvNR2B3C6wgxPhyjr8HKnP4Fz9DX9I1uUCJbZojXSck0Bxcs8aZLVSa1bAVYA5ZLXGBLlrNI5FsEyFCTX6KGqfQmrI0LHSILzzSHSBIsCc5DMegniVcAyxFlRSwj75FsqRUWSqUou1skPjAa/4/DuYxjcRmNd4crtZczjqzQ/WUdt9HGqxsOoew+t6Ncp3SKZQoCzQojVrR9Edn7y/ssBWtFPhWGOKMFsT3JvMIn+fpT9/X2cs7s0ju3Q7f5IVU9cEefztz84F/ZIq55DrZlDI0T58PUAU39cAR6Yfv9flNbeTWyObQxdQoT+NaHiOh0T21hfbFMuxJDljnn2qLbFKCqforRsnNN6P7PLX3n36TfRN7+43B5GlSmaWtDkwzm5guPpEkOPAxSY3LTcDfJoJMRDR5iLzX4yxLvClmXyLGHSTUtcaAtQdstLVssKWnucQnOIdCHM0RzmGgMUtwaxTcTpGk/S9yyB0R4mx+AlW/RLfpyvnyfzpotU/XOutrqp75on/cYMJ7RjZAiwo8GWllHnVcoank4yOBXDObOLaSCmjMPhePjJNy5Qap4iu8FFrn6WMssk5xpdFDa7xP3h2PwF8RY+ZzWrk0kAAAAASUVORK5CYII="},"images":{"fallback":{"src":"/static/c4ac5299b2917eddaad2f8659b472a21/c82d5/istio-1-24.png","srcSet":"/static/c4ac5299b2917eddaad2f8659b472a21/9ae6a/istio-1-24.png 750w,\n/static/c4ac5299b2917eddaad2f8659b472a21/0f80b/istio-1-24.png 1080w,\n/static/c4ac5299b2917eddaad2f8659b472a21/43124/istio-1-24.png 1366w,\n/static/c4ac5299b2917eddaad2f8659b472a21/c82d5/istio-1-24.png 1920w","sizes":"100vw"},"sources":[{"srcSet":"/static/c4ac5299b2917eddaad2f8659b472a21/8d8ff/istio-1-24.webp 750w,\n/static/c4ac5299b2917eddaad2f8659b472a21/fc98a/istio-1-24.webp 1080w,\n/static/c4ac5299b2917eddaad2f8659b472a21/1ab6d/istio-1-24.webp 1366w,\n/static/c4ac5299b2917eddaad2f8659b472a21/e2aba/istio-1-24.webp 1920w","type":"image/webp","sizes":"100vw"}]},"width":1,"height":0.5604166666666667}}},"coverCredits":"Photo by Saifeddine Rajhi"}}},"pageContext":{"prevThought":{"frontmatter":{"path":"/blog/kubernetes-user-namespaces/","title":"Enhancing Kubernetes Security with User Namespaces","date":"2024-11-10 20:00:00"},"excerpt":"Enhancing Kubernetes Security with User Namespaces 🛡️ Introduction User namespaces in Kubernetes offer a robust mechanism for enhancing…","html":"<blockquote>\n<p><strong>Enhancing Kubernetes Security with User Namespaces</strong></p>\n</blockquote>\n<h2 id=\"️-introduction\" style=\"position:relative;\"><a href=\"#%EF%B8%8F-introduction\" aria-label=\"️ introduction permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>🛡️ Introduction</h2>\n<p>User namespaces in Kubernetes offer a robust mechanism for enhancing security and flexibility. This blog post explores the benefits of user namespaces, their implementation, and how they contribute to a more secure Kubernetes environment.</p>\n<p>User namespaces in Kubernetes provide several ways to improve workload security, although they can, under certain uncommon configurations, increase the attack surface of clusters. By remapping UIDs and reducing privileges, user namespaces enhance isolation for applicable workloads.</p>\n<h2 id=\"-background\" style=\"position:relative;\"><a href=\"#-background\" aria-label=\" background permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>📚 Background</h2>\n<p>User namespaces are not a new concept. The <a href=\"https://man7.org/linux/man-pages/man7/user_namespaces.7.html\" target=\"_blank\" rel=\"noopener noreferrer\">Linux kernel manual</a> mentions user namespaces starting with v3.8. Since then, user namespaces have been a core technology behind rootless containers. Given that current kernel versions are in the 5.x range, user namespaces have had ample opportunity to evolve. However, their complexity and potential security implications must be recognized: their use opens previously untested code paths. Despite being readily available in the kernel, several Linux distributions chose to disable user namespaces by default to allow the feature to mature. Kubernetes developers adopted a similar approach.</p>\n<h2 id=\"️-kubernetes-versions-and-user-namespaces\" style=\"position:relative;\"><a href=\"#%EF%B8%8F-kubernetes-versions-and-user-namespaces\" aria-label=\"️ kubernetes versions and user namespaces permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>🗂️ Kubernetes Versions and User Namespaces</h2>\n<ul>\n<li><strong>Kubernetes v1.25</strong>: Introduced alpha support for Linux user namespaces (userns). This feature is touted as an additional isolation layer that improves host security and prevents many known container escape scenarios.</li>\n<li><strong>Kubernetes v1.28</strong>: Lifted the restriction on user namespaces for stateless pods.</li>\n<li><strong>Kubernetes v1.30</strong>: Moved user namespaces to beta, enabling broader usage and introducing custom ranges for UIDs/GIDs mapping.</li>\n</ul>\n<h2 id=\"-motivation\" style=\"position:relative;\"><a href=\"#-motivation\" aria-label=\" motivation permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>🎯 Motivation</h2>\n<p>From <a href=\"https://man7.org/linux/man-pages/man7/user_namespaces.7.html\" target=\"_blank\" rel=\"noopener noreferrer\">user_namespaces(7)</a>:</p>\n<blockquote>\n<p>User namespaces isolate security-related identifiers and attributes, in particular, user IDs and group IDs, the root directory, keys, and capabilities. A process's user and group IDs can be different inside and outside a user namespace. In particular, a process can have a normal unprivileged user ID outside a user namespace while at the same time having a user ID of 0 inside the namespace; in other words, the process has full privileges for operations inside the user namespace, but is unprivileged for operations outside the namespace.</p>\n</blockquote>\n<p>The goal of supporting user namespaces in Kubernetes is to run processes in pods with different user and group IDs than in the host. Specifically, a privileged process in the pod runs as an unprivileged process in the host. If such a process breaks out of the container to the host, it will have limited impact as it will be running as an unprivileged user there.</p>\n<h2 id=\"-how-user-namespaces-improve-workload-security\" style=\"position:relative;\"><a href=\"#-how-user-namespaces-improve-workload-security\" aria-label=\" how user namespaces improve workload security permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>🔒 How User Namespaces Improve Workload Security</h2>\n<h3 id=\"mitigating-the-impact-of-container-escape\" style=\"position:relative;\"><a href=\"#mitigating-the-impact-of-container-escape\" aria-label=\"mitigating the impact of container escape permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Mitigating the Impact of Container Escape</h3>\n<p>The main motivation behind user namespaces in the container context is curbing the potential impact of container escape. When a container-bound process running as root escapes to the host, it is still considered a privileged process with its user ID (UID) equal to 0. However, user namespaces introduce a consistent mapping between host-level user IDs and container-level user IDs that ensures a UID 0 on the container corresponds to a non-zero UID on the host. To eliminate the possibility of UID overlap with the host, every pod receives 64K user IDs for private use.</p>\n<h3 id=\"user-namespace-mapping-between-host-and-container-user-ids\" style=\"position:relative;\"><a href=\"#user-namespace-mapping-between-host-and-container-user-ids\" aria-label=\"user namespace mapping between host and container user ids permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>User Namespace Mapping Between Host and Container User IDs</h3>\n<p>As a result, even if a process is root (i.e., UID 0) inside the container, escaping to the host will only entitle it to access resources associated with UID X.</p>\n<p>Moreover, an escaped process with a user namespace would be blocked from accessing resources such as:</p>\n<ul>\n<li>Changing the system time (CAP_SYS_TIME)</li>\n<li>Loading a kernel module (CAP_SYS_MODULE)</li>\n<li>Creating a device (CAP_MKNOD)</li>\n<li><code class=\"language-text\">/etc</code> config files</li>\n<li>Devices in <code class=\"language-text\">/dev</code></li>\n<li>The <code class=\"language-text\">/home/root</code> directory storing potential secrets</li>\n<li>Kubelet config, which is commonly used for lateral movement within the cluster and is only readable by the root process on the cluster host</li>\n<li>Unix sockets with root ownership</li>\n<li>TCP/UDP sockets with root ownership</li>\n</ul>\n<h2 id=\"-benefits\" style=\"position:relative;\"><a href=\"#-benefits\" aria-label=\" benefits permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>🌟 Benefits</h2>\n<ol>\n<li><strong>Enhanced Security</strong>: User namespaces isolate security-related identifiers and attributes, reducing the risk of privilege escalation attacks.</li>\n<li><strong>Flexibility</strong>: Allows running processes in pods with different user and group IDs than in the host, providing more control over permissions.</li>\n<li><strong>Mitigation of Vulnerabilities</strong>: Helps mitigate several known vulnerabilities, such as <a href=\"https://nvd.nist.gov/vuln/detail/CVE-2019-5736\" target=\"_blank\" rel=\"noopener noreferrer\">CVE-2019-5736</a> and <a href=\"https://github.com/kubernetes/kubernetes/issues/104980\" target=\"_blank\" rel=\"noopener noreferrer\">CVE-2021-25741</a>.</li>\n</ol>\n<p>A process running as root in a container can run as a different (non-root) user in the host; in other words, the process has full privileges for operations inside the user namespace, but is unprivileged for operations outside the namespace.</p>\n<p>You can use this feature to reduce the damage a compromised container can do to the host or other pods in the same node. There are several security vulnerabilities rated either HIGH or CRITICAL that were not exploitable when user namespaces are active. It is expected user namespaces will mitigate some future vulnerabilities too.</p>\n<p>Without using a user namespace, a container running as root, in the case of a container breakout, has root privileges on the node. And if some capability were granted to the container, the capabilities are valid on the host too. None of this is true when user namespaces are used.</p>\n<p>A user namespace is a Linux feature that isolates the user and group identifiers (UIDs and GIDs) of the containers from the ones on the host. The identifiers in the container can be mapped to identifiers on the host in a way where the host UID/GIDs used for different containers never overlap. Furthermore, the identifiers can be mapped to unprivileged non-overlapping UIDs and GIDs on the host. This brings two key benefits:</p>\n<ol>\n<li>\n<p><strong>Prevention of Lateral Movement</strong>: As the UIDs and GIDs for different containers are mapped to different UIDs and GIDs on the host, containers have a harder time attacking each other even if they escape the container boundaries. For example, if container A is running with different UIDs and GIDs on the host than container B, the operations it can do on container B's files and processes are limited: only read/write what a file allows to others, as it will never have permission owner or group permission (the UIDs/GIDs on the host are guaranteed to be different for different containers).</p>\n</li>\n<li>\n<p><strong>Increased Host Isolation</strong>: As the UIDs and GIDs are mapped to unprivileged users on the host, if a container escapes the container boundaries, even if it is running as root inside the container, it has no privileges on the host. This greatly protects what host files it can read/write, which processes it can send signals to, etc. Furthermore, capabilities granted are only valid inside the user namespace and not on the host, which also limits the impact a container escape can have.</p>\n</li>\n</ol>\n<p>Without using a user namespace, a container running as root in the case of a container breakout, has root privileges on the node. And if some capabilities were granted to the container, the capabilities are valid on the host too. None of this is true when using user namespaces.</p>\n<p>There are many known CVEs (and likely many more as-yet unidentified vulnerabilities) that are partially or completely mitigated by the use of user namespaces.</p>\n<h2 id=\"implementation\" style=\"position:relative;\"><a href=\"#implementation\" aria-label=\"implementation permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Implementation</h2>\n<h3 id=\"podspec-changes\" style=\"position:relative;\"><a href=\"#podspec-changes\" aria-label=\"podspec changes permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Pod.spec Changes</h3>\n<p>The following changes will be done to the pod.spec:</p>\n<ul>\n<li><code class=\"language-text\">pod.spec.hostUsers</code>: <code class=\"language-text\">*bool</code>.\n- If true or not present, uses the host user namespace (as today).\n- If false, a new user namespace is created for the pod.\n- By default, it is not set, which implies using the host user namespace.</li>\n</ul>\n<h3 id=\"support-for-pods\" style=\"position:relative;\"><a href=\"#support-for-pods\" aria-label=\"support for pods permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Support for Pods</h3>\n<p>Make pods work with user namespaces. This is activated via the bool <code class=\"language-text\">pod.spec.hostUsers</code>.\nThe mapping length will be 65536, mapping the range 0-65535 to the pod. This wide range makes sure most workloads will work fine. Additionally, we don't need to worry about fragmentation of IDs, as all pods will use the same length.</p>\n<p>The Kubernetes implementation was redesigned in 1.27, so the requirements are different for versions\npre and post Kubernetes 1.27.</p>\n<p>Please note that if you try to use user namespaces with containerd 1.6 or older, the <code class=\"language-text\">hostUsers:\nfalse</code> setting in your pod.spec will be <strong>silently ignored</strong>.</p>\n<h3 id=\"kubernetes-125-and-126\" style=\"position:relative;\"><a href=\"#kubernetes-125-and-126\" aria-label=\"kubernetes 125 and 126 permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Kubernetes 1.25 and 1.26</h3>\n<ul>\n<li>Containerd 1.7</li>\n<li>You can use runc or crun as the OCI runtime:\n<ul>\n<li>runc 1.1 or greater</li>\n<li>crun 1.4.3 or greater</li>\n</ul>\n</li>\n</ul>\n<p>You can also use containerd 2.0 or above, but the same <a href=\"#Kubernetes-127-and-greater\">requirements as Kubernetes 1.27 and\ngreater</a> apply, except for the Linux kernel. Bear in mind that all the\nrequirements there apply, including file-systems supporting idmap mounts. You can use Linux\nversions:</p>\n<ul>\n<li>Linux 5.15: you will suffer from <a href=\"#Limitations\">the containerd 1.7 storage and latency\nlimitations</a>, as it doesn't support idmap mounts for overlayfs.</li>\n<li>Linux 5.19 or greater (recommended): it doesn't suffer from any of the containerd 1.7\nlimitations, as overlayfs started supporting idmap mounts on this kernel version.</li>\n</ul>\n<h3 id=\"kubernetes-127-and-greater\" style=\"position:relative;\"><a href=\"#kubernetes-127-and-greater\" aria-label=\"kubernetes 127 and greater permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Kubernetes 1.27 and greater</h3>\n<ul>\n<li>Linux 6.3 or greater</li>\n<li>Containerd 2.0 or greater</li>\n<li>You can use runc or crun as the OCI runtime:\n<ul>\n<li>runc 1.2 or greater</li>\n<li>crun 1.9 or greater</li>\n</ul>\n</li>\n</ul>\n<p>Furthermore, all the file-systems used by the volumes in the pod need kernel-support for idmap\nmounts. Some popular file-systems that support idmap mounts in Linux 6.3 are: <code class=\"language-text\">btrfs</code>, <code class=\"language-text\">ext4</code>, <code class=\"language-text\">xfs</code>,\n<code class=\"language-text\">fat</code>, <code class=\"language-text\">tmpfs</code>, <code class=\"language-text\">overlayfs</code>.</p>\n<p>The kubelet is in charge of populating some files to the containers (like configmap, secrets, etc.).\nThe file-system used in that path needs to support idmap mounts too. See <a href=\"https://kubernetes.io/docs/concepts/workloads/pods/user-namespaces/#before-you-begin\" target=\"_blank\" rel=\"noopener noreferrer\">the Kubernetes\ndocumentation</a> for more info on that.</p>\n<h3 id=\"stripping-unnecessary-privileges\" style=\"position:relative;\"><a href=\"#stripping-unnecessary-privileges\" aria-label=\"stripping unnecessary privileges permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Stripping Unnecessary Privileges</h3>\n<p>Privileged containers running in their own user namespace are isolated and therefore their capabilities cannot harm the host. For example, Kubernetes lacks support for FUSE filesystem mounting. One workaround is adding a spec to mount a GCP bucket at a postStart event with the required CAP_SYS_ADMIN permissions for the initial namespace.</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span> \n    <span class=\"token key atrule\">containers</span><span class=\"token punctuation\">:</span> \n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> my<span class=\"token punctuation\">-</span>container \n        <span class=\"token key atrule\">securityContext</span><span class=\"token punctuation\">:</span> \n            <span class=\"token key atrule\">privileged</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span> \n            <span class=\"token key atrule\">capabilities</span><span class=\"token punctuation\">:</span> \n                <span class=\"token key atrule\">add</span><span class=\"token punctuation\">:</span> \n                    <span class=\"token punctuation\">-</span> SYS_ADMIN \n        <span class=\"token key atrule\">lifecycle</span><span class=\"token punctuation\">:</span> \n            <span class=\"token key atrule\">postStart</span><span class=\"token punctuation\">:</span> \n                <span class=\"token key atrule\">exec</span><span class=\"token punctuation\">:</span> \n                    <span class=\"token key atrule\">command</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"gcsfuse\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"-o\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"nonempty\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"your-bucket-name\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"/etc/letsencrypt\"</span><span class=\"token punctuation\">]</span></code></pre></div>\n<p>However, SYS_ADMIN is a powerful capability. In this case, implementing a user namespace would eliminate the need to specify <code class=\"language-text\">privileged: true</code> and grant SYS_ADMIN, drastically reducing the host’s attack surface.</p>\n<h2 id=\"demo\" style=\"position:relative;\"><a href=\"#demo\" aria-label=\"demo permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Demo</h2>\n<h3 id=\"run-a-pod-that-uses-a-user-namespace\" style=\"position:relative;\"><a href=\"#run-a-pod-that-uses-a-user-namespace\" aria-label=\"run a pod that uses a user namespace permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Run a Pod that uses a User Namespace</h3>\n<p>A user namespace for a pod is enabled by setting the <code class=\"language-text\">hostUsers</code> field of <code class=\"language-text\">.spec</code> to <code class=\"language-text\">false</code>. For example:</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> v1\n<span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> Pod\n<span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> userns\n<span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">hostUsers</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">false</span>\n    <span class=\"token key atrule\">containers</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> shell\n        <span class=\"token key atrule\">command</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"sleep\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"infinity\"</span><span class=\"token punctuation\">]</span>\n        <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> debian</code></pre></div>\n<p>Attach to the container and run <code class=\"language-text\">readlink /proc/self/ns/user</code>:</p>\n<div class=\"gatsby-highlight\" data-language=\"sh\"><pre class=\"language-sh\"><code class=\"language-sh\">kubectl attach <span class=\"token parameter variable\">-it</span> userns <span class=\"token function\">bash</span></code></pre></div>\n<p>Run this command:</p>\n<div class=\"gatsby-highlight\" data-language=\"sh\"><pre class=\"language-sh\"><code class=\"language-sh\">readlink /proc/self/ns/user</code></pre></div>\n<p>The output is similar to:</p>\n<div class=\"gatsby-highlight\" data-language=\"sh\"><pre class=\"language-sh\"><code class=\"language-sh\">user:<span class=\"token punctuation\">[</span><span class=\"token number\">4026531837</span><span class=\"token punctuation\">]</span></code></pre></div>\n<p>Also, run:</p>\n<div class=\"gatsby-highlight\" data-language=\"sh\"><pre class=\"language-sh\"><code class=\"language-sh\"><span class=\"token function\">cat</span> /proc/self/uid_map</code></pre></div>\n<p>The output is similar to:</p>\n<div class=\"gatsby-highlight\" data-language=\"sh\"><pre class=\"language-sh\"><code class=\"language-sh\"><span class=\"token number\">0</span>  <span class=\"token number\">833617920</span>      <span class=\"token number\">65536</span></code></pre></div>\n<p>Then, open a shell in the host and run the same commands.</p>\n<p>The <code class=\"language-text\">readlink</code> command shows the user namespace the process is running in. It should be different when it is run on the host and inside the container.</p>\n<p>The last number of the <code class=\"language-text\">uid_map</code> file inside the container must be 65536, on the host it must be a bigger number.</p>\n<p>If you are running the kubelet inside a user namespace, you need to compare the output from running the command in the pod to the output of running in the host:</p>\n<div class=\"gatsby-highlight\" data-language=\"sh\"><pre class=\"language-sh\"><code class=\"language-sh\">readlink /proc/<span class=\"token variable\">$pid</span>/ns/user</code></pre></div>\n<p>replacing <code class=\"language-text\">$pid</code> with the kubelet PID.</p>\n<h2 id=\"-conclusion\" style=\"position:relative;\"><a href=\"#-conclusion\" aria-label=\" conclusion permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>🏁 Conclusion</h2>\n<p>User namespaces in Kubernetes provide a robust mechanism for enhancing security and flexibility. By isolating security-related identifiers and attributes, they reduce the risk of privilege escalation attacks and provide more control over permissions. Implementing user namespaces involves changes to the pod specification and container runtime interface, but the benefits in terms of security and flexibility make it a worthwhile endeavor.</p>"},"nextThought":{"frontmatter":{"path":"/blog/testing-kubernetes-clusters-and-components/","title":"Kubernetes Testing: From clusters, operators to CRDs and more 🧪","date":"2024-11-05 17:00:00"},"excerpt":"A Deep dive into tools and practices for testing Kubernetes environments Introduction Kubernetes is the leading platform for container…","html":"<blockquote>\n<p><strong>A Deep dive into tools and practices for testing Kubernetes environments</strong></p>\n</blockquote>\n<h2 id=\"introduction\" style=\"position:relative;\"><a href=\"#introduction\" aria-label=\"introduction permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Introduction</h2>\n<p>Kubernetes is the leading platform for container orchestration, but deploying and managing a Kubernetes cluster requires thorough testing to ensure everything works correctly.</p>\n<p>This guide will cover essential tools and practices for testing Kubernetes clusters and components, ensuring your deployments are robust and reliable.</p>\n<p><span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 55.88235294117647%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAABYlAAAWJQFJUiTwAAACvklEQVR42k2SSUyTURDHv77WBAsu0ZigMTHBiyQuiSaG6EEvevFsjPHkxe3kRQ8mXtxXUIlGRZCy2UilX1m0LW0txaAotCAIFihbKZWWApp48fJz+pVED5OXeW/eb+Y/M5rypVHN4yj7V9SbYVTjN1TTd5RjSM4oyinmGhOLiT+CqVFi9LHcu2Hiu2dRvhSqfQ5N+QXoHEG9CKFefkRVdqJqujHd11FXajA/aEM9FHvQYpz5z92Y63tRFdn4rpy1TWMUZgDbf6D886iOJVRwERX6ifL+wJKt+FUfJscAqiGC1tCPVt+H2TuJObggscvxWVuubhk4ZwCUJ2mcJklgbZlhY2Mciy/Dpvo0ee3zrO9MU9KzxBb/LJprHLNnNvcv+8c39x/QOycX2Qwp41GTxxXuJFZ9hjWeBIc6EtyOpGjpzRCNLZLMZNjfEUdrncbiT2ERiNWV/AfcUh2h5JwHqy1MQd0Ae067WfuslwLvFMXXX1L5MczQQIyyxjHqvQnSEyPURpNGlZo3yZpWiasZRbXGRboA8/UJCisGWe0cxNo8SWH1iATHudAdo6j0NbtPnufVk3JsrjBlpY/RbZXYPoTR7MNYBGiu/ZwbZF2P0UtN8y+yPvCFg+5PHHCGyQuK7MASNz4MsO1pG9q1Bm7pAarfjlPREuKi00+1v4sjAUkswyx4F6fozSAr3TNG6wS4wC5HkGN1Hk64mljtFintGQ7rPey7dE/k+yh+5OB4uY19D+3suFGFp6ubs8EhkZxia9M3DtpCbNaj0n8DmGaDa5S9tUG2t37ONVYGlCdy7IMT/ElMEu2LEOn/yu/EFIHpefJPXZY9bcYc+sX2pl52irJivV82ZHkPTQLV3i9KyQsG0Jz19Rir7jo4WlqF3dfJO/97ztwpp+hmDavOXWVdVQea7KJJkmelm3zzRjF/AdHcSpm+W0UfAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"alt text\" title=\"\" src=\"/static/1ebcb3ef42519fb1af75f78aceba494e/c5bb3/image.png\" srcset=\"/static/1ebcb3ef42519fb1af75f78aceba494e/04472/image.png 170w,\n/static/1ebcb3ef42519fb1af75f78aceba494e/9f933/image.png 340w,\n/static/1ebcb3ef42519fb1af75f78aceba494e/c5bb3/image.png 680w,\n/static/1ebcb3ef42519fb1af75f78aceba494e/b12f7/image.png 1020w,\n/static/1ebcb3ef42519fb1af75f78aceba494e/b5a09/image.png 1360w,\n/static/1ebcb3ef42519fb1af75f78aceba494e/b4472/image.png 2468w\" sizes=\"(max-width: 680px) 100vw, 680px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n    </span>\n          </p>\n<h2 id=\"importance-of-testing-kubernetes-clusters\" style=\"position:relative;\"><a href=\"#importance-of-testing-kubernetes-clusters\" aria-label=\"importance of testing kubernetes clusters permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Importance of Testing Kubernetes Clusters</h2>\n<ul>\n<li>\n<p><strong>Application Functionality</strong>: Testing ensures your applications run correctly in a Kubernetes environment. It helps identify issues with performance, functionality, and interactions with other services and databases. By testing, you can confirm that your application meets expected standards and provides a good user experience.</p>\n</li>\n<li>\n<p><strong>Operational Reliability</strong>: Testing evaluates the cluster's ability to handle your application under different conditions. It helps find issues like resource allocation problems, network connectivity issues, and configuration errors. Addressing these issues through testing ensures your cluster is reliable and can manage your application effectively.</p>\n</li>\n<li>\n<p><strong>Performance Optimization</strong>: Testing helps assess how well your application performs under various workloads and configurations. It identifies performance bottlenecks, allowing you to optimize your application to handle load efficiently.</p>\n</li>\n</ul>\n<h3 id=\"types-of-tests-for-kubernetes\" style=\"position:relative;\"><a href=\"#types-of-tests-for-kubernetes\" aria-label=\"types of tests for kubernetes permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Types of Tests for Kubernetes</h3>\n<ul>\n<li>\n<p><strong>Unit Tests</strong>: These tests focus on individual components or functions of a microservice. They are usually performed during the development phase and do not involve Kubernetes. Unit tests ensure that each part of your application works as expected in isolation.</p>\n</li>\n<li>\n<p><strong>Integration Tests</strong>: Integration tests check if different components of an application work together as expected. They involve testing communication between microservices, databases, and interactions with external APIs. These tests help ensure that the integrated parts of your application function correctly.</p>\n</li>\n<li>\n<p><strong>End-to-End (E2E) Tests</strong>: E2E tests simulate user workflows and verify that the entire application functions as expected from the user's perspective. These tests often require a Kubernetes environment to run the application components. E2E tests are crucial for validating the complete functionality of your application in a real-world scenario.</p>\n</li>\n<li>\n<p><strong>Performance or Load Tests</strong>: Performance tests assess the application's ability to handle load and maintain responsiveness under various conditions. These tests may involve stress testing, load testing, and benchmarking on a Kubernetes cluster. Performance tests help identify bottlenecks and ensure that your application can scale effectively.</p>\n</li>\n<li>\n<p><strong>Resilience Tests or Chaos Tests</strong>: These tests evaluate an application's ability to recover from failures and continue functioning. They can involve chaos testing, failover testing, and disaster recovery testing on a Kubernetes cluster. Resilience tests help ensure that your application can withstand unexpected disruptions and maintain availability.</p>\n</li>\n</ul>\n<h2 id=\"tools-for-testing-kubernetes\" style=\"position:relative;\"><a href=\"#tools-for-testing-kubernetes\" aria-label=\"tools for testing kubernetes permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Tools for Testing Kubernetes</h2>\n<h3 id=\"kuttl-kubernetes-test-tool\" style=\"position:relative;\"><a href=\"#kuttl-kubernetes-test-tool\" aria-label=\"kuttl kubernetes test tool permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>KUTTL (Kubernetes Test Tool)</h3>\n<p><a href=\"https://kuttl.dev/\" target=\"_blank\" rel=\"noopener noreferrer\">KUTTL</a> is a declarative integration testing harness for testing operators, KUDO, Helm charts, and other Kubernetes applications or controllers. Test cases are written as plain Kubernetes resources and can be run against a mocked control plane, locally in kind, or any other Kubernetes cluster.</p>\n<p><strong>Demo</strong>:</p>\n<ol>\n<li>\n<p><strong>Install KUTTL</strong>:</p>\n<p>Install the kubectl kuttl plugin. To do so, please run the below commands:</p>\n<div class=\"gatsby-highlight\" data-language=\"sh\"><pre class=\"language-sh\"><code class=\"language-sh\">brew tap kudobuilder/tap\nbrew <span class=\"token function\">install</span> kuttl-cli</code></pre></div>\n<p>Another alternative is <a href=\"https://krew.sigs.k8s.io/\" target=\"_blank\" rel=\"noopener noreferrer\">krew</a>, the package manager for kubectl plugins.</p>\n<div class=\"gatsby-highlight\" data-language=\"sh\"><pre class=\"language-sh\"><code class=\"language-sh\">kubectl krew <span class=\"token function\">install</span> kuttl</code></pre></div>\n</li>\n<li>\n<p><strong>Create a Test Case</strong>:</p>\n</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> kuttl.dev/v1beta1\n<span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> TestStep\n<span class=\"token key atrule\">apply</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> my<span class=\"token punctuation\">-</span>resource.yaml\n<span class=\"token key atrule\">assert</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">command</span><span class=\"token punctuation\">:</span> kubectl get myresource my<span class=\"token punctuation\">-</span>instance <span class=\"token punctuation\">-</span>o yaml\n<span class=\"token key atrule\">commands</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">command</span><span class=\"token punctuation\">:</span> helm init\n<span class=\"token key atrule\">unitTest</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">false</span></code></pre></div>\n<ol start=\"3\">\n<li><strong>Run the Test</strong>:</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"sh\"><pre class=\"language-sh\"><code class=\"language-sh\">kubectl kuttl <span class=\"token builtin class-name\">test</span></code></pre></div>\n<h3 id=\"chainsaw\" style=\"position:relative;\"><a href=\"#chainsaw\" aria-label=\"chainsaw permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Chainsaw</h3>\n<p><a href=\"https://kyverno.github.io/chainsaw/0.2.3/\" target=\"_blank\" rel=\"noopener noreferrer\">Chainsaw</a> is a tool primarily developed to run end-to-end tests in Kubernetes clusters. It tests Kubernetes operators by running a sequence of steps and asserting various conditions.</p>\n<p><strong>Demo</strong>:</p>\n<ol>\n<li><strong>Install Chainsaw</strong>:</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"sh\"><pre class=\"language-sh\"><code class=\"language-sh\">go <span class=\"token function\">install</span> github.com/operator-framework/operator-sdk/cmd/operator-sdk@latest</code></pre></div>\n<ol start=\"2\">\n<li><strong>Create a Test Scenario</strong>:</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> chainsaw.kyverno.io/v1alpha1\n<span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> Test\n<span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> example\n<span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">steps</span><span class=\"token punctuation\">:</span>\n        <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">try</span><span class=\"token punctuation\">:</span>\n                <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">apply</span><span class=\"token punctuation\">:</span>\n                        <span class=\"token key atrule\">resource</span><span class=\"token punctuation\">:</span>\n                            <span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> v1\n                            <span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> ConfigMap\n                            <span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n                                <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> quick<span class=\"token punctuation\">-</span>start\n                            <span class=\"token key atrule\">data</span><span class=\"token punctuation\">:</span>\n                                <span class=\"token key atrule\">foo</span><span class=\"token punctuation\">:</span> bar\n                <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">assert</span><span class=\"token punctuation\">:</span>\n                        <span class=\"token key atrule\">resource</span><span class=\"token punctuation\">:</span>\n                            <span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> v1\n                            <span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> ConfigMap\n                            <span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n                                <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> quick<span class=\"token punctuation\">-</span>start\n                            <span class=\"token key atrule\">data</span><span class=\"token punctuation\">:</span>\n                                <span class=\"token key atrule\">foo</span><span class=\"token punctuation\">:</span> bar</code></pre></div>\n<ol start=\"3\">\n<li><strong>Run the Test</strong>:</li>\n</ol>\n<p>You can run the chainsaw test command:</p>\n<div class=\"gatsby-highlight\" data-language=\"sh\"><pre class=\"language-sh\"><code class=\"language-sh\">chainsaw <span class=\"token builtin class-name\">test</span></code></pre></div>\n<h3 id=\"testkube\" style=\"position:relative;\"><a href=\"#testkube\" aria-label=\"testkube permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Testkube</h3>\n<p><a href=\"https://testkube.io/\" target=\"_blank\" rel=\"noopener noreferrer\">Testkube</a> is a Kubernetes-native testing framework that allows you to orchestrate and scale tests within Kubernetes. It supports various testing frameworks like Postman, Cypress, and k6.</p>\n<p><strong>Demo</strong>:</p>\n<ol>\n<li><strong>Install Testkube</strong>:</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"sh\"><pre class=\"language-sh\"><code class=\"language-sh\">brew <span class=\"token function\">install</span> testkube\ntestkube init demo</code></pre></div>\n<ol start=\"2\">\n<li><strong>Create a Test</strong>:</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"sh\"><pre class=\"language-sh\"><code class=\"language-sh\">testkube create <span class=\"token builtin class-name\">test</span> <span class=\"token parameter variable\">--name</span> my-test <span class=\"token parameter variable\">--type</span> postman/collection <span class=\"token parameter variable\">--source</span> https://example.com/my-collection.json</code></pre></div>\n<ol start=\"3\">\n<li><strong>Run the Test</strong>:</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"sh\"><pre class=\"language-sh\"><code class=\"language-sh\">kubectl testkube run <span class=\"token builtin class-name\">test</span> my-test</code></pre></div>\n<h3 id=\"kubernetes-e2e-framework\" style=\"position:relative;\"><a href=\"#kubernetes-e2e-framework\" aria-label=\"kubernetes e2e framework permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Kubernetes E2E Framework</h3>\n<p>This framework provides a set of tools and libraries to write end-to-end tests for Kubernetes. It is designed to test the functionality of Kubernetes clusters and components.</p>\n<p><strong>Demo</strong>:</p>\n<ol>\n<li><strong>Clone the Repository</strong>:</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"sh\"><pre class=\"language-sh\"><code class=\"language-sh\"><span class=\"token function\">git</span> clone https://github.com/kubernetes-sigs/e2e-framework</code></pre></div>\n<ol start=\"2\">\n<li><strong>Write a Test</strong>:</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"go\"><pre class=\"language-go\"><code class=\"language-go\"><span class=\"token keyword\">package</span> main\n\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">(</span>\n        <span class=\"token string\">\"testing\"</span>\n        <span class=\"token string\">\"sigs.k8s.io/e2e-framework/pkg/env\"</span>\n<span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">func</span> <span class=\"token function\">TestMain</span><span class=\"token punctuation\">(</span>m <span class=\"token operator\">*</span>testing<span class=\"token punctuation\">.</span>M<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        env<span class=\"token punctuation\">.</span><span class=\"token function\">TestMain</span><span class=\"token punctuation\">(</span>m<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<ol start=\"3\">\n<li><strong>Run the Test</strong>:</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"sh\"><pre class=\"language-sh\"><code class=\"language-sh\">go <span class=\"token builtin class-name\">test</span> <span class=\"token parameter variable\">-v</span></code></pre></div>\n<h3 id=\"goss\" style=\"position:relative;\"><a href=\"#goss\" aria-label=\"goss permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Goss</h3>\n<p><a href=\"https://goss.rocks/\" target=\"_blank\" rel=\"noopener noreferrer\">Goss</a> is a YAML-based serverspec alternative tool for validating a server's configuration. It can be used to test Kubernetes nodes and configurations.</p>\n<p><strong>Demo</strong>:</p>\n<ol>\n<li><strong>Install Goss</strong>:</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"sh\"><pre class=\"language-sh\"><code class=\"language-sh\"><span class=\"token function\">curl</span> <span class=\"token parameter variable\">-fsSL</span> https://goss.rocks/install <span class=\"token operator\">|</span> <span class=\"token function\">sh</span></code></pre></div>\n<ol start=\"2\">\n<li><strong>Create a Goss File</strong>:</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">file</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">/etc/passwd</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">exists</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span></code></pre></div>\n<ol start=\"3\">\n<li><strong>Run Goss</strong>:</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"sh\"><pre class=\"language-sh\"><code class=\"language-sh\">goss validate\n<span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span>.\nTotal Duration: <span class=\"token number\">0</span>.021s\nCount: <span class=\"token number\">15</span>, Failed: <span class=\"token number\">0</span></code></pre></div>\n<h3 id=\"garden\" style=\"position:relative;\"><a href=\"#garden\" aria-label=\"garden permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Garden</h3>\n<p><a href=\"https://garden.io/\" target=\"_blank\" rel=\"noopener noreferrer\">Garden</a> is a development and testing tool that allows you to define, build, and test your Kubernetes environments.</p>\n<p><strong>Demo</strong>:</p>\n<ol>\n<li><strong>Install Garden</strong>:</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"sh\"><pre class=\"language-sh\"><code class=\"language-sh\"><span class=\"token function\">curl</span> <span class=\"token parameter variable\">-sL</span> https://get.garden.io/install.sh <span class=\"token operator\">|</span> <span class=\"token function\">bash</span></code></pre></div>\n<ol start=\"2\">\n<li><strong>Create a Garden Project</strong>:</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> Project\n<span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> my<span class=\"token punctuation\">-</span>project\n<span class=\"token key atrule\">environments</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> dev</code></pre></div>\n<ol start=\"3\">\n<li><strong>Run Garden</strong>:</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"sh\"><pre class=\"language-sh\"><code class=\"language-sh\">garden deploy</code></pre></div>\n<h3 id=\"conftest\" style=\"position:relative;\"><a href=\"#conftest\" aria-label=\"conftest permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Conftest</h3>\n<p><a href=\"https://www.conftest.dev/\" target=\"_blank\" rel=\"noopener noreferrer\">Conftest</a> is a tool for writing tests against structured configuration data using the Open Policy Agent (OPA) Rego language.</p>\n<p><strong>Demo</strong>:</p>\n<ol>\n<li><strong>Install Conftest</strong>:</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"sh\"><pre class=\"language-sh\"><code class=\"language-sh\">brew <span class=\"token function\">install</span> conftest</code></pre></div>\n<ol start=\"2\">\n<li><strong>Write a Policy</strong>:</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"rego\"><pre class=\"language-rego\"><code class=\"language-rego\"><span class=\"token keyword\">package</span> main\n\ndeny<span class=\"token punctuation\">[</span>msg<span class=\"token punctuation\">]</span> <span class=\"token punctuation\">{</span>\n        input<span class=\"token punctuation\">.</span>kind <span class=\"token operator\">==</span> <span class=\"token string\">\"Deployment\"</span>\n        <span class=\"token keyword\">not</span> input<span class=\"token punctuation\">.</span>spec<span class=\"token punctuation\">.</span>template<span class=\"token punctuation\">.</span>spec<span class=\"token punctuation\">.</span>containers<span class=\"token punctuation\">[</span><span class=\"token operator\">_</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>resources\n        msg <span class=\"token operator\">=</span> <span class=\"token string\">\"Containers must have resource limits\"</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<ol start=\"3\">\n<li><strong>Run Conftest</strong>:</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"sh\"><pre class=\"language-sh\"><code class=\"language-sh\">conftest <span class=\"token builtin class-name\">test</span> my-deployment.yaml</code></pre></div>\n<h2 id=\"best-practices-for-kubernetes-testing\" style=\"position:relative;\"><a href=\"#best-practices-for-kubernetes-testing\" aria-label=\"best practices for kubernetes testing permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Best Practices for Kubernetes Testing</h2>\n<ul>\n<li>\n<p><strong>Automating Tests in CI/CD Pipelines</strong>: Integrate your tests into CI/CD pipelines to ensure that every change is automatically tested before it reaches production. This helps catch issues early and ensures that your codebase remains stable. Tools like Jenkins, GitLab CI, and GitHub Actions can be used to automate these tests.</p>\n</li>\n<li>\n<p><strong>Regularly Updating and Maintaining Test Cases</strong>: Keep your test cases up to date with the latest changes in your application and infrastructure. Regular maintenance ensures that your tests remain relevant and effective in catching new issues. Review and update your test cases periodically to adapt to any changes in your environment.</p>\n</li>\n<li>\n<p><strong>Monitoring and Analyzing Test Results</strong>: Use monitoring tools to keep track of your test results and analyze them for patterns or recurring issues. Tools like Prometheus, Grafana, and ELK Stack can help you visualize and analyze test data. Regular analysis helps in understanding the health of your applications and clusters, and in making informed decisions for improvements.</p>\n</li>\n</ul>\n<h2 id=\"conclusion\" style=\"position:relative;\"><a href=\"#conclusion\" aria-label=\"conclusion permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Conclusion</h2>\n<p>Testing is an important component in the lifecycle of Kubernetes deployments. It ensures that your clusters and applications are not only functional but also resilient and performant. By integrating comprehensive testing strategies, you can detect and resolve issues early, maintain operational reliability, and optimize performance.</p>\n<p>Implementing robust testing practices using tools like KUTTL, Chainsaw, Testkube, and others discussed in this guide will help you achieve a stable and reliable Kubernetes environment. Regularly updating your test cases, automating tests in CI/CD pipelines, and monitoring test results are essential practices to keep your Kubernetes deployments healthy and efficient.</p>\n<p>By adopting these best practices and leveraging the right tools, you can ensure that your Kubernetes clusters and applications are well-tested and ready to handle production workloads.</p>\n<p><strong>Additional resources</strong></p>\n<ul>\n<li><a href=\"https://kuttl.dev/docs/\" target=\"_blank\" rel=\"noopener noreferrer\">KUTTL Documentation</a></li>\n<li><a href=\"https://github.com/kyverno/chainsaw\" target=\"_blank\" rel=\"noopener noreferrer\">Chainsaw GitHub Repository</a></li>\n<li><a href=\"https://docs.testkube.io/\" target=\"_blank\" rel=\"noopener noreferrer\">Testkube Documentation</a></li>\n<li><a href=\"https://github.com/kubernetes-sigs/e2e-framework\" target=\"_blank\" rel=\"noopener noreferrer\">Kubernetes E2E Framework</a></li>\n<li><a href=\"https://goss.rocks/docs/\" target=\"_blank\" rel=\"noopener noreferrer\">Goss Documentation</a></li>\n<li><a href=\"https://docs.garden.io/\" target=\"_blank\" rel=\"noopener noreferrer\">Garden Documentation</a></li>\n<li><a href=\"https://www.conftest.dev/docs/\" target=\"_blank\" rel=\"noopener noreferrer\">Conftest Documentation</a></li>\n</ul>"}}},"staticQueryHashes":["1271460761","1321585977"],"slicesMap":{}}