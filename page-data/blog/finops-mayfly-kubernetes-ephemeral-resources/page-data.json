{"componentChunkName":"component---src-templates-blog-template-js","path":"/blog/finops-mayfly-kubernetes-ephemeral-resources/","result":{"data":{"markdownRemark":{"html":"<blockquote>\n<p><strong>Optimizing Resources Spend with the Mayfly Kubernetes Operator</strong></p>\n</blockquote>\n<h2 id=\"-introduction\" style=\"position:relative;\"><a href=\"#-introduction\" aria-label=\" introduction permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üìñ Introduction</h2>\n<p>In the world of cloud computing, managing costs can be a challenge. One way to optimize your cloud spend is to use ephemeral resources that automatically expire after a certain period of time. Kubernetes is a popular container orchestration platform that can help manage these resources.</p>\n<p>In this blog post, we will explore the <a href=\"https://github.com/NCCloud/mayfly\" target=\"_blank\" rel=\"noopener noreferrer\">Mayfly Kubernetes operator</a>, which enables you to create temporary resources on the cluster that will expire after a certain period of time. We will discuss how to use Mayfly to implement FinOps best practices and optimize your cloud spend.</p>\n<p><span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 56.470588235294116%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAALABQDASIAAhEBAxEB/8QAFwAAAwEAAAAAAAAAAAAAAAAAAAQFAv/EABUBAQEAAAAAAAAAAAAAAAAAAAAB/9oADAMBAAIQAxAAAAEbc2RSwR//xAAbEAACAgMBAAAAAAAAAAAAAAABAwACBBETFP/aAAgBAQABBQI5DNtZcD0XnBUK6GcVz//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8BP//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8BP//EABsQAAICAwEAAAAAAAAAAAAAAAABAjIRITES/9oACAEBAAY/AsemyLUntcLMojceFEf/xAAcEAEAAgEFAAAAAAAAAAAAAAABABARIUFRgcH/2gAIAQEAAT8hAxgbzQNFfU5B6o1BBRgrP//aAAwDAQACAAMAAAAQoz//xAAWEQADAAAAAAAAAAAAAAAAAAABEGH/2gAIAQMBAT8QFX//xAAXEQADAQAAAAAAAAAAAAAAAAAAARFB/9oACAECAQE/EHMRD//EABwQAAICAgMAAAAAAAAAAAAAAAERACFBUTGR8f/aAAgBAQABPxALcG1AeGsQuIUQAgiS/VRfOaDQmbsTrUDpgTQGJ58//9k='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"mayfly\" title=\"\" src=\"/static/39bcfe1514a7edad2ce14f2345af81c6/7bf67/mayfly.jpg\" srcset=\"/static/39bcfe1514a7edad2ce14f2345af81c6/651be/mayfly.jpg 170w,\n/static/39bcfe1514a7edad2ce14f2345af81c6/d30a3/mayfly.jpg 340w,\n/static/39bcfe1514a7edad2ce14f2345af81c6/7bf67/mayfly.jpg 680w,\n/static/39bcfe1514a7edad2ce14f2345af81c6/990cb/mayfly.jpg 1020w,\n/static/39bcfe1514a7edad2ce14f2345af81c6/eea4a/mayfly.jpg 1280w\" sizes=\"(max-width: 680px) 100vw, 680px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n    </span>\n          </p>\n<h2 id=\"-introduction-to-mayfly\" style=\"position:relative;\"><a href=\"#-introduction-to-mayfly\" aria-label=\" introduction to mayfly permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üìÑ Introduction to Mayfly</h2>\n<p>The <strong>Mayfly Operator</strong> is a tool that allows you to manage resources on your cluster for a temporary time. It works by deleting the resources from the cluster based on a Mayfly expiration annotation that you set to specify how long the resource should remain active. This can be useful for creating temporary resources, managing temporary accesses, or simply keeping your cluster organized and tidy. The Mayfly Operator helps in resource management by automatically cleaning up resources after a specified period, reducing clutter and improving efficiency.</p>\n<p>The Mayfly Operator is a valuable tool for managing resources in a Kubernetes cluster. By setting a Mayfly expiration annotation, you can ensure that resources are automatically deleted after a specified period, helping to keep your cluster organized and efficient. This can be useful for managing temporary resources, such as test environments or short-lived jobs, and can also help to ensure that resources are not left running unnecessarily, reducing costs and improving security.</p>\n<h2 id=\"-configuration\" style=\"position:relative;\"><a href=\"#-configuration\" aria-label=\" configuration permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üõ† Configuration</h2>\n<p>Mayfly is an easy-to-use and configurable project that uses resource watches and schedulers to delete your resources at the appropriate time. It is simple to set up and customize. To specify which resources should be monitored and cleaned up, you can set the <code class=\"language-text\">RESOURCES</code> environment variable to a comma-separated list of <code class=\"language-text\">{ApiVersion};{Kind}</code> as text. This allows you to customize which resources are targeted for cleanup.</p>\n<p><strong>Example:</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"sh\"><pre class=\"language-sh\"><code class=\"language-sh\"><span class=\"token builtin class-name\">export</span> <span class=\"token assign-left variable\">RESOURCES</span><span class=\"token operator\">=</span><span class=\"token string\">\"v1;Secret,test.com/v1alpha;MyCRD\"</span></code></pre></div>\n<h2 id=\"-usage\" style=\"position:relative;\"><a href=\"#-usage\" aria-label=\" usage permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üöÄ Usage</h2>\n<p>Once you have determined which resources you want Mayfly to monitor, you can set the <code class=\"language-text\">mayfly.cloud.namecheap.com/expire</code> annotation on those resources with a duration value. This will cause Mayfly to delete the resources once the specified duration has passed, based on the time of their creation. Keep in mind that the expiration will be calculated based on the creation time of the resource.</p>\n<p><strong>Example:</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> v1\n<span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> Pod\n<span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> my<span class=\"token punctuation\">-</span>pod\n    <span class=\"token key atrule\">annotations</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">mayfly.cloud.namecheap.com/expire</span><span class=\"token punctuation\">:</span> 30s\n<span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">containers</span><span class=\"token punctuation\">:</span>\n        <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> alpine\n            <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> alpine\n            <span class=\"token key atrule\">command</span><span class=\"token punctuation\">:</span>\n                <span class=\"token punctuation\">-</span> sleep\n                <span class=\"token punctuation\">-</span> infinity</code></pre></div>\n<h2 id=\"Ô∏è-deployment\" style=\"position:relative;\"><a href=\"#%EF%B8%8F-deployment\" aria-label=\"Ô∏è deployment permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üõ≥Ô∏è Deployment</h2>\n<p>The easiest and most recommended way to deploy the Mayfly operator to your Kubernetes cluster is by using the Helm chart. To do this, you will need to add our Helm repository and install it from there, providing the <code class=\"language-text\">RESOURCES</code> environment variable as needed. If you prefer, you can also compile the operator and install it using any method you choose.</p>\n<p><strong>Example:</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"sh\"><pre class=\"language-sh\"><code class=\"language-sh\">helm repo <span class=\"token function\">add</span> nccloud https://nccloud.github.io/charts\nhelm <span class=\"token function\">install</span> mayfly nccloud/mayfly <span class=\"token parameter variable\">--set</span> <span class=\"token assign-left variable\">RESOURCES</span><span class=\"token operator\">=</span><span class=\"token string\">\"v1;Secret\"</span> <span class=\"token comment\"># For only secrets</span></code></pre></div>\n<h2 id=\"-summary\" style=\"position:relative;\"><a href=\"#-summary\" aria-label=\" summary permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üìå Summary</h2>\n<p>In conclusion, the <strong>Mayfly Kubernetes Operator</strong> is a valuable tool for managing ephemeral resources in a Kubernetes cluster. It allows you to create temporary resources, accesses, or maintain a clean and organized cluster by automatically deleting resources after a specified period. Key points about the Mayfly Operator include:</p>\n<ul>\n<li>Mayfly enables you to create temporary resources on the cluster that will expire after a certain period of time.</li>\n<li>It helps in resource management by automatically cleaning up resources after a specified period, reducing clutter and improving efficiency.</li>\n<li>The Mayfly Operator is easy to set up and customize, with the ability to specify which resources should be monitored and cleaned up using the <code class=\"language-text\">RESOURCES</code> environment variable.</li>\n<li>To deploy the Mayfly Operator, you can use the Helm chart, which is the easiest and most recommended method.</li>\n</ul>\n<p>By using the Mayfly Kubernetes Operator, you can ensure that your Kubernetes cluster remains organized, efficient, and secure by automatically managing temporary resources and cleaning up after they are no longer needed.</p>\n<p><strong>Thank You üñ§</strong></p>\n<br>\n<p><strong><em>Until next time, „Å§„Å•„Åè üéâ</em></strong></p>\n<blockquote>\n<p>üí° Thank you for Reading !! üôåüèªüòÅüìÉ, see you in the next blog.ü§ò  <strong><em>Until next time üéâ</em></strong></p>\n</blockquote>\n<p>üöÄ Thank you for sticking up till the end. If you have any questions/feedback regarding this blog feel free to connect with me:</p>\n<p><strong>‚ôªÔ∏è LinkedIn:</strong> <a href=\"https://www.linkedin.com/in/rajhi-saif/\" target=\"_blank\" rel=\"noopener noreferrer\">https://www.linkedin.com/in/rajhi-saif/</a></p>\n<p><strong>‚ôªÔ∏è X/Twitter:</strong> <a href=\"https://x.com/rajhisaifeddine\" target=\"_blank\" rel=\"noopener noreferrer\">https://x.com/rajhisaifeddine</a></p>\n<p><strong>The end ‚úåüèª</strong></p>\n<h1 align=\"center\">üî∞ Keep Learning !! Keep Sharing !! üî∞</h1>\n<p><strong>üìÖ Stay updated</strong></p>\n<p>Subscribe to our newsletter for more insights on AWS cloud computing and containers.</p>","timeToRead":3,"rawMarkdownBody":"\n> **Optimizing Resources Spend with the Mayfly Kubernetes Operator**\n\n## üìñ Introduction\n\nIn the world of cloud computing, managing costs can be a challenge. One way to optimize your cloud spend is to use ephemeral resources that automatically expire after a certain period of time. Kubernetes is a popular container orchestration platform that can help manage these resources.\n\nIn this blog post, we will explore the [Mayfly Kubernetes operator](https://github.com/NCCloud/mayfly), which enables you to create temporary resources on the cluster that will expire after a certain period of time. We will discuss how to use Mayfly to implement FinOps best practices and optimize your cloud spend.\n\n![mayfly](./mayfly.jpg)\n\n## üìÑ Introduction to Mayfly\n\nThe **Mayfly Operator** is a tool that allows you to manage resources on your cluster for a temporary time. It works by deleting the resources from the cluster based on a Mayfly expiration annotation that you set to specify how long the resource should remain active. This can be useful for creating temporary resources, managing temporary accesses, or simply keeping your cluster organized and tidy. The Mayfly Operator helps in resource management by automatically cleaning up resources after a specified period, reducing clutter and improving efficiency.\n\nThe Mayfly Operator is a valuable tool for managing resources in a Kubernetes cluster. By setting a Mayfly expiration annotation, you can ensure that resources are automatically deleted after a specified period, helping to keep your cluster organized and efficient. This can be useful for managing temporary resources, such as test environments or short-lived jobs, and can also help to ensure that resources are not left running unnecessarily, reducing costs and improving security.\n\n## üõ† Configuration\n\nMayfly is an easy-to-use and configurable project that uses resource watches and schedulers to delete your resources at the appropriate time. It is simple to set up and customize. To specify which resources should be monitored and cleaned up, you can set the `RESOURCES` environment variable to a comma-separated list of `{ApiVersion};{Kind}` as text. This allows you to customize which resources are targeted for cleanup.\n\n**Example:**\n\n```sh\nexport RESOURCES=\"v1;Secret,test.com/v1alpha;MyCRD\"\n```\n\n## üöÄ Usage\n\nOnce you have determined which resources you want Mayfly to monitor, you can set the `mayfly.cloud.namecheap.com/expire` annotation on those resources with a duration value. This will cause Mayfly to delete the resources once the specified duration has passed, based on the time of their creation. Keep in mind that the expiration will be calculated based on the creation time of the resource.\n\n**Example:**\n\n```yaml\napiVersion: v1\nkind: Pod\nmetadata:\n    name: my-pod\n    annotations:\n        mayfly.cloud.namecheap.com/expire: 30s\nspec:\n    containers:\n        - name: alpine\n            image: alpine\n            command:\n                - sleep\n                - infinity\n```\n\n## üõ≥Ô∏è Deployment\n\nThe easiest and most recommended way to deploy the Mayfly operator to your Kubernetes cluster is by using the Helm chart. To do this, you will need to add our Helm repository and install it from there, providing the `RESOURCES` environment variable as needed. If you prefer, you can also compile the operator and install it using any method you choose.\n\n**Example:**\n\n```sh\nhelm repo add nccloud https://nccloud.github.io/charts\nhelm install mayfly nccloud/mayfly --set RESOURCES=\"v1;Secret\" # For only secrets\n```\n\n## üìå Summary\n\nIn conclusion, the **Mayfly Kubernetes Operator** is a valuable tool for managing ephemeral resources in a Kubernetes cluster. It allows you to create temporary resources, accesses, or maintain a clean and organized cluster by automatically deleting resources after a specified period. Key points about the Mayfly Operator include:\n\n- Mayfly enables you to create temporary resources on the cluster that will expire after a certain period of time.\n- It helps in resource management by automatically cleaning up resources after a specified period, reducing clutter and improving efficiency.\n- The Mayfly Operator is easy to set up and customize, with the ability to specify which resources should be monitored and cleaned up using the `RESOURCES` environment variable.\n- To deploy the Mayfly Operator, you can use the Helm chart, which is the easiest and most recommended method.\n\nBy using the Mayfly Kubernetes Operator, you can ensure that your Kubernetes cluster remains organized, efficient, and secure by automatically managing temporary resources and cleaning up after they are no longer needed.\n\n**Thank You üñ§**\n\n<br>\n\n**_Until next time, „Å§„Å•„Åè üéâ_**\n\n> üí° Thank you for Reading !! üôåüèªüòÅüìÉ, see you in the next blog.ü§ò  **_Until next time üéâ_**\n\nüöÄ Thank you for sticking up till the end. If you have any questions/feedback regarding this blog feel free to connect with me:\n\n**‚ôªÔ∏è LinkedIn:** https://www.linkedin.com/in/rajhi-saif/\n\n**‚ôªÔ∏è X/Twitter:** https://x.com/rajhisaifeddine\n\n**The end ‚úåüèª**\n\n<h1 align=\"center\">üî∞ Keep Learning !! Keep Sharing !! üî∞</h1>\n\n**üìÖ Stay updated**\n\nSubscribe to our newsletter for more insights on AWS cloud computing and containers.\n","wordCount":{"words":692},"frontmatter":{"id":"cd8cb43e0b1130beee42a088","path":"/blog/finops-mayfly-kubernetes-ephemeral-resources/","humanDate":"Oct 25, 2024","fullDate":"2024-10-25","title":"FinOps Best Practices: Using Mayfly Kubernetes Operator for Ephemeral Resources","keywords":["Kubernetes","FinOps","Mayfly Operator","Ephemeral Resources"],"excerpt":"Learn how to optimize resource spend with the Mayfly Kubernetes Operator, implementing FinOps best practices for ephemeral resources.","cover":{"childImageSharp":{"gatsbyImageData":{"layout":"fullWidth","placeholder":{"fallback":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAAAsTAAALEwEAmpwYAAABl0lEQVR42mMQyYg1VKgpO6/f2/E3aP6sd9nrV+QyAIGgoPoiISHNZB0dh9XGxp662tqObhoaTkba2lbKKipmfBISulkyMsYzdXScMgwMnPLNzDz4nJxCtRh8O2qONe7Z+D9367I/BTvX/K88sOl78tLpZhysUpMFhdV2SkjorZSQ0J+rqGjeKS9vPlNa2qhTXFy/R0REuw1o6RRhYU1/GRmjPqCFPTY2gRMY3Gqyvicv7PmTt2P+/9Mv7v2edf3Q/+KDy5MZGFij1P38ePn4lMN5eZXyebgUenj4FZOFBNRzhQQ0ZggKqtkI8mpYCgoq6bJzybjLy5vN1lSzyWRg99c7Yt2c9D9ubeefgL09/+12Nf3w39JlAPK2Vn0oG8OqUGaG+nomQWNjfgYPFXZ+QdVGPgk1U5A8QyhQHgh4RZRUgRY088vrCzDIJNjpWlSFX9HoCPnPPt37i/Da2CyQIu6mQl2umlxDnvpcLe6mbF2eiSA6RZu3LNqCZ36aBteUFAPeOUnq3IuSdPj6Ikx45gdp8O6OVQMAHp95hZuFTtQAAAAASUVORK5CYII="},"images":{"fallback":{"src":"/static/c4939fa7fe0c2fd03fbaa49f94ab75a3/fa90e/cover.png","srcSet":"/static/c4939fa7fe0c2fd03fbaa49f94ab75a3/3be7c/cover.png 750w,\n/static/c4939fa7fe0c2fd03fbaa49f94ab75a3/1b4ad/cover.png 1080w,\n/static/c4939fa7fe0c2fd03fbaa49f94ab75a3/79b05/cover.png 1366w,\n/static/c4939fa7fe0c2fd03fbaa49f94ab75a3/fa90e/cover.png 1600w","sizes":"100vw"},"sources":[{"srcSet":"/static/c4939fa7fe0c2fd03fbaa49f94ab75a3/497ec/cover.webp 750w,\n/static/c4939fa7fe0c2fd03fbaa49f94ab75a3/b6cdd/cover.webp 1080w,\n/static/c4939fa7fe0c2fd03fbaa49f94ab75a3/48f89/cover.webp 1366w,\n/static/c4939fa7fe0c2fd03fbaa49f94ab75a3/533fc/cover.webp 1600w","type":"image/webp","sizes":"100vw"}]},"width":1,"height":0.268125}}},"coverCredits":"Photo by Saifeddine Rajhi"}}},"pageContext":{"prevThought":{"frontmatter":{"path":"/blog/data-on-kubernetes-argo-workflows-4/","title":"Data on Kubernetes: Part 4‚Ää-‚ÄäArgo Workflows: Simplify parallel jobs","date":"2024-10-25 16:06:00"},"excerpt":"Container-native workflow engine for Kubernetes üîÆ üêô Introduction Welcome to the fourth part of the \"Data on Kubernetes\" series! In this‚Ä¶","html":"<blockquote>\n<p><strong>Container-native workflow engine for Kubernetes üîÆ</strong></p>\n</blockquote>\n<h2 id=\"-introduction\" style=\"position:relative;\"><a href=\"#-introduction\" aria-label=\" introduction permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üêô Introduction</h2>\n<p>Welcome to the fourth part of the \"Data on Kubernetes\" series!</p>\n<p>In this part, we'll explore <a href=\"https://argo-workflows.readthedocs.io/en/latest/\" target=\"_blank\" rel=\"noopener noreferrer\">Argo Workflows</a>‚Ää-‚Ääan open-source, container-native workflow engine designed specifically for orchestrating parallel jobs on Kubernetes.</p>\n<p>Argo Workflows seamlessly integrates with Kubernetes services like volumes, secrets, and RBAC, making it a powerful tool for managing complex data workflows.</p>\n<h2 id=\"introduction-to-argo-workflows\" style=\"position:relative;\"><a href=\"#introduction-to-argo-workflows\" aria-label=\"introduction to argo workflows permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Introduction to Argo Workflows</h2>\n<p>In our <a href=\"https://seifrajhi.github.io/blog/data-on-kubernetes-airflow-on-aws-3/\" target=\"_blank\" rel=\"noopener noreferrer\">previous blog post</a>, we explored the world of workflow orchestrators, with a specific focus on Apache Airflow.</p>\n<p>Now, let's check another tool: Argo Workflows.</p>\n<p>As an open-source, container-native workflow engine, Argo Workflows is purpose-built for orchestrating parallel jobs within Kubernetes environments.</p>\n<p>Let's take a closer look at why Argo Workflows stands out:</p>\n<h3 id=\"1-what-is-argo-workflows-\" style=\"position:relative;\"><a href=\"#1-what-is-argo-workflows-\" aria-label=\"1 what is argo workflows  permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>1. What is Argo Workflows? ü§î</h3>\n<p>Argo Workflows empowers you to define workflows where each step corresponds to a container. This flexibility allows for the creation of complex data processing pipelines. Think of it as assembling a series of building blocks, where each block represents a specific task or operation.</p>\n<p>Additionally, Argo Workflows is implemented as a Kubernetes Custom Resource Definition (CRD), seamlessly integrating into the Kubernetes ecosystem without disrupting the existing setup.</p>\n<h3 id=\"2-main-features-and-benefits\" style=\"position:relative;\"><a href=\"#2-main-features-and-benefits\" aria-label=\"2 main features and benefits permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>2. Main Features and Benefits</h3>\n<p><strong>Container-Native Approach:</strong></p>\n<p>Argo Workflows fully embraces the containerization paradigm. Each step in your workflow runs within its own container, ensuring consistency and compatibility across different tasks. Whether you're dealing with data transformations, model training, or any other computational task, Argo Workflows has you covered.</p>\n<p><strong>DAG Modeling (Directed Acyclic Graphs):</strong></p>\n<p>Imagine your workflow as a flowchart with interconnected boxes. Argo Workflows allows you to model multi-step workflows using <a href=\"https://en.wikipedia.org/wiki/Directed_acyclic_graph\" target=\"_blank\" rel=\"noopener noreferrer\">directed acyclic graphs (DAGs)</a>. These graphs capture dependencies between tasks, ensuring that steps execute in the correct order. It's like choreographing a dance where each move follows a logical sequence.</p>\n<p><strong>Efficient Compute Handling:</strong></p>\n<p>Argo Workflows shines when it comes to compute-intensive workloads. Whether you're crunching numbers, analyzing data, or training machine learning models, Argo efficiently manages the computational resources needed for each step.</p>\n<h3 id=\"3-integration-with-the-kubernetes-ecosystem\" style=\"position:relative;\"><a href=\"#3-integration-with-the-kubernetes-ecosystem\" aria-label=\"3 integration with the kubernetes ecosystem permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>3. Integration with the Kubernetes Ecosystem</h3>\n<p>Argo Workflows seamlessly integrates with other Kubernetes services:</p>\n<ul>\n<li><strong>Volumes:</strong> Need to read or write data? Argo Workflows plays well with <a href=\"https://kubernetes.io/docs/concepts/storage/volumes/\" target=\"_blank\" rel=\"noopener noreferrer\">Kubernetes volumes</a>, allowing you to handle data storage efficiently.</li>\n<li><strong>Secrets:</strong> Security matters! Argo Workflows integrates with <a href=\"https://kubernetes.io/docs/concepts/configuration/secret/\" target=\"_blank\" rel=\"noopener noreferrer\">Kubernetes secrets</a>, ensuring that sensitive information remains protected.</li>\n<li><strong>RBAC (Role-Based Access Control):</strong> Argo Workflows respects your access policies. It works harmoniously with <a href=\"https://kubernetes.io/docs/reference/access-authn-authz/rbac/\" target=\"_blank\" rel=\"noopener noreferrer\">Kubernetes RBAC</a>, allowing you to control who can orchestrate workflows and who can't.</li>\n</ul>\n<h3 id=\"4-why-choose-argo-workflows\" style=\"position:relative;\"><a href=\"#4-why-choose-argo-workflows\" aria-label=\"4 why choose argo workflows permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>4. Why Choose Argo Workflows</h3>\n<p>Argo Workflows stands out for several reasons:</p>\n<ul>\n<li><strong>Kubernetes Integration:</strong> Argo Workflows seamlessly integrates with Kubernetes, simplifying usage and deployment.</li>\n<li><strong>Scalability and Complexity Handling:</strong> It efficiently manages complex workflows, even those with thousands of steps.</li>\n<li><strong>Flexible Workflow Patterns:</strong> Argo supports various workflow structures, adapting to your needs.</li>\n<li><strong>Active Open Source Community:</strong> Benefit from a thriving community that actively contributes to Argo's development.</li>\n</ul>\n<h2 id=\"exploring-argo-workflows-on-amazon-eks\" style=\"position:relative;\"><a href=\"#exploring-argo-workflows-on-amazon-eks\" aria-label=\"exploring argo workflows on amazon eks permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Exploring Argo Workflows on Amazon EKS</h2>\n<p>In this section, we'll dive into creating and deploying a data processing platform on <a href=\"https://aws.amazon.com/eks/\" target=\"_blank\" rel=\"noopener noreferrer\">Amazon Elastic Kubernetes Service (Amazon EKS)</a>.</p>\n<p>The solution includes essential Kubernetes add-ons: <a href=\"https://argo-workflows.readthedocs.io/en/latest/\" target=\"_blank\" rel=\"noopener noreferrer\">Argo Workflows</a>, <a href=\"https://argoproj.github.io/argo-events/\" target=\"_blank\" rel=\"noopener noreferrer\">Argo Events</a>, <a href=\"https://github.com/kubeflow/spark-operator\" target=\"_blank\" rel=\"noopener noreferrer\">Spark Operator</a> for managing Spark jobs, <a href=\"https://fluentbit.io/\" target=\"_blank\" rel=\"noopener noreferrer\">Fluent Bit</a> for logging, and <a href=\"https://prometheus.io/\" target=\"_blank\" rel=\"noopener noreferrer\">Prometheus</a> for metrics.</p>\n<h3 id=\"Ô∏è-setup-overview\" style=\"position:relative;\"><a href=\"#%EF%B8%8F-setup-overview\" aria-label=\"Ô∏è setup overview permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üõ†Ô∏è Setup Overview</h3>\n<p><strong>Cluster Setup:</strong> We'll set up an Amazon EKS cluster with a managed node group. We'll install Argo Workflows and Argo Events in their own dedicated namespaces (<code class=\"language-text\">argo-workflows</code> and <code class=\"language-text\">argo-events</code>).</p>\n<p><strong>Event-Driven Workflow:</strong> An <a href=\"https://docs.aws.amazon.com/AWSSimpleQueueService/latest/SQSDeveloperGuide/welcome.html\" target=\"_blank\" rel=\"noopener noreferrer\">Amazon SQS queue</a> will receive user requests. In the Argo Events namespace, an SQS event source object will fetch messages from this external queue. When a new message arrives, a sensor in Argo Workflow will trigger the specified workflow.</p>\n<p><strong>Spark Job Execution:</strong> The triggered workflow will create a Spark application using Spark Operator in the <code class=\"language-text\">data-ops</code> namespace. This application consists of one Spark driver pod and two executor pods.</p>\n<p>The diagram illustrates how Argo Events sources drive the execution of Spark jobs.</p>\n<p><span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 117.64705882352942%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAYCAYAAAD6S912AAAACXBIWXMAAAsTAAALEwEAmpwYAAADHklEQVR42qVUaVMaQRTkn6cq35KqROVQROWwxJhK6cecqKAg4onchyCsgBy77LLILXTezC4pk0piDFPVOzNvenpev9ldA55ok8kEvcEIveEI/9IMfxbS+t5gCLu/CFewhNFwoK3NItjpdLETymEnmMWg35slQ01RasrIFwpIpTNQ1fYMgvw5xtekBNNhFYuBOnZTEl+ZybI/WYHTl8aqJ4JQtvrT2rMEWevT7TaaLdwIJaSv85BabQyGw+dbHusp7KfqMPprsIVErBDMQQmBrPhX24a/XUj0VoY7kMOWP4313QjcR3mkKq3nCz5uaktBqVRCLpfj4/+65enp7EXeDjdgOZZhPmpgJ1x/4rV+IsPxwwh7kSK2zwR8CBX4+MkM+/RpiYrKb/BXiLICQRCQTaeQSSZQJuu/44oEWb3HZDyG4TArwR4ZwJ0YYiOuI0bz5ANswTrmPsXx9mMMr3ZOMfc5Afu5QtwHzvnBT4ywHm6jLKow7Gdl2OMTuNPARuoRaO6iTUavgDlPDvOePMyHZTiuujp3onO1vc5oH8VGCwZvViHBMQUnOkmHLrh22cZSoAqTT6DxPY9NhTSMuaCLBIUGz1CBIznBZhZwZx6B5qvnLViDDViPCWSfCa9dqti8Bk9A42p7XbGpYEaG7bIH51WP7EzRhSPSw8qpDIv/Dsb9IuZ38zSuYOVMhjOic6b8SB92ciKwGn6L1/gnxUj2cIeDkVhNlimzN1/SeLHhxcstP0xUT5axQxfU+Pd8vhi4Q7GukGCsiuWLNt7noNmmujjpRFd0QKQqLIcVQhlmXwlLRzVCVT9wwG1vkuV3tNcarKFQk7UMF08UrMeGsJ02uT3biUzWqLZXHV5HJriwd4PVC5VnxNaWQxJxC3zOLspKhxU1wSrmfWX+N2FFZ8W3nTQJIhzhFv1pJG6dxZaJ44p2sHYucwEGbU2ClVnmgokaXnuKMFPxzf4qocb7Be8tjGTXSNmZaM0SqMF0UOFrxgOKURIWGlsoCSONTRQT2Hsoql3EbyUkOESOuCDyGOuncS2m98Ijno5MRaGf7wjfASpL287nxVwEAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"diagram\" title=\"\" src=\"/static/77747e1703c0180ae5de6102493873dc/c5bb3/diagram.png\" srcset=\"/static/77747e1703c0180ae5de6102493873dc/04472/diagram.png 170w,\n/static/77747e1703c0180ae5de6102493873dc/9f933/diagram.png 340w,\n/static/77747e1703c0180ae5de6102493873dc/c5bb3/diagram.png 680w,\n/static/77747e1703c0180ae5de6102493873dc/dc616/diagram.png 933w\" sizes=\"(max-width: 680px) 100vw, 680px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n    </span>\n          </p>\n<blockquote>\n<p><strong>Prerequisites:</strong> Ensure you have <a href=\"https://docs.aws.amazon.com/cli/latest/userguide/install-cliv2.html\" target=\"_blank\" rel=\"noopener noreferrer\">AWS CLI</a>, <a href=\"https://kubernetes.io/docs/tasks/tools/\" target=\"_blank\" rel=\"noopener noreferrer\">kubectl</a>, <a href=\"https://learn.hashicorp.com/tutorials/terraform/install-cli\" target=\"_blank\" rel=\"noopener noreferrer\">Terraform</a>, and <a href=\"https://github.com/argoproj/argo-workflows/releases/latest\" target=\"_blank\" rel=\"noopener noreferrer\">Argo Workflow CLI</a> installed.</p>\n</blockquote>\n<p>The diagram below shows the detailed technical design that will be set up in this demo:</p>\n<p><span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 35.29411764705882%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAAsTAAALEwEAmpwYAAABu0lEQVR42n2QX2/SUBiH+3H8GH4Fr/wGfgIvjDExmskSY0x0XhgnaEe2ONmGq9kfBg51MAbLRM2cysbSCvQQCgVGW1ZaeCy98sqTPDnv+3vfPDk5kuuN6Vo+vUswrQkjb8L0+OMJ3YGHeeGF83ZwG8GS0R+F9TT7F3PgM3THSKblUTh1yB+dcPi7FUjHodAa+hypLuUGfNF83mRVniTKPF35hrxzzsHZkFLVoVgdUjz32ftpU+uMkAwbNjIfWbh9hcymzLSHCbY7YXNfJ/Z6j42CIPXdYjlnsLArWC+Z7P6wQrLHffaPRSC00FqXSHof3ipbFOevkkvHUY0xtu1gDEY8jiS4d+0Gj2bXWPrcYPXDKanMV16lzoIXayx+arK1XcCUryPUCp2ujVQzXOZTOnMvYkSVMprhMeiZmLbPM7nEzM3nzMmHxLItojv1QPaHl2lBLCOIZprE0xrvt0us5gW/6g5SRbe5v6xxZ1Hl7pJKVTjhHxp9l4frgkhSMJvUiSRqAXUerNSJhNRCpv1MssWtuEbupIckTJe1Qhul1OHdQZtm1w2FF46PUmyTDGbT/H8oRYNEvkWl4fAXMvHjpJ1109EAAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"setup\" title=\"\" src=\"/static/7ca26b2a4e959d7b89e601c5b9c98a7c/c5bb3/setup.png\" srcset=\"/static/7ca26b2a4e959d7b89e601c5b9c98a7c/04472/setup.png 170w,\n/static/7ca26b2a4e959d7b89e601c5b9c98a7c/9f933/setup.png 340w,\n/static/7ca26b2a4e959d7b89e601c5b9c98a7c/c5bb3/setup.png 680w,\n/static/7ca26b2a4e959d7b89e601c5b9c98a7c/b12f7/setup.png 1020w,\n/static/7ca26b2a4e959d7b89e601c5b9c98a7c/b5a09/setup.png 1360w,\n/static/7ca26b2a4e959d7b89e601c5b9c98a7c/29007/setup.png 1600w\" sizes=\"(max-width: 680px) 100vw, 680px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n    </span>\n          </p>\n<h3 id=\"-implementation-steps\" style=\"position:relative;\"><a href=\"#-implementation-steps\" aria-label=\" implementation steps permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üöÄ Implementation Steps</h3>\n<ol>\n<li>\n<p><strong>Clone the Repository:</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token function\">git</span> clone https://github.com/awslabs/data-on-eks.git\n<span class=\"token builtin class-name\">cd</span> data-on-eks/schedulers/terraform/argo-workflow</code></pre></div>\n</li>\n<li>\n<p><strong>Initialize and Apply Terraform:</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">terraform init\nterraform apply <span class=\"token parameter variable\">-var</span> <span class=\"token assign-left variable\">region</span><span class=\"token operator\">=</span>eu-west-1 --auto-approve</code></pre></div>\n<p>This will create:</p>\n<ul>\n<li><strong>EKS and Networking Infrastructure:</strong>\n<ul>\n<li>VPC with Private and Public Subnets.</li>\n<li>Internet Gateway (Public) and NAT Gateway (Private).</li>\n<li>EKS Cluster Control Plane with managed node group.</li>\n</ul>\n</li>\n<li><strong>EKS Managed Add-ons:</strong>\n<ul>\n<li>VPC_CNI, CoreDNS, Kube_Proxy, EBS_CSI_Driver.</li>\n</ul>\n</li>\n<li><strong>Additional Kubernetes Components:</strong>\n<ul>\n<li>Argo Workflows, Argo Events, AWS for FluentBit, Karpenter.</li>\n<li>Metrics Server, CoreDNS Autoscaler, Cluster Autoscaler.</li>\n<li>Kube Prometheus Stack, Spark Operator.</li>\n<li>Roles for Argo Workflows and Argo Events.</li>\n</ul>\n</li>\n</ul>\n</li>\n<li>\n<p><strong>Create the SQS Queue:</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token assign-left variable\">queue_url</span><span class=\"token operator\">=</span><span class=\"token variable\"><span class=\"token variable\">$(</span>aws sqs create-queue --queue-name demo-argo-workflows <span class=\"token parameter variable\">--region</span> eu-west-1 <span class=\"token parameter variable\">--output</span> text<span class=\"token variable\">)</span></span></code></pre></div>\n</li>\n<li>\n<p><strong>Retrieve the Queue ARN:</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token assign-left variable\">sqs_queue_arn</span><span class=\"token operator\">=</span><span class=\"token variable\"><span class=\"token variable\">$(</span>aws sqs get-queue-attributes --queue-url $queue_url --attribute-names QueueArn <span class=\"token parameter variable\">--region</span> eu-west-1 <span class=\"token parameter variable\">--query</span> <span class=\"token string\">\"Attributes.QueueArn\"</span> <span class=\"token parameter variable\">--output</span> text<span class=\"token variable\">)</span></span></code></pre></div>\n<p>Update the SQS access policy:</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token assign-left variable\">template</span><span class=\"token operator\">=</span><span class=\"token variable\"><span class=\"token variable\">`</span><span class=\"token function\">cat</span> argo-events-manifests/sqs-accesspolicy.json <span class=\"token operator\">|</span> <span class=\"token function\">sed</span> <span class=\"token parameter variable\">-e</span> <span class=\"token string\">\"s|&lt;sqs_queue_arn>|<span class=\"token variable\">$sqs_queue_arn</span>|g;s|&lt;your_event_irsa_arn>|<span class=\"token variable\">$your_event_irsa_arn</span>|g\"</span><span class=\"token variable\">`</span></span>\naws sqs set-queue-attributes --queue-url <span class=\"token variable\">$queue_url</span> <span class=\"token parameter variable\">--attributes</span> <span class=\"token variable\">$template</span> <span class=\"token parameter variable\">--region</span> eu-west-1</code></pre></div>\n</li>\n<li>\n<p><strong>Access Argo Workflows Web UI:</strong></p>\n<p>Extract the bearer token:</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">argo auth token</code></pre></div>\n<p>Get the load balancer URL:</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">kubectl <span class=\"token parameter variable\">-n</span> argo-workflows get <span class=\"token function\">service</span> argo-workflows-server <span class=\"token parameter variable\">-o</span> <span class=\"token assign-left variable\">jsonpath</span><span class=\"token operator\">=</span><span class=\"token string\">\"{.status.loadBalancer.ingress[*].hostname}{'<span class=\"token entity\" title=\"\\n\">\\n</span>'}\"</span></code></pre></div>\n<p>Open your browser, enter the URL, and paste the token (including <code class=\"language-text\">Bearer</code>) into the login prompt.</p>\n<p><span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 48.8235294117647%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsTAAALEwEAmpwYAAABQUlEQVR42pWSi26CQBBF+f8va/rS1ipUgQW7sPJGRCAq3g7rFtFo2pLczOxw5+wwQbOWHPXugGJbY1M1vcq6kbX/qOvTXmdzOEEKkwewvBAmiYcJ4nyNvKwuLrmn7vKs2Mp+bURAN8zkwfYjCYzXG1RNjd1+j7ZtlQ6DvMXxeMTwaXZ72a+N9AXc4Azsoh/niAiaDtRNkJKyolTn8pSr2A0hgWPdJGDaA5mIMWMexgsXhuNRzqFTfPqY4mEywePUxPPUwsT6wothQyev7nAsaGUS+GZcAUlzynUydHAmEjhiCREx2qtHk3hYJS55BGY8VJ5Y9p4mvAL+iPV5TEBGO6r7fVVNSXVGnviiR01o3QTaA6DtC/DUQVL4yDcBomxJNU+9uwK+f/4GPEENvqI9efR7+SRx10tA+w/ASH3eULeB3wW+6a/ZrR2LAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"argo\" title=\"\" src=\"/static/3eb6034f8353d03f9b039f02915e645f/c5bb3/argo.png\" srcset=\"/static/3eb6034f8353d03f9b039f02915e645f/04472/argo.png 170w,\n/static/3eb6034f8353d03f9b039f02915e645f/9f933/argo.png 340w,\n/static/3eb6034f8353d03f9b039f02915e645f/c5bb3/argo.png 680w,\n/static/3eb6034f8353d03f9b039f02915e645f/b12f7/argo.png 1020w,\n/static/3eb6034f8353d03f9b039f02915e645f/b5a09/argo.png 1360w,\n/static/3eb6034f8353d03f9b039f02915e645f/64639/argo.png 1568w\" sizes=\"(max-width: 680px) 100vw, 680px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n    </span>\n          </p>\n</li>\n<li>\n<p><strong>Create a Spark Job within an Argo Workflow:</strong></p>\n<p>Install the EventBus:</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">kubectl apply <span class=\"token parameter variable\">-f</span> argo-events-manifests/eventbus.yaml</code></pre></div>\n<p>Set up Amazon SQS as an event source:</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token assign-left variable\">queue_name</span><span class=\"token operator\">=</span>demo-argo-workflows\n<span class=\"token assign-left variable\">region_sqs</span><span class=\"token operator\">=</span>eu-west-1\n\n<span class=\"token function\">cat</span> argo-events-manifests/eventsource-sqs.yaml <span class=\"token operator\">|</span> <span class=\"token function\">sed</span> <span class=\"token string\">\"s/&lt;region_sqs>/<span class=\"token variable\">$region_sqs</span>/g;s/&lt;queue_name>/<span class=\"token variable\">$queue_name</span>/g\"</span> <span class=\"token operator\">|</span> kubectl apply <span class=\"token parameter variable\">-f</span> -</code></pre></div>\n<p>Deploy the sensor:</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">kubectl apply <span class=\"token parameter variable\">-f</span> argo-events-manifests/sensor-rbac.yaml</code></pre></div>\n<p>Update <code class=\"language-text\">taxi-trip.sh</code> with your S3 bucket and region:</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token keyword\">if</span> <span class=\"token punctuation\">[</span> <span class=\"token variable\">$#</span> <span class=\"token parameter variable\">-ne</span> <span class=\"token number\">2</span> <span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span> <span class=\"token keyword\">then</span>\n  <span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"Usage: <span class=\"token variable\">$0</span> &lt;s3_bucket> &lt;region>\"</span>\n  <span class=\"token builtin class-name\">exit</span> <span class=\"token number\">1</span>\n<span class=\"token keyword\">fi</span>\n\n<span class=\"token assign-left variable\">s3_bucket</span><span class=\"token operator\">=</span><span class=\"token string\">\"<span class=\"token variable\">$1</span>\"</span>\n<span class=\"token assign-left variable\">region</span><span class=\"token operator\">=</span><span class=\"token string\">\"<span class=\"token variable\">$2</span>\"</span>\n\n<span class=\"token assign-left variable\">INPUT_DATA_S3_PATH</span><span class=\"token operator\">=</span><span class=\"token string\">\"s3://<span class=\"token variable\">${s3_bucket}</span>/taxi-trip/input/\"</span>\n\n<span class=\"token function\">mkdir</span> input\n\naws s3 <span class=\"token function\">cp</span> pyspark-taxi-trip.py s3://<span class=\"token variable\">${s3_bucket}</span>/taxi-trip/scripts/ <span class=\"token parameter variable\">--region</span> <span class=\"token variable\">${region}</span>\n\n<span class=\"token function\">wget</span> https://d37ci6vzurychx.cloudfront.net/trip-data/yellow_tripdata_2022-01.parquet <span class=\"token parameter variable\">-O</span> <span class=\"token string\">\"input/yellow_tripdata_2022-0.parquet\"</span>\n\n<span class=\"token assign-left variable\">max</span><span class=\"token operator\">=</span><span class=\"token number\">5</span>\n<span class=\"token keyword\">for</span> <span class=\"token variable\"><span class=\"token punctuation\">((</span> i<span class=\"token operator\">=</span><span class=\"token number\">1</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;=</span> $max<span class=\"token punctuation\">;</span> <span class=\"token operator\">++</span>i <span class=\"token punctuation\">))</span></span>\n<span class=\"token keyword\">do</span>\n   <span class=\"token function\">cp</span> <span class=\"token parameter variable\">-rf</span> <span class=\"token string\">\"input/yellow_tripdata_2022-0.parquet\"</span> <span class=\"token string\">\"input/yellow_tripdata_2022-<span class=\"token variable\">${i}</span>.parquet\"</span>\n<span class=\"token keyword\">done</span>\n\naws s3 <span class=\"token function\">sync</span> <span class=\"token string\">\"input/\"</span> <span class=\"token variable\">${INPUT_DATA_S3_PATH}</span>\n\n<span class=\"token function\">rm</span> <span class=\"token parameter variable\">-rf</span> input</code></pre></div>\n<p>Execute the script:</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">./taxi-trip.sh</code></pre></div>\n<p>Apply the sensor configuration:</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">kubectl apply <span class=\"token parameter variable\">-f</span> sensor-sqs-sparkjobs.yaml</code></pre></div>\n</li>\n<li>\n<p><strong>Test the Setup:</strong></p>\n<p>Send a message from SQS:</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">aws sqs send-message --queue-url <span class=\"token variable\">$queue_url</span> --message-body <span class=\"token string\">'{\"message\": \"hello data on k8s\"}'</span> <span class=\"token parameter variable\">--region</span> <span class=\"token variable\">$region_sqs</span></code></pre></div>\n<p>Check the workflow status:</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">kubectl get workflows <span class=\"token parameter variable\">-n</span> argo-workflows</code></pre></div>\n<p>You can also see the SQS workflow status in the web UI:</p>\n<p><span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 49.411764705882355%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsTAAALEwEAmpwYAAABBElEQVR42q2Sy07DMBBF/fcIxKISVFRNqVoQfwMLFl0gnq2gBQc7iRM7dp1wGQcLNiwQqaWjedi+uhoN29s/wNXiBpfXC7jttsM6Isbaua865t/Yn37AUJ1VGuxwcAwuc2y4gNI1eK6QElmpURoLWVR4pzpEQYR+pjRyikVlOqSqurfhPxuejMmNh/Mekh49rDkeieWrwIpLrN5EhHIee7/wtEmxJNjgaEiWHXzbotAGt88cdy9phP+Z8C/ARuMJPgB4chgsh8v7dfpvWHI6h2/aKGj6C06mc5jaom0aGuwOHM7OLqDKCk0naPsLjpIp7Z5HODsRTGbnyGl2lhZT0D71FfwEnJjies0NtoYAAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"webui\" title=\"\" src=\"/static/a6886faf142fff5d7b6ed8fdb42d33f0/c5bb3/webui.png\" srcset=\"/static/a6886faf142fff5d7b6ed8fdb42d33f0/04472/webui.png 170w,\n/static/a6886faf142fff5d7b6ed8fdb42d33f0/9f933/webui.png 340w,\n/static/a6886faf142fff5d7b6ed8fdb42d33f0/c5bb3/webui.png 680w,\n/static/a6886faf142fff5d7b6ed8fdb42d33f0/b12f7/webui.png 1020w,\n/static/a6886faf142fff5d7b6ed8fdb42d33f0/b5a09/webui.png 1360w,\n/static/a6886faf142fff5d7b6ed8fdb42d33f0/29007/webui.png 1600w\" sizes=\"(max-width: 680px) 100vw, 680px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n    </span>\n          </p>\n<p><span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 38.23529411764706%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA9UlEQVR42qWQzU7DMBCE8/6PBVKhh0IqKGkSx46NY+fHDi0SEqEiw5pGqEhpLz180q7XO5rZ6JmViLcM8WaLpyTH5/CFEcD3OP4xntRzDIcDPoYB61Qg0o2DqGoo28C0HtbvUNYOsvEoCUW8GAtOb6GWMwjrYPs97tcporAk6iMlUVQd2ERO8MrhgUukuvk3OyXXLVT3hsUjCXISYVWLwnRnWUqJhFLwM/Ow/+p2WMQkKOoenCzPEaJkpsVSlNhoS72f/RdEtd/jLs4Qyab/jXoJRcgL8yBq+vdj5IIaFmxfQUaRFUW+WSV0w8nyNeTTDW9XCX4AUshPDrxA1/wAAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"webui2\" title=\"\" src=\"/static/52ac3f0c144f0d186e2d73126b7d153d/c5bb3/webui2.png\" srcset=\"/static/52ac3f0c144f0d186e2d73126b7d153d/04472/webui2.png 170w,\n/static/52ac3f0c144f0d186e2d73126b7d153d/9f933/webui2.png 340w,\n/static/52ac3f0c144f0d186e2d73126b7d153d/c5bb3/webui2.png 680w,\n/static/52ac3f0c144f0d186e2d73126b7d153d/b12f7/webui2.png 1020w,\n/static/52ac3f0c144f0d186e2d73126b7d153d/b5a09/webui2.png 1360w,\n/static/52ac3f0c144f0d186e2d73126b7d153d/29007/webui2.png 1600w\" sizes=\"(max-width: 680px) 100vw, 680px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n    </span>\n          </p>\n</li>\n</ol>\n<h3 id=\"-key-takeaways\" style=\"position:relative;\"><a href=\"#-key-takeaways\" aria-label=\" key takeaways permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üìå Key Takeaways</h3>\n<p>In this post, we explored how Argo Workflows and Argo Events can help us better manage and scale Spark applications on Amazon EKS. These tools have several advantages, such as allowing us to create and automate complex pipelines using Argo Workflows, and triggering actions based on events using Argo Events.</p>\n<p><strong>Stay tuned for next blogs in this¬†seriesüéâ</strong></p>\n<p><strong>References:</strong></p>\n<ul>\n<li><a href=\"https://spacelift.io/blog/argo-workflows\" target=\"_blank\" rel=\"noopener noreferrer\">https://spacelift.io/blog/argo-workflows</a></li>\n<li><a href=\"https://codefresh.io/learn/argo-workflows\" target=\"_blank\" rel=\"noopener noreferrer\">https://codefresh.io/learn/argo-workflows</a></li>\n<li><a href=\"https://codefresh.io/learn/argo-workflows/learn-argo-workflows-with-8-simple-examples\" target=\"_blank\" rel=\"noopener noreferrer\">https://codefresh.io/learn/argo-workflows/learn-argo-workflows-with-8-simple-examples</a></li>\n<li><a href=\"https://argo-workflows.readthedocs.io/en/latest\" target=\"_blank\" rel=\"noopener noreferrer\">https://argo-workflows.readthedocs.io/en/latest</a></li>\n<li><a href=\"https://awslabs.github.io/data-on-eks/docs/blueprints/job-schedulers/argo-workflows-eks\" target=\"_blank\" rel=\"noopener noreferrer\">https://awslabs.github.io/data-on-eks/docs/blueprints/job-schedulers/argo-workflows-eks</a></li>\n<li><a href=\"https://aws.amazon.com/blogs/containers/dynamic-spark-scaling-on-amazon-eks-with-argo-workflows-and-events\" target=\"_blank\" rel=\"noopener noreferrer\">https://aws.amazon.com/blogs/containers/dynamic-spark-scaling-on-amazon-eks-with-argo-workflows-and-events</a></li>\n<li><a href=\"https://mkdev.me/posts/argo-ecosystem-argo-cd-argo-workflows-argo-events-argo-rollouts-argo-everything\" target=\"_blank\" rel=\"noopener noreferrer\">https://mkdev.me/posts/argo-ecosystem-argo-cd-argo-workflows-argo-events-argo-rollouts-argo-everything</a></li>\n<li><a href=\"https://dok.community/blog/scheduled-scaling-with-dask-and-argo-workflows/\" target=\"_blank\" rel=\"noopener noreferrer\">https://dok.community/blog/scheduled-scaling-with-dask-and-argo-workflows/</a></li>\n<li>\n<iframe width=\"100%\" height=\"315\" src=\"https://www.youtube-nocookie.com/embed/FBRMURQYbgw?rel=0\" frameborder=\"0\" allow=\"accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture\" allowfullscreen></iframe>\n</li>\n</ul>\n<p><strong>Thank You üñ§</strong></p>\n<br>\n<p><strong><em>Until next time, „Å§„Å•„Åè üéâ</em></strong></p>\n<blockquote>\n<p>üí° Thank you for Reading !! üôåüèªüòÅüìÉ, see you in the next blog.ü§ò  <strong><em>Until next time üéâ</em></strong></p>\n</blockquote>\n<p>üöÄ Thank you for sticking up till the end. If you have any questions/feedback regarding this blog feel free to connect with me:</p>\n<p><strong>‚ôªÔ∏è LinkedIn:</strong> <a href=\"https://www.linkedin.com/in/rajhi-saif/\" target=\"_blank\" rel=\"noopener noreferrer\">https://www.linkedin.com/in/rajhi-saif/</a></p>\n<p><strong>‚ôªÔ∏è X/Twitter:</strong> <a href=\"https://x.com/rajhisaifeddine\" target=\"_blank\" rel=\"noopener noreferrer\">https://x.com/rajhisaifeddine</a></p>\n<p><strong>The end ‚úåüèª</strong></p>\n<h1 align=\"center\">üî∞ Keep Learning !! Keep Sharing !! üî∞</h1>\n<p><strong>üìÖ Stay updated</strong></p>\n<p>Subscribe to our newsletter for more insights on AWS cloud computing and containers.</p>"},"nextThought":{"frontmatter":{"path":"/blog/goldilocks-kubernetes-resource-allocation/","title":"Goldilocks: The Secret to Setting Kubernetes Resource Requests and Limits Just Right","date":"2024-10-25 14:34:00"},"excerpt":"Optimizing Kubernetes Resource Allocation ‚ò∏Ô∏è Introduction Kubernetes resource requests and limits are two of the most important concepts in‚Ä¶","html":"<blockquote>\n<p><strong>Optimizing Kubernetes Resource Allocation</strong></p>\n</blockquote>\n<h2 id=\"Ô∏è-introduction\" style=\"position:relative;\"><a href=\"#%EF%B8%8F-introduction\" aria-label=\"Ô∏è introduction permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>‚ò∏Ô∏è Introduction</h2>\n<p>Kubernetes resource requests and limits are two of the most important concepts in Kubernetes, but they can also be some of the most difficult to set correctly. If your requests are too low, your pods will be evicted and your applications will fail. If your requests are too high, you'll be wasting resources and money.</p>\n<p><a href=\"https://github.com/FairwindsOps/goldilocks\" target=\"_blank\" rel=\"noopener noreferrer\">Goldilocks</a> is a utility that can help you identify a starting point for setting your resource requests and limits. It uses the Kubernetes Vertical Pod Autoscaler (VPA) to analyze the current resource usage of your pods and provide recommendations.</p>\n<p>In this post, we'll explain what Goldilocks is and how it works. We'll also show you how to use Goldilocks to set your resource requests and limits just right.</p>\n<h3 id=\"how-can-this-help-with-resource-settings\" style=\"position:relative;\"><a href=\"#how-can-this-help-with-resource-settings\" aria-label=\"how can this help with resource settings permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>How can this help with resource settings</h3>\n<p>By using the Kubernetes <a href=\"https://github.com/kubernetes/autoscaler/tree/master/vertical-pod-autoscaler\" target=\"_blank\" rel=\"noopener noreferrer\">Vertical Pod Autoscaler</a> in recommendation mode, we can see a suggestion for resource requests on each of our apps. This tool creates a VPA for each workload in a namespace and then queries them for information.</p>\n<p>Once your VPAs are in place, you'll see recommendations appear in the Goldilocks dashboard:</p>\n<p><span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 57.05882352941176%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAABrklEQVR42pWSW2+bQBCF+f8/pa+VWvUpUlIl6kvbNJEs10rFZfEusHcWQ8BwOl4nTSL7IX34AM05MzrMbrK++o70boP8D4PIOdLfGbJNjqHtsIwT5sfxv0hWn69we3EDtn7AoDywoyG+x2Q6jDq8H/IPtUWibz6ivvgAl6VwLEXYMsxGAk6dZbFHTjSvMTUVks3qDl++XaPYFmCCgdccYefR9e1Z+scucqIdalIgMU2NzBgI67BVDiVhpz38fo44+n7G0k6zWiGvNdx49Lj9kzYv8EoiCVqiAyUms/FdRFqPRltUysa6n14woYelA9MuRE+tDBwdhpvn48CWHjERNUoypHkJSSbBORw1vx1IScIOWVaglhq80VDGox1fD5QNxZ5io6gkipJDH9IJgbYbqD7+G9jS70kakBUllHYQ0sBQUv86YbAGdFnifg57LLVBE7rj3qgW3/sXKt+CKUrn/FGPngl2oR3S+hL78xLq/itaXcNWDFYUCEpgcBK9bdCbt3SkBcmjJ+rPHkt+zuge/rhEdv0J1cMKfP0L1eYeY8MocoXFiFOofk471CbB8BffeUYXxWSj9wAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"goldilocks\" title=\"\" src=\"/static/f33bec6050370a9e359e76d5cc147d72/c5bb3/goldilocks.png\" srcset=\"/static/f33bec6050370a9e359e76d5cc147d72/04472/goldilocks.png 170w,\n/static/f33bec6050370a9e359e76d5cc147d72/9f933/goldilocks.png 340w,\n/static/f33bec6050370a9e359e76d5cc147d72/c5bb3/goldilocks.png 680w,\n/static/f33bec6050370a9e359e76d5cc147d72/b12f7/goldilocks.png 1020w,\n/static/f33bec6050370a9e359e76d5cc147d72/b5a09/goldilocks.png 1360w,\n/static/f33bec6050370a9e359e76d5cc147d72/29007/goldilocks.png 1600w\" sizes=\"(max-width: 680px) 100vw, 680px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n    </span>\n          </p>\n<h3 id=\"installation\" style=\"position:relative;\"><a href=\"#installation\" aria-label=\"installation permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Installation</h3>\n<h4 id=\"requirements\" style=\"position:relative;\"><a href=\"#requirements\" aria-label=\"requirements permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Requirements</h4>\n<ul>\n<li><code class=\"language-text\">kubectl</code></li>\n<li>Vertical Pod Autoscaler configured in the cluster</li>\n<li>Some workloads with pods (Goldilocks will monitor any workload controller that includes a PodSpec template (spec.template.spec.containers[] to be specific). This includes Deployments, DaemonSets, and StatefulSets among others.)</li>\n<li><code class=\"language-text\">metrics-server</code> (a requirement of VPA)</li>\n<li><code class=\"language-text\">golang 1.17+</code></li>\n</ul>\n<h4 id=\"installing-vertical-pod-autoscaler\" style=\"position:relative;\"><a href=\"#installing-vertical-pod-autoscaler\" aria-label=\"installing vertical pod autoscaler permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Installing Vertical Pod Autoscaler</h4>\n<p>There are multiple ways to install VPA for use with Goldilocks:</p>\n<ul>\n<li>Install using the <code class=\"language-text\">hack/vpa-up.sh</code> script from the <a href=\"https://github.com/kubernetes/autoscaler/blob/master/vertical-pod-autoscaler/hack/vpa-up.sh\" target=\"_blank\" rel=\"noopener noreferrer\">vertical-pod-autoscaler repository</a>.</li>\n<li>Install using the <a href=\"https://github.com/FairwindsOps/charts/tree/master/stable/vpa\" target=\"_blank\" rel=\"noopener noreferrer\">Fairwinds VPA Helm Chart</a>.</li>\n</ul>\n<blockquote>\n<p><strong>Important Note about VPA:</strong>\nThe full VPA install includes the updater and the admission webhook for VPA. Goldilocks only requires the recommender. An admission webhook can introduce unexpected results in a cluster if not planned for properly. If installing VPA using the Goldilocks chart and the VPA sub-chart, only the VPA recommender will be installed. See the <a href=\"https://github.com/FairwindsOps/charts/tree/master/stable/vpa\" target=\"_blank\" rel=\"noopener noreferrer\">VPA chart</a> and the Goldilocks <a href=\"https://github.com/FairwindsOps/charts/blob/master/stable/goldilocks/values.yaml\" target=\"_blank\" rel=\"noopener noreferrer\">values.yaml</a> for more information.\nVPA does not require the use of Prometheus, but it is supported. The use of Prometheus may provide more accurate results.</p>\n</blockquote>\n<h4 id=\"installation-1\" style=\"position:relative;\"><a href=\"#installation-1\" aria-label=\"installation 1 permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Installation</h4>\n<p>First, make sure you satisfy the requirements above.</p>\n<p><strong>Method 1‚Ää-‚ÄäHelm (preferred):</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"sh\"><pre class=\"language-sh\"><code class=\"language-sh\">helm repo <span class=\"token function\">add</span> fairwinds-stable https://charts.fairwinds.com/stable\nkubectl create namespace goldilocks\nhelm <span class=\"token function\">install</span> goldilocks <span class=\"token parameter variable\">--namespace</span> goldilocks fairwinds-stable/goldilocks</code></pre></div>\n<p><strong>Method 2‚Ää-‚ÄäManifests:</strong></p>\n<p>The <a href=\"https://github.com/FairwindsOps/goldilocks/tree/master/hack/manifests\" target=\"_blank\" rel=\"noopener noreferrer\">hack/manifests</a> directory contains collections of Kubernetes YAML definitions for installing the controller and dashboard components in cluster.</p>\n<div class=\"gatsby-highlight\" data-language=\"sh\"><pre class=\"language-sh\"><code class=\"language-sh\"><span class=\"token function\">git</span> clone https://github.com/FairwindsOps/goldilocks.git\n<span class=\"token builtin class-name\">cd</span> goldilocks\nkubectl create namespace goldilocks\nkubectl <span class=\"token parameter variable\">-n</span> goldilocks apply <span class=\"token parameter variable\">-f</span> hack/manifests/controller\nkubectl <span class=\"token parameter variable\">-n</span> goldilocks apply <span class=\"token parameter variable\">-f</span> hack/manifests/dashboard</code></pre></div>\n<h4 id=\"enable-namespace\" style=\"position:relative;\"><a href=\"#enable-namespace\" aria-label=\"enable namespace permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Enable Namespace</h4>\n<p>Pick an application namespace and label it like so in order to see some data:</p>\n<div class=\"gatsby-highlight\" data-language=\"sh\"><pre class=\"language-sh\"><code class=\"language-sh\">kubectl label ns goldilocks goldilocks.fairwinds.com/enabled<span class=\"token operator\">=</span>true</code></pre></div>\n<p>After that, you should start to see VPA objects in that namespace.</p>\n<h4 id=\"viewing-the-dashboard\" style=\"position:relative;\"><a href=\"#viewing-the-dashboard\" aria-label=\"viewing the dashboard permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Viewing the Dashboard</h4>\n<p>The default installation creates a ClusterIP service for the dashboard. You can access via port forward:</p>\n<div class=\"gatsby-highlight\" data-language=\"sh\"><pre class=\"language-sh\"><code class=\"language-sh\">kubectl <span class=\"token parameter variable\">-n</span> goldilocks port-forward svc/goldilocks-dashboard <span class=\"token number\">8080</span>:80</code></pre></div>\n<p>Then open your browser to <a href=\"http://localhost:8080\" target=\"_blank\" rel=\"noopener noreferrer\">http://localhost:8080</a>.</p>\n<h3 id=\"how-accurate-is-goldilocks\" style=\"position:relative;\"><a href=\"#how-accurate-is-goldilocks\" aria-label=\"how accurate is goldilocks permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>How Accurate is Goldilocks?</h3>\n<p>The Goldilocks open-source software is based entirely on the underlying VPA project, specifically the Recommender. In our experience, Goldilocks is a good starting point for setting your resource requests and limits. But every environment is different, and Goldilocks isn't a replacement for tuning your applications to your specific use cases.</p>\n<h2 id=\"-closing-thoughts\" style=\"position:relative;\"><a href=\"#-closing-thoughts\" aria-label=\" closing thoughts permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üìù Closing Thoughts</h2>\n<p>So this is how Goldilocks can be used by Developers, SRE, and DevOps teams to calculate the right estimates for all their workloads and also from the FinOps perspective. Please feel free to share your experience while implementing this in your clusters.</p>\n<p><strong>Thank You üñ§</strong></p>\n<br>\n<p><strong><em>Until next time, „Å§„Å•„Åè üéâ</em></strong></p>\n<blockquote>\n<p>üí° Thank you for Reading !! üôåüèªüòÅüìÉ, see you in the next blog.ü§ò  <strong><em>Until next time üéâ</em></strong></p>\n</blockquote>\n<p>üöÄ Thank you for sticking up till the end. If you have any questions/feedback regarding this blog feel free to connect with me:</p>\n<p><strong>‚ôªÔ∏è LinkedIn:</strong> <a href=\"https://www.linkedin.com/in/rajhi-saif/\" target=\"_blank\" rel=\"noopener noreferrer\">https://www.linkedin.com/in/rajhi-saif/</a></p>\n<p><strong>‚ôªÔ∏è X/Twitter:</strong> <a href=\"https://x.com/rajhisaifeddine\" target=\"_blank\" rel=\"noopener noreferrer\">https://x.com/rajhisaifeddine</a></p>\n<p><strong>The end ‚úåüèª</strong></p>\n<h1 align=\"center\">üî∞ Keep Learning !! Keep Sharing !! üî∞</h1>\n<p><strong>üìÖ Stay updated</strong></p>\n<p>Subscribe to our newsletter for more insights on AWS cloud computing and containers.</p>"}}},"staticQueryHashes":["1271460761","1321585977"],"slicesMap":{}}