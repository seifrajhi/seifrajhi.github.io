{"componentChunkName":"component---src-templates-blog-template-js","path":"/blog/ekspert-automation-auto-mode-karpenter/","result":{"data":{"markdownRemark":{"html":"<blockquote>\n<p><strong>Automate Your Amazon EKS Journey with Auto Mode and Karpenter in Action</strong></p>\n</blockquote>\n<h2 id=\"-introduction\" style=\"position:relative;\"><a href=\"#-introduction\" aria-label=\" introduction permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üöÄ Introduction</h2>\n<p>In the quest for seamless Kubernetes management, automation is key.</p>\n<p>This blog explores how <a href=\"https://karpenter.sh/\" target=\"_blank\" rel=\"noopener noreferrer\">Karpenter</a> and <a href=\"https://docs.aws.amazon.com/eks/latest/userguide/automode.html\" target=\"_blank\" rel=\"noopener noreferrer\">EKS Auto Mode</a> transform Amazon Kubernetes cluster management.</p>\n<p>By overcoming the limitations of traditional scaling tools, optimizing resource usage, and automating infrastructure provisioning and updates, these tools ensure your clusters are efficient and cost-effective.</p>\n<p>Amazon EKS Auto Mode further enhances deployment by managing compute, networking, and storage, dynamically scaling resources based on application needs, and maintaining security through automatic updates and health monitoring.</p>\n<h2 id=\"introduction-to-amazon-eks-and-karpenter\" style=\"position:relative;\"><a href=\"#introduction-to-amazon-eks-and-karpenter\" aria-label=\"introduction to amazon eks and karpenter permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Introduction to Amazon EKS and Karpenter</h2>\n<p>Amazon Elastic Kubernetes Service EKS simplifies the deployment and management of Kubernetes (k8s) clusters. Kubernetes is a well-known container orchestration platform, but managing its control plane can be complex and resource-intensive. EKS provides a managed control plane, ensuring scalability, high availability, and security.</p>\n<h3 id=\"scaling-applications-with-traditional-tools\" style=\"position:relative;\"><a href=\"#scaling-applications-with-traditional-tools\" aria-label=\"scaling applications with traditional tools permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Scaling Applications with Traditional Tools</h3>\n<p>Traditional tools like Cluster Autoscaler have several challenges:</p>\n<ul>\n<li><strong>Node Groups Management</strong>: Requires creating and managing multiple node groups.</li>\n<li><strong>Instance Family Specification</strong>: Users must specify instance families and their priorities.</li>\n<li><strong>Autoscaling Groups</strong>: Each node group needs a separate autoscaling group, complicating management.</li>\n<li><strong>AMI Selection and Refresh</strong>: Managing AMI (Amazon Machine Image) selection and updates can be cumbersome.</li>\n</ul>\n<h3 id=\"karpenter-a-modern-solution-for-scaling\" style=\"position:relative;\"><a href=\"#karpenter-a-modern-solution-for-scaling\" aria-label=\"karpenter a modern solution for scaling permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Karpenter: A Modern Solution for Scaling</h3>\n<p>Karpenter is a Kubernetes-native autoscaler designed to overcome these limitations. It interacts directly with EC2 Fleet, bypassing the need for node groups and autoscaling groups, resulting in faster and more efficient instance provisioning. Karpenter uses YAML files (NodePool and EC2NodeClass) to manage its behavior, offering flexibility and control.</p>\n<h3 id=\"key-insights\" style=\"position:relative;\"><a href=\"#key-insights\" aria-label=\"key insights permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Key Insights</h3>\n<ol>\n<li>\n<p><strong>üîç What is Karpenter?</strong>\nKarpenter automatically adds or removes servers (nodes) in a Kubernetes cluster, adjusting resources dynamically to match workloads.</p>\n</li>\n<li>\n<p><strong>‚öñÔ∏è Karpenter vs. Cluster Autoscaler</strong>\nKarpenter communicates directly with cloud providers (like AWS EC2) and can add new resources in seconds instead of minutes.</p>\n</li>\n<li>\n<p><strong>üìä Choosing the Right Resources Automatically</strong>\nKarpenter selects the best type of server based on application needs (CPU, memory, etc.), simplifying setup and saving time.</p>\n</li>\n<li>\n<p><strong>üîÑ Save Money with Resource Consolidation</strong>\nKarpenter combines workloads on fewer servers, moving workloads around and shutting down idle servers to reduce costs.</p>\n</li>\n<li>\n<p><strong>‚öôÔ∏è Works with Kubernetes Scheduling</strong>\nKarpenter integrates seamlessly with Kubernetes, respecting all scheduling rules and supporting specialized applications.</p>\n</li>\n<li>\n<p><strong>üí° Supports All Types of Workloads</strong>\nKarpenter handles high-performance servers, GPUs, specific configurations, and works across different environments, including multi-cloud setups.</p>\n</li>\n<li>\n<p><strong>üìö Easy to Learn and Use</strong>\nThis guide covers everything from understanding scaling to implementing Karpenter in real-world scenarios.</p>\n</li>\n</ol>\n<h3 id=\"key-features-of-karpenter\" style=\"position:relative;\"><a href=\"#key-features-of-karpenter\" aria-label=\"key features of karpenter permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Key Features of Karpenter</h3>\n<ul>\n<li><a href=\"https://karpenter.sh/v1.1/concepts/nodepools/\" target=\"_blank\" rel=\"noopener noreferrer\">NodePool YAML</a>: Specify instance families, availability zones, architecture types (x86 or ARM), and capacity types (spot and on-demand).</li>\n<li><a href=\"https://karpenter.sh/v1.1/concepts/scheduling/\" target=\"_blank\" rel=\"noopener noreferrer\">Scheduling Constraints</a>: Supports node selectors, node affinity, taints and tolerations, and topology spread.</li>\n<li><strong>User-Defined Labels</strong>: Enables custom labels, taints, and annotations.</li>\n<li><strong>Cost Optimization</strong>: Automatically consolidates underutilized nodes.</li>\n<li><a href=\"https://karpenter.sh/docs/concepts/disruption/#disruption-budgets\" target=\"_blank\" rel=\"noopener noreferrer\">Disruption Budget</a>: Controls when nodes can be disrupted, with configurable policies.</li>\n<li><a href=\"https://karpenter.sh/docs/concepts/disruption/#drift\" target=\"_blank\" rel=\"noopener noreferrer\">Drift Management</a>: Ensures the desired state matches the current state by reconciling node configurations.</li>\n<li><a href=\"https://karpenter.sh/v1.1/concepts/nodeclasses/\" target=\"_blank\" rel=\"noopener noreferrer\">EC2NodeClass</a>: Manages AMI selection, subnets, security groups, and other configurations.</li>\n</ul>\n<h3 id=\"advanced-ami-management\" style=\"position:relative;\"><a href=\"#advanced-ami-management\" aria-label=\"advanced ami management permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Advanced AMI Management</h3>\n<p>Karpenter supports using Amazon EKS optimized AMIs, including BottleRocket and Amazon Linux 2. Users can pin worker nodes to specific AMI versions for testing before rolling out updates. Custom AMIs are also supported, allowing selection by tag, name, owner, or ID. If multiple AMIs match the criteria, Karpenter uses the latest one.</p>\n<h3 id=\"new-features-in-karpenter-v1\" style=\"position:relative;\"><a href=\"#new-features-in-karpenter-v1\" aria-label=\"new features in karpenter v1 permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>New Features in Karpenter v1</h3>\n<ol>\n<li>\n<p><strong>Enhanced Disruption Controls by Reason</strong>\nSpecify disruption budgets based on reasons like Underutilized, Empty, or Drifted.</p>\n</li>\n<li>\n<p><strong>Forceful Disruption Mode</strong>\nBalance application availability against security requirements with assertive node lifecycle management.</p>\n</li>\n<li>\n<p><strong>Expanded consolidateAfter Functionality</strong>\nDefine how long Karpenter should wait before consolidating underutilized nodes.</p>\n</li>\n</ol>\n<h3 id=\"challenges-and-solutions-beyond-karpenter\" style=\"position:relative;\"><a href=\"#challenges-and-solutions-beyond-karpenter\" aria-label=\"challenges and solutions beyond karpenter permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Challenges and Solutions Beyond Karpenter</h3>\n<p>While Karpenter addresses many scaling challenges, managing core cluster capabilities like networking, service discovery, and load balancing remains complex. Upgrading and securing Kubernetes clusters also require dedicated expertise and continuous time investment.</p>\n<h2 id=\"introduction-to-amazon-eks-auto-mode\" style=\"position:relative;\"><a href=\"#introduction-to-amazon-eks-auto-mode\" aria-label=\"introduction to amazon eks auto mode permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Introduction to Amazon EKS Auto Mode</h2>\n<p>Amazon EKS Auto Mode offloads more operational responsibilities to AWS, extending AWS's responsibility from the control plane to the data plane, including compute, networking, and storage.</p>\n<p>EKS Auto Mode dynamically scales compute resources based on application needs, optimizes costs through dynamic scaling and capacity planning, and automatically updates worker nodes and applies security fixes.</p>\n<h3 id=\"benefits-of-eks-auto-mode\" style=\"position:relative;\"><a href=\"#benefits-of-eks-auto-mode\" aria-label=\"benefits of eks auto mode permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Benefits of EKS Auto Mode</h3>\n<ul>\n<li><strong>Simplified Deployment</strong>: Reduces the steps needed to deploy applications by automating infrastructure provisioning and management.</li>\n<li><strong>Managed Core Capabilities</strong>: Provides managed compute, network, and storage capabilities out of the box.</li>\n<li><strong>Health Monitoring and Auto Repair</strong>: Includes health monitoring and auto-repair features.</li>\n<li><strong>Networking Enhancements</strong>: Simplifies networking with managed VPC CNI, network policies, and in-cluster service load balancing.</li>\n<li><strong>Shared Responsibility Model</strong>: Shifts more responsibility to AWS, allowing customers to focus on application innovation.</li>\n</ul>\n<h3 id=\"getting-started-with-eks-auto-mode\" style=\"position:relative;\"><a href=\"#getting-started-with-eks-auto-mode\" aria-label=\"getting started with eks auto mode permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Getting Started with EKS Auto Mode</h3>\n<p>EKS Auto Mode simplifies cluster creation with a single-click setup and built-in best practices.</p>\n<p>It provides two default node pools (general purpose and system) supporting a mix of instance types and architectures (Graviton and x86). Users can also define custom node pools for specific use cases like GPU instances, spot instances, and tenant isolation.</p>\n<p><strong>Key Features of EKS Auto Mode:</strong></p>\n<ul>\n<li><strong>General Purpose Node Pool</strong>: Supports a mix of on-demand instance types, consolidation enabled by default, and a default node expiry of 14 days.</li>\n<li><strong>System Node Pool</strong>: Dedicated for critical add-ons, supports both AMD and ARM architectures, and includes a special taint to prevent scheduling regular workloads.</li>\n<li><strong>User-Defined Node Pools</strong>: Allows customization for specific use cases, such as GPU instances, spot instances, and tenant isolation.</li>\n<li><strong>EKSNodeClass</strong>: Manages security groups and subnets without requiring AMI selectors, as AWS handles the lifecycle of EC2 instances.</li>\n</ul>\n<h3 id=\"day-two-operations-and-updates\" style=\"position:relative;\"><a href=\"#day-two-operations-and-updates\" aria-label=\"day two operations and updates permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Day Two Operations and Updates</h3>\n<p>EKS Auto Mode handles updates for core capabilities and data plane nodes, respecting disruption budgets and ensuring minimal impact on running applications. Security updates are automatically applied, and worker nodes are updated in a rolling deployment fashion.</p>\n<p><strong>Automatic Updates:</strong></p>\n<ul>\n<li><strong>Core Capabilities</strong>: Automatically updates core capabilities like Karpenter, storage controllers, and network controllers.</li>\n<li><strong>Data Plane Nodes</strong>: Worker nodes are updated to the latest AMI versions, respecting disruption budgets.</li>\n<li><strong>Security Updates</strong>: Security patches are applied automatically, ensuring a secure environment.</li>\n</ul>\n<h3 id=\"conclusion\" style=\"position:relative;\"><a href=\"#conclusion\" aria-label=\"conclusion permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Conclusion</h3>\n<p>Amazon EKS, Karpenter, and EKS Auto Mode collectively enhance Kubernetes cluster management by simplifying scaling, optimizing costs, and automating infrastructure provisioning and updates. These tools provide robust solutions for modern cloud-based applications, allowing users to focus on innovation while AWS handles the operational complexities.</p>\n<p>This comprehensive approach ensures efficient, secure, and cost-effective Kubernetes cluster management, making it easier for users to deploy and manage their applications at scale.</p>\n<p><strong>Thank You üñ§</strong></p>\n<p><strong><em>Until next time, „Å§„Å•„Åè üéâ</em></strong></p>\n<blockquote>\n<p>üí° Thank you for Reading !! üôåüèªüòÅüìÉ, see you in the next blog.ü§ò  <strong><em>Until next time üéâ</em></strong></p>\n</blockquote>\n<p>üöÄ Thank you for sticking up till the end. If you have any questions/feedback regarding this blog feel free to connect with me:</p>\n<p><strong>‚ôªÔ∏è LinkedIn:</strong> <a href=\"https://www.linkedin.com/in/rajhi-saif/\" target=\"_blank\" rel=\"noopener noreferrer\">https://www.linkedin.com/in/rajhi-saif/</a></p>\n<p><strong>‚ôªÔ∏è X/Twitter:</strong> <a href=\"https://x.com/rajhisaifeddine\" target=\"_blank\" rel=\"noopener noreferrer\">https://x.com/rajhisaifeddine</a></p>\n<p><strong>The end ‚úåüèª</strong></p>\n<h1 align=\"center\">üî∞ Keep Learning !! Keep Sharing !! üî∞</h1>\n<p><strong>üìÖ Stay updated</strong></p>\n<p>Subscribe to our newsletter for more insights on AWS cloud computing and containers.</p>","timeToRead":5,"rawMarkdownBody":"\n> **Automate Your Amazon EKS Journey with Auto Mode and Karpenter in Action**\n\n## üöÄ Introduction\n\nIn the quest for seamless Kubernetes management, automation is key.\n\nThis blog explores how [Karpenter](https://karpenter.sh/) and [EKS Auto Mode](https://docs.aws.amazon.com/eks/latest/userguide/automode.html) transform Amazon Kubernetes cluster management.\n\nBy overcoming the limitations of traditional scaling tools, optimizing resource usage, and automating infrastructure provisioning and updates, these tools ensure your clusters are efficient and cost-effective.\n\nAmazon EKS Auto Mode further enhances deployment by managing compute, networking, and storage, dynamically scaling resources based on application needs, and maintaining security through automatic updates and health monitoring.\n\n## Introduction to Amazon EKS and Karpenter\n\nAmazon Elastic Kubernetes Service EKS simplifies the deployment and management of Kubernetes (k8s) clusters. Kubernetes is a well-known container orchestration platform, but managing its control plane can be complex and resource-intensive. EKS provides a managed control plane, ensuring scalability, high availability, and security.\n\n### Scaling Applications with Traditional Tools\n\nTraditional tools like Cluster Autoscaler have several challenges:\n\n- **Node Groups Management**: Requires creating and managing multiple node groups.\n- **Instance Family Specification**: Users must specify instance families and their priorities.\n- **Autoscaling Groups**: Each node group needs a separate autoscaling group, complicating management.\n- **AMI Selection and Refresh**: Managing AMI (Amazon Machine Image) selection and updates can be cumbersome.\n\n### Karpenter: A Modern Solution for Scaling\n\nKarpenter is a Kubernetes-native autoscaler designed to overcome these limitations. It interacts directly with EC2 Fleet, bypassing the need for node groups and autoscaling groups, resulting in faster and more efficient instance provisioning. Karpenter uses YAML files (NodePool and EC2NodeClass) to manage its behavior, offering flexibility and control.\n\n### Key Insights\n\n1. **üîç What is Karpenter?**\n   Karpenter automatically adds or removes servers (nodes) in a Kubernetes cluster, adjusting resources dynamically to match workloads.\n\n2. **‚öñÔ∏è Karpenter vs. Cluster Autoscaler**\n   Karpenter communicates directly with cloud providers (like AWS EC2) and can add new resources in seconds instead of minutes.\n\n3. **üìä Choosing the Right Resources Automatically**\n   Karpenter selects the best type of server based on application needs (CPU, memory, etc.), simplifying setup and saving time.\n\n4. **üîÑ Save Money with Resource Consolidation**\n   Karpenter combines workloads on fewer servers, moving workloads around and shutting down idle servers to reduce costs.\n\n5. **‚öôÔ∏è Works with Kubernetes Scheduling**\n   Karpenter integrates seamlessly with Kubernetes, respecting all scheduling rules and supporting specialized applications.\n\n6. **üí° Supports All Types of Workloads**\n   Karpenter handles high-performance servers, GPUs, specific configurations, and works across different environments, including multi-cloud setups.\n\n7. **üìö Easy to Learn and Use**\n   This guide covers everything from understanding scaling to implementing Karpenter in real-world scenarios.\n\n### Key Features of Karpenter\n\n- [NodePool YAML](https://karpenter.sh/v1.1/concepts/nodepools/): Specify instance families, availability zones, architecture types (x86 or ARM), and capacity types (spot and on-demand).\n- [Scheduling Constraints](https://karpenter.sh/v1.1/concepts/scheduling/): Supports node selectors, node affinity, taints and tolerations, and topology spread.\n- **User-Defined Labels**: Enables custom labels, taints, and annotations.\n- **Cost Optimization**: Automatically consolidates underutilized nodes.\n- [Disruption Budget](https://karpenter.sh/docs/concepts/disruption/#disruption-budgets): Controls when nodes can be disrupted, with configurable policies.\n- [Drift Management](https://karpenter.sh/docs/concepts/disruption/#drift): Ensures the desired state matches the current state by reconciling node configurations.\n- [EC2NodeClass](https://karpenter.sh/v1.1/concepts/nodeclasses/): Manages AMI selection, subnets, security groups, and other configurations.\n\n### Advanced AMI Management\n\nKarpenter supports using Amazon EKS optimized AMIs, including BottleRocket and Amazon Linux 2. Users can pin worker nodes to specific AMI versions for testing before rolling out updates. Custom AMIs are also supported, allowing selection by tag, name, owner, or ID. If multiple AMIs match the criteria, Karpenter uses the latest one.\n\n### New Features in Karpenter v1\n\n1. **Enhanced Disruption Controls by Reason**\n   Specify disruption budgets based on reasons like Underutilized, Empty, or Drifted.\n\n2. **Forceful Disruption Mode**\n   Balance application availability against security requirements with assertive node lifecycle management.\n\n3. **Expanded consolidateAfter Functionality**\n   Define how long Karpenter should wait before consolidating underutilized nodes.\n\n### Challenges and Solutions Beyond Karpenter\n\nWhile Karpenter addresses many scaling challenges, managing core cluster capabilities like networking, service discovery, and load balancing remains complex. Upgrading and securing Kubernetes clusters also require dedicated expertise and continuous time investment.\n\n## Introduction to Amazon EKS Auto Mode\n\nAmazon EKS Auto Mode offloads more operational responsibilities to AWS, extending AWS's responsibility from the control plane to the data plane, including compute, networking, and storage.\n\nEKS Auto Mode dynamically scales compute resources based on application needs, optimizes costs through dynamic scaling and capacity planning, and automatically updates worker nodes and applies security fixes.\n\n### Benefits of EKS Auto Mode\n\n- **Simplified Deployment**: Reduces the steps needed to deploy applications by automating infrastructure provisioning and management.\n- **Managed Core Capabilities**: Provides managed compute, network, and storage capabilities out of the box.\n- **Health Monitoring and Auto Repair**: Includes health monitoring and auto-repair features.\n- **Networking Enhancements**: Simplifies networking with managed VPC CNI, network policies, and in-cluster service load balancing.\n- **Shared Responsibility Model**: Shifts more responsibility to AWS, allowing customers to focus on application innovation.\n\n### Getting Started with EKS Auto Mode\n\nEKS Auto Mode simplifies cluster creation with a single-click setup and built-in best practices.\n\nIt provides two default node pools (general purpose and system) supporting a mix of instance types and architectures (Graviton and x86). Users can also define custom node pools for specific use cases like GPU instances, spot instances, and tenant isolation.\n\n**Key Features of EKS Auto Mode:**\n\n- **General Purpose Node Pool**: Supports a mix of on-demand instance types, consolidation enabled by default, and a default node expiry of 14 days.\n- **System Node Pool**: Dedicated for critical add-ons, supports both AMD and ARM architectures, and includes a special taint to prevent scheduling regular workloads.\n- **User-Defined Node Pools**: Allows customization for specific use cases, such as GPU instances, spot instances, and tenant isolation.\n- **EKSNodeClass**: Manages security groups and subnets without requiring AMI selectors, as AWS handles the lifecycle of EC2 instances.\n\n### Day Two Operations and Updates\n\nEKS Auto Mode handles updates for core capabilities and data plane nodes, respecting disruption budgets and ensuring minimal impact on running applications. Security updates are automatically applied, and worker nodes are updated in a rolling deployment fashion.\n\n**Automatic Updates:**\n\n- **Core Capabilities**: Automatically updates core capabilities like Karpenter, storage controllers, and network controllers.\n- **Data Plane Nodes**: Worker nodes are updated to the latest AMI versions, respecting disruption budgets.\n- **Security Updates**: Security patches are applied automatically, ensuring a secure environment.\n\n### Conclusion\n\nAmazon EKS, Karpenter, and EKS Auto Mode collectively enhance Kubernetes cluster management by simplifying scaling, optimizing costs, and automating infrastructure provisioning and updates. These tools provide robust solutions for modern cloud-based applications, allowing users to focus on innovation while AWS handles the operational complexities.\n\nThis comprehensive approach ensures efficient, secure, and cost-effective Kubernetes cluster management, making it easier for users to deploy and manage their applications at scale.\n\n**Thank You üñ§**\n\n**_Until next time, „Å§„Å•„Åè üéâ_**\n\n> üí° Thank you for Reading !! üôåüèªüòÅüìÉ, see you in the next blog.ü§ò  **_Until next time üéâ_**\n\nüöÄ Thank you for sticking up till the end. If you have any questions/feedback regarding this blog feel free to connect with me:\n\n**‚ôªÔ∏è LinkedIn:** https://www.linkedin.com/in/rajhi-saif/\n\n**‚ôªÔ∏è X/Twitter:** https://x.com/rajhisaifeddine\n\n**The end ‚úåüèª**\n\n<h1 align=\"center\">üî∞ Keep Learning !! Keep Sharing !! üî∞</h1>\n\n**üìÖ Stay updated**\n\nSubscribe to our newsletter for more insights on AWS cloud computing and containers.\n","wordCount":{"words":1134},"frontmatter":{"id":"b5a2899b42b61274dfcce6fe","path":"/blog/ekspert-automation-auto-mode-karpenter/","humanDate":"Jan 20, 2025","fullDate":"2025-01-20","title":"EKS'pert Automation: Amazon EKS Auto Mode and Karpenter in action","keywords":["AWS EKS","Amazon EKS","Karpenter","Kubernetes","Automation","Auto mode"],"excerpt":"Automate Your Amazon EKS Journey with Auto Mode and Karpenter in Action","cover":{"childImageSharp":{"gatsbyImageData":{"layout":"fullWidth","placeholder":{"fallback":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAABYlAAAWJQFJUiTwAAACpUlEQVR42kWS20tUURSH5/9JIkfPmXHGGpWg1KikTAgj08zSNAQpeqiHJPIpzO5YmaaOqdM4nlFLxxTyVkp5I5MRlKxIm25qkZOer3XOKD187LX3Xvv322uvbdnv+cDFhxqFdf0U1A2R5x7mWMM4RbV95NcPccI9Int9Mn9BRlOQzMa3FD/qIafhDfl1g5yrCXCmtp/E1hWUdrA4/GvEa6vE+8MktS6ZsUv7TYp3kT3eBdI88yS3hEj2fjHXjDhJDsdrf3DKmfjWn2z3fcfu17EJFrUNU1ltN0Ydq4y7vSHT/XDjO7IbxiioHzRvm+t+bVawQwRjOyBOiGoJCN3EPQN7xzoWmwiabDhsEtv2H8UYxSymPWJuE6JbJoVRoqq72fbgI9FVn7HWhCKCdiNJHNROOWCwERvYDDoiJnGSG+ObZqunS8TemqKKbxnVpwth4W9EUNXWcDwI4rr5ioSKAVzl/eaYKHPnnQkUz7KUA1YtTJT3PdbWEDHy9opfDMQoRjRi2yI3tyhPIcH9iYM550g/eYGM06UcL7nCkeLLHCos5UBmIbvKe4mWW6f3rJM3CMkBSAnoJHetkyrx3ueRNXubISiqric/yL4/gLPpG0evtuDal0vm+RskNi6QUT1GmnuGLZJcMKRzfRrOjuiUjuqUDOsUydppIV8wqrWocm2HlHOqeQqHf5Ws2nEOFVwit8KPU7qW1RwkRVsyG+L0rZPUuMrOTp0dXVKu8QwG0jSrJu9oCJpdlXKi7wVJvxZAezlLYGSGjqEg+ZW9qLfGJFGXfyYlVYZxlH1FuTOP9bY05O4Uyu0J1KpZYQ5b8/JGl42/KG/p8q1Q2rtA2dNJyrrnSPUsmuv2za9VvYb9/l/snl+oj0Mo9bJfv4DavITqWcHmC/MPQ8NyZoYmW3cAAAAASUVORK5CYII="},"images":{"fallback":{"src":"/static/6c6694dc3c35eb43d428f204439a55f6/94622/cover.png","srcSet":"/static/6c6694dc3c35eb43d428f204439a55f6/ba276/cover.png 750w,\n/static/6c6694dc3c35eb43d428f204439a55f6/87bd8/cover.png 1080w,\n/static/6c6694dc3c35eb43d428f204439a55f6/aff65/cover.png 1366w,\n/static/6c6694dc3c35eb43d428f204439a55f6/94622/cover.png 1920w","sizes":"100vw"},"sources":[{"srcSet":"/static/6c6694dc3c35eb43d428f204439a55f6/5436b/cover.webp 750w,\n/static/6c6694dc3c35eb43d428f204439a55f6/e1011/cover.webp 1080w,\n/static/6c6694dc3c35eb43d428f204439a55f6/87692/cover.webp 1366w,\n/static/6c6694dc3c35eb43d428f204439a55f6/9d794/cover.webp 1920w","type":"image/webp","sizes":"100vw"}]},"width":1,"height":0.5526041666666667}}},"coverCredits":"Photo by Saifeddine Rajhi"}}},"pageContext":{"nextThought":{"frontmatter":{"path":"/blog/eks-node-health-monitoring/","title":"Node Health Monitoring and Auto-Repair for Amazon EKS","date":"2024-12-23 08:00:00"},"excerpt":"Overiew of Node health monitoring and auto-repair for Amazon EKS Amazon Elastic Kubernetes Service (Amazon EKS) continues to innovate beyond‚Ä¶"}}},"staticQueryHashes":["1271460761","1321585977"],"slicesMap":{}}