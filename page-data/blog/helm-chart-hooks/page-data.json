{"componentChunkName":"component---src-templates-blog-template-js","path":"/blog/helm-chart-hooks/","result":{"data":{"markdownRemark":{"html":"<blockquote>\n<p><strong>the significance of Helm Chart Hooks in Kubernetes application deployment‚Ü©</strong></p>\n</blockquote>\n<h2 id=\"Ô∏è-introduction\" style=\"position:relative;\"><a href=\"#%EF%B8%8F-introduction\" aria-label=\"Ô∏è introduction permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>‚úçÔ∏è Introduction</h2>\n<p>Helm, the package manager for Kubernetes, provides a great mechanism known as <strong>chart hooks</strong>, which allows us to execute scripts or commands at specific points during the lifecycle of a Kubernetes object created from a Helm chart.</p>\n<p>These hooks play a big role in addressing missing orchestration and facilitating runtime parameter changes, thereby enhancing the flexibility and control of the deployment process.</p>\n<p>In this guide, we will explore Helm chart hooks, examining their various types, practical applications, and the significance of integrating them into the deployment workflow.</p>\n<h2 id=\"-key-use-cases-of-helm-chart-hooks\" style=\"position:relative;\"><a href=\"#-key-use-cases-of-helm-chart-hooks\" aria-label=\" key use cases of helm chart hooks permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üîë Key Use Cases of Helm Chart Hooks</h2>\n<p>Helm chart hooks offer a wide range of use cases, empowering developers to streamline the packaging of complex applications. Some of the key applications of Helm chart hooks include:</p>\n<ul>\n<li><strong>Loading Secrets for Image Pull</strong>: Helm chart hooks can be used to load secrets required to access a repository and pull an image before the main service is deployed.</li>\n<li><strong>Database Migrations</strong>: They enable the execution of database migrations before updating the service, ensuring seamless transitions and data integrity.</li>\n<li><strong>Resource Cleanup</strong>: Helm chart hooks facilitate the cleanup of external resources after the associated service is deleted, promoting efficient resource management.</li>\n<li><strong>Prerequisite Checking</strong>: They allow for the validation of service prerequisites before the actual deployment, ensuring that all necessary conditions are met for a successful deployment.</li>\n</ul>\n<p>These use cases demonstrate the versatility and practicality of Helm chart hooks in addressing various aspects of the application lifecycle, from pre-deployment preparations to post-deployment maintenance and cleanup.</p>\n<h2 id=\"Ô∏è-types-of-helm-chart-hooks\" style=\"position:relative;\"><a href=\"#%EF%B8%8F-types-of-helm-chart-hooks\" aria-label=\"Ô∏è types of helm chart hooks permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üõ†Ô∏è Types of Helm Chart Hooks</h2>\n<p>Helm chart hooks are categorized into the following types based on what stage of the chart lifecycle they are triggered:</p>\n<ul>\n<li><strong>Pre-Install Hooks</strong>: These run after templates are rendered and before any resources are created in a Kubernetes cluster.</li>\n<li><strong>Post-Install Hooks</strong>: They run after all Kubernetes resources have been loaded.</li>\n<li><strong>Pre-Delete Hooks</strong>: These run before any existing resources are deleted from Kubernetes.</li>\n<li><strong>Post-Delete Hooks</strong>: They run after all Kubernetes resources have been deleted.</li>\n<li><strong>Pre-Upgrade Hooks</strong>: These run after chart templates have been rendered and before any resources are loaded into Kubernetes.</li>\n<li><strong>Post-Upgrade Hooks</strong>: They run after all Kubernetes resources have been upgraded.</li>\n<li><strong>Pre-Rollback Hooks</strong>: These run after templates have been rendered and before any resources are rolled back.</li>\n<li><strong>Post-Rollback Hooks</strong>: They run after all resources have been modified.</li>\n<li><strong>Test Hooks</strong>: These run when the <code class=\"language-text\">helm test</code> subcommand is executed.</li>\n</ul>\n<p>These distinct types of hooks enable developers to intervene at specific points in a release's lifecycle, allowing for a high degree of customization and control over the deployment process.</p>\n<p><span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 51.17647058823529%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsTAAALEwEAmpwYAAACMElEQVR42j2Su2sUURTGJyEsAXceOzN3Zic7z+zuzO5mFcVG7MQHMUVElESSbIIJJpCAiooE1CZgKsVCbEWwsFQQhCBYBfEvsBErK8HOwvLzu3d2UxzOYw5nfue7RzODFNKsIMNRPJUNa2Uukhxe1IJl12H5MUx+L3tozGtOQB+pXs1NunCiDuywDTdmTLMabfqOshpju5HDbp+Cc3YOTnEaTpjDojlRAad1Eu6ZWbisu3EBzUl68LKCDSRIe2p4lA2bOTwr+hBuA9Wdp9B+Asd29uHW6ki7HMS6vvEE2nfW7z6DEJEk7JV/9NNyCE3F4TCuZ3D8BNb5BUzuvYV1YRG2kGs3Wacs565jcv8dzMsDiKA5IuSaEYfK9blmmBaKVBKmeR+eCKHffATt6z9U1x8r4qxHQhLpKw+gHf5FdWsPwktKQqmf4cX01IpkJolGsRVMw+E3c3YFlefv6Qew3ZCP0mKd5BdvoPLiI8z5DRJOl4SCRGbUpoYzsEk2FbeVt0kYNnslyeAhxr78QXV1F74XIcqPw+er6ot3MPb5N6rU8ojQ4TCT0+UQpSPPYaShS3pFOLeKyssD+jV43MBPuxDU17y0hMqrAxhXbjEfErpxrm6qRg1tDvEaXJOaytgnrXxNY+kexj/9gr58X2lYzzoQvEHj2jbGP/yAvrbLPB2tzHsjSS3rq0cJeMjqDhO58oxqNK5uYeL1If0mvHqKMD8BTx72/Dom3nyDsXBbEf8HPKIrcm3C9SsAAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"hooks-types\" title=\"\" src=\"/static/862cfa3397f8b494805ccb834cfb3992/c5bb3/hooks-types.png\" srcset=\"/static/862cfa3397f8b494805ccb834cfb3992/04472/hooks-types.png 170w,\n/static/862cfa3397f8b494805ccb834cfb3992/9f933/hooks-types.png 340w,\n/static/862cfa3397f8b494805ccb834cfb3992/c5bb3/hooks-types.png 680w,\n/static/862cfa3397f8b494805ccb834cfb3992/b12f7/hooks-types.png 1020w,\n/static/862cfa3397f8b494805ccb834cfb3992/b5a09/hooks-types.png 1360w,\n/static/862cfa3397f8b494805ccb834cfb3992/d5b59/hooks-types.png 1370w\" sizes=\"(max-width: 680px) 100vw, 680px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n    </span>\n          </p>\n<p>For more detailed information, you can refer to the <a href=\"https://helm.sh/docs/topics/charts_hooks/\" target=\"_blank\" rel=\"noopener noreferrer\">Helm documentation</a>.</p>\n<h2 id=\"-test-run-explanation\" style=\"position:relative;\"><a href=\"#-test-run-explanation\" aria-label=\" test run explanation permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üß™ Test-Run Explanation</h2>\n<p>When we use a <strong>pre-install hook</strong> in Helm, it works like this:</p>\n<ol>\n<li>You type a command like <code class=\"language-text\">helm install release-name ./chart</code>.</li>\n<li>Helm starts preparing files, but it doesn't send them to Kubernetes yet.</li>\n<li>Instead, it runs the pre-install hook, following the actions in the chart.</li>\n<li>For example, this hook might create a Kubernetes object, like a Job, to do something.</li>\n<li>After the hook finishes, Helm installs our chart. It sends the files to Kubernetes, and our objects are installed.</li>\n</ol>\n<p>With a <strong>post-install hook</strong>, it's similar, but the hook runs after the chart installs everything. This pattern repeats with pre/post-upgrade and pre/post-rollback hooks. They run before or after normal operations, depending on what we want to do. For instance, a pre-upgrade hook might back up a database, while a post-upgrade hook could check if the website works after the upgrade.</p>\n<p>Helm waits for the hook to finish, and if a pre/post-install hook fails, the whole operation fails. That means the release installation stops because of the hook failure.</p>\n<h2 id=\"Ô∏è-hands-on-example\" style=\"position:relative;\"><a href=\"#%EF%B8%8F-hands-on-example\" aria-label=\"Ô∏è hands on example permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üõ†Ô∏è Hands-on Example</h2>\n<p>Hooks are pretty much regular template files that we can add to the <code class=\"language-text\">templates/</code> directory. I have set up a GitHub repository with a full example of how Helm Chart Hooks work ‚≠êÔ∏è. You can check it out <a href=\"https://github.com/seifrajhi/Kubernetes-practical-exercises-Hands-on/tree/main/helm-chart-hooks-example\" target=\"_blank\" rel=\"noopener noreferrer\">here</a>.</p>\n<p>What makes them special is the annotation we add to the <code class=\"language-text\">metadata:</code> section. Here's an example of such an annotation:</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> batch/v1\n<span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> Job\n<span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> .Release.Name <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">-</span>app\n    <span class=\"token key atrule\">labels</span><span class=\"token punctuation\">:</span>\n        <span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">-</span> include \"app.labels\" . <span class=\"token punctuation\">|</span> indent 4 <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\n    <span class=\"token key atrule\">annotations</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">\"helm.sh/hook\"</span><span class=\"token punctuation\">:</span> post<span class=\"token punctuation\">-</span>install\n        <span class=\"token key atrule\">\"helm.sh/hook-weight\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"5\"</span>\n        <span class=\"token key atrule\">\"helm.sh/hook-delete-policy\"</span><span class=\"token punctuation\">:</span> hook<span class=\"token punctuation\">-</span>succeeded\n<span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">template</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n            <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> .Release.Name <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">-</span>app\n            <span class=\"token key atrule\">labels</span><span class=\"token punctuation\">:</span>\n                <span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">-</span> include \"app.labels\" . <span class=\"token punctuation\">|</span> indent 8 <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\n        <span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span>\n            <span class=\"token key atrule\">restartPolicy</span><span class=\"token punctuation\">:</span> Never\n            <span class=\"token key atrule\">containers</span><span class=\"token punctuation\">:</span>\n            <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> post<span class=\"token punctuation\">-</span>install<span class=\"token punctuation\">-</span>job\n                <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"my-image:1.0\"</span>\n                <span class=\"token key atrule\">command</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"/bin/some-backup-command\"</span><span class=\"token punctuation\">]</span></code></pre></div>\n<p>For more detailed information, you can refer to the <a href=\"https://helm.sh/docs/topics/charts_hooks/\" target=\"_blank\" rel=\"noopener noreferrer\">Helm documentation on hooks</a>.</p>\n<p>This simply defines a <strong>post-install hook</strong> that would create a Kubernetes Job to do something in our cluster after the <code class=\"language-text\">helm install</code> command succeeds. To use this in our chart, we'd create a file with a command like <code class=\"language-text\">vim ~/chart/templates/job.yaml</code> and paste the contents above to it. But we won't be doing that as it wouldn't generate any interesting practical results in our scenario. Instead, let's study how to use the annotations section, the line:</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">\"helm.sh/hook\"</span><span class=\"token punctuation\">:</span> post<span class=\"token punctuation\">-</span>install</code></pre></div>\n<p>This defines what kind of hook this is: <code class=\"language-text\">post-install</code>, <code class=\"language-text\">pre-install</code>, <code class=\"language-text\">post-rollback</code>, and so on.</p>\n<h3 id=\"Ô∏è-pre-install-example\" style=\"position:relative;\"><a href=\"#%EF%B8%8F-pre-install-example\" aria-label=\"Ô∏è pre install example permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üõ†Ô∏è Pre-Install Example</h3>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> v1\n<span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> Pod\n<span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> hook<span class=\"token punctuation\">-</span>preinstall\n    <span class=\"token key atrule\">annotations</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">\"helm.sh/hook\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"pre-install\"</span>\n<span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">containers</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> hook1<span class=\"token punctuation\">-</span>container\n        <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> busybox\n        <span class=\"token key atrule\">imagePullPolicy</span><span class=\"token punctuation\">:</span> IfNotPresent\n        <span class=\"token key atrule\">command</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'sh'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'-c'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'echo The pre-install hook Pod is running - hook-preinstall &amp;&amp; sleep 15'</span><span class=\"token punctuation\">]</span>\n    <span class=\"token key atrule\">restartPolicy</span><span class=\"token punctuation\">:</span> Never\n    <span class=\"token key atrule\">terminationGracePeriodSeconds</span><span class=\"token punctuation\">:</span> <span class=\"token number\">0</span></code></pre></div>\n<p>This hook will start a container, sleep for 15 seconds, and then complete.</p>\n<h3 id=\"Ô∏è-post-install-example\" style=\"position:relative;\"><a href=\"#%EF%B8%8F-post-install-example\" aria-label=\"Ô∏è post install example permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üõ†Ô∏è Post-Install Example</h3>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> v1\n<span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> Pod\n<span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> hook<span class=\"token punctuation\">-</span>postinstall\n    <span class=\"token key atrule\">annotations</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">\"helm.sh/hook\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"post-install\"</span>\n<span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">containers</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> hook2<span class=\"token punctuation\">-</span>container\n        <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> busybox\n        <span class=\"token key atrule\">imagePullPolicy</span><span class=\"token punctuation\">:</span> IfNotPresent\n        <span class=\"token key atrule\">command</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'sh'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'-c'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'echo post-install hook Pod is running - hook-postinstall &amp;&amp; sleep 10'</span><span class=\"token punctuation\">]</span>\n    <span class=\"token key atrule\">restartPolicy</span><span class=\"token punctuation\">:</span> Never\n    <span class=\"token key atrule\">terminationGracePeriodSeconds</span><span class=\"token punctuation\">:</span> <span class=\"token number\">0</span></code></pre></div>\n<p>The above manifest ensures that the actions defined within this Pod's container are executed as part of the post-install hook process, allowing for custom operations to be performed after the installation of the Helm chart.</p>\n<h3 id=\"-helm-test\" style=\"position:relative;\"><a href=\"#-helm-test\" aria-label=\" helm test permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üß™ Helm Test</h3>\n<p>There is also a Helm hook called <code class=\"language-text\">test</code>. Using the <code class=\"language-text\">test</code> hook, we can test our release. The <code class=\"language-text\">helm test</code> command takes the release as an input. So to test our chart, we have to install the chart beforehand. Then we can run the <code class=\"language-text\">helm test</code> command to test our release.</p>\n<p>All the test files reside under the <code class=\"language-text\">Chart/templates/tests</code> directory. Let's see a test template file:</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token comment\"># chartName/templates/tests/test-connection.yaml</span>\n<span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> v1\n<span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> Pod\n<span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> \"<span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> include \"webserver.fullname\" . <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">-</span>test<span class=\"token punctuation\">-</span>connection\"\n    <span class=\"token key atrule\">labels</span><span class=\"token punctuation\">:</span>\n        <span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">-</span> include \"app.labels\" . <span class=\"token punctuation\">|</span> nindent 4 <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\n    <span class=\"token key atrule\">annotations</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">\"helm.sh/hook\"</span><span class=\"token punctuation\">:</span> test\n<span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">containers</span><span class=\"token punctuation\">:</span>\n        <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> wget\n            <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> busybox\n            <span class=\"token key atrule\">command</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'wget'</span><span class=\"token punctuation\">]</span>\n            <span class=\"token key atrule\">args</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'{{ include \"app.fullname\" . }}:{{ .Values.service.port }}'</span><span class=\"token punctuation\">]</span>\n    <span class=\"token key atrule\">restartPolicy</span><span class=\"token punctuation\">:</span> Never</code></pre></div>\n<p>In the above demonstration, we can see that a <code class=\"language-text\">test</code> type hook is defined. Though it is a Pod, it will not be installed during the installation phase of the chart. It will be installed only if we trigger it using the <code class=\"language-text\">helm test</code> command. This Pod will test the connection between the Pod and a particular service specified in the above template file. There are other use cases such as, when deploying a database, we can check whether the database passwords are set correctly or not.</p>\n<h3 id=\"Ô∏è-conclusion\" style=\"position:relative;\"><a href=\"#%EF%B8%8F-conclusion\" aria-label=\"Ô∏è conclusion permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>‚òÅÔ∏è Conclusion</h3>\n<p>The significance of Helm Chart Hooks in Kubernetes application deployment is undeniable. These hooks enable developers to execute custom actions and create Kubernetes objects at specific points in a release's lifecycle, seamlessly incorporating tasks such as initialization, configuration, and validation. This level of control not only enhances the extensibility of Helm charts but also facilitates the implementation of best practices in Kubernetes application management.</p>\n<br>\n<p><strong><em>Until next time, „Å§„Å•„Åè üéâ</em></strong></p>\n<blockquote>\n<p>üí° Thank you for Reading !! üôåüèªüòÅüìÉ, see you in the next blog.ü§ò  <strong><em>Until next time üéâ</em></strong></p>\n</blockquote>\n<p>üöÄ Thank you for sticking up till the end. If you have any questions/feedback regarding this blog feel free to connect with me:</p>\n<p><strong>‚ôªÔ∏è LinkedIn:</strong> <a href=\"https://www.linkedin.com/in/rajhi-saif/\" target=\"_blank\" rel=\"noopener noreferrer\">https://www.linkedin.com/in/rajhi-saif/</a></p>\n<p><strong>‚ôªÔ∏è X/Twitter:</strong> <a href=\"https://x.com/rajhisaifeddine\" target=\"_blank\" rel=\"noopener noreferrer\">https://x.com/rajhisaifeddine</a></p>\n<p><strong>The end ‚úåüèª</strong></p>\n<h1 align=\"center\">üî∞ Keep Learning !! Keep Sharing !! üî∞</h1>\n<p><strong>üìÖ Stay updated</strong></p>\n<p>Subscribe to our newsletter for more insights on AWS cloud computing and containers.</p>","timeToRead":5,"rawMarkdownBody":"\n\n> **the significance of Helm Chart Hooks in Kubernetes application deployment‚Ü©**\n\n## ‚úçÔ∏è Introduction\n\nHelm, the package manager for Kubernetes, provides a great mechanism known as **chart hooks**, which allows us to execute scripts or commands at specific points during the lifecycle of a Kubernetes object created from a Helm chart.\n\nThese hooks play a big role in addressing missing orchestration and facilitating runtime parameter changes, thereby enhancing the flexibility and control of the deployment process.\n\nIn this guide, we will explore Helm chart hooks, examining their various types, practical applications, and the significance of integrating them into the deployment workflow.\n\n## üîë Key Use Cases of Helm Chart Hooks\n\nHelm chart hooks offer a wide range of use cases, empowering developers to streamline the packaging of complex applications. Some of the key applications of Helm chart hooks include:\n\n- **Loading Secrets for Image Pull**: Helm chart hooks can be used to load secrets required to access a repository and pull an image before the main service is deployed.\n- **Database Migrations**: They enable the execution of database migrations before updating the service, ensuring seamless transitions and data integrity.\n- **Resource Cleanup**: Helm chart hooks facilitate the cleanup of external resources after the associated service is deleted, promoting efficient resource management.\n- **Prerequisite Checking**: They allow for the validation of service prerequisites before the actual deployment, ensuring that all necessary conditions are met for a successful deployment.\n\nThese use cases demonstrate the versatility and practicality of Helm chart hooks in addressing various aspects of the application lifecycle, from pre-deployment preparations to post-deployment maintenance and cleanup.\n\n## üõ†Ô∏è Types of Helm Chart Hooks\n\nHelm chart hooks are categorized into the following types based on what stage of the chart lifecycle they are triggered:\n\n- **Pre-Install Hooks**: These run after templates are rendered and before any resources are created in a Kubernetes cluster.\n- **Post-Install Hooks**: They run after all Kubernetes resources have been loaded.\n- **Pre-Delete Hooks**: These run before any existing resources are deleted from Kubernetes.\n- **Post-Delete Hooks**: They run after all Kubernetes resources have been deleted.\n- **Pre-Upgrade Hooks**: These run after chart templates have been rendered and before any resources are loaded into Kubernetes.\n- **Post-Upgrade Hooks**: They run after all Kubernetes resources have been upgraded.\n- **Pre-Rollback Hooks**: These run after templates have been rendered and before any resources are rolled back.\n- **Post-Rollback Hooks**: They run after all resources have been modified.\n- **Test Hooks**: These run when the `helm test` subcommand is executed.\n\nThese distinct types of hooks enable developers to intervene at specific points in a release's lifecycle, allowing for a high degree of customization and control over the deployment process.\n\n![hooks-types](./hooks-types.png)\n\nFor more detailed information, you can refer to the [Helm documentation](https://helm.sh/docs/topics/charts_hooks/).\n\n## üß™ Test-Run Explanation\n\nWhen we use a **pre-install hook** in Helm, it works like this:\n\n1. You type a command like `helm install release-name ./chart`.\n2. Helm starts preparing files, but it doesn't send them to Kubernetes yet.\n3. Instead, it runs the pre-install hook, following the actions in the chart.\n4. For example, this hook might create a Kubernetes object, like a Job, to do something.\n5. After the hook finishes, Helm installs our chart. It sends the files to Kubernetes, and our objects are installed.\n\nWith a **post-install hook**, it's similar, but the hook runs after the chart installs everything. This pattern repeats with pre/post-upgrade and pre/post-rollback hooks. They run before or after normal operations, depending on what we want to do. For instance, a pre-upgrade hook might back up a database, while a post-upgrade hook could check if the website works after the upgrade.\n\nHelm waits for the hook to finish, and if a pre/post-install hook fails, the whole operation fails. That means the release installation stops because of the hook failure.\n\n## üõ†Ô∏è Hands-on Example\n\nHooks are pretty much regular template files that we can add to the `templates/` directory. I have set up a GitHub repository with a full example of how Helm Chart Hooks work ‚≠êÔ∏è. You can check it out [here](https://github.com/seifrajhi/Kubernetes-practical-exercises-Hands-on/tree/main/helm-chart-hooks-example).\n\nWhat makes them special is the annotation we add to the `metadata:` section. Here's an example of such an annotation:\n\n```yaml\napiVersion: batch/v1\nkind: Job\nmetadata:\n    name: {{ .Release.Name }}-app\n    labels:\n        {{- include \"app.labels\" . | indent 4 }}\n    annotations:\n        \"helm.sh/hook\": post-install\n        \"helm.sh/hook-weight\": \"5\"\n        \"helm.sh/hook-delete-policy\": hook-succeeded\nspec:\n    template:\n        metadata:\n            name: {{ .Release.Name }}-app\n            labels:\n                {{- include \"app.labels\" . | indent 8 }}\n        spec:\n            restartPolicy: Never\n            containers:\n            - name: post-install-job\n                image: \"my-image:1.0\"\n                command: [\"/bin/some-backup-command\"]\n```\n\nFor more detailed information, you can refer to the [Helm documentation on hooks](https://helm.sh/docs/topics/charts_hooks/).\n\nThis simply defines a **post-install hook** that would create a Kubernetes Job to do something in our cluster after the `helm install` command succeeds. To use this in our chart, we'd create a file with a command like `vim ~/chart/templates/job.yaml` and paste the contents above to it. But we won't be doing that as it wouldn't generate any interesting practical results in our scenario. Instead, let's study how to use the annotations section, the line:\n\n```yaml\n\"helm.sh/hook\": post-install\n```\n\nThis defines what kind of hook this is: `post-install`, `pre-install`, `post-rollback`, and so on.\n\n### üõ†Ô∏è Pre-Install Example\n\n```yaml\napiVersion: v1\nkind: Pod\nmetadata:\n    name: hook-preinstall\n    annotations:\n        \"helm.sh/hook\": \"pre-install\"\nspec:\n    containers:\n    - name: hook1-container\n        image: busybox\n        imagePullPolicy: IfNotPresent\n        command: ['sh', '-c', 'echo The pre-install hook Pod is running - hook-preinstall && sleep 15']\n    restartPolicy: Never\n    terminationGracePeriodSeconds: 0\n```\n\nThis hook will start a container, sleep for 15 seconds, and then complete.\n\n### üõ†Ô∏è Post-Install Example\n\n```yaml\napiVersion: v1\nkind: Pod\nmetadata:\n    name: hook-postinstall\n    annotations:\n        \"helm.sh/hook\": \"post-install\"\nspec:\n    containers:\n    - name: hook2-container\n        image: busybox\n        imagePullPolicy: IfNotPresent\n        command: ['sh', '-c', 'echo post-install hook Pod is running - hook-postinstall && sleep 10']\n    restartPolicy: Never\n    terminationGracePeriodSeconds: 0\n```\n\nThe above manifest ensures that the actions defined within this Pod's container are executed as part of the post-install hook process, allowing for custom operations to be performed after the installation of the Helm chart.\n\n### üß™ Helm Test\n\nThere is also a Helm hook called `test`. Using the `test` hook, we can test our release. The `helm test` command takes the release as an input. So to test our chart, we have to install the chart beforehand. Then we can run the `helm test` command to test our release.\n\nAll the test files reside under the `Chart/templates/tests` directory. Let's see a test template file:\n\n```yaml\n# chartName/templates/tests/test-connection.yaml\napiVersion: v1\nkind: Pod\nmetadata:\n    name: \"{{ include \"webserver.fullname\" . }}-test-connection\"\n    labels:\n        {{- include \"app.labels\" . | nindent 4 }}\n    annotations:\n        \"helm.sh/hook\": test\nspec:\n    containers:\n        - name: wget\n            image: busybox\n            command: ['wget']\n            args: ['{{ include \"app.fullname\" . }}:{{ .Values.service.port }}']\n    restartPolicy: Never\n```\n\nIn the above demonstration, we can see that a `test` type hook is defined. Though it is a Pod, it will not be installed during the installation phase of the chart. It will be installed only if we trigger it using the `helm test` command. This Pod will test the connection between the Pod and a particular service specified in the above template file. There are other use cases such as, when deploying a database, we can check whether the database passwords are set correctly or not.\n\n### ‚òÅÔ∏è Conclusion\n\nThe significance of Helm Chart Hooks in Kubernetes application deployment is undeniable. These hooks enable developers to execute custom actions and create Kubernetes objects at specific points in a release's lifecycle, seamlessly incorporating tasks such as initialization, configuration, and validation. This level of control not only enhances the extensibility of Helm charts but also facilitates the implementation of best practices in Kubernetes application management.\n\n<br>\n\n**_Until next time, „Å§„Å•„Åè üéâ_**\n\n> üí° Thank you for Reading !! üôåüèªüòÅüìÉ, see you in the next blog.ü§ò  **_Until next time üéâ_**\n\nüöÄ Thank you for sticking up till the end. If you have any questions/feedback regarding this blog feel free to connect with me:\n\n**‚ôªÔ∏è LinkedIn:** https://www.linkedin.com/in/rajhi-saif/\n\n**‚ôªÔ∏è X/Twitter:** https://x.com/rajhisaifeddine\n\n**The end ‚úåüèª**\n\n<h1 align=\"center\">üî∞ Keep Learning !! Keep Sharing !! üî∞</h1>\n\n**üìÖ Stay updated**\n\nSubscribe to our newsletter for more insights on AWS cloud computing and containers.\n\n","wordCount":{"words":1097},"frontmatter":{"id":"c947e45955339a61d4cef872","path":"/blog/helm-chart-hooks/","humanDate":"Oct 21, 2024","fullDate":"2024-10-21","title":"Understanding Helm Chart Hooks ü™ù","keywords":["Helm chart","Kubernetes","Helm hooks","DevOps"],"excerpt":"Discover the power of Helm Chart Hooks and how they can automate and streamline your Kubernetes deployments. Learn about the different types of hooks and their practical applications.","cover":{"childImageSharp":{"gatsbyImageData":{"layout":"fullWidth","placeholder":{"fallback":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAAAsTAAALEwEAmpwYAAADyElEQVR42iWTa1OTVxSFQ7lDCJikuRJyfRMuolCKldoOzICoSAEFtNxBEVKEqlRAnUERAgkWEpK8hAS0CAgdBkSp03aml+mH/oD+i/6Hfnp6Rj+sOWdm771mrbPXUeQdB9AcLaI7DqF7F0V3FEb38zqan+IYX0dRH8moX4fJ218k9/kjVFuTKF+OkbPdj332G1zPJjixWoskN+KMNKDI2nlA5kgz6XfbyRhsInOwmbTRa6TebiNj+ArpAkkDF0n6tpGkpgqS+qtI6vuUtAdnMAfacD67Q95KFfbwecyhGkG4e5fUQDfJ4Rsk+zpI9veQutRHynIvycvdpMy2kOJrJG3+ApmPzpHrO0feUAna+yU4E81YH1ylQK7GHK6jIFKPQr3Vg2q3h+ztLpQ7nSj3OskINJLlv0S2/zzKhRrUwRpM8S8pSFRhjX+GdfUMFrkS60oN7oftSOsNGCK1GKMXULjW67CJZmviC6yxz7GLIf0NO9pWE+oGPdoWA4ZuE7Y5D65oKY5QKfZIOVZZkIbPUvi4C+d6C1q5Hm3sKxSeWDkeuRhXsBAp6BH3D3BH3EghCWlFwhPzUJgowr1ahJQ4hVPMWKOV7wW4pzuF2mbyEk2o4tdQlMRKkfwOTDdM6Np06Dv0GPuMAgYsY/noruowe82YBkyiZsB404ItUIotVol5owZpppe84BWUm31oXoygKF4rp2jJTv49AyavQQzpPpCN5mObtInTSr7X8p7Q5M3HeMuCZeE0HyeqRXRasM0OoA2PkLJzj4yXD1GclC9SuVyBe/Qy0tMKnP5ipCUX7mUJ15INt2zAHbO8t+xJlOHcFEvaqCN1/TppeyOCXCDhI3XfR9qrAArVWivW/h48I424ujpwjAkbQQvOBTunQmepCkWpiNzEJRdiW6vGOve1SMMwyVvjZBzMiY3PYJMXyXqzStZ+DEX2w9sUjHo5/aSOsplqpKEWnE/KcHyvoTayw/O/YHj7XxGbdvFLruO804PxxSzphwGyj1ex/7CEfWUR1a87ZL/ZFAr7p8kYGMc42M3JiQY83f04pqtwyHoq43PcevUf9dv/CDtjpO1PUCzPoz+M89FBmNw/d0XfvIhchJzfDznxdg9FakI85rAgfNSFa6ibivFLVDwppXDqExEJkcvFYYz+AdTzA5jCU7gnR7FuyuT8fYDtj0OcM9PY3/2I5pd9NG93USijUyh998nxfofqcS+OmS5K5i5jftqAZqaVrEg/6kUv2uAE+vA0BatzuP2zFAdDeOZ92LbjaH/bR3W0SfbhBv8D3mAo/Qqpb10AAAAASUVORK5CYII="},"images":{"fallback":{"src":"/static/3927db2fff10c223374d9cb89636921e/5120b/h-hooks-cover.png","srcSet":"/static/3927db2fff10c223374d9cb89636921e/372e6/h-hooks-cover.png 750w,\n/static/3927db2fff10c223374d9cb89636921e/52574/h-hooks-cover.png 1080w,\n/static/3927db2fff10c223374d9cb89636921e/30c4f/h-hooks-cover.png 1366w,\n/static/3927db2fff10c223374d9cb89636921e/5120b/h-hooks-cover.png 1394w","sizes":"100vw"},"sources":[{"srcSet":"/static/3927db2fff10c223374d9cb89636921e/54c3a/h-hooks-cover.webp 750w,\n/static/3927db2fff10c223374d9cb89636921e/85e18/h-hooks-cover.webp 1080w,\n/static/3927db2fff10c223374d9cb89636921e/51c3e/h-hooks-cover.webp 1366w,\n/static/3927db2fff10c223374d9cb89636921e/37731/h-hooks-cover.webp 1394w","type":"image/webp","sizes":"100vw"}]},"width":1,"height":0.7051649928263988}}},"coverCredits":"Photo by Saifeddine Rajhi"}}},"pageContext":{"prevThought":{"frontmatter":{"path":"/blog/container-exit-codes/","title":"Understanding Common Exit Codes and Error Messages in Containers & Kubernetes üéë","date":"2024-10-21 20:06:00"},"excerpt":"A Guide for Effective Troubleshooting üîß üñã Introduction When working with containers and Kubernetes, understanding exit codes and common‚Ä¶"},"nextThought":{"frontmatter":{"path":"/blog/cloud-native-landscape/","title":"Explore the Variety of Cloud-Native Landscape: the Dynamic World of Kubernetes and Beyond","date":"2024-10-21 17:06:00"},"excerpt":"Cloudy with a Chance of Containers: Navigating the Murky Waters of Cloud-Native Projects ‚òÅÔ∏è üå© Overview üëÄ They say I was supposed to be a‚Ä¶"}}},"staticQueryHashes":["1271460761","1321585977"],"slicesMap":{}}