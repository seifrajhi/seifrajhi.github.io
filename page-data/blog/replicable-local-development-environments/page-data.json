{"componentChunkName":"component---src-templates-blog-template-js","path":"/blog/replicable-local-development-environments/","result":{"data":{"markdownRemark":{"html":"<blockquote>\n<p><strong>Isolated, shareable, and secure local setup strategies üî•</strong></p>\n</blockquote>\n<h2 id=\"-introduction\" style=\"position:relative;\"><a href=\"#-introduction\" aria-label=\" introduction permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üìö Introduction</h2>\n<p>The modern software development relies heavily upon external libraries, frameworks, and packages to expedite project delivery.</p>\n<p>While these dependencies offer many benefits, they also introduce potential risks, such as <a href=\"https://www.cloudflare.com/en-gb/learning/security/what-is-remote-code-execution/\" target=\"_blank\" rel=\"noopener noreferrer\"><strong>remote code execution (RCE)</strong></a> vulnerabilities.</p>\n<p>To address these concerns, we will explore various strategies and tools designed to minimize local machine dependencies and establish replicable development environments.</p>\n<p>We will explore the specifics of <a href=\"https://earthly.dev/blog/repeatable-builds-every-time/\" target=\"_blank\" rel=\"noopener noreferrer\">modular Dockerfile builds</a>, <a href=\"https://containers.dev/\" target=\"_blank\" rel=\"noopener noreferrer\">Dev Containers</a>, <a href=\"https://nixos.wiki/wiki/Configuration_Collection\" target=\"_blank\" rel=\"noopener noreferrer\">Nix configurations</a>, and customization techniques!</p>\n<div class=\"important\">\n    <p><strong>‚ùó Important:</strong></p>\n    <p>This article serves as a follow-up to <a href=\"https://seifrajhi.github.io/blog/devcontainers-replicable-local-setup/\">my previous blog on DevContainers</a>, continuing the exploration of effective methods to mitigate dependency management challenges.</p>\n</div>\n<p>Let‚Äôs get started :)</p>\n<h2 id=\"optimize-developer-workflows-with-modular-docker-builds-and-devcontainer-integration\" style=\"position:relative;\"><a href=\"#optimize-developer-workflows-with-modular-docker-builds-and-devcontainer-integration\" aria-label=\"optimize developer workflows with modular docker builds and devcontainer integration permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Optimize Developer workflows with Modular Docker builds and Devcontainer integration</h2>\n<p>To maximize the effectiveness of containerized development environments, it is imperative to use <strong>modular Dockerfile structures</strong> and integrate <strong>dev container solutions</strong>.</p>\n<p>The provided <code class=\"language-text\">Dockerfile</code> snippet highlights a modular approach using a configurable base image, tailored specifically for <code class=\"language-text\">CUDA profiling</code> with <code class=\"language-text\">TensorFlow</code>.</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token comment\"># Make this Dockerfile modular by using a configurable base image</span>\nARG BASE_IMAGE\nFROM <span class=\"token variable\">${BASE_IMAGE}</span>\n<span class=\"token comment\"># For CUDA profiling, TensorFlow requires CUPTI.</span>\nENV LD_LIBRARY_PATH /usr/local/cuda/extras/CUPTI/lib64:/usr/local/cuda/lib64:<span class=\"token variable\">$LD_LIBRARY_PATH</span>\n<span class=\"token comment\"># Link the libcuda stub to the location where Tensorflow is searching for it and reconfigure</span>\n<span class=\"token comment\"># dynamic linker run-time bindings</span>\nRUN <span class=\"token function\">ln</span> <span class=\"token parameter variable\">-s</span> /usr/local/cuda/lib64/stubs/libcuda.so /usr/local/cuda/lib64/stubs/libcuda.so.1 <span class=\"token punctuation\">\\</span>\n  <span class=\"token operator\">&amp;&amp;</span> <span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"/usr/local/cuda/lib64/stubs\"</span> <span class=\"token operator\">></span> /etc/ld.so.conf.d/z-cuda-stubs.conf <span class=\"token punctuation\">\\</span>\n  <span class=\"token operator\">&amp;&amp;</span> ldconfig</code></pre></div>\n<p>While containerization brings many advantages, it does not inherently solve the issue of managing developer experience.</p>\n<p>Then check out DevContainer, a great tool that simplifies tasks like cache ordering and configuration management.</p>\n<p>Below is an example of a <code class=\"language-text\">DevContainer JSON configuration snippet</code> that illustrates its capabilities:</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\n<span class=\"token property\">\"image\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"mcr.microsoft.com/vscode/devcontainers/base:jammy\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"features\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"ghcr.io/devcontainers/features/node:1\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"ghcr.io/devcontainers/features/python:1\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>With DevContainer integrated into containerized environments, developers can enhance their workflow efficiency, reduce cognitive load, and focus on coding tasks without being hindered by setup complexities.</p>\n<p>This combination of containerization with tools like Docker and DevContainer not only boosts security and reproducibility but also elevates the overall developer experience, fostering a more productive and collaborative development environment across projects.</p>\n<p>Because we want to encourage cross-team collaboration, we want to standardize the tooling across teams as much as possible.</p>\n<p>Different language ecosystems will have different tools and we want to keep using those. You can't tell the frontend team not to use <code class=\"language-text\">package.json</code> / <code class=\"language-text\">npm</code> / <code class=\"language-text\">Yarn</code> etc‚Ää-‚Ääthat would be cumbersome for them. <em>So we're not touching the language-specific build layer.</em></p>\n<p>In addition, because we want to be able to iterate quickly when there are CI failures, we will containerize the build as much as possible. If the failure is part of a containerized script, then it will be easier to reproduce it locally.</p>\n<p>Three prominent approaches for achieving this include:</p>\n<ul>\n<li><strong>Makefile + Dockerfile:</strong> Using Makefiles as a collection of daily commands (e.g., <code class=\"language-text\">make build</code>, <code class=\"language-text\">make start</code>, <code class=\"language-text\">make package</code>, <code class=\"language-text\">make test</code>) complements Dockerfiles, keeping most of the build contained within containers.</li>\n<li><strong>bash + Dockerfile:</strong> Another alternative involves collecting scripts for everyday tasks within a dedicated directory (e.g.,¬†<code class=\"language-text\">./build</code>,¬†<code class=\"language-text\">./test</code>,¬†<code class=\"language-text\">./release</code>).</li>\n<li><strong>Bake + Dockerfile:</strong> Using <a href=\"https://github.com/SanderMertens/bake\" target=\"_blank\" rel=\"noopener noreferrer\">bake</a> as a collection of daily commands (e.g., <code class=\"language-text\">bake build</code>, <code class=\"language-text\">bake start</code>¬†, etc)¬†.</li>\n</ul>\n<p>All these approaches enable the quick reproduction of issues during Continuous Integration (CI) failures since the failing actions occur within containerized scripts.</p>\n<div class=\"note\">\n    <p><strong>üîµ Note:</strong></p>\n    <p><a href=\"https://github.com/tsuru/docker-nginx-with-modules\">Here</a>\n, you can find a project that contains a Dockerfile that allows you to create a custom Docker image with any number of additional dynamic modules, using makefile.\n</p>\n</div>\n<h2 id=\"simplifying-system-sependencies-with-nix-packagemanager\" style=\"position:relative;\"><a href=\"#simplifying-system-sependencies-with-nix-packagemanager\" aria-label=\"simplifying system sependencies with nix packagemanager permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Simplifying system sependencies with Nix Package¬†manager</h2>\n<p>While containerization and modular builds offer significant benefits, heavy system dependencies like OpenSSL, QEMU, and CUDA can still pose challenges.</p>\n<p>To address this issue, Nix‚Ää-‚Ääa Unix-like package manager‚Ää-‚Ääprovides a solution that is operating system-neutral, versioned, and reproducible.</p>\n<p>Nix can install virtually anything in a truly reproducible way, similar to <code class=\"language-text\">package-lock.json</code>, making it an ideal choice for managing system dependencies.</p>\n<p>The following example demonstrates how Nix can be used to simplify system dependencies:</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\n  inputs = <span class=\"token punctuation\">{</span>\n    nixpkgs.url = <span class=\"token string\">\"github:nixos/nixpkgs\"</span>;\n    devenv.url = <span class=\"token string\">\"github:cachix/devenv\"</span>;\n  <span class=\"token punctuation\">}</span>;\n\n  outputs = <span class=\"token punctuation\">{</span> nixpkgs<span class=\"token punctuation\">,</span> devenv<span class=\"token punctuation\">,</span> ... <span class=\"token punctuation\">}</span>@inputs<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    devShells = nixpkgs.lib.genAttrs nixpkgs.lib.platforms.unix (system<span class=\"token operator\">:</span>\n      let pkgs = import nixpkgs <span class=\"token punctuation\">{</span> inherit system; <span class=\"token punctuation\">}</span>; in <span class=\"token punctuation\">{</span>\n        default = devenv.lib.mkShell <span class=\"token punctuation\">{</span>\n          inherit inputs pkgs;\n          modules = <span class=\"token punctuation\">[</span>\n            <span class=\"token punctuation\">{</span>\n              pre-commit.hooks = <span class=\"token punctuation\">{</span>\n                eslint.enable = <span class=\"token boolean\">true</span>;\n                prettier.enable = <span class=\"token boolean\">true</span>;\n                black.enable = <span class=\"token boolean\">true</span>;\n                isort.enable = <span class=\"token boolean\">true</span>;\n              <span class=\"token punctuation\">}</span>;\n              packages = <span class=\"token punctuation\">[</span>\n                pkgs.python\n                pkgs.nodejs\n              <span class=\"token punctuation\">]</span>;\n            <span class=\"token punctuation\">}</span>\n          <span class=\"token punctuation\">]</span>;\n        <span class=\"token punctuation\">}</span>;\n      <span class=\"token punctuation\">}</span>\n    );\n  <span class=\"token punctuation\">}</span>;\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>By combining <code class=\"language-text\">Nix</code> with <code class=\"language-text\">[direnv](https://direnv.net/)</code> and the associated VSCode extension, changes made in the repository can be instantly reflected without rebuilding the entire container.</p>\n<p>To automatically switch nix shells when switching projects, you can do this by using <a href=\"https://github.com/nix-community/nix-direnv\" target=\"_blank\" rel=\"noopener noreferrer\">nix-direnv</a> and the <a href=\"https://marketplace.visualstudio.com/items?itemName=mkhl.direnv\" target=\"_blank\" rel=\"noopener noreferrer\">VSCode extension</a> direnv for integration. View the nix-direnv github page linked for a guide on setting it up.</p>\n<p>The¬†<code class=\"language-text\">.envrc</code> file below demonstrates how to create a development environment and predefine a Google Cloud project for convenience</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token comment\"># .envrc</span>\n<span class=\"token comment\"># Create the development environment</span>\nuse flake\n<span class=\"token comment\"># Predefine a Google Cloud project if not provided for convenience</span>\n<span class=\"token builtin class-name\">export</span> <span class=\"token assign-left variable\">GOOGLE_PROJECT_ID</span><span class=\"token operator\">=</span><span class=\"token variable\">${GOOGLE_PROJECT_ID<span class=\"token operator\">:-</span>foobar}</span>\n<span class=\"token comment\"># Fetch Google Application Credential from Vault</span>\n<span class=\"token keyword\">if</span> <span class=\"token punctuation\">[</span> <span class=\"token operator\">!</span> <span class=\"token parameter variable\">-f</span> key.json <span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span> <span class=\"token keyword\">then</span>\n  vault kv get <span class=\"token parameter variable\">-field</span><span class=\"token operator\">=</span>keyfile <span class=\"token variable\">$GOOGLE_PROJECT_ID</span> <span class=\"token operator\">></span> key.json\n<span class=\"token keyword\">fi</span></code></pre></div>\n<h2 id=\"more-customization-with-home-manager-and-dotfiles\" style=\"position:relative;\"><a href=\"#more-customization-with-home-manager-and-dotfiles\" aria-label=\"more customization with home manager and dotfiles permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>More customization with Home-Manager and Dotfiles</h2>\n<p><a href=\"https://nix-community.github.io/home-manager/\" target=\"_blank\" rel=\"noopener noreferrer\">Home-Manager</a> and <a href=\"https://www.webpro.nl/articles/getting-started-with-dotfiles\" target=\"_blank\" rel=\"noopener noreferrer\">Dotfiles</a> offer a wealth of possibilities for customizing and optimizing your development environment.</p>\n<p>Here are two lightweight examples to demonstrate the usage of these tools:</p>\n<h3 id=\"home-manager-example\" style=\"position:relative;\"><a href=\"#home-manager-example\" aria-label=\"home manager example permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Home-Manager example</h3>\n<p>Create a basic Home-Manager configuration file named <code class=\"language-text\">~/.config/homebrew/home.nix</code>:</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token punctuation\">{</span>\n  imports <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span>\n    <span class=\"token string\">\"./overrides.nix\"</span>\n  <span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\n  env.extraPackages <span class=\"token operator\">=</span> with pkgs<span class=\"token punctuation\">;</span> <span class=\"token punctuation\">[</span>\n    <span class=\"token function\">vim</span>\n    nodejs\n    <span class=\"token function\">yarn</span>\n  <span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\n  services.vscode <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token builtin class-name\">enable</span> <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span>\n    extraArgs <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"--user-data-dir=<span class=\"token environment constant\">$HOME</span>/.cache/code\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Then, define overrides in <code class=\"language-text\">~/.config/homebrew/overrides.nix</code>:</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token punctuation\">{</span>\n  vim.packages <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span>\n    pkgs.vimPlug // Install Vim Plugins\n  <span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>This example sets up a basic development environment with <code class=\"language-text\">Vim</code>, <code class=\"language-text\">NodeJS</code>, <code class=\"language-text\">Yarn</code>, and <code class=\"language-text\">VSCode</code> configured to store user data in <code class=\"language-text\">$HOME/.cache/code</code>.</p>\n<h3 id=\"dotfiles-example\" style=\"position:relative;\"><a href=\"#dotfiles-example\" aria-label=\"dotfiles example permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Dotfiles example</h3>\n<p>Create a <a href=\"https://github.com/ohmyzsh/ohmyzsh\" target=\"_blank\" rel=\"noopener noreferrer\">ZSH</a> configuration file named <code class=\"language-text\">~/.zshrc</code>:</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token comment\"># Enable plugins</span>\n<span class=\"token assign-left variable\">plugins</span><span class=\"token operator\">=</span><span class=\"token punctuation\">(</span>git z shocks<span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\"># Configure plugins</span>\n<span class=\"token builtin class-name\">source</span> <span class=\"token variable\"><span class=\"token variable\">$(</span>brew <span class=\"token parameter variable\">--prefix</span> zsh-syntax-highlighting<span class=\"token variable\">)</span></span>/zsh-syntax-highlighting/zsh-syntax-highlighting.zsh\nautoload <span class=\"token parameter variable\">-U</span> compinit <span class=\"token operator\">&amp;&amp;</span> compinit\n\n<span class=\"token comment\"># Alias</span>\n<span class=\"token builtin class-name\">alias</span> <span class=\"token assign-left variable\">ll</span><span class=\"token operator\">=</span><span class=\"token string\">'ls -lahG'</span>\n<span class=\"token builtin class-name\">alias</span> <span class=\"token assign-left variable\">grep</span><span class=\"token operator\">=</span><span class=\"token string\">'grep --color=auto'</span>\n<span class=\"token builtin class-name\">alias</span> <span class=\"token assign-left variable\">diff</span><span class=\"token operator\">=</span><span class=\"token string\">'diff --color'</span>\n<span class=\"token builtin class-name\">alias</span> <span class=\"token assign-left variable\">history</span><span class=\"token operator\">=</span><span class=\"token string\">\"fc -lr\"</span>\n\n<span class=\"token comment\"># Prompt</span>\n<span class=\"token assign-left variable\">ZSH_THEME</span><span class=\"token operator\">=</span><span class=\"token string\">\"robbyrussell\"</span>\n\n<span class=\"token comment\"># Color scheme</span>\n<span class=\"token assign-left variable\"><span class=\"token environment constant\">LS_COLORS</span></span><span class=\"token operator\">=</span><span class=\"token string\">\"di=34;46:ln=35;43:so=35;43:pi=35;43:ex=35;41:bd=43;34:cd=36;43:su=35;40:sg=36;40:tw=32;41:ow=33;42:st=37;44:\"</span></code></pre></div>\n<p>This example sets up a basic <code class=\"language-text\">ZSH configuration</code> with <strong>syntax highlighting</strong>, <strong>colorful output</strong>, <strong>useful aliases</strong>, and a <strong>custom prompt theme</strong>.</p>\n<h2 id=\"-final-thoughts\" style=\"position:relative;\"><a href=\"#-final-thoughts\" aria-label=\" final thoughts permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üìå Final thoughts</h2>\n<p>Using tools like Docker, Makefile, Nix, Direnv, Home-Manager, and <a href=\"https://www.webpro.nl/articles/getting-started-with-dotfiles\" target=\"_blank\" rel=\"noopener noreferrer\">Dotfiles</a> to create secure, reliable, and efficient development environments.</p>\n<p>Prioritize security measures and adapt to new developments to safeguard your digital assets and propel the software industry forward.</p>\n<p><strong><em>Until next time, „Å§„Å•„Åè üéâ üáµüá∏</em></strong></p>\n<p><br><br></p>\n<blockquote>\n<p>üí° Thank you for Reading !! üôåüèªüòÅüìÉ, see you in the next blog.ü§ò</p>\n</blockquote>\n<p>üöÄ Thank you for sticking up till the end. If you have any questions/feedback regarding this blog feel free to connect with me:</p>\n<p><strong>‚ôªÔ∏è LinkedIn:</strong> <a href=\"https://www.linkedin.com/in/rajhi-saif/\" target=\"_blank\" rel=\"noopener noreferrer\">https://www.linkedin.com/in/rajhi-saif/</a></p>\n<p><strong>‚ôªÔ∏è X/Twitter:</strong> <a href=\"https://x.com/rajhisaifeddine\" target=\"_blank\" rel=\"noopener noreferrer\">https://x.com/rajhisaifeddine</a></p>\n<p><strong>The end ‚úåüèª</strong></p>\n<h1 align=\"center\">üî∞ Keep Learning !! Keep Sharing !! üî∞</h1>\n<p><strong>References:</strong></p>\n<ul>\n<li><a href=\"https://nixos.wiki/wiki/Visual_Studio_Code\" target=\"_blank\" rel=\"noopener noreferrer\">Visual Studio Code and NixOS</a></li>\n<li><a href=\"https://nixos.wiki/wiki/Nix_Ecosystem\" target=\"_blank\" rel=\"noopener noreferrer\">Nix Ecosystem</a></li>\n<li><a href=\"https://code.visualstudio.com/docs/devcontainers/containers\" target=\"_blank\" rel=\"noopener noreferrer\">Dev Containers</a></li>\n<li><a href=\"https://containers.dev/overview\" target=\"_blank\" rel=\"noopener noreferrer\">DevContainers Overview</a></li>\n<li><a href=\"https://nix-community.github.io/home-manager/\" target=\"_blank\" rel=\"noopener noreferrer\">Nix Home Manager</a></li>\n</ul>\n<p><strong>üìÖ Stay updated</strong></p>\n<p>Subscribe to our newsletter for more insights on AWS cloud computing and containers.</p>","timeToRead":5,"rawMarkdownBody":"\n> **Isolated, shareable, and secure local setup strategies üî•**\n\n## üìö Introduction\n\nThe modern software development relies heavily upon external libraries, frameworks, and packages to expedite project delivery.\n\nWhile these dependencies offer many benefits, they also introduce potential risks, such as [**remote code execution (RCE)**](https://www.cloudflare.com/en-gb/learning/security/what-is-remote-code-execution/) vulnerabilities.\n\nTo address these concerns, we will explore various strategies and tools designed to minimize local machine dependencies and establish replicable development environments.\n\nWe will explore the specifics of [modular Dockerfile builds](https://earthly.dev/blog/repeatable-builds-every-time/), [Dev Containers](https://containers.dev/), [Nix configurations](https://nixos.wiki/wiki/Configuration_Collection), and customization techniques!\n\n<div class=\"important\">\n    <p><strong>‚ùó Important:</strong></p>\n    <p>This article serves as a follow-up to <a href=\"https://seifrajhi.github.io/blog/devcontainers-replicable-local-setup/\">my previous blog on DevContainers</a>, continuing the exploration of effective methods to mitigate dependency management challenges.</p>\n</div>\n\nLet‚Äôs get started :)\n\n## Optimize Developer workflows with Modular Docker builds and Devcontainer integration\n\nTo maximize the effectiveness of containerized development environments, it is imperative to use **modular Dockerfile structures** and integrate **dev container solutions**.\n\nThe provided `Dockerfile` snippet highlights a modular approach using a configurable base image, tailored specifically for `CUDA profiling` with `TensorFlow`.\n\n```shell\n# Make this Dockerfile modular by using a configurable base image\nARG BASE_IMAGE\nFROM ${BASE_IMAGE}\n# For CUDA profiling, TensorFlow requires CUPTI.\nENV LD_LIBRARY_PATH /usr/local/cuda/extras/CUPTI/lib64:/usr/local/cuda/lib64:$LD_LIBRARY_PATH\n# Link the libcuda stub to the location where Tensorflow is searching for it and reconfigure\n# dynamic linker run-time bindings\nRUN ln -s /usr/local/cuda/lib64/stubs/libcuda.so /usr/local/cuda/lib64/stubs/libcuda.so.1 \\\n  && echo \"/usr/local/cuda/lib64/stubs\" > /etc/ld.so.conf.d/z-cuda-stubs.conf \\\n  && ldconfig\n```\n\nWhile containerization brings many advantages, it does not inherently solve the issue of managing developer experience.\n\nThen check out DevContainer, a great tool that simplifies tasks like cache ordering and configuration management.\n\nBelow is an example of a `DevContainer JSON configuration snippet` that illustrates its capabilities:\n\n```json\n{\n\"image\": \"mcr.microsoft.com/vscode/devcontainers/base:jammy\",\n  \"features\": {\n    \"ghcr.io/devcontainers/features/node:1\": {},\n    \"ghcr.io/devcontainers/features/python:1\": {}\n  }\n}\n```\n\nWith DevContainer integrated into containerized environments, developers can enhance their workflow efficiency, reduce cognitive load, and focus on coding tasks without being hindered by setup complexities.\n\nThis combination of containerization with tools like Docker and DevContainer not only boosts security and reproducibility but also elevates the overall developer experience, fostering a more productive and collaborative development environment across projects.\n\nBecause we want to encourage cross-team collaboration, we want to standardize the tooling across teams as much as possible.\n\nDifferent language ecosystems will have different tools and we want to keep using those. You can't tell the frontend team not to use `package.json` / `npm` / `Yarn` etc‚Ää-‚Ääthat would be cumbersome for them. _So we're not touching the language-specific build layer._\n\nIn addition, because we want to be able to iterate quickly when there are CI failures, we will containerize the build as much as possible. If the failure is part of a containerized script, then it will be easier to reproduce it locally.\n\nThree prominent approaches for achieving this include:\n\n* **Makefile + Dockerfile:** Using Makefiles as a collection of daily commands (e.g., `make build`, `make start`, `make package`, `make test`) complements Dockerfiles, keeping most of the build contained within containers.\n* **bash + Dockerfile:** Another alternative involves collecting scripts for everyday tasks within a dedicated directory (e.g.,¬†`./build`,¬†`./test`,¬†`./release`).\n* **Bake + Dockerfile:** Using [bake](https://github.com/SanderMertens/bake) as a collection of daily commands (e.g., `bake build`, `bake start`¬†, etc)¬†.\n\nAll these approaches enable the quick reproduction of issues during Continuous Integration (CI) failures since the failing actions occur within containerized scripts.\n\n<div class=\"note\">\n    <p><strong>üîµ Note:</strong></p>\n    <p><a href=\"https://github.com/tsuru/docker-nginx-with-modules\">Here</a>\n, you can find a project that contains a Dockerfile that allows you to create a custom Docker image with any number of additional dynamic modules, using makefile.\n</p>\n</div>\n\n## Simplifying system sependencies with Nix Package¬†manager\n\nWhile containerization and modular builds offer significant benefits, heavy system dependencies like OpenSSL, QEMU, and CUDA can still pose challenges.\n\nTo address this issue, Nix‚Ää-‚Ääa Unix-like package manager‚Ää-‚Ääprovides a solution that is operating system-neutral, versioned, and reproducible.\n\nNix can install virtually anything in a truly reproducible way, similar to `package-lock.json`, making it an ideal choice for managing system dependencies.\n\nThe following example demonstrates how Nix can be used to simplify system dependencies:\n\n```json\n{\n  inputs = {\n    nixpkgs.url = \"github:nixos/nixpkgs\";\n    devenv.url = \"github:cachix/devenv\";\n  };\n\n  outputs = { nixpkgs, devenv, ... }@inputs: {\n    devShells = nixpkgs.lib.genAttrs nixpkgs.lib.platforms.unix (system:\n      let pkgs = import nixpkgs { inherit system; }; in {\n        default = devenv.lib.mkShell {\n          inherit inputs pkgs;\n          modules = [\n            {\n              pre-commit.hooks = {\n                eslint.enable = true;\n                prettier.enable = true;\n                black.enable = true;\n                isort.enable = true;\n              };\n              packages = [\n                pkgs.python\n                pkgs.nodejs\n              ];\n            }\n          ];\n        };\n      }\n    );\n  };\n}\n```\n\n\nBy combining `Nix` with `[direnv](https://direnv.net/)` and the associated VSCode extension, changes made in the repository can be instantly reflected without rebuilding the entire container.\n\nTo automatically switch nix shells when switching projects, you can do this by using [nix-direnv](https://github.com/nix-community/nix-direnv) and the [VSCode extension](https://marketplace.visualstudio.com/items?itemName=mkhl.direnv) direnv for integration. View the nix-direnv github page linked for a guide on setting it up.\n\nThe¬†`.envrc` file below demonstrates how to create a development environment and predefine a Google Cloud project for convenience\n\n```shell\n# .envrc\n# Create the development environment\nuse flake\n# Predefine a Google Cloud project if not provided for convenience\nexport GOOGLE_PROJECT_ID=${GOOGLE_PROJECT_ID:-foobar}\n# Fetch Google Application Credential from Vault\nif [ ! -f key.json ]; then\n  vault kv get -field=keyfile $GOOGLE_PROJECT_ID > key.json\nfi\n```\n\n## More customization with Home-Manager and Dotfiles\n\n[Home-Manager](https://nix-community.github.io/home-manager/) and [Dotfiles](https://www.webpro.nl/articles/getting-started-with-dotfiles) offer a wealth of possibilities for customizing and optimizing your development environment.\n\nHere are two lightweight examples to demonstrate the usage of these tools:\n\n### Home-Manager example\n\nCreate a basic Home-Manager configuration file named `~/.config/homebrew/home.nix`:\n\n```shell\n{\n  imports = [\n    \"./overrides.nix\"\n  ];\n\n  env.extraPackages = with pkgs; [\n    vim\n    nodejs\n    yarn\n  ];\n\n  services.vscode = {\n    enable = true;\n    extraArgs = [\"--user-data-dir=$HOME/.cache/code\"];\n  };\n}\n```\n\nThen, define overrides in `~/.config/homebrew/overrides.nix`:\n\n```shell\n{\n  vim.packages = [\n    pkgs.vimPlug // Install Vim Plugins\n  ];\n}\n```\n\nThis example sets up a basic development environment with `Vim`, `NodeJS`, `Yarn`, and `VSCode` configured to store user data in `$HOME/.cache/code`.\n\n### Dotfiles example\n\nCreate a [ZSH](https://github.com/ohmyzsh/ohmyzsh) configuration file named `~/.zshrc`:\n\n```shell\n# Enable plugins\nplugins=(git z shocks)\n\n# Configure plugins\nsource $(brew --prefix zsh-syntax-highlighting)/zsh-syntax-highlighting/zsh-syntax-highlighting.zsh\nautoload -U compinit && compinit\n\n# Alias\nalias ll='ls -lahG'\nalias grep='grep --color=auto'\nalias diff='diff --color'\nalias history=\"fc -lr\"\n\n# Prompt\nZSH_THEME=\"robbyrussell\"\n\n# Color scheme\nLS_COLORS=\"di=34;46:ln=35;43:so=35;43:pi=35;43:ex=35;41:bd=43;34:cd=36;43:su=35;40:sg=36;40:tw=32;41:ow=33;42:st=37;44:\"\n```\n\nThis example sets up a basic `ZSH configuration` with **syntax highlighting**, **colorful output**, **useful aliases**, and a **custom prompt theme**.\n\n## üìå Final thoughts\n\nUsing tools like Docker, Makefile, Nix, Direnv, Home-Manager, and [Dotfiles](https://www.webpro.nl/articles/getting-started-with-dotfiles) to create secure, reliable, and efficient development environments.\n\nPrioritize security measures and adapt to new developments to safeguard your digital assets and propel the software industry forward.\n\n**_Until next time, „Å§„Å•„Åè üéâ üáµüá∏_**\n\n<br><br>\n\n> üí° Thank you for Reading !! üôåüèªüòÅüìÉ, see you in the next blog.ü§ò  \n\nüöÄ Thank you for sticking up till the end. If you have any questions/feedback regarding this blog feel free to connect with me:\n\n**‚ôªÔ∏è LinkedIn:** https://www.linkedin.com/in/rajhi-saif/\n\n**‚ôªÔ∏è X/Twitter:** https://x.com/rajhisaifeddine\n\n**The end ‚úåüèª**\n\n<h1 align=\"center\">üî∞ Keep Learning !! Keep Sharing !! üî∞</h1>\n\n**References:**\n\n* [Visual Studio Code and NixOS](https://nixos.wiki/wiki/Visual_Studio_Code)\n* [Nix Ecosystem](https://nixos.wiki/wiki/Nix_Ecosystem)\n* [Dev Containers](https://code.visualstudio.com/docs/devcontainers/containers)\n* [DevContainers Overview](https://containers.dev/overview)\n* [Nix Home Manager](https://nix-community.github.io/home-manager/)\n  \n**üìÖ Stay updated**\n\nSubscribe to our newsletter for more insights on AWS cloud computing and containers.\n","wordCount":{"words":771},"frontmatter":{"id":"1e48fef829399cc6b9f3e30e","path":"/blog/replicable-local-development-environments/","humanDate":"Oct 15, 2024","fullDate":"2024-10-15","title":"Minimizing local machine dependencies with replicable development environments üìà","keywords":["NixOS","Isolation","Shareability","Security","Local Development","Cloud native","Devcontainer","Nix"],"excerpt":"Modular Docker builds, Devcontainer Integration,Nix Package Manager, Home-Manager, Dotfiles","cover":{"childImageSharp":{"gatsbyImageData":{"layout":"fullWidth","placeholder":{"fallback":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAADGUlEQVR42h2Q71PaBRzHv/7I0m2stbtWt8lqOgWEEIYCgalssNlAPQ8Wg8Qx5ZcoqLg0EG+61Ky5NopYdS2Xo/N0q4UT2+Z159mD9qRHPexJT3tW/8Crr3vwvvvc596f1+fzeQuyxVXUsSzqsZyo2zSO5lDO3sPcM4PRnsLUHMXcGMZsGMJgT2IS+w0zK8996oTo35M4X7+0js7/KYKjsoOO0tN4j3mZPHuNMeMkMe8N/K55xqJ3iPkzTAWyJBMrXPYu0SkuGL54nbg+QUL0JixpPEdcWA86UE18jbBXhFomGeleINGzSML1CdPdGT53LFO8vMluYJXd4TV2hn7hJ+dD5utucNWVJWJNE7JOM+FeYswxj88Qx3a4SwRK7Jx93c3o6SkiHWlS5zN8Y3rEQ+fvFPp2eNT3lAfn1ihcfMwD5w73rb9xt22TtD1D9N2rDJgnGTB9IF7YyR5LaDTOotEm0TUnsb96ibhhnVF9gfHmPW1xxVDkim6DcWOR6bqfWdz3HX22PKHIOqmlDbK5Da6Jr/o6x7EddYrAUx+iMsyg1E3y/vEYvvY1/O2PCZi2CJ8pEmwtMvD2FpdanzJR8z2jsnmkM3cJLhf4cirMf//8zb9//UmhsI3HEkfQyqMo1eM0aCawSSOMnMkzZNkm0rJN3PaEYesTBi1bYmbbROuW6VInaAteZ2A4STro5dnuM/5Y3WQj/ysBdwpBqYqjVInANwOcOuTEq8vha1qhV3OPPm3+ufyaH+jXruOqyWCpitB+IEDzUTf6BjfWd0J02aJ0OwZpre1E0Es6kNV5UFd7UJ0MIJeHUdZEUJ+I0qRKYVZM85Z0kBOyMKr6OA2KEaS1fuprIyiOB6h5o5eTUjcqyXmUil6EI1IHgqSJ/S/pkVZ1IJd4UEh60b7sR7nfxWsVbZSXqhDKZJRVNFJeqUOoUFJVaaR63znR24Pm8AXkqn6q5/IIJaEkpS1uSj76gtKFHAdv3ufQrR95JXWbFy6IIdt8lARTlHWFKXkvRllijvKPv6L8s28RFrIcmLvDsfY4L0ZnkVj6+R8UpMsvmNS1dgAAAABJRU5ErkJggg=="},"images":{"fallback":{"src":"/static/a68f9b0aebceadeb4f8a00a8beab101e/8d7bf/dev-env-cover.png","srcSet":"/static/a68f9b0aebceadeb4f8a00a8beab101e/00d8d/dev-env-cover.png 750w,\n/static/a68f9b0aebceadeb4f8a00a8beab101e/80b42/dev-env-cover.png 1080w,\n/static/a68f9b0aebceadeb4f8a00a8beab101e/d3351/dev-env-cover.png 1366w,\n/static/a68f9b0aebceadeb4f8a00a8beab101e/8d7bf/dev-env-cover.png 1600w","sizes":"100vw"},"sources":[{"srcSet":"/static/a68f9b0aebceadeb4f8a00a8beab101e/2ccd6/dev-env-cover.webp 750w,\n/static/a68f9b0aebceadeb4f8a00a8beab101e/cad7b/dev-env-cover.webp 1080w,\n/static/a68f9b0aebceadeb4f8a00a8beab101e/a7696/dev-env-cover.webp 1366w,\n/static/a68f9b0aebceadeb4f8a00a8beab101e/1abd8/dev-env-cover.webp 1600w","type":"image/webp","sizes":"100vw"}]},"width":1,"height":0.53375}}},"coverCredits":"Photo by Saifeddine Rajhi"}}},"pageContext":{"prevThought":{"frontmatter":{"path":"/blog/kubernetes-dns/","title":"Connecting the Dots: Understanding How Pods Talk in Kubernetes Networks","date":"2024-10-15 19:06:00"},"excerpt":"Kubernetes DNS Expeditionüî• üìö Introduction Kubernetes is an orchestration system for managing containerized applications. One of its key‚Ä¶"},"nextThought":{"frontmatter":{"path":"/blog/devcontainers-replicable-local-setup/","title":"Devcontainers: Minimizing local machine dependencies with replicable Setups","date":"2024-10-15 12:06:00"},"excerpt":"Building consistency in distributed teams üê≥üî• üìî Introduction Imagine being able to instantly recreate your entire development setup‚Ää-‚Ääno‚Ä¶"}}},"staticQueryHashes":["1271460761","1321585977"],"slicesMap":{}}