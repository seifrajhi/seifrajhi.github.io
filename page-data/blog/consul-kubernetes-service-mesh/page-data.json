{"componentChunkName":"component---src-templates-blog-template-js","path":"/blog/consul-kubernetes-service-mesh/","result":{"data":{"markdownRemark":{"html":"<blockquote>\n<p><strong>The Tech-Forward Approach to Service Discovery üîç</strong></p>\n</blockquote>\n<h2 id=\"-introduction\" style=\"position:relative;\"><a href=\"#-introduction\" aria-label=\" introduction permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üå† Introduction</h2>\n<p>Welcome to this blog post where I'll be sharing the fundamental concepts of Consul as a service mesh and discovery tool. Whether you're just starting out or looking to enhance your knowledge, this post will provide you with a head start on your journey.</p>\n<p><a href=\"https://www.consul.io/\" target=\"_blank\" rel=\"noopener noreferrer\">Consul</a> acts as a facilitator, allowing services to communicate smoothly. I'll simplify the complexities and guide you through the essential aspects of Consul, ensuring you have a solid understanding. So, let's dive in and explore the wonders of Consul together! üôå</p>\n<p><span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 56.470588235294116%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAAC/ElEQVR42iWTXWibVRjH3/ec98375rNL2qRJ+rXSpO2apm26j65Za7O1tc1qFjcY2kHCLqQbjM6yoZYirDJUqvamIGVt3ZRtTNkY1N3IFGUieqFXRVTwQvDCXTjBL4bI4OdTd/HwcODhd/7/8/yPYZh+DLMGQ7VIj2CqEMqqRzkN6GAaq34Au/EAVjyL03MEZ9chPB157O4CVksvdnMPVtcYZqQZ0xvG+B9mhqR8WHYE2wljeyPomjZ0fQ67dRhP9gierlHc/jKe3FM4IxW8XcP40gO42Un0zr2Y/hgq2LQNDIi6EOa2UsOR0gKvxWrM40mPiaoSbp8oy5Vxh6q4g8/g9JcwUyMY4VYM7UO54iyQxNTCMtW2TD9+f5jzLy6y8s4dTp9fxJMq4Ok7hvfgKYLFWcJTs4Sm5vAVnsPsO0qxeparyxu8fG6eUCwtDJ8Axam2a+VgMb9wkfc+h4Vr/3D9HsxcWMHYUyUwNc/4Kx8w8fpt6ibOYHQeZnj6LH/c+oJHG5/C1n3WNt4XRhitotusKP5gPW+uf8K5jT+5+/UD5tb+YunyR+jBKtEz19j86W8+/OE3kpVljK5jvDC/zCOZ//Wr7/j3x/t8f+8b3GCzwGQf2itUJ87iayus3oW5S7/zrlz8/KurGP0nCMxcpbj5M+NXtvAdXcJITTI2PcvDm1/ycP1j+PYXbty4I7AISolbHUxieGPEW9NcfGuV9c0tXnpjjeDuEvb+CoHSBbwnL+M8+za+/Ax26kl0fC+nZhf47NIt1pZW2ZnqF2AApetkwZEWzJoEmaFxhotl8k9PM1Su0DZaRfUex9lXwcmfxtlzErv9MEbiIKHGQXL7Jxgvn2CoMEky0Sbb3cHjxAhM7XoCT6wZXzSJG28j2H4ANzOJ1VlEt46gUyVUUwEzlkeF94mjbmoTObI9g3R29MpHEJeqQYASOys7is7IcE0c3dSNnexEJzLYkkGrYQBVl0VFd2PuyGGGOiTAGZS3XSAJAbhSQXm3xsfdDPMfJXJ0lHeahggAAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"consul\" title=\"\" src=\"/static/5ae45c5125b937e068f2c3aa95eb6258/c5bb3/consul.png\" srcset=\"/static/5ae45c5125b937e068f2c3aa95eb6258/04472/consul.png 170w,\n/static/5ae45c5125b937e068f2c3aa95eb6258/9f933/consul.png 340w,\n/static/5ae45c5125b937e068f2c3aa95eb6258/c5bb3/consul.png 680w,\n/static/5ae45c5125b937e068f2c3aa95eb6258/b12f7/consul.png 1020w,\n/static/5ae45c5125b937e068f2c3aa95eb6258/b5a09/consul.png 1360w,\n/static/5ae45c5125b937e068f2c3aa95eb6258/29007/consul.png 1600w\" sizes=\"(max-width: 680px) 100vw, 680px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n    </span>\n          </p>\n<h3 id=\"exploring-consuls-core-features-installation-configuration-and-service-discovery\" style=\"position:relative;\"><a href=\"#exploring-consuls-core-features-installation-configuration-and-service-discovery\" aria-label=\"exploring consuls core features installation configuration and service discovery permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Exploring Consul's Core Features: Installation, Configuration, and Service Discovery</h3>\n<p>In essence, Consul is a networking tool that serves multiple purposes. It functions as a <a href=\"https://en.wikipedia.org/wiki/Service_discovery\" target=\"_blank\" rel=\"noopener noreferrer\">service discovery</a> mechanism and enables the storage and retrieval of configuration values.</p>\n<p>Additionally, it offers <a href=\"https://developer.hashicorp.com/consul/docs/connect\" target=\"_blank\" rel=\"noopener noreferrer\">service-mesh</a> capabilities by managing and encrypting traffic between services. Although this may seem straightforward, in intricate and dynamic infrastructures spanning various locations, such as on-premises and cloud environments, it can become highly complex.</p>\n<p>Let's focus on the fundamentals and highlight three key aspects:</p>\n<ol>\n<li><strong>Installation on Kubernetes</strong></li>\n<li><strong>Utilizing the key-value store for configuration purposes</strong></li>\n<li><strong>Leveraging the service catalog to obtain service information</strong></li>\n</ol>\n<p>To demonstrate the practical usage of the Consul API, we will employ a small Go program. Let's begin our exploration.</p>\n<h3 id=\"prerequisites-\" style=\"position:relative;\"><a href=\"#prerequisites-\" aria-label=\"prerequisites  permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Prerequisites üèó</h3>\n<ul>\n<li>Kubernetes cluster</li>\n<li>Helm installed and configured</li>\n<li>Kubectl installed and configured</li>\n<li>Go installed</li>\n</ul>\n<h3 id=\"consul-setup\" style=\"position:relative;\"><a href=\"#consul-setup\" aria-label=\"consul setup permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Consul Setup</h3>\n<p>I intend to deploy Consul using the <a href=\"https://github.com/hashicorp/consul-k8s/tree/main/charts/consul\" target=\"_blank\" rel=\"noopener noreferrer\">Helm chart</a> provided. It's important to note that the installation I'm about to carry out is suitable for testing purposes only and should not be utilized in a production environment. When dealing with production setups, there are numerous additional considerations to take into account, such as certificates, storage size and class, and options for enabling or disabling certain features. However, it's worth mentioning that the Helm chart does include the installation of multiple servers and clients to ensure high availability.</p>\n<p>The chart supports multiple use cases of Consul on Kubernetes, depending on the values provided. Detailed installation instructions for Consul on Kubernetes are found <a href=\"https://www.consul.io/docs/k8s/installation/overview\" target=\"_blank\" rel=\"noopener noreferrer\">here</a>.</p>\n<p>Add the HashiCorp Helm repository:</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">helm repo <span class=\"token function\">add</span> hashicorp https://helm.releases.hashicorp.com</code></pre></div>\n<p>Ensure you have access to the Consul Helm chart and you see the latest chart version listed. If you have previously added the HashiCorp Helm repository, run:</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">helm repo update\nhelm search repo hashicorp/consul</code></pre></div>\n<p>Now you're ready to install Consul! To install Consul with the default configuration using Helm 3.2, run the following command below. This will create a Consul Kubernetes namespace if not already present, and install Consul on the dedicated namespace.</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">helm <span class=\"token function\">install</span> consul hashicorp/consul <span class=\"token parameter variable\">--set</span> <span class=\"token assign-left variable\">global.name</span><span class=\"token operator\">=</span>consul --create-namespace <span class=\"token parameter variable\">-n</span> consul</code></pre></div>\n<p>Please see the many options supported in the <code class=\"language-text\">values.yaml</code> file. These are also fully documented directly on the <a href=\"https://www.consul.io/docs/platform/k8s/helm.html\" target=\"_blank\" rel=\"noopener noreferrer\">Consul website</a>.</p>\n<p><span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 67.05882352941177%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAIAAAAmMtkJAAAACXBIWXMAAAsTAAALEwEAmpwYAAAC6ElEQVR42lWQW0hTcRzHT42SKBOnGYhdHoqgpy4PhfVQlj5EYBREUFKR1tKyOQ0zDROELis1odCyoMThNEsrE/JWOLt4azHnNre5zTkvZ207287/ds52Tid9qT+fl/+f/+fL7/ujxvaU22+1+odsMAwhIUEMIQhaJ0OX8oGigFfdjBaURC8Vi+eVkZLcYa1CZb+ylVPJ+EJZtFBGsXM+Ioo4GsXRiPfnlKn1i9Vu6Ox3pKWPph/xZJ5kz+QwNYoXVtVBoowRVZR4fZlQuFwCqVZQiOMgC2EIEFHwvBsalCu+7rvRcrkh63jTyWx95inLof2vilJXa44so6/IxOKVRLUiqIxxX40158VTCCCEsASEiA2GGZ3FdqFhdLOyIyG/cvv90xnacxkVI3lJtw8nHd1EaTJjPMo4Q27CuIRCTi2ZSzJggSgIotTC9ZtWf3QcU3/PqNbsLTFc3M2rd8yVbdOdWWnMWzeeIzfmyG1F8f/IAEKMoW0eTdEkwgGe8CwJ9Ojn8l+/TTswUR4nViUvXFtlzE2Yroj3Nsh97Yn/ywSHLZ7g4KThx1hfb+8CTQvi30E0tZXHUqknZ2VOdaxfm+j9kDT7Ptn1JuW/sSWiHC8EwLxntq2t7dnTp9NOJy+I1q91PY+2lWZvfF4a5+3aMNWa4tImuJrXUEsOkkAISLUxiSzWlq5Go7Gx8WVvn840UG9/vUs0pfu71js0sa6WtTOdO71jZVQ0wksHEh5iDgaYsM3MTI4HvTSHsRTB8byUbdKP/OqtQvoLzKcts/0nArZmEKIxL1ITVpfT6SE0zdsniF6HfnSj4W5WP8hMuwMBBrKs0NTkGNDZ3D4AMGQcCGNJQ5hDIEQ9r65rUT/sq681v230D/UQtwnOuFEwLG0BcHzQbAllZfmqa/xsWApCRPhbELIIcZATqY4Hd9sf3tHevdfxotHQ/c39uNtZ1QUYFmEi/cMcD+cXQP9nGF56WdwNIoj1EbfmD0diQqoMby+GAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"helm\" title=\"\" src=\"/static/dfade66a54963ee9344ec5b5c695cff2/c5bb3/helm.png\" srcset=\"/static/dfade66a54963ee9344ec5b5c695cff2/04472/helm.png 170w,\n/static/dfade66a54963ee9344ec5b5c695cff2/9f933/helm.png 340w,\n/static/dfade66a54963ee9344ec5b5c695cff2/c5bb3/helm.png 680w,\n/static/dfade66a54963ee9344ec5b5c695cff2/f4b77/helm.png 770w\" sizes=\"(max-width: 680px) 100vw, 680px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n    </span>\n          </p>\n<h3 id=\"connecting-to-the-consul-ui\" style=\"position:relative;\"><a href=\"#connecting-to-the-consul-ui\" aria-label=\"connecting to the consul ui permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Connecting to the Consul UI</h3>\n<p>The chart installs Consul in the <code class=\"language-text\">consul</code> namespace. You can run the following command to get to the UI:</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">kubectl port-forward services/consul-ui <span class=\"token number\">8080</span>:80 <span class=\"token parameter variable\">-n</span> consul</code></pre></div>\n<p>Then you access the UI on <a href=\"http://localhost:8080\" target=\"_blank\" rel=\"noopener noreferrer\">http://localhost:8080</a>. You will see the list of services depending on the Kubernetes services in your system. The services include Consul itself. Additionally, the Consul service is equipped with health checks. The remaining services displayed are Kubernetes services that were discovered by Consul. We will install Redis in the default namespace and make it accessible through a service named <code class=\"language-text\">redissvc</code>. Consequently, a Consul service called <code class=\"language-text\">redissvc-default</code> is generated. Later on, we will query this service from our Go application.</p>\n<p>By selecting <strong>Key/Value</strong>, you can view the configured keys. One of the keys I created is named <code class=\"language-text\">REDISPATTERN</code>, which is subsequently utilized in the Go program to determine the Redis channels to subscribe to. This key serves as a runtime configuration value.</p>\n<p><span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 51.17647058823529%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAIAAAA7N+mxAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA8klEQVR42mM4Wjn7UNnso1VzjlTOWlfav6No4pHymQeLp+3Lnbg/bxIutC9v0oGCKQxfvn67ee/xkxcvnzx/9uv37/+kAIZvX77cv3fv/r27QPj48eMnT548fUIAPH7y9NrNh58+fWI4dugwP78gGxsrBwcHGysrMYidjZ2BgWHVqlUMO3bsALIYGRkZiAZMTExAcuXKlVDNQD4j0YCZmZkaNu/cuYMRxCdKM9AOYOhANINsfvn6/fptR/YdOHoEBI4ewwuOHz9+6tQpIOPwoUNvXr9hePL236w9/24///f//+/ff/4RFb///v3/9fv/338A6bkTrW42e7MAAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"keys\" title=\"\" src=\"/static/a32caaeae2be5b9cb155c6fc2d03e8fc/c5bb3/keys.png\" srcset=\"/static/a32caaeae2be5b9cb155c6fc2d03e8fc/04472/keys.png 170w,\n/static/a32caaeae2be5b9cb155c6fc2d03e8fc/9f933/keys.png 340w,\n/static/a32caaeae2be5b9cb155c6fc2d03e8fc/c5bb3/keys.png 680w,\n/static/a32caaeae2be5b9cb155c6fc2d03e8fc/b12f7/keys.png 1020w,\n/static/a32caaeae2be5b9cb155c6fc2d03e8fc/1ac29/keys.png 1022w\" sizes=\"(max-width: 680px) 100vw, 680px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n    </span>\n          </p>\n<p>The Key/Value pair can be created via the Consul CLI, the HTTP API, or via the UI (Create button in the main Key/Value screen). I created the <code class=\"language-text\">REDISPATTERN</code> key via the Create button in the web UI.</p>\n<h3 id=\"discovering-consul-querying-the-keyvalue-store\" style=\"position:relative;\"><a href=\"#discovering-consul-querying-the-keyvalue-store\" aria-label=\"discovering consul querying the keyvalue store permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Discovering Consul: Querying the Key/Value Store</h3>\n<p>Now, let's focus on developing code that fetches a Consul key during runtime. The main question here is: 'How does your application discover Consul?'</p>\n<p><span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 85.29411764705883%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAARCAIAAABSJhvpAAAACXBIWXMAAAsTAAALEwEAmpwYAAACAklEQVR42oVTi47jIAzs///mNte05RHADx6BvSHJrlY6ndaqUjAeexib2+dv1nvfts05Z63FN8YYQvDet9Zuv4Jrrd651+t1X5Z1XZdleRtDRDnnGxLvX4Zk2I4xzvVp2KKOinyOgdAOT+9n3puIpMPAhw5DStADVWCYGWs4h+qodZSCb8+51zrBpRQgEQowFohTVQD4MGxBFTS66qw1xvygfikTjDpZtZWCUCgBInBggaRIZ4xBvv+CER2EnNIzeBeDCR4/l4Lu9WHeFp64BU4xbFQzl8ytaNZxgonZpPBI/u7euOSsrCqqpe+rfc+N6qwsEzBEGjwA5zzBARfNinxW6EkBxQOTp+QyvyXB71NECqEkTBJDYkoqF3gqxFSAFxJh72zYfNw8PMqMI2eMQAtnVXh6hCHPRRuC5terLH/qumKaOCVEFHS11BbiHiJ5j8bs29aJe0pgvie6BKMYK00XDnaihHnAhcFq30ctO5ofwhygGHE6W11LF/kSDJWJ3Lq6jw9QIGPY+2SMfz5f97uiVdaiaQ3NezzKujbn5pB89xmdhM6YKRTJpWCYQ4wYG7yDgGlBHQwmdHauHfWBHK1N8NH5w3qvzp3euT3+Gq56CLszV2uvOTkOL/BpmJtJ6cckAdYgBMQDmAiJvp/EP2A8r0OSn+mAv7jgPSDvV80T/BdesNl+/XBuswAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"app\" title=\"\" src=\"/static/0eeee77314397cbe7aa18746d0e74bb8/c5bb3/app.png\" srcset=\"/static/0eeee77314397cbe7aa18746d0e74bb8/04472/app.png 170w,\n/static/0eeee77314397cbe7aa18746d0e74bb8/9f933/app.png 340w,\n/static/0eeee77314397cbe7aa18746d0e74bb8/c5bb3/app.png 680w,\n/static/0eeee77314397cbe7aa18746d0e74bb8/b3ad9/app.png 909w\" sizes=\"(max-width: 680px) 100vw, 680px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n    </span>\n          </p>\n<h3 id=\"the-architecture-of-consul-server-and-client-agents\" style=\"position:relative;\"><a href=\"#the-architecture-of-consul-server-and-client-agents\" aria-label=\"the architecture of consul server and client agents permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>The Architecture of Consul: Server and Client Agents</h3>\n<p>In the above setup, the Consul server agents are deployed as a Kubernetes StatefulSet. Each server pod utilizes a volume, such as an Azure disk, to store data, including key/value pairs. However, your application won't directly connect to these server agents. Instead, it will connect through the client agents.</p>\n<p>The client agents are implemented as a DaemonSet, ensuring that there is a client agent running on each Kubernetes node. The client agent pods expose a static port on the Kubernetes host, allowing your application to connect to the IP address of the host it is running on. Your app can discover that IP address via the <a href=\"https://kubernetes.io/docs/tasks/inject-data-application/downward-api-volume-expose-pod-information/#the-downward-api\" target=\"_blank\" rel=\"noopener noreferrer\">Downward API</a>.</p>\n<p>The container spec contains the following code:</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">containers</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> realtimeapp\n        <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> rajhisaifeddine/realtime<span class=\"token punctuation\">-</span>go<span class=\"token punctuation\">-</span>consul<span class=\"token punctuation\">:</span>1.0.0\n        <span class=\"token key atrule\">env</span><span class=\"token punctuation\">:</span>\n            <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> HOST_IP\n                <span class=\"token key atrule\">valueFrom</span><span class=\"token punctuation\">:</span>\n                    <span class=\"token key atrule\">fieldRef</span><span class=\"token punctuation\">:</span>\n                        <span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> v1\n                        <span class=\"token key atrule\">fieldPath</span><span class=\"token punctuation\">:</span> status.hostIP\n            <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> CONSUL_HTTP_ADDR\n                <span class=\"token key atrule\">value</span><span class=\"token punctuation\">:</span> http<span class=\"token punctuation\">:</span>//$(HOST_IP)<span class=\"token punctuation\">:</span><span class=\"token number\">8500</span></code></pre></div>\n<p>The <code class=\"language-text\">HOST_IP</code> will be set to the IP of the Kubernetes host via a reference to <code class=\"language-text\">status.hostIP</code>. Next, the environment variable <code class=\"language-text\">CONSUL_HTTP_ADDR</code> is set to the full HTTP address including port 8500. In your code, you will need to read that environment variable.</p>\n<h3 id=\"fetching-a-keyvalue-pair\" style=\"position:relative;\"><a href=\"#fetching-a-keyvalue-pair\" aria-label=\"fetching a keyvalue pair permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Fetching a Key/Value Pair</h3>\n<p>Below is a code snippet in Go that demonstrates how to retrieve a key/value pair from Consul. You can find the complete source code <a href=\"https://github.com/hashicorp/consul\" target=\"_blank\" rel=\"noopener noreferrer\">here</a>.</p>\n<div class=\"gatsby-highlight\" data-language=\"go\"><pre class=\"language-go\"><code class=\"language-go\"><span class=\"token comment\">// return a Consul client based on given address</span>\n<span class=\"token keyword\">func</span> <span class=\"token function\">getConsul</span><span class=\"token punctuation\">(</span>address <span class=\"token builtin\">string</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">*</span>consulapi<span class=\"token punctuation\">.</span>Client<span class=\"token punctuation\">,</span> <span class=\"token builtin\">error</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    config <span class=\"token operator\">:=</span> consulapi<span class=\"token punctuation\">.</span><span class=\"token function\">DefaultConfig</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    config<span class=\"token punctuation\">.</span>Address <span class=\"token operator\">=</span> address\n    consul<span class=\"token punctuation\">,</span> err <span class=\"token operator\">:=</span> consulapi<span class=\"token punctuation\">.</span><span class=\"token function\">NewClient</span><span class=\"token punctuation\">(</span>config<span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">return</span> consul<span class=\"token punctuation\">,</span> err\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">// get key/value pair from Consul client and passed key name</span>\n<span class=\"token keyword\">func</span> <span class=\"token function\">getKvPair</span><span class=\"token punctuation\">(</span>client <span class=\"token operator\">*</span>consulapi<span class=\"token punctuation\">.</span>Client<span class=\"token punctuation\">,</span> key <span class=\"token builtin\">string</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">*</span>consulapi<span class=\"token punctuation\">.</span>KVPair<span class=\"token punctuation\">,</span> <span class=\"token builtin\">error</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    kv <span class=\"token operator\">:=</span> client<span class=\"token punctuation\">.</span><span class=\"token function\">KV</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    keyPair<span class=\"token punctuation\">,</span> <span class=\"token boolean\">_</span><span class=\"token punctuation\">,</span> err <span class=\"token operator\">:=</span> kv<span class=\"token punctuation\">.</span><span class=\"token function\">Get</span><span class=\"token punctuation\">(</span>key<span class=\"token punctuation\">,</span> <span class=\"token boolean\">nil</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">return</span> keyPair<span class=\"token punctuation\">,</span> err\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">func</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// retrieve address of Consul set via downward API in spec</span>\n    consulAddress <span class=\"token operator\">:=</span> <span class=\"token function\">getEnv</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"CONSUL_HTTP_ADDR\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">if</span> consulAddress <span class=\"token operator\">==</span> <span class=\"token string\">\"\"</span> <span class=\"token punctuation\">{</span>\n        log<span class=\"token punctuation\">.</span><span class=\"token function\">Fatalf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"CONSUL_HTTP_ADDRESS environment variable not set\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token comment\">// get Consul client</span>\n    consul<span class=\"token punctuation\">,</span> err <span class=\"token operator\">:=</span> <span class=\"token function\">getConsul</span><span class=\"token punctuation\">(</span>consulAddress<span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">if</span> err <span class=\"token operator\">!=</span> <span class=\"token boolean\">nil</span> <span class=\"token punctuation\">{</span>\n        log<span class=\"token punctuation\">.</span><span class=\"token function\">Fatalf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Error connecting to Consul: %s\"</span><span class=\"token punctuation\">,</span> err<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token comment\">// get key/value pair with Consul client</span>\n    redisPattern<span class=\"token punctuation\">,</span> err <span class=\"token operator\">:=</span> <span class=\"token function\">getKvPair</span><span class=\"token punctuation\">(</span>consul<span class=\"token punctuation\">,</span> <span class=\"token string\">\"REDISPATTERN\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">if</span> err <span class=\"token operator\">!=</span> <span class=\"token boolean\">nil</span> <span class=\"token operator\">||</span> redisPattern <span class=\"token operator\">==</span> <span class=\"token boolean\">nil</span> <span class=\"token punctuation\">{</span>\n        log<span class=\"token punctuation\">.</span><span class=\"token function\">Fatalf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Could not get REDISPATTERN: %s\"</span><span class=\"token punctuation\">,</span> err<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n    log<span class=\"token punctuation\">.</span><span class=\"token function\">Printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"KV: %v %s\\n\"</span><span class=\"token punctuation\">,</span> redisPattern<span class=\"token punctuation\">.</span>Key<span class=\"token punctuation\">,</span> redisPattern<span class=\"token punctuation\">.</span>Value<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>The comments in the code should be self-explanatory. When the <code class=\"language-text\">REDISPATTERN</code> key is not set or another error occurs, the program will exit. If <code class=\"language-text\">REDISPATTERN</code> is set, we can use the value later:</p>\n<div class=\"gatsby-highlight\" data-language=\"go\"><pre class=\"language-go\"><code class=\"language-go\">pubsub <span class=\"token operator\">:=</span> client<span class=\"token punctuation\">.</span><span class=\"token function\">PSubscribe</span><span class=\"token punctuation\">(</span><span class=\"token function\">string</span><span class=\"token punctuation\">(</span>redisPattern<span class=\"token punctuation\">.</span>Value<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></code></pre></div>\n<h3 id=\"looking-up-a-service\" style=\"position:relative;\"><a href=\"#looking-up-a-service\" aria-label=\"looking up a service permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Looking up a Service</h3>\n<p>That's great, but how do you look up an address of a service? That's easy with the following basic code via the catalog:</p>\n<div class=\"gatsby-highlight\" data-language=\"go\"><pre class=\"language-go\"><code class=\"language-go\">cat <span class=\"token operator\">:=</span> consul<span class=\"token punctuation\">.</span><span class=\"token function\">Catalog</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\nsvc<span class=\"token punctuation\">,</span> <span class=\"token boolean\">_</span><span class=\"token punctuation\">,</span> err <span class=\"token operator\">:=</span> cat<span class=\"token punctuation\">.</span><span class=\"token function\">Service</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"redissvc-default\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">nil</span><span class=\"token punctuation\">)</span>\nlog<span class=\"token punctuation\">.</span><span class=\"token function\">Printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Service address and port: %s:%d\\n\"</span><span class=\"token punctuation\">,</span> svc<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>ServiceAddress<span class=\"token punctuation\">,</span> svc<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>ServicePort<span class=\"token punctuation\">)</span></code></pre></div>\n<p><code class=\"language-text\">consul</code> is a <code class=\"language-text\">*consulapi.Client</code> obtained earlier. You use the <code class=\"language-text\">Catalog()</code> function to obtain access to the catalog service functionality. In this case, we simply retrieve the address and port value of the Kubernetes service <code class=\"language-text\">redissvc</code> in the default namespace. We can use that information to connect to our Redis back-end.</p>\n<h2 id=\"-wrap-up\" style=\"position:relative;\"><a href=\"#-wrap-up\" aria-label=\" wrap up permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üöÄ Wrap Up</h2>\n<p>Exploring the Service Mesh Galaxy, particularly through Consul on Kubernetes, opens up a world of possibilities for an efficient service mesh and discovery experience.</p>\n<p>By adopting a tech-forward approach to service discovery, organizations can overcome the challenges of a distributed and dynamic microservices environment. Its integration with Kubernetes empowers developers to leverage the full potential of service mesh capabilities. As we venture deeper into the realm of service mesh, Consul on Kubernetes stands as a powerful tool to navigate the vast expanse of interconnected services, ensuring a smooth and reliable journey for both developers and end-users.</p>","timeToRead":5,"rawMarkdownBody":"\n> **The Tech-Forward Approach to Service Discovery üîç**\n\n## üå† Introduction\n\nWelcome to this blog post where I'll be sharing the fundamental concepts of Consul as a service mesh and discovery tool. Whether you're just starting out or looking to enhance your knowledge, this post will provide you with a head start on your journey.\n\n[Consul](https://www.consul.io/) acts as a facilitator, allowing services to communicate smoothly. I'll simplify the complexities and guide you through the essential aspects of Consul, ensuring you have a solid understanding. So, let's dive in and explore the wonders of Consul together! üôå\n\n![consul](./consul.png)\n\n### Exploring Consul's Core Features: Installation, Configuration, and Service Discovery\n\nIn essence, Consul is a networking tool that serves multiple purposes. It functions as a [service discovery](https://en.wikipedia.org/wiki/Service_discovery) mechanism and enables the storage and retrieval of configuration values.\n\nAdditionally, it offers [service-mesh](https://developer.hashicorp.com/consul/docs/connect) capabilities by managing and encrypting traffic between services. Although this may seem straightforward, in intricate and dynamic infrastructures spanning various locations, such as on-premises and cloud environments, it can become highly complex.\n\nLet's focus on the fundamentals and highlight three key aspects:\n\n1. **Installation on Kubernetes**\n2. **Utilizing the key-value store for configuration purposes**\n3. **Leveraging the service catalog to obtain service information**\n\nTo demonstrate the practical usage of the Consul API, we will employ a small Go program. Let's begin our exploration.\n\n### Prerequisites üèó\n\n- Kubernetes cluster\n- Helm installed and configured\n- Kubectl installed and configured\n- Go installed\n\n### Consul Setup\n\nI intend to deploy Consul using the [Helm chart](https://github.com/hashicorp/consul-k8s/tree/main/charts/consul) provided. It's important to note that the installation I'm about to carry out is suitable for testing purposes only and should not be utilized in a production environment. When dealing with production setups, there are numerous additional considerations to take into account, such as certificates, storage size and class, and options for enabling or disabling certain features. However, it's worth mentioning that the Helm chart does include the installation of multiple servers and clients to ensure high availability.\n\nThe chart supports multiple use cases of Consul on Kubernetes, depending on the values provided. Detailed installation instructions for Consul on Kubernetes are found [here](https://www.consul.io/docs/k8s/installation/overview).\n\nAdd the HashiCorp Helm repository:\n\n```shell\nhelm repo add hashicorp https://helm.releases.hashicorp.com\n```\n\nEnsure you have access to the Consul Helm chart and you see the latest chart version listed. If you have previously added the HashiCorp Helm repository, run:\n\n```shell\nhelm repo update\nhelm search repo hashicorp/consul\n```\n\nNow you're ready to install Consul! To install Consul with the default configuration using Helm 3.2, run the following command below. This will create a Consul Kubernetes namespace if not already present, and install Consul on the dedicated namespace.\n\n```shell\nhelm install consul hashicorp/consul --set global.name=consul --create-namespace -n consul\n```\n\nPlease see the many options supported in the `values.yaml` file. These are also fully documented directly on the [Consul website](https://www.consul.io/docs/platform/k8s/helm.html).\n\n![helm](./helm.png)\n\n### Connecting to the Consul UI\n\nThe chart installs Consul in the `consul` namespace. You can run the following command to get to the UI:\n\n```shell\nkubectl port-forward services/consul-ui 8080:80 -n consul\n```\n\nThen you access the UI on [http://localhost:8080](http://localhost:8080). You will see the list of services depending on the Kubernetes services in your system. The services include Consul itself. Additionally, the Consul service is equipped with health checks. The remaining services displayed are Kubernetes services that were discovered by Consul. We will install Redis in the default namespace and make it accessible through a service named `redissvc`. Consequently, a Consul service called `redissvc-default` is generated. Later on, we will query this service from our Go application.\n\nBy selecting **Key/Value**, you can view the configured keys. One of the keys I created is named `REDISPATTERN`, which is subsequently utilized in the Go program to determine the Redis channels to subscribe to. This key serves as a runtime configuration value.\n\n![keys](./keys.png)\n\nThe Key/Value pair can be created via the Consul CLI, the HTTP API, or via the UI (Create button in the main Key/Value screen). I created the `REDISPATTERN` key via the Create button in the web UI.\n\n### Discovering Consul: Querying the Key/Value Store\n\nNow, let's focus on developing code that fetches a Consul key during runtime. The main question here is: 'How does your application discover Consul?'\n\n![app](./app.png)\n\n### The Architecture of Consul: Server and Client Agents\n\nIn the above setup, the Consul server agents are deployed as a Kubernetes StatefulSet. Each server pod utilizes a volume, such as an Azure disk, to store data, including key/value pairs. However, your application won't directly connect to these server agents. Instead, it will connect through the client agents.\n\nThe client agents are implemented as a DaemonSet, ensuring that there is a client agent running on each Kubernetes node. The client agent pods expose a static port on the Kubernetes host, allowing your application to connect to the IP address of the host it is running on. Your app can discover that IP address via the [Downward API](https://kubernetes.io/docs/tasks/inject-data-application/downward-api-volume-expose-pod-information/#the-downward-api).\n\nThe container spec contains the following code:\n\n```yaml\ncontainers:\n    - name: realtimeapp\n        image: rajhisaifeddine/realtime-go-consul:1.0.0\n        env:\n            - name: HOST_IP\n                valueFrom:\n                    fieldRef:\n                        apiVersion: v1\n                        fieldPath: status.hostIP\n            - name: CONSUL_HTTP_ADDR\n                value: http://$(HOST_IP):8500\n```\n\nThe `HOST_IP` will be set to the IP of the Kubernetes host via a reference to `status.hostIP`. Next, the environment variable `CONSUL_HTTP_ADDR` is set to the full HTTP address including port 8500. In your code, you will need to read that environment variable.\n\n### Fetching a Key/Value Pair\n\nBelow is a code snippet in Go that demonstrates how to retrieve a key/value pair from Consul. You can find the complete source code [here](https://github.com/hashicorp/consul).\n\n```go\n// return a Consul client based on given address\nfunc getConsul(address string) (*consulapi.Client, error) {\n    config := consulapi.DefaultConfig()\n    config.Address = address\n    consul, err := consulapi.NewClient(config)\n    return consul, err\n}\n\n// get key/value pair from Consul client and passed key name\nfunc getKvPair(client *consulapi.Client, key string) (*consulapi.KVPair, error) {\n    kv := client.KV()\n    keyPair, _, err := kv.Get(key, nil)\n    return keyPair, err\n}\n\nfunc main() {\n    // retrieve address of Consul set via downward API in spec\n    consulAddress := getEnv(\"CONSUL_HTTP_ADDR\", \"\")\n    if consulAddress == \"\" {\n        log.Fatalf(\"CONSUL_HTTP_ADDRESS environment variable not set\")\n    }\n\n    // get Consul client\n    consul, err := getConsul(consulAddress)\n    if err != nil {\n        log.Fatalf(\"Error connecting to Consul: %s\", err)\n    }\n\n    // get key/value pair with Consul client\n    redisPattern, err := getKvPair(consul, \"REDISPATTERN\")\n    if err != nil || redisPattern == nil {\n        log.Fatalf(\"Could not get REDISPATTERN: %s\", err)\n    }\n    log.Printf(\"KV: %v %s\\n\", redisPattern.Key, redisPattern.Value)\n}\n```\n\nThe comments in the code should be self-explanatory. When the `REDISPATTERN` key is not set or another error occurs, the program will exit. If `REDISPATTERN` is set, we can use the value later:\n\n```go\npubsub := client.PSubscribe(string(redisPattern.Value))\n```\n\n### Looking up a Service\n\nThat's great, but how do you look up an address of a service? That's easy with the following basic code via the catalog:\n\n```go\ncat := consul.Catalog()\nsvc, _, err := cat.Service(\"redissvc-default\", \"\", nil)\nlog.Printf(\"Service address and port: %s:%d\\n\", svc[0].ServiceAddress, svc[0].ServicePort)\n```\n\n`consul` is a `*consulapi.Client` obtained earlier. You use the `Catalog()` function to obtain access to the catalog service functionality. In this case, we simply retrieve the address and port value of the Kubernetes service `redissvc` in the default namespace. We can use that information to connect to our Redis back-end.\n\n## üöÄ Wrap Up\n\nExploring the Service Mesh Galaxy, particularly through Consul on Kubernetes, opens up a world of possibilities for an efficient service mesh and discovery experience.\n\nBy adopting a tech-forward approach to service discovery, organizations can overcome the challenges of a distributed and dynamic microservices environment. Its integration with Kubernetes empowers developers to leverage the full potential of service mesh capabilities. As we venture deeper into the realm of service mesh, Consul on Kubernetes stands as a powerful tool to navigate the vast expanse of interconnected services, ensuring a smooth and reliable journey for both developers and end-users.\n","wordCount":{"words":1046},"frontmatter":{"id":"384464547971f7b27e444dd3","path":"/blog/consul-kubernetes-service-mesh/","humanDate":"Oct 30, 2024","fullDate":"2024-10-30","title":"Explore the Service discovery: A Deep Dive into Consul on Kubernetes for Service Mesh and Discovery üîç","keywords":["Service Mesh","Consul","Kubernetes","k8s","Cloud-native","DevOps"],"excerpt":"Discover the tech-forward approach to service discovery with a deep dive into Consul on Kubernetes, exploring its role in service mesh and discovery.","cover":{"childImageSharp":{"gatsbyImageData":{"layout":"fullWidth","placeholder":{"fallback":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAAsTAAALEwEAmpwYAAADZUlEQVR42g2R20/TBwBGfw8by2TiHJsE5nTRcaliO4ITsC0BN64CBQu0k8ukLVSQlrbQllIsQgsdBUpxlHEpMBwoFCTcxDmFLMsWyXTxwSV7WhZN5r9x1ofzenLyfYJz9z8c26/o2nlNz+5reh+9wbf2jKEuMzedXQRudTDtqMdvrGHU3U2/y0mfw8rSSpj9P//i72dPePVig3+f3uHNyyUEg3WaZk8YXd899P1h7OM7TAUn6avKJD+/gI6ydCaMCoxtBszNWjotBppqq7DaOnHPbxGcmWE0GKQvMIN/dgXhhmmEFt8azaPbtAQ2aLnzHK9/glsmPVZTK0Mden5wm1lYXmVpfYOf9vYZ8Qdo1OlpDB2gHd/n2thjrrrD1DmnENoG5hn7zs/QVAh/YJBOXxCL1YnFbMNsbMdjNbE4YME74GWg38OAx409UmfTa7D5QjR75zANhjD55rG4hhFeTtey7i5FX3KB1tIsQpZyikqqGe0yMuZqY8HnYqVbwz1rGavOau46KvnRoWbaWs+ysYLJxmICegXO6xpG2q8j/LNkQpUnJfV4AooLEro0WuSZUpx6Nb8GOzjwt7DTLOO5XcoLRwRvFU8GmxlvKkGnqmHMG+KqsoETootUXrMibH87wmK3iwXXECsWHbO9vahVdTjrVezeyGerVky4RsJ6rYiftSk8+uYUm3UipnSleNudBCPCPs015OJErtT3RIRuLctOPWGXkQceA6vWCnb79Rz0KJj++hxbbTL2bHnsW3P4zZ7NA1Meg5dFzCrT2bRFpnDouGsqIdQkZcZcj6AslJOfJSEnPYXstCTKss/ze28ZSw1idLlpDDWV8ceil4fDFh7fdtLyZQbCW7GY5J8yofiMI4ePEhcbxyfxJ3k/Nh5BllNE7lfFyKTZnD0rRpv3BU9tGaSdjOd88mm+byxgrbeR+z0qwnY16oxUUj8+hu5iIsuqMxjkiTTkipEnHyfqcBxCUVExFeXlKBRXkOYWYq2UsaP/HMmJBDJTTnFTKeOXUTV7k7Xsekppy0nhUnICGrmIh7pzZJ1O4O1Dx4iOjuFITCxCdWUlSmUVboOK2+1VzLVeYlMnQp8tokCSSKEkiTlL5JxhNcO6XC6LkxCEGOyFYu43nOHQex8R9e5Rot6J5oMPE/gfjqQhWt5w918AAAAASUVORK5CYII="},"images":{"fallback":{"src":"/static/b3c1105766c84618b0a3e160716880a5/1e1a6/consul-service-cover.png","srcSet":"/static/b3c1105766c84618b0a3e160716880a5/2512b/consul-service-cover.png 750w,\n/static/b3c1105766c84618b0a3e160716880a5/1e1a6/consul-service-cover.png 1050w","sizes":"100vw"},"sources":[{"srcSet":"/static/b3c1105766c84618b0a3e160716880a5/80f13/consul-service-cover.webp 750w,\n/static/b3c1105766c84618b0a3e160716880a5/1d1da/consul-service-cover.webp 1050w","type":"image/webp","sizes":"100vw"}]},"width":1,"height":0.6}}},"coverCredits":"Photo by Saifeddine Rajhi"}}},"pageContext":{"prevThought":{"frontmatter":{"path":"/blog/openfaas-kubernetes-serverless/","title":"Discover the Potential of Serverless Computing with OpenFaaS and Kubernetes as Catalysts for Change üêã","date":"2024-10-30 18:30:00"},"excerpt":"OpenFaaS and Kubernetes: Orchestrating Serverless Symphony üé∂ üìá Overview OpenFaaS and Kubernetes are catalysts for change in the world of‚Ä¶","html":"<blockquote>\n<p><strong>OpenFaaS and Kubernetes: Orchestrating Serverless Symphony üé∂</strong></p>\n</blockquote>\n<h2 id=\"-overview\" style=\"position:relative;\"><a href=\"#-overview\" aria-label=\" overview permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üìá Overview</h2>\n<p>OpenFaaS and Kubernetes are catalysts for change in the world of serverless computing. Together, they enable organizations to scale new heights with efficiency and simplicity.</p>\n<p><a href=\"https://github.com/openfaas/faas\" target=\"_blank\" rel=\"noopener noreferrer\">OpenFaaS</a>, an open-source serverless platform, harmonizes perfectly with <a href=\"https://kubernetes.io/\" target=\"_blank\" rel=\"noopener noreferrer\">Kubernetes</a>, the renowned container orchestration system, to achieve the true potential of serverless computing. With OpenFaaS and Kubernetes, businesses can embrace the power of serverless computing and embark on a transformative journey toward a future of agility, scalability, and boundless possibilities.</p>\n<p><span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 41.76470588235294%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAIABQDASIAAhEBAxEB/8QAFwABAAMAAAAAAAAAAAAAAAAAAAIDBf/EABQBAQAAAAAAAAAAAAAAAAAAAAH/2gAMAwEAAhADEAAAAdS0SQH/xAAZEAABBQAAAAAAAAAAAAAAAAARAQISIjL/2gAIAQEAAQUCdq0kI//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8BP//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8BP//EABcQAQEBAQAAAAAAAAAAAAAAAAAxIWH/2gAIAQEABj8Crja//8QAGRABAAMBAQAAAAAAAAAAAAAAAQARITFh/9oACAEBAAE/IbJTB2C1zOQ0ZfE//9oADAMBAAIAAwAAABDwD//EABYRAAMAAAAAAAAAAAAAAAAAABARIf/aAAgBAwEBPxBUf//EABYRAQEBAAAAAAAAAAAAAAAAABEBEP/aAAgBAgEBPxBJn//EABwQAAICAgMAAAAAAAAAAAAAAAERACExUUFh0f/aAAgBAQABPxCmLAvyGdPtO6Xe4CIuQQQn/9k='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"openfaas-python\" title=\"\" src=\"/static/a24b0406ca9ebf8f36beed43ca55e2b1/7bf67/openfaas-python.jpg\" srcset=\"/static/a24b0406ca9ebf8f36beed43ca55e2b1/651be/openfaas-python.jpg 170w,\n/static/a24b0406ca9ebf8f36beed43ca55e2b1/d30a3/openfaas-python.jpg 340w,\n/static/a24b0406ca9ebf8f36beed43ca55e2b1/7bf67/openfaas-python.jpg 680w,\n/static/a24b0406ca9ebf8f36beed43ca55e2b1/990cb/openfaas-python.jpg 1020w,\n/static/a24b0406ca9ebf8f36beed43ca55e2b1/c44b8/openfaas-python.jpg 1360w,\n/static/a24b0406ca9ebf8f36beed43ca55e2b1/d165a/openfaas-python.jpg 1400w\" sizes=\"(max-width: 680px) 100vw, 680px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n    </span>\n          </p>\n<h2 id=\"-goals--objectives\" style=\"position:relative;\"><a href=\"#-goals--objectives\" aria-label=\" goals  objectives permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üî≠ Goals &#x26; Objectives</h2>\n<p>In this blog, we will explore the powerful combination of OpenFaaS and Kubernetes and explore how they are revolutionizing the world of serverless computing.</p>\n<div style=\"width:100%;height:0;padding-bottom:56%;position:relative;\"><iframe src=\"https://giphy.com/embed/cUpOMrVpmmLCF3rjyA\" width=\"100%\" height=\"100%\" style=\"position:absolute\" frameborder=\"0\" class=\"giphy-embed\" allowfullscreen></iframe></div>\n<h2 id=\"understanding-serverless-architecture-simplifying-code-execution-without-infrastructure\" style=\"position:relative;\"><a href=\"#understanding-serverless-architecture-simplifying-code-execution-without-infrastructure\" aria-label=\"understanding serverless architecture simplifying code execution without infrastructure permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Understanding Serverless Architecture: Simplifying Code Execution without Infrastructure</h2>\n<p>Serverless architecture refers to an innovative approach in which the core business logic is implemented as functions that can be executed in a stateless manner. Contrary to its name, serverless does not imply running code without servers; rather, it entails eliminating the need for manual hardware and infrastructure provisioning during the development process. In this model, the application still operates on servers, albeit ones that are managed by external service providers.</p>\n<p><a href=\"https://en.wikipedia.org/wiki/Function_as_a_service\" target=\"_blank\" rel=\"noopener noreferrer\">Function-as-a-Service (FaaS)</a> plays a big role in enabling serverless architecture. With FaaS, developers can focus solely on writing the functions that represent the specific business logic, without concerning themselves with the underlying infrastructure or server management. FaaS platforms, such as <a href=\"https://aws.amazon.com/lambda/\" target=\"_blank\" rel=\"noopener noreferrer\">AWS Lambda</a>, <a href=\"https://azure.microsoft.com/en-us/services/functions/\" target=\"_blank\" rel=\"noopener noreferrer\">Azure Functions</a>, or <a href=\"https://cloud.google.com/functions\" target=\"_blank\" rel=\"noopener noreferrer\">Google Cloud Functions</a>, allow developers to deploy their functions and execute them in response to specific events or triggers.</p>\n<p>The beauty of FaaS lies in its event-driven nature. Functions are executed only when a specific event occurs, such as an HTTP request, a file upload, or a database update. This event-driven approach brings several benefits. First, it enables auto-scaling, as the FaaS platform dynamically scales the execution environment based on the incoming workload. This ensures that the application can handle sudden spikes in traffic without any manual intervention.</p>\n<h2 id=\"exploring-openfaas-a-technical-overview-of-open-source-function-as-a-service\" style=\"position:relative;\"><a href=\"#exploring-openfaas-a-technical-overview-of-open-source-function-as-a-service\" aria-label=\"exploring openfaas a technical overview of open source function as a service permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Exploring OpenFaaS: A Technical Overview of Open-Source Function-as-a-Service</h2>\n<p><a href=\"https://docs.openfaas.com/\" target=\"_blank\" rel=\"noopener noreferrer\">OpenFaaS</a> is an open-source Function-as-a-Service (FaaS) platform that offers developers a flexible and scalable solution for building serverless applications. By leveraging containerization technology, OpenFaaS allows developers to package their functions into lightweight, independent containers that can be easily deployed and executed in a serverless environment. With OpenFaaS, developers have the freedom to write functions in any language of their choice, enabling a polyglot development approach.</p>\n<p>Under the hood, OpenFaaS relies on Docker and Kubernetes for container orchestration, providing robust scalability and high availability. The platform supports automatic scaling, allowing functions to handle varying workloads seamlessly. Additionally, OpenFaaS integrates with popular cloud providers, allowing developers to leverage existing cloud services and resources.</p>\n<h3 id=\"getting-hands-on-with-openfaas\" style=\"position:relative;\"><a href=\"#getting-hands-on-with-openfaas\" aria-label=\"getting hands on with openfaas permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Getting Hands-On with OpenFaaS</h3>\n<p>In this hands-on exploration of OpenFaaS, we will follow a straightforward process to deploy a Flask microservice as a serverless function. The steps involve setting up Kubernetes and OpenFaaS, dockerizing the Python application, creating a custom function, deploying the function, and finally, testing its functionality. This practical approach will provide a firsthand experience of leveraging OpenFaaS for serverless development. Let's start!</p>\n<h3 id=\"-setting-up-the-environment\" style=\"position:relative;\"><a href=\"#-setting-up-the-environment\" aria-label=\" setting up the environment permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>‚ùï Setting up the environment</h3>\n<p>Setting up Kubernetes and OpenFaas involves deploying OpenFaaS on either a local or remote Kubernetes cluster. In our case, we will utilize the EKS Kubernetes cluster to deploy OpenFaaS. The deployment of OpenFaaS can be accomplished using either Helm or arkade.</p>\n<p><a href=\"https://helm.sh/\" target=\"_blank\" rel=\"noopener noreferrer\">Helm</a> serves as a Kubernetes package and operations manager. Users can utilize Helm to publish their application configurations in the form of Charts.</p>\n<p>On the other hand, <a href=\"https://github.com/alexellis/arkade\" target=\"_blank\" rel=\"noopener noreferrer\">arkade</a> is a Go-based open-source CLI that simplifies app management. Internally, arkade leverages helm charts and kubectl to install applications onto the Kubernetes cluster.</p>\n<p>In this demo, we will use arkade to install OpenFaas as it is very easy and quick to use.</p>\n<h4 id=\"-install-arkade\" style=\"position:relative;\"><a href=\"#-install-arkade\" aria-label=\" install arkade permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>‚úÖ Install arkade</h4>\n<p>Use the following command to install arkade.</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token comment\"># Note: you can also run without `sudo` and move the binary yourself</span>\n<span class=\"token function\">curl</span> <span class=\"token parameter variable\">-sLS</span> https://get.arkade.dev <span class=\"token operator\">|</span> <span class=\"token function\">sudo</span> <span class=\"token function\">sh</span>\n\narkade <span class=\"token parameter variable\">--help</span>\nark <span class=\"token parameter variable\">--help</span>  <span class=\"token comment\"># a handy alias</span>\n\n<span class=\"token comment\"># Windows users with Git Bash</span>\n<span class=\"token function\">curl</span> <span class=\"token parameter variable\">-sLS</span> https://get.arkade.dev <span class=\"token operator\">|</span> <span class=\"token function\">sh</span></code></pre></div>\n<h4 id=\"-install-openfaas\" style=\"position:relative;\"><a href=\"#-install-openfaas\" aria-label=\" install openfaas permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>‚úÖ Install OpenFaas</h4>\n<p>Use arkade install to configure OpenFaaS with a cloud LoadBalancer, in this instance an \"ALB\" will be created.</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">arkade <span class=\"token function\">install</span> openfaas --load-balancer\n\n<span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">=</span>\n<span class=\"token operator\">=</span> OpenFaaS has been installed.                                        <span class=\"token operator\">=</span>\n<span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">=</span></code></pre></div>\n<p>To verify if the installation is successful we can execute the following command:</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">kubectl <span class=\"token parameter variable\">-n</span> openfaas get deployments <span class=\"token parameter variable\">-l</span> <span class=\"token assign-left variable\">release</span><span class=\"token operator\">=</span>openfaas,app<span class=\"token operator\">=</span>openfaas</code></pre></div>\n<p>Or to verify that openfaas has started, run:</p>\n<p><span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 137.05882352941177%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAbCAYAAAB836/YAAAACXBIWXMAAAsTAAALEwEAmpwYAAADcElEQVR42n1V6XriMAzkfQokJAQKJByBcENijgK9dtvt+z9B82k1ss3d/tBn55popNG4EA0W3/5wSeVoRU57ReW2WSMlUYoyvqeoyKvdI0pX1zYK3jD7DiZrak73VB8/UXN2oE72Rn6yJqejqNLDuqLq4In3G9kDyIs35PH1NWjBB+BUUXWiCGsNMVPkDxU5XUX14V5Au8s/9Dg6MNCWimFKDd7juhjeAuYACQyQgI/MC0y5ljBgd0299C81xs+S2a+A1REDzk9gdbNHeIMVZ8hZcYb91SeX5YX8/pYeGLA5eaHG5FnALwDdOMu9BB9z9M3KUeF9JeZ9byt1A/Vq/4lczhZ1AzDipobeIMtRq1KLIzxFjQFcBkI2PtetxdlVBxoA1KM5N45/cNNlp5vlbk+RRKwbgQeoFToLCfm8T9b/6HF8kGcABN1rME2ZASuGojfUK5oBMNAE3SDZUaw+qMV1Q9YNXvGseE+HAJTaJTpDEXT7BOgawL76FNpudyXNQYfvCrvcTvNyNyUn5m7xWopS/nMqIgYoPgJgsv66oBzws4fWUrp8PjWFYLjNw8UzhcsDtRZ7ClPW13RH7fk7xdkHhbNXyQbC7nAAzGYNBtCp1Js7LoA1BowWLwRQfIgs8GI4e2PQN9nXR3vqLN4FsGXo4rk84/BNAzXlTpo7PU0X6dvAuAWGMvSHbJvcWcw3QCGru5QhbD/Rs1sda/mUMHLDnQCgCfg42XxJGTCGKAOoX4+dzjDK8nJH3dWUtintOABHrSB0ZIz93S77iRZ2yfifDegPmWAakA3qhlHDhNS4IcFgJ+/cAsJtZtphAqYcwMZmELg2BsgH84uPsbeeGM1B+yf7mun6WV/E+GHkkAnooo6gBzDr1uH09Rc/nJ8B8opRRBY1MdfNERAO7RrHDjnDx3sZwm1qBkjoGucG5cBk6PCLkAioY34BgrrKPN/4YU93WWwrMhHaA0odvU/snzPUrr2Vn6HT+MklZXZsNEQMdXBpsNAm/1A+hsNgGuDUkA0ahp/g+lw+hQpTBk1QPh4DCx3Yo0EVQ1VWpmtPPtQ4YrFfAHqsQ9sMrLaGWJEhXtJSUUfJoEn2WMC8XwIiw7HR4eQUuJaDKjFAbXtGK+m0VQHEfwHIlHIYKw4kt28iNmGOBddMhHO1imeenSu4/x/qdsDEcWd6mgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"check\" title=\"\" src=\"/static/b1fc131591abb2f351333d71c30bf6f6/c5bb3/check.png\" srcset=\"/static/b1fc131591abb2f351333d71c30bf6f6/04472/check.png 170w,\n/static/b1fc131591abb2f351333d71c30bf6f6/9f933/check.png 340w,\n/static/b1fc131591abb2f351333d71c30bf6f6/c5bb3/check.png 680w,\n/static/b1fc131591abb2f351333d71c30bf6f6/b12f7/check.png 1020w,\n/static/b1fc131591abb2f351333d71c30bf6f6/b5a09/check.png 1360w,\n/static/b1fc131591abb2f351333d71c30bf6f6/29007/check.png 1600w\" sizes=\"(max-width: 680px) 100vw, 680px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n    </span>\n          </p>\n<p>To retrieve the admin password, run:</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token builtin class-name\">echo</span> <span class=\"token variable\"><span class=\"token variable\">$(</span>kubectl <span class=\"token parameter variable\">-n</span> openfaas get secret basic-auth <span class=\"token parameter variable\">-o</span> <span class=\"token assign-left variable\">jsonpath</span><span class=\"token operator\">=</span><span class=\"token string\">\"{.data.basic-auth-password}\"</span> <span class=\"token operator\">|</span> base64 <span class=\"token parameter variable\">--decode</span> <span class=\"token variable\">)</span></span></code></pre></div>\n<h4 id=\"-install-faas-cli\" style=\"position:relative;\"><a href=\"#-install-faas-cli\" aria-label=\" install faas cli permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>‚úÖ Install faas-cli</h4>\n<p>Once OpenFaas is installed, we must install faas-cli.</p>\n<p>The faas-cli is required to deploy and test functions with OpenFaas. Execute the following command to install faas-cli.</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token function\">curl</span> <span class=\"token parameter variable\">-SLsf</span> https://cli.openfaas.com <span class=\"token operator\">|</span> <span class=\"token function\">sudo</span> <span class=\"token function\">sh</span></code></pre></div>\n<p>If basic auth is enabled, you can now log into your gateway:</p>\n<p><span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 14.117647058823529%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAYAAACTWi8uAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAqElEQVR42k2KzQ6CMBAGeR0jfx5MoS3Fg5E2GEuBGIGo73807K0ma2mieJjMt5MNiFTvDdU2YtqGrLFbuvhLs8KbX4/4X+PGExXGxqK1AasHFJcHkmrAXE1uP5HVd8zk5G+P26QaXRuRn5ffK1LVY1b13vtjh7HoMCk7DJhqZ3JqIZMDUDVALm/A6wl2hxZSYSAtDSRiZemJaFzXztr9OBcaQq7nWJjXB7mMaWXbcY60AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"gateway\" title=\"\" src=\"/static/a8ddb1b7a87e7435b4c827c806f938eb/c5bb3/gateway.png\" srcset=\"/static/a8ddb1b7a87e7435b4c827c806f938eb/04472/gateway.png 170w,\n/static/a8ddb1b7a87e7435b4c827c806f938eb/9f933/gateway.png 340w,\n/static/a8ddb1b7a87e7435b4c827c806f938eb/c5bb3/gateway.png 680w,\n/static/a8ddb1b7a87e7435b4c827c806f938eb/b12f7/gateway.png 1020w,\n/static/a8ddb1b7a87e7435b4c827c806f938eb/b5a09/gateway.png 1360w,\n/static/a8ddb1b7a87e7435b4c827c806f938eb/29007/gateway.png 1600w\" sizes=\"(max-width: 680px) 100vw, 680px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n    </span>\n          </p>\n<p>Then Open UI and you will find it like below:</p>\n<p><span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 52.352941176470594%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAyUlEQVR42uWRwQqCQBCGff9HqA6BlyjoEL1FFNFFq0spnVpNd91dXVf/1MowhQiPDXwwzO5+M8Mao+kOQ9PCwLQxnuxhH33EsQZlCix6wlN4PgMhPjzPB/HC91lNiiCUMJRSUEpDZ0Ce5+CiebEUC6lxdgPMlzZmCxvWgUBWTZO2sJS8oswjnrS6R1zBvRCsty5WGwcn51rU4+4J8RGcq451kmIaASFkBStyynoJHw9oAWvQS/iN/xVmWQatdQ1lEiH9nfLXbwHHHa94A5YnJK8NAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"ui\" title=\"\" src=\"/static/e8c0926e810362dd6629886dad772b63/c5bb3/ui.png\" srcset=\"/static/e8c0926e810362dd6629886dad772b63/04472/ui.png 170w,\n/static/e8c0926e810362dd6629886dad772b63/9f933/ui.png 340w,\n/static/e8c0926e810362dd6629886dad772b63/c5bb3/ui.png 680w,\n/static/e8c0926e810362dd6629886dad772b63/b12f7/ui.png 1020w,\n/static/e8c0926e810362dd6629886dad772b63/b5a09/ui.png 1360w,\n/static/e8c0926e810362dd6629886dad772b63/29007/ui.png 1600w\" sizes=\"(max-width: 680px) 100vw, 680px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n    </span>\n          </p>\n<h3 id=\"flask-on-fire-dockerizing-the-python-application\" style=\"position:relative;\"><a href=\"#flask-on-fire-dockerizing-the-python-application\" aria-label=\"flask on fire dockerizing the python application permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Flask on Fire: Dockerizing the Python Application</h3>\n<p>In simpler words, dockerizing means using special containers called docker to package, deploy, and run applications.</p>\n<p>We will use docker to package and run the sample Flask application.</p>\n<h4 id=\"prepare-the-codebase\" style=\"position:relative;\"><a href=\"#prepare-the-codebase\" aria-label=\"prepare the codebase permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Prepare the Codebase</h4>\n<p>To set up the application, you can make a copy of my sample Python application project by running the provided command in any directory you prefer.</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token function\">git</span> clone https://github.com/seifrajhi/python-openfaas-demo</code></pre></div>\n<p>We will use this Flask application to be packaged into our docker image.</p>\n<h4 id=\"brief-explanation-of-the-dockerfile\" style=\"position:relative;\"><a href=\"#brief-explanation-of-the-dockerfile\" aria-label=\"brief explanation of the dockerfile permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Brief explanation of the Dockerfile</h4>\n<p>A Dockerfile is essentially a textual document that contains specific instructions on constructing a Docker image for our project.</p>\n<p><span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 45.294117647058826%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA20lEQVR42p2Sy3KDMAxFWeaBSYHExjZ+hWSmZSB9/f+f4bkxStvpsu7iLKTFsa6l4uouC7cBO3ZG+fRgfwjEd/1XWD2g4NItyo4QasZJjuAJZW8QekJZn7OlxVH4pdMDWvFMVM0Fh/ZKrC9mC3kXYqccjt0LZD9Tc1PahMOW+ezohdQ2SjOid+/QX1GNf4MfPlPvlabOEmrjo7YT+iSRZiahDR+ENDf6gixhy0OsGp8ieuyqlUBRt8xRnR254T7Wp4EmWZfAfk4gf8MkFCpEZSaKq1LE/2z29x3eAeu946Wf0tz5AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"Dockerfile\" title=\"\" src=\"/static/b6869ce620b072c4488ac49be021ab76/c5bb3/Dockerfile.png\" srcset=\"/static/b6869ce620b072c4488ac49be021ab76/04472/Dockerfile.png 170w,\n/static/b6869ce620b072c4488ac49be021ab76/9f933/Dockerfile.png 340w,\n/static/b6869ce620b072c4488ac49be021ab76/c5bb3/Dockerfile.png 680w,\n/static/b6869ce620b072c4488ac49be021ab76/b12f7/Dockerfile.png 1020w,\n/static/b6869ce620b072c4488ac49be021ab76/b5a09/Dockerfile.png 1360w,\n/static/b6869ce620b072c4488ac49be021ab76/29007/Dockerfile.png 1600w\" sizes=\"(max-width: 680px) 100vw, 680px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n    </span>\n          </p>\n<p>First, we need to create the image by using the Dockerfile.</p>\n<p><span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 10.588235294117647%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAACCAYAAABYBvyLAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAVUlEQVR42mOQVdb4yaei/odZVOMPizgEs0IxC4mYVULjDwOXgv4fbkXD/9wKBv85ZHT+8yoY/udXNAJjPiWj/zxKhv95lY3AmFtB/z9QI07MKqH5HwD7vjOMKdV/vgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"build\" title=\"\" src=\"/static/3f4186824ab37520cae8dc920cc619f6/c5bb3/build.png\" srcset=\"/static/3f4186824ab37520cae8dc920cc619f6/04472/build.png 170w,\n/static/3f4186824ab37520cae8dc920cc619f6/9f933/build.png 340w,\n/static/3f4186824ab37520cae8dc920cc619f6/c5bb3/build.png 680w,\n/static/3f4186824ab37520cae8dc920cc619f6/b12f7/build.png 1020w,\n/static/3f4186824ab37520cae8dc920cc619f6/b5a09/build.png 1360w,\n/static/3f4186824ab37520cae8dc920cc619f6/29007/build.png 1600w\" sizes=\"(max-width: 680px) 100vw, 680px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n    </span>\n          </p>\n<p>To verify the created image, you can use the following command:</p>\n<p><span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 10.588235294117647%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAACCAYAAABYBvyLAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAU0lEQVR42oWOXQqAMAyDa7u/thOkF/D+dxzEoXtT8OEjEEISOqOMCEHhDS0tmNDkB/5g+mSehx8V+6JHhaq8CrQxND9jVgXu6VabWSuM3tI8Q7gAPj4ql35VgKcAAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"verify\" title=\"\" src=\"/static/1bce9ba976387fa4d4510d4a325b4222/c5bb3/verify.png\" srcset=\"/static/1bce9ba976387fa4d4510d4a325b4222/04472/verify.png 170w,\n/static/1bce9ba976387fa4d4510d4a325b4222/9f933/verify.png 340w,\n/static/1bce9ba976387fa4d4510d4a325b4222/c5bb3/verify.png 680w,\n/static/1bce9ba976387fa4d4510d4a325b4222/b12f7/verify.png 1020w,\n/static/1bce9ba976387fa4d4510d4a325b4222/b5a09/verify.png 1360w,\n/static/1bce9ba976387fa4d4510d4a325b4222/29007/verify.png 1600w\" sizes=\"(max-width: 680px) 100vw, 680px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n    </span>\n          </p>\n<h3 id=\"pushing-docker-image-to-docker-hub\" style=\"position:relative;\"><a href=\"#pushing-docker-image-to-docker-hub\" aria-label=\"pushing docker image to docker hub permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Pushing Docker Image to Docker Hub</h3>\n<p>To upload the Docker image to Docker Hub, we can use the docker tag and docker push commands. This step enables us to create, test, store, and distribute container images through the Docker Hub platform.</p>\n<p><span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 12.941176470588234%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAYAAACTWi8uAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAVklEQVR42pXOsQ7AIAgEUBS1gFr//2uvymCXOnR4uRwhBBIJkECQ+BN/IzOG1YTqMszS7qbs2XpBbXlT4eNR8kN9Lt4FfVyebVmzySRCU4Dml8x++vAB0lQ/0p9Co5oAAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"push\" title=\"\" src=\"/static/75c080b1f01b5c43a8011cb969e4e536/c5bb3/push-dh.png\" srcset=\"/static/75c080b1f01b5c43a8011cb969e4e536/04472/push-dh.png 170w,\n/static/75c080b1f01b5c43a8011cb969e4e536/9f933/push-dh.png 340w,\n/static/75c080b1f01b5c43a8011cb969e4e536/c5bb3/push-dh.png 680w,\n/static/75c080b1f01b5c43a8011cb969e4e536/b12f7/push-dh.png 1020w,\n/static/75c080b1f01b5c43a8011cb969e4e536/b5a09/push-dh.png 1360w,\n/static/75c080b1f01b5c43a8011cb969e4e536/29007/push-dh.png 1600w\" sizes=\"(max-width: 680px) 100vw, 680px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n    </span>\n          </p>\n<p>Now, that the docker image is created, we can use this docker image to run the Flask application from anywhere we want.</p>\n<h3 id=\"building-a-serverless-function\" style=\"position:relative;\"><a href=\"#building-a-serverless-function\" aria-label=\"building a serverless function permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Building a Serverless Function</h3>\n<p>In the preceding stages, we used the arkade CLI to install OpenFaaS on a Kubernetes cluster.</p>\n<p>Now, we can generate a function using the OpenFaas template, which we can subsequently deploy within OpenFaas.</p>\n<p>Since we have a dockerized Flask application we will use the <a href=\"https://github.com/openfaas/templates\" target=\"_blank\" rel=\"noopener noreferrer\">dockerfile template of OpenFaas</a> to create our function as follows:</p>\n<p><span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 13.529411764705882%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAYAAACTWi8uAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAbUlEQVR42nWOzQ7DMAiDSdcCaUPS3+39n7MHz5OmaZccPgkbMIhquk3kttTHhz8efYx9qTGhPWfU3RFXRjsygvWyKuKgRz3bgDylH1zuIqWMeC0jahjidNRPyG4oTb+aB1bqTelxZnN4J5Qf4g3PUUBVR3ymTAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"create\" title=\"\" src=\"/static/778ec96f746ea37e8780bfc7be4855be/c5bb3/create.png\" srcset=\"/static/778ec96f746ea37e8780bfc7be4855be/04472/create.png 170w,\n/static/778ec96f746ea37e8780bfc7be4855be/9f933/create.png 340w,\n/static/778ec96f746ea37e8780bfc7be4855be/c5bb3/create.png 680w,\n/static/778ec96f746ea37e8780bfc7be4855be/b12f7/create.png 1020w,\n/static/778ec96f746ea37e8780bfc7be4855be/b5a09/create.png 1360w,\n/static/778ec96f746ea37e8780bfc7be4855be/29007/create.png 1600w\" sizes=\"(max-width: 680px) 100vw, 680px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n    </span>\n          </p>\n<p>Container images are used to store OpenFaas functions. In this case, we will use DockerHub as the repository for our image. Consequently, we will establish the environment variable <code class=\"language-text\">OPENFAAS_PREFIX</code> with the username associated with DockerHub.</p>\n<p><code class=\"language-text\">faas-cli new</code> enables us to create a new function via the dockerfile template in the current directory. Here, we have created a function called <code class=\"language-text\">sample-openfaas-demo</code> using the OpenFaas template dockerfile. After executing the above commands we will find that the following files were created:</p>\n<ul>\n<li><code class=\"language-text\">sample-openfaas-demo.yaml</code></li>\n<li><code class=\"language-text\">sample-openfaas-demo/Dockerfile</code></li>\n</ul>\n<p>We will now make the necessary changes to files in order to deploy our serverless logic.</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">version</span><span class=\"token punctuation\">:</span> <span class=\"token number\">1.0</span>\n<span class=\"token key atrule\">provider</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">gateway</span><span class=\"token punctuation\">:</span> http<span class=\"token punctuation\">:</span>//a55330be826824eefb8b679774fa42b2.eu<span class=\"token punctuation\">-</span>west<span class=\"token punctuation\">-</span>1.elb.amazonaws.com\n<span class=\"token key atrule\">functions</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">sample-flask-service</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">lang</span><span class=\"token punctuation\">:</span> dockerfile\n        <span class=\"token key atrule\">handler</span><span class=\"token punctuation\">:</span> ./dockerfile<span class=\"token punctuation\">-</span>sample/python<span class=\"token punctuation\">-</span>openfaas<span class=\"token punctuation\">-</span>demo\n        <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> rajhisaifeddine/python<span class=\"token punctuation\">-</span>openfaas<span class=\"token punctuation\">-</span>demo<span class=\"token punctuation\">:</span>latest\n        <span class=\"token key atrule\">environment</span><span class=\"token punctuation\">:</span>\n            <span class=\"token key atrule\">RAW_BODY</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">True</span>\n            <span class=\"token key atrule\">write_timeout</span><span class=\"token punctuation\">:</span> 30s\n            <span class=\"token key atrule\">read_timeout</span><span class=\"token punctuation\">:</span> 30s\n            <span class=\"token key atrule\">exec_timeout</span><span class=\"token punctuation\">:</span> 30s\n        <span class=\"token key atrule\">labels</span><span class=\"token punctuation\">:</span>\n         <span class=\"token key atrule\">com.openfaas.scale.min</span><span class=\"token punctuation\">:</span> <span class=\"token number\">1</span>\n         <span class=\"token key atrule\">com.openfaas.scale.max</span><span class=\"token punctuation\">:</span> <span class=\"token number\">5</span>\n         <span class=\"token key atrule\">com.openfaas.scale.zero</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"true\"</span></code></pre></div>\n<p>Then, we update the Dockerfile for our function.</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\">FROM ghcr.io/openfaas/classic<span class=\"token punctuation\">-</span>watchdog<span class=\"token punctuation\">:</span>0.2.1 as watchdog\n\nFROM rajhisaifeddine/python<span class=\"token punctuation\">-</span>openfaas<span class=\"token punctuation\">-</span>demo<span class=\"token punctuation\">:</span>latest\n\nRUN mkdir <span class=\"token punctuation\">-</span>p /home/app\n\nCOPY <span class=\"token punctuation\">-</span><span class=\"token punctuation\">-</span>from=watchdog /fwatchdog /usr/bin/fwatchdog\nRUN chmod +x /usr/bin/fwatchdog\n\n<span class=\"token comment\"># Add non root user</span>\nRUN addgroup <span class=\"token punctuation\">-</span>S app <span class=\"token important\">&amp;&amp;</span> adduser app <span class=\"token punctuation\">-</span>S <span class=\"token punctuation\">-</span>G app\nRUN chown app /home/app\n\nWORKDIR /home/app\n\nUSER app\n\nENV fprocess=\"python app.py\"\n\nENV upstream_url=\"http<span class=\"token punctuation\">:</span>//127.0.0.1<span class=\"token punctuation\">:</span>5000\"\nENV mode=\"http\"\nENV cgi_headers=\"true\"\n\n<span class=\"token comment\"># Set to true to see request in function logs</span>\nENV write_debug=\"false\"\n\nHEALTHCHECK <span class=\"token punctuation\">-</span><span class=\"token punctuation\">-</span>interval=3s CMD <span class=\"token punctuation\">[</span> <span class=\"token punctuation\">-</span>e /tmp/.lock <span class=\"token punctuation\">]</span> <span class=\"token punctuation\">|</span><span class=\"token punctuation\">|</span> exit 1\n\nCMD <span class=\"token punctuation\">[</span><span class=\"token string\">\"fwatchdog\"</span><span class=\"token punctuation\">]</span></code></pre></div>\n<div style=\"width:100%;height:0;padding-bottom:67%;position:relative;\"><iframe src=\"https://giphy.com/embed/drj2TRzBtDG6lx5le3\" width=\"100%\" height=\"100%\" style=\"position:absolute\" frameborder=\"0\" class=\"giphy-embed\" allowfullscreen></iframe></div>\n<h3 id=\"deploy-the-function\" style=\"position:relative;\"><a href=\"#deploy-the-function\" aria-label=\"deploy the function permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Deploy the Function</h3>\n<p>The function is now ready to be deployed. We can run the following command to deploy the function.</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">faas-cli up <span class=\"token parameter variable\">-f</span> sample-openfaas-demo.yaml</code></pre></div>\n<p>The above command will perform the following actions:</p>\n<ul>\n<li>Creates a local container image of the function.</li>\n<li>Pushes the image to the remote registry, which in our case is the docker hub.</li>\n<li>Using the OpenFaas REST API, creates a deployment inside Kubernetes Cluster and a new Pod to serve the traffic.</li>\n</ul>\n<h3 id=\"testing-the-function\" style=\"position:relative;\"><a href=\"#testing-the-function\" aria-label=\"testing the function permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Testing the Function</h3>\n<p>We have deployed our function as a Serverless function with autoscaling enabled in OpenFaas. Before proceeding to test our function we must set up monitoring of the process to understand how serverless actually works. For monitoring purposes, we can use <a href=\"https://grafana.com/\" target=\"_blank\" rel=\"noopener noreferrer\">Grafana</a>.</p>\n<p>We can easily install Grafana as a pod in Kubernetes Cluster using the below command:</p>\n<p><span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 13.529411764705882%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAYAAACTWi8uAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAe0lEQVR42lXOQQ6FIAwEUEAsFGsFY7z/PV2M1U/Id/EyQJsJjshfybshB8vgPm8f4S+7PP08Z6dCUE1YjwyphLJECM9Yd4Y2hrRkbKfllyhhsXtVRmObpwgrG9zZNpx1gxxWumfwHIwHp4Bi+OV7GuozmlCe3ehHmf0QN99oQEkqKXYHAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"grafana\" title=\"\" src=\"/static/5577d5b9088c601a832a44b5cd7e19cd/c5bb3/grafana.png\" srcset=\"/static/5577d5b9088c601a832a44b5cd7e19cd/04472/grafana.png 170w,\n/static/5577d5b9088c601a832a44b5cd7e19cd/9f933/grafana.png 340w,\n/static/5577d5b9088c601a832a44b5cd7e19cd/c5bb3/grafana.png 680w,\n/static/5577d5b9088c601a832a44b5cd7e19cd/b12f7/grafana.png 1020w,\n/static/5577d5b9088c601a832a44b5cd7e19cd/b5a09/grafana.png 1360w,\n/static/5577d5b9088c601a832a44b5cd7e19cd/29007/grafana.png 1600w\" sizes=\"(max-width: 680px) 100vw, 680px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n    </span>\n          </p>\n<p>Next, use port-forward from our local computer to access Grafana the URL:</p>\n<p><span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 10%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAACCAYAAABYBvyLAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAVklEQVR42oWNOw6AMAxDexCSLNA0SatO3P9ilQyFBcTA8OTPYKe9ythcQAtDRMDMNw//6n9I6jE0KjY1ZHNkD8xcajt9g4Wj9YC5YtUCa/1SIvqMzeMDYVc3/wUrk8QAAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"port-forward\" title=\"\" src=\"/static/6fe97391e1a22974cc4dda68405855be/c5bb3/port-forward.png\" srcset=\"/static/6fe97391e1a22974cc4dda68405855be/04472/port-forward.png 170w,\n/static/6fe97391e1a22974cc4dda68405855be/9f933/port-forward.png 340w,\n/static/6fe97391e1a22974cc4dda68405855be/c5bb3/port-forward.png 680w,\n/static/6fe97391e1a22974cc4dda68405855be/b12f7/port-forward.png 1020w,\n/static/6fe97391e1a22974cc4dda68405855be/b5a09/port-forward.png 1360w,\n/static/6fe97391e1a22974cc4dda68405855be/29007/port-forward.png 1600w\" sizes=\"(max-width: 680px) 100vw, 680px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n    </span>\n          </p>\n<p>Open the OpenFaas Grafana Dashboard from <a href=\"http://127.0.0.1:3000/\" target=\"_blank\" rel=\"noopener noreferrer\">http://127.0.0.1:3000/</a>. Enter the default password for Grafana, which is admin: admin. The OpenFaas Grafana Dashboard would look as follows:</p>\n<p><span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 35.29411764705882%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAAsTAAALEwEAmpwYAAAA1UlEQVR42nVQWw7CMAzrOYC+sm7ryvgA7n82k4Rl6ob4sKImbmLbPWbC8/VGaxXzNOLeGtcJNAwY/oCIsNSKdV1R54plqWgT8b8CF0OEv1wQvEe43ZBCQI4Rkd8G6fdvQU5JeTJTbDw35KwDgyy0pX2vf2uPF/R9Sl+eKyx/KoUbCZEbxAfkiCkRklwWRUVmzJcqfypHUySCTDoXlc4+2YKRCUI6WJaqasLuYB5HRe9KOO6c1Vd++slNrYVjLOcodOEe6oZ+ucFfr2wrqU1zs6va1Fs0H9G1wBunfOpbAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"dashboard\" title=\"\" src=\"/static/5940164c2d724d452a63848e3ae07cbc/c5bb3/dashboard.png\" srcset=\"/static/5940164c2d724d452a63848e3ae07cbc/04472/dashboard.png 170w,\n/static/5940164c2d724d452a63848e3ae07cbc/9f933/dashboard.png 340w,\n/static/5940164c2d724d452a63848e3ae07cbc/c5bb3/dashboard.png 680w,\n/static/5940164c2d724d452a63848e3ae07cbc/b12f7/dashboard.png 1020w,\n/static/5940164c2d724d452a63848e3ae07cbc/e996b/dashboard.png 1050w\" sizes=\"(max-width: 680px) 100vw, 680px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n    </span>\n          </p>\n<p>From the Dashboard, we can see that the number of replicas has increased to 1 from 0 to serve the request. This replica count will further increase depending on the load till the <code class=\"language-text\">com.openfaas.scale.max</code> specified previously.</p>\n<p>The way autoscaling works in the background is that the requests are blocked until the desired count of replicas is achieved. We can verify that from the gateway logs as follows:</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">kubectl logs <span class=\"token parameter variable\">-n</span> openfaas deploy/gateway <span class=\"token parameter variable\">-c</span> gateway <span class=\"token parameter variable\">-f</span></code></pre></div>\n<div style=\"width:100%;height:0;padding-bottom:67%;position:relative;\"><iframe src=\"https://giphy.com/embed/3o84U9arAYRM73AIvu\" width=\"100%\" height=\"100%\" style=\"position:absolute\" frameborder=\"0\" class=\"giphy-embed\" allowfullscreen></iframe></div>\n<h2 id=\"-wrap-up\" style=\"position:relative;\"><a href=\"#-wrap-up\" aria-label=\" wrap up permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üåü Wrap-up</h2>\n<p>The combination of OpenFaaS and Kubernetes has unlocked new possibilities in serverless computing. These powerful tools have acted as catalysts for change, enabling businesses to scale new heights in terms of efficiency and flexibility. By harnessing their potential, organizations can embrace the future of technology and revolutionize the way they deploy and manage applications. With OpenFaaS and Kubernetes orchestrating serverless environments, the sky's the limit for innovation and growth.</p>\n<br>\n<p><strong><em>Until next time, „Å§„Å•„Åè üéâ</em></strong></p>\n<blockquote>\n<p>üí° Thank you for Reading !! üôåüèªüòÅüìÉ, see you in the next blog.ü§ò  <strong><em>Until next time üéâ</em></strong></p>\n</blockquote>\n<p>üöÄ Thank you for sticking up till the end. If you have any questions/feedback regarding this blog feel free to connect with me:</p>\n<p><strong>‚ôªÔ∏è LinkedIn:</strong> <a href=\"https://www.linkedin.com/in/rajhi-saif/\" target=\"_blank\" rel=\"noopener noreferrer\">https://www.linkedin.com/in/rajhi-saif/</a></p>\n<p><strong>‚ôªÔ∏è X/Twitter:</strong> <a href=\"https://x.com/rajhisaifeddine\" target=\"_blank\" rel=\"noopener noreferrer\">https://x.com/rajhisaifeddine</a></p>\n<p><strong>The end ‚úåüèª</strong></p>\n<h1 align=\"center\">üî∞ Keep Learning !! Keep Sharing !! üî∞</h1>\n<p><strong>üìÖ Stay updated</strong></p>\n<p>Subscribe to our newsletter for more insights on AWS cloud computing and containers.</p>"},"nextThought":{"frontmatter":{"path":"/blog/kubernetes-rbac-privilege-escalation-mitigation/","title":"Kubernetes RBAC: Privilege Escalation Exploits and Mitigations üîí","date":"2024-10-29 21:30:00"},"excerpt":"RBAC: Mapping Out Privilege Escalation Routes üîí üéë Introduction Kubernetes, the open-source container orchestration system, has‚Ä¶","html":"<blockquote>\n<p><strong>RBAC: Mapping Out Privilege Escalation Routes üîí</strong></p>\n</blockquote>\n<h2 id=\"-introduction\" style=\"position:relative;\"><a href=\"#-introduction\" aria-label=\" introduction permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üéë Introduction</h2>\n<p>Kubernetes, the open-source container orchestration system, has revolutionized the world of container management. Its RBAC module ensures that only authorized entities can access cluster resources. However, as with any complex system, there are nuances to be explored, and certain permissions can inadvertently pave the way for privilege escalation.</p>\n<p>In this blog post, we will explore seven distinct privilege escalation threat vectors, empowered by specific permissions, including:</p>\n<ul>\n<li>Creating Pods</li>\n<li>Reading Secrets</li>\n<li>Binding Roles</li>\n<li>Escalating Existing Roles</li>\n<li>Impersonating Entities in the Cluster</li>\n</ul>\n<p>For each threat vector, we will provide a detailed explanation of how the exploit can be executed and discuss potential mitigations.</p>\n<div style=\"width:100%;height:0;padding-bottom:89%;position:relative;\"><iframe src=\"https://giphy.com/embed/ul1omlrGG6kpO\" width=\"100%\" height=\"100%\" style=\"position:absolute\" frameborder=\"0\" class=\"giphy-embed\" allowfullscreen></iframe></div>\n<h2 id=\"Ô∏è-pod-creation\" style=\"position:relative;\"><a href=\"#%EF%B8%8F-pod-creation\" aria-label=\"Ô∏è pod creation permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>‚ñ∂Ô∏è Pod Creation</h2>\n<p>Pods are the basic building blocks of Kubernetes clusters. Each pod contains at least one container, which runs an application. In other words, if you're using Kubernetes, you're using pods.</p>\n<p>While RBAC ensures that only authorized users can create pods, it doesn't control what they can put in their pod definitions. Without proper <a href=\"https://kubernetes.io/docs/reference/access-authn-authz/admission-controllers/\" target=\"_blank\" rel=\"noopener noreferrer\">admission control</a>, authorized users can create pods with arbitrary images, which can contain arbitrary privileges and configurations. This can lead to privilege escalation attacks.</p>\n<p><strong>Examples of Exploitation:</strong></p>\n<ul>\n<li>An attacker can create a pod with a malicious image that has root privileges, allowing them to gain root access to the Kubernetes node where the pod is running.</li>\n<li>An attacker can create a pod with an image that has the ability to escape the container and run arbitrary code on the Kubernetes node.</li>\n<li>An attacker can create a pod with an image that can exploit a vulnerability in the Kubernetes cluster, potentially gaining access to sensitive data or resources.</li>\n</ul>\n<p><strong>Mitigation Strategies:</strong></p>\n<ul>\n<li>Use <a href=\"https://kubernetes.io/docs/reference/access-authn-authz/admission-controllers/\" target=\"_blank\" rel=\"noopener noreferrer\">admission control</a> to restrict the types of pods that can be created.</li>\n<li>Implement security policies to restrict the privileges of pods.</li>\n<li>Scan container images for vulnerabilities before running them in production.</li>\n<li>Monitor your Kubernetes cluster for suspicious activity.</li>\n</ul>\n<h2 id=\"Ô∏è-mounting-a-service-account-token\" style=\"position:relative;\"><a href=\"#%EF%B8%8F-mounting-a-service-account-token\" aria-label=\"Ô∏è mounting a service account token permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>‚ñ∂Ô∏è Mounting a Service Account Token</h2>\n<p>Pods can be configured to <a href=\"https://kubernetes.io/docs/tasks/configure-pod-container/configure-service-account/#use-the-default-service-account-to-access-the-api-server\" target=\"_blank\" rel=\"noopener noreferrer\">mount the authorization token</a> for a service account within the same namespace. This means that an attacker could create a pod with a malicious image that steals the token from a high-privileged service account. The attacker could then use this token to perform API actions and escalate their privileges.</p>\n<p><strong>Mitigation Strategies:</strong></p>\n<ul>\n<li>Only mount service account tokens to pods that need them.</li>\n<li>Use security policies to restrict the privileges of pods.</li>\n</ul>\n<h2 id=\"Ô∏è-unauthorized-cluster-node-access-risks-and-mitigations\" style=\"position:relative;\"><a href=\"#%EF%B8%8F-unauthorized-cluster-node-access-risks-and-mitigations\" aria-label=\"Ô∏è unauthorized cluster node access risks and mitigations permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>‚ñ∂Ô∏è Unauthorized Cluster Node Access: Risks and Mitigations</h2>\n<p>If you allow entities to create highly privileged containers without comprehensive admission control, you are creating security vulnerabilities. This can result in the creation of vulnerable Pods that enable attackers to gain access to the corresponding container and potentially infiltrate the Cluster's underlying node.</p>\n<p><strong>Risks of Unauthorized Cluster Node Access:</strong></p>\n<ul>\n<li>An attacker typically follows a two-step process: gaining access to the container and then executing traditional container escape techniques. Such an attack can have severe consequences within Kubernetes environments.</li>\n<li>Access to any Cluster node is a significant breach. With node access, an attacker can leverage the container engine to access ServiceAccount tokens from other Pods on the same node, potentially compromising the security of the entire Cluster.</li>\n<li>Additionally, the attacker can search for application data and configuration files on the node, exposing critical parts of the Cluster. They can also identify and target unrelated network hosts and services like DNS Servers.</li>\n</ul>\n<p><strong>Mitigation Strategies:</strong></p>\n<ul>\n<li>Implement strict admission control.</li>\n<li>Continuous monitoring and auditing.</li>\n<li>Network segmentation and access control lists.</li>\n</ul>\n<h2 id=\"Ô∏è-secret-access-in-kubernetes-risks-and-mitigations\" style=\"position:relative;\"><a href=\"#%EF%B8%8F-secret-access-in-kubernetes-risks-and-mitigations\" aria-label=\"Ô∏è secret access in kubernetes risks and mitigations permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>‚ñ∂Ô∏è Secret Access in Kubernetes: Risks and Mitigations</h2>\n<p>It is important to grant the permission to read Secrets with caution, as it is a very powerful permission. In Kubernetes, Secrets can be used to store application-critical configuration data, as well as authorization tokens for ServiceAccounts.</p>\n<p><strong>Risks of Unauthorized Secret Access:</strong></p>\n<ul>\n<li>If an attacker is able to read Secrets, they could steal authorization tokens and essentially take over the corresponding ServiceAccounts. This could give them access to sensitive data, the ability to launch attacks against other nodes in the cluster, or disrupt the cluster's operations.</li>\n</ul>\n<p><strong>Mitigation Strategies:</strong></p>\n<ul>\n<li>Implement strict Role-Based Access Control (RBAC) policies to restrict who can read Secrets.</li>\n<li>Use a secrets management tool to encrypt Secrets at rest and in transit.</li>\n<li>Monitor for suspicious activity, such as a large number of failed attempts to read Secrets.</li>\n</ul>\n<h2 id=\"Ô∏è-impersonation-in-kubernetes\" style=\"position:relative;\"><a href=\"#%EF%B8%8F-impersonation-in-kubernetes\" aria-label=\"Ô∏è impersonation in kubernetes permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>‚ñ∂Ô∏è Impersonation in Kubernetes</h2>\n<p>Impersonation in Kubernetes is a mechanism that allows an entity to act as another entity while performing API requests. This can be useful for administrators to test configurations or troubleshoot problems. However, attackers can also use impersonation to gain unauthorized access to the Kubernetes cluster or its resources.</p>\n<p><strong>How Impersonation Works:</strong></p>\n<ul>\n<li>Impersonation is done by adding the <code class=\"language-text\">Impersonate-User</code> header to the API request. The value of the header is the name of the entity that the user wants to impersonate. Kubernetes first checks whether impersonation is allowed for the target entity. If it is, Kubernetes proceeds as if the impersonated entity made the request.</li>\n</ul>\n<p><strong>Impersonating Service Accounts:</strong></p>\n<ul>\n<li>To impersonate a service account, the <code class=\"language-text\">Impersonate-User</code> header must be set to the following value:\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">Impersonate-User: system:serviceaccount:&lt;namespace>:&lt;service-account-name></code></pre></div>\nFor example, to impersonate the default service account in the default namespace, the header would be set to:\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">Impersonate-User: system:serviceaccount:default:default</code></pre></div>\n</li>\n</ul>\n<p><strong>Risks of Impersonation:</strong></p>\n<ul>\n<li>Impersonation can be a very powerful tool for attackers. If an attacker is able to impersonate a privileged entity, they could gain access to sensitive data, delete resources, or disrupt the operation of the Kubernetes cluster.</li>\n</ul>\n<p><strong>Mitigation Strategies:</strong></p>\n<ul>\n<li>Implement strict Role-Based Access Control (RBAC) policies to restrict who can impersonate entities.</li>\n<li>Monitor for suspicious activity, such as a large number of failed attempts to impersonate entities.</li>\n<li>Educate users about the risks of impersonation and how to avoid them.</li>\n</ul>\n<h2 id=\"Ô∏è-rolebinding-permissions-in-kubernetes-implications-and-safeguards\" style=\"position:relative;\"><a href=\"#%EF%B8%8F-rolebinding-permissions-in-kubernetes-implications-and-safeguards\" aria-label=\"Ô∏è rolebinding permissions in kubernetes implications and safeguards permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>‚ñ∂Ô∏è Rolebinding Permissions in Kubernetes: Implications and Safeguards</h2>\n<p>The <code class=\"language-text\">bind</code> verb in Kubernetes allows an entity to assign a Role or ClusterRole to a subject (e.g., a user, group, or service account). This is a powerful permission, as it allows the entity to grant itself new permissions.</p>\n<p><strong>Binding Roles:</strong></p>\n<ul>\n<li>If an entity has the permission to create RoleBindings and the permission to bind Roles, it can assign arbitrary Roles to itself and elevate its privileges depending on the Roles available in the namespace in which these permissions are available.</li>\n</ul>\n<p><strong>Binding ClusterRoles within a Namespace:</strong></p>\n<ul>\n<li>If an entity has the permission to create RoleBindings and the permission to bind ClusterRoles, it can bind the permissions of a ClusterRole to the respective namespace. This is generally a greater privilege escalation than the first variant, as it allows the entity to gain the permissions of any ClusterRole, regardless of which namespace it is defined in.</li>\n</ul>\n<p><strong>Binding ClusterRoles Cluster-wide:</strong></p>\n<ul>\n<li>Finally, if an entity has the permission to create ClusterRoleBindings and the permission to bind ClusterRoles, it can gain the highest possible permissions within the Cluster by binding the permissions of the most privileged entities within the <code class=\"language-text\">kube-system</code> namespace to itself.</li>\n</ul>\n<p><strong>Risks of Binding Roles and ClusterRoles:</strong></p>\n<ul>\n<li>If an attacker gains the permission to bind Roles or ClusterRoles, they could elevate their privileges and gain access to sensitive data or disrupt the operation of the Kubernetes cluster.</li>\n</ul>\n<h2 id=\"mitigation-strategies\" style=\"position:relative;\"><a href=\"#mitigation-strategies\" aria-label=\"mitigation strategies permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Mitigation Strategies</h2>\n<ul>\n<li>Implement strict Role-Based Access Control (RBAC) policies to restrict who can bind Roles and ClusterRoles.</li>\n<li>Monitor for suspicious activity, such as a large number of attempts to bind Roles or ClusterRoles.</li>\n<li>Educate users about the risks of binding Roles and ClusterRoles and how to avoid them.</li>\n</ul>\n<p>üìí <strong>Privilege Escalation Prevention and Bootstrapping</strong></p>\n<p>The RBAC API prevents users from escalating privileges by editing roles or role bindings. Because this is enforced at the API level, it applies even when the RBAC authorizer is not in use.</p>\n<p>üìí <strong>Restrictions on Role Creation or Update</strong></p>\n<p>You can only create/update a role if at least one of the following conditions is true:</p>\n<ul>\n<li><strong>You already have all the permissions contained in the role</strong>, at the same scope as the object being modified (cluster-wide for a ClusterRole, within the same namespace or cluster-wide for a Role).</li>\n<li><strong>You are granted explicit permission</strong> to perform the <code class=\"language-text\">escalate</code> verb on the roles or clusterroles resource in the <code class=\"language-text\">rbac.authorization.k8s.io</code> API group.</li>\n</ul>\n<p>For example, if <code class=\"language-text\">user-1</code> does not have the ability to list Secrets cluster-wide, they cannot create a ClusterRole containing that permission. To allow a user to create/update roles:</p>\n<ol>\n<li><strong>Grant them a role</strong> that allows them to create/update Role or ClusterRole objects, as desired.</li>\n<li><strong>Grant them permission</strong> to include specific permissions in the roles they create/update:\n<ul>\n<li><strong>Implicitly</strong>, by giving them those permissions (if they attempt to create or modify a Role or ClusterRole with permissions they themselves have not been granted, the API request will be forbidden).</li>\n<li><strong>Explicitly</strong>, by giving them permission to perform the <code class=\"language-text\">escalate</code> verb on roles or clusterroles resources in the <code class=\"language-text\">rbac.authorization.k8s.io</code> API group.</li>\n</ul>\n</li>\n</ol>\n<p>For more details, refer to the <a href=\"https://kubernetes.io/docs/reference/access-authn-authz/rbac/\" target=\"_blank\" rel=\"noopener noreferrer\">Kubernetes RBAC documentation</a>.</p>\n<p>üìí <strong>Restrictions on Role Binding Creation or Update</strong></p>\n<p>You can only create/update a role binding if you already have all the permissions contained in the referenced role (at the same scope as the role binding) or if you have been authorized to perform the <code class=\"language-text\">bind</code> verb on the referenced role.</p>\n<p>For example, if <code class=\"language-text\">user-1</code> does not have the ability to list Secrets cluster-wide, they cannot create a <code class=\"language-text\">ClusterRoleBinding</code> to a role that grants that permission.</p>\n<p>To allow a user to create/update role bindings:</p>\n<ol>\n<li><strong>Grant them a role</strong> that allows them to create/update <code class=\"language-text\">RoleBinding</code> or <code class=\"language-text\">ClusterRoleBinding</code> objects, as desired.</li>\n<li><strong>Grant them permissions needed to bind a particular role:</strong>\n<ul>\n<li><strong>Implicitly</strong>, by giving them the permissions contained in the role.</li>\n<li><strong>Explicitly</strong>, by giving them permission to perform the <code class=\"language-text\">bind</code> verb on the particular Role (or ClusterRole).</li>\n</ul>\n</li>\n</ol>\n<p>For more details, refer to the <a href=\"https://kubernetes.io/docs/reference/access-authn-authz/rbac/\" target=\"_blank\" rel=\"noopener noreferrer\">Kubernetes RBAC documentation</a>.</p>\n<p>For example, this ClusterRole and RoleBinding would allow user-1 to grant other users the admin, edit, and view roles in the namespace user-1-namespace:</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> rbac.authorization.k8s.io/v1\n<span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> ClusterRole\n<span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> role<span class=\"token punctuation\">-</span>grantor\n<span class=\"token key atrule\">rules</span><span class=\"token punctuation\">:</span>\n<span class=\"token punctuation\">-</span> <span class=\"token key atrule\">apiGroups</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"rbac.authorization.k8s.io\"</span><span class=\"token punctuation\">]</span>\n  <span class=\"token key atrule\">resources</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"rolebindings\"</span><span class=\"token punctuation\">]</span>\n  <span class=\"token key atrule\">verbs</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"create\"</span><span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">-</span> <span class=\"token key atrule\">apiGroups</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"rbac.authorization.k8s.io\"</span><span class=\"token punctuation\">]</span>\n  <span class=\"token key atrule\">resources</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"clusterroles\"</span><span class=\"token punctuation\">]</span>\n  <span class=\"token key atrule\">verbs</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"bind\"</span><span class=\"token punctuation\">]</span>\n  <span class=\"token comment\"># omit resourceNames to allow binding any ClusterRole</span>\n  <span class=\"token key atrule\">resourceNames</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"admin\"</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"edit\"</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"view\"</span><span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">---</span>\n<span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> rbac.authorization.k8s.io/v1\n<span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> RoleBinding\n<span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> role<span class=\"token punctuation\">-</span>grantor<span class=\"token punctuation\">-</span>binding\n  <span class=\"token key atrule\">namespace</span><span class=\"token punctuation\">:</span> user<span class=\"token punctuation\">-</span>1<span class=\"token punctuation\">-</span>namespace\n<span class=\"token key atrule\">roleRef</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">apiGroup</span><span class=\"token punctuation\">:</span> rbac.authorization.k8s.io\n  <span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> ClusterRole\n  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> role<span class=\"token punctuation\">-</span>grantor\n<span class=\"token key atrule\">subjects</span><span class=\"token punctuation\">:</span>\n<span class=\"token punctuation\">-</span> <span class=\"token key atrule\">apiGroup</span><span class=\"token punctuation\">:</span> rbac.authorization.k8s.io\n  <span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> User\n  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> user<span class=\"token punctuation\">-</span><span class=\"token number\">1</span></code></pre></div>\n<p><strong>üìú Bootstrapping Initial Roles and Role Bindings</strong></p>\n<p>When bootstrapping the first roles and role bindings, it is necessary for the initial user to grant permissions they do not yet have. To bootstrap initial roles and role bindings:</p>\n<ul>\n<li><strong>Use a credential with the <code class=\"language-text\">system:masters</code> group</strong>, which is bound to the <code class=\"language-text\">cluster-admin</code> super-user role by the default bindings.</li>\n</ul>\n<p>For more details, refer to the <a href=\"https://kubernetes.io/docs/reference/access-authn-authz/rbac/\" target=\"_blank\" rel=\"noopener noreferrer\">Kubernetes RBAC documentation</a>.</p>\n<h2 id=\"-conclusion\" style=\"position:relative;\"><a href=\"#-conclusion\" aria-label=\" conclusion permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üèÅ Conclusion</h2>\n<p>In this blog post, we have discussed three of the most common security threats to Kubernetes environments:</p>\n<ul>\n<li><strong>Unauthorized access to Cluster nodes</strong></li>\n<li><strong>Impersonation</strong></li>\n<li><strong>Binding Roles and ClusterRoles</strong></li>\n</ul>\n<p>We have also provided some recommendations on how to mitigate these risks.</p>\n<p>üîê <strong>Key Takeaway:</strong> Security is a continuous process. There is no single solution that will protect your Kubernetes cluster from all threats. However, by implementing a layered security approach and following the recommendations in this blog post, you can help to reduce your risk and protect your Kubernetes environment.</p>\n<p>For further reading, check out the <a href=\"https://kubernetes.io/docs/concepts/security/overview/\" target=\"_blank\" rel=\"noopener noreferrer\">Kubernetes Security Best Practices</a>.</p>"}}},"staticQueryHashes":["1271460761","1321585977"],"slicesMap":{}}