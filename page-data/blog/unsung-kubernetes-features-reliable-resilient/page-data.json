{"componentChunkName":"component---src-templates-blog-template-js","path":"/blog/unsung-kubernetes-features-reliable-resilient/","result":{"data":{"markdownRemark":{"html":"<blockquote>\n<p><strong>Explore the lesser-known features that keep Kubernetes high available</strong></p>\n</blockquote>\n<h2 id=\"️-introduction\" style=\"position:relative;\"><a href=\"#%EF%B8%8F-introduction\" aria-label=\"️ introduction permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>⭐️ Introduction</h2>\n<p>Ensuring high availability and reliability in Kubernetes clusters can be a challenge. While some features like Deployments and Services are well-known for their ability to maintain availability, there are several lesser-known features that play an important role in keeping Kubernetes clusters running smoothly. In this article, we'll talk about some of these unsung heroes, including <strong>Pod Topology Spread Constraints</strong>, <strong>pod-deletion-cost</strong>, <strong>maxUnavailable</strong>, <strong>Pod Disruption Budgets</strong>, <strong>PriorityClasses</strong>, and <strong>Pod Anti-Affinity</strong>.</p>\n<h2 id=\"pod-topology-spread-constraints\" style=\"position:relative;\"><a href=\"#pod-topology-spread-constraints\" aria-label=\"pod topology spread constraints permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Pod Topology Spread Constraints</h2>\n<p>Pod Topology Spread Constraints in Kubernetes allow for fine-grained control over the distribution of pods across failure domains, such as regions and zones, to achieve high availability and efficient resource utilization. These constraints use labels to enforce specific distribution patterns, ensuring that workloads are evenly distributed and separated by topology. By preventing single points of failure, they enhance fault-tolerance, improve performance, and optimize resource utilization.</p>\n<p>For example, the <code class=\"language-text\">maxSkew</code> parameter defines the degree to which pods may be unevenly distributed, while the <code class=\"language-text\">minDomains</code> parameter forces spreading pods over a minimum number of domains. These constraints complement other Kubernetes scheduling policies, such as Pod affinity/anti-affinity, Node Selector, Node Affinity, and Node Taints, and are an important asset in deploying and running efficient and highly available workloads in complex, distributed environments.</p>\n<p>Here's an example of a pod topology spread constraint:</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> v1\n<span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> Pod\n<span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> example<span class=\"token punctuation\">-</span>pod\n<span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">topologySpreadConstraints</span><span class=\"token punctuation\">:</span>\n        <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">maxSkew</span><span class=\"token punctuation\">:</span> &lt;integer<span class=\"token punctuation\">></span>\n            <span class=\"token key atrule\">minDomains</span><span class=\"token punctuation\">:</span> &lt;integer<span class=\"token punctuation\">></span> <span class=\"token comment\"># optional</span>\n            <span class=\"token key atrule\">topologyKey</span><span class=\"token punctuation\">:</span> &lt;string<span class=\"token punctuation\">></span>\n            <span class=\"token key atrule\">whenUnsatisfiable</span><span class=\"token punctuation\">:</span> &lt;string<span class=\"token punctuation\">></span>\n            <span class=\"token key atrule\">labelSelector</span><span class=\"token punctuation\">:</span> &lt;object<span class=\"token punctuation\">></span>\n            <span class=\"token key atrule\">matchLabelKeys</span><span class=\"token punctuation\">:</span> &lt;list<span class=\"token punctuation\">></span> <span class=\"token comment\"># optional</span>\n            <span class=\"token key atrule\">nodeAffinityPolicy</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span>Honor<span class=\"token punctuation\">|</span>Ignore<span class=\"token punctuation\">]</span> <span class=\"token comment\"># optional</span>\n            <span class=\"token key atrule\">nodeTaintsPolicy</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span>Honor<span class=\"token punctuation\">|</span>Ignore<span class=\"token punctuation\">]</span> <span class=\"token comment\"># optional</span></code></pre></div>\n<p>You can find a full explanation of each element in the <a href=\"https://kubernetes.io/docs/concepts/scheduling-eviction/topology-spread-constraints/#spread-constraint-definition\" target=\"_blank\" rel=\"noopener noreferrer\">Kubernetes documentation</a>. For now, let's just briefly outline the obligatory fields:</p>\n<ul>\n<li><strong>maxSkew</strong>: The degree to which your Pods can be distributed unevenly across all zones. Its value must be more than zero.</li>\n<li><strong>topologyKey</strong>: The key of node labels. Nodes with the same label and values belong to the same topology. Each topology instance is a domain to which the scheduler tries to assign a balanced number of pods.</li>\n<li><strong>whenUnsatisfiable</strong>: Lets you decide what to do with a Pod when it doesn't satisfy your spread constraint:\n<ol>\n<li><code class=\"language-text\">DoNotSchedule</code> instructs the scheduler not to schedule it.</li>\n<li><code class=\"language-text\">ScheduleAnyway</code> tells the scheduler to schedule it and prioritize the nodes minimizing the skew.</li>\n</ol>\n</li>\n<li><strong>labelSelector</strong>: Allows finding matching Pods. The number of Pods in their corresponding topology domain is based on the Pods matching the label selector.</li>\n</ul>\n<h2 id=\"pod-deletion-cost\" style=\"position:relative;\"><a href=\"#pod-deletion-cost\" aria-label=\"pod deletion cost permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Pod Deletion Cost</h2>\n<p>Pod deletion cost is an annotation in Kubernetes that allows users to set a preference regarding which pods to remove first when downscaling a ReplicaSet. By using the <code class=\"language-text\">controller.kubernetes.io/pod-deletion-cost</code> annotation, users can influence the order in which pods are deleted. The annotation should be set on the pod, and the range is <code class=\"language-text\">[-2147483648, 2147483647]</code>.</p>\n<p>It represents the cost of deleting a pod compared to other pods belonging to the same ReplicaSet. Pods with lower deletion cost are preferred to be deleted before pods with higher deletion costs. If the annotation is not specified, the implicit value is 0.</p>\n<p>This feature is useful for influencing the downscaling order of pods and can be particularly beneficial in scenarios where specific pods need to be retained for longer periods during downscaling. The annotation interacts with the ReplicaSet controller to determine the order of pod deletion based on the set deletion cost values. It provides a way to customize the pod deletion behavior, ensuring that pods are removed in the desired order when downscaling a ReplicaSet.</p>\n<p>Here's an example of a YAML manifest for a Kubernetes Pod with the <code class=\"language-text\">controller.kubernetes.io/pod-deletion-cost</code> annotation:</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> v1\n<span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> Pod\n<span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> example<span class=\"token punctuation\">-</span>pod\n    <span class=\"token key atrule\">labels</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">app</span><span class=\"token punctuation\">:</span> example\n    <span class=\"token key atrule\">annotations</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">controller.kubernetes.io/pod-deletion-cost</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"100\"</span>\n<span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">containers</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> nginx\n        <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> nginx\n        <span class=\"token key atrule\">ports</span><span class=\"token punctuation\">:</span>\n        <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">containerPort</span><span class=\"token punctuation\">:</span> <span class=\"token number\">80</span></code></pre></div>\n<p>In this example, we have a Pod named \"example-pod\" with the label \"app: example\" running an Nginx container. The <code class=\"language-text\">controller.kubernetes.io/pod-deletion-cost</code> annotation is set to \"100\" to indicate the deletion cost for this Pod. When scaling down, Pods with lower deletion costs will be preferred for deletion first.</p>\n<h2 id=\"maxunavailable-parameter\" style=\"position:relative;\"><a href=\"#maxunavailable-parameter\" aria-label=\"maxunavailable parameter permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>maxUnavailable Parameter</h2>\n<p><code class=\"language-text\">maxUnavailable</code> is a parameter in Kubernetes that specifies the maximum number of pods that can be unavailable during a rolling update. It is used in conjunction with the <code class=\"language-text\">maxSurge</code> parameter, which specifies the maximum number of new pods that can be created at a time. Together, these parameters control the rate at which pods are updated during a rolling update.</p>\n<p>Here's an example of how to use <code class=\"language-text\">maxUnavailable</code> in a Kubernetes Deployment:</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> apps/v1\n<span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> Deployment\n<span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> my<span class=\"token punctuation\">-</span>deployment\n<span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">replicas</span><span class=\"token punctuation\">:</span> <span class=\"token number\">3</span>\n    <span class=\"token key atrule\">selector</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">matchLabels</span><span class=\"token punctuation\">:</span>\n            <span class=\"token key atrule\">app</span><span class=\"token punctuation\">:</span> my<span class=\"token punctuation\">-</span>app\n    <span class=\"token key atrule\">template</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n            <span class=\"token key atrule\">labels</span><span class=\"token punctuation\">:</span>\n                <span class=\"token key atrule\">app</span><span class=\"token punctuation\">:</span> my<span class=\"token punctuation\">-</span>app\n        <span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span>\n            <span class=\"token key atrule\">containers</span><span class=\"token punctuation\">:</span>\n            <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> my<span class=\"token punctuation\">-</span>container\n                <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> my<span class=\"token punctuation\">-</span>image\n                <span class=\"token key atrule\">ports</span><span class=\"token punctuation\">:</span>\n                <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">containerPort</span><span class=\"token punctuation\">:</span> <span class=\"token number\">80</span>\n    <span class=\"token key atrule\">strategy</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">type</span><span class=\"token punctuation\">:</span> RollingUpdate\n        <span class=\"token key atrule\">rollingUpdate</span><span class=\"token punctuation\">:</span>\n            <span class=\"token key atrule\">maxSurge</span><span class=\"token punctuation\">:</span> <span class=\"token number\">1</span>\n            <span class=\"token key atrule\">maxUnavailable</span><span class=\"token punctuation\">:</span> <span class=\"token number\">0</span></code></pre></div>\n<p>In this example, the <code class=\"language-text\">maxSurge</code> is set to 1, which means that only one new pod can be created at a time. The <code class=\"language-text\">maxUnavailable</code> is set to 0, which means that no old pods can be deleted at a time.</p>\n<p>Keep in mind that <code class=\"language-text\">maxUnavailable</code> can only be used to control the eviction of pods that have an associated controller managing them. In the case of a Deployment, this means that the controller is the ReplicaSet. If you want to control the eviction of pods in a StatefulSet, you can use the <code class=\"language-text\">maxUnavailable</code> parameter in the StatefulSet's rolling update strategy.</p>\n<h2 id=\"pod-disruption-budgets-pdb\" style=\"position:relative;\"><a href=\"#pod-disruption-budgets-pdb\" aria-label=\"pod disruption budgets pdb permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Pod Disruption Budgets (PDB)</h2>\n<p>PDBs are a Kubernetes feature that allows users to declare the minimum or maximum number of unavailable pods for an application during disruptions. PDBs help ensure the high availability of applications by setting constraints on the number of pods that can be disrupted at a time. Disruptions can be voluntary, such as maintenance operations or node scaling, or involuntary, such as hardware failures or system crashes.</p>\n<h3 id=\"three-steps-to-creating-a-pdb\" style=\"position:relative;\"><a href=\"#three-steps-to-creating-a-pdb\" aria-label=\"three steps to creating a pdb permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Three Steps to Creating a PDB:</h3>\n<ol>\n<li>\n<p><strong>Determine the Minimum Number of Instances</strong>: Assess your application's needs and identify the minimum number of instances (<code class=\"language-text\">minAvailable</code>) that must be operational during disruptions.</p>\n</li>\n<li>\n<p><strong>Create a YAML File</strong>: Use a text editor to create a YAML file that specifies the PDB object. Here's an example YAML file:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\"> ```yaml\n apiVersion: policy/v1\n kind: PodDisruptionBudget\n metadata:\n     name: my-pdb\n spec:\n     minAvailable: 2\n     selector:\n         matchLabels:\n             app: my-app\n ```\n\n In this example, the `minAvailable` field is set to 2, indicating that at least two instances of the specified pods should be available at any given time. The `selector` field identifies the target pods based on the label selector `app: my-app`.</code></pre></div>\n</li>\n<li>\n<p><strong>Apply the YAML File</strong>: Use the <code class=\"language-text\">kubectl apply</code> command to apply the YAML file and create the PDB within your Kubernetes cluster:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\"> ```sh\n kubectl apply -f pdb.yaml\n ```</code></pre></div>\n</li>\n</ol>\n<h2 id=\"kubernetes-pod-priority--preemption\" style=\"position:relative;\"><a href=\"#kubernetes-pod-priority--preemption\" aria-label=\"kubernetes pod priority  preemption permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Kubernetes Pod Priority &#x26; Preemption</h2>\n<p><code class=\"language-text\">PriorityClass</code> is a cluster-wide API object in Kubernetes and part of the <code class=\"language-text\">scheduling.k8s.io/v1</code> API group. It contains a mapping of the <code class=\"language-text\">PriorityClass</code> name (defined in <code class=\"language-text\">.metadata.name</code>) and an integer value (defined in <code class=\"language-text\">.value</code>). This represents the value that the scheduler uses to determine Pod's relative priority.</p>\n<p><a href=\"https://kubernetes.io/docs/concepts/scheduling-eviction/pod-priority-preemption/#preemption\" target=\"_blank\" rel=\"noopener noreferrer\">Pod preemption</a> is a Kubernetes feature that allows the cluster to preempt pods (removing an existing Pod in favor of a new Pod) on the basis of priority. <a href=\"https://kubernetes.io/docs/concepts/scheduling-eviction/pod-priority-preemption/#pod-priority\" target=\"_blank\" rel=\"noopener noreferrer\">Pod priority</a> indicates the importance of a pod relative to other pods while scheduling. If there aren't enough resources to run all the current pods, the scheduler tries to evict lower-priority pods over high-priority ones.</p>\n<p>Here's an example. Next, create some environment-specific <code class=\"language-text\">PriorityClasses</code>:</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> scheduling.k8s.io/v1\n<span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> PriorityClass\n<span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> dev<span class=\"token punctuation\">-</span>pc\n<span class=\"token key atrule\">value</span><span class=\"token punctuation\">:</span> <span class=\"token number\">1000000</span>\n<span class=\"token key atrule\">globalDefault</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">false</span>\n<span class=\"token key atrule\">description</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">></span><span class=\"token punctuation\">-</span>\n    (Optional) This priority class should only be used for all development pods.\n<span class=\"token punctuation\">---</span>\n<span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> scheduling.k8s.io/v1\n<span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> PriorityClass\n<span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> preprod<span class=\"token punctuation\">-</span>pc\n<span class=\"token key atrule\">value</span><span class=\"token punctuation\">:</span> <span class=\"token number\">2000000</span>\n<span class=\"token key atrule\">globalDefault</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">false</span>\n<span class=\"token key atrule\">description</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">></span><span class=\"token punctuation\">-</span>\n    (Optional) This priority class should only be used for all preprod pods.\n<span class=\"token punctuation\">---</span>\n<span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> scheduling.k8s.io/v1\n<span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> PriorityClass\n<span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> prod<span class=\"token punctuation\">-</span>pc\n<span class=\"token key atrule\">value</span><span class=\"token punctuation\">:</span> <span class=\"token number\">4000000</span>\n<span class=\"token key atrule\">globalDefault</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">false</span>\n<span class=\"token key atrule\">description</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">></span><span class=\"token punctuation\">-</span>\n    (Optional) This priority class should only be used for all prod pods.</code></pre></div>\n<p>Use <code class=\"language-text\">kubectl create -f &lt;FILE.YAML></code> command to create a pc and <code class=\"language-text\">kubectl get pc</code> to check its status.</p>\n<div class=\"gatsby-highlight\" data-language=\"sh\"><pre class=\"language-sh\"><code class=\"language-sh\">$ kubectl get pc\nNAME                      VALUE        GLOBAL-DEFAULT   AGE\ndev-pc                    <span class=\"token number\">1000000</span>      <span class=\"token boolean\">false</span>            3m13s\npreprod-pc                <span class=\"token number\">2000000</span>      <span class=\"token boolean\">false</span>            2m3s\nprod-pc                   <span class=\"token number\">4000000</span>      <span class=\"token boolean\">false</span>            7s\nsystem-cluster-critical   <span class=\"token number\">2000000000</span>   <span class=\"token boolean\">false</span>            82m\nsystem-node-critical      <span class=\"token number\">2000001000</span>   <span class=\"token boolean\">false</span>            82m</code></pre></div>\n<p>Now, let's say there are 3 application pods: one for prod, one for preprod, and one for development. Below are three sample YAML manifest files for each of those.</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token punctuation\">---</span>\n<span class=\"token comment\"># development</span>\n<span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> v1\n<span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> Pod\n<span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> dev<span class=\"token punctuation\">-</span>nginx\n    <span class=\"token key atrule\">labels</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">env</span><span class=\"token punctuation\">:</span> dev\n<span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">containers</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> dev<span class=\"token punctuation\">-</span>nginx\n        <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> nginx\n    <span class=\"token key atrule\">priorityClassName</span><span class=\"token punctuation\">:</span> dev<span class=\"token punctuation\">-</span>pc\n<span class=\"token punctuation\">---</span>\n<span class=\"token comment\"># preproduction</span>\n<span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> v1\n<span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> Pod\n<span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> preprod<span class=\"token punctuation\">-</span>nginx\n    <span class=\"token key atrule\">labels</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">env</span><span class=\"token punctuation\">:</span> preprod\n<span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">containers</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> preprod<span class=\"token punctuation\">-</span>nginx\n        <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> nginx\n    <span class=\"token key atrule\">priorityClassName</span><span class=\"token punctuation\">:</span> preprod<span class=\"token punctuation\">-</span>pc\n<span class=\"token punctuation\">---</span>\n<span class=\"token comment\"># production</span>\n<span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> v1\n<span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> Pod\n<span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> prod<span class=\"token punctuation\">-</span>nginx\n    <span class=\"token key atrule\">labels</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">env</span><span class=\"token punctuation\">:</span> prod\n<span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">containers</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> prod<span class=\"token punctuation\">-</span>nginx\n        <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> nginx\n    <span class=\"token key atrule\">priorityClassName</span><span class=\"token punctuation\">:</span> prod<span class=\"token punctuation\">-</span>pc</code></pre></div>\n<p>You can create these pods with the <code class=\"language-text\">kubectl create -f &lt;FILE.yaml></code> command, and then check their status using the <code class=\"language-text\">kubectl get pods</code> command. You can see if they are up and look ready to serve traffic:</p>\n<div class=\"gatsby-highlight\" data-language=\"sh\"><pre class=\"language-sh\"><code class=\"language-sh\">$ kubectl get pods --show-labels\nNAME            READY   STATUS    RESTARTS   AGE   LABELS\ndev-nginx       <span class=\"token number\">1</span>/1     Running   <span class=\"token number\">0</span>          55s   <span class=\"token assign-left variable\">env</span><span class=\"token operator\">=</span>dev\npreprod-nginx   <span class=\"token number\">1</span>/1     Running   <span class=\"token number\">0</span>          55s   <span class=\"token assign-left variable\">env</span><span class=\"token operator\">=</span>preprod\nprod-nginx      <span class=\"token number\">0</span>/1     Pending   <span class=\"token number\">0</span>          55s   <span class=\"token assign-left variable\">env</span><span class=\"token operator\">=</span>prod</code></pre></div>\n<p>The diagram below shows exactly how it works with the help of an exampl</p>\n<p><span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 124.70588235294117%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAZCAYAAAAxFw7TAAAACXBIWXMAAAsTAAALEwEAmpwYAAACIklEQVR42qVV2XLiMBD0/39TfoCHTfEQ7hXmMmXANjfG8tHrHjKJAwS8hapU2GNNT6unhRy8MPKiAIoMbx8x5pFlBM4rgKfTCdPpFAMzhjEuoih6DdBai/V6DW82w2QywWaz+QYsSvq73Q6z8uNyuUQcxxJ7NJIkkZwgCCTncDh8A7Ka7/toNptot9tSLcuyS7E7U0lcF/0CTNNUNOj3+3BdF8fjUWJpanEumbBgorN812LX48eWCUBN9vu9JFiblGAWf7wco3WOdy+DCXP0g7xsrsU9RR42Jc9zYWO8CFM/xMdfD13Xg5mtkGcpCtQAJAjZXX4vzzaJsdtusFr4CFZLHA/7X0k42hB2lfN8Psv7Rb9UAClHVhZg/NlwuJhNaDQaaLVa0ozqUNDFYoHRaITtditFuYNfGZIZfURP0f1qBSbxGwHpTxYkIItQW9TRMPm0CIGZzI4TlCDqOxbid5XjBlAXchKMCXJGBwMMh0PZqjLimvl8LuZn/FpX5975rG7567R8xqRBZazasB+ATOIZpH5siDLkqaGunGEY1uqwABKk1+uh0+nIFlQvzytN3O3K1tgQxqtMH9qGNiAwddKuqmWq2tVieE9DPSlq7v8ZN4AKQqbGGJHj2uxPAclIG6PmVkBqy291t+3o3UBvMVn/C9Uedbt7Y2y1T1U3ArJhL2nIQYa8dDjH47FMXgm1bFN90cVkRTPzjqEUfFYdnzH8BzpJpcsmGvYGAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"class\" title=\"\" src=\"/static/7ac02e7be6040d03a013650befced831/c5bb3/priority.png\" srcset=\"/static/7ac02e7be6040d03a013650befced831/04472/priority.png 170w,\n/static/7ac02e7be6040d03a013650befced831/9f933/priority.png 340w,\n/static/7ac02e7be6040d03a013650befced831/c5bb3/priority.png 680w,\n/static/7ac02e7be6040d03a013650befced831/b12f7/priority.png 1020w,\n/static/7ac02e7be6040d03a013650befced831/1be7e/priority.png 1059w\" sizes=\"(max-width: 680px) 100vw, 680px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n    </span>\n          </p>\n<h2 id=\"inter-pod-anti-affinity\" style=\"position:relative;\"><a href=\"#inter-pod-anti-affinity\" aria-label=\"inter pod anti affinity permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Inter-pod Anti-affinity</h2>\n<p>Inter-pod affinity and anti-affinity allow you to constrain which nodes your Pods can be scheduled on based on the labels of Pods already running on that node, instead of the node labels. Inter-pod affinity and anti-affinity rules take the form \"this Pod should (or, in the case of anti-affinity, should not) run in an X if that X is already running one or more Pods that meet rule Y\", where X is a topology domain like node, rack, cloud provider zone or region, or similar and Y is the rule Kubernetes tries to satisfy.</p>\n<p>You express these rules (Y) as <a href=\"https://kubernetes.io/docs/concepts/overview/working-with-objects/labels/#label-selector\" target=\"_blank\" rel=\"noopener noreferrer\">label selectors</a> with an optional associated list of namespaces. Pods are namespaced objects in Kubernetes, so Pod labels also implicitly have namespaces. Any label selectors for Pod labels should specify the namespaces in which Kubernetes should look for those labels. You express the topology domain (X) using a <code class=\"language-text\">topologyKey</code>, which is the key for the node label that the system uses to denote the domain.</p>\n<p>Here's what the pod spec looks like:</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">affinity</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">podAntiAffinity</span><span class=\"token punctuation\">:</span>\n            <span class=\"token key atrule\">requiredDuringSchedulingIgnoredDuringExecution</span><span class=\"token punctuation\">:</span>\n            <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">labelSelector</span><span class=\"token punctuation\">:</span>\n                    <span class=\"token key atrule\">matchExpressions</span><span class=\"token punctuation\">:</span>\n                    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">key</span><span class=\"token punctuation\">:</span> app\n                        <span class=\"token key atrule\">operator</span><span class=\"token punctuation\">:</span> In\n                        <span class=\"token key atrule\">values</span><span class=\"token punctuation\">:</span>\n                        <span class=\"token punctuation\">-</span> web\n                <span class=\"token key atrule\">topologyKey</span><span class=\"token punctuation\">:</span> kubernetes.io/hostname\n            <span class=\"token key atrule\">preferredDuringSchedulingIgnoredDuringExecution</span><span class=\"token punctuation\">:</span>\n            <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">weight</span><span class=\"token punctuation\">:</span> <span class=\"token number\">100</span>\n                <span class=\"token key atrule\">podAffinityTerm</span><span class=\"token punctuation\">:</span>\n                    <span class=\"token key atrule\">labelSelector</span><span class=\"token punctuation\">:</span>\n                        <span class=\"token key atrule\">matchExpressions</span><span class=\"token punctuation\">:</span>\n                        <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">key</span><span class=\"token punctuation\">:</span> app\n                            <span class=\"token key atrule\">operator</span><span class=\"token punctuation\">:</span> In\n                            <span class=\"token key atrule\">values</span><span class=\"token punctuation\">:</span>\n                            <span class=\"token punctuation\">-</span> backend\n                    <span class=\"token key atrule\">topologyKey</span><span class=\"token punctuation\">:</span> kubernetes.io/hostname</code></pre></div>\n<p>Let's dive into the inter-pod anti-affinity structure:</p>\n<ul>\n<li><strong>requiredDuringSchedulingIgnoredDuringExecution</strong>: It means that conditions must be satisfied to pod be scheduled (hard requirement).</li>\n<li><strong>preferredDuringSchedulingIgnoredDuringExecution</strong>: If a condition can be satisfied, it will be satisfied. But if not, it will be ignored (soft requirement).</li>\n<li><strong>podAffinityTerm</strong>: The pod affinity term defines which pods we select with a label selector and which node topology key we target.</li>\n</ul>\n<p>A soft requirement has <code class=\"language-text\">podAffinityTerm</code> as separate property with an additional weight parameter that defines which term is more important. A hard requirement has an affinity term as a root list item object. For the hard affinity rule, all affinity terms and all expressions should be satisfied for the pod to be scheduled.</p>\n<h2 id=\"wrap-up\" style=\"position:relative;\"><a href=\"#wrap-up\" aria-label=\"wrap up permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Wrap Up</h2>\n<p>In this blog post, we explore the lesser-known features of Kubernetes that play an important role in keeping Kubernetes clusters running smoothly. We discuss <strong>Pod Topology Spread Constraints</strong>, <strong>pod-deletion-cost</strong>, <strong>maxUnavailable</strong>, <strong>Pod Disruption Budgets</strong>, and <strong>PriorityClasses</strong>. These features help ensure high availability and reliability in Kubernetes clusters, making them essential for managing Kubernetes workloads effectively.</p>\n<p><span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 64px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 100%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAsTAAALEwEAmpwYAAAD8ElEQVR42pWUC0xbZRTHL2DUGJMlRpeZ6OIr0fggLnO+jeHRFQota2np7YunmoUYTTAaTdxq1Jmo8f2YDveIC3GbYxQHDA1zBBgPIWwtlEkfYHkVJrS9bWlLe7/797vUmk7ZmCc5uffmu9/v+59zvnMY5l9mNjOZ4vP3uq03L7351APpa4A5E2ZzJrOe4ZgmC0CG6OK3d2f2xmh7SW+oRx0NNssbQgcLNAu12zYloUyG6OtDmeRPZxjmmkizvAWz5Ui4jHzUbgJv1SHRq/GGmor3TZsfvS0Fvixs6dD2F7gW+ZlAq6I7fLKkH3aW4I9aHq5qfmWMjXsHWCHqMBLMVyH2s3Joqubxmy4LDezPKYNNB8yUE/KLEsKvpcCkgYf7RSJMvw24TfyKXUu8/VoSuWCIYaoCXENhXSpV/wFyR2R74DSAG1DHfZ/nC0vUY91qAR4TwdRuCNPvAhM7SWxMTzirjsd0BZZPKg6nirSGQqmOt7LgRlg+0FQM32d58H8tQbRTJWCynMDzMiETrwhwVBI49HHMVCLcVmJJAmkxVwuaBl549v4bIx07LsRFlTYtCfykoNB8ULUIN8sFfkRD4NZTN4q+CryiQtGC9fmq2IAGwVGWUKVC4FQJ/Hsl8H1C1e6TYrlZIaz0agRi18XhMCL4Q+Eucd+ehzfd4mmXf+kbZesvuayruTwsfUuwsRSqTXAjWoHrVyNwtAi+L6jaj3KTqfhGwpPvZfSwvFWFB7T31WFQh/hiTcLWWvhIGjRZfl+D9ENQaGxcL1BogrNScJcKgcZi+A9I4ftKIoiHhDtVQH1utunBjU94v5UAC9WYH9LuTo86I6V0cW9uTej0Dh9cBoTsNPxRlqdwwg2XITioAXe+jISsWvg7lYMdDds/Hn/naT8c5Yi4jENrtqD49Jsfu8N3rOi7UJcqjHED4g69EB7TwW/TwndevI+0SBerAe55QluTj1oUSEyWY8CSFvalfZ1MwZ/v59zLHZW9F2hXjIV6SmPDJwoTK2LHOEyw7c9rPGuRtWHxOUQ7VHHMVmJumK1Yu6/pREm/ErTPszpf2ypxt8mD7qaiRvcHz5SireA6urTZ3aWcEmGYrYJ3WP/SlQcGVTpq1lwrvrOKe7aIYcVdxn82VWrvvn2uTz0NT8UqcOGcrmrdKZSajxs2MHfO9GuWidN4ztOtlPT9WJDt6VOfxUIN4DQlyIQJI6dLnmSuxlJz8tTB3CNI1ILMVsZ5J+2aqQoBTmMMF2uwnKxy1tUB/56Vt951/ea+E7Ie2uPAfLVA5qoEsdq0UBFnjyqH+Z+Wmn03fLprm7L7uPSNPovs9d9aZK8OtRY+lErPXzG7r/RlSAwMAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"hat\" title=\"\" src=\"/static/3f09f9fba9b337c48fbfa766a63fec33/6b377/hat.png\" srcset=\"/static/3f09f9fba9b337c48fbfa766a63fec33/6b377/hat.png 64w\" sizes=\"(max-width: 64px) 100vw, 64px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n    </span>\n          </p>\n<br>\n<p><strong><em>Until next time, つづく 🎉</em></strong></p>\n<blockquote>\n<p>💡 Thank you for Reading !! 🙌🏻😁📃, see you in the next blog.🤘  <strong><em>Until next time 🎉</em></strong></p>\n</blockquote>\n<p>🚀 Thank you for sticking up till the end. If you have any questions/feedback regarding this blog feel free to connect with me:</p>\n<p><strong>♻️ LinkedIn:</strong> <a href=\"https://www.linkedin.com/in/rajhi-saif/\" target=\"_blank\" rel=\"noopener noreferrer\">https://www.linkedin.com/in/rajhi-saif/</a></p>\n<p><strong>♻️ X/Twitter:</strong> <a href=\"https://x.com/rajhisaifeddine\" target=\"_blank\" rel=\"noopener noreferrer\">https://x.com/rajhisaifeddine</a></p>\n<p><strong>The end ✌🏻</strong></p>\n<h1 align=\"center\">🔰 Keep Learning !! Keep Sharing !! 🔰</h1>\n<p><strong>📅 Stay updated</strong></p>\n<p>Subscribe to our newsletter for more insights on AWS cloud computing and containers.</p>","timeToRead":8,"rawMarkdownBody":"\n> **Explore the lesser-known features that keep Kubernetes high available**\n\n## ⭐️ Introduction\n\nEnsuring high availability and reliability in Kubernetes clusters can be a challenge. While some features like Deployments and Services are well-known for their ability to maintain availability, there are several lesser-known features that play an important role in keeping Kubernetes clusters running smoothly. In this article, we'll talk about some of these unsung heroes, including **Pod Topology Spread Constraints**, **pod-deletion-cost**, **maxUnavailable**, **Pod Disruption Budgets**, **PriorityClasses**, and **Pod Anti-Affinity**.\n\n## Pod Topology Spread Constraints\n\nPod Topology Spread Constraints in Kubernetes allow for fine-grained control over the distribution of pods across failure domains, such as regions and zones, to achieve high availability and efficient resource utilization. These constraints use labels to enforce specific distribution patterns, ensuring that workloads are evenly distributed and separated by topology. By preventing single points of failure, they enhance fault-tolerance, improve performance, and optimize resource utilization.\n\nFor example, the `maxSkew` parameter defines the degree to which pods may be unevenly distributed, while the `minDomains` parameter forces spreading pods over a minimum number of domains. These constraints complement other Kubernetes scheduling policies, such as Pod affinity/anti-affinity, Node Selector, Node Affinity, and Node Taints, and are an important asset in deploying and running efficient and highly available workloads in complex, distributed environments.\n\nHere's an example of a pod topology spread constraint:\n\n```yaml\napiVersion: v1\nkind: Pod\nmetadata:\n    name: example-pod\nspec:\n    topologySpreadConstraints:\n        - maxSkew: <integer>\n            minDomains: <integer> # optional\n            topologyKey: <string>\n            whenUnsatisfiable: <string>\n            labelSelector: <object>\n            matchLabelKeys: <list> # optional\n            nodeAffinityPolicy: [Honor|Ignore] # optional\n            nodeTaintsPolicy: [Honor|Ignore] # optional\n```\n\nYou can find a full explanation of each element in the [Kubernetes documentation](https://kubernetes.io/docs/concepts/scheduling-eviction/topology-spread-constraints/#spread-constraint-definition). For now, let's just briefly outline the obligatory fields:\n\n- **maxSkew**: The degree to which your Pods can be distributed unevenly across all zones. Its value must be more than zero.\n- **topologyKey**: The key of node labels. Nodes with the same label and values belong to the same topology. Each topology instance is a domain to which the scheduler tries to assign a balanced number of pods.\n- **whenUnsatisfiable**: Lets you decide what to do with a Pod when it doesn't satisfy your spread constraint:\n    1. `DoNotSchedule` instructs the scheduler not to schedule it.\n    2. `ScheduleAnyway` tells the scheduler to schedule it and prioritize the nodes minimizing the skew.\n- **labelSelector**: Allows finding matching Pods. The number of Pods in their corresponding topology domain is based on the Pods matching the label selector.\n\n## Pod Deletion Cost\n\nPod deletion cost is an annotation in Kubernetes that allows users to set a preference regarding which pods to remove first when downscaling a ReplicaSet. By using the `controller.kubernetes.io/pod-deletion-cost` annotation, users can influence the order in which pods are deleted. The annotation should be set on the pod, and the range is `[-2147483648, 2147483647]`.\n\nIt represents the cost of deleting a pod compared to other pods belonging to the same ReplicaSet. Pods with lower deletion cost are preferred to be deleted before pods with higher deletion costs. If the annotation is not specified, the implicit value is 0.\n\nThis feature is useful for influencing the downscaling order of pods and can be particularly beneficial in scenarios where specific pods need to be retained for longer periods during downscaling. The annotation interacts with the ReplicaSet controller to determine the order of pod deletion based on the set deletion cost values. It provides a way to customize the pod deletion behavior, ensuring that pods are removed in the desired order when downscaling a ReplicaSet.\n\nHere's an example of a YAML manifest for a Kubernetes Pod with the `controller.kubernetes.io/pod-deletion-cost` annotation:\n\n```yaml\napiVersion: v1\nkind: Pod\nmetadata:\n    name: example-pod\n    labels:\n        app: example\n    annotations:\n        controller.kubernetes.io/pod-deletion-cost: \"100\"\nspec:\n    containers:\n    - name: nginx\n        image: nginx\n        ports:\n        - containerPort: 80\n```\n\nIn this example, we have a Pod named \"example-pod\" with the label \"app: example\" running an Nginx container. The `controller.kubernetes.io/pod-deletion-cost` annotation is set to \"100\" to indicate the deletion cost for this Pod. When scaling down, Pods with lower deletion costs will be preferred for deletion first.\n\n## maxUnavailable Parameter\n\n`maxUnavailable` is a parameter in Kubernetes that specifies the maximum number of pods that can be unavailable during a rolling update. It is used in conjunction with the `maxSurge` parameter, which specifies the maximum number of new pods that can be created at a time. Together, these parameters control the rate at which pods are updated during a rolling update.\n\nHere's an example of how to use `maxUnavailable` in a Kubernetes Deployment:\n\n```yaml\napiVersion: apps/v1\nkind: Deployment\nmetadata:\n    name: my-deployment\nspec:\n    replicas: 3\n    selector:\n        matchLabels:\n            app: my-app\n    template:\n        metadata:\n            labels:\n                app: my-app\n        spec:\n            containers:\n            - name: my-container\n                image: my-image\n                ports:\n                - containerPort: 80\n    strategy:\n        type: RollingUpdate\n        rollingUpdate:\n            maxSurge: 1\n            maxUnavailable: 0\n```\n\nIn this example, the `maxSurge` is set to 1, which means that only one new pod can be created at a time. The `maxUnavailable` is set to 0, which means that no old pods can be deleted at a time.\n\nKeep in mind that `maxUnavailable` can only be used to control the eviction of pods that have an associated controller managing them. In the case of a Deployment, this means that the controller is the ReplicaSet. If you want to control the eviction of pods in a StatefulSet, you can use the `maxUnavailable` parameter in the StatefulSet's rolling update strategy.\n\n## Pod Disruption Budgets (PDB)\n\nPDBs are a Kubernetes feature that allows users to declare the minimum or maximum number of unavailable pods for an application during disruptions. PDBs help ensure the high availability of applications by setting constraints on the number of pods that can be disrupted at a time. Disruptions can be voluntary, such as maintenance operations or node scaling, or involuntary, such as hardware failures or system crashes.\n\n### Three Steps to Creating a PDB:\n\n1. **Determine the Minimum Number of Instances**: Assess your application's needs and identify the minimum number of instances (`minAvailable`) that must be operational during disruptions.\n2. **Create a YAML File**: Use a text editor to create a YAML file that specifies the PDB object. Here's an example YAML file:\n\n        ```yaml\n        apiVersion: policy/v1\n        kind: PodDisruptionBudget\n        metadata:\n            name: my-pdb\n        spec:\n            minAvailable: 2\n            selector:\n                matchLabels:\n                    app: my-app\n        ```\n\n        In this example, the `minAvailable` field is set to 2, indicating that at least two instances of the specified pods should be available at any given time. The `selector` field identifies the target pods based on the label selector `app: my-app`.\n\n3. **Apply the YAML File**: Use the `kubectl apply` command to apply the YAML file and create the PDB within your Kubernetes cluster:\n\n        ```sh\n        kubectl apply -f pdb.yaml\n        ```\n\n## Kubernetes Pod Priority & Preemption\n\n`PriorityClass` is a cluster-wide API object in Kubernetes and part of the `scheduling.k8s.io/v1` API group. It contains a mapping of the `PriorityClass` name (defined in `.metadata.name`) and an integer value (defined in `.value`). This represents the value that the scheduler uses to determine Pod's relative priority.\n\n[Pod preemption](https://kubernetes.io/docs/concepts/scheduling-eviction/pod-priority-preemption/#preemption) is a Kubernetes feature that allows the cluster to preempt pods (removing an existing Pod in favor of a new Pod) on the basis of priority. [Pod priority](https://kubernetes.io/docs/concepts/scheduling-eviction/pod-priority-preemption/#pod-priority) indicates the importance of a pod relative to other pods while scheduling. If there aren't enough resources to run all the current pods, the scheduler tries to evict lower-priority pods over high-priority ones.\n\nHere's an example. Next, create some environment-specific `PriorityClasses`:\n\n```yaml\napiVersion: scheduling.k8s.io/v1\nkind: PriorityClass\nmetadata:\n    name: dev-pc\nvalue: 1000000\nglobalDefault: false\ndescription: >-\n    (Optional) This priority class should only be used for all development pods.\n---\napiVersion: scheduling.k8s.io/v1\nkind: PriorityClass\nmetadata:\n    name: preprod-pc\nvalue: 2000000\nglobalDefault: false\ndescription: >-\n    (Optional) This priority class should only be used for all preprod pods.\n---\napiVersion: scheduling.k8s.io/v1\nkind: PriorityClass\nmetadata:\n    name: prod-pc\nvalue: 4000000\nglobalDefault: false\ndescription: >-\n    (Optional) This priority class should only be used for all prod pods.\n```\n\nUse `kubectl create -f <FILE.YAML>` command to create a pc and `kubectl get pc` to check its status.\n\n```sh\n$ kubectl get pc\nNAME                      VALUE        GLOBAL-DEFAULT   AGE\ndev-pc                    1000000      false            3m13s\npreprod-pc                2000000      false            2m3s\nprod-pc                   4000000      false            7s\nsystem-cluster-critical   2000000000   false            82m\nsystem-node-critical      2000001000   false            82m\n```\n\nNow, let's say there are 3 application pods: one for prod, one for preprod, and one for development. Below are three sample YAML manifest files for each of those.\n\n```yaml\n---\n# development\napiVersion: v1\nkind: Pod\nmetadata:\n    name: dev-nginx\n    labels:\n        env: dev\nspec:\n    containers:\n    - name: dev-nginx\n        image: nginx\n    priorityClassName: dev-pc\n---\n# preproduction\napiVersion: v1\nkind: Pod\nmetadata:\n    name: preprod-nginx\n    labels:\n        env: preprod\nspec:\n    containers:\n    - name: preprod-nginx\n        image: nginx\n    priorityClassName: preprod-pc\n---\n# production\napiVersion: v1\nkind: Pod\nmetadata:\n    name: prod-nginx\n    labels:\n        env: prod\nspec:\n    containers:\n    - name: prod-nginx\n        image: nginx\n    priorityClassName: prod-pc\n```\n\nYou can create these pods with the `kubectl create -f <FILE.yaml>` command, and then check their status using the `kubectl get pods` command. You can see if they are up and look ready to serve traffic:\n\n```sh\n$ kubectl get pods --show-labels\nNAME            READY   STATUS    RESTARTS   AGE   LABELS\ndev-nginx       1/1     Running   0          55s   env=dev\npreprod-nginx   1/1     Running   0          55s   env=preprod\nprod-nginx      0/1     Pending   0          55s   env=prod\n```\n\nThe diagram below shows exactly how it works with the help of an exampl\n\n![class](./priority.png)\n\n## Inter-pod Anti-affinity\n\nInter-pod affinity and anti-affinity allow you to constrain which nodes your Pods can be scheduled on based on the labels of Pods already running on that node, instead of the node labels. Inter-pod affinity and anti-affinity rules take the form \"this Pod should (or, in the case of anti-affinity, should not) run in an X if that X is already running one or more Pods that meet rule Y\", where X is a topology domain like node, rack, cloud provider zone or region, or similar and Y is the rule Kubernetes tries to satisfy.\n\nYou express these rules (Y) as [label selectors](https://kubernetes.io/docs/concepts/overview/working-with-objects/labels/#label-selector) with an optional associated list of namespaces. Pods are namespaced objects in Kubernetes, so Pod labels also implicitly have namespaces. Any label selectors for Pod labels should specify the namespaces in which Kubernetes should look for those labels. You express the topology domain (X) using a `topologyKey`, which is the key for the node label that the system uses to denote the domain.\n\nHere's what the pod spec looks like:\n\n```yaml\nspec:\n    affinity:\n        podAntiAffinity:\n            requiredDuringSchedulingIgnoredDuringExecution:\n            - labelSelector:\n                    matchExpressions:\n                    - key: app\n                        operator: In\n                        values:\n                        - web\n                topologyKey: kubernetes.io/hostname\n            preferredDuringSchedulingIgnoredDuringExecution:\n            - weight: 100\n                podAffinityTerm:\n                    labelSelector:\n                        matchExpressions:\n                        - key: app\n                            operator: In\n                            values:\n                            - backend\n                    topologyKey: kubernetes.io/hostname\n```\n\nLet's dive into the inter-pod anti-affinity structure:\n\n- **requiredDuringSchedulingIgnoredDuringExecution**: It means that conditions must be satisfied to pod be scheduled (hard requirement).\n- **preferredDuringSchedulingIgnoredDuringExecution**: If a condition can be satisfied, it will be satisfied. But if not, it will be ignored (soft requirement).\n- **podAffinityTerm**: The pod affinity term defines which pods we select with a label selector and which node topology key we target.\n\nA soft requirement has `podAffinityTerm` as separate property with an additional weight parameter that defines which term is more important. A hard requirement has an affinity term as a root list item object. For the hard affinity rule, all affinity terms and all expressions should be satisfied for the pod to be scheduled.\n\n## Wrap Up\n\nIn this blog post, we explore the lesser-known features of Kubernetes that play an important role in keeping Kubernetes clusters running smoothly. We discuss **Pod Topology Spread Constraints**, **pod-deletion-cost**, **maxUnavailable**, **Pod Disruption Budgets**, and **PriorityClasses**. These features help ensure high availability and reliability in Kubernetes clusters, making them essential for managing Kubernetes workloads effectively.\n\n![hat](./hat.png)\n\n<br>\n\n**_Until next time, つづく 🎉_**\n\n> 💡 Thank you for Reading !! 🙌🏻😁📃, see you in the next blog.🤘  **_Until next time 🎉_**\n\n🚀 Thank you for sticking up till the end. If you have any questions/feedback regarding this blog feel free to connect with me:\n\n**♻️ LinkedIn:** https://www.linkedin.com/in/rajhi-saif/\n\n**♻️ X/Twitter:** https://x.com/rajhisaifeddine\n\n**The end ✌🏻**\n\n<h1 align=\"center\">🔰 Keep Learning !! Keep Sharing !! 🔰</h1>\n\n**📅 Stay updated**\n\nSubscribe to our newsletter for more insights on AWS cloud computing and containers.\n","wordCount":{"words":1512},"frontmatter":{"id":"0e195ee5f970d8ac4a0c1023","path":"/blog/unsung-kubernetes-features-reliable-resilient/","humanDate":"Oct 24, 2024","fullDate":"2024-10-24","title":"Unsung Kubernetes Features that Keep Kubernetes Clusters Reliable and Resilient","keywords":["Kubernetes","High Availability","Resilience","Kubernetes Features"],"excerpt":"Discover the hidden gems within Kubernetes that ensure your clusters remain highly available and resilient.","cover":{"childImageSharp":{"gatsbyImageData":{"layout":"fullWidth","placeholder":{"fallback":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAACaklEQVR42k1SyW4TQRT0H3LiyA9w4ICEhED8QHLkwo2LOSBxiAQkBAGJiIgCUeKQjGN74m083TO9TM++2JOleDNGiEOpul+3SlXvvc5ApOjzELaIESUpiiJHksQwgUGgFbFAFKp/CAO5PhuFONR01vC9BcbjEeI4RsfyEsw4w2Boodc7Rt/qYTS8wJU9gJIcRZUgK1PkhGqZoVymSIqkRUpY1TkZCcD4HJoMdFSUIIwDJLGAZZ3AHp2jyJu7JgcSA1/j9aGNLwMXfS/A9yuOHWuB9+cO9m2Onqvw0XIx1yH9N+gUeQYpfVIXCJSkiIqiSnIn2hruKsRlhh8Tjp8zH2euxNHUw4kjcMEUeguJ+qZCXTc6Ap08zxGQSBQFBHJFbKhP4/FVK1hfF8hXeSt2TGgcn5JInytiEiWurytUVUo6Gp0kSaiZGkq54GwKZ27DGI+aLagvjKI28eZtvF8k+HXAiBshjW3Lwd6I4duQ4bfjkQESzLIMWvnkjiZo1hONyWlA7hTVK3K3rMv/UGBFtbqp05Aa3FCKoozXQynLslVWilbEBC2UlO2dcxceG0IJG5LQsPDGcH0HC7WAKxs4YMIBd6cUOV5HloJR3BmmkyFY86A5rsmJMRJysQExewR/9gTe9CEM72JLj7Cx2MdL7xCb7AAfQgs1rZWSJ+vIUSSxWia0LgYVWa9XKW5vK3i0sN70Geyz+xiePcDl6T1I5xXeZRM8n3/C44Muno53sFVMcLO6A59vopOmpKxEO91m66O/HBrdRmbOFrT3Bsp7S9yF7+7hyJ9iV13iM7vAruzj2N+GEbvQ7gv8ASZdJMEIMEe1AAAAAElFTkSuQmCC"},"images":{"fallback":{"src":"/static/09e20fec65f88b9bfdec8ebe1d3285dc/40ae5/unsung-k8s.png","srcSet":"/static/09e20fec65f88b9bfdec8ebe1d3285dc/dc458/unsung-k8s.png 750w,\n/static/09e20fec65f88b9bfdec8ebe1d3285dc/46f54/unsung-k8s.png 1080w,\n/static/09e20fec65f88b9bfdec8ebe1d3285dc/58134/unsung-k8s.png 1366w,\n/static/09e20fec65f88b9bfdec8ebe1d3285dc/40ae5/unsung-k8s.png 1600w","sizes":"100vw"},"sources":[{"srcSet":"/static/09e20fec65f88b9bfdec8ebe1d3285dc/4ff4a/unsung-k8s.webp 750w,\n/static/09e20fec65f88b9bfdec8ebe1d3285dc/0220e/unsung-k8s.webp 1080w,\n/static/09e20fec65f88b9bfdec8ebe1d3285dc/2da9e/unsung-k8s.webp 1366w,\n/static/09e20fec65f88b9bfdec8ebe1d3285dc/50456/unsung-k8s.webp 1600w","type":"image/webp","sizes":"100vw"}]},"width":1,"height":0.55125}}},"coverCredits":"Photo by Saifeddine Rajhi"}}},"pageContext":{"prevThought":{"frontmatter":{"path":"/blog/data-on-kubernetes-cloudnativepg-ceph-2/","title":"Data on Kubernetes: Part 2 - Deploying Databases in K8s with PostgreSQL, CloudNative-PG, and Ceph Rook on Amazon EKS","date":"2024-10-25 13:06:00"},"excerpt":"Data persistence: running PostgreSQL on Amazon EKS 🎆 Introduction PostgreSQL, the well-known open-source relational database, is a popular…","html":"<blockquote>\n<p><strong>Data persistence: running PostgreSQL on Amazon EKS</strong></p>\n</blockquote>\n<h2 id=\"-introduction\" style=\"position:relative;\"><a href=\"#-introduction\" aria-label=\" introduction permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>🎆 Introduction</h2>\n<p><a href=\"https://www.postgresql.org/\" target=\"_blank\" rel=\"noopener noreferrer\">PostgreSQL</a>, the well-known open-source <a href=\"https://en.wikipedia.org/wiki/Relational_database\" target=\"_blank\" rel=\"noopener noreferrer\">relational database</a>, is a popular choice for applications demanding scalability, reliability, and ease of management.</p>\n<p>But how can we deploy and run PostgreSQL in a Kubernetes environment to handle the stored data? 🤔</p>\n<p>In this blog post, we'll explore how to combine <a href=\"https://github.com/cloudnative-pg/cloudnative-pg\" target=\"_blank\" rel=\"noopener noreferrer\">CloudNative-PG</a> (a PostgreSQL operator) and <a href=\"https://rook.io/\" target=\"_blank\" rel=\"noopener noreferrer\">Ceph Rook</a> (a storage orchestrator) to create a PostgreSQL cluster that scales easily, recovers from failures, and ensures data persistence — all within an <a href=\"https://docs.aws.amazon.com/eks/latest/userguide/what-is-eks.html\" target=\"_blank\" rel=\"noopener noreferrer\">Amazon Elastic Kubernetes Service EKS cluster</a>.</p>\n<h2 id=\"-databases-on-k8seks\" style=\"position:relative;\"><a href=\"#-databases-on-k8seks\" aria-label=\" databases on k8seks permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>💥 Databases on K8S/EKS</h2>\n<p>Running databases and query engines on Kubernetes can offer benefits, but it's important to consider the trade-offs.</p>\n<h3 id=\"️-benefits-of-running-databases-on-kubernetes\" style=\"position:relative;\"><a href=\"#%EF%B8%8F-benefits-of-running-databases-on-kubernetes\" aria-label=\"️ benefits of running databases on kubernetes permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>☑️ Benefits of Running Databases on Kubernetes</h3>\n<ul>\n<li><strong>Automated deployment</strong>: Kubernetes simplifies deploying databases by automating the process and it aligns with DevOps practices and infrastructure as code.</li>\n<li><strong>Scaling</strong>: Kubernetes allows automatic scaling based on workload demands.</li>\n<li><strong>Rolling updates</strong>: It supports seamless updates without downtime.</li>\n<li><strong>Self-healing</strong>: Kubernetes ensures high availability by automatically recovering from failures.</li>\n<li><strong>Portability</strong>: Kubernetes provides a consistent environment across different clusters and cloud providers.</li>\n<li><strong>Cost-effectiveness</strong>: Kubernetes optimizes resource utilization.</li>\n</ul>\n<h3 id=\"️-challenges-and-considerations\" style=\"position:relative;\"><a href=\"#%EF%B8%8F-challenges-and-considerations\" aria-label=\"️ challenges and considerations permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>☑️ Challenges and Considerations</h3>\n<ul>\n<li><strong>Statefulness</strong>: Databases are stateful, and managing state in a transient environment (like Kubernetes pods) can be complex.</li>\n<li><strong>Transient pods</strong>: Pods can restart or fail over, affecting database availability.</li>\n<li><strong>Abstractions</strong>: Containerization introduces abstractions that impact database-specific tasks (e.g., backups, scaling).</li>\n<li><strong>DIY on VM</strong>: Full control but more operational overhead.</li>\n<li><a href=\"https://cloud.google.com/blog/products/databases/to-run-or-not-to-run-a-database-on-kubernetes-what-to-consider\" target=\"_blank\" rel=\"noopener noreferrer\">Kubernetes: Closer to full control, but still requires careful planning</a>.</li>\n</ul>\n<h3 id=\"️-popular-databases-on-kubernetes\" style=\"position:relative;\"><a href=\"#%EF%B8%8F-popular-databases-on-kubernetes\" aria-label=\"️ popular databases on kubernetes permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>☑️ Popular Databases on Kubernetes</h3>\n<ul>\n<li><strong>Apache Cassandra</strong>: Scalable, distributed NoSQL database.</li>\n<li><strong>PostgreSQL</strong>: Supports Kubernetes through operators (e.g., cnpg).</li>\n<li><strong>MySQL, MongoDB, and others</strong>.</li>\n</ul>\n<blockquote>\n<p><a href=\"https://sealos.io/blog/to-run-or-not-to-run-a-database-on-kubernetes\" target=\"_blank\" rel=\"noopener noreferrer\">Many teams successfully run databases on Kubernetes in production, but it requires thoughtful planning and understanding of trade-offs</a>.</p>\n</blockquote>\n<h2 id=\"-deploying-cloudnative-pg-with-ceph-rook-on-aws-eks\" style=\"position:relative;\"><a href=\"#-deploying-cloudnative-pg-with-ceph-rook-on-aws-eks\" aria-label=\" deploying cloudnative pg with ceph rook on aws eks permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>🚀 Deploying CloudNative-PG with Ceph Rook on AWS EKS</h2>\n<p><strong>CloudNativePG</strong> is an open-source <a href=\"https://kubernetes.io/docs/concepts/extend-kubernetes/operator/\" target=\"_blank\" rel=\"noopener noreferrer\">Level 5 operator</a> designed to manage PostgreSQL workloads on any Kubernetes cluster. It simplifies the deployment, management, and recovery of PostgreSQL instances within Kubernetes. Here are some key features:</p>\n<ul>\n<li><strong>High availability</strong>: CloudNativePG covers the full lifecycle of a highly available PostgreSQL database cluster with a primary/standby architecture, using native streaming replication.</li>\n<li><strong>Automated failover</strong>: It automates tasks that a human operator would perform, including failover.</li>\n<li><strong>Data persistence</strong>: Unlike relying on stateful sets, CloudNativePG manages persistent volume claims for storing PGDATA.</li>\n<li><strong>Declarative configuration</strong>: It directly integrates with the Kubernetes API server, eliminating the need for an external failover management tool.</li>\n<li><strong>Cloud Native</strong>: Built on DevOps concepts like immutable infrastructure and declarative configuration, it leverages Kubernetes for self-healing, high availability, and more.</li>\n<li><strong>Security &#x26; TLS</strong>: Supports security contexts, encrypted TLS connections, and client authentication.</li>\n<li><strong>Monitoring</strong>: Includes a Prometheus exporter for metrics and transparent log integration.</li>\n<li><strong>Advanced architectures</strong>: Extend the architecture with PgBouncer or create disaster recovery clusters.</li>\n</ul>\n<blockquote>\n<p>CloudNativePG was originally developed by <a href=\"https://www.enterprisedb.com/\" target=\"_blank\" rel=\"noopener noreferrer\">EDB</a>, released under the Apache License 2.0, and submitted to CNCF Sandbox in April 2022.</p>\n</blockquote>\n<p><strong>Rook</strong> is an open-source cloud-native storage orchestrator designed for Kubernetes. Its purpose is to provide a platform, framework, and support for <a href=\"https://docs.ceph.com/en/latest/rados/\" target=\"_blank\" rel=\"noopener noreferrer\">Ceph storage</a> to seamlessly integrate with Kubernetes. Here are some key points about Rook:</p>\n<ul>\n<li><strong>Ceph integration</strong>: Rook enables Ceph, a distributed storage system that offers file, block, and object storage, to be deployed and managed within Kubernetes clusters.</li>\n<li><strong>Automation and management</strong>: Rook automates the deployment, configuration, provisioning, scaling, upgrading, and monitoring of Ceph. It ensures self-managing, self-scaling, and self-healing storage services.</li>\n<li><strong>Stability and compatibility</strong>: The status of the Ceph storage provider in Rook is stable. Upgrades between versions maintain backward compatibility.</li>\n<li><strong>CNCF project</strong>: Rook is hosted by the Cloud Native Computing Foundation (CNCF) as a graduated-level project.</li>\n</ul>\n<p>Now let's start the deployment process.</p>\n<h2 id=\"hands-on-demo\" style=\"position:relative;\"><a href=\"#hands-on-demo\" aria-label=\"hands on demo permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Hands-on Demo</h2>\n<p>First, you can get the code and clone the repo:</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token function\">git</span> clone git@github.com:seifrajhi/data-on-eks.git</code></pre></div>\n<p>After that, run the <code class=\"language-text\">deploy.sh</code> script which deploys an <strong>EKS cluster</strong> to the <code class=\"language-text\">eu-west-1</code> region.</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token builtin class-name\">cd</span> distributed-databases/cloudnative-postgres/\n\n<span class=\"token function\">chmod</span> +x install.sh\n\n./install.sh</code></pre></div>\n<p>Once the script ends, you can run the below command to update the local kubeconfig so we can access the Kubernetes cluster:</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">aws eks update-kubeconfig <span class=\"token parameter variable\">--name</span> cnpg-on-eks <span class=\"token parameter variable\">--region</span> eu-west-1</code></pre></div>\n<p>Next, you can verify if all the pods are running:</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">kubectl get pods <span class=\"token parameter variable\">-n</span><span class=\"token operator\">=</span>cnpg-system\nNAME                                          READY   STATUS    RESTARTS   AGE\ncnpg-on-eks-cloudnative-pg-412d5a5fd8-amuz   <span class=\"token number\">1</span>/1     Running   <span class=\"token number\">0</span>          11m</code></pre></div>\n<h3 id=\"️-setup-rook-for-storage\" style=\"position:relative;\"><a href=\"#%EF%B8%8F-setup-rook-for-storage\" aria-label=\"️ setup rook for storage permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>🏗️ Setup Rook for Storage</h3>\n<p>Rook has published the following Helm charts for the Ceph storage provider:</p>\n<ul>\n<li><a href=\"https://rook.io/docs/rook/latest-release/Helm-Charts/operator-chart/\" target=\"_blank\" rel=\"noopener noreferrer\">Rook Ceph Operator</a>: Starts the Ceph Operator, which will watch for Ceph CRs (custom resources).</li>\n<li><a href=\"https://rook.io/docs/rook/latest-release/Helm-Charts/ceph-cluster-chart/\" target=\"_blank\" rel=\"noopener noreferrer\">Rook Ceph Cluster</a>: Creates Ceph CRs that the operator will use to configure the cluster.</li>\n</ul>\n<h4 id=\"-rook-ceph-operator\" style=\"position:relative;\"><a href=\"#-rook-ceph-operator\" aria-label=\" rook ceph operator permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>📦 Rook Ceph Operator</h4>\n<p>Installs Rook to create, configure, and manage Ceph clusters on Kubernetes.</p>\n<p>This chart bootstraps a <a href=\"https://github.com/rook/rook\" target=\"_blank\" rel=\"noopener noreferrer\">rook-ceph-operator</a> deployment on a Kubernetes cluster using the Helm package manager.</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">helm repo <span class=\"token function\">add</span> rook-release https://charts.rook.io/release\nhelm <span class=\"token function\">install</span> --create-namespace <span class=\"token parameter variable\">--namespace</span> rook-ceph rook-ceph rook-release/rook-ceph <span class=\"token parameter variable\">-f</span> values.yaml</code></pre></div>\n<p>For customized settings, you can check the <a href=\"https://github.com/rook/rook/tree/release-1.14/deploy/charts/rook-ceph/values.yaml\" target=\"_blank\" rel=\"noopener noreferrer\">values.yaml</a> file.</p>\n<h4 id=\"️-ceph-cluster\" style=\"position:relative;\"><a href=\"#%EF%B8%8F-ceph-cluster\" aria-label=\"️ ceph cluster permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>🏗️ Ceph Cluster</h4>\n<p>Creates Rook resources to configure a Ceph cluster using the Helm package manager.</p>\n<p>Before installing, review the <code class=\"language-text\">values.yaml</code> to confirm if the default settings need to be updated.</p>\n<ul>\n<li>If the operator was installed in a namespace other than <code class=\"language-text\">rook-ceph</code>, the namespace must be set in the <code class=\"language-text\">operatorNamespace</code> variable.</li>\n<li>Set the desired settings in the <code class=\"language-text\">cephClusterSpec</code>. <a href=\"https://github.com/rook/rook/tree/release-1.14/deploy/charts/rook-ceph-cluster/values.yaml\" target=\"_blank\" rel=\"noopener noreferrer\">The defaults</a> are only an example and not likely to apply to your cluster.</li>\n<li>The monitoring section should be removed from the <code class=\"language-text\">cephClusterSpec</code>, as it is specified separately in the Helm settings.</li>\n<li>The default values for <code class=\"language-text\">cephBlockPools</code>, <code class=\"language-text\">cephFileSystems</code>, and <code class=\"language-text\">CephObjectStores</code> will create one of each, and their corresponding storage classes.</li>\n</ul>\n<p>All Ceph components now have default values for the pod resources. The resources may need to be adjusted in production clusters depending on the load. The resources can also be disabled if Ceph should not be limited (e.g., test clusters).</p>\n<p>The below command assumes you have first created a customized <code class=\"language-text\">values.yaml</code> file:</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">helm <span class=\"token function\">install</span> --create-namespace <span class=\"token parameter variable\">--namespace</span> rook-ceph rook-ceph-cluster <span class=\"token punctuation\">\\</span>\n    <span class=\"token parameter variable\">--set</span> <span class=\"token assign-left variable\">operatorNamespace</span><span class=\"token operator\">=</span>rook-ceph rook-release/rook-ceph-cluster <span class=\"token parameter variable\">-f</span> values.yaml</code></pre></div>\n<h4 id=\"-provision-storage\" style=\"position:relative;\"><a href=\"#-provision-storage\" aria-label=\" provision storage permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>📦 Provision Storage</h4>\n<p>Before Rook can provision storage, a <a href=\"https://kubernetes.io/docs/concepts/storage/storage-classes\" target=\"_blank\" rel=\"noopener noreferrer\">StorageClass</a> and <a href=\"https://rook.io/docs/rook/latest-release/CRDs/Block-Storage/ceph-block-pool-crd/\" target=\"_blank\" rel=\"noopener noreferrer\">CephBlockPool</a> CR need to be created. This will allow Kubernetes to interoperate with Rook when provisioning persistent volumes.</p>\n<p>Save this StorageClass definition as <strong>storageclass.yaml</strong>:</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token punctuation\">---</span>\n<span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> ceph.rook.io/v1\n<span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> CephBlockPool\n<span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> replicapool\n  <span class=\"token key atrule\">namespace</span><span class=\"token punctuation\">:</span> rook<span class=\"token punctuation\">-</span>ceph <span class=\"token comment\"># namespace:cluster</span>\n<span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">failureDomain</span><span class=\"token punctuation\">:</span> host\n  <span class=\"token key atrule\">replicated</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">size</span><span class=\"token punctuation\">:</span> <span class=\"token number\">3</span>\n    <span class=\"token key atrule\">requireSafeReplicaSize</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span>\n<span class=\"token punctuation\">---</span>\n<span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> storage.k8s.io/v1\n<span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> StorageClass\n<span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> rook<span class=\"token punctuation\">-</span>ceph<span class=\"token punctuation\">-</span>block\n<span class=\"token key atrule\">provisioner</span><span class=\"token punctuation\">:</span> rook<span class=\"token punctuation\">-</span>ceph.rbd.csi.ceph.com <span class=\"token comment\"># csi-provisioner-name</span>\n<span class=\"token key atrule\">parameters</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">clusterID</span><span class=\"token punctuation\">:</span> rook<span class=\"token punctuation\">-</span>ceph \n  <span class=\"token key atrule\">pool</span><span class=\"token punctuation\">:</span> replicapool\n  <span class=\"token key atrule\">imageFormat</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"2\"</span>\n  <span class=\"token key atrule\">imageFeatures</span><span class=\"token punctuation\">:</span> layering\n  <span class=\"token key atrule\">csi.storage.k8s.io/provisioner-secret-name</span><span class=\"token punctuation\">:</span> rook<span class=\"token punctuation\">-</span>csi<span class=\"token punctuation\">-</span>rbd<span class=\"token punctuation\">-</span>provisioner\n  <span class=\"token key atrule\">csi.storage.k8s.io/provisioner-secret-namespace</span><span class=\"token punctuation\">:</span> rook<span class=\"token punctuation\">-</span>ceph <span class=\"token comment\"># namespace:cluster</span>\n  <span class=\"token key atrule\">csi.storage.k8s.io/controller-expand-secret-name</span><span class=\"token punctuation\">:</span> rook<span class=\"token punctuation\">-</span>csi<span class=\"token punctuation\">-</span>rbd<span class=\"token punctuation\">-</span>provisioner\n  <span class=\"token key atrule\">csi.storage.k8s.io/controller-expand-secret-namespace</span><span class=\"token punctuation\">:</span> rook<span class=\"token punctuation\">-</span>ceph <span class=\"token comment\"># namespace:cluster</span>\n  <span class=\"token key atrule\">csi.storage.k8s.io/node-stage-secret-name</span><span class=\"token punctuation\">:</span> rook<span class=\"token punctuation\">-</span>csi<span class=\"token punctuation\">-</span>rbd<span class=\"token punctuation\">-</span>node\n  <span class=\"token key atrule\">csi.storage.k8s.io/node-stage-secret-namespace</span><span class=\"token punctuation\">:</span> rook<span class=\"token punctuation\">-</span>ceph <span class=\"token comment\"># namespace:cluster</span>\n  <span class=\"token key atrule\">csi.storage.k8s.io/fstype</span><span class=\"token punctuation\">:</span> ext4\n<span class=\"token key atrule\">allowVolumeExpansion</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span>\n<span class=\"token key atrule\">reclaimPolicy</span><span class=\"token punctuation\">:</span> Delete</code></pre></div>\n<p>Then apply it</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">kubectl apply <span class=\"token parameter variable\">-f</span> storageclass.yaml</code></pre></div>\n<h3 id=\"-deploy-a-postgresql-cluster\" style=\"position:relative;\"><a href=\"#-deploy-a-postgresql-cluster\" aria-label=\" deploy a postgresql cluster permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>🚀 Deploy a PostgreSQL Cluster</h3>\n<p>As with any other deployment in Kubernetes, to deploy a PostgreSQL cluster you need to apply a configuration file that defines your desired Cluster. The CloudNativePG operator offers two types of bootstrapping a new database:</p>\n<ol>\n<li><strong>Bootstrap an empty cluster</strong></li>\n<li><strong>Bootstrap from another cluster</strong></li>\n</ol>\n<p>In this demo, we are going to create a new empty database cluster using <code class=\"language-text\">initdb</code> flags. We will use the template below by modifying the IAM role for IRSA configuration and the S3 bucket for the backup restore process and WAL archiving.</p>\n<p>The Terraform script has already created these resources. Use the Terraform output to extract these parameters:</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">terraform output\ndemo_backup_irsa <span class=\"token operator\">=</span> <span class=\"token string\">\"arn:aws:iam::&lt;your_account_id>:role/cnpg-on-eks-prod-irsa\"</span>\ndemo_s3_bucket <span class=\"token operator\">=</span> <span class=\"token string\">\"xyz-cnpg-demo-bucket\"</span>\nconfigure_kubectl <span class=\"token operator\">=</span> <span class=\"token string\">\"aws eks --region eu-west-1 update-kubeconfig --name cnpg-on-eks\"</span></code></pre></div>\n<ul>\n<li><strong>IRSA Configuration</strong>: <code class=\"language-text\">arn:aws:iam::&lt;your_account_id>:role/cnpg-on-eks-prod-irsa</code></li>\n<li><strong>S3 Bucket</strong>: <code class=\"language-text\">xyz-cnpg-demo-bucket</code></li>\n</ul>\n<p>For more information on configuring IAM roles for service accounts (IRSA), refer to the <a href=\"https://docs.aws.amazon.com/eks/latest/userguide/iam-roles-for-service-accounts.html\" target=\"_blank\" rel=\"noopener noreferrer\">AWS documentation</a>.</p>\n<p>For details on setting up S3 buckets for backups, check the <a href=\"https://docs.aws.amazon.com/AmazonS3/latest/userguide/Welcome.html\" target=\"_blank\" rel=\"noopener noreferrer\">AWS S3 documentation</a>.</p>\n<p>Now, we are ready to deploy a CloudNativePG database cluster.</p>\n<p><strong>demo-cnpg-cluster.yaml</strong>:</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> postgresql.cnpg.io/v1\n<span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> Cluster\n<span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> demo<span class=\"token punctuation\">-</span>cnpg\n  <span class=\"token key atrule\">namespace</span><span class=\"token punctuation\">:</span> demo\n<span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">description</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"Cluster Demo for DoEKS\"</span>\n  <span class=\"token comment\"># Choose your PostGres Database Version</span>\n  <span class=\"token key atrule\">imageName</span><span class=\"token punctuation\">:</span> ghcr.io/cloudnative<span class=\"token punctuation\">-</span>pg/postgresql<span class=\"token punctuation\">:</span><span class=\"token number\">15.2</span>\n  <span class=\"token comment\"># Number of Replicas</span>\n  <span class=\"token key atrule\">instances</span><span class=\"token punctuation\">:</span> <span class=\"token number\">3</span>\n  <span class=\"token key atrule\">startDelay</span><span class=\"token punctuation\">:</span> <span class=\"token number\">300</span>\n  <span class=\"token key atrule\">stopDelay</span><span class=\"token punctuation\">:</span> <span class=\"token number\">300</span>\n  <span class=\"token key atrule\">replicationSlots</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">highAvailability</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">enabled</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span>\n    <span class=\"token key atrule\">updateInterval</span><span class=\"token punctuation\">:</span> <span class=\"token number\">300</span>\n  <span class=\"token key atrule\">primaryUpdateStrategy</span><span class=\"token punctuation\">:</span> unsupervised\n  <span class=\"token key atrule\">serviceAccountTemplate</span><span class=\"token punctuation\">:</span>\n    <span class=\"token comment\"># For backup and restore, we use IRSA for demo tool.</span>\n    <span class=\"token comment\"># You will find this IAM role on terraform outputs.</span>\n    <span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">annotations</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">eks.amazonaws.com/role-arn</span><span class=\"token punctuation\">:</span> arn<span class=\"token punctuation\">:</span>aws<span class=\"token punctuation\">:</span>iam<span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span>&lt;&lt;account_id<span class=\"token punctuation\">></span><span class=\"token punctuation\">></span><span class=\"token punctuation\">:</span>role/cnpg<span class=\"token punctuation\">-</span>on<span class=\"token punctuation\">-</span>eks<span class=\"token punctuation\">-</span>prod<span class=\"token punctuation\">-</span>irsa <span class=\"token comment\">#1</span>\n  <span class=\"token key atrule\">postgresql</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">parameters</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">shared_buffers</span><span class=\"token punctuation\">:</span> 256MB\n      <span class=\"token key atrule\">pg_stat_statements.max</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'10000'</span>\n      <span class=\"token key atrule\">pg_stat_statements.track</span><span class=\"token punctuation\">:</span> all\n      <span class=\"token key atrule\">auto_explain.log_min_duration</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'10s'</span>\n    <span class=\"token key atrule\">pg_hba</span><span class=\"token punctuation\">:</span>\n      <span class=\"token comment\"># - hostssl app all all cert</span>\n      <span class=\"token punctuation\">-</span> host app app all password\n  <span class=\"token key atrule\">logLevel</span><span class=\"token punctuation\">:</span> debug\n  <span class=\"token key atrule\">storage</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">storageClass</span><span class=\"token punctuation\">:</span> rook<span class=\"token punctuation\">-</span>ceph<span class=\"token punctuation\">-</span>block\n    <span class=\"token key atrule\">size</span><span class=\"token punctuation\">:</span> 1Gi\n  <span class=\"token key atrule\">walStorage</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">storageClass</span><span class=\"token punctuation\">:</span> rook<span class=\"token punctuation\">-</span>ceph<span class=\"token punctuation\">-</span>block\n    <span class=\"token key atrule\">size</span><span class=\"token punctuation\">:</span> 1Gi\n  <span class=\"token key atrule\">monitoring</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">enablePodMonitor</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span>\n  <span class=\"token key atrule\">bootstrap</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">initdb</span><span class=\"token punctuation\">:</span> <span class=\"token comment\"># Deploying a new cluster</span>\n      <span class=\"token key atrule\">database</span><span class=\"token punctuation\">:</span> WorldDB\n      <span class=\"token key atrule\">owner</span><span class=\"token punctuation\">:</span> app\n      <span class=\"token key atrule\">secret</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> app<span class=\"token punctuation\">-</span>auth\n  <span class=\"token key atrule\">backup</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">barmanObjectStore</span><span class=\"token punctuation\">:</span>\n    <span class=\"token comment\"># For backup, we S3 bucket to store data.</span>\n    <span class=\"token comment\"># On this Blueprint, we create an S3 check the terraform output for it.</span>\n      <span class=\"token key atrule\">destinationPath</span><span class=\"token punctuation\">:</span> s3<span class=\"token punctuation\">:</span>//&lt;your<span class=\"token punctuation\">-</span>s3<span class=\"token punctuation\">-</span>demo<span class=\"token punctuation\">-</span>bucket<span class=\"token punctuation\">></span> <span class=\"token comment\">#2</span>\n      <span class=\"token key atrule\">s3Credentials</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">inheritFromIAMRole</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span>\n      <span class=\"token key atrule\">wal</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">compression</span><span class=\"token punctuation\">:</span> gzip\n        <span class=\"token key atrule\">maxParallel</span><span class=\"token punctuation\">:</span> <span class=\"token number\">8</span>\n    <span class=\"token key atrule\">retentionPolicy</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"30d\"</span>\n\n  <span class=\"token key atrule\">resources</span><span class=\"token punctuation\">:</span> <span class=\"token comment\"># m5large: m5xlarge 2vCPU, 8GI RAM</span>\n    <span class=\"token key atrule\">requests</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">memory</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"512Mi\"</span>\n      <span class=\"token key atrule\">cpu</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"1\"</span>\n    <span class=\"token key atrule\">limits</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">memory</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"1Gi\"</span>\n      <span class=\"token key atrule\">cpu</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"2\"</span>\n\n  <span class=\"token key atrule\">affinity</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">enablePodAntiAffinity</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span>\n    <span class=\"token key atrule\">topologyKey</span><span class=\"token punctuation\">:</span> failure<span class=\"token punctuation\">-</span>domain.beta.kubernetes.io/zone\n\n  <span class=\"token key atrule\">nodeMaintenanceWindow</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">inProgress</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">false</span>\n    <span class=\"token key atrule\">reusePVC</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">false</span></code></pre></div>\n<p>Once updated, you can apply your template.</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">kubectl apply <span class=\"token parameter variable\">-f</span> demo-cnpg-cluster.yaml</code></pre></div>\n<p>Now you can check Cluster status is by using cloudnative-pg kubectl plugin offered by the CloudNativePG community.</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">$ kubectl cnpg status demo-cnpg\nCluster Summary\nName:               demo-cnpg\nNamespace:          demo\nSystem ID:          <span class=\"token number\">7214866198623563798</span>\nPostgreSQL Image:   ghcr.io/cloudnative-pg/postgresql:15.2\nPrimary instance:   demo-cnpg-1\nStatus:             Cluster <span class=\"token keyword\">in</span> healthy state\nInstances:          <span class=\"token number\">3</span>\nReady instances:    <span class=\"token number\">3</span>\nCurrent Write LSN:  <span class=\"token number\">0</span>/6000000 <span class=\"token punctuation\">(</span>Timeline: <span class=\"token number\">1</span> - WAL File: 000000010000000000000005<span class=\"token punctuation\">)</span>\nCertificates Status\nCertificate Name  Expiration Date                Days Left Until Expiration\n----------------  ---------------                --------------------------\ndemo-cnpg-ca           <span class=\"token number\">2024</span>-07-14 <span class=\"token number\">14</span>:40:27 +0000 UTC  <span class=\"token number\">89.96</span>\ndemo-cnpg-replication  <span class=\"token number\">2024</span>-07-14 <span class=\"token number\">14</span>:40:27 +0000 UTC  <span class=\"token number\">89.96</span>\ndemo-cnpg-server       <span class=\"token number\">2024</span>-07-14 <span class=\"token number\">14</span>:40:27 +0000 UTC  <span class=\"token number\">89.96</span>\n\nContinuous Backup status\nFirst Point of Recoverability:  Not Available\nWorking WAL archiving:          OK\nWALs waiting to be archived:    <span class=\"token number\">0</span>\nLast Archived WAL:              000000010000000000000005   @   <span class=\"token number\">2024</span>-07-01T14:52:09.24307Z\nLast Failed WAL:                -\n\nStreaming Replication status\nReplication Slots Enabled\nName    Sent LSN   Write LSN  Flush LSN  Replay LSN  Write Lag  Flush Lag  Replay Lag  State      Sync State  Sync Priority  Replication Slot\n----    --------   ---------  ---------  ----------  ---------  ---------  ----------  -----      ----------  -------------  ----------------\ndemo-cnpg-2  <span class=\"token number\">0</span>/6000000  <span class=\"token number\">0</span>/6000000  <span class=\"token number\">0</span>/6000000  <span class=\"token number\">0</span>/6000000   00:00:00   00:00:00   00:00:00    streaming  async       <span class=\"token number\">0</span>              active\ndemo-cnpg-3  <span class=\"token number\">0</span>/6000000  <span class=\"token number\">0</span>/6000000  <span class=\"token number\">0</span>/6000000  <span class=\"token number\">0</span>/6000000   00:00:00   00:00:00   00:00:00    streaming  async       <span class=\"token number\">0</span>              active\n\nUnmanaged Replication Slot Status\nNo unmanaged replication slots found\n\nInstances status\nName    Database Size  Current LSN  Replication role  Status  QoS         Manager Version  Node\n----    -------------  -----------  ----------------  ------  ---         ---------------  ----\ndemo-cnpg-1  <span class=\"token number\">29</span> MB          <span class=\"token number\">0</span>/6000000    Primary           OK      BestEffort  <span class=\"token number\">1.19</span>.0           ip-10-1-10-111.eu-west-1.compute.internal\ndemo-cnpg-2  <span class=\"token number\">29</span> MB          <span class=\"token number\">0</span>/6000000    Standby <span class=\"token punctuation\">(</span>async<span class=\"token punctuation\">)</span>   OK      BestEffort  <span class=\"token number\">1.19</span>.0           ip-10-1-12-144.eu-west-1.compute.internal\ndemo-cnpg-3  <span class=\"token number\">29</span> MB          <span class=\"token number\">0</span>/6000000    Standby <span class=\"token punctuation\">(</span>async<span class=\"token punctuation\">)</span>   OK      BestEffort  <span class=\"token number\">1.19</span>.0           ip-10-1-11-78.eu-west-1.compute.internal</code></pre></div>\n<p>And there are more to discover like backup, monitoring, etc.</p>\n<h2 id=\"key-takeaways\" style=\"position:relative;\"><a href=\"#key-takeaways\" aria-label=\"key takeaways permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Key takeaways</h2>\n<p>When running PostgreSQL on Amazon EKS, it's important to ensure data persistence in Kubernetes. Tools like CloudNativePG help manage highly available PostgreSQL clusters with native streaming replication, ensuring data durability and seamless failover.</p>\n<p><strong>Stay tuned for next blogs in this series🎉</strong></p>\n<p><strong>References:</strong></p>\n<ul>\n<li><a href=\"https://dok.community/blog/the-future-of-data-on-kubernetes\" target=\"_blank\" rel=\"noopener noreferrer\">https://dok.community/blog/the-future-of-data-on-kubernetes</a></li>\n<li><a href=\"https://www.reddit.com/r/kubernetes/comments/1dp062w/are_you_running_stateful_data_workloads_or/?sort=old\" target=\"_blank\" rel=\"noopener noreferrer\">https://www.reddit.com/r/kubernetes/comments/1dp062w/are_you_running_stateful_data_workloads_or/?sort=old</a></li>\n<li>\n<iframe width=\"100%\" height=\"315\" src=\"https://www.youtube-nocookie.com/embed/99uSJXkKpeI?rel=0\" frameborder=\"0\" allow=\"accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture\" allowfullscreen></iframe>\n</li>\n<li><a href=\"https://awslabs.github.io/data-on-eks/docs/blueprints/distributed-databases/cloudnative-postgres\" target=\"_blank\" rel=\"noopener noreferrer\">https://awslabs.github.io/data-on-eks/docs/blueprints/distributed-databases/cloudnative-postgres</a></li>\n<li><a href=\"https://sealos.io/blog/to-run-or-not-to-run-a-database-on-kubernetes\" target=\"_blank\" rel=\"noopener noreferrer\">https://sealos.io/blog/to-run-or-not-to-run-a-database-on-kubernetes</a></li>\n<li><a href=\"https://rook.io/docs/rook/latest-release/Getting-Started/intro/\" target=\"_blank\" rel=\"noopener noreferrer\">https://rook.io/docs/rook/latest-release/Getting-Started/intro/</a></li>\n<li><a href=\"https://cloudnative-pg.io/documentation/1.22/\" target=\"_blank\" rel=\"noopener noreferrer\">https://cloudnative-pg.io/documentation/1.22/</a></li>\n</ul>\n<p><strong>Thank You 🖤</strong></p>\n<br>\n<p><strong><em>Until next time, つづく 🎉</em></strong></p>\n<blockquote>\n<p>💡 Thank you for Reading !! 🙌🏻😁📃, see you in the next blog.🤘  <strong><em>Until next time 🎉</em></strong></p>\n</blockquote>\n<p>🚀 Thank you for sticking up till the end. If you have any questions/feedback regarding this blog feel free to connect with me:</p>\n<p><strong>♻️ LinkedIn:</strong> <a href=\"https://www.linkedin.com/in/rajhi-saif/\" target=\"_blank\" rel=\"noopener noreferrer\">https://www.linkedin.com/in/rajhi-saif/</a></p>\n<p><strong>♻️ X/Twitter:</strong> <a href=\"https://x.com/rajhisaifeddine\" target=\"_blank\" rel=\"noopener noreferrer\">https://x.com/rajhisaifeddine</a></p>\n<p><strong>The end ✌🏻</strong></p>\n<h1 align=\"center\">🔰 Keep Learning !! Keep Sharing !! 🔰</h1>\n<p><strong>📅 Stay updated</strong></p>\n<p>Subscribe to our newsletter for more insights on AWS cloud computing and containers.</p>"},"nextThought":{"frontmatter":{"path":"/blog/sysdig-docker-scout-cloud-native-security/","title":"Sysdig and Docker Forge Alliance to Accelerate Cloud-Native Security: Docker Scout🐳","date":"2024-10-24 21:36:00"},"excerpt":"Shift Left and Shield Right with Prioritized Risk and Improved Security Posture 🐋 Introduction Docker and Sysdig are teaming up to make…","html":"<blockquote>\n<p><strong>Shift Left and Shield Right with Prioritized Risk and Improved Security Posture</strong></p>\n</blockquote>\n<h2 id=\"-introduction\" style=\"position:relative;\"><a href=\"#-introduction\" aria-label=\" introduction permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>🐋 Introduction</h2>\n<p><a href=\"https://www.docker.com/\" target=\"_blank\" rel=\"noopener noreferrer\">Docker</a> and <a href=\"https://sysdig.com/\" target=\"_blank\" rel=\"noopener noreferrer\">Sysdig</a> are teaming up to make cloud-native app delivery faster and safer. This partnership brings Sysdig's runtime insights into Docker Scout, giving developers useful information to manage risks and boost security.</p>\n<p>This collaboration is important for the cloud-native community because it combines two popular tools for container security and app delivery. Sysdig provides deep visibility into container environments, while Docker Scout helps find and fix security issues in container images.</p>\n<p>By merging these tools, Sysdig and Docker are helping developers secure their cloud-native apps throughout the development process. This is crucial in today's fast-moving and constantly changing threat landscape.</p>\n<blockquote>\n<p>TL;DR: <a href=\"https://www.docker.com/products/docker-scout/\" target=\"_blank\" rel=\"noopener noreferrer\">Docker Scout</a> is a set of software supply chain features integrated into Docker's user interfaces and CLI. These features offer comprehensive visibility into the structure and security of container images.</p>\n</blockquote>\n<h2 id=\"-goals-and-objectives\" style=\"position:relative;\"><a href=\"#-goals-and-objectives\" aria-label=\" goals and objectives permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>🥅 Goals and Objectives</h2>\n<p>In this blog post, we'll explore the new partnership between Sysdig and Docker and how it helps developers speed up and secure cloud-native app delivery.</p>\n<p><span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 54.70588235294118%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAAsTAAALEwEAmpwYAAABF0lEQVR42q2R207CQBCGeSOFtnveVkO0rUVFkXipgHolgkK80fgORvAOSXwTEh9D3sW/mbBIQ0xMaP5OdqfzzaklLjUT6r8KuJTaljYD4+AklCn4/4JhKz4rewG0XfG3yh6uFOeuAHwmIBxWYC/g2eHxSaPZaJ5ftNq33V799EwZ6zF+2eoMho9pVrPRLsmEO0BymDpE+m6vP/mYvr6NRuP3yRTPZ1JPojiczb6+5/O7/j1SPAyGT88vV9c3KLYys5C6uhfDBSH3Qe2IS/hlnGb7SYq2tY0gfEI9NF/ctpsHQm7GFU0EIYz8iFkujNqGzYsv7NIptQqNNGb9tvFSnAOcXfiJ12tgF1f4yb/gnJehFVrTIA7+ATMno4tkPtuPAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"scout\" title=\"\" src=\"/static/5171f27d03a9bb56c37fe3eea1c45e57/c5bb3/docker.png\" srcset=\"/static/5171f27d03a9bb56c37fe3eea1c45e57/04472/docker.png 170w,\n/static/5171f27d03a9bb56c37fe3eea1c45e57/9f933/docker.png 340w,\n/static/5171f27d03a9bb56c37fe3eea1c45e57/c5bb3/docker.png 680w,\n/static/5171f27d03a9bb56c37fe3eea1c45e57/b12f7/docker.png 1020w,\n/static/5171f27d03a9bb56c37fe3eea1c45e57/690c6/docker.png 1201w\" sizes=\"(max-width: 680px) 100vw, 680px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n    </span>\n          </p>\n<h2 id=\"️-sysdig-runtime-insights-and-docker-scout\" style=\"position:relative;\"><a href=\"#%EF%B8%8F-sysdig-runtime-insights-and-docker-scout\" aria-label=\"️ sysdig runtime insights and docker scout permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>☸️ Sysdig Runtime Insights and Docker Scout</h2>\n<p>Sysdig and Docker have announced an integration at <a href=\"https://www.dockercon.com/\" target=\"_blank\" rel=\"noopener noreferrer\">DockerCon</a>, <a href=\"https://www.docker.com/press-release/announces-new-local-cloud-products-to-accelerate-delivery-of-secure-apps/\" target=\"_blank\" rel=\"noopener noreferrer\">merging Sysdig runtime insights with Docker Scout</a>. This collaboration helps developers prioritize risk assessment within their CLI and simplifies vulnerability identification in container-based applications. Docker Scout, an event-based tool, enhances the development process by providing integrations with Sysdig, JFrog Artifactory, AWS ECR, BastionZero, GitHub, GitLab, CircleCI, and Jenkins, optimizing DevSecOps workflows.</p>\n<p>Eric Carter, a senior product marketing manager at Sysdig, highlights the importance of Docker Scout as a conduit for Sysdig's container image insights through its cloud-native application protection platform (CNAPP).</p>\n<p>During DockerCon, Docker, Inc. made <a href=\"https://docs.docker.com/scout/\" target=\"_blank\" rel=\"noopener noreferrer\">Docker Scout</a> generally available, marking a pivotal moment in streamlining the developer's inner-loop process for creating container-based applications. The goal is to improve developer productivity, reduce post-deployment vulnerabilities, and expedite image creation, potentially saving developers up to an hour per day per project.</p>\n<p>Furthermore, Docker, Inc. introduced Docker Debug and an enhanced Docker Build tool, which offers substantially improved speed and allows for cloud service offloading.</p>\n<h2 id=\"️-what-is-docker-scout\" style=\"position:relative;\"><a href=\"#%EF%B8%8F-what-is-docker-scout\" aria-label=\"️ what is docker scout permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>🛠️ What is Docker Scout</h2>\n<p>Docker Scout is designed to generate actionable insights for the software supply chain. It offers a layer-by-layer view of image dependencies, vulnerabilities, comparisons, and remediation paths. Docker announced the general availability of Docker Scout this week at DockerCon. You can check out their announcement <a href=\"https://www.docker.com/blog/introducing-docker-scout/\" target=\"_blank\" rel=\"noopener noreferrer\">here</a>.</p>\n<h2 id=\"-what-are-sysdig-runtime-insights\" style=\"position:relative;\"><a href=\"#-what-are-sysdig-runtime-insights\" aria-label=\" what are sysdig runtime insights permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>🔍 What are Sysdig Runtime Insights</h2>\n<p>Sysdig's deep runtime security visibility uses system calls at the kernel level to identify container activity. This is critical for <a href=\"https://sysdig.com/solutions/cloud-threat-detection-and-response/\" target=\"_blank\" rel=\"noopener noreferrer\">threat detection</a> but also enables Sysdig Secure to identify running containers and the packages loaded at runtime. Often, containers include packages to accommodate potential dependencies that are never used. <a href=\"https://sysdig.com/why-runtime-insights/\" target=\"_blank\" rel=\"noopener noreferrer\">Runtime insights</a> help you clearly see what's in use and what's not.</p>\n<p><span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 46.470588235294116%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAIAAAC9o5sfAAAACXBIWXMAAAsTAAALEwEAmpwYAAABU0lEQVR42lVR2W7CMBDk/z8JqRJKi0Slipb2gZZyFQIhcZzDdry+6YaEQufBsrQ7mmMH5wuMtcroRit8jbPWufMdQghCiDynUkqttbtOB90sKYtNmn7G8TbNdiRPSxbCjeycXyy+o+hxtVqXVdVIeSPHhDxM36PXr2j2E81OozcyfC5SYroNLprpx1yhN/Tjgw/BX15ES2Zc7A8JyTLGeM0lF0BrULr3RotqOBqDNkw0itfQCJDcaRk6ZVw8nvKM1rRkCsB7D1XhDHTkoqzGk5dWQzTHlO4zvowF6vW2AdRqtV0vN4RQzhmaY1msJOvIhBajpwl+0PU+h/mOjWasZBj7YhvTVFXNakwnsQzvvAHurO7I6OuQpF2veAsudUIxhO2V/4A1gMGbGeOd0jYj9SkrD0mBqzZo7ZUL5n7/H7njW4/aLUAZCVo04Nqa26avZ+/JvwGxBDeTiZlXAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"insights\" title=\"\" src=\"/static/1fba8b2561c3e949f130d257be658641/c5bb3/insights.png\" srcset=\"/static/1fba8b2561c3e949f130d257be658641/04472/insights.png 170w,\n/static/1fba8b2561c3e949f130d257be658641/9f933/insights.png 340w,\n/static/1fba8b2561c3e949f130d257be658641/c5bb3/insights.png 680w,\n/static/1fba8b2561c3e949f130d257be658641/b12f7/insights.png 1020w,\n/static/1fba8b2561c3e949f130d257be658641/105d8/insights.png 1170w\" sizes=\"(max-width: 680px) 100vw, 680px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n    </span>\n          </p>\n<h2 id=\"-enhanced-security-with-docker-scout-and-sysdig\" style=\"position:relative;\"><a href=\"#-enhanced-security-with-docker-scout-and-sysdig\" aria-label=\" enhanced security with docker scout and sysdig permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>🔒 Enhanced Security with Docker Scout and Sysdig</h2>\n<p>Docker Scout and Sysdig together provide a robust solution for managing container security. By leveraging the strengths of both tools, developers can gain deeper insights into their container images and prioritize remediation efforts effectively.</p>\n<h3 id=\"-prioritize-risks-using-sboms-and-runtime-insights\" style=\"position:relative;\"><a href=\"#-prioritize-risks-using-sboms-and-runtime-insights\" aria-label=\" prioritize risks using sboms and runtime insights permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>🧩 Prioritize Risks Using SBOMs and Runtime Insights</h3>\n<p>Container images are often built from layers of other container images and software packages. These layers and packages can contain vulnerabilities that make your containers and the applications they run vulnerable to attack. Docker Scout can proactively help you find and fix these vulnerabilities, helping you create a more secure software supply chain. It does this by analyzing your images and creating a full inventory of the packages and layers called a <a href=\"https://ntia.gov/sites/default/files/publications/sbom_at_a_glance_apr2021_0.pdf\" target=\"_blank\" rel=\"noopener noreferrer\">Software Bill of Materials (SBOM)</a>. It then correlates this inventory with a continuously updated vulnerability database to identify vulnerabilities in your images.</p>\n<h3 id=\"-what-is-sbom\" style=\"position:relative;\"><a href=\"#-what-is-sbom\" aria-label=\" what is sbom permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>📜 What is SBOM?</h3>\n<p>A Software Bill of Materials (SBOM) is key when shifting security left. SBOMs provide an artifact that contains a comprehensive list of software assets and dependencies that make up a piece of software. SBOMs are also handy for knowing details such as the licensing covering each package. In terms of security, an SBOM is key for staying on top of security risks. It helps maintain an accurate and updated correlation between package dependencies, which makes the detection task easier.</p>\n<h3 id=\"️-docker-scout-and-sysdig-to-manage-container-security\" style=\"position:relative;\"><a href=\"#%EF%B8%8F-docker-scout-and-sysdig-to-manage-container-security\" aria-label=\"️ docker scout and sysdig to manage container security permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>🛡️ Docker Scout and Sysdig to Manage Container Security</h3>\n<p>Docker Scout is a tool that helps Docker users manage container security. It provides a unified software analysis view to help users understand their image composition, correlates security risks with the image's SBOM, and gives contextual remediation advice. Sysdig is a container security platform that provides runtime insights into containerized applications. It can be integrated with Docker Scout to provide additional information about CVE data and in-use vulnerabilities.</p>\n<h4 id=\"installation\" style=\"position:relative;\"><a href=\"#installation\" aria-label=\"installation permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Installation</h4>\n<p>The Docker Scout CLI plugin comes pre-installed with Docker Desktop.</p>\n<p>If you run Docker Engine without Docker Desktop, Docker Scout doesn't come pre-installed, but you can install it as a standalone binary.</p>\n<p><strong>Installation script</strong></p>\n<p>To install the latest version of the plugin, run the following commands:</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token function\">curl</span> <span class=\"token parameter variable\">-fsSL</span> https://raw.githubusercontent.com/docker/scout-cli/main/install.sh <span class=\"token parameter variable\">-o</span> install-scout.sh</code></pre></div>\n<p><strong>Container image</strong></p>\n<p>The Docker Scout CLI plugin is also available as <a href=\"https://hub.docker.com/r/docker/scout-cli\" target=\"_blank\" rel=\"noopener noreferrer\">a container image</a>. Use the docker/scout-cli to run docker scout commands without installing the CLI plugin on your host.</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"> <span class=\"token function\">docker</span> run <span class=\"token parameter variable\">-it</span> <span class=\"token punctuation\">\\</span>\n  <span class=\"token parameter variable\">-e</span> <span class=\"token assign-left variable\">DOCKER_SCOUT_HUB_USER</span><span class=\"token operator\">=</span><span class=\"token operator\">&lt;</span>your Docker Hub user name<span class=\"token operator\">></span> <span class=\"token punctuation\">\\</span>\n  <span class=\"token parameter variable\">-e</span> <span class=\"token assign-left variable\">DOCKER_SCOUT_HUB_PASSWORD</span><span class=\"token operator\">=</span><span class=\"token operator\">&lt;</span>your Docker Hub PAT<span class=\"token operator\">></span>  <span class=\"token punctuation\">\\</span>\n  docker/scout-cli <span class=\"token operator\">&lt;</span>command<span class=\"token operator\">></span></code></pre></div>\n<p><strong>GitHub Action</strong>\nThe Docker Scout CLI plugin is also available as a <a href=\"https://github.com/docker/scout-action\" target=\"_blank\" rel=\"noopener noreferrer\">GitHub action</a>. You can use it in your GitHub workflows to automatically analyze images and evaluate policy compliance with each push.</p>\n<p>Docker Scout also integrates with many more CI/CD tools, such as Jenkins, GitLab, and Azure DevOps.</p>\n<p>For more details how to install the scout CLI, follow the steps in the <a href=\"https://docs.docker.com/scout/install/\" target=\"_blank\" rel=\"noopener noreferrer\">documentation</a></p>\n<h4 id=\"use-case-1-cve-data-and-in-use-vulnerabilities\" style=\"position:relative;\"><a href=\"#use-case-1-cve-data-and-in-use-vulnerabilities\" aria-label=\"use case 1 cve data and in use vulnerabilities permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Use Case 1: CVE Data and In-Use Vulnerabilities</h4>\n<p>Docker Scout can get CVE information from the SBOM, but it does not know which packages are actually in use. The Sysdig integration allows developers to see which CVE data impacts in-use packages, so they can prioritize remediation efforts.</p>\n<p>Run the below command:</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token function\">docker</span> scout cves nginx</code></pre></div>\n<p><span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 78.82352941176471%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAYAAAAWGF8bAAAACXBIWXMAABYlAAAWJQFJUiTwAAAB2UlEQVR42qVTuY7bQBSzLuu+PJKtyzpsy5aP9e4iRaoA6VKn3zZVkP8vGY7jDRDAASRs8SDh6YlD8nFmsVchCRuIqES6WGOZbhAEBVRVg6apmM1m0+pbvsDb0xU/vl7x6/sLfr59wedPZ9RNi82mI3gAz/MQhuHt3XEc+L4PwzAeA0a+B+E6EIGPssiR5ytEUQjTNGHbNlzX/VsS2LKsG6imaY8BdX5YZxmassSu77Hb7dB0Heq65gEFhBD///lRSertHWBF4CxJMGy36Pd7+JR4G1KU8YCqqsKmDEX+xDqkAqc0QUmfluwHuo7EMpFQvjoO+N9GRekdGXdNjSxNkVCyPZ9DJ5gyhqEcDA0NoW0hy3MU9C2KIui04n2jUsUkDwf6dTodcT6fseViTpcLXl5fGZ0GIcEnL0UykxmzyKiJI1zyDNVyCZdSVQ6ZBLRZyjjQ2Z+F3BvH9RqXtsG+LNCIBbIogHBsxOZ83FLkqZKFxmHJNhbJrRx6Z8swk7k6STKHa26zLUoMw4CeHlZkmTGTK8qO7x4qUzzsDwdsGOaCkano5zMX9HS9YsGQa8yhMjXY8n6+Nw6JwJFV8N6mDHRgyGBbSD8S7KZtUfO5YqhFHMOkCm1ksH8DR1JjVzqIaZkAAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"alt text\" title=\"\" src=\"/static/eff8e035c1b3e95bf09ebda24cdfbc34/c5bb3/image.png\" srcset=\"/static/eff8e035c1b3e95bf09ebda24cdfbc34/04472/image.png 170w,\n/static/eff8e035c1b3e95bf09ebda24cdfbc34/9f933/image.png 340w,\n/static/eff8e035c1b3e95bf09ebda24cdfbc34/c5bb3/image.png 680w,\n/static/eff8e035c1b3e95bf09ebda24cdfbc34/b12f7/image.png 1020w,\n/static/eff8e035c1b3e95bf09ebda24cdfbc34/b5a09/image.png 1360w,\n/static/eff8e035c1b3e95bf09ebda24cdfbc34/a8a6f/image.png 1516w\" sizes=\"(max-width: 680px) 100vw, 680px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n    </span>\n          </p>\n<p>Vulnerabilities are ordered and summarized by priority, from the highest (CRITICAL) to the lowest (LOW). With the Sysdig integration, developers also get information about whether a vulnerability impacts in-use packages or not.</p>\n<p><span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 51.17647058823529%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsTAAALEwEAmpwYAAAB90lEQVR42o2SSY7TQBSGy0OS8lRlu1yeYjsTjQSIDTkAO5Q9yg3gAhyAg7BHQrCFFRLdrLkAWy7QwAIJKyE/r0zMAvWCkn7VINX3/jewe7HEw+UCjx7cwu2LNfKigNYaZVkiyzL4vg8hBKIo+hVLiURGz7bbrc+UqoM8L4Ig+CtaOXMcB2WeY960g6q6RkZA7nlgjMGyrEEGulQpNmnyQ3J+LTj/Gp4lPe9aeN73VIgvBHSRpAk830NJDjZVhSSKMLVtzCiYxzkEvcdxjPubNe6sVtg0c9ztWugohBYRVOCf5HQKFQbfmM0s2GcnDaW5IJVpCkUQ33XhEtQmeBiGp4KCVU3zeblev6/a9qpp28u26y79SHywHPtjEIZvmWs7mFPdFi2l3DaoKbou8qF2Y8rn/Wh20hP2ZznspuUQMKQUXXeCVCdYXCygMoUJ3V1yaNyZnWr9f0DXsqGo4JoaU5uGqGzocEppn1M1MAMagU/HryTrH9ErNWVOoCIvoHKFbt0RXA8wA+IzjjRJISJxNG+TyWRwuN/vb3ZoW3ZPH3s69olK+7qte5q/nuaqD8LgKLRAXMfIan0yneacf5JSvqS5fEN6TedXpHc0u49HZj6KIIMIWO12u5lS6kW37NCtup9FVRxocA8ylifjfJxP0sHcqTTPDe03ciuxljPBO6wAAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"vulnerabilities\" title=\"\" src=\"/static/28444e9bf38b41bfc894b4c2b2fd1f53/c5bb3/vulnerabilities.png\" srcset=\"/static/28444e9bf38b41bfc894b4c2b2fd1f53/04472/vulnerabilities.png 170w,\n/static/28444e9bf38b41bfc894b4c2b2fd1f53/9f933/vulnerabilities.png 340w,\n/static/28444e9bf38b41bfc894b4c2b2fd1f53/c5bb3/vulnerabilities.png 680w,\n/static/28444e9bf38b41bfc894b4c2b2fd1f53/b12f7/vulnerabilities.png 1020w,\n/static/28444e9bf38b41bfc894b4c2b2fd1f53/2bef9/vulnerabilities.png 1024w\" sizes=\"(max-width: 680px) 100vw, 680px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n    </span>\n          </p>\n<h4 id=\"use-case-2-compare-vulnerabilities-between-releases\" style=\"position:relative;\"><a href=\"#use-case-2-compare-vulnerabilities-between-releases\" aria-label=\"use case 2 compare vulnerabilities between releases permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Use Case 2: Compare Vulnerabilities Between Releases</h4>\n<p>At software development time, it is important to have visibility into the differences between the code being developed and the code that is deployed in production. Docker Scout can be used to compare a local image to an image that is currently running in a cluster, and to identify any vulnerabilities that exist in the newer image but not in the older image. This information can then be used to prioritize remediation efforts and to minimize security blind spots in production. In addition to identifying new vulnerabilities, the \"compare\" approach can also be used to identify packages that are no longer in use. These packages can then be removed from the image, which can help to reduce the attack surface and make the image more lean and efficient.</p>\n<p>The below command can perform the comparison:</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token function\">docker</span> scout compare nginx:1.27.2 nginx:1.26.2</code></pre></div>\n<p><span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 42.35294117647059%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAABYlAAAWJQFJUiTwAAABbUlEQVR42n1S206DQBQElvtFoFsuQmmrUAqmTRuNqcH4A7X6oG+mif//FeNZEoykiQ+TQ+bsDnPmrKRqDjTNhayokGUJkiSBMQbLtmE7oqf1nCzLfRV83yMM3Ai6rkFAURRYlgUehCjSFE21Qruqschy4gKExCd8inVVUa/CuiyRRREm1BsJu66LFV00DAOaruOlbfD93KGrS9xGITbFNaaBj7vZDOeuw3G/Q5VwNFmMKo0x8byxQ1VVkZKjMAzh0hgH7uFz3eBjV+N4yHE+7WFYOirHxOuywHtb4/SQ4eu4RX0TjeL4FYzIushN5MU5p3oFXbXBFBmayqDQBd/3KRq9v6QypYdC/YscTdNEHMcQVYgW9D0nDAsaMKWsSprEpnMXi/gL4Urk2P+Z3LqUCafxxZKGQ0Lcth3iJzAp638FhWXxBDwScuiZbAyGMklw3xZ4eyyQ57nIBUuNYcsDzBcFPp/maMs5LMe9EPwBnxy6d3MfdVYAAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"alt text\" title=\"\" src=\"/static/8394af75add308875773963a94287a13/c5bb3/image-1.png\" srcset=\"/static/8394af75add308875773963a94287a13/04472/image-1.png 170w,\n/static/8394af75add308875773963a94287a13/9f933/image-1.png 340w,\n/static/8394af75add308875773963a94287a13/c5bb3/image-1.png 680w,\n/static/8394af75add308875773963a94287a13/b12f7/image-1.png 1020w,\n/static/8394af75add308875773963a94287a13/b5a09/image-1.png 1360w,\n/static/8394af75add308875773963a94287a13/b4904/image-1.png 1768w\" sizes=\"(max-width: 680px) 100vw, 680px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n    </span>\n          </p>\n<h4 id=\"use-case-3-view-image-insights-in-your-cicd-pipeline\" style=\"position:relative;\"><a href=\"#use-case-3-view-image-insights-in-your-cicd-pipeline\" aria-label=\"use case 3 view image insights in your cicd pipeline permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Use Case 3: View Image Insights in Your CI/CD Pipeline</h4>\n<p>Docker Scout can be integrated into the CI/CD pipeline workflow to get vulnerability and runtime insights when building and pushing images. This can be done using a variety of CI/CD tools, including GitHub, GitLab, CircleCI, Microsoft Azure DevOps Pipelines, and Jenkins. Specifically for GitHub, Docker Scout can be integrated using the popular Docker Build and Push GitHub Action. This action allows developers to build and push images to Docker Hub from their GitHub workflows.</p>\n<h3 id=\"️-view-and-manage-security-issues\" style=\"position:relative;\"><a href=\"#%EF%B8%8F-view-and-manage-security-issues\" aria-label=\"️ view and manage security issues permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>🛠️ View and Manage Security Issues</h3>\n<p>Docker Scout results can be viewed and managed across various interfaces, including Docker Desktop, the Docker CLI, Docker Hub, and the Docker Scout Dashboard. The Docker Scout Dashboard provides a unified view of discovered vulnerabilities, as well as extended information about CVEs and recommendations on how to remediate them by updating to a different base image. The Docker Scout Dashboard web console gives developers a view into discovered vulnerabilities but also provides extended information about CVEs along with recommendations on how to bypass vulnerabilities by updating to a different base image.</p>\n<p><span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 44.11764705882353%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAIAAAC9o5sfAAAACXBIWXMAAAsTAAALEwEAmpwYAAABLElEQVR42nVRXUsDMRC8//+btLSCIpRSFR+E0ooifag975qvzSabxMldvYrgPuQmYWZndq9h5lQrO/InbTgCliSCpxhjKQUncBkq5ywiOMdr45wDE4jZj+wBMzARge6ARfAImda6bVulFAhV3OmgXdVwnDoWzwwlGBLDx3LVvSxZv8P/HFPEByFOzWfnoEcWBJ7EzpE1FhXYb2eLr8cFqx3mkVgz55xCTNan5tjToWfHSdLF2VpnjFFKs6fd7Ob4MGe1rWI5i+FsSJr25HsTsKTfYmSGrTGWnH27u2+fb716HZzj5Oxq7J6UC3XOkP44n5QyWm2v54fVle83l9jpx7lTpOm8sEmNhfG4M0/79VO/WUe7H1RpcM5oUhdW/qlphpGN74jRMYRQf37O3+GTCrnXKUN/AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"issues\" title=\"\" src=\"/static/82aa560044b27db7604ae1558b2002dc/c5bb3/issues.png\" srcset=\"/static/82aa560044b27db7604ae1558b2002dc/04472/issues.png 170w,\n/static/82aa560044b27db7604ae1558b2002dc/9f933/issues.png 340w,\n/static/82aa560044b27db7604ae1558b2002dc/c5bb3/issues.png 680w,\n/static/82aa560044b27db7604ae1558b2002dc/b12f7/issues.png 1020w,\n/static/82aa560044b27db7604ae1558b2002dc/105d8/issues.png 1170w\" sizes=\"(max-width: 680px) 100vw, 680px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n    </span>\n          </p>\n<h3 id=\"-ship-more-secure-images\" style=\"position:relative;\"><a href=\"#-ship-more-secure-images\" aria-label=\" ship more secure images permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>🚀 Ship More Secure Images</h3>\n<p>The ability to compare images during the build phase with those running in production gives developers a new lens to help build better images. Beyond remediating in-use vulnerabilities, teams can see which packages are unused and consider if they can be removed to address \"container bloat.\" Leaner container images have a reduced attack surface with the added benefit of being able to scale more quickly.</p>\n<h2 id=\"-conclusion\" style=\"position:relative;\"><a href=\"#-conclusion\" aria-label=\" conclusion permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>🏁 Conclusion</h2>\n<p>It is essential to identify, prioritize, and fix security issues across the software supply chain in order to avoid security breaches when software is released into production. Docker and Sysdig help teams to do this more effectively by providing real-time security information throughout the development and deployment process. The integration of Sysdig Secure and Docker Scout offers users new and powerful ways to stay on top of known CVEs and ensure the security of their software supply chain.</p>\n<br>\n<p><strong><em>Until next time, つづく 🎉</em></strong></p>\n<blockquote>\n<p>💡 Thank you for Reading !! 🙌🏻😁📃, see you in the next blog.🤘  <strong><em>Until next time 🎉</em></strong></p>\n</blockquote>\n<p>🚀 Thank you for sticking up till the end. If you have any questions/feedback regarding this blog feel free to connect with me:</p>\n<p><strong>♻️ LinkedIn:</strong> <a href=\"https://www.linkedin.com/in/rajhi-saif/\" target=\"_blank\" rel=\"noopener noreferrer\">https://www.linkedin.com/in/rajhi-saif/</a></p>\n<p><strong>♻️ X/Twitter:</strong> <a href=\"https://x.com/rajhisaifeddine\" target=\"_blank\" rel=\"noopener noreferrer\">https://x.com/rajhisaifeddine</a></p>\n<p><strong>The end ✌🏻</strong></p>\n<h1 align=\"center\">🔰 Keep Learning !! Keep Sharing !! 🔰</h1>\n<p><strong>📅 Stay updated</strong></p>\n<p>Subscribe to our newsletter for more insights on AWS cloud computing and containers.</p>"}}},"staticQueryHashes":["1271460761","1321585977"],"slicesMap":{}}