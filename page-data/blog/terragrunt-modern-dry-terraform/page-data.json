{"componentChunkName":"component---src-templates-blog-template-js","path":"/blog/terragrunt-modern-dry-terraform/","result":{"data":{"markdownRemark":{"html":"<blockquote>\n<p><strong>Dry Terraform code with Terragrunt â™¨ï¸</strong></p>\n</blockquote>\n<h2 id=\"-introduction\" style=\"position:relative;\"><a href=\"#-introduction\" aria-label=\" introduction permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>ğŸ’¬ Introduction</h2>\n<p>Terraform is an excellent infrastructure-as-code tool, but it can be challenging to keep your code <strong>DRY</strong> (Don't Repeat Yourself) and maintainable, especially when managing multiple environments. <strong>Terragrunt</strong>, a lightweight Terraform wrapper, offers a variety of features to help you simplify this task.</p>\n<p>One of Terragrunt's biggest advantages is its ability to centralize backend configuration. This means you can define your backend configuration in a single location and inherit it across all child modules. This eliminates the need to duplicate backend configuration in each module, making your code more streamlined and manageable.</p>\n<p>In this blog post, we'll explore the basics of Terragrunt, its key features, and how it can significantly improve your Terraform workflows, making them more efficient, organized, and easier to maintain.</p>\n<h2 id=\"-addressing-common-challenges-with-terraform-the-terragrunt-approach\" style=\"position:relative;\"><a href=\"#-addressing-common-challenges-with-terraform-the-terragrunt-approach\" aria-label=\" addressing common challenges with terraform the terragrunt approach permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>ğŸ“‘ Addressing Common Challenges with Terraform: The Terragrunt Approach</h2>\n<p>Terraform is a powerful infrastructure-as-code tool that allows users to define their infrastructure through code. However, it can be challenging to manage the Terraform state file and maintain <strong>DRY</strong> (Don't Repeat Yourself) code, especially in multi-environment deployments.</p>\n<p>There are various solutions to these challenges, such as using <a href=\"https://www.terraform.io/docs/state/workspaces.html\" target=\"_blank\" rel=\"noopener noreferrer\">workspaces</a>, <a href=\"https://www.hashicorp.com/products/terraform\" target=\"_blank\" rel=\"noopener noreferrer\">Terraform Cloud</a> (for a fee), or scripts with variables. However, <strong>Terragrunt</strong>, a wrapper for Terraform, offers a flexible and elegant solution.</p>\n<h2 id=\"what-is-dry-and-why-is-it-important\" style=\"position:relative;\"><a href=\"#what-is-dry-and-why-is-it-important\" aria-label=\"what is dry and why is it important permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>What is DRY and Why is it Important</h2>\n<p><a href=\"https://en.wikipedia.org/wiki/Don&#x27;t_repeat_yourself\" target=\"_blank\" rel=\"noopener noreferrer\">DRY</a> stands for <em>Don't Repeat Yourself</em>. It is a software engineering principle that aims to reduce software complexity. Any piece of information that is duplicated is liable to get stale and cause problems and requires extra work to be kept updated, increasing the costs and difficulty of maintaining software.</p>\n<p>In order to avoid paying the extra costs of maintaining duplicated information, we need abstractions that help us:</p>\n<ul>\n<li>Extract information, define it only once, and reuse it whenever possible.</li>\n<li>Provide an easy way to update and access the single representation of information and use it multiple times for different environments.</li>\n</ul>\n<h2 id=\"-terragrunt-folder-structures\" style=\"position:relative;\"><a href=\"#-terragrunt-folder-structures\" aria-label=\" terragrunt folder structures permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>ğŸ“‚ Terragrunt Folder Structures</h2>\n<p><a href=\"https://terragrunt.gruntwork.io/\" target=\"_blank\" rel=\"noopener noreferrer\">Terragrunt</a> allows you to select a Terraform code directory and populate variables with easy state management. Inputs for Terraform variables are defined in <code class=\"language-text\">.hcl</code> files that can reference each other and more.</p>\n<p>This example will create an <code class=\"language-text\">AWS Instance</code> in <code class=\"language-text\">eu-west-1</code> and an <code class=\"language-text\">S3 bucket</code> deployed with <a href=\"https://terragrunt.gruntwork.io/docs/features/keep-your-terraform-code-dry/\" target=\"_blank\" rel=\"noopener noreferrer\">Terragrunt</a> for <code class=\"language-text\">development</code>, <code class=\"language-text\">production</code>, and <code class=\"language-text\">staging</code> environments.</p>\n<p>You can follow along in your AWS account by cloning <a href=\"https://github.com/seifrajhi/terragrunt-dry-demo\" target=\"_blank\" rel=\"noopener noreferrer\">this repo</a>.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token comment\"># terragrunt-dry-demo</span>\nâ”œâ”€â”€ development\nâ”‚   â”œâ”€â”€ instance\nâ”‚   â”‚   â””â”€â”€ terragrunt.hcl\nâ”‚   â”œâ”€â”€ s3\nâ”‚   â”‚   â””â”€â”€ terragrunt.hcl\nâ”‚   â””â”€â”€ terragrunt.hcl\nâ”‚       \nâ”œâ”€â”€ production\nâ”‚   â”œâ”€â”€ instance\nâ”‚   â”‚   â””â”€â”€ terragrunt.hcl\nâ”‚   â”œâ”€â”€ s3\nâ”‚   â”‚   â””â”€â”€ terragrunt.hcl\nâ”‚   â””â”€â”€ terragrunt.hcl\nâ”‚       \nâ””â”€â”€ staging\n    â”œâ”€â”€ instance\n    â”‚   â””â”€â”€ terragrunt.hcl\n    â”œâ”€â”€ s3\n    â”‚   â””â”€â”€ terragrunt.hcl\n    â””â”€â”€ terragrunt.hcl</code></pre></div>\n<p>The root <code class=\"language-text\">terragrunt.hcl</code> file in each directory generates an AWS provider so you only need to specify this code once in the root location.</p>\n<h3 id=\"ï¸-terragrunt-config-file-structure\" style=\"position:relative;\"><a href=\"#%EF%B8%8F-terragrunt-config-file-structure\" aria-label=\"ï¸ terragrunt config file structure permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>ğŸ—‚ï¸ Terragrunt Config File Structure</h3>\n<p>Terragrunt config contains blocks and attributes. Let's start with <code class=\"language-text\">{env_name}/terragrunt.hcl</code> file where <code class=\"language-text\">env_name</code> can be <code class=\"language-text\">development</code>, <code class=\"language-text\">staging</code>, or <code class=\"language-text\">production</code>.</p>\n<p>It contains definitions for things every environment will use:</p>\n<div class=\"gatsby-highlight\" data-language=\"hcl\"><pre class=\"language-hcl\"><code class=\"language-hcl\"><span class=\"token keyword\">locals</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token property\">region</span>         <span class=\"token punctuation\">=</span> <span class=\"token string\">\"eu-west-1\"</span>\n  <span class=\"token property\">bucket</span>         <span class=\"token punctuation\">=</span> <span class=\"token string\">\"example\"</span>\n  <span class=\"token property\">key</span>            <span class=\"token punctuation\">=</span> <span class=\"token string\">\"terraform/<span class=\"token interpolation\"><span class=\"token punctuation\">$</span><span class=\"token punctuation\">{</span><span class=\"token function\">path_relative_to_include</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span></span>/terraform.tfstate\"</span>\n  <span class=\"token property\">dynamodb_table</span> <span class=\"token punctuation\">=</span> <span class=\"token string\">\"terraform_locks\"</span>\n  <span class=\"token property\">profile</span>        <span class=\"token punctuation\">=</span> <span class=\"token string\">\"my-aws-profile\"</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token property\">inputs</span> <span class=\"token punctuation\">=</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">remote_state</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token property\">backend</span> <span class=\"token punctuation\">=</span> <span class=\"token string\">\"s3\"</span>\n  <span class=\"token property\">config</span> <span class=\"token punctuation\">=</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">bucket</span>         <span class=\"token punctuation\">=</span> local.bucket\n    <span class=\"token property\">region</span>         <span class=\"token punctuation\">=</span> local.region\n    <span class=\"token property\">key</span>            <span class=\"token punctuation\">=</span> local.key\n    <span class=\"token property\">dynamodb_table</span> <span class=\"token punctuation\">=</span> local.dynamodb_table\n    <span class=\"token property\">profile</span>        <span class=\"token punctuation\">=</span> local.profile\n    <span class=\"token property\">encrypt</span>        <span class=\"token punctuation\">=</span> <span class=\"token boolean\">true</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>The <code class=\"language-text\">locals</code> block should be quite obviousâ€Šâ€”â€Šyou can easily refer to them later in Terragrunt. The most important code line is:</p>\n<div class=\"gatsby-highlight\" data-language=\"hcl\"><pre class=\"language-hcl\"><code class=\"language-hcl\"><span class=\"token property\">key</span> <span class=\"token punctuation\">=</span> <span class=\"token string\">\"terraform/<span class=\"token interpolation\"><span class=\"token punctuation\">$</span><span class=\"token punctuation\">{</span><span class=\"token function\">path_relative_to_include</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span></span>/terraform.tfstate\"</span></code></pre></div>\n<p>This line ensures that the Terraform state file is stored in a consistent location across different environments.</p>\n<p>This will ensure that the state will be saved to the path which includes the path in which <code class=\"language-text\">.hcl</code> lives. With that, you can quickly ensure that every environment state will be managed in a different state file.</p>\n<p>Now to make sure this will be referenced in other Terragrunt files, you need to add this:</p>\n<div class=\"gatsby-highlight\" data-language=\"hcl\"><pre class=\"language-hcl\"><code class=\"language-hcl\"><span class=\"token comment\"># terragrunt-dry-demo/development/instance/terragrunt.hcl</span>\n<span class=\"token keyword\">terraform</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">source</span> <span class=\"token punctuation\">=</span> <span class=\"token string\">\"git::https://github.com/seifrajhi/terragrunt-dry-tutorial-modules.git//instance?ref=v1.0.0\"</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">include</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">path</span> <span class=\"token punctuation\">=</span> find_in_parent_folders()\n<span class=\"token punctuation\">}</span>\n<span class=\"token property\">inputs</span> <span class=\"token punctuation\">=</span> <span class=\"token punctuation\">{</span>\n     <span class=\"token property\">ami</span> <span class=\"token punctuation\">=</span> <span class=\"token string\">\"ami-046a9f26a7f14326b\"</span>\n     <span class=\"token property\">instance_type</span> <span class=\"token punctuation\">=</span> <span class=\"token string\">\"t2.micro\"</span>\n     <span class=\"token property\">availability_zone_names</span> <span class=\"token punctuation\">=</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"eu-west-1a\"</span>, <span class=\"token string\">\"eu-west-1b\"</span>, <span class=\"token string\">\"eu-west-1c\"</span><span class=\"token punctuation\">]</span>\n     <span class=\"token property\">resource_tags</span> <span class=\"token punctuation\">=</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token property\">Name</span> <span class=\"token punctuation\">=</span> <span class=\"token string\">\"instance-demo\"</span>\n        <span class=\"token property\">Owner</span> <span class=\"token punctuation\">=</span> <span class=\"token string\">\"Saif Rajhi\"</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Use the <code class=\"language-text\">include</code> block to add <code class=\"language-text\">*.hcl</code> file. Then use <code class=\"language-text\">terraform</code> to point to the directory with Terraform code using the relative path returned from the function <code class=\"language-text\">find_in_parent_folders()</code>.</p>\n<p>To run <code class=\"language-text\">develop/terragrunt.hcl</code>, go to the directory and run:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">terragrunt apply</code></pre></div>\n<p>State will be saved in the bucket as:</p>\n<div class=\"gatsby-highlight\" data-language=\"hcl\"><pre class=\"language-hcl\"><code class=\"language-hcl\">terraform/$<span class=\"token punctuation\">{</span>path_relative_to_include()<span class=\"token punctuation\">}</span>/terraform.tfstate</code></pre></div>\n<p>Each environment configuration is wrapped into a single <code class=\"language-text\">.hcl</code> file. Of course, if you want to keep states in different buckets, it is also possible. Just change the bucket name to use a function like the state key.</p>\n<h3 id=\"-terragrunt-commands\" style=\"position:relative;\"><a href=\"#-terragrunt-commands\" aria-label=\" terragrunt commands permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>ğŸš€ Terragrunt Commands</h3>\n<p>Most of the Terragrunt commands are wrappers around Terraform commands:</p>\n<ul>\n<li><code class=\"language-text\">terragrunt plan</code> -> <code class=\"language-text\">terraform plan</code></li>\n<li><code class=\"language-text\">terragrunt apply</code> -> <code class=\"language-text\">terraform apply</code></li>\n</ul>\n<p>But some of them proceed with additional changes. For example, <code class=\"language-text\">terragrunt init</code> automatically creates a bucket or DynamoDB (if using AWS).</p>\n<h3 id=\"ï¸-generating-terraform-code-with-terragrunt\" style=\"position:relative;\"><a href=\"#%EF%B8%8F-generating-terraform-code-with-terragrunt\" aria-label=\"ï¸ generating terraform code with terragrunt permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>ğŸ› ï¸ Generating Terraform Code with Terragrunt</h3>\n<p>You can generate Terraform code to skip some manual work. Example use case: you want to generate an identical provider for each environment with the ability to change the AWS profile and region.</p>\n<div class=\"gatsby-highlight\" data-language=\"hcl\"><pre class=\"language-hcl\"><code class=\"language-hcl\"><span class=\"token comment\"># terragrunt-dry-demo/development/terragrunt.hcl</span>\ngenerate <span class=\"token string\">\"provider\"</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">path</span> <span class=\"token punctuation\">=</span> <span class=\"token string\">\"provider.tf\"</span>\n    <span class=\"token property\">if_exists</span> <span class=\"token punctuation\">=</span> <span class=\"token string\">\"overwrite_terragrunt\"</span>\n    <span class=\"token property\">contents</span> <span class=\"token punctuation\">=</span> <span class=\"token heredoc string\">&lt;&lt;EOF\nprovider \"aws\" {\n    profile = \"default\"\n    region  = \"eu-west-1\"\n}\nEOF</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>The <code class=\"language-text\">instance</code> and <code class=\"language-text\">s3</code> sub-folders also contain a <code class=\"language-text\">terragrunt.hcl</code> file. This sets the <code class=\"language-text\">source</code> parameter to point at a specific Terragrunt module in the <a href=\"https://github.com/seifrajhi/terragrunt-cloudtruth-modules\" target=\"_blank\" rel=\"noopener noreferrer\">terragrunt-cloudtruth-modules</a> repo. They also include a function <code class=\"language-text\">find_in_parent_folders</code> which configures the AWS provider from the root <code class=\"language-text\">terragrunt.hcl</code>. As a result, you avoid copying the provider and Terraform code in multiple locations.</p>\n<p>Terraform modules allow you to keep your HCL DRY by allowing you to reuse and break down infrastructure code into smaller pieces. Our structure contains a <code class=\"language-text\">main.tf</code>, <code class=\"language-text\">outputs.tf</code>, and <code class=\"language-text\">variables.tf</code>.</p>\n<h3 id=\"-final-thoughts\" style=\"position:relative;\"><a href=\"#-final-thoughts\" aria-label=\" final thoughts permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>ğŸ“ Final Thoughts</h3>\n<p>Terraform is a great tool, but I could not imagine working with it now without Terragrunt. This article is only a quick introduction and does not dive deeply into more hidden features. And yes, Terragrunt supports working with modules.</p>\n<p>Of course, Terraform has an official solution to multi-environment managementâ€Šâ€”â€Š<a href=\"https://www.hashicorp.com/products/terraform\" target=\"_blank\" rel=\"noopener noreferrer\">Terraform Cloud</a>. But if you are not convinced by enterprise solutions and costs, here comes Terragrunt.</p>\n<p>Try it yourself. It could be a game-changer for you.</p>\n<br>\n<p><strong><em>Until next time, ã¤ã¥ã ğŸ‰</em></strong></p>\n<blockquote>\n<p>ğŸ’¡ Thank you for Reading !! ğŸ™ŒğŸ»ğŸ˜ğŸ“ƒ, see you in the next blog.ğŸ¤˜  <strong><em>Until next time ğŸ‰</em></strong></p>\n</blockquote>\n<p>ğŸš€ Thank you for sticking up till the end. If you have any questions/feedback regarding this blog feel free to connect with me:</p>\n<p><strong>â™»ï¸ LinkedIn:</strong> <a href=\"https://www.linkedin.com/in/rajhi-saif/\" target=\"_blank\" rel=\"noopener noreferrer\">https://www.linkedin.com/in/rajhi-saif/</a></p>\n<p><strong>â™»ï¸ X/Twitter:</strong> <a href=\"https://x.com/rajhisaifeddine\" target=\"_blank\" rel=\"noopener noreferrer\">https://x.com/rajhisaifeddine</a></p>\n<p><strong>The end âœŒğŸ»</strong></p>\n<h1 align=\"center\">ğŸ”° Keep Learning !! Keep Sharing !! ğŸ”°</h1>\n<p><strong>ğŸ“… Stay updated</strong></p>\n<p>Subscribe to our newsletter for more insights on AWS cloud computing and containers.</p>","timeToRead":5,"rawMarkdownBody":"\n> **Dry Terraform code with Terragrunt â™¨ï¸**\n\n## ğŸ’¬ Introduction\n\nTerraform is an excellent infrastructure-as-code tool, but it can be challenging to keep your code **DRY** (Don't Repeat Yourself) and maintainable, especially when managing multiple environments. **Terragrunt**, a lightweight Terraform wrapper, offers a variety of features to help you simplify this task.\n\nOne of Terragrunt's biggest advantages is its ability to centralize backend configuration. This means you can define your backend configuration in a single location and inherit it across all child modules. This eliminates the need to duplicate backend configuration in each module, making your code more streamlined and manageable.\n\nIn this blog post, we'll explore the basics of Terragrunt, its key features, and how it can significantly improve your Terraform workflows, making them more efficient, organized, and easier to maintain.\n\n## ğŸ“‘ Addressing Common Challenges with Terraform: The Terragrunt Approach\n\nTerraform is a powerful infrastructure-as-code tool that allows users to define their infrastructure through code. However, it can be challenging to manage the Terraform state file and maintain **DRY** (Don't Repeat Yourself) code, especially in multi-environment deployments.\n\nThere are various solutions to these challenges, such as using [workspaces](https://www.terraform.io/docs/state/workspaces.html), [Terraform Cloud](https://www.hashicorp.com/products/terraform) (for a fee), or scripts with variables. However, **Terragrunt**, a wrapper for Terraform, offers a flexible and elegant solution.\n\n## What is DRY and Why is it Important\n\n[DRY](https://en.wikipedia.org/wiki/Don't_repeat_yourself) stands for *Don't Repeat Yourself*. It is a software engineering principle that aims to reduce software complexity. Any piece of information that is duplicated is liable to get stale and cause problems and requires extra work to be kept updated, increasing the costs and difficulty of maintaining software.\n\nIn order to avoid paying the extra costs of maintaining duplicated information, we need abstractions that help us:\n\n- Extract information, define it only once, and reuse it whenever possible.\n- Provide an easy way to update and access the single representation of information and use it multiple times for different environments.\n\n\n## ğŸ“‚ Terragrunt Folder Structures\n\n[Terragrunt](https://terragrunt.gruntwork.io/) allows you to select a Terraform code directory and populate variables with easy state management. Inputs for Terraform variables are defined in `.hcl` files that can reference each other and more.\n\nThis example will create an `AWS Instance` in `eu-west-1` and an `S3 bucket` deployed with [Terragrunt](https://terragrunt.gruntwork.io/docs/features/keep-your-terraform-code-dry/) for `development`, `production`, and `staging` environments.\n\nYou can follow along in your AWS account by cloning [this repo](https://github.com/seifrajhi/terragrunt-dry-demo).\n\n```bash\n# terragrunt-dry-demo\nâ”œâ”€â”€ development\nâ”‚   â”œâ”€â”€ instance\nâ”‚   â”‚   â””â”€â”€ terragrunt.hcl\nâ”‚   â”œâ”€â”€ s3\nâ”‚   â”‚   â””â”€â”€ terragrunt.hcl\nâ”‚   â””â”€â”€ terragrunt.hcl\nâ”‚       \nâ”œâ”€â”€ production\nâ”‚   â”œâ”€â”€ instance\nâ”‚   â”‚   â””â”€â”€ terragrunt.hcl\nâ”‚   â”œâ”€â”€ s3\nâ”‚   â”‚   â””â”€â”€ terragrunt.hcl\nâ”‚   â””â”€â”€ terragrunt.hcl\nâ”‚       \nâ””â”€â”€ staging\n    â”œâ”€â”€ instance\n    â”‚   â””â”€â”€ terragrunt.hcl\n    â”œâ”€â”€ s3\n    â”‚   â””â”€â”€ terragrunt.hcl\n    â””â”€â”€ terragrunt.hcl\n```\n\nThe root `terragrunt.hcl` file in each directory generates an AWS provider so you only need to specify this code once in the root location.\n\n### ğŸ—‚ï¸ Terragrunt Config File Structure\n\nTerragrunt config contains blocks and attributes. Let's start with `{env_name}/terragrunt.hcl` file where `env_name` can be `development`, `staging`, or `production`.\n\nIt contains definitions for things every environment will use:\n\n```hcl\nlocals {\n  region         = \"eu-west-1\"\n  bucket         = \"example\"\n  key            = \"terraform/${path_relative_to_include()}/terraform.tfstate\"\n  dynamodb_table = \"terraform_locks\"\n  profile        = \"my-aws-profile\"\n}\n\ninputs = {}\n\nremote_state {\n  backend = \"s3\"\n  config = {\n    bucket         = local.bucket\n    region         = local.region\n    key            = local.key\n    dynamodb_table = local.dynamodb_table\n    profile        = local.profile\n    encrypt        = true\n  }\n}\n```\nThe `locals` block should be quite obviousâ€Šâ€”â€Šyou can easily refer to them later in Terragrunt. The most important code line is:\n\n```hcl\nkey = \"terraform/${path_relative_to_include()}/terraform.tfstate\"\n```\n\nThis line ensures that the Terraform state file is stored in a consistent location across different environments.\n\nThis will ensure that the state will be saved to the path which includes the path in which `.hcl` lives. With that, you can quickly ensure that every environment state will be managed in a different state file.\n\nNow to make sure this will be referenced in other Terragrunt files, you need to add this:\n\n```hcl\n# terragrunt-dry-demo/development/instance/terragrunt.hcl\nterraform {\n    source = \"git::https://github.com/seifrajhi/terragrunt-dry-tutorial-modules.git//instance?ref=v1.0.0\"\n}\ninclude {\n    path = find_in_parent_folders()\n}\ninputs = {\n     ami = \"ami-046a9f26a7f14326b\"\n     instance_type = \"t2.micro\"\n     availability_zone_names = [\"eu-west-1a\", \"eu-west-1b\", \"eu-west-1c\"]\n     resource_tags = {\n        Name = \"instance-demo\"\n        Owner = \"Saif Rajhi\"\n    }\n}\n```\n\nUse the `include` block to add `*.hcl` file. Then use `terraform` to point to the directory with Terraform code using the relative path returned from the function `find_in_parent_folders()`.\n\nTo run `develop/terragrunt.hcl`, go to the directory and run:\n\n```bash\nterragrunt apply\n```\n\nState will be saved in the bucket as:\n\n```hcl\nterraform/${path_relative_to_include()}/terraform.tfstate\n```\n\nEach environment configuration is wrapped into a single `.hcl` file. Of course, if you want to keep states in different buckets, it is also possible. Just change the bucket name to use a function like the state key.\n\n### ğŸš€ Terragrunt Commands\n\nMost of the Terragrunt commands are wrappers around Terraform commands:\n\n- `terragrunt plan` -> `terraform plan`\n- `terragrunt apply` -> `terraform apply`\n\nBut some of them proceed with additional changes. For example, `terragrunt init` automatically creates a bucket or DynamoDB (if using AWS).\n\n### ğŸ› ï¸ Generating Terraform Code with Terragrunt\n\nYou can generate Terraform code to skip some manual work. Example use case: you want to generate an identical provider for each environment with the ability to change the AWS profile and region.\n\n```hcl\n# terragrunt-dry-demo/development/terragrunt.hcl\ngenerate \"provider\" {\n    path = \"provider.tf\"\n    if_exists = \"overwrite_terragrunt\"\n    contents = <<EOF\nprovider \"aws\" {\n    profile = \"default\"\n    region  = \"eu-west-1\"\n}\nEOF\n}\n```\n\nThe `instance` and `s3` sub-folders also contain a `terragrunt.hcl` file. This sets the `source` parameter to point at a specific Terragrunt module in the [terragrunt-cloudtruth-modules](https://github.com/seifrajhi/terragrunt-cloudtruth-modules) repo. They also include a function `find_in_parent_folders` which configures the AWS provider from the root `terragrunt.hcl`. As a result, you avoid copying the provider and Terraform code in multiple locations.\n\nTerraform modules allow you to keep your HCL DRY by allowing you to reuse and break down infrastructure code into smaller pieces. Our structure contains a `main.tf`, `outputs.tf`, and `variables.tf`.\n\n### ğŸ“ Final Thoughts\n\nTerraform is a great tool, but I could not imagine working with it now without Terragrunt. This article is only a quick introduction and does not dive deeply into more hidden features. And yes, Terragrunt supports working with modules.\n\nOf course, Terraform has an official solution to multi-environment managementâ€Šâ€”â€Š[Terraform Cloud](https://www.hashicorp.com/products/terraform). But if you are not convinced by enterprise solutions and costs, here comes Terragrunt.\n\nTry it yourself. It could be a game-changer for you.\n\n<br>\n\n**_Until next time, ã¤ã¥ã ğŸ‰_**\n\n> ğŸ’¡ Thank you for Reading !! ğŸ™ŒğŸ»ğŸ˜ğŸ“ƒ, see you in the next blog.ğŸ¤˜  **_Until next time ğŸ‰_**\n\nğŸš€ Thank you for sticking up till the end. If you have any questions/feedback regarding this blog feel free to connect with me:\n\n**â™»ï¸ LinkedIn:** https://www.linkedin.com/in/rajhi-saif/\n\n**â™»ï¸ X/Twitter:** https://x.com/rajhisaifeddine\n\n**The end âœŒğŸ»**\n\n<h1 align=\"center\">ğŸ”° Keep Learning !! Keep Sharing !! ğŸ”°</h1>\n\n**ğŸ“… Stay updated**\n\nSubscribe to our newsletter for more insights on AWS cloud computing and containers.\n","wordCount":{"words":885},"frontmatter":{"id":"3597d0823b9a7bbbee55cad6","path":"/blog/terragrunt-modern-dry-terraform/","humanDate":"Oct 23, 2024","fullDate":"2024-10-23","title":"Terragrunt: A Modern Way to Keep Your Terraform Code DRY and Maintainable","keywords":["Terragrunt","terraform","IAC","automation"],"excerpt":"Discover how Terragrunt can revolutionize your Terraform workflow by keeping your code DRY and maintainable. Learn best practices and tips for efficient infrastructure as code (IaC) management.","cover":{"childImageSharp":{"gatsbyImageData":{"layout":"fullWidth","placeholder":{"fallback":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsTAAALEwEAmpwYAAABq0lEQVR42n2SzU8TURTF+08ZWakbESFuVBKXbGCpBuMCjQmJxrARGlYsKGEhxBATNpK2QUMMClZMQ5qyQZq0VAqtSWc6b2Y6r+2bH9PXMqHUeJOzuPedd+5nhK75vs9la/tKKY2rb/+zSCgQYH/vhNj8TxLrWSqVEqenfygUChqmaXR4ytcJWi31z4SRC2d54RfDA0vcfJXlzuQOa0tbpFIZcrkjSoFw8bCGbUocWUU4Bs2mh+dJpJS4rttb4UHmjKHrMaaeJNkseXxMlxl/uMqziQ1kXWni95UG0QeCVLJI+muJQqYZtmbbdlilFlz/kGVoIMbeTpGGa9DyBPMzu9y7sczZidBE21TE5zzejXjM3K6T/tTojgAcx+kV/BI/YvDaItuf89AuKED07TdGB99jGvWwnXJO8fqWxX5cdhfXifcJCksydn+NF4+TGGXJ8e8aj+6usjD3Q5OU6pAbrk8iKvmbV+GC9H8h9HJ6lpLPVZl9s83Lpwmmn2+yspimVrOC7DaWJTQcRyBbIogLLdKGZVl6hr1n0y29fQqVso1ZrYe32AfVH7t8h+eyypO8DkOdFQAAAABJRU5ErkJggg=="},"images":{"fallback":{"src":"/static/0c53f8363afef00e7c0b2f0be6479ce3/750db/tg-dry-cover.png","srcSet":"/static/0c53f8363afef00e7c0b2f0be6479ce3/aa4af/tg-dry-cover.png 750w,\n/static/0c53f8363afef00e7c0b2f0be6479ce3/750db/tg-dry-cover.png 753w","sizes":"100vw"},"sources":[{"srcSet":"/static/0c53f8363afef00e7c0b2f0be6479ce3/e9d06/tg-dry-cover.webp 750w,\n/static/0c53f8363afef00e7c0b2f0be6479ce3/7316a/tg-dry-cover.webp 753w","type":"image/webp","sizes":"100vw"}]},"width":1,"height":0.43957503320053126}}},"coverCredits":"Photo by Saifeddine Rajhi"}}},"pageContext":{"prevThought":{"frontmatter":{"path":"/blog/kubernetes-open-standards/","title":"The State of Kubernetes Open Standards: What You Need to Know","date":"2024-10-23 20:06:00"},"excerpt":"Discover k8s open standards (OCI, CRI, CNI, CSI, SMI, CPI, KSD, CIL) ğŸ•¸ ğŸ² Preamble Kubernetes relies on a number of open standards toâ€¦"},"nextThought":{"frontmatter":{"path":"/blog/helmfile-declarative-helm-charts/","title":"Helmfile: A Declarative Way to Deploy Helm Charts","date":"2024-10-23 19:36:00"},"excerpt":"The Key to Managing Your Kubernetes Applications ğŸ“” Intro Helmfile is a tool that can help simplify Kubernetes deployments by automating theâ€¦"}}},"staticQueryHashes":["1271460761","1321585977"],"slicesMap":{}}