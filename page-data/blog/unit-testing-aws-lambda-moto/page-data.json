{"componentChunkName":"component---src-templates-blog-template-js","path":"/blog/unit-testing-aws-lambda-moto/","result":{"data":{"markdownRemark":{"html":"<blockquote>\n<p><strong>Quality Assurance and Resilience of AWS Lambda with Moto üöÅ‚ú®</strong></p>\n</blockquote>\n<h2 id=\"-introduction\" style=\"position:relative;\"><a href=\"#-introduction\" aria-label=\" introduction permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üìç Introduction</h2>\n<p>When developing <a href=\"https://www.cloudflare.com/en-gb/learning/serverless/what-is-serverless/\" target=\"_blank\" rel=\"noopener noreferrer\">serverless</a> <a href=\"https://en.wikipedia.org/wiki/Event-driven_architecture\" target=\"_blank\" rel=\"noopener noreferrer\">event-driven</a> applications with AWS Lambda, ensuring the reliability and functionality of individual components is important.</p>\n<p><a href=\"https://www.techtarget.com/searchsoftwarequality/definition/unit-testing\" target=\"_blank\" rel=\"noopener noreferrer\">Unit testing</a> serves as a fundamental practice to swiftly identify and isolate potential issues within <a href=\"https://aws.amazon.com/lambda/features/\" target=\"_blank\" rel=\"noopener noreferrer\">AWS Lambda function</a> code.</p>\n<p>This blog post explores the application of unit testing techniques for Python-based AWS Lambda functions, particularly focusing on interactions with various AWS services. In this context, the <a href=\"https://github.com/getmoto/moto/tree/master\" target=\"_blank\" rel=\"noopener noreferrer\">Moto</a> library emerges as a valuable tool for simulating AWS resources, enabling the testing of Python code that interfaces with services such as <a href=\"https://aws.amazon.com/dynamodb/features/\" target=\"_blank\" rel=\"noopener noreferrer\">DynamoDB</a> and <a href=\"https://aws.amazon.com/s3/features/\" target=\"_blank\" rel=\"noopener noreferrer\">S3</a>.</p>\n<p>Through the integration of Moto with <a href=\"https://github.com/pytest-dev/pytest\" target=\"_blank\" rel=\"noopener noreferrer\">pytest</a>, this post aims to provide insights into effectively testing Python-based AWS Lambda functions.</p>\n<p><span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 52.352941176470594%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsTAAALEwEAmpwYAAABcUlEQVR42p2SXU7CQBSFWYpLcgMuwNX4aOIOfPVFfNCIlRhFQsQoRSlIhPJTKFN+SqdzZ463FeVH9MGbnJzMafPl5sxksDHGAPOY2DVMPGZNYNRsRVPOAkBLbJvMZjAMY1RcASIFGpSgvBLIfwQNE5WhRxWQV4QeN2Bozop+ApOtkql1BZx+gJ4IIWMJLWyQqEJP39lfQQxLQBTUWA6f+Rv7N2AJ/AxKjT7qPQEvmEIq+iphobVitmSrwMXBm0SYRRL17hRzGXPCPZo47XMJMRtQ8ztwxP35ocJT6xYijPCfWQP6IWHQsWAX9yA8CyF31SzsY+Rm03+0prW9NFdlzB8bNnyFy/wBHGsX+bsj1iEKJzuwCse4dwnndhunD2/IlpuprpwhbqptfhG0/dn0x3O0hYQbhGiNJNr+DN0ggs2dXjy3cP3SQY49V2nBsl2cld9RcjpYXSqz2q5OXFMqnUqnrkgZGSuzcROcaxMrWss+ACkJAmVIWYLsAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"Unit Testing AWS Lambda\" title=\"\" src=\"/static/c47a8ffa88342cc7eb06d4b7077a1cb0/c5bb3/ut.png\" srcset=\"/static/c47a8ffa88342cc7eb06d4b7077a1cb0/04472/ut.png 170w,\n/static/c47a8ffa88342cc7eb06d4b7077a1cb0/9f933/ut.png 340w,\n/static/c47a8ffa88342cc7eb06d4b7077a1cb0/c5bb3/ut.png 680w,\n/static/c47a8ffa88342cc7eb06d4b7077a1cb0/5a190/ut.png 800w\" sizes=\"(max-width: 680px) 100vw, 680px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n    </span>\n          </p>\n<h3 id=\"Ô∏è-what-is-moto-and-why-use-it\" style=\"position:relative;\"><a href=\"#%EF%B8%8F-what-is-moto-and-why-use-it\" aria-label=\"Ô∏è what is moto and why use it permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üõ†Ô∏è What is Moto and Why Use It?</h3>\n<p>When testing code that interacts with cloud services, it's essential to mimic the functionality of those services. However, replicating them completely locally can be challenging. This is where <a href=\"https://github.com/getmoto/moto\" target=\"_blank\" rel=\"noopener noreferrer\">Moto</a>, a library that allows mocking AWS services, comes into play.</p>\n<p>Moto is particularly useful when testing Python code that interacts with AWS services like DynamoDB, S3, and others. It enables developers to simulate AWS resources, making it easier to test code that interfaces with various AWS services.</p>\n<p>By using Moto in combination with <a href=\"https://docs.pytest.org/en/6.2.x/\" target=\"_blank\" rel=\"noopener noreferrer\">pytest</a>, developers can ensure comprehensive testing of their Python code, thereby enhancing the reliability and quality of their applications.</p>\n<p>Moto has gained recognition for its ability to simplify testing in the cloud, making it a valuable tool for developers working on serverless applications. By using Moto, developers can test their code without the need to directly access real AWS resources, ultimately streamlining the testing process and contributing to the overall robustness of their applications.</p>\n<p><span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 126.47058823529413%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAZCAYAAAAxFw7TAAAACXBIWXMAAAsTAAALEwEAmpwYAAACgUlEQVR42o2Vh44iQQxE5/9/CgEiigwi55xzTr57lrya2xV7bamZmQ5ll8tuPPlr9/tdptOpdLtdaTabUq1WdZTLZSmVStJqtaRYLOqzVqvpfL/fl9lspmex9/utT4+f5/Mpm81GxuOxtNttyWazCjQajWQymehzMBgoSKVSUafs3W63etZv3u12k+v1Ko/HQ8EajYYcDgf1zObX6yWXy0XYdzqd5Hg8Sq/Xk3q9rvN8n89nfQfHgyZeAcpkMuqdzXzvdjvZ7/caIWvMQzmXy0mhUNABfeY4R9q81WqluVgsFhohh5fLpVI1z6wNh0NdgzbOACKYTqejc6yDpTmELkakTELVkmwJZwDOXhwkk0lNC05NGNKjgGxIp9OSz+clEono05JtwHxDm0F08XhcKyEWi2l0tlcBSTY0Gev1WhXHm9/YjNJQnM/nX0GQP85/qSwfDGooCx0GApF4UxaHpIiK+KdsvgMZRXIJ9UAgINFoVILBoNIkJXwTXSKR0Fr8FdCM6IgKYFOdCJkjJdCkTJj/0SmfDKocpGA5TP2hKjShzrtfkI+AtohAKAl1wOhnipkntQcwtekcIbShC20UplygiyOEIUqnCL9Hy2EoEykpAMjWALTGcAJkMxRpM3qZwgbcDEBz4ATop47KCOGPCEDmnAGhS1eQQ6Kj7ugUa01nQH+BIwZqc+ly+dJuFiU3FVecc4REYpQBJmKGOeTdX9wf65DyQAioIgKCcGVRd9zY1CHUYcDfwa+ARAUVK2TEsHeAU6mUfgOMs/8CYrQbnWCFbF0BOO/Uo12wP+5DFwMA+qFQSCMzcNKAWE6i4NEuWsoFmtBFcfujCofD+l9krfcHfkBvY6i+hoUAAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"UT AWS Lambda\" title=\"\" src=\"/static/d3a07e298be6630d63af77e5b340123b/c5bb3/graph.png\" srcset=\"/static/d3a07e298be6630d63af77e5b340123b/04472/graph.png 170w,\n/static/d3a07e298be6630d63af77e5b340123b/9f933/graph.png 340w,\n/static/d3a07e298be6630d63af77e5b340123b/c5bb3/graph.png 680w,\n/static/d3a07e298be6630d63af77e5b340123b/5a190/graph.png 800w\" sizes=\"(max-width: 680px) 100vw, 680px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n    </span>\n          </p>\n<h2 id=\"-decorator-approach\" style=\"position:relative;\"><a href=\"#-decorator-approach\" aria-label=\" decorator approach permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üß© Decorator Approach</h2>\n<p>The decorator approach simplifies AWS service mocking using Moto in the <code class=\"language-text\">eu-west-1</code> region. The <code class=\"language-text\">@mock_ec2</code> decorator encapsulates the test function, ensuring automatic management of the Moto mock environment for seamless testing.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">import</span> boto3\n<span class=\"token keyword\">from</span> moto <span class=\"token keyword\">import</span> mock_ec2\n<span class=\"token keyword\">from</span> main <span class=\"token keyword\">import</span> create_instances\n\n<span class=\"token decorator annotation punctuation\">@mock_ec2</span>\n<span class=\"token keyword\">def</span> <span class=\"token function\">test_create_instances_with_decorator</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    instance_count <span class=\"token operator\">=</span> <span class=\"token number\">1</span>\n    image_id <span class=\"token operator\">=</span> <span class=\"token string\">'ami-02ed82f3a38303e6f'</span>\n    create_instances<span class=\"token punctuation\">(</span><span class=\"token string\">'eu-west-1'</span><span class=\"token punctuation\">,</span> image_id<span class=\"token punctuation\">,</span> instance_count<span class=\"token punctuation\">)</span>\n    client <span class=\"token operator\">=</span> boto3<span class=\"token punctuation\">.</span>client<span class=\"token punctuation\">(</span><span class=\"token string\">'ec2'</span><span class=\"token punctuation\">,</span> region_name<span class=\"token operator\">=</span><span class=\"token string\">'eu-west-1'</span><span class=\"token punctuation\">)</span>\n    instances <span class=\"token operator\">=</span> client<span class=\"token punctuation\">.</span>describe_instances<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token string\">'Reservations'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token string\">'Instances'</span><span class=\"token punctuation\">]</span>\n    <span class=\"token keyword\">assert</span> <span class=\"token builtin\">len</span><span class=\"token punctuation\">(</span>instances<span class=\"token punctuation\">)</span> <span class=\"token operator\">==</span> instance_count\n    <span class=\"token keyword\">assert</span> instances<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token string\">'ImageId'</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">==</span> image_id</code></pre></div>\n<h2 id=\"-context-manager-approach\" style=\"position:relative;\"><a href=\"#-context-manager-approach\" aria-label=\" context manager approach permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üß© Context Manager Approach</h2>\n<p>In the Ireland region, the context manager-based approach facilitates AWS service mocking with Moto. Utilizing <code class=\"language-text\">with mock_ec2():</code>, the test logic within the block benefits from the active Moto mock environment, maintaining clarity and proper resource management.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">import</span> boto3\n<span class=\"token keyword\">from</span> main <span class=\"token keyword\">import</span> create_instances\n<span class=\"token keyword\">from</span> moto <span class=\"token keyword\">import</span> mock_ec2\n\n<span class=\"token keyword\">def</span> <span class=\"token function\">test_create_instances_with_context_manager</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">with</span> mock_ec2<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        instance_count <span class=\"token operator\">=</span> <span class=\"token number\">1</span>\n        image_id <span class=\"token operator\">=</span> <span class=\"token string\">'ami-02ed82f3a38303e6f'</span>\n        create_instances<span class=\"token punctuation\">(</span><span class=\"token string\">'eu-west-1'</span><span class=\"token punctuation\">,</span> image_id<span class=\"token punctuation\">,</span> instance_count<span class=\"token punctuation\">)</span>\n        client <span class=\"token operator\">=</span> boto3<span class=\"token punctuation\">.</span>client<span class=\"token punctuation\">(</span><span class=\"token string\">'ec2'</span><span class=\"token punctuation\">,</span> region_name<span class=\"token operator\">=</span><span class=\"token string\">'eu-west-1'</span><span class=\"token punctuation\">)</span>\n        instances <span class=\"token operator\">=</span> client<span class=\"token punctuation\">.</span>describe_instances<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token string\">'Reservations'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token string\">'Instances'</span><span class=\"token punctuation\">]</span>\n        <span class=\"token keyword\">assert</span> <span class=\"token builtin\">len</span><span class=\"token punctuation\">(</span>instances<span class=\"token punctuation\">)</span> <span class=\"token operator\">==</span> instance_count\n        <span class=\"token keyword\">assert</span> instances<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token string\">'ImageId'</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">==</span> image_id</code></pre></div>\n<h2 id=\"-raw-approach\" style=\"position:relative;\"><a href=\"#-raw-approach\" aria-label=\" raw approach permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üß© Raw Approach</h2>\n<p>For explicit control over the Moto mock environment, the raw approach is demonstrated in the Ireland region. Manually starting and stopping the mock using <code class=\"language-text\">mock.start()</code> and <code class=\"language-text\">mock.stop()</code> provides flexibility, as shown in the following example.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">import</span> boto3\n<span class=\"token keyword\">from</span> main <span class=\"token keyword\">import</span> create_instances\n<span class=\"token keyword\">from</span> moto <span class=\"token keyword\">import</span> mock_ec2\n\n<span class=\"token keyword\">def</span> <span class=\"token function\">test_create_instances_raw</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    mock <span class=\"token operator\">=</span> mock_ec2<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    mock<span class=\"token punctuation\">.</span>start<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    instance_count <span class=\"token operator\">=</span> <span class=\"token number\">1</span>\n    image_id <span class=\"token operator\">=</span> <span class=\"token string\">'ami-02ed82f3a38303e6f'</span>\n    create_instances<span class=\"token punctuation\">(</span><span class=\"token string\">'eu-west-1'</span><span class=\"token punctuation\">,</span> image_id<span class=\"token punctuation\">,</span> instance_count<span class=\"token punctuation\">)</span>\n    client <span class=\"token operator\">=</span> boto3<span class=\"token punctuation\">.</span>client<span class=\"token punctuation\">(</span><span class=\"token string\">'ec2'</span><span class=\"token punctuation\">,</span> region_name<span class=\"token operator\">=</span><span class=\"token string\">'eu-west-1'</span><span class=\"token punctuation\">)</span>\n    instances <span class=\"token operator\">=</span> client<span class=\"token punctuation\">.</span>describe_instances<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token string\">'Reservations'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token string\">'Instances'</span><span class=\"token punctuation\">]</span>\n    <span class=\"token keyword\">assert</span> <span class=\"token builtin\">len</span><span class=\"token punctuation\">(</span>instances<span class=\"token punctuation\">)</span> <span class=\"token operator\">==</span> instance_count\n    <span class=\"token keyword\">assert</span> instances<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token string\">'ImageId'</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">==</span> image_id\n    mock<span class=\"token punctuation\">.</span>stop<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></code></pre></div>\n<hr>\n<h2 id=\"-local-lambda-testing\" style=\"position:relative;\"><a href=\"#-local-lambda-testing\" aria-label=\" local lambda testing permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üé© Local Lambda Testing</h2>\n<p>Moto uses decorators to intercept and simulate responses to and from AWS resources. By adding a decorator for a given AWS service, subsequent calls from the module to that service will be re-directed to the mock.</p>\n<p>In this section, we'll couple the Moto library and pytest framework to have clean and scalable unit tests. Let's test a serverless app using Pytest and Moto. Our goal? Check if a piece of code (AWS Lambda) works right. We'll focus on the Lambda function, not AWS services. We'll use Pytest for testing and Moto to pretend AWS services. This keeps tests clear and reliable.</p>\n<h3 id=\"-lambda-function-code\" style=\"position:relative;\"><a href=\"#-lambda-function-code\" aria-label=\" lambda function code permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üìÑ Lambda Function Code</h3>\n<p>This file (<code class=\"language-text\">main.py</code>) contains the main Lambda function (<code class=\"language-text\">lambda_handler</code>) that manipulates data and uploads it to an S3 bucket. It utilizes the Boto3 library to interact with AWS services.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">import</span> boto3\n\n<span class=\"token keyword\">def</span> <span class=\"token function\">lambda_handler</span><span class=\"token punctuation\">(</span>event<span class=\"token punctuation\">,</span> context<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token comment\"># Sample Lambda function that manipulates data and uploads to S3</span>\n    data_to_upload <span class=\"token operator\">=</span> <span class=\"token string\">\"Hello, Moto!\"</span>\n\n    <span class=\"token comment\"># AWS S3 Configuration</span>\n    s3_bucket <span class=\"token operator\">=</span> <span class=\"token string\">\"your-s3-bucket\"</span>\n    s3_key <span class=\"token operator\">=</span> <span class=\"token string\">\"example.txt\"</span>\n\n    <span class=\"token comment\"># Upload to S3</span>\n    s3 <span class=\"token operator\">=</span> boto3<span class=\"token punctuation\">.</span>client<span class=\"token punctuation\">(</span><span class=\"token string\">\"s3\"</span><span class=\"token punctuation\">)</span>\n    s3<span class=\"token punctuation\">.</span>put_object<span class=\"token punctuation\">(</span>Body<span class=\"token operator\">=</span>data_to_upload<span class=\"token punctuation\">,</span> Bucket<span class=\"token operator\">=</span>s3_bucket<span class=\"token punctuation\">,</span> Key<span class=\"token operator\">=</span>s3_key<span class=\"token punctuation\">)</span>\n\n    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span><span class=\"token string\">\"statusCode\"</span><span class=\"token punctuation\">:</span> <span class=\"token number\">200</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"body\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"Data uploaded to S3 successfully.\"</span><span class=\"token punctuation\">}</span></code></pre></div>\n<h3 id=\"Ô∏è-pytest-configuration\" style=\"position:relative;\"><a href=\"#%EF%B8%8F-pytest-configuration\" aria-label=\"Ô∏è pytest configuration permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üõ†Ô∏è Pytest Configuration</h3>\n<p><code class=\"language-text\">conftest.py</code> serves as a configuration file for Pytest. In this example, it defines two fixtures:</p>\n<ul>\n<li><strong>aws_credentials</strong>: A fixture to set up mocked AWS credentials using environment variables.</li>\n<li><strong>s3_mock</strong>: A fixture that uses Moto's <code class=\"language-text\">mock_s3</code> context manager to mock the S3 service. It depends on the <code class=\"language-text\">aws_credentials</code> fixture to ensure mocked credentials are available.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">import</span> pytest\n<span class=\"token keyword\">import</span> os\n<span class=\"token keyword\">from</span> moto <span class=\"token keyword\">import</span> mock_s3\n\n<span class=\"token decorator annotation punctuation\">@pytest<span class=\"token punctuation\">.</span>fixture</span><span class=\"token punctuation\">(</span>scope<span class=\"token operator\">=</span><span class=\"token string\">'function'</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">def</span> <span class=\"token function\">aws_credentials</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token comment\"># Mocked AWS Credentials for Moto</span>\n    os<span class=\"token punctuation\">.</span>environ<span class=\"token punctuation\">[</span><span class=\"token string\">'AWS_ACCESS_KEY_ID'</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token string\">'fake-access-key'</span>\n    os<span class=\"token punctuation\">.</span>environ<span class=\"token punctuation\">[</span><span class=\"token string\">'AWS_SECRET_ACCESS_KEY'</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token string\">'fake-secret-key'</span>\n    os<span class=\"token punctuation\">.</span>environ<span class=\"token punctuation\">[</span><span class=\"token string\">'AWS_SECURITY_TOKEN'</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token string\">'fake-security-token'</span>\n    os<span class=\"token punctuation\">.</span>environ<span class=\"token punctuation\">[</span><span class=\"token string\">'AWS_SESSION_TOKEN'</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token string\">'fake-session-token'</span>\n\n<span class=\"token decorator annotation punctuation\">@pytest<span class=\"token punctuation\">.</span>fixture</span><span class=\"token punctuation\">(</span>scope<span class=\"token operator\">=</span><span class=\"token string\">'function'</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">def</span> <span class=\"token function\">s3_mock</span><span class=\"token punctuation\">(</span>aws_credentials<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">with</span> mock_s3<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        <span class=\"token keyword\">yield</span> boto3<span class=\"token punctuation\">.</span>client<span class=\"token punctuation\">(</span><span class=\"token string\">'s3'</span><span class=\"token punctuation\">)</span></code></pre></div>\n<h3 id=\"-unit-test\" style=\"position:relative;\"><a href=\"#-unit-test\" aria-label=\" unit test permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üß™ Unit Test</h3>\n<p><code class=\"language-text\">test_main.py</code> is a Pytest test file that contains a single unit test (<code class=\"language-text\">test_lambda_handler</code>). This test checks if the Lambda function in <code class=\"language-text\">main.py</code> successfully uploads a file to an S3 bucket. It uses the <code class=\"language-text\">s3_mock</code> and <code class=\"language-text\">aws_credentials</code> fixtures from <code class=\"language-text\">conftest.py</code> to set up the required mocking environment.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">import</span> pytest\n<span class=\"token keyword\">import</span> boto3\n<span class=\"token keyword\">from</span> main <span class=\"token keyword\">import</span> lambda_handler\n\n<span class=\"token keyword\">def</span> <span class=\"token function\">test_lambda_handler</span><span class=\"token punctuation\">(</span>s3_mock<span class=\"token punctuation\">,</span> aws_credentials<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token comment\"># Event and Context are not used in this example</span>\n    event <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n    context <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n\n    <span class=\"token comment\"># Invoke the Lambda function</span>\n    response <span class=\"token operator\">=</span> lambda_handler<span class=\"token punctuation\">(</span>event<span class=\"token punctuation\">,</span> context<span class=\"token punctuation\">)</span>\n\n    <span class=\"token comment\"># Check if the S3 object was created successfully</span>\n    <span class=\"token keyword\">assert</span> response<span class=\"token punctuation\">[</span><span class=\"token string\">\"statusCode\"</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">==</span> <span class=\"token number\">200</span>\n\n    <span class=\"token comment\"># Check if the object exists in S3</span>\n    objects <span class=\"token operator\">=</span> s3_mock<span class=\"token punctuation\">.</span>list_objects<span class=\"token punctuation\">(</span>Bucket<span class=\"token operator\">=</span><span class=\"token string\">'your-s3-bucket'</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">assert</span> objects<span class=\"token punctuation\">[</span><span class=\"token string\">\"Contents\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token string\">\"Key\"</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">==</span> <span class=\"token string\">\"example.txt\"</span></code></pre></div>\n<h3 id=\"-running-the-unit-tests\" style=\"position:relative;\"><a href=\"#-running-the-unit-tests\" aria-label=\" running the unit tests permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üöÄ Running the Unit Tests</h3>\n<p>The unit testing framework can be run using the Python <code class=\"language-text\">pytest</code> utility. To ensure network isolation and verify the unit tests are not accidentally connecting to AWS resources, the <a href=\"https://pypi.org/project/pytest-socket/\" target=\"_blank\" rel=\"noopener noreferrer\">pytest-socket</a> project provides the ability to disable network communication during a test.</p>\n<div class=\"gatsby-highlight\" data-language=\"sh\"><pre class=\"language-sh\"><code class=\"language-sh\">pytest <span class=\"token parameter variable\">-v</span> --disable-socket <span class=\"token parameter variable\">-s</span> test_main.py</code></pre></div>\n<p>The <code class=\"language-text\">pytest</code> command results in a PASSED or FAILED status for each test. A PASSED status verifies that your unit tests, as written, did not encounter errors or issues.</p>\n<h3 id=\"-conclusion\" style=\"position:relative;\"><a href=\"#-conclusion\" aria-label=\" conclusion permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üìå Conclusion</h3>\n<p>In this guide, we explored some ways for mocking AWS responses with Moto, offering a swift and cost-free approach to testing Python code. When paired with Pytest, it delivers scalable and tidy unit tests specifically tailored for AWS interactions.</p>\n<h3 id=\"-what-next\" style=\"position:relative;\"><a href=\"#-what-next\" aria-label=\" what next permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üîç What Next?</h3>\n<p>You can keep an eye on this <a href=\"https://github.com/seifrajhi/Python-AWS-Lambda-Testing\" target=\"_blank\" rel=\"noopener noreferrer\">repository</a> as I continue to develop it and add more use cases and integrations!</p>\n<br>\n<p><strong><em>Until next time, „Å§„Å•„Åè üéâ</em></strong></p>\n<blockquote>\n<p>üí° Thank you for Reading !! üôåüèªüòÅüìÉ, see you in the next blog.ü§ò  <em><strong>Until next time üéâ</strong></em></p>\n</blockquote>\n<p>üöÄ Thank you for sticking up till the end. If you have any questions/feedback regarding this blog feel free to connect with me:</p>\n<p><strong>‚ôªÔ∏è LinkedIn:</strong> <a href=\"https://www.linkedin.com/in/rajhi-saif/\" target=\"_blank\" rel=\"noopener noreferrer\">https://www.linkedin.com/in/rajhi-saif/</a></p>\n<p><strong>‚ôªÔ∏è X/Twitter:</strong> <a href=\"https://x.com/rajhisaifeddine\" target=\"_blank\" rel=\"noopener noreferrer\">https://x.com/rajhisaifeddine</a></p>\n<p><strong>The end ‚úåüèª</strong></p>\n<h1 align=\"center\">üî∞ Keep Learning !! Keep Sharing !! üî∞</h1>\n<p><strong>üìÖ Stay updated</strong></p>\n<p>Subscribe to our newsletter for more insights on AWS cloud computing and containers.</p>","timeToRead":5,"rawMarkdownBody":"\n> **Quality Assurance and Resilience of AWS Lambda with Moto üöÅ‚ú®**\n\n## üìç Introduction\n\nWhen developing [serverless](https://www.cloudflare.com/en-gb/learning/serverless/what-is-serverless/) [event-driven](https://en.wikipedia.org/wiki/Event-driven_architecture) applications with AWS Lambda, ensuring the reliability and functionality of individual components is important.\n\n[Unit testing](https://www.techtarget.com/searchsoftwarequality/definition/unit-testing) serves as a fundamental practice to swiftly identify and isolate potential issues within [AWS Lambda function](https://aws.amazon.com/lambda/features/) code.\n\nThis blog post explores the application of unit testing techniques for Python-based AWS Lambda functions, particularly focusing on interactions with various AWS services. In this context, the [Moto](https://github.com/getmoto/moto/tree/master) library emerges as a valuable tool for simulating AWS resources, enabling the testing of Python code that interfaces with services such as [DynamoDB](https://aws.amazon.com/dynamodb/features/) and [S3](https://aws.amazon.com/s3/features/).\n\nThrough the integration of Moto with [pytest](https://github.com/pytest-dev/pytest), this post aims to provide insights into effectively testing Python-based AWS Lambda functions.\n\n![Unit Testing AWS Lambda](./ut.png)\n\n### üõ†Ô∏è What is Moto and Why Use It?\n\nWhen testing code that interacts with cloud services, it's essential to mimic the functionality of those services. However, replicating them completely locally can be challenging. This is where [Moto](https://github.com/getmoto/moto), a library that allows mocking AWS services, comes into play.\n\nMoto is particularly useful when testing Python code that interacts with AWS services like DynamoDB, S3, and others. It enables developers to simulate AWS resources, making it easier to test code that interfaces with various AWS services.\n\nBy using Moto in combination with [pytest](https://docs.pytest.org/en/6.2.x/), developers can ensure comprehensive testing of their Python code, thereby enhancing the reliability and quality of their applications.\n\nMoto has gained recognition for its ability to simplify testing in the cloud, making it a valuable tool for developers working on serverless applications. By using Moto, developers can test their code without the need to directly access real AWS resources, ultimately streamlining the testing process and contributing to the overall robustness of their applications.\n\n\n![UT AWS Lambda](./graph.png)\n\n## üß© Decorator Approach\n\nThe decorator approach simplifies AWS service mocking using Moto in the `eu-west-1` region. The `@mock_ec2` decorator encapsulates the test function, ensuring automatic management of the Moto mock environment for seamless testing.\n\n```python\nimport boto3\nfrom moto import mock_ec2\nfrom main import create_instances\n\n@mock_ec2\ndef test_create_instances_with_decorator(self):\n    instance_count = 1\n    image_id = 'ami-02ed82f3a38303e6f'\n    create_instances('eu-west-1', image_id, instance_count)\n    client = boto3.client('ec2', region_name='eu-west-1')\n    instances = client.describe_instances()['Reservations'][0]['Instances']\n    assert len(instances) == instance_count\n    assert instances[0]['ImageId'] == image_id\n```\n\n## üß© Context Manager Approach\n\nIn the Ireland region, the context manager-based approach facilitates AWS service mocking with Moto. Utilizing `with mock_ec2():`, the test logic within the block benefits from the active Moto mock environment, maintaining clarity and proper resource management.\n\n```python\nimport boto3\nfrom main import create_instances\nfrom moto import mock_ec2\n\ndef test_create_instances_with_context_manager(self):\n    with mock_ec2():\n        instance_count = 1\n        image_id = 'ami-02ed82f3a38303e6f'\n        create_instances('eu-west-1', image_id, instance_count)\n        client = boto3.client('ec2', region_name='eu-west-1')\n        instances = client.describe_instances()['Reservations'][0]['Instances']\n        assert len(instances) == instance_count\n        assert instances[0]['ImageId'] == image_id\n```\n\n## üß© Raw Approach\n\nFor explicit control over the Moto mock environment, the raw approach is demonstrated in the Ireland region. Manually starting and stopping the mock using `mock.start()` and `mock.stop()` provides flexibility, as shown in the following example.\n\n```python\nimport boto3\nfrom main import create_instances\nfrom moto import mock_ec2\n\ndef test_create_instances_raw(self):\n    mock = mock_ec2()\n    mock.start()\n    instance_count = 1\n    image_id = 'ami-02ed82f3a38303e6f'\n    create_instances('eu-west-1', image_id, instance_count)\n    client = boto3.client('ec2', region_name='eu-west-1')\n    instances = client.describe_instances()['Reservations'][0]['Instances']\n    assert len(instances) == instance_count\n    assert instances[0]['ImageId'] == image_id\n    mock.stop()\n```\n\n\n---\n\n## üé© Local Lambda Testing\n\nMoto uses decorators to intercept and simulate responses to and from AWS resources. By adding a decorator for a given AWS service, subsequent calls from the module to that service will be re-directed to the mock.\n\nIn this section, we'll couple the Moto library and pytest framework to have clean and scalable unit tests. Let's test a serverless app using Pytest and Moto. Our goal? Check if a piece of code (AWS Lambda) works right. We'll focus on the Lambda function, not AWS services. We'll use Pytest for testing and Moto to pretend AWS services. This keeps tests clear and reliable.\n\n### üìÑ Lambda Function Code\n\nThis file (`main.py`) contains the main Lambda function (`lambda_handler`) that manipulates data and uploads it to an S3 bucket. It utilizes the Boto3 library to interact with AWS services.\n\n```python\nimport boto3\n\ndef lambda_handler(event, context):\n    # Sample Lambda function that manipulates data and uploads to S3\n    data_to_upload = \"Hello, Moto!\"\n\n    # AWS S3 Configuration\n    s3_bucket = \"your-s3-bucket\"\n    s3_key = \"example.txt\"\n\n    # Upload to S3\n    s3 = boto3.client(\"s3\")\n    s3.put_object(Body=data_to_upload, Bucket=s3_bucket, Key=s3_key)\n\n    return {\"statusCode\": 200, \"body\": \"Data uploaded to S3 successfully.\"}\n```\n\n### üõ†Ô∏è Pytest Configuration\n\n`conftest.py` serves as a configuration file for Pytest. In this example, it defines two fixtures:\n\n- **aws_credentials**: A fixture to set up mocked AWS credentials using environment variables.\n- **s3_mock**: A fixture that uses Moto's `mock_s3` context manager to mock the S3 service. It depends on the `aws_credentials` fixture to ensure mocked credentials are available.\n\n```python\nimport pytest\nimport os\nfrom moto import mock_s3\n\n@pytest.fixture(scope='function')\ndef aws_credentials():\n    # Mocked AWS Credentials for Moto\n    os.environ['AWS_ACCESS_KEY_ID'] = 'fake-access-key'\n    os.environ['AWS_SECRET_ACCESS_KEY'] = 'fake-secret-key'\n    os.environ['AWS_SECURITY_TOKEN'] = 'fake-security-token'\n    os.environ['AWS_SESSION_TOKEN'] = 'fake-session-token'\n\n@pytest.fixture(scope='function')\ndef s3_mock(aws_credentials):\n    with mock_s3():\n        yield boto3.client('s3')\n```\n\n### üß™ Unit Test\n\n`test_main.py` is a Pytest test file that contains a single unit test (`test_lambda_handler`). This test checks if the Lambda function in `main.py` successfully uploads a file to an S3 bucket. It uses the `s3_mock` and `aws_credentials` fixtures from `conftest.py` to set up the required mocking environment.\n\n```python\nimport pytest\nimport boto3\nfrom main import lambda_handler\n\ndef test_lambda_handler(s3_mock, aws_credentials):\n    # Event and Context are not used in this example\n    event = {}\n    context = {}\n\n    # Invoke the Lambda function\n    response = lambda_handler(event, context)\n\n    # Check if the S3 object was created successfully\n    assert response[\"statusCode\"] == 200\n\n    # Check if the object exists in S3\n    objects = s3_mock.list_objects(Bucket='your-s3-bucket')\n    assert objects[\"Contents\"][0][\"Key\"] == \"example.txt\"\n```\n\n### üöÄ Running the Unit Tests\n\nThe unit testing framework can be run using the Python `pytest` utility. To ensure network isolation and verify the unit tests are not accidentally connecting to AWS resources, the [pytest-socket](https://pypi.org/project/pytest-socket/) project provides the ability to disable network communication during a test.\n\n```sh\npytest -v --disable-socket -s test_main.py\n```\n\nThe `pytest` command results in a PASSED or FAILED status for each test. A PASSED status verifies that your unit tests, as written, did not encounter errors or issues.\n\n### üìå Conclusion\n\nIn this guide, we explored some ways for mocking AWS responses with Moto, offering a swift and cost-free approach to testing Python code. When paired with Pytest, it delivers scalable and tidy unit tests specifically tailored for AWS interactions.\n\n### üîç What Next?\n\nYou can keep an eye on this [repository](https://github.com/seifrajhi/Python-AWS-Lambda-Testing) as I continue to develop it and add more use cases and integrations!\n\n<br>\n\n**_Until next time, „Å§„Å•„Åè üéâ_**\n\n> üí° Thank you for Reading !! üôåüèªüòÅüìÉ, see you in the next blog.ü§ò  _**Until next time üéâ**_\n\nüöÄ Thank you for sticking up till the end. If you have any questions/feedback regarding this blog feel free to connect with me:\n\n**‚ôªÔ∏è LinkedIn:** https://www.linkedin.com/in/rajhi-saif/\n\n**‚ôªÔ∏è X/Twitter:** https://x.com/rajhisaifeddine\n\n**The end ‚úåüèª**\n\n<h1 align=\"center\">üî∞ Keep Learning !! Keep Sharing !! üî∞</h1>\n\n**üìÖ Stay updated**\n\nSubscribe to our newsletter for more insights on AWS cloud computing and containers.\n","wordCount":{"words":827},"frontmatter":{"id":"d837800e43e69bcae9a1a4be","path":"/blog/unit-testing-aws-lambda-moto/","humanDate":"Oct 20, 2024","fullDate":"2024-10-20","title":"Unit Testing AWS Lambda with Python and Mock AWS Services Using Moto üìà","keywords":["AWS Lambda","Unit testing","Python","Moto","Mock AWS services"],"excerpt":"Ensure the quality and resilience of your AWS Lambda functions with Python and Moto for effective unit testing.","cover":{"childImageSharp":{"gatsbyImageData":{"layout":"fullWidth","placeholder":{"fallback":"data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAALABQDASIAAhEBAxEB/8QAFwAAAwEAAAAAAAAAAAAAAAAAAAMFAv/EABYBAQEBAAAAAAAAAAAAAAAAAAMAAv/aAAwDAQACEAMQAAABduRXFnDiz//EABoQAQEAAgMAAAAAAAAAAAAAAAECAAMREiH/2gAIAQEAAQUC7eTthBeKpzRTRn//xAAXEQEAAwAAAAAAAAAAAAAAAAAAAQIR/9oACAEDAQE/AZqx/8QAFxEBAQEBAAAAAAAAAAAAAAAAAQASE//aAAgBAgEBPwHaXVv/xAAcEAAABgMAAAAAAAAAAAAAAAAAARAREiECMUH/2gAIAQEABj8CfI2FSkm+i0//xAAbEAADAQADAQAAAAAAAAAAAAAAASERMVFhsf/aAAgBAQABPyGcIoKsUTTo1XwTz05ooQ50Yj//2gAMAwEAAgADAAAAEGjf/8QAFhEBAQEAAAAAAAAAAAAAAAAAAAER/9oACAEDAQE/EIVl/8QAFxEBAAMAAAAAAAAAAAAAAAAAABEhYf/aAAgBAgEBPxCDbB//xAAeEAEAAgIBBQAAAAAAAAAAAAABABEhQTFhcYGRsf/aAAgBAQABPxB8QWS+xzGS4QQt9KhhKO8pbLNEaPcXWjawnwlGif/Z"},"images":{"fallback":{"src":"/static/ac13cde9802f6a6d3725e9cf50043479/0e3c8/ut-moto-lambda-cover.jpg","srcSet":"/static/ac13cde9802f6a6d3725e9cf50043479/53d53/ut-moto-lambda-cover.jpg 750w,\n/static/ac13cde9802f6a6d3725e9cf50043479/0e3c8/ut-moto-lambda-cover.jpg 800w","sizes":"100vw"},"sources":[{"srcSet":"/static/ac13cde9802f6a6d3725e9cf50043479/ee3fa/ut-moto-lambda-cover.webp 750w,\n/static/ac13cde9802f6a6d3725e9cf50043479/8e613/ut-moto-lambda-cover.webp 800w","type":"image/webp","sizes":"100vw"}]},"width":1,"height":0.5525}}},"coverCredits":"Photo by Saifeddine Rajhi"}}},"pageContext":{"prevThought":{"frontmatter":{"path":"/blog/spot-idle-aws-resources/","title":"Uncover hidden AWS costs with unusd.cloud: save money and reduce risk","date":"2024-10-20 18:06:00"},"excerpt":"Discover hidden costs: Spot idle AWS resources üí∏ üí¨ Introduction AWS is a powerful tool that can help businesses of all sizes save money‚Ä¶"},"nextThought":{"frontmatter":{"path":"/blog/aws-eks-workshop-intro/","title":"Hands-on Labs for Amazon EKS: a great intro to learning Amazon EKS","date":"2024-10-19 21:44:00"},"excerpt":"Fun with AWS: Learn AWS EKS Step-by-Step üí¨ üìò Introduction Hey there! Ready to learn EKS? We're diving into the world of Amazon Web‚Ä¶"}}},"staticQueryHashes":["1271460761","1321585977"],"slicesMap":{}}