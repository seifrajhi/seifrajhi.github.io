{"componentChunkName":"component---src-templates-blog-template-js","path":"/blog/unit-testing-aws-lambda-moto/","result":{"data":{"markdownRemark":{"html":"<blockquote>\n<p><strong>Quality Assurance and Resilience of AWS Lambda with Moto üöÅ‚ú®</strong></p>\n</blockquote>\n<h2 id=\"-introduction\" style=\"position:relative;\"><a href=\"#-introduction\" aria-label=\" introduction permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üìç Introduction</h2>\n<p>When developing <a href=\"https://www.cloudflare.com/en-gb/learning/serverless/what-is-serverless/\" target=\"_blank\" rel=\"noopener noreferrer\">serverless</a> <a href=\"https://en.wikipedia.org/wiki/Event-driven_architecture\" target=\"_blank\" rel=\"noopener noreferrer\">event-driven</a> applications with AWS Lambda, ensuring the reliability and functionality of individual components is important.</p>\n<p><a href=\"https://www.techtarget.com/searchsoftwarequality/definition/unit-testing\" target=\"_blank\" rel=\"noopener noreferrer\">Unit testing</a> serves as a fundamental practice to swiftly identify and isolate potential issues within <a href=\"https://aws.amazon.com/lambda/features/\" target=\"_blank\" rel=\"noopener noreferrer\">AWS Lambda function</a> code.</p>\n<p>This blog post explores the application of unit testing techniques for Python-based AWS Lambda functions, particularly focusing on interactions with various AWS services. In this context, the <a href=\"https://github.com/getmoto/moto/tree/master\" target=\"_blank\" rel=\"noopener noreferrer\">Moto</a> library emerges as a valuable tool for simulating AWS resources, enabling the testing of Python code that interfaces with services such as <a href=\"https://aws.amazon.com/dynamodb/features/\" target=\"_blank\" rel=\"noopener noreferrer\">DynamoDB</a> and <a href=\"https://aws.amazon.com/s3/features/\" target=\"_blank\" rel=\"noopener noreferrer\">S3</a>.</p>\n<p>Through the integration of Moto with <a href=\"https://github.com/pytest-dev/pytest\" target=\"_blank\" rel=\"noopener noreferrer\">pytest</a>, this post aims to provide insights into effectively testing Python-based AWS Lambda functions.</p>\n<p><span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 52.352941176470594%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsTAAALEwEAmpwYAAABfUlEQVR42o2S0W7TQBBF8yV8E698AJ/DKxJfwDMPqEJCqCmtRItCCSDigpsUxcG4SRw7wU53d3YP46RIrZsKRrqau+PR3Znr7dCKEKC2otkTTEmwK8XvbXbX2RTgDbui0y7MK8NgskDEIbMPuGkPmX9W9HGzPpIPkMsefjnUC2qCrO8KNlM1EacFcVaSFTXGGnwRIcUZfjVGyu/IIlKhkfJYcb45NxzdpiW4VTwdZgyzgmlZYZz8NWHHYoH7onPz82x1RWUsw7RibZxW1MegfuKvu8KN7vZ5h+CituS148v4HUV99Y9Z/mPCvBamaZeo94ji8oBafbs4fsw82dv0eC94JQ0al7wSH8L9P2WUO/aPnhAfPOTw+JniKScvHtA9ec77ieP1IOHlxxF7/R+KC/bjGUdnE30RcvfZNJrZcs2ksKSlIVlYkrwmXTqiXxVvviYcfkvpam7wNvrJq09jTs/TW9Z0Wu7qDhI2uyDb5ZQ7kWCshHavEx+s3K7/AYzFAhTihvgNAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"Unit Testing AWS Lambda\" title=\"\" src=\"/static/c47a8ffa88342cc7eb06d4b7077a1cb0/c5bb3/ut.png\" srcset=\"/static/c47a8ffa88342cc7eb06d4b7077a1cb0/04472/ut.png 170w,\n/static/c47a8ffa88342cc7eb06d4b7077a1cb0/9f933/ut.png 340w,\n/static/c47a8ffa88342cc7eb06d4b7077a1cb0/c5bb3/ut.png 680w,\n/static/c47a8ffa88342cc7eb06d4b7077a1cb0/5a190/ut.png 800w\" sizes=\"(max-width: 680px) 100vw, 680px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n    </span>\n          </p>\n<h3 id=\"Ô∏è-what-is-moto-and-why-use-it\" style=\"position:relative;\"><a href=\"#%EF%B8%8F-what-is-moto-and-why-use-it\" aria-label=\"Ô∏è what is moto and why use it permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üõ†Ô∏è What is Moto and Why Use It?</h3>\n<p>When testing code that interacts with cloud services, it's essential to mimic the functionality of those services. However, replicating them completely locally can be challenging. This is where <a href=\"https://github.com/getmoto/moto\" target=\"_blank\" rel=\"noopener noreferrer\">Moto</a>, a library that allows mocking AWS services, comes into play.</p>\n<p>Moto is particularly useful when testing Python code that interacts with AWS services like DynamoDB, S3, and others. It enables developers to simulate AWS resources, making it easier to test code that interfaces with various AWS services.</p>\n<p>By using Moto in combination with <a href=\"https://docs.pytest.org/en/6.2.x/\" target=\"_blank\" rel=\"noopener noreferrer\">pytest</a>, developers can ensure comprehensive testing of their Python code, thereby enhancing the reliability and quality of their applications.</p>\n<p>Moto has gained recognition for its ability to simplify testing in the cloud, making it a valuable tool for developers working on serverless applications. By using Moto, developers can test their code without the need to directly access real AWS resources, ultimately streamlining the testing process and contributing to the overall robustness of their applications.</p>\n<p><span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 126.47058823529413%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAZCAYAAAAxFw7TAAAACXBIWXMAAAsTAAALEwEAmpwYAAACg0lEQVR42pWVhW4rQQxF8/8/FSUKMynMzMzk9ljy0yavsLU03Qxd+/p6XI982u12k/F4LO12W2q1mpTLZR3FYlEKhYI0m03J5/PSaDSkUqnoeq/Xk8lkoned5uHP/X6X5XIpw+FQL6VSKQXo9/u6xhcAHAJWr9d1fbVa6d0XwMvlIufzWT21Wi09vNvthHUOPx4P3Wd+OBxkv99Lp9PRc6yzdjwe/53x4LVUKilVIuNgtVrV+Wazke12K4PBQPdYh3Imk1EGuVxOI2ade6TAs1gs9MdsNtNccZnfUMLz6XSS6XSqtNkjOgAAghGj2+1qSsDyPJ9PuV6vyp9D8/lcqbJuxm+jzh4OY7GYpgmn3LczKgoHksmkUgkEApLNZnXTwDDm0E6n0+o4HA5rJUQiEY3eziogiQWUQdgoboDOKKEFRVLASCQSCsr9l7L5yqCDatBhIBCJJ6coDXXEpCL+q8P3SDAihbrX65VQKCQ+n0/pBYNBnZMi5jj6EdCM6DgMMELxkih61ihoaLI2Go1eAvkWEIMqF1GXy4iGqtQmX4ZTkG8BbRNxyBPUGVbMfKlHK3rXEUIbutBGYcoFuswRBoFcRfgeLZfJFZQNyPYAdHacXwEpDyjy5nlyFDb5NAPQHLgCxBAF6tQhQjgj+jMgFHlB5JCnRw55JdYHXQM6CxwxeGJ0byjTwixKOhVq/ymHqE2UABMxwxyaYC/N4avoqEGEoNchAlFFo1GtO9apQ6jDgN75IyBRQQV1KWi6txU1StNloG/OfgXESDS5QQSipasggP3P4UmSivfn56psrGcSkd/vV7pQB5w0EK0rUaytY+v1WinH43F936hNOnBAF7Kn9wE84G704IFrKwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"UT AWS Lambda\" title=\"\" src=\"/static/d3a07e298be6630d63af77e5b340123b/c5bb3/graph.png\" srcset=\"/static/d3a07e298be6630d63af77e5b340123b/04472/graph.png 170w,\n/static/d3a07e298be6630d63af77e5b340123b/9f933/graph.png 340w,\n/static/d3a07e298be6630d63af77e5b340123b/c5bb3/graph.png 680w,\n/static/d3a07e298be6630d63af77e5b340123b/5a190/graph.png 800w\" sizes=\"(max-width: 680px) 100vw, 680px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n    </span>\n          </p>\n<h2 id=\"-decorator-approach\" style=\"position:relative;\"><a href=\"#-decorator-approach\" aria-label=\" decorator approach permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üß© Decorator Approach</h2>\n<p>The decorator approach simplifies AWS service mocking using Moto in the <code class=\"language-text\">eu-west-1</code> region. The <code class=\"language-text\">@mock_ec2</code> decorator encapsulates the test function, ensuring automatic management of the Moto mock environment for seamless testing.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">import</span> boto3\n<span class=\"token keyword\">from</span> moto <span class=\"token keyword\">import</span> mock_ec2\n<span class=\"token keyword\">from</span> main <span class=\"token keyword\">import</span> create_instances\n\n<span class=\"token decorator annotation punctuation\">@mock_ec2</span>\n<span class=\"token keyword\">def</span> <span class=\"token function\">test_create_instances_with_decorator</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    instance_count <span class=\"token operator\">=</span> <span class=\"token number\">1</span>\n    image_id <span class=\"token operator\">=</span> <span class=\"token string\">'ami-02ed82f3a38303e6f'</span>\n    create_instances<span class=\"token punctuation\">(</span><span class=\"token string\">'eu-west-1'</span><span class=\"token punctuation\">,</span> image_id<span class=\"token punctuation\">,</span> instance_count<span class=\"token punctuation\">)</span>\n    client <span class=\"token operator\">=</span> boto3<span class=\"token punctuation\">.</span>client<span class=\"token punctuation\">(</span><span class=\"token string\">'ec2'</span><span class=\"token punctuation\">,</span> region_name<span class=\"token operator\">=</span><span class=\"token string\">'eu-west-1'</span><span class=\"token punctuation\">)</span>\n    instances <span class=\"token operator\">=</span> client<span class=\"token punctuation\">.</span>describe_instances<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token string\">'Reservations'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token string\">'Instances'</span><span class=\"token punctuation\">]</span>\n    <span class=\"token keyword\">assert</span> <span class=\"token builtin\">len</span><span class=\"token punctuation\">(</span>instances<span class=\"token punctuation\">)</span> <span class=\"token operator\">==</span> instance_count\n    <span class=\"token keyword\">assert</span> instances<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token string\">'ImageId'</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">==</span> image_id</code></pre></div>\n<h2 id=\"-context-manager-approach\" style=\"position:relative;\"><a href=\"#-context-manager-approach\" aria-label=\" context manager approach permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üß© Context Manager Approach</h2>\n<p>In the Ireland region, the context manager-based approach facilitates AWS service mocking with Moto. Utilizing <code class=\"language-text\">with mock_ec2():</code>, the test logic within the block benefits from the active Moto mock environment, maintaining clarity and proper resource management.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">import</span> boto3\n<span class=\"token keyword\">from</span> main <span class=\"token keyword\">import</span> create_instances\n<span class=\"token keyword\">from</span> moto <span class=\"token keyword\">import</span> mock_ec2\n\n<span class=\"token keyword\">def</span> <span class=\"token function\">test_create_instances_with_context_manager</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">with</span> mock_ec2<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        instance_count <span class=\"token operator\">=</span> <span class=\"token number\">1</span>\n        image_id <span class=\"token operator\">=</span> <span class=\"token string\">'ami-02ed82f3a38303e6f'</span>\n        create_instances<span class=\"token punctuation\">(</span><span class=\"token string\">'eu-west-1'</span><span class=\"token punctuation\">,</span> image_id<span class=\"token punctuation\">,</span> instance_count<span class=\"token punctuation\">)</span>\n        client <span class=\"token operator\">=</span> boto3<span class=\"token punctuation\">.</span>client<span class=\"token punctuation\">(</span><span class=\"token string\">'ec2'</span><span class=\"token punctuation\">,</span> region_name<span class=\"token operator\">=</span><span class=\"token string\">'eu-west-1'</span><span class=\"token punctuation\">)</span>\n        instances <span class=\"token operator\">=</span> client<span class=\"token punctuation\">.</span>describe_instances<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token string\">'Reservations'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token string\">'Instances'</span><span class=\"token punctuation\">]</span>\n        <span class=\"token keyword\">assert</span> <span class=\"token builtin\">len</span><span class=\"token punctuation\">(</span>instances<span class=\"token punctuation\">)</span> <span class=\"token operator\">==</span> instance_count\n        <span class=\"token keyword\">assert</span> instances<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token string\">'ImageId'</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">==</span> image_id</code></pre></div>\n<h2 id=\"-raw-approach\" style=\"position:relative;\"><a href=\"#-raw-approach\" aria-label=\" raw approach permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üß© Raw Approach</h2>\n<p>For explicit control over the Moto mock environment, the raw approach is demonstrated in the Ireland region. Manually starting and stopping the mock using <code class=\"language-text\">mock.start()</code> and <code class=\"language-text\">mock.stop()</code> provides flexibility, as shown in the following example.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">import</span> boto3\n<span class=\"token keyword\">from</span> main <span class=\"token keyword\">import</span> create_instances\n<span class=\"token keyword\">from</span> moto <span class=\"token keyword\">import</span> mock_ec2\n\n<span class=\"token keyword\">def</span> <span class=\"token function\">test_create_instances_raw</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    mock <span class=\"token operator\">=</span> mock_ec2<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    mock<span class=\"token punctuation\">.</span>start<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    instance_count <span class=\"token operator\">=</span> <span class=\"token number\">1</span>\n    image_id <span class=\"token operator\">=</span> <span class=\"token string\">'ami-02ed82f3a38303e6f'</span>\n    create_instances<span class=\"token punctuation\">(</span><span class=\"token string\">'eu-west-1'</span><span class=\"token punctuation\">,</span> image_id<span class=\"token punctuation\">,</span> instance_count<span class=\"token punctuation\">)</span>\n    client <span class=\"token operator\">=</span> boto3<span class=\"token punctuation\">.</span>client<span class=\"token punctuation\">(</span><span class=\"token string\">'ec2'</span><span class=\"token punctuation\">,</span> region_name<span class=\"token operator\">=</span><span class=\"token string\">'eu-west-1'</span><span class=\"token punctuation\">)</span>\n    instances <span class=\"token operator\">=</span> client<span class=\"token punctuation\">.</span>describe_instances<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token string\">'Reservations'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token string\">'Instances'</span><span class=\"token punctuation\">]</span>\n    <span class=\"token keyword\">assert</span> <span class=\"token builtin\">len</span><span class=\"token punctuation\">(</span>instances<span class=\"token punctuation\">)</span> <span class=\"token operator\">==</span> instance_count\n    <span class=\"token keyword\">assert</span> instances<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token string\">'ImageId'</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">==</span> image_id\n    mock<span class=\"token punctuation\">.</span>stop<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></code></pre></div>\n<hr>\n<h2 id=\"-local-lambda-testing\" style=\"position:relative;\"><a href=\"#-local-lambda-testing\" aria-label=\" local lambda testing permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üé© Local Lambda Testing</h2>\n<p>Moto uses decorators to intercept and simulate responses to and from AWS resources. By adding a decorator for a given AWS service, subsequent calls from the module to that service will be re-directed to the mock.</p>\n<p>In this section, we'll couple the Moto library and pytest framework to have clean and scalable unit tests. Let's test a serverless app using Pytest and Moto. Our goal? Check if a piece of code (AWS Lambda) works right. We'll focus on the Lambda function, not AWS services. We'll use Pytest for testing and Moto to pretend AWS services. This keeps tests clear and reliable.</p>\n<h3 id=\"-lambda-function-code\" style=\"position:relative;\"><a href=\"#-lambda-function-code\" aria-label=\" lambda function code permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üìÑ Lambda Function Code</h3>\n<p>This file (<code class=\"language-text\">main.py</code>) contains the main Lambda function (<code class=\"language-text\">lambda_handler</code>) that manipulates data and uploads it to an S3 bucket. It utilizes the Boto3 library to interact with AWS services.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">import</span> boto3\n\n<span class=\"token keyword\">def</span> <span class=\"token function\">lambda_handler</span><span class=\"token punctuation\">(</span>event<span class=\"token punctuation\">,</span> context<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token comment\"># Sample Lambda function that manipulates data and uploads to S3</span>\n    data_to_upload <span class=\"token operator\">=</span> <span class=\"token string\">\"Hello, Moto!\"</span>\n\n    <span class=\"token comment\"># AWS S3 Configuration</span>\n    s3_bucket <span class=\"token operator\">=</span> <span class=\"token string\">\"your-s3-bucket\"</span>\n    s3_key <span class=\"token operator\">=</span> <span class=\"token string\">\"example.txt\"</span>\n\n    <span class=\"token comment\"># Upload to S3</span>\n    s3 <span class=\"token operator\">=</span> boto3<span class=\"token punctuation\">.</span>client<span class=\"token punctuation\">(</span><span class=\"token string\">\"s3\"</span><span class=\"token punctuation\">)</span>\n    s3<span class=\"token punctuation\">.</span>put_object<span class=\"token punctuation\">(</span>Body<span class=\"token operator\">=</span>data_to_upload<span class=\"token punctuation\">,</span> Bucket<span class=\"token operator\">=</span>s3_bucket<span class=\"token punctuation\">,</span> Key<span class=\"token operator\">=</span>s3_key<span class=\"token punctuation\">)</span>\n\n    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span><span class=\"token string\">\"statusCode\"</span><span class=\"token punctuation\">:</span> <span class=\"token number\">200</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"body\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"Data uploaded to S3 successfully.\"</span><span class=\"token punctuation\">}</span></code></pre></div>\n<h3 id=\"Ô∏è-pytest-configuration\" style=\"position:relative;\"><a href=\"#%EF%B8%8F-pytest-configuration\" aria-label=\"Ô∏è pytest configuration permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üõ†Ô∏è Pytest Configuration</h3>\n<p><code class=\"language-text\">conftest.py</code> serves as a configuration file for Pytest. In this example, it defines two fixtures:</p>\n<ul>\n<li><strong>aws_credentials</strong>: A fixture to set up mocked AWS credentials using environment variables.</li>\n<li><strong>s3_mock</strong>: A fixture that uses Moto's <code class=\"language-text\">mock_s3</code> context manager to mock the S3 service. It depends on the <code class=\"language-text\">aws_credentials</code> fixture to ensure mocked credentials are available.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">import</span> pytest\n<span class=\"token keyword\">import</span> os\n<span class=\"token keyword\">from</span> moto <span class=\"token keyword\">import</span> mock_s3\n\n<span class=\"token decorator annotation punctuation\">@pytest<span class=\"token punctuation\">.</span>fixture</span><span class=\"token punctuation\">(</span>scope<span class=\"token operator\">=</span><span class=\"token string\">'function'</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">def</span> <span class=\"token function\">aws_credentials</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token comment\"># Mocked AWS Credentials for Moto</span>\n    os<span class=\"token punctuation\">.</span>environ<span class=\"token punctuation\">[</span><span class=\"token string\">'AWS_ACCESS_KEY_ID'</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token string\">'fake-access-key'</span>\n    os<span class=\"token punctuation\">.</span>environ<span class=\"token punctuation\">[</span><span class=\"token string\">'AWS_SECRET_ACCESS_KEY'</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token string\">'fake-secret-key'</span>\n    os<span class=\"token punctuation\">.</span>environ<span class=\"token punctuation\">[</span><span class=\"token string\">'AWS_SECURITY_TOKEN'</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token string\">'fake-security-token'</span>\n    os<span class=\"token punctuation\">.</span>environ<span class=\"token punctuation\">[</span><span class=\"token string\">'AWS_SESSION_TOKEN'</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token string\">'fake-session-token'</span>\n\n<span class=\"token decorator annotation punctuation\">@pytest<span class=\"token punctuation\">.</span>fixture</span><span class=\"token punctuation\">(</span>scope<span class=\"token operator\">=</span><span class=\"token string\">'function'</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">def</span> <span class=\"token function\">s3_mock</span><span class=\"token punctuation\">(</span>aws_credentials<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">with</span> mock_s3<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        <span class=\"token keyword\">yield</span> boto3<span class=\"token punctuation\">.</span>client<span class=\"token punctuation\">(</span><span class=\"token string\">'s3'</span><span class=\"token punctuation\">)</span></code></pre></div>\n<h3 id=\"-unit-test\" style=\"position:relative;\"><a href=\"#-unit-test\" aria-label=\" unit test permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üß™ Unit Test</h3>\n<p><code class=\"language-text\">test_main.py</code> is a Pytest test file that contains a single unit test (<code class=\"language-text\">test_lambda_handler</code>). This test checks if the Lambda function in <code class=\"language-text\">main.py</code> successfully uploads a file to an S3 bucket. It uses the <code class=\"language-text\">s3_mock</code> and <code class=\"language-text\">aws_credentials</code> fixtures from <code class=\"language-text\">conftest.py</code> to set up the required mocking environment.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">import</span> pytest\n<span class=\"token keyword\">import</span> boto3\n<span class=\"token keyword\">from</span> main <span class=\"token keyword\">import</span> lambda_handler\n\n<span class=\"token keyword\">def</span> <span class=\"token function\">test_lambda_handler</span><span class=\"token punctuation\">(</span>s3_mock<span class=\"token punctuation\">,</span> aws_credentials<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token comment\"># Event and Context are not used in this example</span>\n    event <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n    context <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n\n    <span class=\"token comment\"># Invoke the Lambda function</span>\n    response <span class=\"token operator\">=</span> lambda_handler<span class=\"token punctuation\">(</span>event<span class=\"token punctuation\">,</span> context<span class=\"token punctuation\">)</span>\n\n    <span class=\"token comment\"># Check if the S3 object was created successfully</span>\n    <span class=\"token keyword\">assert</span> response<span class=\"token punctuation\">[</span><span class=\"token string\">\"statusCode\"</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">==</span> <span class=\"token number\">200</span>\n\n    <span class=\"token comment\"># Check if the object exists in S3</span>\n    objects <span class=\"token operator\">=</span> s3_mock<span class=\"token punctuation\">.</span>list_objects<span class=\"token punctuation\">(</span>Bucket<span class=\"token operator\">=</span><span class=\"token string\">'your-s3-bucket'</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">assert</span> objects<span class=\"token punctuation\">[</span><span class=\"token string\">\"Contents\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token string\">\"Key\"</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">==</span> <span class=\"token string\">\"example.txt\"</span></code></pre></div>\n<h3 id=\"-running-the-unit-tests\" style=\"position:relative;\"><a href=\"#-running-the-unit-tests\" aria-label=\" running the unit tests permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üöÄ Running the Unit Tests</h3>\n<p>The unit testing framework can be run using the Python <code class=\"language-text\">pytest</code> utility. To ensure network isolation and verify the unit tests are not accidentally connecting to AWS resources, the <a href=\"https://pypi.org/project/pytest-socket/\" target=\"_blank\" rel=\"noopener noreferrer\">pytest-socket</a> project provides the ability to disable network communication during a test.</p>\n<div class=\"gatsby-highlight\" data-language=\"sh\"><pre class=\"language-sh\"><code class=\"language-sh\">pytest <span class=\"token parameter variable\">-v</span> --disable-socket <span class=\"token parameter variable\">-s</span> test_main.py</code></pre></div>\n<p>The <code class=\"language-text\">pytest</code> command results in a PASSED or FAILED status for each test. A PASSED status verifies that your unit tests, as written, did not encounter errors or issues.</p>\n<h3 id=\"-conclusion\" style=\"position:relative;\"><a href=\"#-conclusion\" aria-label=\" conclusion permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üìå Conclusion</h3>\n<p>In this guide, we explored some ways for mocking AWS responses with Moto, offering a swift and cost-free approach to testing Python code. When paired with Pytest, it delivers scalable and tidy unit tests specifically tailored for AWS interactions.</p>\n<h3 id=\"-what-next\" style=\"position:relative;\"><a href=\"#-what-next\" aria-label=\" what next permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üîç What Next?</h3>\n<p>You can keep an eye on this <a href=\"https://github.com/seifrajhi/Python-AWS-Lambda-Testing\" target=\"_blank\" rel=\"noopener noreferrer\">repository</a> as I continue to develop it and add more use cases and integrations!</p>\n<br>\n<p><strong><em>Until next time, „Å§„Å•„Åè üéâ</em></strong></p>\n<blockquote>\n<p>üí° Thank you for Reading !! üôåüèªüòÅüìÉ, see you in the next blog.ü§ò  <em><strong>Until next time üéâ</strong></em></p>\n</blockquote>\n<p>üöÄ Thank you for sticking up till the end. If you have any questions/feedback regarding this blog feel free to connect with me:</p>\n<p><strong>‚ôªÔ∏è LinkedIn:</strong> <a href=\"https://www.linkedin.com/in/rajhi-saif/\" target=\"_blank\" rel=\"noopener noreferrer\">https://www.linkedin.com/in/rajhi-saif/</a></p>\n<p><strong>‚ôªÔ∏è X/Twitter:</strong> <a href=\"https://x.com/rajhisaifeddine\" target=\"_blank\" rel=\"noopener noreferrer\">https://x.com/rajhisaifeddine</a></p>\n<p><strong>The end ‚úåüèª</strong></p>\n<h1 align=\"center\">üî∞ Keep Learning !! Keep Sharing !! üî∞</h1>\n<p><strong>üìÖ Stay updated</strong></p>\n<p>Subscribe to our newsletter for more insights on AWS cloud computing and containers.</p>","timeToRead":5,"rawMarkdownBody":"\n> **Quality Assurance and Resilience of AWS Lambda with Moto üöÅ‚ú®**\n\n## üìç Introduction\n\nWhen developing [serverless](https://www.cloudflare.com/en-gb/learning/serverless/what-is-serverless/) [event-driven](https://en.wikipedia.org/wiki/Event-driven_architecture) applications with AWS Lambda, ensuring the reliability and functionality of individual components is important.\n\n[Unit testing](https://www.techtarget.com/searchsoftwarequality/definition/unit-testing) serves as a fundamental practice to swiftly identify and isolate potential issues within [AWS Lambda function](https://aws.amazon.com/lambda/features/) code.\n\nThis blog post explores the application of unit testing techniques for Python-based AWS Lambda functions, particularly focusing on interactions with various AWS services. In this context, the [Moto](https://github.com/getmoto/moto/tree/master) library emerges as a valuable tool for simulating AWS resources, enabling the testing of Python code that interfaces with services such as [DynamoDB](https://aws.amazon.com/dynamodb/features/) and [S3](https://aws.amazon.com/s3/features/).\n\nThrough the integration of Moto with [pytest](https://github.com/pytest-dev/pytest), this post aims to provide insights into effectively testing Python-based AWS Lambda functions.\n\n![Unit Testing AWS Lambda](./ut.png)\n\n### üõ†Ô∏è What is Moto and Why Use It?\n\nWhen testing code that interacts with cloud services, it's essential to mimic the functionality of those services. However, replicating them completely locally can be challenging. This is where [Moto](https://github.com/getmoto/moto), a library that allows mocking AWS services, comes into play.\n\nMoto is particularly useful when testing Python code that interacts with AWS services like DynamoDB, S3, and others. It enables developers to simulate AWS resources, making it easier to test code that interfaces with various AWS services.\n\nBy using Moto in combination with [pytest](https://docs.pytest.org/en/6.2.x/), developers can ensure comprehensive testing of their Python code, thereby enhancing the reliability and quality of their applications.\n\nMoto has gained recognition for its ability to simplify testing in the cloud, making it a valuable tool for developers working on serverless applications. By using Moto, developers can test their code without the need to directly access real AWS resources, ultimately streamlining the testing process and contributing to the overall robustness of their applications.\n\n\n![UT AWS Lambda](./graph.png)\n\n## üß© Decorator Approach\n\nThe decorator approach simplifies AWS service mocking using Moto in the `eu-west-1` region. The `@mock_ec2` decorator encapsulates the test function, ensuring automatic management of the Moto mock environment for seamless testing.\n\n```python\nimport boto3\nfrom moto import mock_ec2\nfrom main import create_instances\n\n@mock_ec2\ndef test_create_instances_with_decorator(self):\n    instance_count = 1\n    image_id = 'ami-02ed82f3a38303e6f'\n    create_instances('eu-west-1', image_id, instance_count)\n    client = boto3.client('ec2', region_name='eu-west-1')\n    instances = client.describe_instances()['Reservations'][0]['Instances']\n    assert len(instances) == instance_count\n    assert instances[0]['ImageId'] == image_id\n```\n\n## üß© Context Manager Approach\n\nIn the Ireland region, the context manager-based approach facilitates AWS service mocking with Moto. Utilizing `with mock_ec2():`, the test logic within the block benefits from the active Moto mock environment, maintaining clarity and proper resource management.\n\n```python\nimport boto3\nfrom main import create_instances\nfrom moto import mock_ec2\n\ndef test_create_instances_with_context_manager(self):\n    with mock_ec2():\n        instance_count = 1\n        image_id = 'ami-02ed82f3a38303e6f'\n        create_instances('eu-west-1', image_id, instance_count)\n        client = boto3.client('ec2', region_name='eu-west-1')\n        instances = client.describe_instances()['Reservations'][0]['Instances']\n        assert len(instances) == instance_count\n        assert instances[0]['ImageId'] == image_id\n```\n\n## üß© Raw Approach\n\nFor explicit control over the Moto mock environment, the raw approach is demonstrated in the Ireland region. Manually starting and stopping the mock using `mock.start()` and `mock.stop()` provides flexibility, as shown in the following example.\n\n```python\nimport boto3\nfrom main import create_instances\nfrom moto import mock_ec2\n\ndef test_create_instances_raw(self):\n    mock = mock_ec2()\n    mock.start()\n    instance_count = 1\n    image_id = 'ami-02ed82f3a38303e6f'\n    create_instances('eu-west-1', image_id, instance_count)\n    client = boto3.client('ec2', region_name='eu-west-1')\n    instances = client.describe_instances()['Reservations'][0]['Instances']\n    assert len(instances) == instance_count\n    assert instances[0]['ImageId'] == image_id\n    mock.stop()\n```\n\n\n---\n\n## üé© Local Lambda Testing\n\nMoto uses decorators to intercept and simulate responses to and from AWS resources. By adding a decorator for a given AWS service, subsequent calls from the module to that service will be re-directed to the mock.\n\nIn this section, we'll couple the Moto library and pytest framework to have clean and scalable unit tests. Let's test a serverless app using Pytest and Moto. Our goal? Check if a piece of code (AWS Lambda) works right. We'll focus on the Lambda function, not AWS services. We'll use Pytest for testing and Moto to pretend AWS services. This keeps tests clear and reliable.\n\n### üìÑ Lambda Function Code\n\nThis file (`main.py`) contains the main Lambda function (`lambda_handler`) that manipulates data and uploads it to an S3 bucket. It utilizes the Boto3 library to interact with AWS services.\n\n```python\nimport boto3\n\ndef lambda_handler(event, context):\n    # Sample Lambda function that manipulates data and uploads to S3\n    data_to_upload = \"Hello, Moto!\"\n\n    # AWS S3 Configuration\n    s3_bucket = \"your-s3-bucket\"\n    s3_key = \"example.txt\"\n\n    # Upload to S3\n    s3 = boto3.client(\"s3\")\n    s3.put_object(Body=data_to_upload, Bucket=s3_bucket, Key=s3_key)\n\n    return {\"statusCode\": 200, \"body\": \"Data uploaded to S3 successfully.\"}\n```\n\n### üõ†Ô∏è Pytest Configuration\n\n`conftest.py` serves as a configuration file for Pytest. In this example, it defines two fixtures:\n\n- **aws_credentials**: A fixture to set up mocked AWS credentials using environment variables.\n- **s3_mock**: A fixture that uses Moto's `mock_s3` context manager to mock the S3 service. It depends on the `aws_credentials` fixture to ensure mocked credentials are available.\n\n```python\nimport pytest\nimport os\nfrom moto import mock_s3\n\n@pytest.fixture(scope='function')\ndef aws_credentials():\n    # Mocked AWS Credentials for Moto\n    os.environ['AWS_ACCESS_KEY_ID'] = 'fake-access-key'\n    os.environ['AWS_SECRET_ACCESS_KEY'] = 'fake-secret-key'\n    os.environ['AWS_SECURITY_TOKEN'] = 'fake-security-token'\n    os.environ['AWS_SESSION_TOKEN'] = 'fake-session-token'\n\n@pytest.fixture(scope='function')\ndef s3_mock(aws_credentials):\n    with mock_s3():\n        yield boto3.client('s3')\n```\n\n### üß™ Unit Test\n\n`test_main.py` is a Pytest test file that contains a single unit test (`test_lambda_handler`). This test checks if the Lambda function in `main.py` successfully uploads a file to an S3 bucket. It uses the `s3_mock` and `aws_credentials` fixtures from `conftest.py` to set up the required mocking environment.\n\n```python\nimport pytest\nimport boto3\nfrom main import lambda_handler\n\ndef test_lambda_handler(s3_mock, aws_credentials):\n    # Event and Context are not used in this example\n    event = {}\n    context = {}\n\n    # Invoke the Lambda function\n    response = lambda_handler(event, context)\n\n    # Check if the S3 object was created successfully\n    assert response[\"statusCode\"] == 200\n\n    # Check if the object exists in S3\n    objects = s3_mock.list_objects(Bucket='your-s3-bucket')\n    assert objects[\"Contents\"][0][\"Key\"] == \"example.txt\"\n```\n\n### üöÄ Running the Unit Tests\n\nThe unit testing framework can be run using the Python `pytest` utility. To ensure network isolation and verify the unit tests are not accidentally connecting to AWS resources, the [pytest-socket](https://pypi.org/project/pytest-socket/) project provides the ability to disable network communication during a test.\n\n```sh\npytest -v --disable-socket -s test_main.py\n```\n\nThe `pytest` command results in a PASSED or FAILED status for each test. A PASSED status verifies that your unit tests, as written, did not encounter errors or issues.\n\n### üìå Conclusion\n\nIn this guide, we explored some ways for mocking AWS responses with Moto, offering a swift and cost-free approach to testing Python code. When paired with Pytest, it delivers scalable and tidy unit tests specifically tailored for AWS interactions.\n\n### üîç What Next?\n\nYou can keep an eye on this [repository](https://github.com/seifrajhi/Python-AWS-Lambda-Testing) as I continue to develop it and add more use cases and integrations!\n\n<br>\n\n**_Until next time, „Å§„Å•„Åè üéâ_**\n\n> üí° Thank you for Reading !! üôåüèªüòÅüìÉ, see you in the next blog.ü§ò  _**Until next time üéâ**_\n\nüöÄ Thank you for sticking up till the end. If you have any questions/feedback regarding this blog feel free to connect with me:\n\n**‚ôªÔ∏è LinkedIn:** https://www.linkedin.com/in/rajhi-saif/\n\n**‚ôªÔ∏è X/Twitter:** https://x.com/rajhisaifeddine\n\n**The end ‚úåüèª**\n\n<h1 align=\"center\">üî∞ Keep Learning !! Keep Sharing !! üî∞</h1>\n\n**üìÖ Stay updated**\n\nSubscribe to our newsletter for more insights on AWS cloud computing and containers.\n","wordCount":{"words":827},"frontmatter":{"id":"d837800e43e69bcae9a1a4be","path":"/blog/unit-testing-aws-lambda-moto/","humanDate":"Oct 20, 2024","fullDate":"2024-10-20","title":"Unit Testing AWS Lambda with Python and Mock AWS Services Using Moto üìà","keywords":["AWS Lambda","Unit testing","Python","Moto","Mock AWS services"],"excerpt":"Ensure the quality and resilience of your AWS Lambda functions with Python and Moto for effective unit testing.","cover":{"childImageSharp":{"gatsbyImageData":{"layout":"fullWidth","placeholder":{"fallback":"data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAALABQDASIAAhEBAxEB/8QAFwAAAwEAAAAAAAAAAAAAAAAAAAMFAv/EABYBAQEBAAAAAAAAAAAAAAAAAAMBAv/aAAwDAQACEAMQAAABduRXJnDiZ//EABoQAQEAAgMAAAAAAAAAAAAAAAECAAMREiH/2gAIAQEAAQUC7eTthBeKpzRTRn//xAAXEQEAAwAAAAAAAAAAAAAAAAAAAQIR/9oACAEDAQE/AZqx/8QAFxEBAQEBAAAAAAAAAAAAAAAAAQASE//aAAgBAgEBPwHaXVv/xAAbEAABBAMAAAAAAAAAAAAAAAAhAAIQEhExQf/aAAgBAQAGPwLLgha0b6jH/8QAGxAAAwEAAwEAAAAAAAAAAAAAAAEhETFRYbH/2gAIAQEAAT8hnSigqxRNOjVfBPPTmihLnRiP/9oADAMBAAIAAwAAABBg3//EABYRAQEBAAAAAAAAAAAAAAAAAAABEf/aAAgBAwEBPxCFZf/EABcRAQADAAAAAAAAAAAAAAAAAAARIWH/2gAIAQIBAT8Qg2wf/8QAHhABAAICAQUAAAAAAAAAAAAAAQARMUEhYXGBkbH/2gAIAQEAAT8QfENyX2MxksIIW+lQwlHZaWyzRGj3F1I2sJ8JRon/2Q=="},"images":{"fallback":{"src":"/static/ac13cde9802f6a6d3725e9cf50043479/0e3c8/ut-moto-lambda-cover.jpg","srcSet":"/static/ac13cde9802f6a6d3725e9cf50043479/53d53/ut-moto-lambda-cover.jpg 750w,\n/static/ac13cde9802f6a6d3725e9cf50043479/0e3c8/ut-moto-lambda-cover.jpg 800w","sizes":"100vw"},"sources":[{"srcSet":"/static/ac13cde9802f6a6d3725e9cf50043479/ee3fa/ut-moto-lambda-cover.webp 750w,\n/static/ac13cde9802f6a6d3725e9cf50043479/8e613/ut-moto-lambda-cover.webp 800w","type":"image/webp","sizes":"100vw"}]},"width":1,"height":0.5525}}},"coverCredits":"Photo by Saifeddine Rajhi"}}},"pageContext":{"prevThought":{"frontmatter":{"path":"/blog/spot-idle-aws-resources/","title":"Uncover hidden AWS costs with unusd.cloud: save money and reduce risk","date":"2024-10-20 18:06:00"},"excerpt":"Discover hidden costs: Spot idle AWS resources üí∏ üí¨ Introduction AWS is a powerful tool that can help businesses of all sizes save money‚Ä¶","html":"<blockquote>\n<p><strong>Discover hidden costs: Spot idle AWS resources üí∏</strong></p>\n</blockquote>\n<h2 id=\"-introduction\" style=\"position:relative;\"><a href=\"#-introduction\" aria-label=\" introduction permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üí¨ Introduction</h2>\n<p>AWS is a powerful tool that can help businesses of all sizes save money and scale efficiently. However, it's important to be aware of the potential for hidden costs. If you're not careful, you can easily overspend on unused resources, inefficient configurations, and unexpected data transfer fees.</p>\n<p>That's where <a href=\"https://unusd.cloud/\" target=\"_blank\" rel=\"noopener noreferrer\">unusd.cloud</a> comes in. Unusd.cloud is a cloud cost management platform that helps you identify and eliminate hidden AWS costs. With unusd.cloud, you can:</p>\n<ul>\n<li>Get a clear view of your AWS spending</li>\n<li>Identify and terminate unused resources</li>\n<li>Optimize your resource configurations</li>\n<li>Set up alerts to notify you of potential cost overruns</li>\n</ul>\n<p>In this blog post, we'll show you how to use unusd.cloud to uncover hidden AWS costs and save money. We'll also run the numbers on real-world scenarios to show you exactly how much you could be overspending.</p>\n<p><span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 200px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 65.29411764705883%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAAsTAAALEwEAmpwYAAACjUlEQVR42pVSbU/TUBTu2NaWFnSIUSEmBEMcjq1d6Xo7eTEZsGUkOogLiUFUGGwZA5YhDIQIzYIIQjQIkQiJf8Ov/hX9pjChXVu6aEK9BUb2AVFOcnKee16enJeLIGeIjiAmwx6O1WHyIuXU1lzt2jrVlt9y1utbrLUQ/y8pJEsjXKWaocLa64aAtkq1ae9Zn7Lp6oSk3fobezlyEdEFpGR/kgnnppl7itAQUJYoRnnnatTWnH7tA+1TPzIPLtSdmGDq1BTbtZ/m2tVZGshzrnZlgQoerNDN8lvWl9+kwuoGU11c89fODPsrDrzKuDeYSzYKUpoJyTPO67qOlMhL7g5l2SnkN1wh/ZPbUVxzLmFuCLTmomBGHQM3pTQfkia5/oNpuk8S3E17q0yNukIt5tfZeiNXOJfwpP2DxN0aJQbSBv6d9oWk+Y4BOe3ezmf4pOHLL9EvRcFx5Z8jF3cpDXD3pQh4JcabR8RUS0weZ5O5KXYK7jSjzdG+s8YtkJtO1AiaDSwcY9P3Z2z33iA3nI/xD3MjnnBu3J2Qp9z+o+IexGwQwt2ajmwReYGwWE7f+ucgthW4Xf811lp1VBxjCX2CIk/j+nEu9FvF4ZYKA9+xWq2NGIb5rVa8l7TZKJvNRmMYESwvLeXNZiwIG4596XGU7faDtmyED8OjdWUjILADjyfFm+xi1MNlh8BTaB8Zk/aazeZliwVLWCxoCsfJCYIom0NR/AVUgcDxeZiTzPC1fnmIf/4z6umEZMKPQTC6D3esxr0pOQoWdiLeWTHCG4QIvBYK/9RlG8QVBEFUoShqJ0nyGoIQN3Acr4H+W1CvaqOg9luEqT58DC7tRjx2vY8iswPAYYxqvKUnXOUf8J31X0C19M4AAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"logo\" title=\"\" src=\"/static/85483c175c66bf11d7627f00dcabe0b2/772e8/logo.png\" srcset=\"/static/85483c175c66bf11d7627f00dcabe0b2/04472/logo.png 170w,\n/static/85483c175c66bf11d7627f00dcabe0b2/772e8/logo.png 200w\" sizes=\"(max-width: 200px) 100vw, 200px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n    </span>\n          </p>\n<h3 id=\"-rationale\" style=\"position:relative;\"><a href=\"#-rationale\" aria-label=\" rationale permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üß† Rationale</h3>\n<p>One of the main advantages of cloud computing is the ability to experiment. Whether you're learning new skills, testing new ideas, or working on proofs of concept, you can easily spin up new resources on AWS and get started.</p>\n<p>However, it's important to be mindful of your costs. AWS uses a consumption-based pricing model, so you're billed for every resource that you use. This means that it's easy to forget to turn off resources, especially if you're working on multiple projects or if you're new to AWS.</p>\n<h3 id=\"-whats-the-problem\" style=\"position:relative;\"><a href=\"#-whats-the-problem\" aria-label=\" whats the problem permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üí£ What's the Problem?</h3>\n<p>AWS doesn't have any built-in billing alerts by default, so you're responsible for manually checking your bill to make sure that there aren't any unexpected charges. This can be challenging, especially if you have resources running in multiple regions.</p>\n<h3 id=\"-lets-dive-into-the-main-culprits\" style=\"position:relative;\"><a href=\"#-lets-dive-into-the-main-culprits\" aria-label=\" lets dive into the main culprits permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üîç Let's Dive into the Main Culprits</h3>\n<p>Here are some of the most common AWS services that can lead to wasted resources:</p>\n<ul>\n<li><strong>EC2 Instances</strong>: If you forget to terminate EC2 instances that you're no longer using, you'll continue to be billed for them.</li>\n<li><strong>EBS Volumes</strong>: If you have EBS volumes that are attached to EC2 instances that you've terminated, you'll continue to be billed for them.</li>\n<li><strong>S3 Buckets</strong>: If you have S3 buckets that are storing data that you no longer need, you'll continue to be billed for the storage and bandwidth costs.</li>\n<li><strong>RDS Databases</strong>: If you have RDS databases that are running when you're not using them, you'll continue to be billed for them.</li>\n<li><strong>Lambda Functions</strong>: If you have Lambda functions that are triggered by events that no longer occur, you'll continue to be billed for them.</li>\n</ul>\n<h3 id=\"-how-to-save-money\" style=\"position:relative;\"><a href=\"#-how-to-save-money\" aria-label=\" how to save money permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üí∞ How to Save Money</h3>\n<p>The best way to save money on AWS is to be mindful of your resource usage and to turn off resources that you're not using. You can also use <a href=\"https://aws.amazon.com/aws-cost-management/aws-cost-explorer/\" target=\"_blank\" rel=\"noopener noreferrer\">AWS Cost Explorer</a> to identify and eliminate wasted resources.</p>\n<p>Here are some tips:</p>\n<ul>\n<li>Set up billing alerts to notify you when your costs exceed a certain threshold.</li>\n<li>Review your AWS Cost Explorer reports regularly to identify wasted resources.</li>\n<li>Use <a href=\"https://aws.amazon.com/premiumsupport/technology/trusted-advisor/\" target=\"_blank\" rel=\"noopener noreferrer\">AWS Trusted Advisor</a> to get recommendations on how to optimize your AWS costs.</li>\n<li>Use <a href=\"https://aws.amazon.com/ec2/pricing/reserved-instances/\" target=\"_blank\" rel=\"noopener noreferrer\">Reserved Instances</a> and <a href=\"https://aws.amazon.com/savingsplans/\" target=\"_blank\" rel=\"noopener noreferrer\">Savings Plans</a> to save money on EC2 instances and RDS databases.</li>\n</ul>\n<h3 id=\"Ô∏è-reduce-attack-surface\" style=\"position:relative;\"><a href=\"#%EF%B8%8F-reduce-attack-surface\" aria-label=\"Ô∏è reduce attack surface permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üõ°Ô∏è Reduce Attack Surface</h3>\n<p>In addition to saving money, reducing wasted resources can also help to improve your security posture. When you have fewer resources running, there are fewer potential targets for attackers.</p>\n<p>Here are some tips:</p>\n<ul>\n<li>Delete S3 buckets that are storing sensitive data that you no longer need.</li>\n<li>Terminate EC2 instances that are not in use.</li>\n<li>Disable Lambda functions that are no longer needed.</li>\n<li>Remove unnecessary permissions from your IAM users and roles.</li>\n</ul>\n<h3 id=\"-lower-carbon-footprint\" style=\"position:relative;\"><a href=\"#-lower-carbon-footprint\" aria-label=\" lower carbon footprint permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üå≥ Lower Carbon Footprint</h3>\n<p>AWS is committed to reducing its environmental impact. By eliminating wasted resources, you can help to reduce the carbon footprint of your cloud applications.</p>\n<h3 id=\"-lets-dive-into-the-main-culprits-aws-services\" style=\"position:relative;\"><a href=\"#-lets-dive-into-the-main-culprits-aws-services\" aria-label=\" lets dive into the main culprits aws services permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üîç Let's Dive into the Main Culprits: AWS Services</h3>\n<h4 id=\"Ô∏è-ec2-instances\" style=\"position:relative;\"><a href=\"#%EF%B8%8F-ec2-instances\" aria-label=\"Ô∏è ec2 instances permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üñ•Ô∏è EC2 Instances</h4>\n<ul>\n<li>Use CloudWatch (CW) metrics to find unused AWS instances, such as <code class=\"language-text\">CPUUtilization</code>, <code class=\"language-text\">NetworkPacketsIn</code>, and <code class=\"language-text\">NetworkPacketsOut</code>. If CPU Utilization is barely low AND there is no traffic in/out during a specific period, we can assume this EC2 instance is no longer used.</li>\n<li>Use Composite Alarm to monitor multiple CW metrics.</li>\n<li>Review each instance in EC2 Console manually and check the Monitoring tab in the last two weeks.</li>\n<li>Paid options on AWS: Trusted Advisor (Cost Optimizations section, Business or Enterprise Support Plan required‚Ää-‚Ääat least $100/month) and AWS Compute Optimizer (See Pricing).</li>\n</ul>\n<h4 id=\"-rds-instances\" style=\"position:relative;\"><a href=\"#-rds-instances\" aria-label=\" rds instances permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üíΩ RDS Instances</h4>\n<ul>\n<li>Check CloudWatch Metrics to see active connection to RDS Database.</li>\n<li>A database without connection for a week is a good suspect for no longer being used.</li>\n<li>Set up a CloudWatch alarm to observe this behavior with an alarm on a 0 threshold on this metric for one week.</li>\n</ul>\n<h4 id=\"-ebs-volumes\" style=\"position:relative;\"><a href=\"#-ebs-volumes\" aria-label=\" ebs volumes permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>ü™£ EBS Volumes</h4>\n<p>Identify \"available\" EBS volumes for a given AWS Region with the following command:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">aws ec2 describe-volumes <span class=\"token parameter variable\">--query</span> <span class=\"token string\">\"Volumes[?State=='available'].[VolumeId,Size]\"</span> <span class=\"token parameter variable\">--output</span> table</code></pre></div>\n<h4 id=\"-ebs-snapshots\" style=\"position:relative;\"><a href=\"#-ebs-snapshots\" aria-label=\" ebs snapshots permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üì∏ EBS Snapshots</h4>\n<p>Identify obsolete snapshots older than 90 days with the following bash script:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token shebang important\">#!/bin/bash</span>\n<span class=\"token assign-left variable\">region</span><span class=\"token operator\">=</span><span class=\"token variable\">$1</span>\naws ec2 describe-snapshots <span class=\"token parameter variable\">--region</span> <span class=\"token variable\">$region</span> <span class=\"token parameter variable\">--query</span> <span class=\"token string\">\"Snapshots[?StartTime&lt;=(timestamp('2023-10-16T16:25:00Z') - 259200000)]\"</span> <span class=\"token parameter variable\">--output</span> json <span class=\"token operator\">|</span> jq <span class=\"token parameter variable\">-r</span> <span class=\"token string\">'.Snapshots[] | {VolumeId: .VolumeId, SnapshotId: .SnapshotId, StartTime: .StartTime}'</span></code></pre></div>\n<h4 id=\"-cloudwatch-loggroups\" style=\"position:relative;\"><a href=\"#-cloudwatch-loggroups\" aria-label=\" cloudwatch loggroups permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üìí CloudWatch LogGroups</h4>\n<p>Identify CloudWatch LogGroup without expiration with the following AWS CLI command:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">aws logs describe-log-groups <span class=\"token parameter variable\">--query</span> <span class=\"token string\">\"sort_by(logGroups[?retentionInDays == null], &amp;storedBytes) | reverse(@) | [].[logGroupName, storedBytes]\"</span> <span class=\"token parameter variable\">--output</span> table</code></pre></div>\n<h4 id=\"Ô∏è-iam-principals\" style=\"position:relative;\"><a href=\"#%EF%B8%8F-iam-principals\" aria-label=\"Ô∏è iam principals permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üë∑üèª‚Äç‚ôÄÔ∏è IAM Principals</h4>\n<p>Use credential reports to extract the last usage of IAM principals. This is a flat file containing all AWS users with metadata about the IAM creds.</p>\n<h3 id=\"automate-waste-detection-on-aws-with-unusdcloud\" style=\"position:relative;\"><a href=\"#automate-waste-detection-on-aws-with-unusdcloud\" aria-label=\"automate waste detection on aws with unusdcloud permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Automate Waste Detection on AWS with unusd.cloud</h3>\n<p>You can automate waste detection on AWS with <a href=\"https://unusd.cloud/\" target=\"_blank\" rel=\"noopener noreferrer\">unusd.cloud</a>. It's a SaaS platform that scans all your AWS accounts and regions for unused or underutilized resources, including both common and specialized services.</p>\n<p>To use unusd.cloud, simply onboard your AWS accounts and schedule regular scans. The platform will then do the heavy lifting for you, sifting through CloudWatch metrics and setting up alerts. You'll receive a digest report through your chosen communication channel, so you can easily identify and address any wasted resources.</p>\n<p>Here are the benefits of using unusd.cloud to automate waste detection on AWS:</p>\n<ul>\n<li><strong>Save time and effort</strong>: unusd.cloud takes care of the complex task of waste detection for you, so you can focus on other things.</li>\n<li><strong>Get a comprehensive view of your AWS resource usage</strong>: unusd.cloud scans all your AWS accounts and regions, giving you a complete picture of your resource usage.</li>\n<li><strong>Identify and address wasted resources quickly and easily</strong>: unusd.cloud provides you with a clear and concise report of all your wasted resources, so you can take action to address them immediately.</li>\n<li><strong>Improve your security posture</strong>: by eliminating wasted resources, you can reduce your attack surface and improve your overall security posture.</li>\n<li><strong>Save money</strong>: by eliminating wasted resources, you can reduce your AWS costs.</li>\n</ul>\n<p>If you're looking for a way to automate waste detection on AWS, unusd.cloud is a great solution. It's easy to use and provides you with all the tools you need to identify and address wasted resources quickly and easily.</p>\n<h2 id=\"-getting-started-with-unusdcloud\" style=\"position:relative;\"><a href=\"#-getting-started-with-unusdcloud\" aria-label=\" getting started with unusdcloud permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üöÄ Getting Started with unusd.cloud</h2>\n<p>This article will guide you through the setup of unusd.cloud.</p>\n<h3 id=\"-step-1-sign-up\" style=\"position:relative;\"><a href=\"#-step-1-sign-up\" aria-label=\" step 1 sign up permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üìù Step 1: Sign-up</h3>\n<ul>\n<li>Sign-up on <a href=\"https://unusd.cloud\" target=\"_blank\" rel=\"noopener noreferrer\">unusd.cloud</a> to set up your AWS Accounts and preferred configuration.</li>\n<li>Free forever for a single AWS Account</li>\n<li>No credit card required</li>\n<li>Cancel anytime</li>\n<li>ReadOnly permissions</li>\n</ul>\n<h3 id=\"-step-2-add-aws-accounts\" style=\"position:relative;\"><a href=\"#-step-2-add-aws-accounts\" aria-label=\" step 2 add aws accounts permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>‚ûï Step 2: Add AWS Accounts</h3>\n<ol>\n<li>Login to the <a href=\"https://app.unusd.cloud\" target=\"_blank\" rel=\"noopener noreferrer\">unusd.cloud app</a>.</li>\n<li>Add each of your AWS Accounts and desired notification configuration (Email, Slack, Microsoft Teams).</li>\n</ol>\n<p><span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 436px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 151.76470588235296%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAeCAYAAAAsEj5rAAAACXBIWXMAAAsTAAALEwEAmpwYAAADa0lEQVR42q1WTW/cVBQddcEP6LZ/ggUrpP4I1N9SITawRaq6ahMqIRFYgBAsqUaO2koUsUAIQWCaNPMZz3gcz9gef388+z3ncK8nSSdxyEwinnTmvbGej8+799xrt6RIHxTx4pcy9dsitDWVxYRIU4JmkWoA1uLk5KQtpXxN649aVWhtI52isA5laXagHJ0wRGn3ISMHmwwiVDxXVbXVomnr9LogqMvgzetA+4pTjidEiG2+13VmMooShGGEkGbH9eD7IT99Y4U0WCG+qJTAeHwkTdPC1DzG3DLhuTYRBnyMmvQ60J6LhCyi3x9IwzCgjw1YE4pf6kJVdJaiIJTXIs/FRUJeGYYph0Mduj4Bz7OZgyiKNwKFpklIT5FCCAhRQOR5/eSylBuB7rkUQzqzro+lMZ1iODpCOB9QpCXFpo7PWihVNRV2Ovtyf/8Ag8EQ5tSEScnhpCRJijhO/hPsivncbhIuFp70PI9iEtUkHJs0zTgU1yPLESdpk5CGxC1Hw4cUBLiGIa25DcuaUYbtc1Pfyoe8crxQknRklOGcUJblqoKbEe70Czx8OZFRXuL42KpVMsbjSf2fOsnNjhzQz59WIiXZhJWxB5mEq4TndfXcjCGNJAplQDYJwxBpktTZZkv4QYg4cCll6dntmxHqE0N23uzj8LCHwXCEbreHEZl8dDSGNdWRxw5yUdbxXbVNlnFVrVQKBbQm9Dy/NjYT8vz2bbfONt+UpoJMnF1p7NqvWdZUSLGSXGocrmX2cG4bjuMSqoGyVOQ61SQMwlimac5lBNddwLYdUjiH47hcq+f22TgpcZJJ7hx8jCzL6Jhn5ZfeLst+ENXGdhyHVC6VsVpWyphSw6CeWSdhI0Luh6wwo4bAzYGzeab0bM3X34VrDeH/2xxoWKYp5zMLC9eBEhFOqpI2VlcSKHKDXEF5qcFu8yojVwh+KVVX1cLNFG4hGSH6Y0cknR9UtPe9Cvd+VP7vOyo3/16+7KmbnL/UCe2ep775x1HfvVniq7/mRbBU8XSp8NfPYHzckvaju7CfvI/Fl/dhfvoegt1Pls+lE62q/uDrLu48PsC9Zz18+O0Qrc/31KvZO4UPCnfwOj74qZ12d7W4+0KLey+06OC5VrjD0w+i6sLH0W/TSGsPfG33FO2+317k8mf+WPoXw+rr7t5scuUAAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"signup\" title=\"\" src=\"/static/b9f4f599d844f7400018aa74ce796aac/8574c/signup.png\" srcset=\"/static/b9f4f599d844f7400018aa74ce796aac/04472/signup.png 170w,\n/static/b9f4f599d844f7400018aa74ce796aac/9f933/signup.png 340w,\n/static/b9f4f599d844f7400018aa74ce796aac/8574c/signup.png 436w\" sizes=\"(max-width: 436px) 100vw, 436px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n    </span>\n          </p>\n<ol start=\"3\">\n<li>Deploy the associated read-only IAM Role using the provided link to the CloudFormation console:</li>\n</ol>\n<p><span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 400px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 80.58823529411765%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAYAAAAWGF8bAAAACXBIWXMAAAsTAAALEwEAmpwYAAACMElEQVR42pVTS2/TQBDu34Ir/wJOSOXCsQIhIXFDQuIKXJAQ4q+gnoADj5YqShM7ib2214/Esb1+rj9mJ3Vp0kBhpU8znvV889iZg6JQaNoOne630fdotUbTtP8Mw3WgygZoJGp5glw4UKELJR3SbVSJxP8cpYiwUDURxmhXE1RxiGYVoV5KVKFAncZ/JeipCoPh5HmBg7IskRcVhB/BlxEcEcBxfXhBBOEFsK055vMFwUEQSLiuYHh0Z+zGtkNYIcsyzGZz2PYcJoDuqKdti5bRseyMrdPQ1NeN3rGu9Z4MlSoRxzEhwWqVMpbL1aWeZTnLNE0hZYj1OqP7FEmyZJ+h7K0MbXsGxxGM0WiM6dSCZc1wfj5l29nZiMueTm2MxxO2DQG3CKuqoog5OdpcsvnRsmySLrVhgcnE4kxMVnmec7Yme+O3e5hQqQpdk0P6psEhl2RIoyimxvsQwqdS10RQM3Zf+Nor89joBImcIJAxojBiopCk70vukQkihMdB9hHtfRTjMIyFs3Dhex7JBUtBtjn12KZWVDS8NAZ75/IiQ0XRNI1GQyvYoq5rWqMGJv4ATTAUXb/5/tPZENL+XWkMi4o25durQ3x/c4jT909x8u4JTgk/PzzDj7dH+Pr6IdqyGJyuE172RWu+KIIFPh7dxvGjW/jy8gHj0/N7+PziPsm7OH58B02ebujIZ/C/ICxuWPl+G/0NJZvBTJKEX3AbEUvzyhv81oe7qzAchusXOxTBneMFDAcAAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"permission\" title=\"\" src=\"/static/e6d30b64b41ac7646fdccbdfff034e75/e17e5/permission.png\" srcset=\"/static/e6d30b64b41ac7646fdccbdfff034e75/04472/permission.png 170w,\n/static/e6d30b64b41ac7646fdccbdfff034e75/9f933/permission.png 340w,\n/static/e6d30b64b41ac7646fdccbdfff034e75/e17e5/permission.png 400w\" sizes=\"(max-width: 400px) 100vw, 400px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n    </span>\n          </p>\n<ol start=\"4\">\n<li>Repeat this operation for every AWS account that you want to attach to your unusd.cloud subscription.</li>\n<li>If you have multiple AWS Accounts, prefer the usage of <a href=\"https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/what-is-cfnstacksets.html\" target=\"_blank\" rel=\"noopener noreferrer\">AWS CloudFormation StackSets</a>. It will allow you to deploy the IAM Role to all your AWS Accounts with a single deployment.</li>\n</ol>\n<h3 id=\"-optional-step-3-add-exception-tag-to-legitimate-aws-assets\" style=\"position:relative;\"><a href=\"#-optional-step-3-add-exception-tag-to-legitimate-aws-assets\" aria-label=\" optional step 3 add exception tag to legitimate aws assets permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>‚úÖ [Optional] Step 3: Add Exception Tag to Legitimate AWS Assets</h3>\n<p>To prevent alert fatigue and irrelevant reports, it may be necessary to add legitimate assets to the exception list. Typically, this can be accomplished by setting a tag on existing legitimate AWS assets.</p>\n<ul>\n<li>Utilize an existing AWS tag that has already been deployed to your legitimate assets.</li>\n<li>The Key of this tag is part of the unusd configuration (Exception Tag) in the advanced menu. The default tag key is <code class=\"language-text\">unusd</code>.</li>\n</ul>\n<h3 id=\"Ô∏è-conclusion\" style=\"position:relative;\"><a href=\"#%EF%B8%8F-conclusion\" aria-label=\"Ô∏è conclusion permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>‚úèÔ∏è Conclusion</h3>\n<p>unusd.cloud is your cost-saving ally in the AWS environment. It scans your AWS accounts, identifies mistakenly active assets, and delivers a summary report filled with cost-saving recommendations.</p>\n<p>What's more, it's not limited to just one AWS service; it supports a range of services, from EC2 instances to Redshift clusters and more. By using unusd.cloud, you're making a smart move toward cost-efficiency and sustainability, freeing up resources for business growth and innovation.</p>\n<p>In a tech-driven world, having the right tool can make all the difference, and unusd.cloud makes optimizing your cloud resources a breeze.</p>\n<br>\n<p><strong><em>Until next time, „Å§„Å•„Åè üéâ</em></strong></p>\n<blockquote>\n<p>üí° Thank you for Reading !! üôåüèªüòÅüìÉ, see you in the next blog.ü§ò  <strong><em>Until next time üéâ</em></strong></p>\n</blockquote>\n<p>üöÄ Thank you for sticking up till the end. If you have any questions/feedback regarding this blog feel free to connect with me:</p>\n<p><strong>‚ôªÔ∏è LinkedIn:</strong> <a href=\"https://www.linkedin.com/in/rajhi-saif/\" target=\"_blank\" rel=\"noopener noreferrer\">https://www.linkedin.com/in/rajhi-saif/</a></p>\n<p><strong>‚ôªÔ∏è X/Twitter:</strong> <a href=\"https://x.com/rajhisaifeddine\" target=\"_blank\" rel=\"noopener noreferrer\">https://x.com/rajhisaifeddine</a></p>\n<p><strong>The end ‚úåüèª</strong></p>\n<h1 align=\"center\">üî∞ Keep Learning !! Keep Sharing !! üî∞</h1>\n<p><strong>üìÖ Stay updated</strong></p>\n<p>Subscribe to our newsletter for more insights on AWS cloud computing and containers.</p>"},"nextThought":{"frontmatter":{"path":"/blog/aws-eks-workshop-intro/","title":"Hands-on Labs for Amazon EKS: a great intro to learning Amazon EKS","date":"2024-10-19 21:44:00"},"excerpt":"Fun with AWS: Learn AWS EKS Step-by-Step üí¨ üìò Introduction Hey there! Ready to learn EKS? We're diving into the world of Amazon Web‚Ä¶","html":"<blockquote>\n<p><strong>Fun with AWS: Learn AWS EKS Step-by-Step üí¨</strong></p>\n</blockquote>\n<h2 id=\"-introduction\" style=\"position:relative;\"><a href=\"#-introduction\" aria-label=\" introduction permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üìò Introduction</h2>\n<p>Hey there! Ready to learn EKS? We're diving into the world of Amazon Web Services (AWS) Elastic Kubernetes Service (EKS) with a super cool workshop called <a href=\"https://github.com/aws-samples/eks-workshop-v2\" target=\"_blank\" rel=\"noopener noreferrer\">EKS Workshop</a>. In this blog, we're going to explore this workshop together. We'll learn how to set up a special place in the cloud called a cluster, play with containers, and do some cool tricks with AWS services. The workshop is designed to be easy to follow, and you can choose which parts you want to do. You'll get to practice using Amazon EKS and other AWS tools, like an EKS cluster, to see how they work together. By the end of this blog post, you'll have a good understanding of Amazon EKS and how to use it to manage your applications on AWS.</p>\n<p><span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 495px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 37.64705882352941%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsTAAALEwEAmpwYAAAB10lEQVR42j1R30/TUBS+bbeMVTZaChR0bpC1o6UMt86ucz8KG7gJU2Yw4QFI9Akj8UkMiYnRF6KJDxrRkBAM+mD8Nz/PvQ08fDnn3HvOd853DmOpGbCUCaZMgEkqmJwhS0joZNOEcUI2frux1z4hacT1gocgjVEg64g2Rnj5+i2e7Bxg/8UR7gVdHB4dY/h0D8t+hP5wF0FrgN5gB41oC0uVNsr+KjTTpuYGBA8nVNRZYtWw//wVzi9+4/jkI04/f8Xqw5GIP335jm9nF3j3/hQ/zn/h7Ocl3px8wNWff7i8+ouwswnGMlDUuZiQKXo8ujwhpMgJ7msilhSVkCVoYh1SUief8tgtJMdmoBnzsXxem5iMCfnozkoT7koLi+UHsL0GnHIT1lIoJBXsGuZLNbGCvFUVuQ7lFixf5NleKGqmcy7tcwosV6yg3h7Ab2ygEvQEMfd5o7D9CJZbh+UEqLf6KLoB5XThh+so0ptX7SBo9mm3fcwVymKXQrLER2YqbOc+tkZ7aK0NUQ3W0Iw20aUjcLLe4BlqRNTpPhak0fp2LJmNx/XXkvl1ZIJEQVrLw7zrwbjtIGMsYIrs9B0XOl3SzHt0UQuTsyWKS+Ivlc0JEjlt3lz5P4pL6yBYZwjUAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"Workshop Image\" title=\"\" src=\"/static/833da211fe2f806db7117c68055e31f2/a4d88/workshop.png\" srcset=\"/static/833da211fe2f806db7117c68055e31f2/04472/workshop.png 170w,\n/static/833da211fe2f806db7117c68055e31f2/9f933/workshop.png 340w,\n/static/833da211fe2f806db7117c68055e31f2/a4d88/workshop.png 495w\" sizes=\"(max-width: 495px) 100vw, 495px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n    </span>\n          </p>\n<h3 id=\"-amazon-eks-workshop\" style=\"position:relative;\"><a href=\"#-amazon-eks-workshop\" aria-label=\" amazon eks workshop permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üèó Amazon EKS Workshop</h3>\n<p>The Amazon EKS Workshop is built to help users learn about Amazon EKS features and integrations with popular open-source projects. The workshop is abstracted into high-level learning modules, including Networking, Security, Cost Optimization, DevOps Automation, and more. These are further broken down into standalone labs focusing on a particular feature, tool, or use case. For example, you can find a lab for <a href=\"https://karpenter.sh/\" target=\"_blank\" rel=\"noopener noreferrer\">Karpenter</a>, an open-source cluster autoscaler, in the Cost Optimization module. To ensure a consistent and predictable learning experience, the Amazon EKS Workshop closely adheres to the following tenets:</p>\n<h4 id=\"principles\" style=\"position:relative;\"><a href=\"#principles\" aria-label=\"principles permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Principles</h4>\n<ul>\n<li><strong>Modular</strong>: The workshop is made up of standalone modules that can be individually completed, allowing you to start at any module and easily switch between them.</li>\n<li><strong>Consistent sample app</strong>: The workshop uses the same sample retail store application across all modules: AWS Containers Retail Sample.</li>\n<li><strong>Amazon EKS-focused</strong>: Although the workshop covers some Kubernetes basics, it primarily focuses on familiarizing the user with concepts directly related to Amazon EKS.</li>\n<li><strong>Continuously tested</strong>: We automatically test the infrastructure provisioning and CLI steps in the workshop, allowing us to keep the workshop updated and tracking the latest versions of Amazon EKS.</li>\n</ul>\n<h3 id=\"-how-to-get-started-with-the-workshop\" style=\"position:relative;\"><a href=\"#-how-to-get-started-with-the-workshop\" aria-label=\" how to get started with the workshop permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üöÄ How to Get Started with the Workshop</h3>\n<p>We designed the workshop for users with a basic understanding of containers and Kubernetes. As a primer to this workshop, users can learn the basics about containers, Kubernetes, and Amazon EKS with the <a href=\"https://www.youtube.com/playlist?list=PLhr1KZpdzukcYwxz6XJz0LhB1yJYt8g8k\" target=\"_blank\" rel=\"noopener noreferrer\">Learn Kubernetes and EKS playlist</a> hosted on \"Containers from the Couch\".</p>\n<h4 id=\"prerequisites\" style=\"position:relative;\"><a href=\"#prerequisites\" aria-label=\"prerequisites permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Prerequisites</h4>\n<ul>\n<li>An active AWS account with administrative permissions</li>\n<li>A basic understanding of containers and Kubernetes</li>\n<li><a href=\"https://learn.hashicorp.com/tutorials/terraform/install-cli\" target=\"_blank\" rel=\"noopener noreferrer\">Terraform v1.3.x</a> (installation instructions here)</li>\n</ul>\n<p>To start the Amazon EKS Workshop, you'll first need to deploy the Amazon EKS cluster environment. To automate these steps, the workshop follows infrastructure as code (IaC) best practices leveraging <a href=\"https://www.terraform.io/\" target=\"_blank\" rel=\"noopener noreferrer\">Terraform</a>, an open-source tool to manage cluster creation and other prerequisites. We decided to use Terraform as a large number of Amazon EKS customers are already using Terraform today, and we expect the workshop to serve as an example for how to configure an Amazon EKS cluster and its various add-ons and integrations.</p>\n<p>Under the hood, Terraform uses <a href=\"https://aws.amazon.com/blogs/containers/introducing-eks-blueprints-for-terraform/\" target=\"_blank\" rel=\"noopener noreferrer\">Amazon EKS Blueprints for Terraform</a>, allowing you to easily bootstrap the Amazon EKS cluster. The workshop cluster is provisioned with a number of these tools and configurations ready to go, including managed node groups, an Amazon Fargate profile, Karpenter, Kubernetes Cluster Autoscaler, Kubecost, Crossplane, various Amazon EKS add-ons, and more. This means you spend less time installing, and more time navigating and learning the workshop material. To learn how to deploy the cluster environment with Terraform, refer to the <a href=\"https://www.eksworkshop.com/020_prerequisites/workspace/\" target=\"_blank\" rel=\"noopener noreferrer\">Getting Started instructions</a> on the Amazon EKS Workshop.</p>\n<h3 id=\"-amazon-eks-workshop-features\" style=\"position:relative;\"><a href=\"#-amazon-eks-workshop-features\" aria-label=\" amazon eks workshop features permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üõ† Amazon EKS Workshop Features</h3>\n<p>Once your workshop environment is deployed, most of the lab is completed through CLI commands. For every command in the workshop, you can easily left-click anywhere in the instruction to copy the command or press the clipboard on the top right to copy all commands.</p>\n<h4 id=\"kustomize\" style=\"position:relative;\"><a href=\"#kustomize\" aria-label=\"kustomize permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Kustomize</h4>\n<p>Kubernetes is configured using declarative YAML files, and most of the workshop modules include steps to update the cluster's YAML configuration. To streamline the edits for YAML files, we leverage <a href=\"https://kustomize.io/\" target=\"_blank\" rel=\"noopener noreferrer\">Kustomize</a>, an open-source configuration management tool that's built into the <code class=\"language-text\">kubectl</code> CLI. This enables us to not only apply changes easily, but also easily see exactly what has changed.</p>\n<h3 id=\"-environment-reset\" style=\"position:relative;\"><a href=\"#-environment-reset\" aria-label=\" environment reset permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üèó Environment Reset</h3>\n<p>After completing a module, you can easily switch to other modules by running the <code class=\"language-text\">reset-environment</code> command. This command cleans up any artifacts in your cluster and returns it to the initial state. This allows you to easily jump between any module in the workshop, and even clean up an uncompleted module.</p>\n<h3 id=\"-conclusion\" style=\"position:relative;\"><a href=\"#-conclusion\" aria-label=\" conclusion permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üîö Conclusion</h3>\n<p>With the new Amazon EKS Workshop, customers now have a reliable and continuously tested hands-on approach to learning about Amazon EKS and its ecosystem of open-source tooling. Get started today with the self-guided experience by using Terraform to deploy the workshop environment and then follow the step-by-step instructions in the standalone workshop modules.</p>\n<ul>\n<li>Get started with the workshop: <a href=\"https://www.eksworkshop.com/\" target=\"_blank\" rel=\"noopener noreferrer\">eksworkshop.com</a></li>\n<li>Learn more about the project and start contributing: <a href=\"https://github.com/aws-samples/eks-workshop-v2\" target=\"_blank\" rel=\"noopener noreferrer\">github.com/aws-samples/eks-workshop-v2</a></li>\n</ul>"}}},"staticQueryHashes":["1271460761","1321585977"],"slicesMap":{}}