{"componentChunkName":"component---src-templates-blog-template-js","path":"/blog/aws-eks-workshop-intro/","result":{"data":{"markdownRemark":{"html":"<blockquote>\n<p><strong>Fun with AWS: Learn AWS EKS Step-by-Step üí¨</strong></p>\n</blockquote>\n<h2 id=\"-introduction\" style=\"position:relative;\"><a href=\"#-introduction\" aria-label=\" introduction permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üìò Introduction</h2>\n<p>Hey there! Ready to learn EKS? We're diving into the world of Amazon Web Services (AWS) Elastic Kubernetes Service (EKS) with a super cool workshop called <a href=\"https://github.com/aws-samples/eks-workshop-v2\" target=\"_blank\" rel=\"noopener noreferrer\">EKS Workshop</a>. In this blog, we're going to explore this workshop together. We'll learn how to set up a special place in the cloud called a cluster, play with containers, and do some cool tricks with AWS services. The workshop is designed to be easy to follow, and you can choose which parts you want to do. You'll get to practice using Amazon EKS and other AWS tools, like an EKS cluster, to see how they work together. By the end of this blog post, you'll have a good understanding of Amazon EKS and how to use it to manage your applications on AWS.</p>\n<p><span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 495px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 37.64705882352941%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsTAAALEwEAmpwYAAAB10lEQVR42j1R30/TUBS+bbeMVTZaChR0bpC1o6UMt86ucz8KG7gJU2Yw4QFI9Akj8UkMiYnRF6KJDxrRkBAM+mD8Nz/PvQ08fDnn3HvOd853DmOpGbCUCaZMgEkqmJwhS0joZNOEcUI2frux1z4hacT1gocgjVEg64g2Rnj5+i2e7Bxg/8UR7gVdHB4dY/h0D8t+hP5wF0FrgN5gB41oC0uVNsr+KjTTpuYGBA8nVNRZYtWw//wVzi9+4/jkI04/f8Xqw5GIP335jm9nF3j3/hQ/zn/h7Ocl3px8wNWff7i8+ouwswnGMlDUuZiQKXo8ujwhpMgJ7msilhSVkCVoYh1SUief8tgtJMdmoBnzsXxem5iMCfnozkoT7koLi+UHsL0GnHIT1lIoJBXsGuZLNbGCvFUVuQ7lFixf5NleKGqmcy7tcwosV6yg3h7Ab2ygEvQEMfd5o7D9CJZbh+UEqLf6KLoB5XThh+so0ptX7SBo9mm3fcwVymKXQrLER2YqbOc+tkZ7aK0NUQ3W0Iw20aUjcLLe4BlqRNTpPhak0fp2LJmNx/XXkvl1ZIJEQVrLw7zrwbjtIGMsYIrs9B0XOl3SzHt0UQuTsyWKS+Ivlc0JEjlt3lz5P4pL6yBYZwjUAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"Workshop Image\" title=\"\" src=\"/static/833da211fe2f806db7117c68055e31f2/a4d88/workshop.png\" srcset=\"/static/833da211fe2f806db7117c68055e31f2/04472/workshop.png 170w,\n/static/833da211fe2f806db7117c68055e31f2/9f933/workshop.png 340w,\n/static/833da211fe2f806db7117c68055e31f2/a4d88/workshop.png 495w\" sizes=\"(max-width: 495px) 100vw, 495px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n    </span>\n          </p>\n<h3 id=\"-amazon-eks-workshop\" style=\"position:relative;\"><a href=\"#-amazon-eks-workshop\" aria-label=\" amazon eks workshop permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üèó Amazon EKS Workshop</h3>\n<p>The Amazon EKS Workshop is built to help users learn about Amazon EKS features and integrations with popular open-source projects. The workshop is abstracted into high-level learning modules, including Networking, Security, Cost Optimization, DevOps Automation, and more. These are further broken down into standalone labs focusing on a particular feature, tool, or use case. For example, you can find a lab for <a href=\"https://karpenter.sh/\" target=\"_blank\" rel=\"noopener noreferrer\">Karpenter</a>, an open-source cluster autoscaler, in the Cost Optimization module. To ensure a consistent and predictable learning experience, the Amazon EKS Workshop closely adheres to the following tenets:</p>\n<h4 id=\"principles\" style=\"position:relative;\"><a href=\"#principles\" aria-label=\"principles permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Principles</h4>\n<ul>\n<li><strong>Modular</strong>: The workshop is made up of standalone modules that can be individually completed, allowing you to start at any module and easily switch between them.</li>\n<li><strong>Consistent sample app</strong>: The workshop uses the same sample retail store application across all modules: AWS Containers Retail Sample.</li>\n<li><strong>Amazon EKS-focused</strong>: Although the workshop covers some Kubernetes basics, it primarily focuses on familiarizing the user with concepts directly related to Amazon EKS.</li>\n<li><strong>Continuously tested</strong>: We automatically test the infrastructure provisioning and CLI steps in the workshop, allowing us to keep the workshop updated and tracking the latest versions of Amazon EKS.</li>\n</ul>\n<h3 id=\"-how-to-get-started-with-the-workshop\" style=\"position:relative;\"><a href=\"#-how-to-get-started-with-the-workshop\" aria-label=\" how to get started with the workshop permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üöÄ How to Get Started with the Workshop</h3>\n<p>We designed the workshop for users with a basic understanding of containers and Kubernetes. As a primer to this workshop, users can learn the basics about containers, Kubernetes, and Amazon EKS with the <a href=\"https://www.youtube.com/playlist?list=PLhr1KZpdzukcYwxz6XJz0LhB1yJYt8g8k\" target=\"_blank\" rel=\"noopener noreferrer\">Learn Kubernetes and EKS playlist</a> hosted on \"Containers from the Couch\".</p>\n<h4 id=\"prerequisites\" style=\"position:relative;\"><a href=\"#prerequisites\" aria-label=\"prerequisites permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Prerequisites</h4>\n<ul>\n<li>An active AWS account with administrative permissions</li>\n<li>A basic understanding of containers and Kubernetes</li>\n<li><a href=\"https://learn.hashicorp.com/tutorials/terraform/install-cli\" target=\"_blank\" rel=\"noopener noreferrer\">Terraform v1.3.x</a> (installation instructions here)</li>\n</ul>\n<p>To start the Amazon EKS Workshop, you'll first need to deploy the Amazon EKS cluster environment. To automate these steps, the workshop follows infrastructure as code (IaC) best practices leveraging <a href=\"https://www.terraform.io/\" target=\"_blank\" rel=\"noopener noreferrer\">Terraform</a>, an open-source tool to manage cluster creation and other prerequisites. We decided to use Terraform as a large number of Amazon EKS customers are already using Terraform today, and we expect the workshop to serve as an example for how to configure an Amazon EKS cluster and its various add-ons and integrations.</p>\n<p>Under the hood, Terraform uses <a href=\"https://aws.amazon.com/blogs/containers/introducing-eks-blueprints-for-terraform/\" target=\"_blank\" rel=\"noopener noreferrer\">Amazon EKS Blueprints for Terraform</a>, allowing you to easily bootstrap the Amazon EKS cluster. The workshop cluster is provisioned with a number of these tools and configurations ready to go, including managed node groups, an Amazon Fargate profile, Karpenter, Kubernetes Cluster Autoscaler, Kubecost, Crossplane, various Amazon EKS add-ons, and more. This means you spend less time installing, and more time navigating and learning the workshop material. To learn how to deploy the cluster environment with Terraform, refer to the <a href=\"https://www.eksworkshop.com/020_prerequisites/workspace/\" target=\"_blank\" rel=\"noopener noreferrer\">Getting Started instructions</a> on the Amazon EKS Workshop.</p>\n<h3 id=\"-amazon-eks-workshop-features\" style=\"position:relative;\"><a href=\"#-amazon-eks-workshop-features\" aria-label=\" amazon eks workshop features permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üõ† Amazon EKS Workshop Features</h3>\n<p>Once your workshop environment is deployed, most of the lab is completed through CLI commands. For every command in the workshop, you can easily left-click anywhere in the instruction to copy the command or press the clipboard on the top right to copy all commands.</p>\n<h4 id=\"kustomize\" style=\"position:relative;\"><a href=\"#kustomize\" aria-label=\"kustomize permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Kustomize</h4>\n<p>Kubernetes is configured using declarative YAML files, and most of the workshop modules include steps to update the cluster's YAML configuration. To streamline the edits for YAML files, we leverage <a href=\"https://kustomize.io/\" target=\"_blank\" rel=\"noopener noreferrer\">Kustomize</a>, an open-source configuration management tool that's built into the <code class=\"language-text\">kubectl</code> CLI. This enables us to not only apply changes easily, but also easily see exactly what has changed.</p>\n<h3 id=\"-environment-reset\" style=\"position:relative;\"><a href=\"#-environment-reset\" aria-label=\" environment reset permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üèó Environment Reset</h3>\n<p>After completing a module, you can easily switch to other modules by running the <code class=\"language-text\">reset-environment</code> command. This command cleans up any artifacts in your cluster and returns it to the initial state. This allows you to easily jump between any module in the workshop, and even clean up an uncompleted module.</p>\n<h3 id=\"-conclusion\" style=\"position:relative;\"><a href=\"#-conclusion\" aria-label=\" conclusion permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üîö Conclusion</h3>\n<p>With the new Amazon EKS Workshop, customers now have a reliable and continuously tested hands-on approach to learning about Amazon EKS and its ecosystem of open-source tooling. Get started today with the self-guided experience by using Terraform to deploy the workshop environment and then follow the step-by-step instructions in the standalone workshop modules.</p>\n<ul>\n<li>Get started with the workshop: <a href=\"https://www.eksworkshop.com/\" target=\"_blank\" rel=\"noopener noreferrer\">eksworkshop.com</a></li>\n<li>Learn more about the project and start contributing: <a href=\"https://github.com/aws-samples/eks-workshop-v2\" target=\"_blank\" rel=\"noopener noreferrer\">github.com/aws-samples/eks-workshop-v2</a></li>\n</ul>","timeToRead":3,"rawMarkdownBody":"\n> **Fun with AWS: Learn AWS EKS Step-by-Step üí¨**\n\n## üìò Introduction\n\nHey there! Ready to learn EKS? We're diving into the world of Amazon Web Services (AWS) Elastic Kubernetes Service (EKS) with a super cool workshop called [EKS Workshop](https://github.com/aws-samples/eks-workshop-v2). In this blog, we're going to explore this workshop together. We'll learn how to set up a special place in the cloud called a cluster, play with containers, and do some cool tricks with AWS services. The workshop is designed to be easy to follow, and you can choose which parts you want to do. You'll get to practice using Amazon EKS and other AWS tools, like an EKS cluster, to see how they work together. By the end of this blog post, you'll have a good understanding of Amazon EKS and how to use it to manage your applications on AWS.\n\n![Workshop Image](./workshop.png)\n\n### üèó Amazon EKS Workshop\n\nThe Amazon EKS Workshop is built to help users learn about Amazon EKS features and integrations with popular open-source projects. The workshop is abstracted into high-level learning modules, including Networking, Security, Cost Optimization, DevOps Automation, and more. These are further broken down into standalone labs focusing on a particular feature, tool, or use case. For example, you can find a lab for [Karpenter](https://karpenter.sh/), an open-source cluster autoscaler, in the Cost Optimization module. To ensure a consistent and predictable learning experience, the Amazon EKS Workshop closely adheres to the following tenets:\n\n#### Principles\n\n- **Modular**: The workshop is made up of standalone modules that can be individually completed, allowing you to start at any module and easily switch between them.\n- **Consistent sample app**: The workshop uses the same sample retail store application across all modules: AWS Containers Retail Sample.\n- **Amazon EKS-focused**: Although the workshop covers some Kubernetes basics, it primarily focuses on familiarizing the user with concepts directly related to Amazon EKS.\n- **Continuously tested**: We automatically test the infrastructure provisioning and CLI steps in the workshop, allowing us to keep the workshop updated and tracking the latest versions of Amazon EKS.\n\n### üöÄ How to Get Started with the Workshop\n\nWe designed the workshop for users with a basic understanding of containers and Kubernetes. As a primer to this workshop, users can learn the basics about containers, Kubernetes, and Amazon EKS with the [Learn Kubernetes and EKS playlist](https://www.youtube.com/playlist?list=PLhr1KZpdzukcYwxz6XJz0LhB1yJYt8g8k) hosted on \"Containers from the Couch\".\n\n#### Prerequisites\n\n- An active AWS account with administrative permissions\n- A basic understanding of containers and Kubernetes\n- [Terraform v1.3.x](https://learn.hashicorp.com/tutorials/terraform/install-cli) (installation instructions here)\n\nTo start the Amazon EKS Workshop, you'll first need to deploy the Amazon EKS cluster environment. To automate these steps, the workshop follows infrastructure as code (IaC) best practices leveraging [Terraform](https://www.terraform.io/), an open-source tool to manage cluster creation and other prerequisites. We decided to use Terraform as a large number of Amazon EKS customers are already using Terraform today, and we expect the workshop to serve as an example for how to configure an Amazon EKS cluster and its various add-ons and integrations.\n\nUnder the hood, Terraform uses [Amazon EKS Blueprints for Terraform](https://aws.amazon.com/blogs/containers/introducing-eks-blueprints-for-terraform/), allowing you to easily bootstrap the Amazon EKS cluster. The workshop cluster is provisioned with a number of these tools and configurations ready to go, including managed node groups, an Amazon Fargate profile, Karpenter, Kubernetes Cluster Autoscaler, Kubecost, Crossplane, various Amazon EKS add-ons, and more. This means you spend less time installing, and more time navigating and learning the workshop material. To learn how to deploy the cluster environment with Terraform, refer to the [Getting Started instructions](https://www.eksworkshop.com/020_prerequisites/workspace/) on the Amazon EKS Workshop.\n\n### üõ† Amazon EKS Workshop Features\n\nOnce your workshop environment is deployed, most of the lab is completed through CLI commands. For every command in the workshop, you can easily left-click anywhere in the instruction to copy the command or press the clipboard on the top right to copy all commands.\n\n#### Kustomize\n\nKubernetes is configured using declarative YAML files, and most of the workshop modules include steps to update the cluster's YAML configuration. To streamline the edits for YAML files, we leverage [Kustomize](https://kustomize.io/), an open-source configuration management tool that's built into the `kubectl` CLI. This enables us to not only apply changes easily, but also easily see exactly what has changed.\n\n### üèó Environment Reset\n\nAfter completing a module, you can easily switch to other modules by running the `reset-environment` command. This command cleans up any artifacts in your cluster and returns it to the initial state. This allows you to easily jump between any module in the workshop, and even clean up an uncompleted module.\n\n### üîö Conclusion\n\nWith the new Amazon EKS Workshop, customers now have a reliable and continuously tested hands-on approach to learning about Amazon EKS and its ecosystem of open-source tooling. Get started today with the self-guided experience by using Terraform to deploy the workshop environment and then follow the step-by-step instructions in the standalone workshop modules.\n\n- Get started with the workshop: [eksworkshop.com](https://www.eksworkshop.com/)\n- Learn more about the project and start contributing: [github.com/aws-samples/eks-workshop-v2](https://github.com/aws-samples/eks-workshop-v2)\n","wordCount":{"words":808},"frontmatter":{"id":"a7a5190830546b17078e04ad","path":"/blog/aws-eks-workshop-intro/","humanDate":"Oct 19, 2024","fullDate":"2024-10-19","title":"Hands-on Labs for Amazon EKS: a great intro to learning Amazon EKS","keywords":["AWS EKS","Amazon EKS","Kubernetes"],"excerpt":"Dive into Amazon EKS with hands-on labs designed to give you a practical introduction to this powerful service.","cover":{"childImageSharp":{"gatsbyImageData":{"layout":"fullWidth","placeholder":{"fallback":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAABYlAAAWJQFJUiTwAAADIklEQVR42hXSjTPbBwDG8V9YT8vqZqt12+nLuq1la9VLWaKhVqTb0JKx3mpWU2wtRd2wVEK8DqeZJBXRxkUTxGuMSiIILWEM2cadf+e77B/43HPPfYXg6DKOXCwjMLqKgJhfEcW1I/pcR4DUzJGMCY5nThP2jYN3ireIqD7gM8U+ya1/k6fZpdy4RavFy/PpV/zhXGFzdQkhIVeFvLyXU+mNCNGPCUzsJkBi4I1rLwiSTfrBKcLyFwgvXCXiwQ6R9f9yteUfcp7s8rNhE/XQGv0THuwvF/EuOxHOpFRzRd7ECWkDQpQSUUw3oitPCRQPEJQxxpu3/OvynZz84RWnKvY4X7mGWOElp3ub+4YN1OZV+scWmZ51su6eRYjNbSXtno74b7XI7g8jLR5BVm4n7eE84XnzBNxcIqTAS1ipj/cr9zlfs018jQeZwk1xzxJNz90YRuaZstvxLkwiXMhs8WMaLsl1SAoHSSoaRlwyg7RyicjSFc6WrBH1aJdL9Qckqg9J6zwkp2ePuz2rVPQ4aTc5sUw7cTlm2HBYED688T/Yy8eZWo5Jfic4dZAQmY3Q7DnevePhZPEGZyp8nKs5IFp5SHLbvv8/H/f0Xmr0LlTaCbqfWrBZzWy+NCKEJTVzIVvHR1l6Tn89wOlbVs7dthMunyVU7uSTn9a5WP0XMXV7JCp9XFdv88VjD2WaZVRGF7/1T6AzWhgaNOEY1iKEStqIzDVy+baZuDtW4oumiCt1crbAQcT3bpJq/yRVuYvMn0pmxx75XZtkqVzU9S3SZZpHPzjO6KiVOdsAs6YOhKCETkSxPQgxet7LspH8cJkTeS5E2W6iH+0gVu4jbT4kVnlAVO0Od/U+6ga3aHvhoW90npHxMWx+aGGogTnDLwhHxRqCk3SEpDwjNMPC29lTvJUzS0ThIpLaLdIad0lv9vkz8fGlep0bCgffNU5S3jaEqqsPzZMuzL0NzOir8BhK/KBEy9GrfRxLNRGcbiHkq3GO37TzQYGLTx+scLnyNQm166QoXnOtdoHU6mly66wUKQaoUmloamlF017Ps44KbJ0/8h+n9An+Tb9D5AAAAABJRU5ErkJggg=="},"images":{"fallback":{"src":"/static/d64ec4cd52ea87df2dc47e714c0d21f9/1ecb8/workshop-cover.png","srcSet":"/static/d64ec4cd52ea87df2dc47e714c0d21f9/dc458/workshop-cover.png 750w,\n/static/d64ec4cd52ea87df2dc47e714c0d21f9/46f54/workshop-cover.png 1080w,\n/static/d64ec4cd52ea87df2dc47e714c0d21f9/58134/workshop-cover.png 1366w,\n/static/d64ec4cd52ea87df2dc47e714c0d21f9/1ecb8/workshop-cover.png 1920w","sizes":"100vw"},"sources":[{"srcSet":"/static/d64ec4cd52ea87df2dc47e714c0d21f9/4ff4a/workshop-cover.webp 750w,\n/static/d64ec4cd52ea87df2dc47e714c0d21f9/0220e/workshop-cover.webp 1080w,\n/static/d64ec4cd52ea87df2dc47e714c0d21f9/2da9e/workshop-cover.webp 1366w,\n/static/d64ec4cd52ea87df2dc47e714c0d21f9/ba23a/workshop-cover.webp 1920w","type":"image/webp","sizes":"100vw"}]},"width":1,"height":0.5510416666666667}}},"coverCredits":"Photo by Saifeddine Rajhi"}}},"pageContext":{"prevThought":{"frontmatter":{"path":"/blog/unit-testing-aws-lambda-moto/","title":"Unit Testing AWS Lambda with Python and Mock AWS Services Using Moto üìà","date":"2024-10-20 10:34:00"},"excerpt":"Quality Assurance and Resilience of AWS Lambda with Moto üöÅ‚ú® üìç Introduction When developing serverless event-driven applications with AWS‚Ä¶","html":"<blockquote>\n<p><strong>Quality Assurance and Resilience of AWS Lambda with Moto üöÅ‚ú®</strong></p>\n</blockquote>\n<h2 id=\"-introduction\" style=\"position:relative;\"><a href=\"#-introduction\" aria-label=\" introduction permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üìç Introduction</h2>\n<p>When developing <a href=\"https://www.cloudflare.com/en-gb/learning/serverless/what-is-serverless/\" target=\"_blank\" rel=\"noopener noreferrer\">serverless</a> <a href=\"https://en.wikipedia.org/wiki/Event-driven_architecture\" target=\"_blank\" rel=\"noopener noreferrer\">event-driven</a> applications with AWS Lambda, ensuring the reliability and functionality of individual components is important.</p>\n<p><a href=\"https://www.techtarget.com/searchsoftwarequality/definition/unit-testing\" target=\"_blank\" rel=\"noopener noreferrer\">Unit testing</a> serves as a fundamental practice to swiftly identify and isolate potential issues within <a href=\"https://aws.amazon.com/lambda/features/\" target=\"_blank\" rel=\"noopener noreferrer\">AWS Lambda function</a> code.</p>\n<p>This blog post explores the application of unit testing techniques for Python-based AWS Lambda functions, particularly focusing on interactions with various AWS services. In this context, the <a href=\"https://github.com/getmoto/moto/tree/master\" target=\"_blank\" rel=\"noopener noreferrer\">Moto</a> library emerges as a valuable tool for simulating AWS resources, enabling the testing of Python code that interfaces with services such as <a href=\"https://aws.amazon.com/dynamodb/features/\" target=\"_blank\" rel=\"noopener noreferrer\">DynamoDB</a> and <a href=\"https://aws.amazon.com/s3/features/\" target=\"_blank\" rel=\"noopener noreferrer\">S3</a>.</p>\n<p>Through the integration of Moto with <a href=\"https://github.com/pytest-dev/pytest\" target=\"_blank\" rel=\"noopener noreferrer\">pytest</a>, this post aims to provide insights into effectively testing Python-based AWS Lambda functions.</p>\n<p><span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 52.352941176470594%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsTAAALEwEAmpwYAAABfUlEQVR42o2S0W7TQBBF8yV8E698AJ/DKxJfwDMPqEJCqCmtRItCCSDigpsUxcG4SRw7wU53d3YP46RIrZsKRrqau+PR3Znr7dCKEKC2otkTTEmwK8XvbXbX2RTgDbui0y7MK8NgskDEIbMPuGkPmX9W9HGzPpIPkMsefjnUC2qCrO8KNlM1EacFcVaSFTXGGnwRIcUZfjVGyu/IIlKhkfJYcb45NxzdpiW4VTwdZgyzgmlZYZz8NWHHYoH7onPz82x1RWUsw7RibZxW1MegfuKvu8KN7vZ5h+CituS148v4HUV99Y9Z/mPCvBamaZeo94ji8oBafbs4fsw82dv0eC94JQ0al7wSH8L9P2WUO/aPnhAfPOTw+JniKScvHtA9ec77ieP1IOHlxxF7/R+KC/bjGUdnE30RcvfZNJrZcs2ksKSlIVlYkrwmXTqiXxVvviYcfkvpam7wNvrJq09jTs/TW9Z0Wu7qDhI2uyDb5ZQ7kWCshHavEx+s3K7/AYzFAhTihvgNAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"Unit Testing AWS Lambda\" title=\"\" src=\"/static/c47a8ffa88342cc7eb06d4b7077a1cb0/c5bb3/ut.png\" srcset=\"/static/c47a8ffa88342cc7eb06d4b7077a1cb0/04472/ut.png 170w,\n/static/c47a8ffa88342cc7eb06d4b7077a1cb0/9f933/ut.png 340w,\n/static/c47a8ffa88342cc7eb06d4b7077a1cb0/c5bb3/ut.png 680w,\n/static/c47a8ffa88342cc7eb06d4b7077a1cb0/5a190/ut.png 800w\" sizes=\"(max-width: 680px) 100vw, 680px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n    </span>\n          </p>\n<h3 id=\"Ô∏è-what-is-moto-and-why-use-it\" style=\"position:relative;\"><a href=\"#%EF%B8%8F-what-is-moto-and-why-use-it\" aria-label=\"Ô∏è what is moto and why use it permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üõ†Ô∏è What is Moto and Why Use It?</h3>\n<p>When testing code that interacts with cloud services, it's essential to mimic the functionality of those services. However, replicating them completely locally can be challenging. This is where <a href=\"https://github.com/getmoto/moto\" target=\"_blank\" rel=\"noopener noreferrer\">Moto</a>, a library that allows mocking AWS services, comes into play.</p>\n<p>Moto is particularly useful when testing Python code that interacts with AWS services like DynamoDB, S3, and others. It enables developers to simulate AWS resources, making it easier to test code that interfaces with various AWS services.</p>\n<p>By using Moto in combination with <a href=\"https://docs.pytest.org/en/6.2.x/\" target=\"_blank\" rel=\"noopener noreferrer\">pytest</a>, developers can ensure comprehensive testing of their Python code, thereby enhancing the reliability and quality of their applications.</p>\n<p>Moto has gained recognition for its ability to simplify testing in the cloud, making it a valuable tool for developers working on serverless applications. By using Moto, developers can test their code without the need to directly access real AWS resources, ultimately streamlining the testing process and contributing to the overall robustness of their applications.</p>\n<p><span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 126.47058823529413%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAZCAYAAAAxFw7TAAAACXBIWXMAAAsTAAALEwEAmpwYAAACg0lEQVR42pWVhW4rQQxF8/8/FSUKMynMzMzk9ljy0yavsLU03Qxd+/p6XI982u12k/F4LO12W2q1mpTLZR3FYlEKhYI0m03J5/PSaDSkUqnoeq/Xk8lkoned5uHP/X6X5XIpw+FQL6VSKQXo9/u6xhcAHAJWr9d1fbVa6d0XwMvlIufzWT21Wi09vNvthHUOPx4P3Wd+OBxkv99Lp9PRc6yzdjwe/53x4LVUKilVIuNgtVrV+Wazke12K4PBQPdYh3Imk1EGuVxOI2ade6TAs1gs9MdsNtNccZnfUMLz6XSS6XSqtNkjOgAAghGj2+1qSsDyPJ9PuV6vyp9D8/lcqbJuxm+jzh4OY7GYpgmn3LczKgoHksmkUgkEApLNZnXTwDDm0E6n0+o4HA5rJUQiEY3eziogiQWUQdgoboDOKKEFRVLASCQSCsr9l7L5yqCDatBhIBCJJ6coDXXEpCL+q8P3SDAihbrX65VQKCQ+n0/pBYNBnZMi5jj6EdCM6DgMMELxkih61ihoaLI2Go1eAvkWEIMqF1GXy4iGqtQmX4ZTkG8BbRNxyBPUGVbMfKlHK3rXEUIbutBGYcoFuswRBoFcRfgeLZfJFZQNyPYAdHacXwEpDyjy5nlyFDb5NAPQHLgCxBAF6tQhQjgj+jMgFHlB5JCnRw55JdYHXQM6CxwxeGJ0byjTwixKOhVq/ymHqE2UABMxwxyaYC/N4avoqEGEoNchAlFFo1GtO9apQ6jDgN75IyBRQQV1KWi6txU1StNloG/OfgXESDS5QQSipasggP3P4UmSivfn56psrGcSkd/vV7pQB5w0EK0rUaytY+v1WinH43F936hNOnBAF7Kn9wE84G704IFrKwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"UT AWS Lambda\" title=\"\" src=\"/static/d3a07e298be6630d63af77e5b340123b/c5bb3/graph.png\" srcset=\"/static/d3a07e298be6630d63af77e5b340123b/04472/graph.png 170w,\n/static/d3a07e298be6630d63af77e5b340123b/9f933/graph.png 340w,\n/static/d3a07e298be6630d63af77e5b340123b/c5bb3/graph.png 680w,\n/static/d3a07e298be6630d63af77e5b340123b/5a190/graph.png 800w\" sizes=\"(max-width: 680px) 100vw, 680px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n    </span>\n          </p>\n<h2 id=\"-decorator-approach\" style=\"position:relative;\"><a href=\"#-decorator-approach\" aria-label=\" decorator approach permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üß© Decorator Approach</h2>\n<p>The decorator approach simplifies AWS service mocking using Moto in the <code class=\"language-text\">eu-west-1</code> region. The <code class=\"language-text\">@mock_ec2</code> decorator encapsulates the test function, ensuring automatic management of the Moto mock environment for seamless testing.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">import</span> boto3\n<span class=\"token keyword\">from</span> moto <span class=\"token keyword\">import</span> mock_ec2\n<span class=\"token keyword\">from</span> main <span class=\"token keyword\">import</span> create_instances\n\n<span class=\"token decorator annotation punctuation\">@mock_ec2</span>\n<span class=\"token keyword\">def</span> <span class=\"token function\">test_create_instances_with_decorator</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    instance_count <span class=\"token operator\">=</span> <span class=\"token number\">1</span>\n    image_id <span class=\"token operator\">=</span> <span class=\"token string\">'ami-02ed82f3a38303e6f'</span>\n    create_instances<span class=\"token punctuation\">(</span><span class=\"token string\">'eu-west-1'</span><span class=\"token punctuation\">,</span> image_id<span class=\"token punctuation\">,</span> instance_count<span class=\"token punctuation\">)</span>\n    client <span class=\"token operator\">=</span> boto3<span class=\"token punctuation\">.</span>client<span class=\"token punctuation\">(</span><span class=\"token string\">'ec2'</span><span class=\"token punctuation\">,</span> region_name<span class=\"token operator\">=</span><span class=\"token string\">'eu-west-1'</span><span class=\"token punctuation\">)</span>\n    instances <span class=\"token operator\">=</span> client<span class=\"token punctuation\">.</span>describe_instances<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token string\">'Reservations'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token string\">'Instances'</span><span class=\"token punctuation\">]</span>\n    <span class=\"token keyword\">assert</span> <span class=\"token builtin\">len</span><span class=\"token punctuation\">(</span>instances<span class=\"token punctuation\">)</span> <span class=\"token operator\">==</span> instance_count\n    <span class=\"token keyword\">assert</span> instances<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token string\">'ImageId'</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">==</span> image_id</code></pre></div>\n<h2 id=\"-context-manager-approach\" style=\"position:relative;\"><a href=\"#-context-manager-approach\" aria-label=\" context manager approach permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üß© Context Manager Approach</h2>\n<p>In the Ireland region, the context manager-based approach facilitates AWS service mocking with Moto. Utilizing <code class=\"language-text\">with mock_ec2():</code>, the test logic within the block benefits from the active Moto mock environment, maintaining clarity and proper resource management.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">import</span> boto3\n<span class=\"token keyword\">from</span> main <span class=\"token keyword\">import</span> create_instances\n<span class=\"token keyword\">from</span> moto <span class=\"token keyword\">import</span> mock_ec2\n\n<span class=\"token keyword\">def</span> <span class=\"token function\">test_create_instances_with_context_manager</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">with</span> mock_ec2<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        instance_count <span class=\"token operator\">=</span> <span class=\"token number\">1</span>\n        image_id <span class=\"token operator\">=</span> <span class=\"token string\">'ami-02ed82f3a38303e6f'</span>\n        create_instances<span class=\"token punctuation\">(</span><span class=\"token string\">'eu-west-1'</span><span class=\"token punctuation\">,</span> image_id<span class=\"token punctuation\">,</span> instance_count<span class=\"token punctuation\">)</span>\n        client <span class=\"token operator\">=</span> boto3<span class=\"token punctuation\">.</span>client<span class=\"token punctuation\">(</span><span class=\"token string\">'ec2'</span><span class=\"token punctuation\">,</span> region_name<span class=\"token operator\">=</span><span class=\"token string\">'eu-west-1'</span><span class=\"token punctuation\">)</span>\n        instances <span class=\"token operator\">=</span> client<span class=\"token punctuation\">.</span>describe_instances<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token string\">'Reservations'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token string\">'Instances'</span><span class=\"token punctuation\">]</span>\n        <span class=\"token keyword\">assert</span> <span class=\"token builtin\">len</span><span class=\"token punctuation\">(</span>instances<span class=\"token punctuation\">)</span> <span class=\"token operator\">==</span> instance_count\n        <span class=\"token keyword\">assert</span> instances<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token string\">'ImageId'</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">==</span> image_id</code></pre></div>\n<h2 id=\"-raw-approach\" style=\"position:relative;\"><a href=\"#-raw-approach\" aria-label=\" raw approach permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üß© Raw Approach</h2>\n<p>For explicit control over the Moto mock environment, the raw approach is demonstrated in the Ireland region. Manually starting and stopping the mock using <code class=\"language-text\">mock.start()</code> and <code class=\"language-text\">mock.stop()</code> provides flexibility, as shown in the following example.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">import</span> boto3\n<span class=\"token keyword\">from</span> main <span class=\"token keyword\">import</span> create_instances\n<span class=\"token keyword\">from</span> moto <span class=\"token keyword\">import</span> mock_ec2\n\n<span class=\"token keyword\">def</span> <span class=\"token function\">test_create_instances_raw</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    mock <span class=\"token operator\">=</span> mock_ec2<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    mock<span class=\"token punctuation\">.</span>start<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    instance_count <span class=\"token operator\">=</span> <span class=\"token number\">1</span>\n    image_id <span class=\"token operator\">=</span> <span class=\"token string\">'ami-02ed82f3a38303e6f'</span>\n    create_instances<span class=\"token punctuation\">(</span><span class=\"token string\">'eu-west-1'</span><span class=\"token punctuation\">,</span> image_id<span class=\"token punctuation\">,</span> instance_count<span class=\"token punctuation\">)</span>\n    client <span class=\"token operator\">=</span> boto3<span class=\"token punctuation\">.</span>client<span class=\"token punctuation\">(</span><span class=\"token string\">'ec2'</span><span class=\"token punctuation\">,</span> region_name<span class=\"token operator\">=</span><span class=\"token string\">'eu-west-1'</span><span class=\"token punctuation\">)</span>\n    instances <span class=\"token operator\">=</span> client<span class=\"token punctuation\">.</span>describe_instances<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token string\">'Reservations'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token string\">'Instances'</span><span class=\"token punctuation\">]</span>\n    <span class=\"token keyword\">assert</span> <span class=\"token builtin\">len</span><span class=\"token punctuation\">(</span>instances<span class=\"token punctuation\">)</span> <span class=\"token operator\">==</span> instance_count\n    <span class=\"token keyword\">assert</span> instances<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token string\">'ImageId'</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">==</span> image_id\n    mock<span class=\"token punctuation\">.</span>stop<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></code></pre></div>\n<hr>\n<h2 id=\"-local-lambda-testing\" style=\"position:relative;\"><a href=\"#-local-lambda-testing\" aria-label=\" local lambda testing permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üé© Local Lambda Testing</h2>\n<p>Moto uses decorators to intercept and simulate responses to and from AWS resources. By adding a decorator for a given AWS service, subsequent calls from the module to that service will be re-directed to the mock.</p>\n<p>In this section, we'll couple the Moto library and pytest framework to have clean and scalable unit tests. Let's test a serverless app using Pytest and Moto. Our goal? Check if a piece of code (AWS Lambda) works right. We'll focus on the Lambda function, not AWS services. We'll use Pytest for testing and Moto to pretend AWS services. This keeps tests clear and reliable.</p>\n<h3 id=\"-lambda-function-code\" style=\"position:relative;\"><a href=\"#-lambda-function-code\" aria-label=\" lambda function code permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üìÑ Lambda Function Code</h3>\n<p>This file (<code class=\"language-text\">main.py</code>) contains the main Lambda function (<code class=\"language-text\">lambda_handler</code>) that manipulates data and uploads it to an S3 bucket. It utilizes the Boto3 library to interact with AWS services.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">import</span> boto3\n\n<span class=\"token keyword\">def</span> <span class=\"token function\">lambda_handler</span><span class=\"token punctuation\">(</span>event<span class=\"token punctuation\">,</span> context<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token comment\"># Sample Lambda function that manipulates data and uploads to S3</span>\n    data_to_upload <span class=\"token operator\">=</span> <span class=\"token string\">\"Hello, Moto!\"</span>\n\n    <span class=\"token comment\"># AWS S3 Configuration</span>\n    s3_bucket <span class=\"token operator\">=</span> <span class=\"token string\">\"your-s3-bucket\"</span>\n    s3_key <span class=\"token operator\">=</span> <span class=\"token string\">\"example.txt\"</span>\n\n    <span class=\"token comment\"># Upload to S3</span>\n    s3 <span class=\"token operator\">=</span> boto3<span class=\"token punctuation\">.</span>client<span class=\"token punctuation\">(</span><span class=\"token string\">\"s3\"</span><span class=\"token punctuation\">)</span>\n    s3<span class=\"token punctuation\">.</span>put_object<span class=\"token punctuation\">(</span>Body<span class=\"token operator\">=</span>data_to_upload<span class=\"token punctuation\">,</span> Bucket<span class=\"token operator\">=</span>s3_bucket<span class=\"token punctuation\">,</span> Key<span class=\"token operator\">=</span>s3_key<span class=\"token punctuation\">)</span>\n\n    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span><span class=\"token string\">\"statusCode\"</span><span class=\"token punctuation\">:</span> <span class=\"token number\">200</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"body\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"Data uploaded to S3 successfully.\"</span><span class=\"token punctuation\">}</span></code></pre></div>\n<h3 id=\"Ô∏è-pytest-configuration\" style=\"position:relative;\"><a href=\"#%EF%B8%8F-pytest-configuration\" aria-label=\"Ô∏è pytest configuration permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üõ†Ô∏è Pytest Configuration</h3>\n<p><code class=\"language-text\">conftest.py</code> serves as a configuration file for Pytest. In this example, it defines two fixtures:</p>\n<ul>\n<li><strong>aws_credentials</strong>: A fixture to set up mocked AWS credentials using environment variables.</li>\n<li><strong>s3_mock</strong>: A fixture that uses Moto's <code class=\"language-text\">mock_s3</code> context manager to mock the S3 service. It depends on the <code class=\"language-text\">aws_credentials</code> fixture to ensure mocked credentials are available.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">import</span> pytest\n<span class=\"token keyword\">import</span> os\n<span class=\"token keyword\">from</span> moto <span class=\"token keyword\">import</span> mock_s3\n\n<span class=\"token decorator annotation punctuation\">@pytest<span class=\"token punctuation\">.</span>fixture</span><span class=\"token punctuation\">(</span>scope<span class=\"token operator\">=</span><span class=\"token string\">'function'</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">def</span> <span class=\"token function\">aws_credentials</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token comment\"># Mocked AWS Credentials for Moto</span>\n    os<span class=\"token punctuation\">.</span>environ<span class=\"token punctuation\">[</span><span class=\"token string\">'AWS_ACCESS_KEY_ID'</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token string\">'fake-access-key'</span>\n    os<span class=\"token punctuation\">.</span>environ<span class=\"token punctuation\">[</span><span class=\"token string\">'AWS_SECRET_ACCESS_KEY'</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token string\">'fake-secret-key'</span>\n    os<span class=\"token punctuation\">.</span>environ<span class=\"token punctuation\">[</span><span class=\"token string\">'AWS_SECURITY_TOKEN'</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token string\">'fake-security-token'</span>\n    os<span class=\"token punctuation\">.</span>environ<span class=\"token punctuation\">[</span><span class=\"token string\">'AWS_SESSION_TOKEN'</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token string\">'fake-session-token'</span>\n\n<span class=\"token decorator annotation punctuation\">@pytest<span class=\"token punctuation\">.</span>fixture</span><span class=\"token punctuation\">(</span>scope<span class=\"token operator\">=</span><span class=\"token string\">'function'</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">def</span> <span class=\"token function\">s3_mock</span><span class=\"token punctuation\">(</span>aws_credentials<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">with</span> mock_s3<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        <span class=\"token keyword\">yield</span> boto3<span class=\"token punctuation\">.</span>client<span class=\"token punctuation\">(</span><span class=\"token string\">'s3'</span><span class=\"token punctuation\">)</span></code></pre></div>\n<h3 id=\"-unit-test\" style=\"position:relative;\"><a href=\"#-unit-test\" aria-label=\" unit test permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üß™ Unit Test</h3>\n<p><code class=\"language-text\">test_main.py</code> is a Pytest test file that contains a single unit test (<code class=\"language-text\">test_lambda_handler</code>). This test checks if the Lambda function in <code class=\"language-text\">main.py</code> successfully uploads a file to an S3 bucket. It uses the <code class=\"language-text\">s3_mock</code> and <code class=\"language-text\">aws_credentials</code> fixtures from <code class=\"language-text\">conftest.py</code> to set up the required mocking environment.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">import</span> pytest\n<span class=\"token keyword\">import</span> boto3\n<span class=\"token keyword\">from</span> main <span class=\"token keyword\">import</span> lambda_handler\n\n<span class=\"token keyword\">def</span> <span class=\"token function\">test_lambda_handler</span><span class=\"token punctuation\">(</span>s3_mock<span class=\"token punctuation\">,</span> aws_credentials<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token comment\"># Event and Context are not used in this example</span>\n    event <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n    context <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n\n    <span class=\"token comment\"># Invoke the Lambda function</span>\n    response <span class=\"token operator\">=</span> lambda_handler<span class=\"token punctuation\">(</span>event<span class=\"token punctuation\">,</span> context<span class=\"token punctuation\">)</span>\n\n    <span class=\"token comment\"># Check if the S3 object was created successfully</span>\n    <span class=\"token keyword\">assert</span> response<span class=\"token punctuation\">[</span><span class=\"token string\">\"statusCode\"</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">==</span> <span class=\"token number\">200</span>\n\n    <span class=\"token comment\"># Check if the object exists in S3</span>\n    objects <span class=\"token operator\">=</span> s3_mock<span class=\"token punctuation\">.</span>list_objects<span class=\"token punctuation\">(</span>Bucket<span class=\"token operator\">=</span><span class=\"token string\">'your-s3-bucket'</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">assert</span> objects<span class=\"token punctuation\">[</span><span class=\"token string\">\"Contents\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token string\">\"Key\"</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">==</span> <span class=\"token string\">\"example.txt\"</span></code></pre></div>\n<h3 id=\"-running-the-unit-tests\" style=\"position:relative;\"><a href=\"#-running-the-unit-tests\" aria-label=\" running the unit tests permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üöÄ Running the Unit Tests</h3>\n<p>The unit testing framework can be run using the Python <code class=\"language-text\">pytest</code> utility. To ensure network isolation and verify the unit tests are not accidentally connecting to AWS resources, the <a href=\"https://pypi.org/project/pytest-socket/\" target=\"_blank\" rel=\"noopener noreferrer\">pytest-socket</a> project provides the ability to disable network communication during a test.</p>\n<div class=\"gatsby-highlight\" data-language=\"sh\"><pre class=\"language-sh\"><code class=\"language-sh\">pytest <span class=\"token parameter variable\">-v</span> --disable-socket <span class=\"token parameter variable\">-s</span> test_main.py</code></pre></div>\n<p>The <code class=\"language-text\">pytest</code> command results in a PASSED or FAILED status for each test. A PASSED status verifies that your unit tests, as written, did not encounter errors or issues.</p>\n<h3 id=\"-conclusion\" style=\"position:relative;\"><a href=\"#-conclusion\" aria-label=\" conclusion permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üìå Conclusion</h3>\n<p>In this guide, we explored some ways for mocking AWS responses with Moto, offering a swift and cost-free approach to testing Python code. When paired with Pytest, it delivers scalable and tidy unit tests specifically tailored for AWS interactions.</p>\n<h3 id=\"-what-next\" style=\"position:relative;\"><a href=\"#-what-next\" aria-label=\" what next permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üîç What Next?</h3>\n<p>You can keep an eye on this <a href=\"https://github.com/seifrajhi/Python-AWS-Lambda-Testing\" target=\"_blank\" rel=\"noopener noreferrer\">repository</a> as I continue to develop it and add more use cases and integrations!</p>\n<br>\n<p><strong><em>Until next time, „Å§„Å•„Åè üéâ</em></strong></p>\n<blockquote>\n<p>üí° Thank you for Reading !! üôåüèªüòÅüìÉ, see you in the next blog.ü§ò  <em><strong>Until next time üéâ</strong></em></p>\n</blockquote>\n<p>üöÄ Thank you for sticking up till the end. If you have any questions/feedback regarding this blog feel free to connect with me:</p>\n<p><strong>‚ôªÔ∏è LinkedIn:</strong> <a href=\"https://www.linkedin.com/in/rajhi-saif/\" target=\"_blank\" rel=\"noopener noreferrer\">https://www.linkedin.com/in/rajhi-saif/</a></p>\n<p><strong>‚ôªÔ∏è X/Twitter:</strong> <a href=\"https://x.com/rajhisaifeddine\" target=\"_blank\" rel=\"noopener noreferrer\">https://x.com/rajhisaifeddine</a></p>\n<p><strong>The end ‚úåüèª</strong></p>\n<h1 align=\"center\">üî∞ Keep Learning !! Keep Sharing !! üî∞</h1>\n<p><strong>üìÖ Stay updated</strong></p>\n<p>Subscribe to our newsletter for more insights on AWS cloud computing and containers.</p>"},"nextThought":{"frontmatter":{"path":"/blog/k8s-observability-datadaog/","title":"Automate Kubernetes Monitoring with Terraform and Datadog","date":"2024-10-19 21:36:00"},"excerpt":"Infrastructure as Code for K8s Observability: Terraform and Datadog in Action üìå Introduction Datadog is a powerful cloud monitoring‚Ä¶","html":"<blockquote>\n<p><strong>Infrastructure as Code for K8s Observability: Terraform and Datadog in Action</strong></p>\n</blockquote>\n<h2 id=\"-introduction\" style=\"position:relative;\"><a href=\"#-introduction\" aria-label=\" introduction permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üìå Introduction</h2>\n<p>Datadog is a powerful cloud monitoring platform that helps you keep an eye on your systems in real-time. It can easily connect with your infrastructure to provide insights into how everything is working. In this guide, we'll show you how to use Datadog along with some helpful tools to monitor a Kubernetes cluster and create custom monitors and dashboards.</p>\n<p>We'll start by setting up a sample Nginx application on your Kubernetes cluster using <a href=\"https://helm.sh/\" target=\"_blank\" rel=\"noopener noreferrer\">Helm</a>. To make sure everything's running smoothly, we'll install the Datadog agent, which will send information about your cluster to your Datadog dashboard. This will help you keep track of what's happening in your cluster and plan your monitoring strategy. By the end of this tutorial, you'll also learn how to create a monitor specifically designed for your Kubernetes cluster using <a href=\"https://www.terraform.io/\" target=\"_blank\" rel=\"noopener noreferrer\">Terraform</a>.</p>\n<p>As your responsibilities grow and you manage many applications in production K8s clusters, especially with important applications, having a solid monitoring system is crucial. This system involves tracking performance, capturing logs, and tracing issues.</p>\n<p>In this blog, we'll guide you through the process of setting up a monitoring system, building a dashboard, and effectively managing your Kubernetes infrastructure (often referred to as K8s) using the versatile capabilities of Datadog.</p>\n<p><span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 74.11764705882352%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAIAAABr+ngCAAAACXBIWXMAAAsTAAALEwEAmpwYAAADBklEQVR42kVT2W4cRRRtvoOP4W94RhGveeQhEjJCKCQRCSYGO1YSx4k9A0jWBMsmeJzZPDOevWd6qe6u6qquXqp6X6Yp5wGOSvft6Nx7Th3p4LjVA8n5jOg42JZ5VhRJEkUhTRO/KFie86osq7LKy21elFWR1VVR11vxtttK+uLrk8+/8T67pz9o0TFCEFHmbwylockNfXPKcWfC1K63quH7zJ2McHRt+l3EO4gPbSZ9t3t6PKS7F8qtSg0H6jZ0sEVsxSPQp4C5xhqDuQM5VVwK5xqUDYiIYxFHRY70e/NPsUMacZsHD7U/drSTOE02sDcDLTtYlGLbLE8Wl0HndaoP67reOOHRPDjToigvpYfPGgoOJmugOO6OdvpAOxaXtdc7rwdf3pr74ro0L0L5Q9w/yM07surGL6a8sY7jvJJ+enbi+AGykMu9++qLe/JuGHLOAsaEYUVZ10xdBp1WMGjz9l/e6nZCvSVGc4ynmEo/PnkHHV+ckWaZEsA1s9OCNUf3X3a/ej/7tqi3zJTd7qvgphH33zF9NjDRtabfQCKTO/Ib23FXssxYkIZRFiY89KfgbGq2oDfPy8q1FvrF97j9Qw2aWRL9vZQ/LOU4F4HV0suDoyjOAICmSWybAgNZFkGmr8qOqbm6Tqi1sj7+hjvPM3AVxWlHEbloqfArz6W9J69CXBprMuuh1YgsB1C+geoS9y/BuG1Nu9CllAU0joIoCgjBxKGMC4Q8DKXHh7+uanJrL86t9pXVvbBvRhwMyWJfbr5RzprgHEKqLsQWvrqkyPQA0FVVhRAihKSn+3taYU+NVdccjdBsjOc6A8DeDJWridFbWkMhZYg/QQOEXUI93xdBfNLmXHr+6JDhcjEGs64xvrYcRan9cSJfVxePtu1f6v6R6qiXZq+PJ//AwdJR0igN78IUI5T2nh56hEPLNYBvwdDGnhcE1PMIdanvC6U4jrMsK0U9tlWapoz9J8yltwc/12U3getK+VgpnZSawvw4jKNIlEvMWBCEsdknJHeN+x//AoUKFwombGQaAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"Alt text\" title=\"\" src=\"/static/68e50298b63017fa73eb6e1401607a2b/c5bb3/dd.png\" srcset=\"/static/68e50298b63017fa73eb6e1401607a2b/04472/dd.png 170w,\n/static/68e50298b63017fa73eb6e1401607a2b/9f933/dd.png 340w,\n/static/68e50298b63017fa73eb6e1401607a2b/c5bb3/dd.png 680w,\n/static/68e50298b63017fa73eb6e1401607a2b/5a190/dd.png 800w\" sizes=\"(max-width: 680px) 100vw, 680px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n    </span>\n          </p>\n<h3 id=\"-prerequisites\" style=\"position:relative;\"><a href=\"#-prerequisites\" aria-label=\" prerequisites permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üìã Prerequisites</h3>\n<p>Before we dive into the tutorial, there are a few things you should have in place:</p>\n<ul>\n<li><strong>Familiarity with Terraform</strong>: This tutorial assumes you have a basic understanding of how Terraform works. If you're new to Terraform, it's a good idea to complete the <a href=\"https://learn.hashicorp.com/collections/terraform/getting-started\" target=\"_blank\" rel=\"noopener noreferrer\">Get Started tutorials</a> to get a grasp of the fundamentals.</li>\n<li><strong>Datadog Trial Account</strong>: You'll need access to a <a href=\"https://www.datadoghq.com/free-datadog-trial/\" target=\"_blank\" rel=\"noopener noreferrer\">Datadog trial account</a>. If you don't have one, you can sign up for a trial on the Datadog website.</li>\n<li><strong>Terraform Installed</strong>: Make sure you have <a href=\"https://learn.hashicorp.com/tutorials/terraform/install-cli\" target=\"_blank\" rel=\"noopener noreferrer\">Terraform installed</a> on your system.</li>\n<li><strong>EKS Cluster</strong>: You should have an Amazon Elastic Kubernetes Service (EKS) cluster set up and running. You can also visit <a href=\"https://eksworkshop.com\" target=\"_blank\" rel=\"noopener noreferrer\">EKS Workshop</a> to learn how to set up.</li>\n<li><strong>Helm</strong>: You should have <a href=\"https://helm.sh/\" target=\"_blank\" rel=\"noopener noreferrer\">Helm</a>, the Kubernetes package manager, installed.</li>\n<li><strong>Basic knowledge of K8s, Docker, and Datadog</strong>.</li>\n<li><strong>kubectl</strong>: to manage the K8s cluster.</li>\n</ul>\n<p>Having these prerequisites in place will ensure you can follow along with the tutorial smoothly.</p>\n<h2 id=\"-retrieve-datadog-api-credentials\" style=\"position:relative;\"><a href=\"#-retrieve-datadog-api-credentials\" aria-label=\" retrieve datadog api credentials permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üîë Retrieve Datadog API Credentials</h2>\n<p>After successfully registering for your Datadog trial, it's essential to obtain your <a href=\"https://docs.datadoghq.com/account_management/api-app-keys/#api-keys\" target=\"_blank\" rel=\"noopener noreferrer\">API</a> and <a href=\"https://docs.datadoghq.com/account_management/api-app-keys/#application-keys\" target=\"_blank\" rel=\"noopener noreferrer\">Application keys</a>.</p>\n<ol>\n<li>\n<p><strong>Access your Datadog account</strong> and go to the <strong>API Keys</strong> section located within the <strong>Organization Settings</strong> page.</p>\n<ul>\n<li>Your API key is generated automatically and is obscured for security purposes. To reveal more information about the API key, simply click on it, and then click on the <strong>Copy</strong> button. Make sure to securely save this information in a safe location.</li>\n</ul>\n<p><span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 40.588235294117645%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsTAAALEwEAmpwYAAABpklEQVR42m1Ra2/TQBDMn0Gpkya2z3e+hx9xRR4KRGoKKTRQBFKLIClYLY1TEAKpaj/0X093rxVCgg+j3dvzzc6MW79+XuPrlxrNpsG3i0tcXf3Attni/OIczfcGl5sN6rrG6vMK69X6H5ytzzxOT05we3OLVrgrEfZjOJcjVQZaW/R6IYKgi253Fx0C9zs7nT9otwN/J+IEUSQICZ4EEeYvXqOlZQ6ZpFBSP14KpKlBWVaI6QFDCPlfJPQuCkMU4wPM13f41JBCq0oopZHnJX2gvDpWORyOMCBS7hnGuIf62DOszXxldyq1OFoeo1UVIyI0NDDohwIhKYx5u0z9jJdI6iNSynd/g62yI3bR6XRxeEiWnR5A9HrQIvLoB22kRFAVAxS0OScFKS3QUiGJYsiYIuElRCKJjN1xRJzzgglz9xTTd1vsUwaT0xsMP/zGbG+E5WSMZ1mGoVIYG4OXFMG82sOsKDCl+cRYzKhaytDSYnayWLyiDElh+fwY0zc1qoOPcLP3yCiPPI6RiQSOFDkhfF8QeZY8zPxZSlgi0tr5H7s8eot7lMUYWjGpH6cAAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"API Key\" title=\"\" src=\"/static/b9b2d5fabc62aa1e82e0c6ab15e2009e/c5bb3/dd-keys.png\" srcset=\"/static/b9b2d5fabc62aa1e82e0c6ab15e2009e/04472/dd-keys.png 170w,\n/static/b9b2d5fabc62aa1e82e0c6ab15e2009e/9f933/dd-keys.png 340w,\n/static/b9b2d5fabc62aa1e82e0c6ab15e2009e/c5bb3/dd-keys.png 680w,\n/static/b9b2d5fabc62aa1e82e0c6ab15e2009e/5a190/dd-keys.png 800w\" sizes=\"(max-width: 680px) 100vw, 680px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n    </span>\n          </p>\n</li>\n<li>\n<p><strong>To generate an application key</strong>:</p>\n<ul>\n<li>Click the <strong>Application Keys</strong> on the <strong>Organization Settings</strong> page.</li>\n<li>Click <strong>New Key</strong>, type in <code class=\"language-text\">Terraform</code> as your new application key name, and click <strong>Create Key</strong>. Click <strong>Copy</strong> and save the key somewhere safe.</li>\n</ul>\n<p><span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 40.588235294117645%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsTAAALEwEAmpwYAAABoklEQVR42l2Qy3ISURRF+28g0O8H9NM0NKTBRwC10NIKJQ0GIxCcODcpLSf5DR36i8tzOzjAwa7d99w++6xztZ8/HlhVH7ndH9jv9hxuD6IvXG827A47trstm+sNyw/LE1XLivVqzUqpWrG4WnDz6TPas9GUZqNFmj4hCEK63QjLdGjrBoZhoYu3ztqcNVsnard0HMfDtl0c18f0EqK0QHs5mWPqtgSFmKaNZTn4foc0OydJMjpBt66p5v9liyzTopMOmN58Z7r8ivZ69hbTcI6E3TpUBcZxWtMG8q1CPaFwJeBEUnOOrkhVhvbuzUKKAWEY1yS6bgldTt4rCKO0fgZFYsggU+7/ea3jRo99BlGUoM1fvZeVLeIoIg4jmewSBR0m5YhenNBPM3LxQjz2fM7ln1TuM6HOhEiRqc3URjXh7HKO5YTE+QW2n6B7MZk0zpKIgWPTt0yG4uPAp/RcRr5H6bs8FXkyXJE2Gs36CerAarFmtrlj+/CH6v4Xi2+/Gc2uyLOMojc4qqDf6z96XhzPBXnep7wYMx4/ZzgseXE54S+4KBf9ysJ62wAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"Application Key\" title=\"\" src=\"/static/bfe0967ed26e403bfca24c6554543f91/c5bb3/app-key.png\" srcset=\"/static/bfe0967ed26e403bfca24c6554543f91/04472/app-key.png 170w,\n/static/bfe0967ed26e403bfca24c6554543f91/9f933/app-key.png 340w,\n/static/bfe0967ed26e403bfca24c6554543f91/c5bb3/app-key.png 680w,\n/static/bfe0967ed26e403bfca24c6554543f91/5a190/app-key.png 800w\" sizes=\"(max-width: 680px) 100vw, 680px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n    </span>\n          </p>\n</li>\n</ol>\n<p>üö® <strong>Important</strong>: These keys serve as the credentials that Terraform will use to create monitors and dashboards on your behalf. When used together, they grant complete access to your Datadog account, so it's crucial to handle them with the same level of security as you would a password. <strong>Never share or commit them to version control systems</strong>.</p>\n<h2 id=\"Ô∏è-hands-on-setting-up-the-environment\" style=\"position:relative;\"><a href=\"#%EF%B8%8F-hands-on-setting-up-the-environment\" aria-label=\"Ô∏è hands on setting up the environment permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üõ†Ô∏è Hands-on: Setting Up the Environment</h2>\n<h3 id=\"-clone-the-example-repository\" style=\"position:relative;\"><a href=\"#-clone-the-example-repository\" aria-label=\" clone the example repository permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>‚úÖ Clone the Example Repository</h3>\n<p>To begin, make sure you're not currently within the <code class=\"language-text\">demo-terraform-k8s-datadog</code> directory created in the EKS cluster tutorial. Next, clone the configuration specific to this tutorial using the following command:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">git</span> clone https://github.com/seifrajhi/demo-terraform-k8s-datadog.git</code></pre></div>\n<h3 id=\"-navigate-to-the-repository-directory\" style=\"position:relative;\"><a href=\"#-navigate-to-the-repository-directory\" aria-label=\" navigate to the repository directory permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>‚úÖ Navigate to the Repository Directory</h3>\n<p>After cloning the repository, change your working directory to the newly created <code class=\"language-text\">demo-terraform-k8s-datadog</code> folder using:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token builtin class-name\">cd</span> demo-terraform-k8s-datadog</code></pre></div>\n<h3 id=\"-deploy-your-kubernetes-application\" style=\"position:relative;\"><a href=\"#-deploy-your-kubernetes-application\" aria-label=\" deploy your kubernetes application permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>‚úÖ Deploy Your Kubernetes Application</h3>\n<p>Open the <code class=\"language-text\">terraform.tf</code> configuration file. This file contains information about the minimum versions required for Datadog, Helm, AWS, Kubernetes providers, and Terraform itself.</p>\n<h3 id=\"-edit-the-code-classlanguage-textkubernetestfcode-file\" style=\"position:relative;\"><a href=\"#-edit-the-code-classlanguage-textkubernetestfcode-file\" aria-label=\" edit the code classlanguage textkubernetestfcode file permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>‚úÖ Edit the <code class=\"language-text\">kubernetes.tf</code> File</h3>\n<p>Within your file editor, open the <code class=\"language-text\">kubernetes.tf</code> file. This tutorial will guide you through the configuration blocks step by step.</p>\n<h3 id=\"-define-the-kubernetes-namespace\" style=\"position:relative;\"><a href=\"#-define-the-kubernetes-namespace\" aria-label=\" define the kubernetes namespace permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>‚úÖ Define the Kubernetes Namespace</h3>\n<p>In the <code class=\"language-text\">kubernetes_namespace</code> block, specify the new namespace you want to create. This namespace will be named after the demo image, and it will be used throughout the rest of the tutorial.</p>\n<p>Notice that the Terraform Kubernetes provider is authenticated using the cluster name provided by the <code class=\"language-text\">demo-terraform-k8s-datadog</code> directory.</p>\n<p>As you can find below, the <code class=\"language-text\">kubernetes_deployment</code> block specifies various aspects, such as the cluster's node count, metadata assignments, and the container image definition. In this setup, it deploys an image named <code class=\"language-text\">demo:datadog</code> which has been specially crafted for use within this tutorial.</p>\n<div class=\"gatsby-highlight\" data-language=\"hcl\"><pre class=\"language-hcl\"><code class=\"language-hcl\"><span class=\"token keyword\">resource <span class=\"token type variable\">\"kubernetes_deployment\"</span></span> <span class=\"token string\">\"demo\"</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">metadata</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token property\">name</span>      <span class=\"token punctuation\">=</span> var.application_name\n        <span class=\"token property\">namespace</span> <span class=\"token punctuation\">=</span> kubernetes_namespace.demo.id\n        <span class=\"token property\">labels</span> <span class=\"token punctuation\">=</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token property\">app</span> <span class=\"token punctuation\">=</span> var.application_name\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">spec</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token property\">replicas</span> <span class=\"token punctuation\">=</span> <span class=\"token number\">3</span>\n\n        <span class=\"token keyword\">selector</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token property\">match_labels</span> <span class=\"token punctuation\">=</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token property\">app</span> <span class=\"token punctuation\">=</span> var.application_name\n            <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span>\n\n        <span class=\"token keyword\">template</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">metadata</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token property\">labels</span> <span class=\"token punctuation\">=</span> <span class=\"token punctuation\">{</span>\n                    <span class=\"token property\">app</span> <span class=\"token punctuation\">=</span> var.application_name\n                <span class=\"token punctuation\">}</span>\n            <span class=\"token punctuation\">}</span>\n\n            <span class=\"token keyword\">spec</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token keyword\">container</span> <span class=\"token punctuation\">{</span>\n                    <span class=\"token property\">image</span> <span class=\"token punctuation\">=</span> <span class=\"token string\">\"rajhisaifeddine/demo:datadog\"</span>\n                    <span class=\"token property\">name</span>  <span class=\"token punctuation\">=</span> var.application_name\n                <span class=\"token punctuation\">}</span>\n            <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>We also have the <code class=\"language-text\">kubernetes_service</code> resource which exposes the demo service using a load balancer on port 8080.</p>\n<div class=\"gatsby-highlight\" data-language=\"hcl\"><pre class=\"language-hcl\"><code class=\"language-hcl\"><span class=\"token keyword\">resource <span class=\"token type variable\">\"kubernetes_service\"</span></span> <span class=\"token string\">\"demo\"</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">metadata</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token property\">name</span>      <span class=\"token punctuation\">=</span> var.application_name\n        <span class=\"token property\">namespace</span> <span class=\"token punctuation\">=</span> kubernetes_namespace.demo.id\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">spec</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token property\">selector</span> <span class=\"token punctuation\">=</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token property\">app</span> <span class=\"token punctuation\">=</span> kubernetes_deployment.demo.metadata<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span>.labels.app\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token keyword\">port</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token property\">port</span>        <span class=\"token punctuation\">=</span> <span class=\"token number\">8080</span>\n            <span class=\"token property\">target_port</span> <span class=\"token punctuation\">=</span> <span class=\"token number\">80</span>\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token property\">type</span> <span class=\"token punctuation\">=</span> <span class=\"token string\">\"LoadBalancer\"</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>The <code class=\"language-text\">application_name</code> variable is defined in the <code class=\"language-text\">variables.tf</code> file and is set to a default value of <code class=\"language-text\">demo</code>.</p>\n<p>Now that you have reviewed the infrastructure, initialize and apply your configuration.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">terraform init\nterraform apply</code></pre></div>\n<p>Verify the namespace.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">kubectl get namespaces</code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"plaintext\"><pre class=\"language-plaintext\"><code class=\"language-plaintext\">NAME              STATUS        AGE\ndemo              Active        3m</code></pre></div>\n<p>Check if the deployment is created.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">kubectl get deployment <span class=\"token parameter variable\">--namespace</span><span class=\"token operator\">=</span>demo</code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"plaintext\"><pre class=\"language-plaintext\"><code class=\"language-plaintext\">NAME        READY    UP-TO-DATE     AVAILABLE           AGE\ndemo        3/3      3              3                   5m</code></pre></div>\n<p>In the next step, you will deploy the Datadog Agent to your Kubernetes cluster as a DaemonSet in order to start collecting your cluster and application metrics, traces, and logs. To do this, you will use the Helm provider to deploy the <a href=\"https://github.com/DataDog/helm-charts/tree/main/charts/datadog\" target=\"_blank\" rel=\"noopener noreferrer\">Datadog Helm chart</a>.</p>\n<h2 id=\"-deploy-the-datadog-agent-to-your-nodes\" style=\"position:relative;\"><a href=\"#-deploy-the-datadog-agent-to-your-nodes\" aria-label=\" deploy the datadog agent to your nodes permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üè¥ Deploy the Datadog Agent to Your Nodes</h2>\n<h3 id=\"using-helm\" style=\"position:relative;\"><a href=\"#using-helm\" aria-label=\"using helm permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Using Helm</h3>\n<p>Now, proceed to deploy the Datadog Helm chart. This chart will install the Datadog Agent on all nodes within your cluster by utilizing a DaemonSet.</p>\n<div class=\"gatsby-highlight\" data-language=\"hcl\"><pre class=\"language-hcl\"><code class=\"language-hcl\"><span class=\"token keyword\">provider<span class=\"token type variable\"> \"helm\" </span></span><span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">kubernetes</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token property\">config_path</span> <span class=\"token punctuation\">=</span> <span class=\"token string\">\"~/.kube/config\"</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">resource <span class=\"token type variable\">\"helm_release\"</span></span> <span class=\"token string\">\"datadog_agent\"</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">name</span>       <span class=\"token punctuation\">=</span> <span class=\"token string\">\"datadog-agent\"</span>\n    <span class=\"token property\">chart</span>      <span class=\"token punctuation\">=</span> <span class=\"token string\">\"datadog\"</span>\n    <span class=\"token property\">repository</span> <span class=\"token punctuation\">=</span> <span class=\"token string\">\"https://helm.datadoghq.com\"</span>\n    <span class=\"token property\">version</span>    <span class=\"token punctuation\">=</span> <span class=\"token string\">\"3.10.9\"</span>\n    <span class=\"token property\">namespace</span>  <span class=\"token punctuation\">=</span> kubernetes_namespace.demo.id\n\n    <span class=\"token keyword\">set_sensitive</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token property\">name</span>  <span class=\"token punctuation\">=</span> <span class=\"token string\">\"datadog.apiKey\"</span>\n        <span class=\"token property\">value</span> <span class=\"token punctuation\">=</span> var.datadog_api_key\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">set</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token property\">name</span>  <span class=\"token punctuation\">=</span> <span class=\"token string\">\"datadog.site\"</span>\n        <span class=\"token property\">value</span> <span class=\"token punctuation\">=</span> var.datadog_site\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">set</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token property\">name</span>  <span class=\"token punctuation\">=</span> <span class=\"token string\">\"datadog.logs.enabled\"</span>\n        <span class=\"token property\">value</span> <span class=\"token punctuation\">=</span> <span class=\"token boolean\">true</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">set</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token property\">name</span>  <span class=\"token punctuation\">=</span> <span class=\"token string\">\"datadog.logs.containerCollectAll\"</span>\n        <span class=\"token property\">value</span> <span class=\"token punctuation\">=</span> <span class=\"token boolean\">true</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">set</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token property\">name</span>  <span class=\"token punctuation\">=</span> <span class=\"token string\">\"datadog.leaderElection\"</span>\n        <span class=\"token property\">value</span> <span class=\"token punctuation\">=</span> <span class=\"token boolean\">true</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">set</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token property\">name</span>  <span class=\"token punctuation\">=</span> <span class=\"token string\">\"datadog.collectEvents\"</span>\n        <span class=\"token property\">value</span> <span class=\"token punctuation\">=</span> <span class=\"token boolean\">true</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">set</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token property\">name</span>  <span class=\"token punctuation\">=</span> <span class=\"token string\">\"clusterAgent.enabled\"</span>\n        <span class=\"token property\">value</span> <span class=\"token punctuation\">=</span> <span class=\"token boolean\">true</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">set</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token property\">name</span>  <span class=\"token punctuation\">=</span> <span class=\"token string\">\"clusterAgent.metricsProvider.enabled\"</span>\n        <span class=\"token property\">value</span> <span class=\"token punctuation\">=</span> <span class=\"token boolean\">true</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">set</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token property\">name</span>  <span class=\"token punctuation\">=</span> <span class=\"token string\">\"networkMonitoring.enabled\"</span>\n        <span class=\"token property\">value</span> <span class=\"token punctuation\">=</span> <span class=\"token boolean\">true</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">set</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token property\">name</span>  <span class=\"token punctuation\">=</span> <span class=\"token string\">\"systemProbe.enableTCPQueueLength\"</span>\n        <span class=\"token property\">value</span> <span class=\"token punctuation\">=</span> <span class=\"token boolean\">true</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">set</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token property\">name</span>  <span class=\"token punctuation\">=</span> <span class=\"token string\">\"systemProbe.enableOOMKill\"</span>\n        <span class=\"token property\">value</span> <span class=\"token punctuation\">=</span> <span class=\"token boolean\">true</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">set</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token property\">name</span>  <span class=\"token punctuation\">=</span> <span class=\"token string\">\"securityAgent.runtime.enabled\"</span>\n        <span class=\"token property\">value</span> <span class=\"token punctuation\">=</span> <span class=\"token boolean\">true</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">set</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token property\">name</span>  <span class=\"token punctuation\">=</span> <span class=\"token string\">\"datadog.hostVolumeMountPropagation\"</span>\n        <span class=\"token property\">value</span> <span class=\"token punctuation\">=</span> <span class=\"token string\">\"HostToContainer\"</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>This Helm configuration requires your Datadog API and application keys. Set these values as environment variables in your terminal.</p>\n<p>Run the following command, replacing <code class=\"language-text\">&lt;Your-API-Key></code> with your Datadog API key and <code class=\"language-text\">&lt;Your-App-Key></code> with your Datadog application key you saved earlier.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token builtin class-name\">export</span> <span class=\"token assign-left variable\">TF_VAR_datadog_api_key</span><span class=\"token operator\">=</span><span class=\"token string\">\"&lt;Your-API-Key>\"</span>\n<span class=\"token builtin class-name\">export</span> <span class=\"token assign-left variable\">TF_VAR_datadog_app_key</span><span class=\"token operator\">=</span><span class=\"token string\">\"&lt;Your-App-Key>\"</span></code></pre></div>\n<p>Note the URL of the Datadog website and refer to the <a href=\"https://docs.datadoghq.com/getting_started/site/\" target=\"_blank\" rel=\"noopener noreferrer\">Getting Started with Datadog Sites</a> documentation to determine the correct values for the <code class=\"language-text\">datadog_site</code> and <code class=\"language-text\">datadog_api_url</code> variables. This tutorial defaults to using values for site EU1.</p>\n<p>If you are on a different site, set the <code class=\"language-text\">datadog_site</code> and <code class=\"language-text\">datadog_api_url</code> to the values in the Datadog documentation.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token builtin class-name\">export</span> <span class=\"token assign-left variable\">TF_VAR_datadog_site</span><span class=\"token operator\">=</span><span class=\"token string\">\"datadoghq.eu\"</span>\n<span class=\"token builtin class-name\">export</span> <span class=\"token assign-left variable\">TF_VAR_datadog_api_url</span><span class=\"token operator\">=</span><span class=\"token string\">\"https://api.datadoghq.eu\"</span></code></pre></div>\n<p>Insert your Datadog key values into the <code class=\"language-text\">variables.tf</code> file. Terraform will then assign these environment variable values to their respective variable declarations.</p>\n<div class=\"gatsby-highlight\" data-language=\"hcl\"><pre class=\"language-hcl\"><code class=\"language-hcl\"><span class=\"token keyword\">variable<span class=\"token type variable\"> \"datadog_api_key\" </span></span><span class=\"token punctuation\">{</span>\n    <span class=\"token property\">type</span>        <span class=\"token punctuation\">=</span> string\n    <span class=\"token property\">description</span> <span class=\"token punctuation\">=</span> <span class=\"token string\">\"Datadog API Key\"</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">variable<span class=\"token type variable\"> \"datadog_app_key\" </span></span><span class=\"token punctuation\">{</span>\n    <span class=\"token property\">type</span>        <span class=\"token punctuation\">=</span> string\n    <span class=\"token property\">description</span> <span class=\"token punctuation\">=</span> <span class=\"token string\">\"Datadog Application Key\"</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">variable<span class=\"token type variable\"> \"datadog_site\" </span></span><span class=\"token punctuation\">{</span>\n    <span class=\"token property\">type</span>        <span class=\"token punctuation\">=</span> string\n    <span class=\"token property\">description</span> <span class=\"token punctuation\">=</span> <span class=\"token string\">\"Datadog Site Parameter\"</span>\n    <span class=\"token property\">default</span>     <span class=\"token punctuation\">=</span> <span class=\"token string\">\"datadoghq.eu\"</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">variable<span class=\"token type variable\"> \"datadog_api_url\" </span></span><span class=\"token punctuation\">{</span>\n    <span class=\"token property\">type</span>        <span class=\"token punctuation\">=</span> string\n    <span class=\"token property\">description</span> <span class=\"token punctuation\">=</span> <span class=\"token string\">\"Datadog API URL\"</span>\n    <span class=\"token property\">default</span>     <span class=\"token punctuation\">=</span> <span class=\"token string\">\"https://api.datadoghq.eu\"</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Then, apply your configuration.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">terraform apply</code></pre></div>\n<p>You can then see that Datadog has been deployed with 3 main components:</p>\n<ol>\n<li><strong>Datadog Agent DaemonSet</strong>.</li>\n<li><strong>Datadog Cluster-Agent</strong>.</li>\n<li><strong>Datadog Kube-state-metrics (KSM)</strong>: Which is a simple service that listens to the Kubernetes API server and generates metrics about the state of the objects: node status, node capacity (CPU and memory), number of desired/available/unavailable/updated replicas per Deployment, pod status (e.g., waiting, running, ready), and so on.</li>\n</ol>\n<p>To understand about DataDog agents and cluster-agent, let me explain DataDog designs, which can be found in <a href=\"https://www.datadoghq.com/blog/datadog-cluster-agent/\" target=\"_blank\" rel=\"noopener noreferrer\">their official docs.</a></p>\n<p><span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 77.64705882352942%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAQABQDASIAAhEBAxEB/8QAGAAAAwEBAAAAAAAAAAAAAAAAAAEDBAX/xAAUAQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIQAxAAAAHtqSNBIP/EABgQAAMBAQAAAAAAAAAAAAAAAAABISIC/9oACAEBAAEFAqUps0ku0z//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/AT//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/AT//xAAcEAABAwUAAAAAAAAAAAAAAAAAARARISIygaH/2gAIAQEABj8CfHpckbKH/8QAGhAAAwEAAwAAAAAAAAAAAAAAAAERIVFhof/aAAgBAQABPyF8TAglMktsufqhFrxn/9oADAMBAAIAAwAAABAwD//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8QP//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8QP//EABwQAQACAgMBAAAAAAAAAAAAAAEAESFhMUFRwf/aAAgBAQABPxD2O7uCyDR055grlV1ApBhzn8lLBotLt+BcuyoY4utk/9k='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"Alt tetx\" title=\"\" src=\"/static/11ff3b13cfe6904d33a820fff8cd96dc/7bf67/dd-agent.jpg\" srcset=\"/static/11ff3b13cfe6904d33a820fff8cd96dc/651be/dd-agent.jpg 170w,\n/static/11ff3b13cfe6904d33a820fff8cd96dc/d30a3/dd-agent.jpg 340w,\n/static/11ff3b13cfe6904d33a820fff8cd96dc/7bf67/dd-agent.jpg 680w,\n/static/11ff3b13cfe6904d33a820fff8cd96dc/4b190/dd-agent.jpg 800w\" sizes=\"(max-width: 680px) 100vw, 680px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n    </span>\n          </p>\n<h2 id=\"Ô∏è-datadog-cluster-agent-main-features\" style=\"position:relative;\"><a href=\"#%EF%B8%8F-datadog-cluster-agent-main-features\" aria-label=\"Ô∏è datadog cluster agent main features permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üè∑Ô∏è DataDog Cluster Agent Main Features</h2>\n<ul>\n<li><strong>Streamlined Data Collection</strong>: Provides a centralized approach to collecting cluster-level monitoring data.</li>\n<li><strong>Server Load Alleviation</strong>: Acts as a proxy between the API server and node-based Agents, helping to reduce server load.</li>\n<li><strong>Enhanced Metadata</strong>: Relays cluster-level metadata to node-based Agents, allowing them to enrich the metadata of locally collected metrics.</li>\n</ul>\n<h3 id=\"benefits-of-using-the-datadog-cluster-agent\" style=\"position:relative;\"><a href=\"#benefits-of-using-the-datadog-cluster-agent\" aria-label=\"benefits of using the datadog cluster agent permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Benefits of Using the Datadog Cluster Agent</h3>\n<ul>\n<li><strong>Infrastructure Impact Reduction</strong>: Alleviates the impact of Agents on your infrastructure.</li>\n<li><strong>Node Isolation</strong>: Isolates node-based Agents to their respective nodes, reducing RBAC rules to solely read metrics and metadata from the kubelet.</li>\n<li><strong>Cluster-Level Metadata</strong>: Provides cluster-level metadata that can only be found in the API server to the Node Agents, enriching the metadata of the locally collected metrics.</li>\n<li><strong>Cluster-Level Data Collection</strong>: Enables the collection of cluster-level data, such as the monitoring of services or SPOF and events.</li>\n<li><strong>Horizontal Pod Autoscaling</strong>: Leverages Horizontal Pod Autoscaling (HPA) with custom Kubernetes metrics.</li>\n</ul>\n<p>With this setup, the DataDog agent doesn't need to elect a leader pod, and the cluster agent will handle the K8s events collection. The DataDog cluster-agent also provides an <a href=\"https://www.datadoghq.com/blog/autoscale-kubernetes-datadog/\" target=\"_blank\" rel=\"noopener noreferrer\">External Metrics Provider</a> to define HPA based on DataDog metrics (not limited to only CPU/Memory utilization).</p>\n<h2 id=\"-create-a-metric-alert-with-the-datadog-provider\" style=\"position:relative;\"><a href=\"#-create-a-metric-alert-with-the-datadog-provider\" aria-label=\" create a metric alert with the datadog provider permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üìä Create a Metric Alert with the Datadog Provider</h2>\n<p>The <a href=\"https://registry.terraform.io/providers/DataDog/datadog/latest/docs/resources/monitor\" target=\"_blank\" rel=\"noopener noreferrer\">datadog_monitor resource</a> will report threshold errors in the Kubernetes pods and notify if any pods go down. Copy and paste the configuration below to <code class=\"language-text\">datadog_metrics.tf</code>.</p>\n<div class=\"gatsby-highlight\" data-language=\"hcl\"><pre class=\"language-hcl\"><code class=\"language-hcl\"><span class=\"token keyword\">provider<span class=\"token type variable\"> \"datadog\" </span></span><span class=\"token punctuation\">{</span>\n    <span class=\"token property\">api_key</span> <span class=\"token punctuation\">=</span> var.datadog_api_key\n    <span class=\"token property\">app_key</span> <span class=\"token punctuation\">=</span> var.datadog_app_key\n    <span class=\"token property\">api_url</span> <span class=\"token punctuation\">=</span> var.datadog_api_url\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">resource <span class=\"token type variable\">\"datadog_monitor\"</span></span> <span class=\"token string\">\"demo\"</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">name</span>               <span class=\"token punctuation\">=</span> <span class=\"token string\">\"Kubernetes Pod Health\"</span>\n    <span class=\"token property\">type</span>               <span class=\"token punctuation\">=</span> <span class=\"token string\">\"metric alert\"</span>\n    <span class=\"token property\">message</span>            <span class=\"token punctuation\">=</span> <span class=\"token string\">\"Kubernetes Pods are not in an optimal health state. Notify: @operator\"</span>\n    <span class=\"token property\">escalation_message</span> <span class=\"token punctuation\">=</span> <span class=\"token string\">\"Please investigate the Kubernetes Pods, @operator\"</span>\n\n    <span class=\"token property\">query</span> <span class=\"token punctuation\">=</span> <span class=\"token string\">\"max(last_1m):sum:kubernetes.containers.running{short_image:beacon} &lt;= 1\"</span>\n\n    <span class=\"token keyword\">monitor_thresholds</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token property\">ok</span>       <span class=\"token punctuation\">=</span> <span class=\"token number\">3</span>\n        <span class=\"token property\">warning</span>  <span class=\"token punctuation\">=</span> <span class=\"token number\">2</span>\n        <span class=\"token property\">critical</span> <span class=\"token punctuation\">=</span> <span class=\"token number\">1</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token property\">notify_no_data</span> <span class=\"token punctuation\">=</span> <span class=\"token boolean\">true</span>\n\n    <span class=\"token property\">tags</span> <span class=\"token punctuation\">=</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"app:demo\"</span>, <span class=\"token string\">\"env:demo\"</span><span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>The <code class=\"language-text\">datadog_monitor.demo</code> resource notifies and escalates the health of the Kubernetes \"beacon\" application. The <code class=\"language-text\">query</code> argument is how Datadog communicates with the pods.</p>\n<ul>\n<li>If all three pods are operational, your Datadog monitor status report is \"OK\".</li>\n<li>If any pods go down, your Datadog monitor status will change to \"Warn\".</li>\n<li>If more than one pod goes down, your Datadog monitor status will change to \"Alert\".</li>\n</ul>\n<p>Apply your configuration to create a new Datadog monitor.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">terraform apply</code></pre></div>\n<p>Navigate to the <a href=\"https://app.datadoghq.com/monitors/manage\" target=\"_blank\" rel=\"noopener noreferrer\">Datadog Monitor page</a>. Your Kubernetes Pod Health monitor is reporting here now.</p>\n<p><span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 75.29411764705883%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAIAAABr+ngCAAAACXBIWXMAAAsTAAALEwEAmpwYAAABqklEQVR42pWSy3LUMBBF/QlJkQzxQ89WS/JD0ozt8QwmyTop2LDiK1jy/7THMBkoCpKqu2iX6nTf7utsF/cxpnEYx36YP3w87I/T8TDOUz/0oQ3OOu/8hZyvm93D0+7xU394zG6ucqEbwLZpYu1ba/w4TEoBq4QUmsSZpPqnSiYkjl++TV+/bx8+Z5vrwvqQxvu6GwRXaJzRqCSARouePlf+QqLc3Obvrj26jJegpLYGERC0oVpwzQVwrrQyWgJ1lAJWF2uhFAoBTR2y6k7ShGl/ADAEGzBKWykbKWwMydmaXBCzNFJ4KvBU6AXmBYhKDjEJocuCLXO42j4fmzlZ7Yxxu+1gjUNjQ0i00bo8wV0bM5YrOk/XBf3rSILTYBQIVc4Yk+ez0Ubk4ry8kmaBLbrQRSWVOa1ND4RVBV+HVCUnXRar6DRZseHUmCw1vqULe1uT8+WZiZeE/qYFru4UmQldQnBUuDNcvQIu39N2NsUtGQZN8cJvf8V/YVA4z/cUGK305y/1bzi/5ZTh0O/J85thlmu6E8HUYo3qTbaXqFJMlBMJDVLOr4R/AARleIvZOAyWAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"Alt text\" title=\"\" src=\"/static/8e010958f7383382f6372799158f4d64/c5bb3/monitor.png\" srcset=\"/static/8e010958f7383382f6372799158f4d64/04472/monitor.png 170w,\n/static/8e010958f7383382f6372799158f4d64/9f933/monitor.png 340w,\n/static/8e010958f7383382f6372799158f4d64/c5bb3/monitor.png 680w,\n/static/8e010958f7383382f6372799158f4d64/5a190/monitor.png 800w\" sizes=\"(max-width: 680px) 100vw, 680px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n    </span>\n          </p>\n<h2 id=\"datadog-events\" style=\"position:relative;\"><a href=\"#datadog-events\" aria-label=\"datadog events permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>DataDog Events</h2>\n<p>In this setup, we have already enabled the <a href=\"https://docs.datadoghq.com/containers/kubernetes/configuration/?tab=datadogoperator#enable-kubernetes-event-collection\" target=\"_blank\" rel=\"noopener noreferrer\">K8s Event Collection</a> by setting the <code class=\"language-text\">datadog.leaderElection</code>, <code class=\"language-text\">datadog.collectEvents</code>, and <code class=\"language-text\">agents.rbac.create</code> options to true in the <code class=\"language-text\">values.yaml</code> file.</p>\n<p>This feature instructs the DataDog Cluster Agent to collect the K8s events from the Control Plane and forward them to DataDog. You can easily check what happens to your clusters, why a pod can't be scheduled, or troubleshoot a BackOff container without needing to use <code class=\"language-text\">kubectl get events</code> or <code class=\"language-text\">kubectl describe nodes|pods</code>.</p>\n<p><span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 39.411764705882355%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAIABQDASIAAhEBAxEB/8QAFgABAQEAAAAAAAAAAAAAAAAAAAIF/8QAFAEBAAAAAAAAAAAAAAAAAAAAAP/aAAwDAQACEAMQAAAByQSD/8QAFRABAQAAAAAAAAAAAAAAAAAAARD/2gAIAQEAAQUCL//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8BP//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8BP//EABQQAQAAAAAAAAAAAAAAAAAAABD/2gAIAQEABj8Cf//EABgQAAMBAQAAAAAAAAAAAAAAAAABESFB/9oACAEBAAE/IYdHnCn/2gAMAwEAAgADAAAAEIvv/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPxA//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPxA//8QAGxABAAICAwAAAAAAAAAAAAAAAQARIUFRcZH/2gAIAQEAAT8QACsjvMpq8ieK6an/2Q=='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"Alt text\" title=\"\" src=\"/static/29fb4876e18197f30b5365a0c335a941/7bf67/events.jpg\" srcset=\"/static/29fb4876e18197f30b5365a0c335a941/651be/events.jpg 170w,\n/static/29fb4876e18197f30b5365a0c335a941/d30a3/events.jpg 340w,\n/static/29fb4876e18197f30b5365a0c335a941/7bf67/events.jpg 680w,\n/static/29fb4876e18197f30b5365a0c335a941/4b190/events.jpg 800w\" sizes=\"(max-width: 680px) 100vw, 680px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n    </span>\n          </p>\n<p>We can easily create dashboards or monitors to watch and notify any K8s events in nearly real-time.</p>\n<h2 id=\"Ô∏è-dashboards\" style=\"position:relative;\"><a href=\"#%EF%B8%8F-dashboards\" aria-label=\"Ô∏è dashboards permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üñºÔ∏è Dashboards</h2>\n<p>The Datadog dashboard is an easily accessible dashboard for your monitors in the Datadog UI, which is useful if you have several monitors and need to group them together for visibility. This configuration contains the dashboard setup for your metrics and synthetics monitors with the <code class=\"language-text\">datadog_dashboard</code> resource.</p>\n<h3 id=\"-types-of-metrics\" style=\"position:relative;\"><a href=\"#-types-of-metrics\" aria-label=\" types of metrics permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üìä Types of Metrics</h3>\n<ul>\n<li><strong>Cloud/Cluster Infrastructure Metrics</strong>: EC2, RDS, ElastiCache, etc.</li>\n<li><strong>System Metrics</strong>: OS, CPU, Memory, Disk IOps, Network bandwidth, etc.</li>\n<li><strong>Orchestration (K8s) Metrics</strong>: Node status, deployments/replicaSet/statefulSet, pods (CPU/Mem), PVC size, etc.</li>\n<li><strong>Application Metrics</strong>: HTTP response time, Kafka consumer lag, JVM Heap, Logstash events, Spark job metrics, etc.</li>\n</ul>\n<h3 id=\"-example-dashboard\" style=\"position:relative;\"><a href=\"#-example-dashboard\" aria-label=\" example dashboard permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üìà Example Dashboard</h3>\n<p>An example dashboard I created which provides an overview for all running EKS clusters:</p>\n<p><span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 55.294117647058826%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAALABQDASIAAhEBAxEB/8QAGAAAAgMAAAAAAAAAAAAAAAAAAAUCAwT/xAAVAQEBAAAAAAAAAAAAAAAAAAABAv/aAAwDAQACEAMQAAABUWbF5IRGv//EABkQAQADAQEAAAAAAAAAAAAAAAEAAhEQE//aAAgBAQABBQKNXXSWDy5//8QAFREBAQAAAAAAAAAAAAAAAAAAARD/2gAIAQMBAT8BGf/EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8BP//EABgQAAIDAAAAAAAAAAAAAAAAAAAhARBB/9oACAEBAAY/AjRkq//EABoQAAICAwAAAAAAAAAAAAAAAAERACEQUXH/2gAIAQEAAT8hcEAAW3GVQxiR8z//2gAMAwEAAgADAAAAEA/v/8QAFxEAAwEAAAAAAAAAAAAAAAAAARARUf/aAAgBAwEBPxClGL//xAAWEQEBAQAAAAAAAAAAAAAAAAABEBH/2gAIAQIBAT8QHZ//xAAbEAEAAgMBAQAAAAAAAAAAAAABABEhMVFBcf/aAAgBAQABPxC+hb+yxEHgM7xUGRcLhDDQyC9diUx3P//Z'); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"Cluster Metrics\" title=\"\" src=\"/static/52bf492e3e452d37aa0012bfb1768437/7bf67/dash1.jpg\" srcset=\"/static/52bf492e3e452d37aa0012bfb1768437/651be/dash1.jpg 170w,\n/static/52bf492e3e452d37aa0012bfb1768437/d30a3/dash1.jpg 340w,\n/static/52bf492e3e452d37aa0012bfb1768437/7bf67/dash1.jpg 680w,\n/static/52bf492e3e452d37aa0012bfb1768437/4b190/dash1.jpg 800w\" sizes=\"(max-width: 680px) 100vw, 680px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n    </span>\n          \n<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 30%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAGABQDASIAAhEBAxEB/8QAFgABAQEAAAAAAAAAAAAAAAAAAAUD/8QAFgEBAQEAAAAAAAAAAAAAAAAAAwEC/9oADAMBAAIQAxAAAAGZRMHmIX//xAAYEAACAwAAAAAAAAAAAAAAAAAAAgExMv/aAAgBAQABBQJdSNf/xAAXEQADAQAAAAAAAAAAAAAAAAAAAQIR/9oACAEDAQE/Abpo0//EABURAQEAAAAAAAAAAAAAAAAAAAIQ/9oACAECAQE/AVP/xAAYEAADAQEAAAAAAAAAAAAAAAAAAZExQf/aAAgBAQAGPwJCyHIf/8QAGBAAAwEBAAAAAAAAAAAAAAAAAAEhQVH/2gAIAQEAAT8hfNR8HsGhP//aAAwDAQACAAMAAAAQC+//xAAXEQADAQAAAAAAAAAAAAAAAAAAAREh/9oACAEDAQE/EMBMo//EABYRAQEBAAAAAAAAAAAAAAAAABEAAf/aAAgBAgEBPxDGLN//xAAdEAEAAgICAwAAAAAAAAAAAAABESEAMUFxYYHB/9oACAEBAAE/EEnhh7dnOed7om/d4Yg0Ion3P//Z'); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"Cluster Metrics\" title=\"\" src=\"/static/fc57a364ceff24d039ca4cc84cef2d58/7bf67/dash2.jpg\" srcset=\"/static/fc57a364ceff24d039ca4cc84cef2d58/651be/dash2.jpg 170w,\n/static/fc57a364ceff24d039ca4cc84cef2d58/d30a3/dash2.jpg 340w,\n/static/fc57a364ceff24d039ca4cc84cef2d58/7bf67/dash2.jpg 680w,\n/static/fc57a364ceff24d039ca4cc84cef2d58/4b190/dash2.jpg 800w\" sizes=\"(max-width: 680px) 100vw, 680px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n    </span>\n          </p>\n<p>Cluster-metrics graphs</p>\n<p>Datadog supports configuring template variables to quickly filter or query metrics from specific tags or attributes, e.g., subaccount (AWS accounts), k8s_cluster (K8s cluster names), k8s_node (EC2 Worker nodes), k8s_namespace, k8s_deployment, k8s_daemonset, and so on.</p>\n<p><span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 75.29411764705883%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAPABQDASIAAhEBAxEB/8QAFwABAQEBAAAAAAAAAAAAAAAAAAECBf/EABQBAQAAAAAAAAAAAAAAAAAAAAD/2gAMAwEAAhADEAAAAeSuQg//xAAXEAADAQAAAAAAAAAAAAAAAAABEBFB/9oACAEBAAEFAsQFf//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8BP//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8BP//EABQQAQAAAAAAAAAAAAAAAAAAACD/2gAIAQEABj8CX//EABcQAQEBAQAAAAAAAAAAAAAAAAEAEBH/2gAIAQEAAT8hjiDgTn//2gAMAwEAAgADAAAAEBjv/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPxA//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPxA//8QAGhABAAMBAQEAAAAAAAAAAAAAAQARITFBUf/aAAgBAQABPxC3V+zFc58hs2IVoiFx8qE//9k='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"Template Variables\" title=\"\" src=\"/static/bcab26624c591d9fe214197d07d56be9/7bf67/vars.jpg\" srcset=\"/static/bcab26624c591d9fe214197d07d56be9/651be/vars.jpg 170w,\n/static/bcab26624c591d9fe214197d07d56be9/d30a3/vars.jpg 340w,\n/static/bcab26624c591d9fe214197d07d56be9/7bf67/vars.jpg 680w,\n/static/bcab26624c591d9fe214197d07d56be9/4b190/vars.jpg 800w\" sizes=\"(max-width: 680px) 100vw, 680px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n    </span>\n          </p>\n<p>Datadog template variables</p>\n<p>You will notice why I'm using 2 different tags to filter the same thing, like <code class=\"language-text\">k8s_namespace</code> and <code class=\"language-text\">k8s_state_namespace</code>. That is because there are 2 sets of metrics gathered by Datadog and being tagged differently:</p>\n<ul>\n<li><code class=\"language-text\">kubernetes.*</code> metrics are collected by Datadog agents/cluster-agent.</li>\n<li><code class=\"language-text\">kubernetes_state.*</code> metrics are gathered from the Kube-state-metrics (KSM) API.</li>\n</ul>\n<p>Besides cluster graphs, I also added system metrics and K8s metrics into the dashboard like this:</p>\n<p><span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 48.23529411764706%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAKABQDASIAAhEBAxEB/8QAFgABAQEAAAAAAAAAAAAAAAAAAQAF/8QAFAEBAAAAAAAAAAAAAAAAAAAAAP/aAAwDAQACEAMQAAAByZAiP//EABgQAAIDAAAAAAAAAAAAAAAAAAERABAx/9oACAEBAAEFAiogzt//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/AT//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/AT//xAAUEAEAAAAAAAAAAAAAAAAAAAAg/9oACAEBAAY/Al//xAAZEAEBAAMBAAAAAAAAAAAAAAABABExUWH/2gAIAQEAAT8h4SBMidgCBz7Oo3O7/9oADAMBAAIAAwAAABBAz//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8QP//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8QP//EABsQAQEAAgMBAAAAAAAAAAAAAAERACExUWHR/9oACAEBAAE/EEmrfW8ILEoWF+ZBAGA4fcAWae8aut1nPn//2Q=='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"System Metrics\" title=\"\" src=\"/static/a5670250d809303066612850e9a40f24/7bf67/dash3.jpg\" srcset=\"/static/a5670250d809303066612850e9a40f24/651be/dash3.jpg 170w,\n/static/a5670250d809303066612850e9a40f24/d30a3/dash3.jpg 340w,\n/static/a5670250d809303066612850e9a40f24/7bf67/dash3.jpg 680w,\n/static/a5670250d809303066612850e9a40f24/4b190/dash3.jpg 800w\" sizes=\"(max-width: 680px) 100vw, 680px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n    </span>\n          \n<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 48.23529411764706%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAKABQDASIAAhEBAxEB/8QAFwAAAwEAAAAAAAAAAAAAAAAAAAECBf/EABUBAQEAAAAAAAAAAAAAAAAAAAAB/9oADAMBAAIQAxAAAAHOiUMkT//EABgQAAIDAAAAAAAAAAAAAAAAAAABEiBB/9oACAEBAAEFAnE2n//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8BP//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8BP//EABkQAAIDAQAAAAAAAAAAAAAAAABBAiAxkf/aAAgBAQAGPwLI9EKn/8QAGhAAAgIDAAAAAAAAAAAAAAAAAAERcRBR8P/aAAgBAQABPyHRNYimxrjGPH//2gAMAwEAAgADAAAAEIc//8QAFhEBAQEAAAAAAAAAAAAAAAAAAAER/9oACAEDAQE/EGR//8QAFhEBAQEAAAAAAAAAAAAAAAAAAAER/9oACAECAQE/EG1//8QAHBAAAgICAwAAAAAAAAAAAAAAAREAITFBEHGh/9oACAEBAAE/ECTZDBj7FumOtIJ0nUAFjl//2Q=='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"K8s Metrics\" title=\"\" src=\"/static/a367fd18289f525ce33ed9a2015fcd25/7bf67/dash4.jpg\" srcset=\"/static/a367fd18289f525ce33ed9a2015fcd25/651be/dash4.jpg 170w,\n/static/a367fd18289f525ce33ed9a2015fcd25/d30a3/dash4.jpg 340w,\n/static/a367fd18289f525ce33ed9a2015fcd25/7bf67/dash4.jpg 680w,\n/static/a367fd18289f525ce33ed9a2015fcd25/4b190/dash4.jpg 800w\" sizes=\"(max-width: 680px) 100vw, 680px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n    </span>\n          \n<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 44.705882352941174%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAJABQDASIAAhEBAxEB/8QAGAAAAgMAAAAAAAAAAAAAAAAAAAMCBAX/xAAVAQEBAAAAAAAAAAAAAAAAAAAAAf/aAAwDAQACEAMQAAABz4uIQWCP/8QAFxAAAwEAAAAAAAAAAAAAAAAAARAhMf/aAAgBAQABBQKMYF//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/AT//xAAVEQEBAAAAAAAAAAAAAAAAAAAAEf/aAAgBAgEBPwFX/8QAGBAAAwEBAAAAAAAAAAAAAAAAAAEyEHH/2gAIAQEABj8CghkPH3P/xAAdEAACAQQDAAAAAAAAAAAAAAAAAREQITFBUXHh/9oACAEBAAE/IZgp15Ek5uX0xpe5g6M6X//aAAwDAQACAAMAAAAQiz//xAAWEQEBAQAAAAAAAAAAAAAAAAAAARH/2gAIAQMBAT8QjH//xAAWEQADAAAAAAAAAAAAAAAAAAABECH/2gAIAQIBAT8QMT//xAAdEAABBAIDAAAAAAAAAAAAAAABABExYSHRQaHw/9oACAEBAAE/ECAQXZnncIkbCAIwqEGcgp2l0S8FBbK//9k='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"K8s Metrics\" title=\"\" src=\"/static/d8f1ca2740d74788a57bfeb462fd4093/7bf67/dash5.jpg\" srcset=\"/static/d8f1ca2740d74788a57bfeb462fd4093/651be/dash5.jpg 170w,\n/static/d8f1ca2740d74788a57bfeb462fd4093/d30a3/dash5.jpg 340w,\n/static/d8f1ca2740d74788a57bfeb462fd4093/7bf67/dash5.jpg 680w,\n/static/d8f1ca2740d74788a57bfeb462fd4093/4b190/dash5.jpg 800w\" sizes=\"(max-width: 680px) 100vw, 680px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n    </span>\n          </p>\n<p>You can add more metrics to your dashboard to have more observations on your infrastructure, but I would recommend splitting different layers (Cluster/Orchestrator/System/Application/etc.) into different dashboards. It's because your dashboard UI will become laggy when you're querying a huge metrics subset or huge time range (1 week or 1 month).</p>\n<h2 id=\"Ô∏è-monitors\" style=\"position:relative;\"><a href=\"#%EF%B8%8F-monitors\" aria-label=\"Ô∏è monitors permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üñºÔ∏è Monitors</h2>\n<p>Before creating a monitor, it is important to consider the following:</p>\n<ul>\n<li><strong>Metric Selection</strong>: Identify the key metrics to monitor, such as CPU and memory usage, event drops, error rates, slow HTTP responses, and percentiles.</li>\n<li><strong>Threshold Configuration</strong>: Calculate and set appropriate thresholds, taking into account factors such as minimum and maximum values, averages, sums, and historical trends.</li>\n<li><strong>Metric Labeling</strong>: Tag or label metrics effectively to organize and categorize them.</li>\n<li><strong>Troubleshooting Runbook</strong>: Develop a comprehensive runbook that outlines troubleshooting steps and links to relevant logs for quick issue resolution.</li>\n<li><strong>Alert Notifications</strong>: Configure alert notifications through channels such as Slack or PagerDuty to ensure timely awareness and response.</li>\n</ul>\n<p>The importance of labels or tags is particularly important when creating standardized alerts for core infrastructure components. For example, let's look at how to set up an alert to detect failed pods in a specific namespace.</p>\n<ol>\n<li><strong>Identify the Namespace</strong>: Identify the namespace that you want to monitor.</li>\n<li><strong>Select the Metric</strong>: Select the metric that you want to monitor, such as the number of failed pods.</li>\n<li><strong>Set a Threshold</strong>: Set a threshold for the metric. For example, you might set a threshold of 1 failed pod per minute.</li>\n<li><strong>Tag or Label the Metric</strong>: Tag or label the metric with the namespace name.</li>\n<li><strong>Create a Troubleshooting Runbook</strong>: Create a troubleshooting runbook that outlines the steps to take if the alert is triggered.</li>\n<li><strong>Configure Alert Notifications</strong>: Configure alert notifications to be sent to a channel such as Slack or PagerDuty.</li>\n</ol>\n<p>By following these steps, you can create a monitor that will help you to detect and troubleshoot failed pods in a specific namespace.</p>\n<h3 id=\"-metrics-to-check\" style=\"position:relative;\"><a href=\"#-metrics-to-check\" aria-label=\" metrics to check permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üìâ Metrics to Check</h3>\n<ul>\n<li><code class=\"language-text\">kubernetes_state.pod.status</code> with <code class=\"language-text\">phase:failed</code></li>\n</ul>\n<p><span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 55.88235294117647%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAALABQDASIAAhEBAxEB/8QAFwABAQEBAAAAAAAAAAAAAAAAAAECBf/EABQBAQAAAAAAAAAAAAAAAAAAAAD/2gAMAwEAAhADEAAAAeTNQgP/xAAUEAEAAAAAAAAAAAAAAAAAAAAg/9oACAEBAAEFAl//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/AT//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/AT//xAAUEAEAAAAAAAAAAAAAAAAAAAAg/9oACAEBAAY/Al//xAAXEAADAQAAAAAAAAAAAAAAAAAAARAR/9oACAEBAAE/IcdQ5//aAAwDAQACAAMAAAAQG+//xAAVEQEBAAAAAAAAAAAAAAAAAAAAEf/aAAgBAwEBPxBX/8QAFREBAQAAAAAAAAAAAAAAAAAAABH/2gAIAQIBAT8QR//EABwQAQABBAMAAAAAAAAAAAAAAAEAEBGBoSExQf/aAAgBAQABPxB4VdzOoNvBxAIXBgDoKf/Z'); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"Failed Pods Alert\" title=\"\" src=\"/static/f3948c6d9f476152f7f79e18af6757a9/7bf67/monitor1.jpg\" srcset=\"/static/f3948c6d9f476152f7f79e18af6757a9/651be/monitor1.jpg 170w,\n/static/f3948c6d9f476152f7f79e18af6757a9/d30a3/monitor1.jpg 340w,\n/static/f3948c6d9f476152f7f79e18af6757a9/7bf67/monitor1.jpg 680w,\n/static/f3948c6d9f476152f7f79e18af6757a9/4b190/monitor1.jpg 800w\" sizes=\"(max-width: 680px) 100vw, 680px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n    </span>\n          </p>\n<p>Sum by: <code class=\"language-text\">kubernetes_cluster</code>, <code class=\"language-text\">cluster_env</code>, and <code class=\"language-text\">namespace</code>‚Ää‚Äî‚Ääthe idea is when a namespace in the cluster has so many failed pods, on-call engineers need to quickly investigate the root cause.</p>\n<h3 id=\"-set-alert-and-warning-thresholds\" style=\"position:relative;\"><a href=\"#-set-alert-and-warning-thresholds\" aria-label=\" set alert and warning thresholds permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üö® Set Alert and Warning Thresholds</h3>\n<p><span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 34.11764705882353%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAHABQDASIAAhEBAxEB/8QAFgABAQEAAAAAAAAAAAAAAAAAAAEF/8QAFQEBAQAAAAAAAAAAAAAAAAAAAAH/2gAMAwEAAhADEAAAAcmAFn//xAAUEAEAAAAAAAAAAAAAAAAAAAAQ/9oACAEBAAEFAn//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/AT//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/AT//xAAUEAEAAAAAAAAAAAAAAAAAAAAQ/9oACAEBAAY/An//xAAVEAEBAAAAAAAAAAAAAAAAAAABEP/aAAgBAQABPyFv/9oADAMBAAIAAwAAABCIH//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8QP//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8QP//EABcQAAMBAAAAAAAAAAAAAAAAAAABESH/2gAIAQEAAT8Q1pRKn//Z'); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"Alert Thresholds\" title=\"\" src=\"/static/f82bdec1be8c1997fabb5ac4994f56ee/7bf67/monitor2.jpg\" srcset=\"/static/f82bdec1be8c1997fabb5ac4994f56ee/651be/monitor2.jpg 170w,\n/static/f82bdec1be8c1997fabb5ac4994f56ee/d30a3/monitor2.jpg 340w,\n/static/f82bdec1be8c1997fabb5ac4994f56ee/7bf67/monitor2.jpg 680w,\n/static/f82bdec1be8c1997fabb5ac4994f56ee/4b190/monitor2.jpg 800w\" sizes=\"(max-width: 680px) 100vw, 680px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n    </span>\n          </p>\n<p>Metrics tagging/labeling: as above I have defined a list of tags in sum by, Datadog allows us to define alert messages with those variables:</p>\n<p><span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 35.29411764705882%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAHABQDASIAAhEBAxEB/8QAFwABAAMAAAAAAAAAAAAAAAAAAAECBf/EABcBAAMBAAAAAAAAAAAAAAAAAAABAgP/2gAMAwEAAhADEAAAAcmprEBH/8QAFBABAAAAAAAAAAAAAAAAAAAAEP/aAAgBAQABBQJ//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPwE//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPwE//8QAFBABAAAAAAAAAAAAAAAAAAAAEP/aAAgBAQAGPwJ//8QAFRABAQAAAAAAAAAAAAAAAAAAEEH/2gAIAQEAAT8hj//aAAwDAQACAAMAAAAQg/8A/8QAFREBAQAAAAAAAAAAAAAAAAAAARD/2gAIAQMBAT8QZ//EABURAQEAAAAAAAAAAAAAAAAAAAEQ/9oACAECAQE/ECf/xAAZEAEAAgMAAAAAAAAAAAAAAAABABExgZH/2gAIAQEAAT8QbpELyzb2f//Z'); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"Alert Message\" title=\"\" src=\"/static/4ac040a125103007fcce0a97f73548a7/7bf67/monitor3.jpg\" srcset=\"/static/4ac040a125103007fcce0a97f73548a7/651be/monitor3.jpg 170w,\n/static/4ac040a125103007fcce0a97f73548a7/d30a3/monitor3.jpg 340w,\n/static/4ac040a125103007fcce0a97f73548a7/7bf67/monitor3.jpg 680w,\n/static/4ac040a125103007fcce0a97f73548a7/4b190/monitor3.jpg 800w\" sizes=\"(max-width: 680px) 100vw, 680px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n    </span>\n          </p>\n<p>Then you can see the alert message as below:</p>\n<p><span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 28.82352941176471%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAGABQDASIAAhEBAxEB/8QAFgABAQEAAAAAAAAAAAAAAAAAAAIF/8QAFAEBAAAAAAAAAAAAAAAAAAAAAP/aAAwDAQACEAMQAAAByZAD/8QAFBABAAAAAAAAAAAAAAAAAAAAEP/aAAgBAQABBQJ//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPwE//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPwE//8QAFBABAAAAAAAAAAAAAAAAAAAAEP/aAAgBAQAGPwJ//8QAFxAAAwEAAAAAAAAAAAAAAAAAAAEQIf/aAAgBAQABPyFzT//aAAwDAQACAAMAAAAQi+//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/ED//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/ED//xAAZEAEAAgMAAAAAAAAAAAAAAAABACERUWH/2gAIAQEAAT8QariiXuHU/9k='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"Alert Message Example\" title=\"\" src=\"/static/5b387fe194793d4a8f9adf910a8cddfe/7bf67/monitor4.jpg\" srcset=\"/static/5b387fe194793d4a8f9adf910a8cddfe/651be/monitor4.jpg 170w,\n/static/5b387fe194793d4a8f9adf910a8cddfe/d30a3/monitor4.jpg 340w,\n/static/5b387fe194793d4a8f9adf910a8cddfe/7bf67/monitor4.jpg 680w,\n/static/5b387fe194793d4a8f9adf910a8cddfe/4b190/monitor4.jpg 800w\" sizes=\"(max-width: 680px) 100vw, 680px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n    </span>\n          </p>\n<p>@slack-k8s-{{cluster_env.name}}-alerts: We can simply diversify the alerts from the different environment (dev, stage, or prd) to different Slack channels (k8s-dev-alerts or k8s-stg-alerts or k8s-prd-alerts) and only trigger PagerDuty to on-call (@pagerduty-de-infra) if failure happens in a production environment.</p>\n<p>An example alert to Slack will look like this:</p>\n<p><span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 84.70588235294117%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAARABQDASIAAhEBAxEB/8QAGQABAAIDAAAAAAAAAAAAAAAAAAQFAgMG/8QAFgEBAQEAAAAAAAAAAAAAAAAAAAEC/9oADAMBAAIQAxAAAAGswstc1AFz08UKIH//xAAdEAABAwUBAAAAAAAAAAAAAAADAAIEAQUQETM0/9oACAEBAAEFAt5FFcQZwVC1RPNcOa//xAAUEQEAAAAAAAAAAAAAAAAAAAAg/9oACAEDAQE/AR//xAAUEQEAAAAAAAAAAAAAAAAAAAAg/9oACAECAQE/AR//xAAaEAACAwEBAAAAAAAAAAAAAAABAgAQERJx/9oACAEBAAY/ArDdAbAS27SRfa//xAAeEAAABgIDAAAAAAAAAAAAAAAAARARITFBsWGB8P/aAAgBAQABPyGk2OkIOUwYSkBoTc2PHwn/2gAMAwEAAgADAAAAEFvnAv/EABcRAAMBAAAAAAAAAAAAAAAAAAABMRD/2gAIAQMBAT8QtY9//8QAFREBAQAAAAAAAAAAAAAAAAAAIDH/2gAIAQIBAT8Qg//EAB4QAQEBAAEEAwAAAAAAAAAAAAERACEQQVGhcbHB/9oACAEBAAE/ELbVXk1cWquNmDElIp+YMR4dHa5i8CfLd6X2b2nR/9k='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"Slack Alert\" title=\"\" src=\"/static/a2b856c9c69ed7e622d81039d8260c10/7bf67/slack.jpg\" srcset=\"/static/a2b856c9c69ed7e622d81039d8260c10/651be/slack.jpg 170w,\n/static/a2b856c9c69ed7e622d81039d8260c10/d30a3/slack.jpg 340w,\n/static/a2b856c9c69ed7e622d81039d8260c10/7bf67/slack.jpg 680w,\n/static/a2b856c9c69ed7e622d81039d8260c10/4b190/slack.jpg 800w\" sizes=\"(max-width: 680px) 100vw, 680px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n    </span>\n          </p>\n<h2 id=\"-clean-up-resources\" style=\"position:relative;\"><a href=\"#-clean-up-resources\" aria-label=\" clean up resources permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üß∏ Clean Up Resources</h2>\n<p>After verifying that the resources were deployed successfully, run <code class=\"language-text\">terraform destroy</code> to destroy them.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">terraform destroy</code></pre></div>\n<h2 id=\"-summary\" style=\"position:relative;\"><a href=\"#-summary\" aria-label=\" summary permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üì¶ Summary</h2>\n<p>The fusion of Terraform and Datadog offers a powerful solution for automating Kubernetes monitoring and observability. This dynamic duo allows you to effortlessly manage your infrastructure as code, ensuring that your K8s environment remains finely tuned and well-monitored. With Terraform's declarative approach and Datadog's robust monitoring capabilities, you can easily adapt and scale your Kubernetes infrastructure while gaining valuable insights into its performance. Embracing this combination empowers organizations to streamline operations, enhance efficiency, and proactively address potential issues, making it an essential toolkit for modern Kubernetes management and observability.\n<br></p>\n<p><strong><em>Until next time, „Å§„Å•„Åè üéâ</em></strong></p>\n<blockquote>\n<p>üí° Thank you for Reading !! üôåüèªüòÅüìÉ, see you in the next blog.ü§ò  <em><strong>Until next time üéâ</strong></em></p>\n</blockquote>\n<p>üöÄ Thank you for sticking up till the end. If you have any questions/feedback regarding this blog feel free to connect with me:</p>\n<p><strong>‚ôªÔ∏è LinkedIn:</strong> <a href=\"https://www.linkedin.com/in/rajhi-saif/\" target=\"_blank\" rel=\"noopener noreferrer\">https://www.linkedin.com/in/rajhi-saif/</a></p>\n<p><strong>‚ôªÔ∏è X/Twitter:</strong> <a href=\"https://x.com/rajhisaifeddine\" target=\"_blank\" rel=\"noopener noreferrer\">https://x.com/rajhisaifeddine</a></p>\n<p><strong>The end ‚úåüèª</strong></p>\n<h1 align=\"center\">üî∞ Keep Learning !! Keep Sharing !! üî∞</h1>\n<p><strong>üìÖ Stay updated</strong></p>\n<p>Subscribe to our newsletter for more insights on AWS cloud computing and containers.</p>"}}},"staticQueryHashes":["1271460761","1321585977"],"slicesMap":{}}