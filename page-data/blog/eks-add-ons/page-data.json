{"componentChunkName":"component---src-templates-blog-template-js","path":"/blog/eks-add-ons/","result":{"data":{"markdownRemark":{"html":"<blockquote>\n<p><strong>Amazon VPC CNI, CoreDNS, Kube-proxy, Amazon EBS CSI driver, Amazon EFS CSI driver, ADOT, AWS Load Balancer Controller add-on and more üòå</strong></p>\n</blockquote>\n<p><strong>There's no magic, just mad science üöÄ</strong></p>\n<h2 id=\"-introduction\" style=\"position:relative;\"><a href=\"#-introduction\" aria-label=\" introduction permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>ü§ñ Introduction</h2>\n<p>Much like the formidable Transformers who join forces to create an unstoppable force, Amazon EKS add-ons bring a new level of functionality and performance to your Kubernetes applications. These add-ons are akin to specialized tools that enhance the operational capabilities of your EKS cluster, ensuring seamless interaction with underlying AWS resources for networking, compute, and storage.</p>\n<p>Whether it's observability agents or purpose-built Kubernetes drivers, these add-ons are the unsung heroes that bolster your cluster's capabilities.</p>\n<p>While EKS provides the foundation for running containerized applications, it's the Amazon EKS add-ons that take your cluster's capabilities to the next level.</p>\n<p>These add-ons are like the Swiss Army knives of Kubernetes, offering a range of supporting operational capabilities that enhance security, stability, and performance.</p>\n<hr>\n<h2 id=\"-goals-and-objectives\" style=\"position:relative;\"><a href=\"#-goals-and-objectives\" aria-label=\" goals and objectives permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>ü•Ö Goals and Objectives</h2>\n<p>In this blog post, we'll explore the role and importance of Amazon EKS add-ons, shedding light on how they can simplify the management of your EKS clusters.</p>\n<hr>\n<h2 id=\"-amazon-eks-add-ons\" style=\"position:relative;\"><a href=\"#-amazon-eks-add-ons\" aria-label=\" amazon eks add ons permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üßÆ Amazon EKS Add-ons</h2>\n<p>Amazon EKS add-ons are additional software that enhance Kubernetes applications, providing operational support. They're not tied to a specific application and can include things like observability tools and drivers for interacting with AWS resources. These add-ons are developed and maintained by the Kubernetes community, cloud providers like AWS, or third-party vendors.</p>\n<p>Amazon EKS automatically installs certain self-managed add-ons like <a href=\"https://aws.github.io/aws-eks-best-practices/networking/index/\" target=\"_blank\" rel=\"noopener noreferrer\">Amazon VPC CNI plugin</a>, <a href=\"https://kubernetes.io/docs/reference/command-line-tools-reference/kube-proxy/\" target=\"_blank\" rel=\"noopener noreferrer\">kube-proxy</a>, and <a href=\"https://coredns.io/\" target=\"_blank\" rel=\"noopener noreferrer\">CoreDNS</a> for every cluster, but you can customize and update them as needed.</p>\n<p>These add-ons from Amazon EKS come pre-packaged with the latest security updates and bug fixes, all validated by AWS to work seamlessly with Amazon EKS clusters. They simplify the process of ensuring your clusters are secure and stable, reducing the manual work needed for installation, configuration, and updates. If you already have a self-managed add-on like kube-proxy running, you can switch to using the Amazon EKS version to benefit from its features.</p>\n<ul>\n<li>\n<p><strong>AWS EKS add-ons</strong> are software components that are provided and managed by AWS. Some of these add-ons are automatically installed on every EKS cluster. These add-ons make it easier to secure, stabilize, and update your clusters. They offer a simplified approach to managing your EKS clusters.</p>\n</li>\n<li>\n<p><strong>Self-managed add-ons</strong>, on the other hand, are managed by the user. This means that the user is responsible for installing, configuring, and updating these add-ons. Self-managed add-ons offer more flexibility, but they require more manual effort to manage.</p>\n</li>\n</ul>\n<p>You can adjust specific configuration settings for Amazon EKS add-ons through the <a href=\"https://docs.aws.amazon.com/eks/latest/APIReference/Welcome.html\" target=\"_blank\" rel=\"noopener noreferrer\">Amazon EKS API</a>. Additionally, you have the flexibility to modify configuration fields not managed by Amazon EKS directly within the Kubernetes cluster after the add-on is installed. These changes won't be overridden by Amazon EKS, thanks to the Kubernetes server-side apply feature.</p>\n<h2 id=\"-amazon-vpc-cni-plugin\" style=\"position:relative;\"><a href=\"#-amazon-vpc-cni-plugin\" aria-label=\" amazon vpc cni plugin permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üåê Amazon VPC CNI Plugin</h2>\n<p>Amazon VPC CNI Plugin is a Kubernetes container network interface (CNI) plugin that provides native VPC networking for your cluster. The self-managed or managed type of this add-on is installed on each Amazon EC2 node by default.</p>\n<h3 id=\"what-is-a-container-networking-interface-cni-\" style=\"position:relative;\"><a href=\"#what-is-a-container-networking-interface-cni-\" aria-label=\"what is a container networking interface cni  permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>What is a Container Networking Interface (CNI)? ü§î</h3>\n<p><strong>Container Networking Interface (CNI):</strong></p>\n<p>CNI (Container Network Interface), a <a href=\"https://www.cncf.io/\" target=\"_blank\" rel=\"noopener noreferrer\">Cloud Native Computing Foundation</a> project, consists of a specification and libraries for writing plugins to configure network interfaces in Linux containers, along with a number of supported plugins. CNI concerns itself only with the network connectivity of containers and removing allocated resources when the container is deleted. Because of this focus, CNI has a wide range of support and the specification is simple and vendor-neutral.</p>\n<p>CNI plugins are used by Kubernetes, Cloud Foundry, Podman, CRI-O, etc.</p>\n<p>The illustration diagram below describes the CNI plugin used by Kubernetes:</p>\n<p><span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 40.588235294117645%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsTAAALEwEAmpwYAAABuklEQVR42k2S627aQBCF/f5v0h99iCpt2jRt0tIADsF3Y+y9+LI2YBLM1wGpSlc62tFq9syZM+PZuqfrB1rXEyc56yC+xsN+T+f2nM+8H4mV6djqhsp2rMME/yWgUA26cSjd4iVFxSqqiNKawtSs0w1BbMlLR2kaztM743mCTWWFqCIINLrtyStDGBrSvEPVDs/I42yR8OXOx4oy6wZuHxKWocK2juk/wul0pu13+GHOzfcFZW0xruVulvAUFNTuStgSVYrnrCQ3KWERXOPUlqjGCMm10ysmUahtjZ9lzKMtub3kr1lvChJTUDYV3tcfT3ybLfGjQlqupKKhP/YCR9O5q6p/53Sa+Pnrmc/3v1mIfxtdo7qG4VU8v/wZ9nhxooiyLS/S4uPcsAxa8m0v/gwMw8jxeGJ8g8MFrxNaDzKQhtWqYjYv8VctcVzLUHbs9iNe70aafk9RirGZIcm0JJQ0Uu0wjlJs4OPDGx8eJ25Wrxx2R0ohLNRAtrHEqZWB1JhuwAmPp7Xj0+2MP34s0y1ZhRvWckepQilZKXegHt4EJ+puFIU994/PvMQ5pb5sg5I1slSyEdbu+AvxUlbbXIyhPAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"CNI Plugin\" title=\"\" src=\"/static/ba7fdb05f65a7221aa3d1a05e0be4ada/c5bb3/cni.png\" srcset=\"/static/ba7fdb05f65a7221aa3d1a05e0be4ada/04472/cni.png 170w,\n/static/ba7fdb05f65a7221aa3d1a05e0be4ada/9f933/cni.png 340w,\n/static/ba7fdb05f65a7221aa3d1a05e0be4ada/c5bb3/cni.png 680w,\n/static/ba7fdb05f65a7221aa3d1a05e0be4ada/5a190/cni.png 800w\" sizes=\"(max-width: 680px) 100vw, 680px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n    </span>\n          </p>\n<ul>\n<li><strong>Pods have their own IP addresses.</strong></li>\n<li>When you install Kubernetes, you need to choose a CNI plugin.</li>\n<li>The node manages pod subnets and allocates pod IPs locally.</li>\n<li>Communication/Access from one pod to another pod is through the CNI bridge (layer 2 bridge).</li>\n<li>Flannel creates an interface called Flannel 1, which is an interface between the container runtime and network and is also used to configure network routes.</li>\n<li>The Flannel interface communicates to another node through VXLAN (virtual extensible LAN, encapsulated as UDP packets and exchanged between the hosts).</li>\n</ul>\n<p>Network configurations are taken care of by the CNI plugin chosen during installation, which results in fewer network failures.</p>\n<h3 id=\"amazon-vpc-cni-plugin-Ô∏è\" style=\"position:relative;\"><a href=\"#amazon-vpc-cni-plugin-%EF%B8%8F\" aria-label=\"amazon vpc cni plugin Ô∏è permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Amazon VPC CNI Plugin üõ†Ô∏è</h3>\n<p>As we discussed in the previous section, the CNI plugin uses VXLAN, BGP, or other overlay networks for communication and encapsulating the packets over the network. In the case of AWS, encapsulation is taking place at the hardware when using AWS Elastic Network Interfaces (ENI) inside a VPC. AWS CNI uses native networking and removes the dependency on the secondary network for encapsulation.</p>\n<p>The illustration diagram below describes the Amazon VPC CNI native plugin for EKS:</p>\n<p><span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 53.529411764705884%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAACQ0lEQVR42l2SWU/bUBCF+f9/o6r60sc+dAWVJRASWppANhzb8e7E9vXuLJCvE0eIqpaO5t6Zc0dnxufkw02HpChI64qkLFD/IXlFkZPVZctLqxJVvXGiPGPLC99+djh537/gwXDxEiUP5UGzIakaOdfkzZpqu0M1W+J6y8XUxVwluCqTugio6haxcA/f94trTpaBzaDzGcO2MFybieMx90NBgL1coeodZlySrGHcO2U0vEW3zbb+5AXoYYQmcSMKf1zeSMMyY+4kaFrEIkiZWC66HmNaKX60IhN1Q5lA1WusZcR05mMvFGaUMDUCDCPB8RX184bTqy4nuTdkPvnFaW/CxA5x84rbsc3tyCRUiiBf058aJHlJPO/Q/T3krDcW1SlaqDjrP7Ur2/J8VJgMPjPtfuF6ZHA30lisUnoSO/djFl5IUGwYuxG5KPTO3zGaPNIZzHh8MmTUkOvBhN7DjPWLNLyShrEs1U5rGaHA0O6xtB66H7U5VZTcORmjsKDcvOClpUywQZed+XoXYz7ASmocVbJjf1SYiQVeiZ5n4jkzvExIgjgvWKjDn5SB9rBMc9yswcsbLGuGu5TG5Q4rzt8apmIVa6Xw04K+7K3zR8NNcuxIcknGft86oo1+nEk+xZF4fjdlMBe7qQIzjGWH+6Ntqp14bL1FbXaiNMcIVvhZLipzQlFYbxrW24ZGcLgf8oe6ESwJsqJ9t6rWRx9eSkPddsRXbgvD9TAFr/dDTbPeMP+He+AZ7vGsLWxRH/Px01f+AhIoLMLSRVT4AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"Amazon VPC CNI Plugin\" title=\"\" src=\"/static/f52f738e9d466918f695d9ff76b3660b/c5bb3/vpc-cni.png\" srcset=\"/static/f52f738e9d466918f695d9ff76b3660b/04472/vpc-cni.png 170w,\n/static/f52f738e9d466918f695d9ff76b3660b/9f933/vpc-cni.png 340w,\n/static/f52f738e9d466918f695d9ff76b3660b/c5bb3/vpc-cni.png 680w,\n/static/f52f738e9d466918f695d9ff76b3660b/5a190/vpc-cni.png 800w\" sizes=\"(max-width: 680px) 100vw, 680px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n    </span>\n          </p>\n<p><strong>Other Kubernetes CNI providers:</strong></p>\n<p><span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 57.64705882352942%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAAsTAAALEwEAmpwYAAACzElEQVR42j2Te3ObRhTF+f6fo504ru04di3JkhCPhWV5g3ishCTraRNbTkScpjPtAKcredI/zvzuPQvL3ctdKZ751XI/q5Yv0yoonEpmo2qyTapFyaviMa9mT7lgduIvHfPpLhX6xfRbscv+KcrUkfyCgj9FmJQhSE7x2VAwtO7QIzfo6u/qaNe4N25P7KjXGIh1c6zASjWYsXKMm+jBQby2ufS43+L5ULb771/aZD5pFWq1zDVa3VRag+mtTtVWNZQT33OtJZbeUsdoLddsdUs7sg4SH8U6z6Wvb3vsq2cc/npFVoyhEBXUZVBMAo0SmLYBsSF0U/tfij6C2BjMs04iVG+W2wV2r2suvb4946Uq8fK9xLqcY7KaI13vkK624NstpkuO+XqCYpljssgw3xQi5lg9PkCcCsf3n6uy+Vn/QPltwyWWEiQrUW45hjvzMIp8mJkN69ibSIUt1s2xCZoKLzFAY/XkH0VjDSQYwc6MZv7CkW4DLkVLB9HSRrrzoQb3OL87w61o/EX3A27kC9wql7iSr/GH3MVn5QZ32if0jBvcm3+e2NGvj2xIJMOZES7NdjlW+wU2r3O40xBd0cOR2YdqDaHZMmTjHpo1EF4XQ9KDLaq1YvLOiICGOlhsNAF34OWUS9XPAw4/vuLt7wP4gsO0KGyXgjJTxAYMIdtjsBwGalMQ8bMsx4IbuPBDD45nC7EmjAPR6ymX8mXciEGtV/uijh+imiZubWdu7aS0Fl+uRQWCpLYiXYjUhq/W4jLUfD0WSup8JbhJ/p09cWTrMJOSdSCGeozVgcMpGPqODi0UI+P1MXLEcf0hZLsn8gEUty/ygRj8LkbCkz0FXdfEgPUbXTynj4cTKd0FLF45LNn4TPY67KLzG7vqnbHL7hn7NDhn553f2WXvA7vqf2RDu8NIPGSq32ckHDJjrDAzUYU3onosh0Yy+PgfkD8nTJTcgtAAAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"CNI Plugin\" title=\"\" src=\"/static/973e37bf383d53309b6fc1df381c1498/c5bb3/other-cnis.png\" srcset=\"/static/973e37bf383d53309b6fc1df381c1498/04472/other-cnis.png 170w,\n/static/973e37bf383d53309b6fc1df381c1498/9f933/other-cnis.png 340w,\n/static/973e37bf383d53309b6fc1df381c1498/c5bb3/other-cnis.png 680w,\n/static/973e37bf383d53309b6fc1df381c1498/5a190/other-cnis.png 800w\" sizes=\"(max-width: 680px) 100vw, 680px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n    </span>\n          </p>\n<h3 id=\"-required-iam-permissions\" style=\"position:relative;\"><a href=\"#-required-iam-permissions\" aria-label=\" required iam permissions permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üîê Required IAM Permissions</h3>\n<p>This add-on uses the <a href=\"https://docs.aws.amazon.com/eks/latest/userguide/iam-roles-for-service-accounts.html\" target=\"_blank\" rel=\"noopener noreferrer\">IAM roles for service accounts IRSA</a> capability of Amazon EKS. If your cluster uses the <code class=\"language-text\">IPv4</code> family, the permissions in the <a href=\"https://docs.aws.amazon.com/IAM/latest/UserGuide/access_policies_create.html\" target=\"_blank\" rel=\"noopener noreferrer\"><code class=\"language-text\">AmazonEKS_CNI_Policy</code></a> are required. If your cluster uses the IPv6 family, you must create an <a href=\"https://docs.aws.amazon.com/IAM/latest/UserGuide/access_policies_create.html\" target=\"_blank\" rel=\"noopener noreferrer\">IAM policy</a> with the permissions in <a href=\"https://github.com/aws/amazon-vpc-cni-k8s/blob/master/docs/iam-policy.md#ipv6-mode\" target=\"_blank\" rel=\"noopener noreferrer\">IPv6 mode</a>.</p>\n<p>You can create an IAM role, attach one of the policies to it, and annotate the Kubernetes service account used by the add-on with the following command:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">eksctl create iamserviceaccount <span class=\"token punctuation\">\\</span> \n    <span class=\"token parameter variable\">--name</span> aws-node <span class=\"token parameter variable\">--namespace</span> kube-system <span class=\"token punctuation\">\\</span> \n    <span class=\"token parameter variable\">--cluster</span> my-cluster --role-name AmazonEKSVPCCNIRole <span class=\"token punctuation\">\\</span>     \n    --role-only --attach-policy-arn arn:aws:iam::aws:policy/AmazonEKS_CNI_Policy <span class=\"token punctuation\">\\</span>\n    <span class=\"token parameter variable\">--approve</span></code></pre></div>\n<p>Replace <code class=\"language-text\">my-cluster</code> with the name of your cluster and <code class=\"language-text\">AmazonEKSVPCCNIRole</code> with the name for your role. If your cluster uses the IPv6 family, then replace <code class=\"language-text\">AmazonEKS_CNI_Policy</code> with the name of the policy that you created.</p>\n<p>This command requires that you have <a href=\"https://eksctl.io/\" target=\"_blank\" rel=\"noopener noreferrer\">eksctl</a> installed on your device. If you need to use a different tool to create the role, attach the policy to it, and annotate the Kubernetes service account, see <a href=\"https://docs.aws.amazon.com/eks/latest/userguide/associate-service-account-role.html\" target=\"_blank\" rel=\"noopener noreferrer\">Configuring a Kubernetes service account to assume an IAM role</a>.</p>\n<h3 id=\"additional-informations\" style=\"position:relative;\"><a href=\"#additional-informations\" aria-label=\"additional informations permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Additional informations</h3>\n<p>To learn more about the add-on's configurable settings, see <a href=\"https://github.com/aws/amazon-vpc-cni-k8s/blob/master/README.md\" target=\"_blank\" rel=\"noopener noreferrer\">aws-vpc-cni-k8s on GitHub</a>.</p>\n<p>To learn more about the plugin, see <a href=\"https://github.com/aws/amazon-vpc-cni-k8s/blob/master/docs/cni-proposal.md\" target=\"_blank\" rel=\"noopener noreferrer\">Proposal: CNI plugin for Kubernetes networking over AWS VPC</a>.</p>\n<p>For more information about creating the add-on, see <a href=\"https://docs.aws.amazon.com/eks/latest/userguide/managing-vpc-cni.html#vpc-add-on-create\" target=\"_blank\" rel=\"noopener noreferrer\">Creating the Amazon EKS add-on.</a></p>\n<p>You can only update one minor version at a time. For example, if your current version is <code class=\"language-text\">1.25.x-eksbuild.y</code> and you want to update to <code class=\"language-text\">1.27.x-eksbuild.y</code>, then you must update your current version to <code class=\"language-text\">1.26.x-eksbuild.y</code> and then update it again to <code class=\"language-text\">1.27.x-eksbuild.y</code>.</p>\n<p>For more information about updating the add-on, see <a href=\"https://docs.aws.amazon.com/eks/latest/userguide/managing-vpc-cni.html#vpc-add-on-update\" target=\"_blank\" rel=\"noopener noreferrer\">Updating the Amazon EKS add-on</a>.</p>\n<h2 id=\"Ô∏è-amazon-ebs-csi-driver\" style=\"position:relative;\"><a href=\"#%EF%B8%8F-amazon-ebs-csi-driver\" aria-label=\"Ô∏è amazon ebs csi driver permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üóÑÔ∏è Amazon EBS CSI Driver</h2>\n<p>Before we dive into this section, make sure to familiarize yourself with the Kubernetes storage objects (volumes, persistent volumes (PV), persistent volume claim (PVC), dynamic provisioning, and ephemeral storage) that were introduced in the <a href=\"https://www.eksworkshop.com/docs/fundamentals/storage/\" target=\"_blank\" rel=\"noopener noreferrer\">Storage</a> main section.</p>\n<p><a href=\"https://kubernetes.io/docs/concepts/storage/volumes/#emptydir\" target=\"_blank\" rel=\"noopener noreferrer\"><code class=\"language-text\">emptyDir</code></a> is an example of ephemeral volumes, and we're currently utilizing it in the MySQL StatefulSet. However, we'll work on updating it in this chapter to a Persistent Volume (PV) using Dynamic Volume Provisioning.</p>\n<p>The <a href=\"https://github.com/container-storage-interface/spec/blob/master/spec.md\" target=\"_blank\" rel=\"noopener noreferrer\"><strong>Container Storage Interface (CSI)</strong></a> is a standard for exposing arbitrary block and file storage systems to containerized workloads on Container Orchestration Systems (COs) like Kubernetes. The <a href=\"https://kubernetes-csi.github.io/docs/\" target=\"_blank\" rel=\"noopener noreferrer\">Kubernetes Container Storage Interface (CSI)</a> helps you run stateful containerized applications. CSI drivers provide a CSI interface that allows Kubernetes clusters to manage the lifecycle of persistent volumes. Amazon EKS makes it easier for you to run stateful workloads by offering CSI drivers for Amazon EBS.</p>\n<p>By using CSI, third-party storage providers can write and deploy plugins exposing new storage systems in Kubernetes without ever having to touch the core Kubernetes code.</p>\n<p>In order to use Amazon EBS volumes with dynamic provisioning on your EKS cluster, you need to confirm that the EBS CSI Driver is installed. The <a href=\"https://github.com/kubernetes-sigs/aws-ebs-csi-driver\" target=\"_blank\" rel=\"noopener noreferrer\">Amazon Elastic Block Store (Amazon EBS) Container Storage Interface (CSI) driver</a> allows Amazon Elastic Kubernetes Service (Amazon EKS) clusters to manage the lifecycle of Amazon EBS volumes for persistent volumes.</p>\n<p><span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 54.70588235294118%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAAsTAAALEwEAmpwYAAAB90lEQVR42l1S24rTUBTtRwl+gv6Gb/7F4Lv4ImhRxOuTDwMzOOCASNXidGw7tDNpmpimTU9yctKTS5M0lyZNGldSVJhNyAk5e132YreCwF9xbtu2Y9tRFMVNRX8rSeI0iZMkwfdmsymLwvUDL4rYalUURYs7rmHoC1X1/HCX52EYBkGQNAUWxl3Dcgxmp9tsvV6n+c4cDSfvXtDRsKqqlkOJ9OHxoP1oZ9MwSgb9/mw2A4XFTEEhZ92b085VV6Di3BKur+WFpr162r93x3jbrsHar873owefjh6aF+f7qtIJsSwLDvM8C+NtX5gNxLm45LYXKrJMuU1eP/t5/y5587wGwwz98vH38cs0Tbfw5nmu63qeV5Z7zIkZwsDHg1bY2RVlwtmy1405q8H4hWO/h2rl+76u60jCayhUVUWQRVnqhuEHgWmaiIMMe+LnE18W/oMRI94QhxHOueM4oGty30SbOkTcYhbcjs+Ov7afmL1vt5WzLGOMQRNRg6gsy/mSqkvGnND2AlmWxemUaQsijB1q3AaDWJIkTdPgUJamN9L8pDN6f9rpjMnFxFDUOUpWFEVVHcetwZgTCnmeY1QYgzKllBCC5OIknSjLH5dXlyPR5Gs/8GENzUWxO4i14BCYwz5hxibzupolibI0yYHYptgzNBww/+oPWfRWqkWXuiAAAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"Amazon EBS CSI Driver\" title=\"\" src=\"/static/204caf78ff95f5aea0827ae1f8fbaa3f/c5bb3/ebs.png\" srcset=\"/static/204caf78ff95f5aea0827ae1f8fbaa3f/04472/ebs.png 170w,\n/static/204caf78ff95f5aea0827ae1f8fbaa3f/9f933/ebs.png 340w,\n/static/204caf78ff95f5aea0827ae1f8fbaa3f/c5bb3/ebs.png 680w,\n/static/204caf78ff95f5aea0827ae1f8fbaa3f/5a190/ebs.png 800w\" sizes=\"(max-width: 680px) 100vw, 680px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n    </span>\n          </p>\n<p>The Amazon Elastic Block Store (Amazon EBS) Container Storage Interface (CSI) driver allows Amazon Elastic Kubernetes Service (Amazon EKS) clusters to manage the lifecycle of Amazon EBS volumes for persistent volumes.</p>\n<h3 id=\"-considerations-for-using-the-amazon-ebs-csi-driver\" style=\"position:relative;\"><a href=\"#-considerations-for-using-the-amazon-ebs-csi-driver\" aria-label=\" considerations for using the amazon ebs csi driver permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üìù Considerations for Using the Amazon EBS CSI Driver</h3>\n<ul>\n<li>The Amazon EBS CSI plugin requires IAM permissions to make calls to AWS APIs on your behalf. For more information, see <a href=\"https://docs.aws.amazon.com/eks/latest/userguide/csi-iam-role.html\" target=\"_blank\" rel=\"noopener noreferrer\">Creating the Amazon EBS CSI driver IAM role</a>.</li>\n<li>You can't mount Amazon EBS volumes to Fargate Pods.</li>\n<li>You can run the Amazon EBS CSI controller on Fargate nodes, but the Amazon EBS CSI node DaemonSet can only run on Amazon EC2 instances.</li>\n<li>Alpha features of the Amazon EBS CSI driver aren't supported on Amazon EKS clusters.</li>\n</ul>\n<p>The Amazon EBS CSI driver isn't installed when you first create a cluster. To use the driver, you must add it as an Amazon EKS add-on or as a self-managed add-on.</p>\n<p>For instructions on how to add it as an Amazon EKS add-on, see <a href=\"https://docs.aws.amazon.com/eks/latest/userguide/managing-ebs-csi.html\" target=\"_blank\" rel=\"noopener noreferrer\">Managing the Amazon EBS CSI driver as an Amazon EKS add-on</a>.</p>\n<p>For instructions on how to add it as a self-managed installation, see the <a href=\"https://github.com/kubernetes-sigs/aws-ebs-csi-driver\" target=\"_blank\" rel=\"noopener noreferrer\">Amazon EBS Container Storage Interface (CSI) driver project on GitHub</a>.</p>\n<p>This add-on uses the <a href=\"https://docs.aws.amazon.com/eks/latest/userguide/iam-roles-for-service-accounts.html\" target=\"_blank\" rel=\"noopener noreferrer\">IAM roles for service accounts capability IRSA</a> of Amazon EKS. The permissions in the <a href=\"https://docs.aws.amazon.com/aws-managed-policy/latest/reference/AmazonEBSCSIDriverPolicy.html\" target=\"_blank\" rel=\"noopener noreferrer\"><code class=\"language-text\">AmazonEBSCSIDriverPolicy</code></a> AWS managed policy are required. You can create an IAM role and attach the managed policy to it with the following command. Replace <code class=\"language-text\">my-cluster</code> with the name of your cluster and <code class=\"language-text\">AmazonEKS_EBS_CSI_DriverRole</code> with the name for your role. This command requires that you have <a href=\"https://eksctl.io/\" target=\"_blank\" rel=\"noopener noreferrer\">eksctl</a> installed on your device. If you need to use a different tool or you need to use a custom KMS key for encryption, see <a href=\"https://docs.aws.amazon.com/eks/latest/userguide/csi-iam-role.html\" target=\"_blank\" rel=\"noopener noreferrer\">Creating the Amazon EBS CSI driver IAM role</a>.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">eksctl create iamserviceaccount <span class=\"token punctuation\">\\</span>     \n    <span class=\"token parameter variable\">--name</span> ebs-csi-controller-sa <span class=\"token punctuation\">\\</span>     \n    <span class=\"token parameter variable\">--namespace</span> kube-system <span class=\"token punctuation\">\\</span>     \n    <span class=\"token parameter variable\">--cluster</span> my-cluster <span class=\"token punctuation\">\\</span>     \n    --role-name AmazonEKS_EBS_CSI_DriverRole <span class=\"token punctuation\">\\</span>     \n    --role-only <span class=\"token punctuation\">\\</span>     \n    --attach-policy-arn arn:aws:iam::aws:policy/service-role/AmazonEBSCSIDriverPolicy <span class=\"token punctuation\">\\</span>     \n    <span class=\"token parameter variable\">--approve</span></code></pre></div>\n<h3 id=\"Ô∏è-adding-the-amazon-ebs-csi-add-on-using-code-classlanguage-texteksctlcode\" style=\"position:relative;\"><a href=\"#%EF%B8%8F-adding-the-amazon-ebs-csi-add-on-using-code-classlanguage-texteksctlcode\" aria-label=\"Ô∏è adding the amazon ebs csi add on using code classlanguage texteksctlcode permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üõ†Ô∏è Adding the Amazon EBS CSI Add-on Using <code class=\"language-text\">eksctl</code></h3>\n<p>Run the following command. Replace <code class=\"language-text\">my-cluster</code> with the name of your cluster, <code class=\"language-text\">111122223333</code> with your account ID, and <code class=\"language-text\">AmazonEKS_EBS_CSI_DriverRole</code> with the name of the IAM role created earlier. If your cluster is in the AWS GovCloud (US-East) or AWS GovCloud (US-West) AWS Regions, then replace <code class=\"language-text\">arn:aws:</code> with <code class=\"language-text\">arn:aws-us-gov:</code>.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">eksctl create addon <span class=\"token parameter variable\">--name</span> aws-ebs-csi-driver <span class=\"token parameter variable\">--cluster</span> my-cluster --service-account-role-arn arn:aws:iam::111122223333:role/AmazonEKS_EBS_CSI_DriverRole <span class=\"token parameter variable\">--force</span></code></pre></div>\n<p>If you remove the <code class=\"language-text\">--force</code> option and any of the Amazon EKS add-on settings conflict with your existing settings, then updating the Amazon EKS add-on fails, and you receive an error message to help you resolve the conflict. Before specifying this option, make sure that the Amazon EKS add-on doesn't manage settings that you need to manage, because those settings are overwritten with this option. For more information about other options for this setting, see <a href=\"https://eksctl.io/usage/addons/\" target=\"_blank\" rel=\"noopener noreferrer\">Addons in the eksctl documentation</a>. For more information about Amazon EKS Kubernetes field management, see <a href=\"https://docs.aws.amazon.com/eks/latest/userguide/kubernetes-field-management.html\" target=\"_blank\" rel=\"noopener noreferrer\">Kubernetes field management</a>.</p>\n<h3 id=\"-additional-information\" style=\"position:relative;\"><a href=\"#-additional-information\" aria-label=\" additional information permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üìö Additional Information</h3>\n<p>To learn more about the add-on, see <a href=\"https://docs.aws.amazon.com/eks/latest/userguide/ebs-csi.html\" target=\"_blank\" rel=\"noopener noreferrer\">Amazon EBS CSI driver</a>.</p>\n<p>To add the Amazon EBS CSI add-on using <code class=\"language-text\">eksctl</code>, follow the instructions provided above.</p>\n<p>For more information about creating the add-on, see <a href=\"https://docs.aws.amazon.com/eks/latest/userguide/ebs-csi.html\" target=\"_blank\" rel=\"noopener noreferrer\">Creating the Amazon EBS CSI driver IAM role</a>.</p>\n<p>For more information about updating the add-on, see <a href=\"https://docs.aws.amazon.com/eks/latest/userguide/ebs-csi.html\" target=\"_blank\" rel=\"noopener noreferrer\">Updating the Amazon EBS CSI driver</a>.</p>\n<h2 id=\"-amazon-efs-csi-driver\" style=\"position:relative;\"><a href=\"#-amazon-efs-csi-driver\" aria-label=\" amazon efs csi driver permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üìÇ Amazon EFS CSI Driver</h2>\n<p><span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 41.76470588235294%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAIABQDASIAAhEBAxEB/8QAFwABAAMAAAAAAAAAAAAAAAAAAAEEBf/EABUBAQEAAAAAAAAAAAAAAAAAAAAB/9oADAMBAAIQAxAAAAHRtCyE/8QAGRABAAIDAAAAAAAAAAAAAAAAAgEDERMh/9oACAEBAAEFAlFm5dIjB//EABYRAQEBAAAAAAAAAAAAAAAAAAEQEf/aAAgBAwEBPwFdn//EABYRAAMAAAAAAAAAAAAAAAAAAAEQIf/aAAgBAgEBPwERf//EABgQAAIDAAAAAAAAAAAAAAAAAAAQERJB/9oACAEBAAY/ArYoP//EABkQAQADAQEAAAAAAAAAAAAAAAEAETEhUf/aAAgBAQABPyFVGM2FcL7KPxP/2gAMAwEAAgADAAAAEPPv/8QAFhEBAQEAAAAAAAAAAAAAAAAAEQEQ/9oACAEDAQE/EAFz/8QAFxEAAwEAAAAAAAAAAAAAAAAAAAERIf/aAAgBAgEBPxDSobun/8QAGhABAQADAQEAAAAAAAAAAAAAAREAITFBUf/aAAgBAQABPxASpwU0Lsk3Z9wWKhDjipCR65//2Q=='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"Amazon EFS\" title=\"\" src=\"/static/964aa13d2e53b849899d5ea6a2e4fff7/7bf67/efs.jpg\" srcset=\"/static/964aa13d2e53b849899d5ea6a2e4fff7/651be/efs.jpg 170w,\n/static/964aa13d2e53b849899d5ea6a2e4fff7/d30a3/efs.jpg 340w,\n/static/964aa13d2e53b849899d5ea6a2e4fff7/7bf67/efs.jpg 680w,\n/static/964aa13d2e53b849899d5ea6a2e4fff7/4b190/efs.jpg 800w\" sizes=\"(max-width: 680px) 100vw, 680px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n    </span>\n          </p>\n<p><a href=\"https://docs.aws.amazon.com/efs/latest/ug/whatisefs.html\" target=\"_blank\" rel=\"noopener noreferrer\">Amazon Elastic File System (Amazon EFS)</a> provides serverless, fully elastic file storage so that you can share file data without provisioning or managing storage capacity and performance. The <a href=\"https://github.com/kubernetes-sigs/aws-efs-csi-driver\" target=\"_blank\" rel=\"noopener noreferrer\">Amazon EFS Container Storage Interface (CSI) driver</a> provides a CSI interface that allows Kubernetes clusters running on AWS to manage the lifecycle of Amazon EFS file systems. This topic shows you how to deploy the Amazon EFS CSI driver to your Amazon EKS cluster.</p>\n<p>The EFS CSI driver makes it simple to configure elastic file storage for both EKS and self-managed Kubernetes clusters running on AWS using standard Kubernetes interfaces. Applications running in Kubernetes can use EFS file systems to share data between pods in a scale-out group, or with other applications running within or outside of Kubernetes. EFS can also help Kubernetes applications be highly available because all data written to EFS is written to multiple AWS Availability Zones. If a Kubernetes pod is terminated and relaunched, the CSI driver will reconnect the EFS file system, even if the pod is relaunched in a different AWS Availability Zone.</p>\n<h3 id=\"Ô∏è-creating-your-amazon-efs-csi-driver-iam-role-with-code-classlanguage-texteksctlcode\" style=\"position:relative;\"><a href=\"#%EF%B8%8F-creating-your-amazon-efs-csi-driver-iam-role-with-code-classlanguage-texteksctlcode\" aria-label=\"Ô∏è creating your amazon efs csi driver iam role with code classlanguage texteksctlcode permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üõ†Ô∏è Creating Your Amazon EFS CSI Driver IAM Role with <code class=\"language-text\">eksctl</code></h3>\n<p>Run the following command to create the IAM role and Kubernetes service account. It also attaches the policy to the role, annotates the Kubernetes service account with the IAM role ARN, and adds the Kubernetes service account name to the trust policy for the IAM role. Replace <code class=\"language-text\">my-cluster</code> with your cluster name and <code class=\"language-text\">AmazonEKS_EFS_CSI_DriverRole</code> with the name for your role.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token builtin class-name\">export</span> <span class=\"token assign-left variable\">cluster_name</span><span class=\"token operator\">=</span>my-cluster\n<span class=\"token builtin class-name\">export</span> <span class=\"token assign-left variable\">role_name</span><span class=\"token operator\">=</span>AmazonEKS_EFS_CSI_DriverRole\n\neksctl create iamserviceaccount <span class=\"token punctuation\">\\</span>\n    <span class=\"token parameter variable\">--name</span> efs-csi-controller-sa <span class=\"token punctuation\">\\</span>\n    <span class=\"token parameter variable\">--namespace</span> kube-system <span class=\"token punctuation\">\\</span>\n    <span class=\"token parameter variable\">--cluster</span> <span class=\"token variable\">$cluster_name</span> <span class=\"token punctuation\">\\</span>\n    --role-name <span class=\"token variable\">$role_name</span> <span class=\"token punctuation\">\\</span>\n    --role-only <span class=\"token punctuation\">\\</span>\n    --attach-policy-arn arn:aws:iam::aws:policy/service-role/AmazonEFSCSIDriverPolicy <span class=\"token punctuation\">\\</span>\n    <span class=\"token parameter variable\">--approve</span>\n\n<span class=\"token assign-left variable\">TRUST_POLICY</span><span class=\"token operator\">=</span><span class=\"token variable\"><span class=\"token variable\">$(</span>aws iam get-role --role-name $role_name <span class=\"token parameter variable\">--query</span> <span class=\"token string\">'Role.AssumeRolePolicyDocument'</span> <span class=\"token operator\">|</span> <span class=\"token punctuation\">\\</span>\n    <span class=\"token function\">sed</span> <span class=\"token parameter variable\">-e</span> <span class=\"token string\">'s/efs-csi-controller-sa/efs-csi-*/'</span> <span class=\"token parameter variable\">-e</span> <span class=\"token string\">'s/StringEquals/StringLike/'</span><span class=\"token variable\">)</span></span>\n\naws iam update-assume-role-policy --role-name <span class=\"token variable\">$role_name</span> --policy-document <span class=\"token string\">\"<span class=\"token variable\">$TRUST_POLICY</span>\"</span></code></pre></div>\n<h3 id=\"-installing-the-amazon-efs-csi-driver\" style=\"position:relative;\"><a href=\"#-installing-the-amazon-efs-csi-driver\" aria-label=\" installing the amazon efs csi driver permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üöÄ Installing the Amazon EFS CSI Driver</h3>\n<p>To use Amazon EFS file system with dynamic provisioning on your EKS cluster, confirm that the EFS CSI Driver is installed. The Amazon Elastic File System Container Storage Interface (CSI) Driver implements the CSI specification for container orchestrators to manage the lifecycle of Amazon EFS file systems.</p>\n<p>We recommend that you install the Amazon EFS CSI driver through the Amazon EKS add-on. To add an Amazon EKS add-on to your cluster, see <a href=\"https://docs.aws.amazon.com/eks/latest/userguide/eks-add-ons.html\" target=\"_blank\" rel=\"noopener noreferrer\">Creating an add-on</a>. For more information about add-ons, see <a href=\"https://docs.aws.amazon.com/eks/latest/userguide/eks-add-ons.html\" target=\"_blank\" rel=\"noopener noreferrer\">Amazon EKS add-ons</a>.</p>\n<p>If you're unable to use the Amazon EKS add-on, we encourage you to submit an issue about why you can't to the <a href=\"https://github.com/aws/containers-roadmap/issues\" target=\"_blank\" rel=\"noopener noreferrer\">Containers roadmap GitHub repository</a>.</p>\n<p>Alternatively, if you want a self-managed installation of the Amazon EFS CSI driver, see <a href=\"https://github.com/kubernetes-sigs/aws-efs-csi-driver/blob/master/docs/README.md#installation\" target=\"_blank\" rel=\"noopener noreferrer\">Installation on GitHub</a>.</p>\n<h2 id=\"-amazon-eks-coredns\" style=\"position:relative;\"><a href=\"#-amazon-eks-coredns\" aria-label=\" amazon eks coredns permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üß© Amazon EKS CoreDNS</h2>\n<p>CoreDNS is a flexible, extensible DNS server that can serve as the Kubernetes cluster DNS. The self-managed or managed type of this add-on was installed, by default, when you created your cluster. When you launch an Amazon EKS cluster with at least one node, two replicas of the CoreDNS image are deployed by default, regardless of the number of nodes deployed in your cluster. The CoreDNS Pods provide name resolution for all Pods in the cluster. You can deploy the CoreDNS Pods to Fargate nodes if your cluster includes an <a href=\"https://docs.aws.amazon.com/eks/latest/userguide/fargate-profile.html\" target=\"_blank\" rel=\"noopener noreferrer\">AWS Fargate profile</a> with a namespace that matches the namespace for the CoreDNS deployment.</p>\n<p><span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 661px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 44.11764705882353%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsTAAALEwEAmpwYAAABOElEQVR42pVSvS/FUBztX2W3WE0WCYlEhJFYLEKCQcIiVgwYiHRAQmLEbiFikfea4Ol7pX19vd/H7W1vte8j4iQnze/c3nN/Xw40lFIFpZSVeJBuker2LIXDOQdjTJODUGZIdWz19NutU0qNST8Yw/9CCFEYHhyfYXl9G+7FdWbISoZrdx9YvX2HH1NdiwDjQvdDYP+hidkrD7UvomMJQkhRwdTcIoaGR7G0spkbssyQ6Mvj53VMXnqIOgRUX0o0Jelg4cbDyMkrakEMySiidowkSQw3tnYxMTOPvcPT3pKjoIlvv2GyyJA1mmnTVuMNMv9XCF6UHEZtPD2/mDb0GKaDUn16ZvT8EfboInSnIWL/97A8FDvJv8goQZpDcH+E+s4YePhZGJYtnWom1R3r3kXbBKXUwA34ARYDsESWpO1JAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"CoreDNS\" title=\"\" src=\"/static/2c6e088ba5642ac9d12fb005a821c07e/0012b/coredns.png\" srcset=\"/static/2c6e088ba5642ac9d12fb005a821c07e/04472/coredns.png 170w,\n/static/2c6e088ba5642ac9d12fb005a821c07e/9f933/coredns.png 340w,\n/static/2c6e088ba5642ac9d12fb005a821c07e/0012b/coredns.png 661w\" sizes=\"(max-width: 661px) 100vw, 661px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n    </span>\n          </p>\n<p>CoreDNS is an open-source DNS service with a Kubernetes plugin for service discovery and by default, it's a DNS server for most of the Kubernetes distributions. Service discovery is actually the main motivation behind hosting a DNS server inside the Kubernetes cluster, otherwise, all DNS queries would go to an external DNS server.</p>\n<p>Better to explain with a drawing:</p>\n<p><span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 35.29411764705882%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAHABQDASIAAhEBAxEB/8QAFgABAQEAAAAAAAAAAAAAAAAAAAEF/8QAFAEBAAAAAAAAAAAAAAAAAAAAAP/aAAwDAQACEAMQAAAB3QUH/8QAFBABAAAAAAAAAAAAAAAAAAAAEP/aAAgBAQABBQJ//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPwE//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPwE//8QAFBABAAAAAAAAAAAAAAAAAAAAEP/aAAgBAQAGPwJ//8QAGRAAAwEBAQAAAAAAAAAAAAAAAREhADFx/9oACAEBAAE/IbkWb5OYA1l7/9oADAMBAAIAAwAAABADz//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8QP//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8QP//EABwQAQACAQUAAAAAAAAAAAAAAAERIQAxQVFhgf/aAAgBAQABPxBLImlCb50FiB6YShJqog4z/9k='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"DNS\" title=\"\" src=\"/static/bbcf336c8952dc9717e9bbf469a9dda4/7bf67/dns.jpg\" srcset=\"/static/bbcf336c8952dc9717e9bbf469a9dda4/651be/dns.jpg 170w,\n/static/bbcf336c8952dc9717e9bbf469a9dda4/d30a3/dns.jpg 340w,\n/static/bbcf336c8952dc9717e9bbf469a9dda4/7bf67/dns.jpg 680w,\n/static/bbcf336c8952dc9717e9bbf469a9dda4/445d5/dns.jpg 681w\" sizes=\"(max-width: 680px) 100vw, 680px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n    </span>\n          </p>\n<ol>\n<li>Application makes a DNS query.</li>\n<li>\n<ul>\n<li><strong>A:</strong> If the record is a Kubernetes service record, like \"application2-internal-service\", CoreDNS responds with the service IP address result.</li>\n<li><strong>B:</strong> If the record is an external endpoint record like \"api.google.com\", then CoreDNS asks the record to the external DNS server.</li>\n</ul>\n</li>\n</ol>\n<p>This architecture is done via <code class=\"language-text\">kubelet</code>, it overwrites the <code class=\"language-text\">/etc/resolv.conf</code> file with content below:</p>\n<div class=\"gatsby-highlight\" data-language=\"plaintext\"><pre class=\"language-plaintext\"><code class=\"language-plaintext\">nameserver 172.20.0.10  # COREDNS \"SERVICE\" IP ADDRESS\nsearch [clustername].svc.cluster.local svc.cluster.local cluster.local eu-central-1.compute.internal\noptions ndots:5</code></pre></div>\n<p>Each pod inherits this <code class=\"language-text\">/etc/resolv.conf</code> configuration and thanks to the \"nameserver\" line, each pod goes to the CoreDNS service endpoint and CoreDNS pods after that.</p>\n<h3 id=\"Ô∏è-creating-the-amazon-eks-add-on\" style=\"position:relative;\"><a href=\"#%EF%B8%8F-creating-the-amazon-eks-add-on\" aria-label=\"Ô∏è creating the amazon eks add on permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üõ†Ô∏è Creating the Amazon EKS Add-on</h3>\n<ol>\n<li>\n<p><strong>See which version of the add-on is installed on your cluster:</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">kubectl describe deployment coredns <span class=\"token parameter variable\">--namespace</span> kube-system <span class=\"token operator\">|</span> <span class=\"token function\">grep</span> coredns: <span class=\"token operator\">|</span> <span class=\"token function\">cut</span> <span class=\"token parameter variable\">-d</span> <span class=\"token builtin class-name\">:</span> <span class=\"token parameter variable\">-f</span> <span class=\"token number\">3</span></code></pre></div>\n<p>An example output is as follows:</p>\n<div class=\"gatsby-highlight\" data-language=\"plaintext\"><pre class=\"language-plaintext\"><code class=\"language-plaintext\">v1.9.3-eksbuild.7</code></pre></div>\n</li>\n<li>\n<p><strong>See which type of the add-on is installed on your cluster:</strong></p>\n<p>Depending on the tool that you created your cluster with, you might not currently have the Amazon EKS add-on type installed on your cluster. Replace <code class=\"language-text\">my-cluster</code> with the name of your cluster.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">aws eks describe-addon --cluster-name my-cluster --addon-name coredns <span class=\"token parameter variable\">--query</span> addon.addonVersion <span class=\"token parameter variable\">--output</span> text</code></pre></div>\n<p>If a version number is returned, you have the Amazon EKS type of the add-on installed on your cluster and don't need to complete the remaining steps in this procedure. If an error is returned, you don't have the Amazon EKS type of the add-on installed on your cluster. Complete the remaining steps of this procedure to install it.</p>\n</li>\n<li>\n<p><strong>Save the configuration of your currently installed add-on:</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">kubectl get deployment coredns <span class=\"token parameter variable\">-n</span> kube-system <span class=\"token parameter variable\">-o</span> yaml <span class=\"token operator\">></span> aws-k8s-coredns-old.yaml</code></pre></div>\n</li>\n<li>\n<p><strong>Create the add-on using the AWS CLI:</strong></p>\n<p>If you want to use the AWS Management Console or <code class=\"language-text\">eksctl</code> to create the add-on, see <a href=\"https://docs.aws.amazon.com/eks/latest/userguide/eks-add-ons.html\" target=\"_blank\" rel=\"noopener noreferrer\">Creating an add-on</a> and specify <code class=\"language-text\">coredns</code> for the add-on name. Copy the command that follows to your device. Make the following modifications to the command, as needed, and then run the modified command.</p>\n<p>Replace <code class=\"language-text\">my-cluster</code> with the name of your cluster. Replace <code class=\"language-text\">v1.10.1-eksbuild.4</code> with the latest version listed in the latest version table for your cluster version.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">aws eks create-addon --cluster-name my-cluster --addon-name coredns --addon-version v1.10.1-eksbuild.4</code></pre></div>\n<p>If you've applied custom settings to your current add-on that conflict with the default settings of the Amazon EKS add-on, creation might fail. If creation fails, you receive an error that can help you resolve the issue. Alternatively, you can add <code class=\"language-text\">--resolve-conflicts OVERWRITE</code> to the previous command. This allows the add-on to overwrite any existing custom settings. Once you've created the add-on, you can update it with your custom settings.</p>\n</li>\n<li>\n<p><strong>Confirm that the latest version of the add-on for your cluster's Kubernetes version was added to your cluster:</strong></p>\n<p>Replace <code class=\"language-text\">my-cluster</code> with the name of your cluster.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">aws eks describe-addon --cluster-name my-cluster --addon-name coredns <span class=\"token parameter variable\">--query</span> addon.addonVersion <span class=\"token parameter variable\">--output</span> text</code></pre></div>\n<p>It might take several seconds for add-on creation to complete. An example output is as follows:</p>\n<div class=\"gatsby-highlight\" data-language=\"plaintext\"><pre class=\"language-plaintext\"><code class=\"language-plaintext\">v1.10.1-eksbuild.4</code></pre></div>\n</li>\n<li>\n<p><strong>If you made custom settings to your original add-on, before you created the Amazon EKS add-on, use the configuration that you saved in a previous step to <a href=\"https://docs.aws.amazon.com/eks/latest/userguide/coredns-add-on-update.html\" target=\"_blank\" rel=\"noopener noreferrer\">update</a> the Amazon EKS add-on with your custom settings.</strong></p>\n</li>\n</ol>\n<p>For more information, visit the <a href=\"https://docs.aws.amazon.com/eks/latest/userguide/managing-coredns.html\" target=\"_blank\" rel=\"noopener noreferrer\">Amazon EKS Documentation</a>.</p>\n<h2 id=\"Ô∏è-kube-proxy-amazon-eks-add-on\" style=\"position:relative;\"><a href=\"#%EF%B8%8F-kube-proxy-amazon-eks-add-on\" aria-label=\"Ô∏è kube proxy amazon eks add on permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üõ†Ô∏è Kube-proxy Amazon EKS Add-on</h2>\n<p>The <strong>Kube-proxy Amazon EKS Add-on</strong> adds support for <a href=\"https://kubernetes.io/docs/concepts/overview/components/#kube-proxy\" target=\"_blank\" rel=\"noopener noreferrer\">kube-proxy</a>. Kube-proxy maintains network rules on each Amazon EC2 node, enabling network communication to your pods</p>\n<blockquote>\n<p>Note that kube-proxy is not deployed to Fargate nodes.</p>\n</blockquote>\n<p>For more information, see <a href=\"https://kubernetes.io/docs/reference/command-line-tools-reference/kube-proxy/\" target=\"_blank\" rel=\"noopener noreferrer\">kube-proxy in the Kubernetes documentation</a>.</p>\n<p>Installing Kube-proxy as an Amazon EKS add-on reduces the amount of work needed to install, configure, and update add-ons. It includes the latest security patches, bug fixes, and is validated by AWS to work with Amazon EKS. This ensures that Amazon EKS clusters are secure and stable.</p>\n<p>Amazon EKS automatically installs Kube-proxy as a self-managed add-on for every cluster. If it is already running on your cluster, you can still install it as an Amazon EKS add-on to start benefiting from the capabilities of Amazon EKS add-ons.</p>\n<p>To learn more about kube-proxy, see <a href=\"https://kubernetes.io/docs/reference/command-line-tools-reference/kube-proxy/\" target=\"_blank\" rel=\"noopener noreferrer\">kube-proxy in the Kubernetes documentation</a>.</p>\n<h3 id=\"-update-information\" style=\"position:relative;\"><a href=\"#-update-information\" aria-label=\" update information permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üîÑ Update Information</h3>\n<p>Before updating your current version, consider the following requirements:</p>\n<ul>\n<li><strong>Compatibility and Skew Policy:</strong> Kube-proxy on an Amazon EKS cluster has the same compatibility and skew policy as Kubernetes.</li>\n<li><strong>Version Matching:</strong> Kube-proxy must be the same minor version as kubelet on your Amazon EC2 nodes.</li>\n<li><strong>Control Plane Version:</strong> Kube-proxy can't be later than the minor version of your cluster's control plane.</li>\n<li><strong>Version Gap:</strong> The kube-proxy version on your Amazon EC2 nodes can't be more than two minor versions earlier than your control plane. For example, if your control plane is running Kubernetes 1.27, then the kube-proxy minor version can't be earlier than 1.25.</li>\n<li><strong>Node Update:</strong> If you recently updated your cluster to a new Kubernetes minor version, then update your Amazon EC2 nodes to the same minor version before updating kube-proxy to the same minor version as your nodes.</li>\n</ul>\n<p>For more detailed information, visit the <a href=\"https://docs.aws.amazon.com/eks/latest/userguide/managing-kube-proxy.html\" target=\"_blank\" rel=\"noopener noreferrer\">Amazon EKS Documentation</a>.</p>\n<h2 id=\"-aws-load-balancer-controller-add-on\" style=\"position:relative;\"><a href=\"#-aws-load-balancer-controller-add-on\" aria-label=\" aws load balancer controller add on permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üåê AWS Load Balancer Controller Add-on</h2>\n<p>AWS Load Balancer Controller is a controller to help manage Elastic Load Balancers for a Kubernetes cluster.</p>\n<p>It satisfies <a href=\"https://kubernetes.io/docs/concepts/services-networking/ingress/\" target=\"_blank\" rel=\"noopener noreferrer\">Kubernetes Ingress resources</a> by provisioning <a href=\"https://docs.aws.amazon.com/elasticloadbalancing/latest/application/introduction.html\" target=\"_blank\" rel=\"noopener noreferrer\">Application Load Balancers</a>. It satisfies <a href=\"https://kubernetes.io/docs/concepts/services-networking/service/\" target=\"_blank\" rel=\"noopener noreferrer\">Kubernetes Service resources</a> by provisioning <a href=\"https://docs.aws.amazon.com/elasticloadbalancing/latest/network/introduction.html\" target=\"_blank\" rel=\"noopener noreferrer\">Network Load Balancers</a>.</p>\n<p>This project was formerly known as \"AWS ALB Ingress Controller\". We rebranded it to be \"AWS Load Balancer Controller\". AWS ALB Ingress Controller was originated by <a href=\"https://github.com/ticketmaster\" target=\"_blank\" rel=\"noopener noreferrer\">Ticketmaster</a> and <a href=\"https://github.com/coreos\" target=\"_blank\" rel=\"noopener noreferrer\">CoreOS</a> as part of Ticketmaster's move to AWS and CoreOS Tectonic. Learn more about Ticketmaster's Kubernetes initiative from Justin Dean's video at <a href=\"https://www.youtube.com/watch?v=wqXVKneP0Hg\" target=\"_blank\" rel=\"noopener noreferrer\">Tectonic Summit</a>. AWS ALB Ingress Controller was donated to Kubernetes SIG-AWS to allow AWS, CoreOS, Ticketmaster, and other SIG-AWS contributors to officially maintain the project. SIG-AWS reached this consensus on June 1, 2018.</p>\n<p><span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 56.470588235294116%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAALABQDASIAAhEBAxEB/8QAGAAAAgMAAAAAAAAAAAAAAAAAAAMCBAX/xAAVAQEBAAAAAAAAAAAAAAAAAAABAv/aAAwDAQACEAMQAAAB051nstEA/wD/xAAaEAACAgMAAAAAAAAAAAAAAAABAhARAAMS/9oACAEBAAEFArpA1xrY50Y//8QAFREBAQAAAAAAAAAAAAAAAAAAARD/2gAIAQMBAT8BJ//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8BP//EABsQAAEEAwAAAAAAAAAAAAAAAAEAEBEhAkFh/9oACAEBAAY/Ap6hRtshqX//xAAbEAADAAIDAAAAAAAAAAAAAAAAAREhYTFRwf/aAAgBAQABPyFbt9oj2YNqiDrhwNhT/9oADAMBAAIAAwAAABAM3//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8QH//EABYRAQEBAAAAAAAAAAAAAAAAAAEREP/aAAgBAgEBPxBSSZ//xAAZEAEBAQEBAQAAAAAAAAAAAAABEQAhMaH/2gAIAQEAAT8QIJqzsFXrp+A4tfHGWCXlCLCaKI+ZS+7/2Q=='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"AWS Load Balancer Controller\" title=\"\" src=\"/static/060337072e65f1195a3c3cfe86cbc81f/7bf67/albc.jpg\" srcset=\"/static/060337072e65f1195a3c3cfe86cbc81f/651be/albc.jpg 170w,\n/static/060337072e65f1195a3c3cfe86cbc81f/d30a3/albc.jpg 340w,\n/static/060337072e65f1195a3c3cfe86cbc81f/7bf67/albc.jpg 680w,\n/static/060337072e65f1195a3c3cfe86cbc81f/9050f/albc.jpg 686w\" sizes=\"(max-width: 680px) 100vw, 680px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n    </span>\n          </p>\n<h3 id=\"how-aws-load-balancer-controller-works\" style=\"position:relative;\"><a href=\"#how-aws-load-balancer-controller-works\" aria-label=\"how aws load balancer controller works permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>How AWS Load Balancer Controller Works</h3>\n<p><strong>Design:</strong></p>\n<p><span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 76.47058823529412%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAAAsTAAALEwEAmpwYAAACzklEQVR42nWTeW/bRhDF9f2/R9F/0hQFUhRoUDQIDPdKbCuyboqixJsUuTyXt35d0nWCts6Ci9kBMW/nvXk744XV9T3XoSdMc94utoTmnwSnW/JgTlOlJN49nnHLxbylyU2apmUYhmnPXgTsuikmmUBzTvSVQ+yvsY17AlebohQHovjIz/MFUuaf614ErOua49GgLDJkIUiSmEqds1TgOiZCRKSJIIwFy5M7AV1VXa+Y/Qvwer1OUUqJ63pEUYzn+pSy4t3ygO35nE4GYRgiq4o8y/BtU8V0ovs/wP9S9kKPk2UwqPvnZojjXthv9lyCaPqflxXLrcbBsGjajuFrgEM/cAwPfP/+Na/ffcc+2NLKjrv3j/zw7U883Kypi4aV1/DN20+8utH4TY9p2/YrgKr9MAtYmyul0YIwD+jbHuvgsl/oKnq0dYcVN3zYhcyNiF9WJ6rmH8BRu2f9PufDlW7oSEuhhiPJlF6VrMnTQmlcElyE0jihzCVd3Y5FU+1s1OvZQ+N53KO4VS3xhY1jOco+CXVb4ancDzxlnYCkKImziEsaEHliuqxX3p0ANU3DMIwvk1afyGP2zpqzZpFET1M8+gd0Q8c1fArZEoiQnb1F356nTke7zcZuhBCkafqFsqJbyIKNteHx/EgmU5q6wRUOd9oHvNRBJAWp8ubGXLK2lsimVNKUzEbUpmmolK/GbsdcVpIiL9h92rK6W5IlubJFg332+f3mAUdFkZXK3AWLuy3zjxsFVk3azsqyxLZtLMtC13W2mzW7zYbjfsXprx8x/nhDnYXUaoJOWHG/DjGckkuc4kcly0PCSlfDqTrKsmA2djbSTZJEdSL4uDvy68Oa0Hew9CWmtqBWb7VWLApFybQdMtX9E5MaxwvwfHWhkqRplIbPE+7VHldQNhhxMZ3767iv6v9VdVBw9DRM6zwxGl/FoKba90+u6Kd84G9bMnNue+DvswAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"AWS Load Balancer Controller Design\" title=\"\" src=\"/static/516d5d80c6607d704258279a649ab87b/c5bb3/albc-design.png\" srcset=\"/static/516d5d80c6607d704258279a649ab87b/04472/albc-design.png 170w,\n/static/516d5d80c6607d704258279a649ab87b/9f933/albc-design.png 340w,\n/static/516d5d80c6607d704258279a649ab87b/c5bb3/albc-design.png 680w,\n/static/516d5d80c6607d704258279a649ab87b/01dae/albc-design.png 721w\" sizes=\"(max-width: 680px) 100vw, 680px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n    </span>\n          </p>\n<p>The following diagram details the AWS components this controller creates. It also demonstrates the route ingress traffic takes from the ALB to the Kubernetes cluster.</p>\n<p><strong>Ingress Creation:</strong></p>\n<p>This section describes each step (circle) above. This example demonstrates satisfying one ingress resource.</p>\n<ol>\n<li>The controller watches for ingress events from the API server. When it finds ingress resources that satisfy its requirements, it begins the creation of AWS resources.</li>\n<li>An ALB (ELBv2) is created in AWS for the new ingress resource. This ALB can be internet-facing or internal. You can also specify the subnets it's created in using annotations.</li>\n<li>Target Groups are created in AWS for each unique Kubernetes service described in the ingress resource.</li>\n<li>Listeners are created for every port detailed in your ingress resource annotations. When no port is specified, sensible defaults (80 or 443) are used. Certificates may also be attached via annotations.</li>\n<li>Rules are created for each path specified in your ingress resource. This ensures traffic to a specific path is routed to the correct Kubernetes Service.</li>\n</ol>\n<p>Along with the above, the controller also:</p>\n<ul>\n<li>Deletes AWS components when ingress resources are removed from Kubernetes.</li>\n<li>Modifies AWS components when ingress resources change in Kubernetes.</li>\n<li>Assembles a list of existing ingress-related AWS components on start-up, allowing you to recover if the controller were to be restarted.</li>\n</ul>\n<p><strong>Ingress Traffic:</strong></p>\n<p>AWS Load Balancer Controller supports two traffic modes:</p>\n<ul>\n<li><strong>Instance mode</strong></li>\n<li><strong>IP mode</strong></li>\n</ul>\n<p>By default, Instance mode is used. Users can explicitly select the mode via <code class=\"language-text\">alb.ingress.kubernetes.io/target-type</code> annotation.</p>\n<p><strong>Instance mode:</strong>\nIngress traffic starts at the ALB and reaches the Kubernetes nodes through each service's NodePort. This means that services referenced from ingress resources must be exposed by type:NodePort in order to be reached by the ALB.</p>\n<p><strong>IP mode:</strong>\nIngress traffic starts at the ALB and reaches the Kubernetes pods directly. CNIs must support directly accessible POD IP via <a href=\"https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/using-eni.html\" target=\"_blank\" rel=\"noopener noreferrer\">secondary IP addresses on ENI</a>.</p>\n<h3 id=\"-load-balancer-controller-installation\" style=\"position:relative;\"><a href=\"#-load-balancer-controller-installation\" aria-label=\" load balancer controller installation permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üöÄ Load Balancer Controller Installation</h3>\n<p>We recommend blocking access to instance metadata by requiring the instance to use <a href=\"https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/configuring-instance-metadata-service.html\" target=\"_blank\" rel=\"noopener noreferrer\">IMDSv2</a> only. For more information, please refer to the AWS guidance <a href=\"https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/configuring-instance-metadata-service.html\" target=\"_blank\" rel=\"noopener noreferrer\">here</a>. If you are using IMDSv2, set the hop limit to 2 or higher to allow the LBC to perform the metadata introspection.</p>\n<p>You can set the IMDSv2 as follows:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">aws ec2 modify-instance-metadata-options --http-put-response-hop-limit <span class=\"token number\">2</span> --http-tokens required <span class=\"token parameter variable\">--region</span> <span class=\"token operator\">&lt;</span>region<span class=\"token operator\">></span> --instance-id <span class=\"token operator\">&lt;</span>instance-id<span class=\"token operator\">></span></code></pre></div>\n<p>Instead of depending on IMDSv2, you can specify the AWS Region and the VPC via the controller flags <code class=\"language-text\">--aws-region</code> and <code class=\"language-text\">--aws-vpc-id</code>.</p>\n<h3 id=\"-configure-iam-permissions\" style=\"position:relative;\"><a href=\"#-configure-iam-permissions\" aria-label=\" configure iam permissions permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>‚úÖ Configure IAM Permissions</h3>\n<p>The controller runs on the worker nodes, so it needs access to the AWS ALB/NLB APIs with IAM permissions. The IAM permissions can either be set up using <a href=\"https://docs.aws.amazon.com/eks/latest/userguide/iam-roles-for-service-accounts.html\" target=\"_blank\" rel=\"noopener noreferrer\">IAM roles for service accounts (IRSA)</a> or can be attached directly to the worker node IAM roles. The best practice is using IRSA if you're using Amazon EKS. If you're using kOps or self-hosted Kubernetes, you must manually attach policies to node instances.</p>\n<p>The reference IAM policies contain the following permissive configuration:</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"Effect\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Allow\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"Action\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n        <span class=\"token string\">\"ec2:AuthorizeSecurityGroupIngress\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token string\">\"ec2:RevokeSecurityGroupIngress\"</span>\n    <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"Resource\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"*\"</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>We recommend further scoping down this configuration based on the VPC ID or cluster name resource tag.</p>\n<p><strong>Example condition for VPC ID:</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token property\">\"Condition\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"ArnEquals\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token property\">\"ec2:Vpc\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"arn:aws:ec2:&lt;REGION>:&lt;ACCOUNT-ID>:vpc/&lt;VPC-ID>\"</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p><strong>Example condition for cluster name resource tag:</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token property\">\"Condition\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"Null\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token property\">\"aws:ResourceTag/kubernetes.io/cluster/&lt;CLUSTER-NAME>\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"false\"</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h3 id=\"-create-an-iam-oidc-provider\" style=\"position:relative;\"><a href=\"#-create-an-iam-oidc-provider\" aria-label=\" create an iam oidc provider permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>‚úÖ Create an IAM OIDC Provider</h3>\n<p>You can skip this step if you already have one for your cluster:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">eksctl utils associate-iam-oidc-provider <span class=\"token punctuation\">\\</span>\n    <span class=\"token parameter variable\">--region</span> <span class=\"token operator\">&lt;</span>region-code<span class=\"token operator\">></span> <span class=\"token punctuation\">\\</span>\n    <span class=\"token parameter variable\">--cluster</span> <span class=\"token operator\">&lt;</span>your-cluster-name<span class=\"token operator\">></span> <span class=\"token punctuation\">\\</span>\n    <span class=\"token parameter variable\">--approve</span></code></pre></div>\n<h3 id=\"-download-an-iam-policy-for-the-lbc\" style=\"position:relative;\"><a href=\"#-download-an-iam-policy-for-the-lbc\" aria-label=\" download an iam policy for the lbc permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>‚úÖ Download an IAM Policy for the LBC</h3>\n<p>Use one of the following commands:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">curl</span> <span class=\"token parameter variable\">-o</span> iam-policy.json https://raw.githubusercontent.com/kubernetes-sigs/aws-load-balancer-controller/v2.6.0/docs/install/iam_policy.json</code></pre></div>\n<h3 id=\"-create-an-iam-policy-named-awsloadbalancercontrolleriampolicy\" style=\"position:relative;\"><a href=\"#-create-an-iam-policy-named-awsloadbalancercontrolleriampolicy\" aria-label=\" create an iam policy named awsloadbalancercontrolleriampolicy permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>‚úÖ Create an IAM Policy Named AWSLoadBalancerControllerIAMPolicy</h3>\n<p>If you downloaded a different policy, replace <code class=\"language-text\">iam-policy</code> with the name of the policy that you downloaded.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">aws iam create-policy <span class=\"token punctuation\">\\</span>\n    --policy-name AWSLoadBalancerControllerIAMPolicy <span class=\"token punctuation\">\\</span>\n    --policy-document file://iam-policy.json</code></pre></div>\n<p>Take note of the policy ARN that's returned.</p>\n<h3 id=\"-create-an-iam-role-and-kubernetes-serviceaccount-for-the-lbc\" style=\"position:relative;\"><a href=\"#-create-an-iam-role-and-kubernetes-serviceaccount-for-the-lbc\" aria-label=\" create an iam role and kubernetes serviceaccount for the lbc permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>‚úÖ Create an IAM Role and Kubernetes ServiceAccount for the LBC</h3>\n<p>Use the ARN from the previous step:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">eksctl create iamserviceaccount <span class=\"token punctuation\">\\</span>\n<span class=\"token parameter variable\">--cluster</span><span class=\"token operator\">=</span><span class=\"token operator\">&lt;</span>cluster-name<span class=\"token operator\">></span> <span class=\"token punctuation\">\\</span>\n<span class=\"token parameter variable\">--namespace</span><span class=\"token operator\">=</span>kube-system <span class=\"token punctuation\">\\</span>\n<span class=\"token parameter variable\">--name</span><span class=\"token operator\">=</span>aws-load-balancer-controller <span class=\"token punctuation\">\\</span>\n--attach-policy-arn<span class=\"token operator\">=</span>arn:aws:iam::<span class=\"token operator\">&lt;</span>AWS_ACCOUNT_ID<span class=\"token operator\">></span>:policy/AWSLoadBalancerControllerIAMPolicy <span class=\"token punctuation\">\\</span>\n--override-existing-serviceaccounts <span class=\"token punctuation\">\\</span>\n<span class=\"token parameter variable\">--region</span> <span class=\"token operator\">&lt;</span>region-code<span class=\"token operator\">></span> <span class=\"token punctuation\">\\</span>\n<span class=\"token parameter variable\">--approve</span></code></pre></div>\n<h3 id=\"-network-configuration\" style=\"position:relative;\"><a href=\"#-network-configuration\" aria-label=\" network configuration permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üåê Network Configuration</h3>\n<p>Review the <a href=\"https://docs.aws.amazon.com/eks/latest/userguide/sec-group-reqs.html\" target=\"_blank\" rel=\"noopener noreferrer\">worker nodes security group docs</a>. Your node security group must permit incoming traffic on TCP port 9443 from the Kubernetes control plane. This is needed for webhook access. If you use <code class=\"language-text\">eksctl</code>, this is the default configuration.</p>\n<h3 id=\"-add-controller-to-cluster\" style=\"position:relative;\"><a href=\"#-add-controller-to-cluster\" aria-label=\" add controller to cluster permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üöÄ Add Controller to Cluster</h3>\n<p>We recommend using the Helm chart to install the controller. The chart supports Fargate and facilitates updating the controller. If you want to run the controller on Fargate, use the Helm chart, since it doesn't depend on the cert-manager.</p>\n<p><strong>Detailed Instructions:</strong></p>\n<p>Follow the instructions in the <a href=\"https://github.com/aws/eks-charts/tree/master/stable/aws-load-balancer-controller\" target=\"_blank\" rel=\"noopener noreferrer\">aws-load-balancer-controller Helm chart</a>.</p>\n<p><strong>Add the EKS chart repo to Helm:</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">helm repo <span class=\"token function\">add</span> eks https://aws.github.io/eks-charts</code></pre></div>\n<p><strong>If upgrading the chart via helm upgrade, install the TargetGroupBinding CRDs:</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">kubectl apply <span class=\"token parameter variable\">-k</span> <span class=\"token string\">\"github.com/aws/eks-charts/stable/aws-load-balancer-controller//crds?ref=master\"</span></code></pre></div>\n<p><strong>Helm install command for clusters with IRSA:</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">helm <span class=\"token function\">install</span> aws-load-balancer-controller eks/aws-load-balancer-controller <span class=\"token parameter variable\">-n</span> kube-system <span class=\"token parameter variable\">--set</span> <span class=\"token assign-left variable\">clusterName</span><span class=\"token operator\">=</span><span class=\"token operator\">&lt;</span>cluster-name<span class=\"token operator\">></span> <span class=\"token parameter variable\">--set</span> <span class=\"token assign-left variable\">serviceAccount.create</span><span class=\"token operator\">=</span>false <span class=\"token parameter variable\">--set</span> <span class=\"token assign-left variable\">serviceAccount.name</span><span class=\"token operator\">=</span>aws-load-balancer-controller</code></pre></div>\n<h2 id=\"-calls-to-action\" style=\"position:relative;\"><a href=\"#-calls-to-action\" aria-label=\" calls to action permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üì¢ Calls to Action</h2>\n<h3 id=\"-give-amazon-eks-add-ons-a-spin\" style=\"position:relative;\"><a href=\"#-give-amazon-eks-add-ons-a-spin\" aria-label=\" give amazon eks add ons a spin permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üöÄ Give Amazon EKS Add-ons a Spin!</h3>\n<p>If you are running Amazon EKS and you haven't tried add-ons yet, now is the time. The new advanced configurations add more robust configuration management to Amazon EKS add-ons. You can now discover additional settings that are underpinned by the Helm charts we use to manage add-ons in your clusters. This provides for more granular configurations, a more flexible user experience, and better fits new and existing DevOps automation.</p>\n<h3 id=\"-check-out-our-containers-roadmap\" style=\"position:relative;\"><a href=\"#-check-out-our-containers-roadmap\" aria-label=\" check out our containers roadmap permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üîç Check Out Our Containers Roadmap!</h3>\n<p>Explore our <a href=\"https://github.com/aws/containers-roadmap/projects/1\" target=\"_blank\" rel=\"noopener noreferrer\">containers roadmap</a> to see what's coming next. If you have ideas about how we can improve Amazon EKS add-ons or other aspects of our container services, please use our containers roadmap to provide us feedback and review our existing roadmap items.</p>\n<p><img src=\"https://github.com/aws/containers-roadmap/raw/master/images/roadmap.png\" alt=\"Roadmap\" loading=\"lazy\">\n          </p>\n<h3 id=\"-share-your-feedback\" style=\"position:relative;\"><a href=\"#-share-your-feedback\" aria-label=\" share your feedback permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üí° Share Your Feedback</h3>\n<p>Your feedback is invaluable to us. Help us shape the future of Amazon EKS add-ons by sharing your thoughts and suggestions on our <a href=\"https://github.com/aws/containers-roadmap/issues\" target=\"_blank\" rel=\"noopener noreferrer\">GitHub issues page</a>.</p>\n<p><img src=\"https://github.githubassets.com/images/modules/logos_page/GitHub-Mark.png\" alt=\"Feedback\" loading=\"lazy\">\n          </p>\n<hr>\n<h2 id=\"-conclusion\" style=\"position:relative;\"><a href=\"#-conclusion\" aria-label=\" conclusion permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üìú Conclusion</h2>\n<p>Amazon EKS add-ons are curated software components that simplify and enhance the management of Kubernetes clusters. They streamline operations, boost security and stability, and offload the heavy lifting of configuring and maintaining essential components.</p>\n<p>This frees users to focus on developing and innovating containerized applications.</p>\n<p>In a world where cloud-native technologies are constantly evolving, efficient cluster management is critical. Amazon EKS add-ons provide a reliable and efficient way to ensure that Kubernetes clusters are always up-to-date, secure, and well-configured.</p>\n<p>By automating the deployment and maintenance of critical components, AWS empowers users to optimize their time and resources, making it easier than ever to harness the full potential of Kubernetes on the cloud.</p>\n<p><strong>References:</strong></p>\n<ul>\n<li><a href=\"https://kubernetes-sigs.github.io/aws-load-balancer-controller/v2.6/deploy/installation/\" target=\"_blank\" rel=\"noopener noreferrer\">Installation Guide‚Ää-‚ÄäAWS Load Balancer Controller</a></li>\n<li><a href=\"https://docs.aws.amazon.com/eks/latest/userguide/pod-networking.html\" target=\"_blank\" rel=\"noopener noreferrer\">Amazon EKS Pod Networking</a></li>\n<li><a href=\"https://kubernetes.io/docs/concepts/cluster-administration/networking/\" target=\"_blank\" rel=\"noopener noreferrer\">Kubernetes Networking Concepts</a></li>\n<li><a href=\"https://www.youtube.com/watch?v=7LRtytR6ZbA&#x26;t=296s\" target=\"_blank\" rel=\"noopener noreferrer\">YouTube: Kubernetes Networking</a></li>\n<li><a href=\"https://www.youtube.com/watch?v=U35C0EPSwoY\" target=\"_blank\" rel=\"noopener noreferrer\">YouTube: EKS Networking Deep Dive</a></li>\n<li><a href=\"https://joachim8675309.medium.com/eks-ebs-storage-with-eksctl-3e526f534215\" target=\"_blank\" rel=\"noopener noreferrer\">Medium: EKS EBS Storage with eksctl</a></li>\n<li><a href=\"https://docs.aws.amazon.com/eks/latest/userguide/eks-add-ons.html\" target=\"_blank\" rel=\"noopener noreferrer\">Amazon EKS Add-ons Documentation</a></li>\n</ul>\n<br>\n<p><strong><em>Until next time, „Å§„Å•„Åè üéâ</em></strong></p>\n<blockquote>\n<p>üí° Thank you for Reading !! üôåüèªüòÅüìÉ, see you in the next blog.ü§ò  <em><strong>Until next time üéâ</strong></em></p>\n</blockquote>\n<p>üöÄ Thank you for sticking up till the end. If you have any questions/feedback regarding this blog feel free to connect with me:</p>\n<p><strong>‚ôªÔ∏è LinkedIn:</strong> <a href=\"https://www.linkedin.com/in/rajhi-saif/\" target=\"_blank\" rel=\"noopener noreferrer\">https://www.linkedin.com/in/rajhi-saif/</a></p>\n<p><strong>‚ôªÔ∏è X/Twitter:</strong> <a href=\"https://x.com/rajhisaifeddine\" target=\"_blank\" rel=\"noopener noreferrer\">https://x.com/rajhisaifeddine</a></p>\n<p><strong>The end ‚úåüèª</strong></p>\n<h1 align=\"center\">üî∞ Keep Learning !! Keep Sharing !! üî∞</h1>\n<p><strong>üìÖ Stay updated</strong></p>\n<p>Subscribe to our newsletter for more insights on AWS cloud computing and containers.</p>","timeToRead":20,"rawMarkdownBody":"\n> **Amazon VPC CNI, CoreDNS, Kube-proxy, Amazon EBS CSI driver, Amazon EFS CSI driver, ADOT, AWS Load Balancer Controller add-on and more üòå**\n\n**There's no magic, just mad science üöÄ**\n\n## ü§ñ Introduction\n\nMuch like the formidable Transformers who join forces to create an unstoppable force, Amazon EKS add-ons bring a new level of functionality and performance to your Kubernetes applications. These add-ons are akin to specialized tools that enhance the operational capabilities of your EKS cluster, ensuring seamless interaction with underlying AWS resources for networking, compute, and storage.\n\nWhether it's observability agents or purpose-built Kubernetes drivers, these add-ons are the unsung heroes that bolster your cluster's capabilities.\n\nWhile EKS provides the foundation for running containerized applications, it's the Amazon EKS add-ons that take your cluster's capabilities to the next level. \n\nThese add-ons are like the Swiss Army knives of Kubernetes, offering a range of supporting operational capabilities that enhance security, stability, and performance.\n\n---\n\n## ü•Ö Goals and Objectives\n\nIn this blog post, we'll explore the role and importance of Amazon EKS add-ons, shedding light on how they can simplify the management of your EKS clusters.\n\n---\n\n## üßÆ Amazon EKS Add-ons\n\nAmazon EKS add-ons are additional software that enhance Kubernetes applications, providing operational support. They're not tied to a specific application and can include things like observability tools and drivers for interacting with AWS resources. These add-ons are developed and maintained by the Kubernetes community, cloud providers like AWS, or third-party vendors.\n\nAmazon EKS automatically installs certain self-managed add-ons like [Amazon VPC CNI plugin](https://aws.github.io/aws-eks-best-practices/networking/index/), [kube-proxy](https://kubernetes.io/docs/reference/command-line-tools-reference/kube-proxy/), and [CoreDNS](https://coredns.io/) for every cluster, but you can customize and update them as needed.\n\nThese add-ons from Amazon EKS come pre-packaged with the latest security updates and bug fixes, all validated by AWS to work seamlessly with Amazon EKS clusters. They simplify the process of ensuring your clusters are secure and stable, reducing the manual work needed for installation, configuration, and updates. If you already have a self-managed add-on like kube-proxy running, you can switch to using the Amazon EKS version to benefit from its features.\n\n* **AWS EKS add-ons** are software components that are provided and managed by AWS. Some of these add-ons are automatically installed on every EKS cluster. These add-ons make it easier to secure, stabilize, and update your clusters. They offer a simplified approach to managing your EKS clusters.\n\n* **Self-managed add-ons**, on the other hand, are managed by the user. This means that the user is responsible for installing, configuring, and updating these add-ons. Self-managed add-ons offer more flexibility, but they require more manual effort to manage.\n\nYou can adjust specific configuration settings for Amazon EKS add-ons through the [Amazon EKS API](https://docs.aws.amazon.com/eks/latest/APIReference/Welcome.html). Additionally, you have the flexibility to modify configuration fields not managed by Amazon EKS directly within the Kubernetes cluster after the add-on is installed. These changes won't be overridden by Amazon EKS, thanks to the Kubernetes server-side apply feature.\n\n## üåê Amazon VPC CNI Plugin\n\nAmazon VPC CNI Plugin is a Kubernetes container network interface (CNI) plugin that provides native VPC networking for your cluster. The self-managed or managed type of this add-on is installed on each Amazon EC2 node by default.\n\n### What is a Container Networking Interface (CNI)? ü§î\n\n**Container Networking Interface (CNI):**\n\nCNI (Container Network Interface), a [Cloud Native Computing Foundation](https://www.cncf.io/) project, consists of a specification and libraries for writing plugins to configure network interfaces in Linux containers, along with a number of supported plugins. CNI concerns itself only with the network connectivity of containers and removing allocated resources when the container is deleted. Because of this focus, CNI has a wide range of support and the specification is simple and vendor-neutral.\n\nCNI plugins are used by Kubernetes, Cloud Foundry, Podman, CRI-O, etc.\n\nThe illustration diagram below describes the CNI plugin used by Kubernetes:\n\n![CNI Plugin](./cni.png)\n\n- **Pods have their own IP addresses.**\n- When you install Kubernetes, you need to choose a CNI plugin.\n- The node manages pod subnets and allocates pod IPs locally.\n- Communication/Access from one pod to another pod is through the CNI bridge (layer 2 bridge).\n- Flannel creates an interface called Flannel 1, which is an interface between the container runtime and network and is also used to configure network routes.\n- The Flannel interface communicates to another node through VXLAN (virtual extensible LAN, encapsulated as UDP packets and exchanged between the hosts).\n\nNetwork configurations are taken care of by the CNI plugin chosen during installation, which results in fewer network failures.\n\n### Amazon VPC CNI Plugin üõ†Ô∏è\n\nAs we discussed in the previous section, the CNI plugin uses VXLAN, BGP, or other overlay networks for communication and encapsulating the packets over the network. In the case of AWS, encapsulation is taking place at the hardware when using AWS Elastic Network Interfaces (ENI) inside a VPC. AWS CNI uses native networking and removes the dependency on the secondary network for encapsulation.\n\nThe illustration diagram below describes the Amazon VPC CNI native plugin for EKS:\n\n![Amazon VPC CNI Plugin](./vpc-cni.png)\n\n**Other Kubernetes CNI providers:**\n\n![CNI Plugin](./other-cnis.png)\n\n### üîê Required IAM Permissions\n\nThis add-on uses the [IAM roles for service accounts IRSA](https://docs.aws.amazon.com/eks/latest/userguide/iam-roles-for-service-accounts.html) capability of Amazon EKS. If your cluster uses the `IPv4` family, the permissions in the [`AmazonEKS_CNI_Policy`](https://docs.aws.amazon.com/IAM/latest/UserGuide/access_policies_create.html) are required. If your cluster uses the IPv6 family, you must create an [IAM policy](https://docs.aws.amazon.com/IAM/latest/UserGuide/access_policies_create.html) with the permissions in [IPv6 mode](https://github.com/aws/amazon-vpc-cni-k8s/blob/master/docs/iam-policy.md#ipv6-mode).\n\nYou can create an IAM role, attach one of the policies to it, and annotate the Kubernetes service account used by the add-on with the following command:\n\n```bash\neksctl create iamserviceaccount \\ \n    --name aws-node --namespace kube-system \\ \n    --cluster my-cluster --role-name AmazonEKSVPCCNIRole \\     \n    --role-only --attach-policy-arn arn:aws:iam::aws:policy/AmazonEKS_CNI_Policy \\\n    --approve\n```\n\nReplace `my-cluster` with the name of your cluster and `AmazonEKSVPCCNIRole` with the name for your role. If your cluster uses the IPv6 family, then replace `AmazonEKS_CNI_Policy` with the name of the policy that you created.\n\nThis command requires that you have [eksctl](https://eksctl.io/) installed on your device. If you need to use a different tool to create the role, attach the policy to it, and annotate the Kubernetes service account, see [Configuring a Kubernetes service account to assume an IAM role](https://docs.aws.amazon.com/eks/latest/userguide/associate-service-account-role.html).\n\n### Additional informations\n\nTo learn more about the add-on's configurable settings, see [aws-vpc-cni-k8s on GitHub](https://github.com/aws/amazon-vpc-cni-k8s/blob/master/README.md).\n\nTo learn more about the plugin, see [Proposal: CNI plugin for Kubernetes networking over AWS VPC](https://github.com/aws/amazon-vpc-cni-k8s/blob/master/docs/cni-proposal.md). \n\nFor more information about creating the add-on, see [Creating the Amazon EKS add-on.](https://docs.aws.amazon.com/eks/latest/userguide/managing-vpc-cni.html#vpc-add-on-create)\n\nYou can only update one minor version at a time. For example, if your current version is `1.25.x-eksbuild.y` and you want to update to `1.27.x-eksbuild.y`, then you must update your current version to `1.26.x-eksbuild.y` and then update it again to `1.27.x-eksbuild.y`.\n\nFor more information about updating the add-on, see [Updating the Amazon EKS add-on](https://docs.aws.amazon.com/eks/latest/userguide/managing-vpc-cni.html#vpc-add-on-update).\n\n\n## üóÑÔ∏è Amazon EBS CSI Driver\n\nBefore we dive into this section, make sure to familiarize yourself with the Kubernetes storage objects (volumes, persistent volumes (PV), persistent volume claim (PVC), dynamic provisioning, and ephemeral storage) that were introduced in the [Storage](https://www.eksworkshop.com/docs/fundamentals/storage/) main section.\n\n[`emptyDir`](https://kubernetes.io/docs/concepts/storage/volumes/#emptydir) is an example of ephemeral volumes, and we're currently utilizing it in the MySQL StatefulSet. However, we'll work on updating it in this chapter to a Persistent Volume (PV) using Dynamic Volume Provisioning.\n\nThe [**Container Storage Interface (CSI)**](https://github.com/container-storage-interface/spec/blob/master/spec.md) is a standard for exposing arbitrary block and file storage systems to containerized workloads on Container Orchestration Systems (COs) like Kubernetes. The [Kubernetes Container Storage Interface (CSI)](https://kubernetes-csi.github.io/docs/) helps you run stateful containerized applications. CSI drivers provide a CSI interface that allows Kubernetes clusters to manage the lifecycle of persistent volumes. Amazon EKS makes it easier for you to run stateful workloads by offering CSI drivers for Amazon EBS.\n\nBy using CSI, third-party storage providers can write and deploy plugins exposing new storage systems in Kubernetes without ever having to touch the core Kubernetes code.\n\nIn order to use Amazon EBS volumes with dynamic provisioning on your EKS cluster, you need to confirm that the EBS CSI Driver is installed. The [Amazon Elastic Block Store (Amazon EBS) Container Storage Interface (CSI) driver](https://github.com/kubernetes-sigs/aws-ebs-csi-driver) allows Amazon Elastic Kubernetes Service (Amazon EKS) clusters to manage the lifecycle of Amazon EBS volumes for persistent volumes.\n\n![Amazon EBS CSI Driver](./ebs.png)\n\nThe Amazon Elastic Block Store (Amazon EBS) Container Storage Interface (CSI) driver allows Amazon Elastic Kubernetes Service (Amazon EKS) clusters to manage the lifecycle of Amazon EBS volumes for persistent volumes.\n\n### üìù Considerations for Using the Amazon EBS CSI Driver\n\n- The Amazon EBS CSI plugin requires IAM permissions to make calls to AWS APIs on your behalf. For more information, see [Creating the Amazon EBS CSI driver IAM role](https://docs.aws.amazon.com/eks/latest/userguide/csi-iam-role.html).\n- You can't mount Amazon EBS volumes to Fargate Pods.\n- You can run the Amazon EBS CSI controller on Fargate nodes, but the Amazon EBS CSI node DaemonSet can only run on Amazon EC2 instances.\n- Alpha features of the Amazon EBS CSI driver aren't supported on Amazon EKS clusters.\n\nThe Amazon EBS CSI driver isn't installed when you first create a cluster. To use the driver, you must add it as an Amazon EKS add-on or as a self-managed add-on.\n\nFor instructions on how to add it as an Amazon EKS add-on, see [Managing the Amazon EBS CSI driver as an Amazon EKS add-on](https://docs.aws.amazon.com/eks/latest/userguide/managing-ebs-csi.html).\n\nFor instructions on how to add it as a self-managed installation, see the [Amazon EBS Container Storage Interface (CSI) driver project on GitHub](https://github.com/kubernetes-sigs/aws-ebs-csi-driver).\n\nThis add-on uses the [IAM roles for service accounts capability IRSA](https://docs.aws.amazon.com/eks/latest/userguide/iam-roles-for-service-accounts.html) of Amazon EKS. The permissions in the [`AmazonEBSCSIDriverPolicy`](https://docs.aws.amazon.com/aws-managed-policy/latest/reference/AmazonEBSCSIDriverPolicy.html) AWS managed policy are required. You can create an IAM role and attach the managed policy to it with the following command. Replace `my-cluster` with the name of your cluster and `AmazonEKS_EBS_CSI_DriverRole` with the name for your role. This command requires that you have [eksctl](https://eksctl.io/) installed on your device. If you need to use a different tool or you need to use a custom KMS key for encryption, see [Creating the Amazon EBS CSI driver IAM role](https://docs.aws.amazon.com/eks/latest/userguide/csi-iam-role.html).\n\n```bash\neksctl create iamserviceaccount \\     \n    --name ebs-csi-controller-sa \\     \n    --namespace kube-system \\     \n    --cluster my-cluster \\     \n    --role-name AmazonEKS_EBS_CSI_DriverRole \\     \n    --role-only \\     \n    --attach-policy-arn arn:aws:iam::aws:policy/service-role/AmazonEBSCSIDriverPolicy \\     \n    --approve\n```\n\n### üõ†Ô∏è Adding the Amazon EBS CSI Add-on Using `eksctl`\n\nRun the following command. Replace `my-cluster` with the name of your cluster, `111122223333` with your account ID, and `AmazonEKS_EBS_CSI_DriverRole` with the name of the IAM role created earlier. If your cluster is in the AWS GovCloud (US-East) or AWS GovCloud (US-West) AWS Regions, then replace `arn:aws:` with `arn:aws-us-gov:`.\n\n```bash\neksctl create addon --name aws-ebs-csi-driver --cluster my-cluster --service-account-role-arn arn:aws:iam::111122223333:role/AmazonEKS_EBS_CSI_DriverRole --force\n```\n\nIf you remove the `--force` option and any of the Amazon EKS add-on settings conflict with your existing settings, then updating the Amazon EKS add-on fails, and you receive an error message to help you resolve the conflict. Before specifying this option, make sure that the Amazon EKS add-on doesn't manage settings that you need to manage, because those settings are overwritten with this option. For more information about other options for this setting, see [Addons in the eksctl documentation](https://eksctl.io/usage/addons/). For more information about Amazon EKS Kubernetes field management, see [Kubernetes field management](https://docs.aws.amazon.com/eks/latest/userguide/kubernetes-field-management.html).\n\n### üìö Additional Information\n\nTo learn more about the add-on, see [Amazon EBS CSI driver](https://docs.aws.amazon.com/eks/latest/userguide/ebs-csi.html).\n\nTo add the Amazon EBS CSI add-on using `eksctl`, follow the instructions provided above.\n\nFor more information about creating the add-on, see [Creating the Amazon EBS CSI driver IAM role](https://docs.aws.amazon.com/eks/latest/userguide/ebs-csi.html).\n\nFor more information about updating the add-on, see [Updating the Amazon EBS CSI driver](https://docs.aws.amazon.com/eks/latest/userguide/ebs-csi.html).\n\n## üìÇ Amazon EFS CSI Driver\n\n![Amazon EFS](./efs.jpg)\n\n[Amazon Elastic File System (Amazon EFS)](https://docs.aws.amazon.com/efs/latest/ug/whatisefs.html) provides serverless, fully elastic file storage so that you can share file data without provisioning or managing storage capacity and performance. The [Amazon EFS Container Storage Interface (CSI) driver](https://github.com/kubernetes-sigs/aws-efs-csi-driver) provides a CSI interface that allows Kubernetes clusters running on AWS to manage the lifecycle of Amazon EFS file systems. This topic shows you how to deploy the Amazon EFS CSI driver to your Amazon EKS cluster.\n\nThe EFS CSI driver makes it simple to configure elastic file storage for both EKS and self-managed Kubernetes clusters running on AWS using standard Kubernetes interfaces. Applications running in Kubernetes can use EFS file systems to share data between pods in a scale-out group, or with other applications running within or outside of Kubernetes. EFS can also help Kubernetes applications be highly available because all data written to EFS is written to multiple AWS Availability Zones. If a Kubernetes pod is terminated and relaunched, the CSI driver will reconnect the EFS file system, even if the pod is relaunched in a different AWS Availability Zone.\n\n### üõ†Ô∏è Creating Your Amazon EFS CSI Driver IAM Role with `eksctl`\n\nRun the following command to create the IAM role and Kubernetes service account. It also attaches the policy to the role, annotates the Kubernetes service account with the IAM role ARN, and adds the Kubernetes service account name to the trust policy for the IAM role. Replace `my-cluster` with your cluster name and `AmazonEKS_EFS_CSI_DriverRole` with the name for your role.\n\n```bash\nexport cluster_name=my-cluster\nexport role_name=AmazonEKS_EFS_CSI_DriverRole\n\neksctl create iamserviceaccount \\\n    --name efs-csi-controller-sa \\\n    --namespace kube-system \\\n    --cluster $cluster_name \\\n    --role-name $role_name \\\n    --role-only \\\n    --attach-policy-arn arn:aws:iam::aws:policy/service-role/AmazonEFSCSIDriverPolicy \\\n    --approve\n\nTRUST_POLICY=$(aws iam get-role --role-name $role_name --query 'Role.AssumeRolePolicyDocument' | \\\n    sed -e 's/efs-csi-controller-sa/efs-csi-*/' -e 's/StringEquals/StringLike/')\n\naws iam update-assume-role-policy --role-name $role_name --policy-document \"$TRUST_POLICY\"\n```\n\n### üöÄ Installing the Amazon EFS CSI Driver\n\nTo use Amazon EFS file system with dynamic provisioning on your EKS cluster, confirm that the EFS CSI Driver is installed. The Amazon Elastic File System Container Storage Interface (CSI) Driver implements the CSI specification for container orchestrators to manage the lifecycle of Amazon EFS file systems.\n\nWe recommend that you install the Amazon EFS CSI driver through the Amazon EKS add-on. To add an Amazon EKS add-on to your cluster, see [Creating an add-on](https://docs.aws.amazon.com/eks/latest/userguide/eks-add-ons.html). For more information about add-ons, see [Amazon EKS add-ons](https://docs.aws.amazon.com/eks/latest/userguide/eks-add-ons.html).\n\nIf you're unable to use the Amazon EKS add-on, we encourage you to submit an issue about why you can't to the [Containers roadmap GitHub repository](https://github.com/aws/containers-roadmap/issues).\n\nAlternatively, if you want a self-managed installation of the Amazon EFS CSI driver, see [Installation on GitHub](https://github.com/kubernetes-sigs/aws-efs-csi-driver/blob/master/docs/README.md#installation).\n\n## üß© Amazon EKS CoreDNS\n\nCoreDNS is a flexible, extensible DNS server that can serve as the Kubernetes cluster DNS. The self-managed or managed type of this add-on was installed, by default, when you created your cluster. When you launch an Amazon EKS cluster with at least one node, two replicas of the CoreDNS image are deployed by default, regardless of the number of nodes deployed in your cluster. The CoreDNS Pods provide name resolution for all Pods in the cluster. You can deploy the CoreDNS Pods to Fargate nodes if your cluster includes an [AWS Fargate profile](https://docs.aws.amazon.com/eks/latest/userguide/fargate-profile.html) with a namespace that matches the namespace for the CoreDNS deployment.\n\n![CoreDNS](./coredns.png)\n\nCoreDNS is an open-source DNS service with a Kubernetes plugin for service discovery and by default, it's a DNS server for most of the Kubernetes distributions. Service discovery is actually the main motivation behind hosting a DNS server inside the Kubernetes cluster, otherwise, all DNS queries would go to an external DNS server.\n\nBetter to explain with a drawing:\n\n![DNS](./dns.jpg)\n\n1. Application makes a DNS query.\n2. \n    - **A:** If the record is a Kubernetes service record, like \"application2-internal-service\", CoreDNS responds with the service IP address result.\n    - **B:** If the record is an external endpoint record like \"api.google.com\", then CoreDNS asks the record to the external DNS server.\n\nThis architecture is done via `kubelet`, it overwrites the `/etc/resolv.conf` file with content below:\n\n```plaintext\nnameserver 172.20.0.10  # COREDNS \"SERVICE\" IP ADDRESS\nsearch [clustername].svc.cluster.local svc.cluster.local cluster.local eu-central-1.compute.internal\noptions ndots:5\n```\n\nEach pod inherits this `/etc/resolv.conf` configuration and thanks to the \"nameserver\" line, each pod goes to the CoreDNS service endpoint and CoreDNS pods after that.\n\n### üõ†Ô∏è Creating the Amazon EKS Add-on\n\n1. **See which version of the add-on is installed on your cluster:**\n\n     ```bash\n     kubectl describe deployment coredns --namespace kube-system | grep coredns: | cut -d : -f 3\n     ```\n\n     An example output is as follows:\n\n     ```plaintext\n     v1.9.3-eksbuild.7\n     ```\n\n2. **See which type of the add-on is installed on your cluster:**\n\n     Depending on the tool that you created your cluster with, you might not currently have the Amazon EKS add-on type installed on your cluster. Replace `my-cluster` with the name of your cluster.\n\n     ```bash\n     aws eks describe-addon --cluster-name my-cluster --addon-name coredns --query addon.addonVersion --output text\n     ```\n\n     If a version number is returned, you have the Amazon EKS type of the add-on installed on your cluster and don't need to complete the remaining steps in this procedure. If an error is returned, you don't have the Amazon EKS type of the add-on installed on your cluster. Complete the remaining steps of this procedure to install it.\n\n3. **Save the configuration of your currently installed add-on:**\n\n     ```bash\n     kubectl get deployment coredns -n kube-system -o yaml > aws-k8s-coredns-old.yaml\n     ```\n\n4. **Create the add-on using the AWS CLI:**\n\n     If you want to use the AWS Management Console or `eksctl` to create the add-on, see [Creating an add-on](https://docs.aws.amazon.com/eks/latest/userguide/eks-add-ons.html) and specify `coredns` for the add-on name. Copy the command that follows to your device. Make the following modifications to the command, as needed, and then run the modified command.\n\n     Replace `my-cluster` with the name of your cluster. Replace `v1.10.1-eksbuild.4` with the latest version listed in the latest version table for your cluster version.\n\n     ```bash\n     aws eks create-addon --cluster-name my-cluster --addon-name coredns --addon-version v1.10.1-eksbuild.4\n     ```\n\n     If you've applied custom settings to your current add-on that conflict with the default settings of the Amazon EKS add-on, creation might fail. If creation fails, you receive an error that can help you resolve the issue. Alternatively, you can add `--resolve-conflicts OVERWRITE` to the previous command. This allows the add-on to overwrite any existing custom settings. Once you've created the add-on, you can update it with your custom settings.\n\n5. **Confirm that the latest version of the add-on for your cluster's Kubernetes version was added to your cluster:**\n\n     Replace `my-cluster` with the name of your cluster.\n\n     ```bash\n     aws eks describe-addon --cluster-name my-cluster --addon-name coredns --query addon.addonVersion --output text\n     ```\n\n     It might take several seconds for add-on creation to complete. An example output is as follows:\n\n     ```plaintext\n     v1.10.1-eksbuild.4\n     ```\n\n6. **If you made custom settings to your original add-on, before you created the Amazon EKS add-on, use the configuration that you saved in a previous step to [update](https://docs.aws.amazon.com/eks/latest/userguide/coredns-add-on-update.html) the Amazon EKS add-on with your custom settings.**\n\nFor more information, visit the [Amazon EKS Documentation](https://docs.aws.amazon.com/eks/latest/userguide/managing-coredns.html).\n\n## üõ†Ô∏è Kube-proxy Amazon EKS Add-on\n\nThe **Kube-proxy Amazon EKS Add-on** adds support for [kube-proxy](https://kubernetes.io/docs/concepts/overview/components/#kube-proxy). Kube-proxy maintains network rules on each Amazon EC2 node, enabling network communication to your pods\n\n> Note that kube-proxy is not deployed to Fargate nodes.\n\nFor more information, see [kube-proxy in the Kubernetes documentation](https://kubernetes.io/docs/reference/command-line-tools-reference/kube-proxy/).\n\nInstalling Kube-proxy as an Amazon EKS add-on reduces the amount of work needed to install, configure, and update add-ons. It includes the latest security patches, bug fixes, and is validated by AWS to work with Amazon EKS. This ensures that Amazon EKS clusters are secure and stable.\n\nAmazon EKS automatically installs Kube-proxy as a self-managed add-on for every cluster. If it is already running on your cluster, you can still install it as an Amazon EKS add-on to start benefiting from the capabilities of Amazon EKS add-ons.\n\nTo learn more about kube-proxy, see [kube-proxy in the Kubernetes documentation](https://kubernetes.io/docs/reference/command-line-tools-reference/kube-proxy/).\n\n### üîÑ Update Information\n\nBefore updating your current version, consider the following requirements:\n\n- **Compatibility and Skew Policy:** Kube-proxy on an Amazon EKS cluster has the same compatibility and skew policy as Kubernetes.\n- **Version Matching:** Kube-proxy must be the same minor version as kubelet on your Amazon EC2 nodes.\n- **Control Plane Version:** Kube-proxy can't be later than the minor version of your cluster's control plane.\n- **Version Gap:** The kube-proxy version on your Amazon EC2 nodes can't be more than two minor versions earlier than your control plane. For example, if your control plane is running Kubernetes 1.27, then the kube-proxy minor version can't be earlier than 1.25.\n- **Node Update:** If you recently updated your cluster to a new Kubernetes minor version, then update your Amazon EC2 nodes to the same minor version before updating kube-proxy to the same minor version as your nodes.\n\nFor more detailed information, visit the [Amazon EKS Documentation](https://docs.aws.amazon.com/eks/latest/userguide/managing-kube-proxy.html).\n\n## üåê AWS Load Balancer Controller Add-on\n\nAWS Load Balancer Controller is a controller to help manage Elastic Load Balancers for a Kubernetes cluster.\n\nIt satisfies [Kubernetes Ingress resources](https://kubernetes.io/docs/concepts/services-networking/ingress/) by provisioning [Application Load Balancers](https://docs.aws.amazon.com/elasticloadbalancing/latest/application/introduction.html). It satisfies [Kubernetes Service resources](https://kubernetes.io/docs/concepts/services-networking/service/) by provisioning [Network Load Balancers](https://docs.aws.amazon.com/elasticloadbalancing/latest/network/introduction.html).\n\nThis project was formerly known as \"AWS ALB Ingress Controller\". We rebranded it to be \"AWS Load Balancer Controller\". AWS ALB Ingress Controller was originated by [Ticketmaster](https://github.com/ticketmaster) and [CoreOS](https://github.com/coreos) as part of Ticketmaster's move to AWS and CoreOS Tectonic. Learn more about Ticketmaster's Kubernetes initiative from Justin Dean's video at [Tectonic Summit](https://www.youtube.com/watch?v=wqXVKneP0Hg). AWS ALB Ingress Controller was donated to Kubernetes SIG-AWS to allow AWS, CoreOS, Ticketmaster, and other SIG-AWS contributors to officially maintain the project. SIG-AWS reached this consensus on June 1, 2018.\n\n![AWS Load Balancer Controller](./albc.jpg)\n\n### How AWS Load Balancer Controller Works\n\n**Design:**\n\n![AWS Load Balancer Controller Design](./albc-design.png)\n\nThe following diagram details the AWS components this controller creates. It also demonstrates the route ingress traffic takes from the ALB to the Kubernetes cluster.\n\n**Ingress Creation:**\n\nThis section describes each step (circle) above. This example demonstrates satisfying one ingress resource.\n\n1. The controller watches for ingress events from the API server. When it finds ingress resources that satisfy its requirements, it begins the creation of AWS resources.\n2. An ALB (ELBv2) is created in AWS for the new ingress resource. This ALB can be internet-facing or internal. You can also specify the subnets it's created in using annotations.\n3. Target Groups are created in AWS for each unique Kubernetes service described in the ingress resource.\n4. Listeners are created for every port detailed in your ingress resource annotations. When no port is specified, sensible defaults (80 or 443) are used. Certificates may also be attached via annotations.\n5. Rules are created for each path specified in your ingress resource. This ensures traffic to a specific path is routed to the correct Kubernetes Service.\n\nAlong with the above, the controller also:\n- Deletes AWS components when ingress resources are removed from Kubernetes.\n- Modifies AWS components when ingress resources change in Kubernetes.\n- Assembles a list of existing ingress-related AWS components on start-up, allowing you to recover if the controller were to be restarted.\n\n**Ingress Traffic:**\n\nAWS Load Balancer Controller supports two traffic modes:\n- **Instance mode**\n- **IP mode**\n\nBy default, Instance mode is used. Users can explicitly select the mode via `alb.ingress.kubernetes.io/target-type` annotation.\n\n**Instance mode:**\nIngress traffic starts at the ALB and reaches the Kubernetes nodes through each service's NodePort. This means that services referenced from ingress resources must be exposed by type:NodePort in order to be reached by the ALB.\n\n**IP mode:**\nIngress traffic starts at the ALB and reaches the Kubernetes pods directly. CNIs must support directly accessible POD IP via [secondary IP addresses on ENI](https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/using-eni.html).\n\n### üöÄ Load Balancer Controller Installation\n\nWe recommend blocking access to instance metadata by requiring the instance to use [IMDSv2](https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/configuring-instance-metadata-service.html) only. For more information, please refer to the AWS guidance [here](https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/configuring-instance-metadata-service.html). If you are using IMDSv2, set the hop limit to 2 or higher to allow the LBC to perform the metadata introspection.\n\nYou can set the IMDSv2 as follows:\n\n```bash\naws ec2 modify-instance-metadata-options --http-put-response-hop-limit 2 --http-tokens required --region <region> --instance-id <instance-id>\n```\n\nInstead of depending on IMDSv2, you can specify the AWS Region and the VPC via the controller flags `--aws-region` and `--aws-vpc-id`.\n\n### ‚úÖ Configure IAM Permissions\n\nThe controller runs on the worker nodes, so it needs access to the AWS ALB/NLB APIs with IAM permissions. The IAM permissions can either be set up using [IAM roles for service accounts (IRSA)](https://docs.aws.amazon.com/eks/latest/userguide/iam-roles-for-service-accounts.html) or can be attached directly to the worker node IAM roles. The best practice is using IRSA if you're using Amazon EKS. If you're using kOps or self-hosted Kubernetes, you must manually attach policies to node instances.\n\nThe reference IAM policies contain the following permissive configuration:\n\n```json\n{\n    \"Effect\": \"Allow\",\n    \"Action\": [\n        \"ec2:AuthorizeSecurityGroupIngress\",\n        \"ec2:RevokeSecurityGroupIngress\"\n    ],\n    \"Resource\": \"*\"\n}\n```\n\nWe recommend further scoping down this configuration based on the VPC ID or cluster name resource tag.\n\n**Example condition for VPC ID:**\n\n```json\n\"Condition\": {\n    \"ArnEquals\": {\n        \"ec2:Vpc\": \"arn:aws:ec2:<REGION>:<ACCOUNT-ID>:vpc/<VPC-ID>\"\n    }\n}\n```\n\n**Example condition for cluster name resource tag:**\n\n```json\n\"Condition\": {\n    \"Null\": {\n        \"aws:ResourceTag/kubernetes.io/cluster/<CLUSTER-NAME>\": \"false\"\n    }\n}\n```\n\n### ‚úÖ Create an IAM OIDC Provider\n\nYou can skip this step if you already have one for your cluster:\n\n```bash\neksctl utils associate-iam-oidc-provider \\\n    --region <region-code> \\\n    --cluster <your-cluster-name> \\\n    --approve\n```\n\n### ‚úÖ Download an IAM Policy for the LBC\n\nUse one of the following commands:\n\n```bash\ncurl -o iam-policy.json https://raw.githubusercontent.com/kubernetes-sigs/aws-load-balancer-controller/v2.6.0/docs/install/iam_policy.json\n```\n\n### ‚úÖ Create an IAM Policy Named AWSLoadBalancerControllerIAMPolicy\n\nIf you downloaded a different policy, replace `iam-policy` with the name of the policy that you downloaded.\n\n```bash\naws iam create-policy \\\n    --policy-name AWSLoadBalancerControllerIAMPolicy \\\n    --policy-document file://iam-policy.json\n```\n\nTake note of the policy ARN that's returned.\n\n### ‚úÖ Create an IAM Role and Kubernetes ServiceAccount for the LBC\n\nUse the ARN from the previous step:\n\n```bash\neksctl create iamserviceaccount \\\n--cluster=<cluster-name> \\\n--namespace=kube-system \\\n--name=aws-load-balancer-controller \\\n--attach-policy-arn=arn:aws:iam::<AWS_ACCOUNT_ID>:policy/AWSLoadBalancerControllerIAMPolicy \\\n--override-existing-serviceaccounts \\\n--region <region-code> \\\n--approve\n```\n\n### üåê Network Configuration\n\nReview the [worker nodes security group docs](https://docs.aws.amazon.com/eks/latest/userguide/sec-group-reqs.html). Your node security group must permit incoming traffic on TCP port 9443 from the Kubernetes control plane. This is needed for webhook access. If you use `eksctl`, this is the default configuration.\n\n### üöÄ Add Controller to Cluster\n\nWe recommend using the Helm chart to install the controller. The chart supports Fargate and facilitates updating the controller. If you want to run the controller on Fargate, use the Helm chart, since it doesn't depend on the cert-manager.\n\n**Detailed Instructions:**\n\nFollow the instructions in the [aws-load-balancer-controller Helm chart](https://github.com/aws/eks-charts/tree/master/stable/aws-load-balancer-controller).\n\n**Add the EKS chart repo to Helm:**\n\n```bash\nhelm repo add eks https://aws.github.io/eks-charts\n```\n\n**If upgrading the chart via helm upgrade, install the TargetGroupBinding CRDs:**\n\n```bash\nkubectl apply -k \"github.com/aws/eks-charts/stable/aws-load-balancer-controller//crds?ref=master\"\n```\n\n**Helm install command for clusters with IRSA:**\n\n```bash\nhelm install aws-load-balancer-controller eks/aws-load-balancer-controller -n kube-system --set clusterName=<cluster-name> --set serviceAccount.create=false --set serviceAccount.name=aws-load-balancer-controller\n```\n\n## üì¢ Calls to Action\n\n### üöÄ Give Amazon EKS Add-ons a Spin!\n\nIf you are running Amazon EKS and you haven't tried add-ons yet, now is the time. The new advanced configurations add more robust configuration management to Amazon EKS add-ons. You can now discover additional settings that are underpinned by the Helm charts we use to manage add-ons in your clusters. This provides for more granular configurations, a more flexible user experience, and better fits new and existing DevOps automation.\n\n### üîç Check Out Our Containers Roadmap!\n\nExplore our [containers roadmap](https://github.com/aws/containers-roadmap/projects/1) to see what's coming next. If you have ideas about how we can improve Amazon EKS add-ons or other aspects of our container services, please use our containers roadmap to provide us feedback and review our existing roadmap items.\n\n![Roadmap](https://github.com/aws/containers-roadmap/raw/master/images/roadmap.png)\n\n### üí° Share Your Feedback\n\nYour feedback is invaluable to us. Help us shape the future of Amazon EKS add-ons by sharing your thoughts and suggestions on our [GitHub issues page](https://github.com/aws/containers-roadmap/issues).\n\n![Feedback](https://github.githubassets.com/images/modules/logos_page/GitHub-Mark.png)\n\n---\n\n## üìú Conclusion\n\nAmazon EKS add-ons are curated software components that simplify and enhance the management of Kubernetes clusters. They streamline operations, boost security and stability, and offload the heavy lifting of configuring and maintaining essential components.\n\nThis frees users to focus on developing and innovating containerized applications.\n\nIn a world where cloud-native technologies are constantly evolving, efficient cluster management is critical. Amazon EKS add-ons provide a reliable and efficient way to ensure that Kubernetes clusters are always up-to-date, secure, and well-configured.\n\nBy automating the deployment and maintenance of critical components, AWS empowers users to optimize their time and resources, making it easier than ever to harness the full potential of Kubernetes on the cloud.\n\n**References:**\n\n- [Installation Guide‚Ää-‚ÄäAWS Load Balancer Controller](https://kubernetes-sigs.github.io/aws-load-balancer-controller/v2.6/deploy/installation/)\n- [Amazon EKS Pod Networking](https://docs.aws.amazon.com/eks/latest/userguide/pod-networking.html)\n- [Kubernetes Networking Concepts](https://kubernetes.io/docs/concepts/cluster-administration/networking/)\n- [YouTube: Kubernetes Networking](https://www.youtube.com/watch?v=7LRtytR6ZbA&t=296s)\n- [YouTube: EKS Networking Deep Dive](https://www.youtube.com/watch?v=U35C0EPSwoY)\n- [Medium: EKS EBS Storage with eksctl](https://joachim8675309.medium.com/eks-ebs-storage-with-eksctl-3e526f534215)\n- [Amazon EKS Add-ons Documentation](https://docs.aws.amazon.com/eks/latest/userguide/eks-add-ons.html)\n\n<br>\n\n**_Until next time, „Å§„Å•„Åè üéâ_**\n\n> üí° Thank you for Reading !! üôåüèªüòÅüìÉ, see you in the next blog.ü§ò  _**Until next time üéâ**_\n\nüöÄ Thank you for sticking up till the end. If you have any questions/feedback regarding this blog feel free to connect with me:\n\n**‚ôªÔ∏è LinkedIn:** https://www.linkedin.com/in/rajhi-saif/\n\n**‚ôªÔ∏è X/Twitter:** https://x.com/rajhisaifeddine\n\n**The end ‚úåüèª**\n\n<h1 align=\"center\">üî∞ Keep Learning !! Keep Sharing !! üî∞</h1>\n\n**üìÖ Stay updated**\n\nSubscribe to our newsletter for more insights on AWS cloud computing and containers.\n","wordCount":{"words":4275},"frontmatter":{"id":"676d1516c486c496533cfd40","path":"/blog/eks-add-ons/","humanDate":"Oct 17, 2024","fullDate":"2024-10-17","title":"Amazon EKS add-ons: A curated set of software for managing your Kubernetes clusters","keywords":["AWS EKS","EKS add-ons","EKS Blueprints","Terraform","CDK"],"excerpt":"Explore a curated set of Amazon EKS add-ons designed to enhance the management and functionality of your Kubernetes clusters, integrating seamlessly with tools like Terraform and CDK.","cover":{"childImageSharp":{"gatsbyImageData":{"layout":"fullWidth","placeholder":{"fallback":"data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAQABQDASIAAhEBAxEB/8QAGAAAAwEBAAAAAAAAAAAAAAAAAAIDBAX/xAAVAQEBAAAAAAAAAAAAAAAAAAABAP/aAAwDAQACEAMQAAAB5LxsOYcj/8QAFxABAQEBAAAAAAAAAAAAAAAAAgEDEv/aAAgBAQABBQIw0DMK6SFlSQuda01//8QAFREBAQAAAAAAAAAAAAAAAAAAAQD/2gAIAQMBAT8BGb//xAAXEQEAAwAAAAAAAAAAAAAAAAAAATFB/9oACAECAQE/AcRT/8QAHBAAAgEFAQAAAAAAAAAAAAAAAAEREBIhMkGB/9oACAEBAAY/Au3HRpU2wSnPh//EABoQAAIDAQEAAAAAAAAAAAAAAAExABEhUfH/2gAIAQEAAT8h8KCAN4WdiQhkGQtjKmwrjEQCpP/aAAwDAQACAAMAAAAQY9//xAAXEQEBAQEAAAAAAAAAAAAAAAABACEx/9oACAEDAQE/EAMS6v/EABYRAQEBAAAAAAAAAAAAAAAAAAEAEf/aAAgBAgEBPxDESSULf//EABwQAQEAAgMBAQAAAAAAAAAAAAERAEEhMVFxof/aAAgBAQABPxDcgSeG/wAwGduy7Dz3PTrLE1qt53kh0BbvnColWGCJo+mO2cgwUJAuf//Z"},"images":{"fallback":{"src":"/static/117e037ec8e7e8491e7104f06b265624/19bf1/addons-cover.jpg","srcSet":"/static/117e037ec8e7e8491e7104f06b265624/cd108/addons-cover.jpg 750w,\n/static/117e037ec8e7e8491e7104f06b265624/19bf1/addons-cover.jpg 800w","sizes":"100vw"},"sources":[{"srcSet":"/static/117e037ec8e7e8491e7104f06b265624/8e9fd/addons-cover.webp 750w,\n/static/117e037ec8e7e8491e7104f06b265624/41401/addons-cover.webp 800w","type":"image/webp","sizes":"100vw"}]},"width":1,"height":0.8}}},"coverCredits":"Photo by Saifeddine Rajhi"}}},"pageContext":{"prevThought":{"frontmatter":{"path":"/blog/eks-upgrade-guide/","title":"EKS cluster upgrades: A Step-by-Step guide to a secure Process","date":"2024-10-17 21:30:00"},"excerpt":"A Step-by-Step upgrade handbook üìö Introduction The cloud computing landscape is constantly evolving, and it can be difficult to keep up‚Ä¶","html":"<blockquote>\n<p><strong>A Step-by-Step upgrade handbook</strong></p>\n</blockquote>\n<h2 id=\"-introduction\" style=\"position:relative;\"><a href=\"#-introduction\" aria-label=\" introduction permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üìö Introduction</h2>\n<p>The <a href=\"https://landscape.cncf.io/\" target=\"_blank\" rel=\"noopener noreferrer\">cloud computing landscape</a> is constantly evolving, and it can be difficult to keep up with the latest changes. However, staying up-to-date is essential for ensuring the security and reliability of your infrastructure.</p>\n<p><a href=\"https://aws.amazon.com/eks/\" target=\"_blank\" rel=\"noopener noreferrer\">Amazon Elastic Kubernetes Service (EKS)</a> is a managed Kubernetes service that makes it easy to deploy, manage, and scale containerized applications.</p>\n<p>One of the most important tasks for EKS cluster administrators is to perform regular upgrades. This ensures that your cluster is running on the latest version of Kubernetes, which includes the latest security patches and features.</p>\n<p>This guide provides a step-by-step walkthrough of the EKS cluster upgrade process. We cover all the essential steps, from planning the upgrade to testing and deploying the new version. Whether you are working with self-managed nodes, managed node groups, Karpenter nodes, or Fargate nodes, we have you covered.\nBy following the guidance in this guide, you can confidently upgrade your EKS cluster without disrupting your applications.</p>\n<p>So let's get started!</p>\n<h2 id=\"-staying-current-how-often-to-upgrade-kubernetes\" style=\"position:relative;\"><a href=\"#-staying-current-how-often-to-upgrade-kubernetes\" aria-label=\" staying current how often to upgrade kubernetes permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üìÖ Staying Current: How Often to Upgrade Kubernetes</h2>\n<p>How frequently should you perform Kubernetes upgrades? This is a crucial aspect often overlooked by newcomers to Kubernetes. Unlike many traditional infrastructure projects, Kubernetes evolves rapidly through its versions. Upgrading Kubernetes cannot be likened to switching to a new long-term support (LTS) release of a Linux distribution; it's a continuous process that demands regular attention.</p>\n<p>To be fair, the Kubernetes team has taken significant steps to make this process more manageable. They follow an <a href=\"https://kubernetes.io/releases/version-skew-policy/\" target=\"_blank\" rel=\"noopener noreferrer\">N-2 support policy</a>, ensuring that the three most recent minor versions receive security fixes and bug patches. This approach gives you ample time to establish a cluster and incorporate upgrade planning into your initial cluster design. Waiting until your cluster is nearly at its end-of-life (EOL) to contemplate upgrades is not a viable strategy. Each release remains eligible for patches for 14 months, which may seem like an extended period, but you're unlikely to install the very latest release.</p>\n<p><span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 56.470588235294116%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAAsTAAALEwEAmpwYAAABKElEQVR42o2Sb2vCMBDG+/2/y7Y3Cs5SpuIcigPdWF8IyiYrdK7D1ubPXZImu7bq3GhhD+lxufTHc5fWc85JKRHRtco6S8sVhu/ES8Tm72yR64QqHh1mWUZ8C2jrR5sEYMkPE+DPSrP60KudAaABKylXSNDJGuMHGY2V3Fqrz6+0OFckBfO5w9k971yJUWDeNoXRx0GanU+GBkGtQnXXE35HhU8FNMxVwnme/4KJTPc4HfPutRzc4uumLh7jH/jS2SLqaKuGvhz0Vbg0h/TnzhudGWNQzaw5w9mEd2/EoI9xdNlLo0pYcA5KWWpgOpZDH9YrS9vzF25XCXPSLpajIA96Ot27f6uEqeevxWO+mGcfMQdEALpCIQRUiaxECf2FVKQZKaGotf4GNDt8pyicpesAAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"Kubernetes Versions\" title=\"\" src=\"/static/a1f99354749040eceeca7ad10eeb28aa/c5bb3/k8s-versions.png\" srcset=\"/static/a1f99354749040eceeca7ad10eeb28aa/04472/k8s-versions.png 170w,\n/static/a1f99354749040eceeca7ad10eeb28aa/9f933/k8s-versions.png 340w,\n/static/a1f99354749040eceeca7ad10eeb28aa/c5bb3/k8s-versions.png 680w,\n/static/a1f99354749040eceeca7ad10eeb28aa/5a190/k8s-versions.png 800w\" sizes=\"(max-width: 680px) 100vw, 680px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n    </span>\n          </p>\n<div class=\"image-title\"><a href=\"https://endoflife.date/kubernetes\">End of Life Date for Kubernetes</a></div>\n<p>So, how frequently should you upgrade Kubernetes? The answer is quite often. Kubernetes aims for three releases per year, down from the previous rate of four releases annually. To assess Kubernetes releases for your organization, you'll likely need to manage multiple versions simultaneously in various environments.</p>\n<p>As a rule of thumb, I recommend letting a minor version bake in a development environment for at least two weeks, and the same applies to the subsequent stages, such as staging or sandbox environments. For production upgrades, ideally, you should have at least a month of solid data indicating that the organization won't encounter issues.</p>\n<p>üîÑ <strong>Key Takeaways:</strong></p>\n<ul>\n<li><strong>N-2 Support Policy:</strong> Ensures the three most recent minor versions receive updates.</li>\n<li><strong>14-Month Patch Eligibility:</strong> Each release is eligible for patches for 14 months.</li>\n<li><strong>Three Releases Per Year:</strong> Kubernetes aims for three releases annually.</li>\n<li><strong>Staging and Production:</strong> Test in development for two weeks and in production for at least a month.</li>\n</ul>\n<h3 id=\"-strategic-kubernetes-upgrade-scheduling\" style=\"position:relative;\"><a href=\"#-strategic-kubernetes-upgrade-scheduling\" aria-label=\" strategic kubernetes upgrade scheduling permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>ü§ñ Strategic Kubernetes Upgrade Scheduling</h3>\n<p>A Kubernetes version encompasses both the control plane and the data plane. To ensure smooth operation, both the control plane and the data plane should run the same Kubernetes <a href=\"https://kubernetes.io/releases/version-skew-policy/#supported-versions\" target=\"_blank\" rel=\"noopener noreferrer\">minor version, such as 1.27</a>.</p>\n<ul>\n<li><strong>Control plane</strong>: The control plane version is defined by the Kubernetes API server. In EKS clusters, this is managed by AWS. Upgrades to the control plane version are started using the AWS API.</li>\n<li><strong>Data plane</strong>: The data plane version references the version of the Kubelet running on your nodes. Different nodes in the same cluster may have different versions. See the version of all nodes with <code class=\"language-text\">kubectl get nodes</code>.</li>\n</ul>\n<h2 id=\"-kubernetes-version-management-a-staged-approach\" style=\"position:relative;\"><a href=\"#-kubernetes-version-management-a-staged-approach\" aria-label=\" kubernetes version management a staged approach permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üíπ Kubernetes Version Management: A Staged Approach</h2>\n<p>In my carefully planned layout:</p>\n<p>‚òëÔ∏è <strong>Development Cluster: Embrace the Bleeding Edge</strong><br>\nThe dev cluster should be on the cutting edge, aligned with the latest Kubernetes version. This approach helps establish SLAs for the dev environment, with a focus on frequent upgrades. The internal communication strategy is to upgrade dev often during specific time frames, relying on it to identify and surface early problems. It's common to encounter critical issues almost immediately, providing ample time for resolution and determining the maximum safe upgrade version on testing day.</p>\n<p>‚òëÔ∏è <strong>Staging Cluster: A Step Behind Dev</strong><br>\nStaging lags slightly behind dev, typically running a minor release older. The concern here might be the possibility of incompatible YAML files. However, it's a prevalent practice to employ per-environment YAMLs, allowing for variations in resource requests and limits. If you're exploring per-environment configuration, consider tools like <a href=\"https://kustomize.io/\" target=\"_blank\" rel=\"noopener noreferrer\">Kustomize</a>.</p>\n<p>‚òëÔ∏è <strong>Production Cluster: Align with Staging</strong><br>\nIn production, the goal is to keep version alignment as close to staging as possible. This approach simplifies developers' lives by avoiding excessive version fragmentation. Kubernetes patch releases are usually conservative with changes, resulting in rare problems. The release cadence for patches on the same minor version follows a two-week cycle in staging before being deployed to production.</p>\n<p>‚òëÔ∏è <strong>Crucial Note: Exercise Caution with Minor Version Upgrades</strong><br>\nA key rule is not to upgrade the minor version until it reaches at least patch <code class=\"language-text\">.2</code>. This means that the latest Kubernetes version, such as 1.26.0, isn't considered ready for a dev release until it reaches 1.26.2. Once this milestone is achieved, the upgrade process begins, progressing from dev to stage and finally to production. By the time the dev upgrade is completed and rolled out to staging, it's often the <code class=\"language-text\">.3</code> release (depending on the time of year).</p>\n<p>‚òëÔ∏è <strong>Balancing Speed and Safety: The Delicate Art of Version Management</strong><br>\nWhile this approach may seem slow, it's rooted in past experiences. Rushing into upgrades too early has led to issues. It's challenging for the Kubernetes team to anticipate every use-case and prevent all regressions. Waiting until at least <code class=\"language-text\">.2</code> ensures extensive testing, with most issues discovered by that point. Some opt to wait until <code class=\"language-text\">.5</code> for the safest path, although it's a slower approach.</p>\n<h3 id=\"-keep-your-cluster-updated\" style=\"position:relative;\"><a href=\"#-keep-your-cluster-updated\" aria-label=\" keep your cluster updated permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üîÑ Keep Your Cluster Updated</h3>\n<p>Staying current with Kubernetes releases is vital within the shared responsibility model for EKS and Kubernetes adoption.</p>\n<ul>\n<li><strong>Review the EKS Release Calendar</strong>: Frequent updates are the norm, with EKS typically releasing three minor Kubernetes versions annually, each supported for around 14 months. Always check the EKS Kubernetes <a href=\"https://docs.aws.amazon.com/eks/latest/userguide/kubernetes-versions.html#kubernetes-release-calendar\" target=\"_blank\" rel=\"noopener noreferrer\">release calendar</a> for the latest information.</li>\n<li><strong>Understand Shared Responsibility</strong>: You're responsible for initiating upgrades for both the cluster control plane and data plane. While AWS handles the control plane during upgrades, the data plane, including Fargate pods and add-ons, falls under your purview. Planning is crucial to ensure workload availability.</li>\n<li><strong>In-Place Cluster Upgrades</strong>: EKS supports in-place cluster upgrades, preserving resources and configuration consistency. This minimizes disruption for users and retains existing workloads and resources. Note that only one minor version upgrade can occur at a time.</li>\n<li><strong>Plan Sequential Upgrades Carefully</strong>: For multiple version updates, sequential upgrades are necessary. However, they pose a higher risk of downtime. Consider evaluating a blue/green cluster upgrade strategy in such cases.</li>\n</ul>\n<h2 id=\"-how-aws-manages-eks-upgrades\" style=\"position:relative;\"><a href=\"#-how-aws-manages-eks-upgrades\" aria-label=\" how aws manages eks upgrades permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üîÑ How AWS Manages EKS Upgrades</h2>\n<p>The EKS upgrade process is managed by AWS to ensure a seamless and safe transition between Kubernetes versions. Here is a detailed breakdown of the steps AWS takes to upgrade the EKS control plane:</p>\n<p><span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 56.470588235294116%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAABgUlEQVR42o2Sy07DMBBF8//fwAqWFTv+gAUIumADUlsJFbWUJg7N0574eRm7D0oBqVYsO57JzdzjyXDm8AHoVzOoao3gFOAkgiWEEH7kZYddDJwErbUwxsA5B8urj2fDBvR6A/l8hUAL/pP7R/DH2ApHsbquURQFlOxgZMMzR7t6Qjkfw/dzTvUngruqTCuguw16NaCTBKkonbddi0KUsFrBVUsuka1GITlH0J+/XB0qJGZD1Qes+oCvXhDUO5yhZPuAJHGo0E6v0bxcwqklPFuOSLTWac3yPIekAa7JYamBLtnOwwVofc/g1c78jm98GUq0YoxaPML1b0kkYhFCpDWTUsI6D89i3ijYZoZOTKGrCQOnP/A6frgaRmAGxrB3kEyE40sJW8DJmk/B75YI2+LWE9h+A8NpRBqkVLJ6xi0f9Z/3UEQw/KGsSwzdGm51i5DfMc963xDnC8YK8kJw/zGOzYIveYFiOoKYjbgPV7/yM5w9QqLhdQXHQnEG3p8KfgF7rVtGFJSxdwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"EKS Upgrade Process\" title=\"\" src=\"/static/ddfd8b0f2d3debaabcdfdfb7c15eb884/c5bb3/upgrades.png\" srcset=\"/static/ddfd8b0f2d3debaabcdfdfb7c15eb884/04472/upgrades.png 170w,\n/static/ddfd8b0f2d3debaabcdfdfb7c15eb884/9f933/upgrades.png 340w,\n/static/ddfd8b0f2d3debaabcdfdfb7c15eb884/c5bb3/upgrades.png 680w,\n/static/ddfd8b0f2d3debaabcdfdfb7c15eb884/5a190/upgrades.png 800w\" sizes=\"(max-width: 680px) 100vw, 680px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n    </span>\n          </p>\n<h3 id=\"Ô∏è-pre-upgrade-checks\" style=\"position:relative;\"><a href=\"#%EF%B8%8F-pre-upgrade-checks\" aria-label=\"Ô∏è pre upgrade checks permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üõ†Ô∏è Pre-upgrade Checks</h3>\n<p>AWS first performs pre-upgrade checks, including assessing the current cluster state and evaluating the compatibility of the new version with your workloads. If any issues are detected, the upgrade process will not proceed.</p>\n<h3 id=\"-backup-and-snapshot\" style=\"position:relative;\"><a href=\"#-backup-and-snapshot\" aria-label=\" backup and snapshot permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üíæ Backup and Snapshot</h3>\n<p>Before initiating the upgrade, AWS takes a backup of your existing control plane and creates a snapshot of your etcd data store. This is done to ensure data consistency and to enable rollback in case of an upgrade failure.</p>\n<p>For additional data protection, consider using <a href=\"https://velero.io/\" target=\"_blank\" rel=\"noopener noreferrer\">Velero</a>, an open-source tool that simplifies the backup and recovery process for Kubernetes cluster resources and persistent volumes. Velero allows you to schedule and manage backups, as well as restore processes, providing an extra layer of safety for your data.</p>\n<h3 id=\"-creating-a-new-control-plane\" style=\"position:relative;\"><a href=\"#-creating-a-new-control-plane\" aria-label=\" creating a new control plane permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üÜï Creating a New Control Plane</h3>\n<p>AWS creates a new control plane with the desired Kubernetes version. This new control plane runs in parallel with your existing control plane, ensuring minimal disruption to your workload.</p>\n<h3 id=\"-testing-compatibility\" style=\"position:relative;\"><a href=\"#-testing-compatibility\" aria-label=\" testing compatibility permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>‚úÖ Testing Compatibility</h3>\n<p>The new control plane is tested for compatibility with your workloads, including running automated tests to verify that your applications continue to function as expected. The goal is to minimize potential disruptions during the upgrade process and maintain the stability of your services. It's important to mention that this only looks for your application health and not for APIs that may be removed or deprecated.</p>\n<h3 id=\"-switching-control-plane-endpoints\" style=\"position:relative;\"><a href=\"#-switching-control-plane-endpoints\" aria-label=\" switching control plane endpoints permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üîÑ Switching Control Plane Endpoints</h3>\n<p>Once compatibility is confirmed, AWS switches the control plane endpoints (API server) to the new control plane. This switch happens atomically, resulting in minimal downtime during the upgrade process.</p>\n<h3 id=\"Ô∏è-terminating-the-old-control-plane\" style=\"position:relative;\"><a href=\"#%EF%B8%8F-terminating-the-old-control-plane\" aria-label=\"Ô∏è terminating the old control plane permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üóëÔ∏è Terminating the Old Control Plane</h3>\n<p>The old control plane is terminated once the upgrade is complete, and all resources associated with it are cleaned up.</p>\n<h2 id=\"-eks-rollback-on-upgrade-failure\" style=\"position:relative;\"><a href=\"#-eks-rollback-on-upgrade-failure\" aria-label=\" eks rollback on upgrade failure permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üîô EKS Rollback on Upgrade Failure</h2>\n<p><span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 52.352941176470594%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsTAAALEwEAmpwYAAABdklEQVR42o1SQU7DMBDM/69IcEOceES5oSKQuKCCEEWilSiENE1rJ04cO7F32LqhpEQgNrLWTuLZnZmN8M/wRCiTGbRMQI0EGgFqFYiffkT7HV8Iqxdt28JaG3LT2HC11Qn09Bzq7hikpnzH/wJ4ELQHlEIiSZbQlYJVAk0ZQ73fYD0fw+dPgyYiol3TlqmYPEOpDVRlONfhh6IokGZrOFvDyQ+uUoDyR4AXmeUQ8Gtj8pTXEk7N4Ve3oPKFQTR36bqmO2omYawziMkJYz/DOReY1HUd9lEcx6Eblyesj+T/L7G6PkK9uABc1cn7rS/VCdTyCiodc9EZvPfIc4ksyyClRKS15pdM25bsGnckHlCu7tFsJvDbc7uXtDPOh9xYgyIXMKbu+Up9U/ou0w6Ez9tibUtMp/vmDWsnUbE8cpMyVfPTlKHDgWKXhdiwyzwqbNZWTq/nECxJNTnlWYwPpuKPscEBja8C4VzOsX4dQbyNQNViAPgJ/4sKYAuJ23AAAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"EKS Rollback Process\" title=\"\" src=\"/static/e78540955b703aecd2357c7fc0248b41/c5bb3/rolloback.png\" srcset=\"/static/e78540955b703aecd2357c7fc0248b41/04472/rolloback.png 170w,\n/static/e78540955b703aecd2357c7fc0248b41/9f933/rolloback.png 340w,\n/static/e78540955b703aecd2357c7fc0248b41/c5bb3/rolloback.png 680w,\n/static/e78540955b703aecd2357c7fc0248b41/5a190/rolloback.png 800w\" sizes=\"(max-width: 680px) 100vw, 680px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n    </span>\n          </p>\n<p>In case an EKS upgrade fails, AWS has measures in place to minimize disruption and revert the control plane to its previous version:</p>\n<h3 id=\"-detecting-the-failure\" style=\"position:relative;\"><a href=\"#-detecting-the-failure\" aria-label=\" detecting the failure permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üö® Detecting the Failure</h3>\n<p>AWS constantly monitors the upgrade process to detect any issues. If a problem arises during the upgrade, the process is immediately halted.</p>\n<h3 id=\"-restoring-from-backup\" style=\"position:relative;\"><a href=\"#-restoring-from-backup\" aria-label=\" restoring from backup permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üîÑ Restoring from Backup</h3>\n<p>AWS uses the backup and snapshot created before the upgrade to restore the control plane and etcd data store to their previous state.</p>\n<h3 id=\"-switching-control-plane-endpoints-1\" style=\"position:relative;\"><a href=\"#-switching-control-plane-endpoints-1\" aria-label=\" switching control plane endpoints 1 permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üîÑ Switching Control Plane Endpoints</h3>\n<p>AWS atomically switches the control plane endpoints back to the previous control plane, ensuring minimal downtime.</p>\n<h3 id=\"Ô∏è-terminating-the-new-control-plane\" style=\"position:relative;\"><a href=\"#%EF%B8%8F-terminating-the-new-control-plane\" aria-label=\"Ô∏è terminating the new control plane permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üóëÔ∏è Terminating the New Control Plane</h3>\n<p>Once the rollback is complete, AWS terminates the new control plane and cleans up any associated resources.</p>\n<h3 id=\"-post-rollback-assessment\" style=\"position:relative;\"><a href=\"#-post-rollback-assessment\" aria-label=\" post rollback assessment permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üìù Post-rollback Assessment</h3>\n<p>After the rollback, AWS will assess the reasons behind the upgrade failure and provide guidance on how to address the issues. You will need to troubleshoot and resolve the problems before attempting the upgrade again.</p>\n<h2 id=\"upgrade-your-control-plane-and-data-plane-in-sequence\" style=\"position:relative;\"><a href=\"#upgrade-your-control-plane-and-data-plane-in-sequence\" aria-label=\"upgrade your control plane and data plane in sequence permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Upgrade your control plane and data plane in sequence</h2>\n<p>To upgrade a cluster you will need to take the following actions:\n<a href=\"https://aws.github.io/aws-eks-best-practices/upgrades/#use-the-eks-documentation-to-create-an-upgrade-checklist\" target=\"_blank\" rel=\"noopener noreferrer\">Review the Kubernetes and EKS release notes</a>.\n<a href=\"https://aws.github.io/aws-eks-best-practices/upgrades/#backup-the-cluster-before-upgrading\" target=\"_blank\" rel=\"noopener noreferrer\">Take a backup of the cluster</a>. (optional)\n<a href=\"https://aws.github.io/aws-eks-best-practices/upgrades/#identify-and-remediate-removed-api-usage-before-upgrading-the-control-plane\" target=\"_blank\" rel=\"noopener noreferrer\">Identify and remediate deprecated and removed API usage in your workloads</a>.\n<a href=\"https://aws.github.io/aws-eks-best-practices/upgrades/#track-the-version-skew-of-nodes-ensure-managed-node-groups-are-on-the-same-version-as-the-control-plane-before-upgrading\" target=\"_blank\" rel=\"noopener noreferrer\">Ensure Managed Node Groups, if used, are on the same Kubernetes version as the control plane</a>. EKS managed node groups and nodes created by EKS Fargate Profiles only support 1 minor version skew between the control plane and data plane.\n<a href=\"https://docs.aws.amazon.com/eks/latest/userguide/update-cluster.html\" target=\"_blank\" rel=\"noopener noreferrer\">Upgrade the cluster control plane using the AWS console or cli</a>.\n<a href=\"https://aws.github.io/aws-eks-best-practices/upgrades/#upgrade-add-ons-and-components-using-the-kubernetes-api\" target=\"_blank\" rel=\"noopener noreferrer\">Review add-on compatibility</a>. Upgrade your Kubernetes add-ons and custom controllers, as required.\n<a href=\"https://docs.aws.amazon.com/eks/latest/userguide/install-kubectl.html\" target=\"_blank\" rel=\"noopener noreferrer\">Update kubectl</a>.\n<a href=\"https://docs.aws.amazon.com/eks/latest/userguide/update-managed-node-group.html\" target=\"_blank\" rel=\"noopener noreferrer\">Upgrade the cluster data plane</a>. Upgrade your nodes to the same Kubernetes minor version as your upgraded cluster.</p>\n<h2 id=\"-use-the-eks-documentation-to-create-an-upgrade-checklist\" style=\"position:relative;\"><a href=\"#-use-the-eks-documentation-to-create-an-upgrade-checklist\" aria-label=\" use the eks documentation to create an upgrade checklist permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üìã Use the EKS Documentation to Create an Upgrade Checklist</h2>\n<p>The EKS Kubernetes version documentation includes a detailed list of changes for each version. Build a checklist for each upgrade.</p>\n<p>For specific EKS version upgrade guidance, review the documentation for notable changes and considerations for each version. The following Kubernetes versions are currently available in Amazon EKS standard support:</p>\n<ul>\n<li><strong>1.30</strong></li>\n<li><strong>1.29</strong></li>\n<li><strong>1.28</strong></li>\n</ul>\n<p>For important changes to be aware of for each version in standard support, see <a href=\"https://docs.aws.amazon.com/eks/latest/userguide/kubernetes-versions.html\" target=\"_blank\" rel=\"noopener noreferrer\">Review release notes for Kubernetes versions on standard support</a>.</p>\n<p><strong>üìÖ Available Versions on Extended Support</strong></p>\n<p>The following Kubernetes versions are currently available in Amazon EKS extended support:</p>\n<ul>\n<li><strong>1.27</strong></li>\n<li><strong>1.26</strong></li>\n<li><strong>1.25</strong></li>\n<li><strong>1.24</strong></li>\n<li><strong>1.23</strong></li>\n</ul>\n<h3 id=\"-upgrading-add-ons-and-components-via-the-kubernetes-api\" style=\"position:relative;\"><a href=\"#-upgrading-add-ons-and-components-via-the-kubernetes-api\" aria-label=\" upgrading add ons and components via the kubernetes api permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üîÑ Upgrading Add-ons and Components via the Kubernetes API</h3>\n<p>Before initiating a cluster upgrade, it's essential to have a comprehensive understanding of the versions of Kubernetes components in use. Conduct an inventory of cluster components, specifically focusing on those that directly interact with the Kubernetes API. These critical cluster components encompass:</p>\n<ul>\n<li><strong>Monitoring and Logging Agents</strong></li>\n<li><strong>Cluster Autoscalers</strong></li>\n<li><strong>Container Storage Drivers</strong> (e.g., <a href=\"https://github.com/kubernetes-sigs/aws-ebs-csi-driver\" target=\"_blank\" rel=\"noopener noreferrer\">EBS CSI</a>, <a href=\"https://github.com/kubernetes-sigs/aws-efs-csi-driver\" target=\"_blank\" rel=\"noopener noreferrer\">EFS CSI</a>)</li>\n<li><strong>Ingress Controllers</strong></li>\n<li><strong>Other Workloads or Add-ons</strong> reliant on direct Kubernetes API interactions</li>\n</ul>\n<h3 id=\"-pro-tip\" style=\"position:relative;\"><a href=\"#-pro-tip\" aria-label=\" pro tip permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üí° Pro Tip</h3>\n<p>Critical cluster components are frequently found within namespaces ending in <code class=\"language-text\">*-system</code>:</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">kubectl get ns <span class=\"token operator\">|</span> <span class=\"token function\">grep</span> <span class=\"token string\">'-system'</span></code></pre></div>\n<p>Once you've identified components that depend on the Kubernetes API, refer to their documentation to ascertain version compatibility and any prerequisites for upgrading. For instance, consult the <a href=\"https://docs.aws.amazon.com/eks/latest/userguide/aws-load-balancer-controller.html\" target=\"_blank\" rel=\"noopener noreferrer\">AWS Load Balancer Controller documentation</a> for insights into version compatibility. Certain components might necessitate updates or configuration adjustments before proceeding with a cluster upgrade. It's imperative to pay special attention to critical components like CoreDNS, kube-proxy, VPC CNI, and storage drivers.</p>\n<p>Clusters typically encompass a multitude of workloads relying on the Kubernetes API, essential for functionalities such as ingress control, continuous delivery systems, and monitoring tools. When embarking on an EKS cluster upgrade, it's equally crucial to upgrade your add-ons and third-party tools, ensuring their seamless compatibility with the upgraded environment.</p>\n<p>See the following examples of common add-ons and their relevant upgrade documentation:</p>\n<ul>\n<li><strong>Amazon VPC CNI</strong>: For the recommended version of the Amazon VPC CNI add-on for each cluster version, see <a href=\"https://docs.aws.amazon.com/eks/latest/userguide/managing-vpc-cni.html\" target=\"_blank\" rel=\"noopener noreferrer\">Updating the Amazon VPC CNI plugin for Kubernetes self-managed add-on</a>. When installed as an Amazon EKS Add-on, it can only be upgraded one minor version at a time.</li>\n<li><strong>kube-proxy</strong>: See <a href=\"https://docs.aws.amazon.com/eks/latest/userguide/managing-kube-proxy.html\" target=\"_blank\" rel=\"noopener noreferrer\">Updating the Kubernetes kube-proxy self-managed add-on</a>.</li>\n<li><strong>CoreDNS</strong>: See <a href=\"https://docs.aws.amazon.com/eks/latest/userguide/managing-coredns.html\" target=\"_blank\" rel=\"noopener noreferrer\">Updating the CoreDNS self-managed add-on</a>.</li>\n<li><strong>AWS Load Balancer Controller</strong>: The AWS Load Balancer Controller needs to be compatible with the EKS version you have deployed. See the <a href=\"https://docs.aws.amazon.com/eks/latest/userguide/aws-load-balancer-controller.html\" target=\"_blank\" rel=\"noopener noreferrer\">installation guide</a> for more information.</li>\n<li><strong>Amazon Elastic Block Store (Amazon EBS) Container Storage Interface (CSI) driver</strong>: For installation and upgrade information, see <a href=\"https://docs.aws.amazon.com/eks/latest/userguide/managing-ebs-csi.html\" target=\"_blank\" rel=\"noopener noreferrer\">Managing the Amazon EBS CSI driver as an Amazon EKS add-on</a>.</li>\n<li><strong>Amazon Elastic File System (Amazon EFS) Container Storage Interface (CSI) driver</strong>: For installation and upgrade information, see <a href=\"https://docs.aws.amazon.com/eks/latest/userguide/efs-csi.html\" target=\"_blank\" rel=\"noopener noreferrer\">Amazon EFS CSI driver</a>.</li>\n<li><strong>Kubernetes Metrics Server</strong>: For more information, see <a href=\"https://kubernetes-sigs.github.io/metrics-server\" target=\"_blank\" rel=\"noopener noreferrer\">metrics-server on GitHub</a>.</li>\n<li><strong>Kubernetes Cluster Autoscaler</strong>: To upgrade the version of Kubernetes Cluster Autoscaler, change the version of the image in the deployment. The Cluster Autoscaler is tightly coupled with the Kubernetes scheduler. You will always need to upgrade it when you upgrade the cluster. Review the <a href=\"https://github.com/kubernetes/autoscaler/releases\" target=\"_blank\" rel=\"noopener noreferrer\">GitHub releases</a> to find the address of the latest release corresponding to your Kubernetes minor version.</li>\n<li><strong>Karpenter</strong>: For installation and upgrade information, see the <a href=\"https://karpenter.sh/docs/getting-started/\" target=\"_blank\" rel=\"noopener noreferrer\">Karpenter documentation</a>.</li>\n<li><strong>Ingress</strong>: You need to really understand how traffic is coming into the cluster and through what systems.</li>\n<li><strong>Service mesh</strong>: Are you using one, what does it do and what version is it set at? Istio can be a BEAR to upgrade, so if you can switch to Linkerd you'll likely be much happier in the long term. However, understanding what controls access to what namespaces and pods is critical to a happy upgrade.</li>\n<li><strong>Certificates</strong>: By default, they expire after a year. You get fresh ones with every upgrade, but you can also trigger a manual refresh whenever with <code class=\"language-text\">kubeadm certs renew</code>. If you are running an old cluster, PLEASE check the expiration dates of your client certificates with:</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">kubeadm certs check-expiration now</code></pre></div>\n<ul>\n<li><strong>Stateful deployments</strong>: Are they storing something, where are they storing it, and how do you manage them? This would be databases, Redis, message queues, applications that hold state. These are often the hardest to move or interact with during an upgrade. You can review the options for moving those <a href=\"https://www.velotio.com/engineering-blog/exploring-upgrade-strategies-for-stateful-sets-in-kubernetes\" target=\"_blank\" rel=\"noopener noreferrer\">here</a>. The biggest thing is to set the pod disruption budget so that there is some minimum available during the upgrade process as shown <a href=\"https://kubernetes.io/docs/tasks/run-application/configure-pdb/\" target=\"_blank\" rel=\"noopener noreferrer\">here</a>.</li>\n</ul>\n<h3 id=\"-verify-available-ip-addresses\" style=\"position:relative;\"><a href=\"#-verify-available-ip-addresses\" aria-label=\" verify available ip addresses permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üîç Verify Available IP Addresses</h3>\n<p>To update the cluster, Amazon EKS requires up to five available IP addresses from the subnets that you specified when you created your cluster. To verify that your subnets have enough IP addresses to upgrade the cluster, you can run the following command:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token assign-left variable\">CLUSTER</span><span class=\"token operator\">=</span><span class=\"token operator\">&lt;</span>cluster name<span class=\"token operator\">></span>\naws ec2 describe-subnets --subnet-ids <span class=\"token punctuation\">\\</span>\n    <span class=\"token variable\"><span class=\"token variable\">$(</span>aws eks describe-cluster <span class=\"token parameter variable\">--name</span> $<span class=\"token punctuation\">{</span>CLUSTER<span class=\"token punctuation\">}</span> <span class=\"token punctuation\">\\</span>\n    <span class=\"token parameter variable\">--query</span> <span class=\"token string\">'cluster.resourcesVpcConfig.subnetIds'</span> <span class=\"token punctuation\">\\</span>\n    <span class=\"token parameter variable\">--output</span> text<span class=\"token variable\">)</span></span> <span class=\"token punctuation\">\\</span>\n    <span class=\"token parameter variable\">--query</span> <span class=\"token string\">'Subnets[*].[SubnetId,AvailabilityZone,AvailableIpAddressCount]'</span> <span class=\"token punctuation\">\\</span>\n    <span class=\"token parameter variable\">--output</span> table</code></pre></div>\n<p>The <a href=\"https://github.com/aws/amazon-vpc-cni-k8s/tree/master/cmd/cni-metrics-helper\" target=\"_blank\" rel=\"noopener noreferrer\">VPC CNI Metrics Helper</a> may be used to create a CloudWatch dashboard for VPC metrics.</p>\n<h3 id=\"-transition-to-eks-add-ons\" style=\"position:relative;\"><a href=\"#-transition-to-eks-add-ons\" aria-label=\" transition to eks add ons permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üîÑ Transition to EKS Add-ons</h3>\n<p>Amazon EKS seamlessly deploys essential add-ons like the Amazon VPC CNI plugin for Kubernetes, kube-proxy, and CoreDNS for each cluster. These add-ons can either be self-managed or installed via Amazon EKS Add-ons, offering an alternative approach to add-on management through the EKS API.</p>\n<p>With Amazon EKS Add-ons, you gain the convenience of updating versions with a single command. For instance:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">aws eks update-addon --cluster-name my-cluster --addon-name vpc-cni --addon-version version-number <span class=\"token punctuation\">\\</span>\n--service-account-role-arn arn:aws:iam::111122223333:role/role-name --configuration-values <span class=\"token string\">'{}'</span> --resolve-conflicts PRESERVE</code></pre></div>\n<p>Check if you have any EKS Add-ons with:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">aws eks list-addons --cluster-name <span class=\"token operator\">&lt;</span>cluster name<span class=\"token operator\">></span></code></pre></div>\n<p>EKS Add-ons are not automatically upgraded during a control plane upgrade. You must initiate EKS add-on updates and select the desired version. You are responsible for selecting a compatible version from all available versions. Review the guidance on <a href=\"https://aws.github.io/aws-eks-best-practices/upgrades/#upgrade-add-ons-and-components-using-the-kubernetes-api\" target=\"_blank\" rel=\"noopener noreferrer\">add-on version compatibility</a>.</p>\n<div class=\"warning\">\n    <p><strong>‚ö†Ô∏è Warning:</strong></p>\n    <p>Amazon EKS Add-ons may only be upgraded one minor version at a time.</p>\n</div>\n<h3 id=\"Ô∏è-kube-no-trouble\" style=\"position:relative;\"><a href=\"#%EF%B8%8F-kube-no-trouble\" aria-label=\"Ô∏è kube no trouble permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üõ†Ô∏è Kube-no-trouble</h3>\n<p><a href=\"https://github.com/doitintl/kube-no-trouble\" target=\"_blank\" rel=\"noopener noreferrer\"><strong>Kube-no-trouble</strong></a> is an open-source command line utility with the command <code class=\"language-text\">kubent</code>. When you run <code class=\"language-text\">kubent</code> without any arguments, it will use your current KubeConfig context, scan the cluster, and print a report with what APIs will be deprecated and removed.</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">kubent</code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token number\">4</span>:17PM INF <span class=\"token operator\">>></span><span class=\"token operator\">></span> Kube No Trouble <span class=\"token variable\"><span class=\"token variable\">`</span>kubent<span class=\"token variable\">`</span></span> <span class=\"token operator\">&lt;&lt;&lt;</span>\n<span class=\"token number\">4</span>:17PM INF version <span class=\"token number\">0.7</span>.0 <span class=\"token punctuation\">(</span>git sha d1bb4e5fd6550b533b2013671aa8419d923ee042<span class=\"token punctuation\">)</span>\n<span class=\"token number\">4</span>:17PM INF Initializing collectors and retrieving data\n<span class=\"token number\">4</span>:17PM INF Target K8s version is <span class=\"token number\">1.24</span>.8-eks-ffeb93d\n<span class=\"token number\">4</span>:17PM INF Retrieved <span class=\"token number\">93</span> resources from collector <span class=\"token assign-left variable\">name</span><span class=\"token operator\">=</span>Cluster\n<span class=\"token number\">4</span>:17PM INF Retrieved <span class=\"token number\">16</span> resources from collector <span class=\"token assign-left variable\">name</span><span class=\"token operator\">=</span><span class=\"token string\">\"Helm v3\"</span>\n<span class=\"token number\">4</span>:17PM INF Loaded ruleset <span class=\"token assign-left variable\">name</span><span class=\"token operator\">=</span>custom.rego.tmpl\n<span class=\"token number\">4</span>:17PM INF Loaded ruleset <span class=\"token assign-left variable\">name</span><span class=\"token operator\">=</span>deprecated-1-16.rego\n<span class=\"token number\">4</span>:17PM INF Loaded ruleset <span class=\"token assign-left variable\">name</span><span class=\"token operator\">=</span>deprecated-1-22.rego\n<span class=\"token number\">4</span>:17PM INF Loaded ruleset <span class=\"token assign-left variable\">name</span><span class=\"token operator\">=</span>deprecated-1-25.rego\n<span class=\"token number\">4</span>:17PM INF Loaded ruleset <span class=\"token assign-left variable\">name</span><span class=\"token operator\">=</span>deprecated-1-26.rego\n<span class=\"token number\">4</span>:17PM INF Loaded ruleset <span class=\"token assign-left variable\">name</span><span class=\"token operator\">=</span>deprecated-future.rego\n__________________________________________________________________________________________\n<span class=\"token operator\">>></span><span class=\"token operator\">></span> Deprecated APIs removed <span class=\"token keyword\">in</span> <span class=\"token number\">1.25</span> <span class=\"token operator\">&lt;&lt;&lt;</span>\n------------------------------------------------------------------------------------------\nKIND                NAMESPACE     NAME             API_VERSION      REPLACE_WITH <span class=\"token punctuation\">(</span>SINCE<span class=\"token punctuation\">)</span>\nPodSecurityPolicy   <span class=\"token operator\">&lt;</span>undefined<span class=\"token operator\">></span>   eks.privileged   policy/v1beta1   <span class=\"token operator\">&lt;</span>removed<span class=\"token operator\">></span> <span class=\"token punctuation\">(</span><span class=\"token number\">1.21</span>.0<span class=\"token punctuation\">)</span></code></pre></div>\n<p>It can also be used to scan static manifest files and helm packages. It is recommended to run <code class=\"language-text\">kubent</code> as part of a continuous integration (CI) process to identify issues before manifests are deployed. Scanning manifests is also more accurate than scanning live clusters.</p>\n<p>Kube-no-trouble provides a sample <a href=\"https://github.com/doitintl/kube-no-trouble/blob/master/docs/k8s-sa-and-role-example.yaml\" target=\"_blank\" rel=\"noopener noreferrer\">Service Account and Role</a> with the appropriate permissions for scanning the cluster.</p>\n<h3 id=\"Ô∏è-pluto\" style=\"position:relative;\"><a href=\"#%EF%B8%8F-pluto\" aria-label=\"Ô∏è pluto permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üõ†Ô∏è Pluto</h3>\n<p>Another option is <a href=\"https://pluto.docs.fairwinds.com/\" target=\"_blank\" rel=\"noopener noreferrer\"><strong>Pluto</strong></a>, which is similar to <code class=\"language-text\">kubent</code> because it supports scanning a live cluster, manifest files, helm charts, and has a <a href=\"https://github.com/FairwindsOps/pluto\" target=\"_blank\" rel=\"noopener noreferrer\">GitHub Action</a> you can include in your CI process.</p>\n<p>See if you can upgrade safely against API paths. I use Pluto. This will check to see if you are calling deprecated or removed API paths in your configuration or helm charts. Run Pluto against local files with:</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">pluto detect-files <span class=\"token parameter variable\">-d</span></code></pre></div>\n<p>You can also check Helm with:</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">pluto detect-helm <span class=\"token parameter variable\">-o</span> wide</code></pre></div>\n<p>Adding all of this to CI is also pretty trivial and something I recommend for people managing many clusters.</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">pluto detect-all-in-cluster</code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"plaintext\"><pre class=\"language-plaintext\"><code class=\"language-plaintext\">NAME             KIND                VERSION          REPLACEMENT   REMOVED   DEPRECATED   REPL AVAIL  \neks.privileged   PodSecurityPolicy   policy/v1beta1                 false     true         true</code></pre></div>\n<p>After you have identified what workloads and manifests need to be updated, you may need to change the resource type in your manifest files (e.g., PodSecurityPolicies to PodSecurityStandards). This will require updating the resource specification and additional research depending on what resource is being replaced.</p>\n<p>If the resource type is staying the same but the API version needs to be updated, you can use the <code class=\"language-text\">kubectl-convert</code> command to automatically convert your manifest files. For example, to convert an older Deployment to <code class=\"language-text\">apps/v1</code>. For more information, see <a href=\"https://kubernetes.io/docs/tasks/tools/install-kubectl/\" target=\"_blank\" rel=\"noopener noreferrer\">Install kubectl convert plugin</a> on the Kubernetes website.</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">kubectl-convert <span class=\"token parameter variable\">-f</span> <span class=\"token operator\">&lt;</span>file<span class=\"token operator\">></span> --output-version <span class=\"token operator\">&lt;</span>group<span class=\"token operator\">></span>/<span class=\"token operator\">&lt;</span>version<span class=\"token operator\">></span></code></pre></div>\n<h3 id=\"Ô∏è-nova\" style=\"position:relative;\"><a href=\"#%EF%B8%8F-nova\" aria-label=\"Ô∏è nova permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üõ†Ô∏è Nova</h3>\n<p>Check your Helm releases for upgrades. Since typically things like the CNI and other dependencies like CoreDNS are installed with Helm, this is often the fastest way to make sure you are running the latest version (check patch notes to ensure they support the version you are targeting). I use <strong>Nova</strong> for this.</p>\n<h3 id=\"Ô∏è-kubepug\" style=\"position:relative;\"><a href=\"#%EF%B8%8F-kubepug\" aria-label=\"Ô∏è kubepug permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üõ†Ô∏è KubePug</h3>\n<p><strong>KubePug/Deprecations</strong> is designed to function as a kubectl plugin with the following capabilities:</p>\n<ul>\n<li><strong>Downloads Deprecation Data</strong>: It fetches a <code class=\"language-text\">data.json</code> file containing deprecation information related to Kubernetes APIs.</li>\n<li><strong>Validation Check</strong>: Verifies the current Kubernetes cluster or input files to determine whether objects exist in deprecated API Versions. This enables users to assess and plan for migration before proceeding.</li>\n</ul>\n<h4 id=\"key-features\" style=\"position:relative;\"><a href=\"#key-features\" aria-label=\"key features permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Key Features</h4>\n<ul>\n<li>Operates against a Kubernetes cluster, utilizing kubeconfig or the active cluster.</li>\n<li>Can be executed against a distinct set of manifests or files.</li>\n<li>Allows users to specify the target Kubernetes version for validation.</li>\n<li>Provides information on the replacement API that should be adopted.</li>\n<li>Offers details about the version in which the API was deprecated or removed, based on the target cluster version.</li>\n</ul>\n<h4 id=\"how-to-install-as-a-krew-plugin\" style=\"position:relative;\"><a href=\"#how-to-install-as-a-krew-plugin\" aria-label=\"how to install as a krew plugin permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>How to Install as a Krew Plugin</h4>\n<p>Simply run the following command to install it as a Krew plugin:</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">kubectl krew <span class=\"token function\">install</span> deprecations</code></pre></div>\n<h3 id=\"Ô∏è-eksup-cluster-upgrade-preparation-assistant\" style=\"position:relative;\"><a href=\"#%EF%B8%8F-eksup-cluster-upgrade-preparation-assistant\" aria-label=\"Ô∏è eksup cluster upgrade preparation assistant permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üõ†Ô∏è eksup: Cluster Upgrade Preparation Assistant</h3>\n<p><strong>eksup</strong> is a command-line interface (CLI) designed to empower users with comprehensive information and tools for preparing their clusters for an upgrade. It streamlines the upgrade process by delivering critical insights and actions for a seamless transition.</p>\n<h4 id=\"key-functions\" style=\"position:relative;\"><a href=\"#key-functions\" aria-label=\"key functions permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Key Functions</h4>\n<ul>\n<li><strong>Cluster Analysis</strong>: eksup allows users to assess their clusters against the next Kubernetes version, identifying any potential issues that could impact the upgrade process.</li>\n<li><strong>Playbook Generation</strong>: Users can generate customized playbooks that outline the upgrade steps specific to their cluster's analysis results. These playbooks detail the necessary actions and remediations.</li>\n<li><strong>Flexibility and Learning</strong>: The generated playbook is editable, enabling users to adapt the upgrade steps to align with their cluster configurations and business needs. It also provides a platform to document insights gained during the upgrade process.</li>\n<li><strong>Enhanced Collaboration</strong>: As upgrades are often initiated on non-production clusters first, any additional steps or insights discovered during this phase can be captured and utilized to enhance the upgrade process for production clusters.</li>\n<li><strong>Historical Artifact</strong>: Users are encouraged to preserve their playbooks as historical references. This practice ensures that each upgrade cycle benefits from a deeper understanding of the process, instilling confidence and efficiency in future upgrades before Kubernetes version support expires.</li>\n</ul>\n<p><strong>High Level¬†Diagram</strong></p>\n<p><span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 203.5294117647059%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAApCAYAAAA1bQl+AAAACXBIWXMAAAsTAAALEwEAmpwYAAAFvUlEQVR42o1Xh5LbNhDV//9fJpNiX3wqLCgkAbCBZfPeUrKdOymJZjikddRi8drCJ3nySf0o58tNrrdS+mGUV59932Xb9n98d/r40rZtUlZWvnz9Sy/jGplzlnmeZRgGCTFiwV7fq2uDha/6/LLgsqxSWy++6cS5Vgvme8FpYtER90m2dZWI4k3T/nvBnBepjJeydlJUTgtyaysKcPsJV+wH/S7EJL7t/m/Bo6hDpz226L2Xkds1Fa5CcvDS2xLPpSxD+lhw/35jQYut8jK2EedbCSHKNI6yD72sKcpcl5KrQrriKq4oZYseC9SyjpEFd5mjk2XstOaIH1a1RTGHu1E8z+ez1FUlGdiFlKTDAiTKOC8XKGFNXoKrZEzx6DA1RqY+aMEeTNbo7MDQaqfEj9cCUnIKkiNwnZIkb6XDljd0JvumWzyt64buoix5lhEdkE2DIixIHPm837Edx0kxTcMkK4igEixlBWX4tEgaVznNc5YGTPEiVsuyHAWN06JaUAW8YbEJP5qlTROYnqWyrVwKI3Fa5e2GxZskJ778s6gHYEipWN/q6gYYVsCv61ppu4B7wL3DnU20ijN/t6tz5CBlm6Lscw8YVmWzNlaqsgKGNZ4dxNuoSyhwkkZYdmDGghbkbes/dLhLaysZWiOyzjJPgxhjULDULVvfKSFcKKX+gKeLMs7Uq5NrUetz26+SsHVleV+zdscPVyfLlQHT5iDlEQTEsEujtHGUMW/ALEiNv6d5k5sBFPjbJ6doQRSq7qQQywTttdgeQyHCbnQOvZygO2LJHeR1lwXJ88R6GUC7e5deC7IAsZuwGIsODAd0THzLyqiEXnqZq/ElElMDy8u1UFYpJ+owhSADxL3mSRoI2zsrGwiN9gqvN58LEit6mJar7hhyy9olrdc10mOr25LFkry6hlOCuPIssXtR8LHd4s4ycaUldcsoNuBa4azWQ/gomEemzfZ8yz8XJEbEkMJNiC5qsWscOsSWtUPotCr1mcLe9mcjgFuGQ24VUqZAQJgWXt0hk1VCf8gmwHaUTe0DduElwsNXC42m+dVMqeHRSm4l7rcKUQVCkDQRwmYgMKk1iBFzBd7JC37jMA7i+Dyx6d/aUditfH0vNHWaMGhnR4fTIWx2iDERx+XeYX4ibOiwhOFpKcrnfCnk/XzVUA2R1osaEhxYDIYbPJ8BR+HS8w6pNZUMiLnVjbydS/n19zftsEcnjK04ZIgb09EFYO0kAMNzDTd9xJBMaXxZDiirLN+A5R9f3jQrIy2I7nTGqEUPDBdgWLj+SUEwTBGTZYbDtWrk27WWX377Iq6DG8YsHZnG1aNDYljivW5Y0GEQHz5smZ6k+S2GD+eJMccQ+hMdet+ouGnDHouusCKt+X6+qF1tOOR0+pg0LEgMSQhlQXK+vn1D2nR6qugxT7i1Fox65CLfJeMXO+h3OlMY6zyzsIvHXKZUmDo8GZQYATzHjNph0EIkhouWdx2aFj4HaSemyDAOGk89jhiUAwvSAXRKaTtlsgTjcUBnEXqEFpnSvuNRJGpSVw22DCxPH6Mr3d1wBCziqeVQisp8TIP+u4MeWZAuer/e0OEODWYl6hPL7JTTjh1e4ecSo7INEDS6GSbqEJk4zOptduiwQD9Dh6+cwszjMaS8E2I4AnAA1TMOCHOe4xMhC3KI4TvOh8TQdYNC8qnDWUk5ApbCZgHGFmcK8aYSSCRHJ8dBQIL/53HukYc/Tg6i45MM84BJp7Aw2ecJlgsBAVnW/UVB47+fER9nG3a/IDh6HEU6CJjMmiZK5Tr18sXAlnF+PvVqnSnN95nCLWV0Qa1aaJXdDgwReJnZyQOXC1mD9unUI3Z1be/Tz+uZWjtcodkpQ2+HRFwLm6LLOG7yXsEYzzrkCPhxxrY6AVmMnVP4Dh2yU81NdHe7FdoEnUNtPh1Sj4M5r/TT/1O4mB7t7ne97r95sPw3Ta9gVHMqBm4AAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"Alt text\" title=\"\" src=\"/static/2bcf04daf28b5bc0a01a97056b293483/c5bb3/eksup.png\" srcset=\"/static/2bcf04daf28b5bc0a01a97056b293483/04472/eksup.png 170w,\n/static/2bcf04daf28b5bc0a01a97056b293483/9f933/eksup.png 340w,\n/static/2bcf04daf28b5bc0a01a97056b293483/c5bb3/eksup.png 680w,\n/static/2bcf04daf28b5bc0a01a97056b293483/5a190/eksup.png 800w\" sizes=\"(max-width: 680px) 100vw, 680px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n    </span>\n          </p>\n<h3 id=\"-gonogo\" style=\"position:relative;\"><a href=\"#-gonogo\" aria-label=\" gonogo permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üö¶ GoNoGo</h3>\n<p><a href=\"https://github.com/FairwindsOps/GoNoGo\" target=\"_blank\" rel=\"noopener noreferrer\"><strong>GoNoGo</strong></a> is an alpha-stage tool to determine the upgrade confidence of your cluster add-ons.</p>\n<h3 id=\"Ô∏è-configure-poddisruptionbudgets-and-topologyspreadconstraints-during-data-plane-upgrade\" style=\"position:relative;\"><a href=\"#%EF%B8%8F-configure-poddisruptionbudgets-and-topologyspreadconstraints-during-data-plane-upgrade\" aria-label=\"Ô∏è configure poddisruptionbudgets and topologyspreadconstraints during data plane upgrade permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üõ°Ô∏è Configure PodDisruptionBudgets and TopologySpreadConstraints During Data Plane Upgrade</h3>\n<p>To safeguard the availability of your workloads during a data plane upgrade, it's crucial to configure <strong>PodDisruptionBudgets</strong> and <strong>topologySpreadConstraints</strong> appropriately. Remember that not all workloads demand the same level of availability. Thus, it's imperative to assess your workload's scale and requirements.</p>\n<p>Ensuring that workloads are distributed across multiple Availability Zones and hosts with topology spreads enhances the confidence that migrations to the new data plane will occur seamlessly and without disruptions.</p>\n<p>Here's an illustrative example of a workload configuration that guarantees 80% of replicas are consistently available and efficiently spreads replicas across zones and hosts:</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> policy/v1\n<span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> PodDisruptionBudget\n<span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> myapp\n<span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">minAvailable</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"80%\"</span>\n    <span class=\"token key atrule\">selector</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">matchLabels</span><span class=\"token punctuation\">:</span>\n            <span class=\"token key atrule\">app</span><span class=\"token punctuation\">:</span> myapp\n<span class=\"token punctuation\">---</span>\n<span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> apps/v1\n<span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> Deployment\n<span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> myapp\n<span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">replicas</span><span class=\"token punctuation\">:</span> <span class=\"token number\">10</span>\n    <span class=\"token key atrule\">selector</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">matchLabels</span><span class=\"token punctuation\">:</span>\n            <span class=\"token key atrule\">app</span><span class=\"token punctuation\">:</span> myapp\n    <span class=\"token key atrule\">template</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n            <span class=\"token key atrule\">labels</span><span class=\"token punctuation\">:</span>\n                <span class=\"token key atrule\">app</span><span class=\"token punctuation\">:</span> myapp\n        <span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span>\n            <span class=\"token key atrule\">containers</span><span class=\"token punctuation\">:</span>\n            <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> public.ecr.aws/eks<span class=\"token punctuation\">-</span>distro/kubernetes/pause<span class=\"token punctuation\">:</span><span class=\"token number\">3.2</span>\n                <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> myapp\n                <span class=\"token key atrule\">resources</span><span class=\"token punctuation\">:</span>\n                    <span class=\"token key atrule\">requests</span><span class=\"token punctuation\">:</span>\n                        <span class=\"token key atrule\">cpu</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"1\"</span>\n                        <span class=\"token key atrule\">memory</span><span class=\"token punctuation\">:</span> 256M\n            <span class=\"token key atrule\">topologySpreadConstraints</span><span class=\"token punctuation\">:</span>\n            <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">labelSelector</span><span class=\"token punctuation\">:</span>\n                    <span class=\"token key atrule\">matchLabels</span><span class=\"token punctuation\">:</span>\n                        <span class=\"token key atrule\">app</span><span class=\"token punctuation\">:</span> host<span class=\"token punctuation\">-</span>zone<span class=\"token punctuation\">-</span>spread\n                <span class=\"token key atrule\">maxSkew</span><span class=\"token punctuation\">:</span> <span class=\"token number\">2</span>\n                <span class=\"token key atrule\">topologyKey</span><span class=\"token punctuation\">:</span> kubernetes.io/hostname\n                <span class=\"token key atrule\">whenUnsatisfiable</span><span class=\"token punctuation\">:</span> DoNotSchedule\n            <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">labelSelector</span><span class=\"token punctuation\">:</span>\n                    <span class=\"token key atrule\">matchLabels</span><span class=\"token punctuation\">:</span>\n                        <span class=\"token key atrule\">app</span><span class=\"token punctuation\">:</span> host<span class=\"token punctuation\">-</span>zone<span class=\"token punctuation\">-</span>spread\n                <span class=\"token key atrule\">maxSkew</span><span class=\"token punctuation\">:</span> <span class=\"token number\">2</span>\n                <span class=\"token key atrule\">topologyKey</span><span class=\"token punctuation\">:</span> topology.kubernetes.io/zone\n                <span class=\"token key atrule\">whenUnsatisfiable</span><span class=\"token punctuation\">:</span> DoNotSchedule</code></pre></div>\n<h3 id=\"-aws-resilience-hub\" style=\"position:relative;\"><a href=\"#-aws-resilience-hub\" aria-label=\" aws resilience hub permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üåê AWS Resilience Hub</h3>\n<p><a href=\"https://aws.amazon.com/resilience-hub/\" target=\"_blank\" rel=\"noopener noreferrer\">AWS Resilience Hub</a> has added Amazon Elastic Kubernetes Service (Amazon EKS) as a supported resource. Resilience Hub provides a single place to define, validate, and track the resilience of your applications so that you can avoid unnecessary downtime caused by software, infrastructure, or operational disruptions.</p>\n<h3 id=\"Ô∏è-use-managed-node-groups-or-karpenter-to-simplify-data-plane-upgrades\" style=\"position:relative;\"><a href=\"#%EF%B8%8F-use-managed-node-groups-or-karpenter-to-simplify-data-plane-upgrades\" aria-label=\"Ô∏è use managed node groups or karpenter to simplify data plane upgrades permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üõ†Ô∏è Use Managed Node Groups or Karpenter to Simplify Data Plane Upgrades</h3>\n<p>Managed Node Groups and Karpenter both simplify node upgrades, but they take different approaches.</p>\n<ul>\n<li><strong>Managed Node Groups</strong>: Automate the provisioning and lifecycle management of nodes. This means that you can create, automatically update, or terminate nodes with a single operation.</li>\n<li><strong>Karpenter</strong>: Automatically creates new nodes using the latest compatible EKS Optimized AMI. As EKS releases updated EKS Optimized AMIs or the cluster is upgraded, Karpenter will automatically start using these images. <a href=\"https://aws.github.io/aws-eks-best-practices/upgrades/#enable-node-expiry-for-karpenter-managed-nodes\" target=\"_blank\" rel=\"noopener noreferrer\">Karpenter also implements Node Expiry to update nodes</a>. <a href=\"https://karpenter.sh/docs/concepts/node-templates/\" target=\"_blank\" rel=\"noopener noreferrer\">Karpenter can be configured to use custom AMIs</a>. If you use custom AMIs with Karpenter, you are responsible for the version of kubelet.</li>\n</ul>\n<h3 id=\"-use-code-classlanguage-texteksctlcode-to-automate-upgrades-for-self-managed-node-groups\" style=\"position:relative;\"><a href=\"#-use-code-classlanguage-texteksctlcode-to-automate-upgrades-for-self-managed-node-groups\" aria-label=\" use code classlanguage texteksctlcode to automate upgrades for self managed node groups permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>ü§ñ Use <code class=\"language-text\">eksctl</code> to Automate Upgrades for Self-Managed Node Groups</h3>\n<p>Self-managed node groups are EC2 instances that were deployed in your account and attached to the cluster outside of the EKS service. These are usually deployed and managed by some form of automation tooling. To upgrade self-managed node groups you should refer to your tools documentation.</p>\n<p>For example, <code class=\"language-text\">eksctl</code> supports <a href=\"https://eksctl.io/usage/managing-nodegroups/#deleting-and-draining\" target=\"_blank\" rel=\"noopener noreferrer\">deleting and draining self-managed nodes</a>. Some common tools include:</p>\n<ul>\n<li><a href=\"https://eksctl.io/usage/nodegroup-upgrade/\" target=\"_blank\" rel=\"noopener noreferrer\">eksctl</a></li>\n<li><a href=\"https://kops.sigs.k8s.io/operations/updates_and_upgrades/\" target=\"_blank\" rel=\"noopener noreferrer\">kOps</a></li>\n<li><a href=\"https://aws-ia.github.io/terraform-aws-eks-blueprints/node-groups/#self-managed-node-groups\" target=\"_blank\" rel=\"noopener noreferrer\">EKS Blueprints</a></li>\n</ul>\n<h3 id=\"-backup-the-cluster-before-upgrading\" style=\"position:relative;\"><a href=\"#-backup-the-cluster-before-upgrading\" aria-label=\" backup the cluster before upgrading permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üíæ Backup the Cluster Before Upgrading</h3>\n<p>New versions of Kubernetes introduce significant changes to your Amazon EKS cluster. After you upgrade a cluster, you can't downgrade it.</p>\n<p><a href=\"https://velero.io/\" target=\"_blank\" rel=\"noopener noreferrer\">Velero</a> is a community-supported open-source tool that can be used to take backups of existing clusters and apply the backups to a new cluster.</p>\n<p>Note that you can only create new clusters for Kubernetes versions currently supported by EKS. If the version your cluster is currently running is still supported and an upgrade fails, you can create a new cluster with the original version and restore the data plane. Note that AWS resources, including IAM, are not included in the backup by Velero. These resources would need to be recreated.</p>\n<h3 id=\"-anticipate-major-kubernetes-changes-stay-ahead-of-the-curve\" style=\"position:relative;\"><a href=\"#-anticipate-major-kubernetes-changes-stay-ahead-of-the-curve\" aria-label=\" anticipate major kubernetes changes stay ahead of the curve permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üìå Anticipate Major Kubernetes Changes‚Ää-‚ÄäStay Ahead of the Curve</h3>\n<p>Rather than solely focusing on the immediate next version of Kubernetes, adopt a forward-thinking approach. Continuously monitor new Kubernetes releases and be vigilant in identifying significant alterations. For instance, certain applications directly interfaced with the Docker API, and Kubernetes 1.24 made a pivotal change by removing support for Container Runtime Interface (CRI) for Docker, commonly known as Dockershim. üê≥ Preparing for such substantial changes demands additional time and planning.</p>\n<p>Examine all documented modifications for the version to which you plan to upgrade, meticulously noting any mandatory upgrade procedures. Additionally, pay attention to specific requirements or processes tailored to Amazon EKS managed clusters. This proactive stance ensures a smoother upgrade process while mitigating potential disruptions caused by unforeseen changes.</p>\n<p>Always keep an eye on <a href=\"https://github.com/kubernetes/kubernetes/tree/master/CHANGELOG\" target=\"_blank\" rel=\"noopener noreferrer\">Kubernetes CHANGLELOG</a></p>\n<h3 id=\"-important-guidance-on-feature-removals\" style=\"position:relative;\"><a href=\"#-important-guidance-on-feature-removals\" aria-label=\" important guidance on feature removals permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üö¢ Important Guidance on Feature Removals</h3>\n<h4 id=\"Ô∏è-removal-of-dockershim-in-125-transition-to-detector-for-docker-socket-dds\" style=\"position:relative;\"><a href=\"#%EF%B8%8F-removal-of-dockershim-in-125-transition-to-detector-for-docker-socket-dds\" aria-label=\"Ô∏è removal of dockershim in 125 transition to detector for docker socket dds permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>‚ñ∂Ô∏è Removal of Dockershim in 1.25‚Ää-‚ÄäTransition to Detector for Docker Socket (DDS)</h4>\n<p>In Kubernetes 1.25, Dockershim support has been discontinued, particularly in the EKS Optimized AMI for 1.25. If your applications rely on Dockershim, for instance, by mounting the Docker socket, it's imperative to eliminate these dependencies before proceeding with the upgrade of your worker nodes to version 1.25. This ensures a seamless transition without any disruptions caused by the removal of Dockershim.</p>\n<p>Find instances where you have a dependency on the Docker socket before upgrading to 1.25. We recommend using <a href=\"https://github.com/aws-containers/kubectl-detector-for-docker-socket\" target=\"_blank\" rel=\"noopener noreferrer\">Detector for Docker Socket (DDS)</a>, a kubectl plugin.</p>\n<h4 id=\"Ô∏è-removal-of-podsecuritypolicy-in-125-migration-to-pod-security-standards-or-policy-as-code-solution\" style=\"position:relative;\"><a href=\"#%EF%B8%8F-removal-of-podsecuritypolicy-in-125-migration-to-pod-security-standards-or-policy-as-code-solution\" aria-label=\"Ô∏è removal of podsecuritypolicy in 125 migration to pod security standards or policy as code solution permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>‚ñ∂Ô∏è Removal of PodSecurityPolicy in 1.25‚Ää-‚ÄäMigration to Pod Security Standards or Policy-as-Code Solution</h4>\n<p>PodSecurityPolicy, deprecated in Kubernetes 1.21, has been entirely removed in Kubernetes 1.25. If your cluster currently utilizes PodSecurityPolicy, it's paramount to initiate a migration process before upgrading your cluster to version 1.25. This migration should involve transitioning to the native Kubernetes Pod Security Standards (PSS) or implementing a policy-as-code solution. This proactive step is crucial for maintaining the uninterrupted functionality of your workloads during the upgrade.</p>\n<ul>\n<li>Review the <a href=\"https://kubernetes.io/docs/concepts/security/pod-security-standards/\" target=\"_blank\" rel=\"noopener noreferrer\">Pod Security Standards (PSS)</a> and <a href=\"https://kubernetes.io/docs/concepts/security/pod-security-admission/\" target=\"_blank\" rel=\"noopener noreferrer\">Pod Security Admission (PSA)</a> best practices.</li>\n<li>Review the <a href=\"https://kubernetes.io/blog/2021/04/06/podsecuritypolicy-deprecation-past-present-and-future/\" target=\"_blank\" rel=\"noopener noreferrer\">PodSecurityPolicy Deprecation blog post</a> on the Kubernetes website.</li>\n</ul>\n<h4 id=\"Ô∏è-deprecation-of-in-tree-storage-driver-in-123-migrate-to-container-storage-interface-csi-drivers\" style=\"position:relative;\"><a href=\"#%EF%B8%8F-deprecation-of-in-tree-storage-driver-in-123-migrate-to-container-storage-interface-csi-drivers\" aria-label=\"Ô∏è deprecation of in tree storage driver in 123 migrate to container storage interface csi drivers permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>‚ñ∂Ô∏è Deprecation of In-Tree Storage Driver in 1.23‚Ää-‚ÄäMigrate to Container Storage Interface (CSI) Drivers</h4>\n<p>The Container Storage Interface (CSI) was designed to help Kubernetes replace its existing, in-tree storage driver mechanisms. The Amazon EBS container storage interface (CSI) migration feature is enabled by default in Amazon EKS 1.23 and later clusters. If you have pods running on a version 1.22 or earlier cluster, then you must install the Amazon EBS CSI driver before updating your cluster to version 1.23 to avoid service interruption.</p>\n<ul>\n<li>Review the <a href=\"https://docs.aws.amazon.com/eks/latest/userguide/ebs-csi.html\" target=\"_blank\" rel=\"noopener noreferrer\">Amazon EBS CSI migration frequently asked questions</a>.</li>\n</ul>\n<h3 id=\"-conclusion\" style=\"position:relative;\"><a href=\"#-conclusion\" aria-label=\" conclusion permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üîö Conclusion</h3>\n<p>I trust that the information provided has been valuable to you. The journey of keeping Kubernetes consistently upgraded becomes less daunting with regular practice. The key takeaway is to allocate ample time to acclimate your environment with each minor release. By adhering to a predictable schedule, the process of upgrading clusters becomes remarkably painless and straightforward, even for less experienced users, as long as you perform the necessary checks.</p>\n<p>Remember, the key to success lies in regularity and thorough preparation when it comes to Kubernetes upgrades.</p>\n<p>We hope that you have found this blog post helpful. If you have any other tips or tricks that you would like to share, please leave a comment below.</p>\n<h2 id=\"-conclusion-1\" style=\"position:relative;\"><a href=\"#-conclusion-1\" aria-label=\" conclusion 1 permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üîö Conclusion</h2>\n<p>I trust that the information provided has been valuable to you. The journey of keeping Kubernetes consistently upgraded becomes less daunting with regular practice. The key takeaway is to allocate ample time to acclimate your environment with each minor release. By adhering to a predictable schedule, the process of upgrading clusters becomes remarkably painless and straightforward, even for less experienced users, as long as you perform the necessary checks.</p>\n<p>Remember, the key to success lies in regularity and thorough preparation when it comes to Kubernetes upgrades.</p>\n<p>We hope that you have found this blog post helpful. If you have any other tips or tricks that you would like to share, please leave a comment below.</p>\n<p><strong>üìï References:</strong></p>\n<ul>\n<li><a href=\"https://repost.aws/knowledge-center/eks-plan-upgrade-cluster\" target=\"_blank\" rel=\"noopener noreferrer\">AWS Knowledge Center: Plan an EKS Cluster Upgrade</a></li>\n<li><a href=\"https://aws.github.io/aws-eks-best-practices/upgrades/\" target=\"_blank\" rel=\"noopener noreferrer\">AWS EKS Best Practices: Upgrades</a></li>\n</ul>\n<br>\n<p><strong><em>Until next time, „Å§„Å•„Åè üéâ</em></strong></p>\n<blockquote>\n<p>üí° Thank you for Reading !! üôåüèªüòÅüìÉ, see you in the next blog.ü§ò  <em><strong>Until next time üéâ</strong></em></p>\n</blockquote>\n<p>üöÄ Thank you for sticking up till the end. If you have any questions/feedback regarding this blog feel free to connect with me:</p>\n<p><strong>‚ôªÔ∏è LinkedIn:</strong> <a href=\"https://www.linkedin.com/in/rajhi-saif/\" target=\"_blank\" rel=\"noopener noreferrer\">https://www.linkedin.com/in/rajhi-saif/</a></p>\n<p><strong>‚ôªÔ∏è X/Twitter:</strong> <a href=\"https://x.com/rajhisaifeddine\" target=\"_blank\" rel=\"noopener noreferrer\">https://x.com/rajhisaifeddine</a></p>\n<p><strong>The end ‚úåüèª</strong></p>\n<h1 align=\"center\">üî∞ Keep Learning !! Keep Sharing !! üî∞</h1>\n<p><strong>üìÖ Stay updated</strong></p>\n<p>Subscribe to our newsletter for more insights on AWS cloud computing and containers.</p>"},"nextThought":{"frontmatter":{"path":"/blog/eks-blueprints/","title":"Efficient Kubernetes Cluster Deployment: Accelerating Setup with EKS Blueprints","date":"2024-10-17 20:06:00"},"excerpt":"‚ÄòEKS‚Äôpress Lane to Seamless EKS Setup üòå ‚ÑπÔ∏è Introduction In the ever-evolving landscape of containerized applications, efficient Kubernetes‚Ä¶","html":"<blockquote>\n<p><strong>‚ÄòEKS‚Äôpress Lane to Seamless EKS Setup üòå</strong></p>\n</blockquote>\n<h2 id=\"‚ÑπÔ∏è-introduction\" style=\"position:relative;\"><a href=\"#%E2%84%B9%EF%B8%8F-introduction\" aria-label=\"‚ÑπÔ∏è introduction permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>‚ÑπÔ∏è Introduction</h2>\n<p>In the ever-evolving landscape of containerized applications, efficient Kubernetes cluster deployment is a key objective for organizations.</p>\n<p>However, the traditional process of setting up and configuring clusters often proves to be a time-consuming and complex endeavor, posing challenges for teams looking to streamline their deployment workflows.</p>\n<p>Fortunately, a transformative solution exists: EKS Blueprints. By leveraging the capabilities of EKS Blueprints, organizations can accelerate cluster setup, reduce time-to-value, and enhance scalability and operational efficiency.</p>\n<h2 id=\"-goals--objectives\" style=\"position:relative;\"><a href=\"#-goals--objectives\" aria-label=\" goals  objectives permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üéØ Goals &#x26; Objectives</h2>\n<p>In this blog post, we will explore the situation surrounding Kubernetes cluster deployment, and unveil the power of EKS Blueprints as the game-changing solution.</p>\n<p>Prepare to discover a new era of efficient Kubernetes cluster deployment with EKS Blueprints. üéâ</p>\n<h2 id=\"-enhancing-the-standard-eks-blueprints-and-terraform-aws-modules-eks\" style=\"position:relative;\"><a href=\"#-enhancing-the-standard-eks-blueprints-and-terraform-aws-modules-eks\" aria-label=\" enhancing the standard eks blueprints and terraform aws modules eks permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üöÄ Enhancing the Standard: EKS Blueprints and terraform-aws-modules-eks</h2>\n<p>Today, we are introducing a new open-source project called <strong>EKS Blueprints</strong> that makes it easier and faster for you to adopt <a href=\"https://aws.amazon.com/eks/\" target=\"_blank\" rel=\"noopener noreferrer\">Amazon Elastic Kubernetes Service (Amazon EKS)</a>.</p>\n<p>EKS Blueprints is a collection of Infrastructure as Code (IaC) modules that will help you configure and deploy consistent, batteries-included EKS clusters across accounts and regions.</p>\n<p>You can use EKS Blueprints to easily bootstrap an EKS cluster with Amazon EKS add-ons as well as a wide range of popular open-source add-ons, including:</p>\n<ul>\n<li>Prometheus</li>\n<li>Karpenter</li>\n<li>Nginx</li>\n<li>Traefik</li>\n<li>AWS Load Balancer Controller</li>\n<li>Fluent Bit</li>\n<li>Keda</li>\n<li>Argo CD</li>\n<li>and more üòÉ</li>\n</ul>\n<p>EKS Blueprints also helps you implement relevant security controls needed to operate workloads from multiple teams in the same cluster.</p>\n<p><span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 107.6470588235294%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAWCAYAAADAQbwGAAAACXBIWXMAAAsTAAALEwEAmpwYAAAERklEQVR42o1V2XIcRRDc/3/lgR8gwEAQQRgbwiGMJctIsmVL2rW00t6n9py7p++dTbJHsrF5YjZqZrqnuyorK6u3cdvpYzRfw9odlNKPZqC1hTW+fv8/JrlPa4NGr9vHdye3uIsj+GoH6z38roI0CluxheP4k9na3MN4t/vinfPOQZQSDUcUkc7w4s230NkKFZ3yhmk6xpvREcJlw2aa57yv9nB8hvGOT/c4Nt7WKBtSKnhu0rMbqNtjqM4JKkb0XDBOpvgwO0eiEqIGWotrtJZNZDqHcjucT99iEA8hbAlpg0OFhtKasB32dJp1zrB+95TvjCoTzLN7nM9PMUr6dODQ2fRwMX9boy+tR3NxiZtVE6ti8YVDwvR0oJMtbBrTEtgshrEFFHmc5zOM0yE3aOS6xCQdYZZNGcATecpgQ6zEsg5YO5RS1jylLw8R/fobNt//hPTgFSr+pMq5eEKkRGQMCqZ6nw+wYJCAMNcRnQ+wLddfI9yRWMOIJctfCEGCidlr9DY5TiYxttKQwx3ezxJ8WGSIg7TI4fFwQxoyZEE6nx2yKOQb8sMV8sMjiMsx5EGLc3uiMXh7N0FvxpS4qLMpcX47xGiVQPkKzfsCzVmE+0z/m7LiraLD+OM14ov3yLpTbE9bcGRWcX5y9AT9V09QhqJpj97TbzBqnUKyirFQaLc/Yh6lDPCJQ8IPV68tcHMhMOoRxXGE3d6hsBWuumPaCNLvEUmLVn+C/jIiogrzhGs7Y0yjAtr9x+Hgdou7yxWm/QTNkxlT9lzkUZhAvoMmr9I+BAkWHEq2a24qFoht6z4LW7KPHSXCXqRZfijYk4kIph9NPTyVw2YVQcQxyjyDZAGVVpDUcrC69XLpEBeWzhyrHGDTURE+KghR1mloSibLSojlptaf5rzOcmo3hQ6HAgtraI6AGqXyiKOYkyUnBR2Qp5HFzVjjXTtFa6hwObAoS8v+VEh/+BlVIWqasN/jq4vSapRS46b1EXmaIU1myIXEBQtzPSzR7Au0BoJSyYnYwhuLwY+/wD069EG7JbMgGOuCdj0amqTfTYmQi8Om8Nx5wnemPp4Cp0YJZsAGYCWDZuM/DpA+fYazKXDcLPCqKXDYpFMWrxG4y4qSkSRGkwvkhcThMbsjVog39xBEUwQ6uHgZkWdD+fT72HZ6mKxLLDYS28xhvpYMSISGLVQsZ9wo8eezLtb8cHkjkGQGr5sx8pzoulfYk/DnZzG608d0eQiHI06Rd80MwkFb+UeH88418kzi5Pc14i0rTJ1JIvq7TQmx4vr6HJYZqJIb6Sz/6zXEiwNcLYDzO4mzW8UWpeSYbcPw1Oj2Y2Qk9+XsiI1eIByO4Ujfs4qKnA6TjP8btj7Jw7W85Bn4/gLtmSDiHKOlQXsk4KnnhmOTGxbGBNUrCW3D/wfniNywG0JAEXTGxXv/UMk9HVeUSOUN9jvLseP44fs/QWaFQGyRFzgAAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"Alt text\" title=\"\" src=\"/static/701a878bcab1c7cc0bc05ebc76f1c285/c5bb3/eks-addons.png\" srcset=\"/static/701a878bcab1c7cc0bc05ebc76f1c285/04472/eks-addons.png 170w,\n/static/701a878bcab1c7cc0bc05ebc76f1c285/9f933/eks-addons.png 340w,\n/static/701a878bcab1c7cc0bc05ebc76f1c285/c5bb3/eks-addons.png 680w,\n/static/701a878bcab1c7cc0bc05ebc76f1c285/5a190/eks-addons.png 800w\" sizes=\"(max-width: 680px) 100vw, 680px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n    </span>\n          </p>\n<h2 id=\"Ô∏è-takeaway-\" style=\"position:relative;\"><a href=\"#%EF%B8%8F-takeaway-\" aria-label=\"Ô∏è takeaway  permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>‚û°Ô∏è Takeaway üéä</h2>\n<p>Upon reviewing EKS Blueprints, I found myself pondering its relationship with <a href=\"https://github.com/terraform-aws-modules/terraform-aws-eks\" target=\"_blank\" rel=\"noopener noreferrer\">terraform-aws-modules-eks</a>. In reality, EKS Blueprints does not stand in opposition to or compete with terraform-aws-modules-eks; rather, it complements and extends its functionality. EKS Blueprints acts as a valuable enhancement to the standard EKS module, enriching it with additional features and refinements, effectively adding a touch of sweetness and spice to the existing framework.</p>\n<h3 id=\"-diving-into-the-depths-the-hidden-gems-of-eks-blueprints-\" style=\"position:relative;\"><a href=\"#-diving-into-the-depths-the-hidden-gems-of-eks-blueprints-\" aria-label=\" diving into the depths the hidden gems of eks blueprints  permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üîç Diving Into the Depths: The Hidden Gems of EKS Blueprints üîµ</h3>\n<p>EKS Blueprints is implemented in two popular IaC frameworks, <a href=\"https://www.terraform.io/\" target=\"_blank\" rel=\"noopener noreferrer\">HashiCorp Terraform</a> and <a href=\"https://aws.amazon.com/cdk/\" target=\"_blank\" rel=\"noopener noreferrer\">AWS Cloud Development Kit (AWS CDK)</a>, which help you automate infrastructure deployments. To get started, please visit the Getting Started guides for either <a href=\"https://aws-ia.github.io/terraform-aws-eks-blueprints/\" target=\"_blank\" rel=\"noopener noreferrer\">EKS Blueprints for Terraform</a> or <a href=\"https://aws-quickstart.github.io/cdk-eks-blueprints/getting-started/\" target=\"_blank\" rel=\"noopener noreferrer\">EKS Blueprints for CDK</a>.</p>\n<p>EKS Blueprints offers the capability to provision both EKS and self-managed add-ons within an EKS cluster. As the EKS service continues to expand its collection of EKS add-ons, EKS Blueprints will also evolve to incorporate these additional capabilities. It handles the configuration of appropriate IAM policies, roles, and service accounts for each add-on, as outlined in the <a href=\"https://docs.aws.amazon.com/eks/latest/userguide/iam-roles-for-service-accounts.html\" target=\"_blank\" rel=\"noopener noreferrer\">EKS IAM roles for service accounts (IRSA)</a> documentation.</p>\n<p>When it comes to facilitating multiple teams running workloads in the same cluster, <strong>EKS Blueprints</strong> comes to the rescue by enabling configuration and management of user and team access. This applies to both cluster-level access (admin teams) and access to specific namespaces within the cluster (application teams).</p>\n<p>For those seeking a GitOps-based approach to managing cluster configuration and workloads, EKS Blueprints offers the means to bootstrap a cluster with <a href=\"https://argo-cd.readthedocs.io/en/stable/\" target=\"_blank\" rel=\"noopener noreferrer\">Argo CD</a> and any number of Argo CD application resources. Additionally, support for <a href=\"https://fluxcd.io/\" target=\"_blank\" rel=\"noopener noreferrer\">Flux</a> is also on the roadmap, expanding the options available for GitOps-based management.</p>\n<p><strong>üîë Key Features:</strong></p>\n<ul>\n<li><strong>User and Team Access Management</strong>: Configure and manage access for multiple teams.</li>\n<li><strong>Cluster-Level Access</strong>: Admin teams can manage the entire cluster.</li>\n<li><strong>Namespace-Specific Access</strong>: Application teams can access specific namespaces.</li>\n</ul>\n<p><strong>üåü GitOps Integration:</strong></p>\n<ul>\n<li><strong>Argo CD</strong>: Bootstrap clusters with Argo CD and manage applications declaratively.</li>\n<li><strong>Flux (Upcoming)</strong>: Future support for Flux will provide more options for GitOps-based management.</li>\n</ul>\n<h2 id=\"Ô∏è-hands-on-with-eks-blueprints-cluster-deployment-and-add-on-configuration\" style=\"position:relative;\"><a href=\"#%EF%B8%8F-hands-on-with-eks-blueprints-cluster-deployment-and-add-on-configuration\" aria-label=\"Ô∏è hands on with eks blueprints cluster deployment and add on configuration permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üõ†Ô∏è Hands-On with EKS Blueprints: Cluster Deployment and Add-On Configuration</h2>\n<p>Experience the capabilities of <strong>EKS Blueprints</strong> firsthand as we explore its practical implementation. In this example, we showcase a Terraform blueprint that effortlessly deploys a fresh EKS cluster accompanied by a managed node group.</p>\n<p>Not only that, but it also seamlessly bootstraps the cluster with a suite of essential add-ons, including:</p>\n<ul>\n<li><code class=\"language-text\">vpc-cni</code></li>\n<li><code class=\"language-text\">coredns</code></li>\n<li><code class=\"language-text\">kube-proxy</code></li>\n<li><code class=\"language-text\">aws-load-balancer-controller</code></li>\n<li><code class=\"language-text\">metrics server</code></li>\n<li><code class=\"language-text\">cluster-autoscaler</code></li>\n</ul>\n<p>Enabling the installation of an add-on within an EKS cluster is as straightforward as toggling a boolean value to <code class=\"language-text\">true</code>. Join us as we unveil the true power and simplicity of EKS Blueprints in action.</p>\n<p><span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 160.58823529411765%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAgCAYAAAASYli2AAAACXBIWXMAAAsTAAALEwEAmpwYAAADAklEQVR42p1W23baMBCUrLslWTbGQErT9v+/MTrbWRkSQtPE5GFYIeyR9jaL+D2bl2nqyApBtnuD2wiv3hC0JDHb7mXfKzrsJP16EnQ+CFpGRdlLGoKgwQus35Bu1tG+J2SI3siXmAxlkJ5mQcedoMMkaJcF7cuK+WIP+G0/8oErpvQBYbSy7qKiXdI09ppKz1bhYUUzDuJ93hu8IiMvIYHl9b3LjTBZXZchUfGGBqfwoib+fhgyiG0jygAOvonVinuy1WWt6uh7EAZim6ylEgLt+khj6LEXcJAlpz4m+OCGso6xg2twMWs6FEPJre7xA+4Cv5UwGlWXHGkPLDmB1LaAhwdI7lwWNbmuxYnB69J3hOx/jzA7VZ/Gnp6X1HCeI/1cImUQf5TFLwmD7uo0JpRJomQsRWPIa/XaMdesbib0nah9UFR2gXJxgKcJyflzFvR8YkgqUWy+rcCDNVmDhAwo5NRKZi6WfiwCncPtpx5zGR91aEXN7qrWBdmv8ftfN3xeh07XYC4JuLzsvhG7G3FQlW91bafP2moT4RC6OmfTtEzL943/KBrhYlU9Rk1Pi2yJYJwPshV5b1bNu+L++z3YM9xQ1mlCu02KzssqsIx9kU0XGdyKbFkrr+tb7WTL4APFGEVlAWVBdTdaZ2/gbsfCXczcP52iVB0cipoB6dqXDGUuzR7nETcfoIuQtrAiGf2p+kBtZC2IFxdwtCwKsI7XLBS62V7z/gpO3hd1iKSUQMcRHZIcXl4JvJKXzMlG5LXcKrCmHvJExwa4mAbI/4iu0S1ufGNuSYyKTUIrMghPw0QnkBxzWQlhZ4wAbkUm2sW4nZAVe+4zCCBhISHwsc2TiZPgPWaNw55vN95GaCEOQVKbK3kdn9HJd+ViHxCJNkZPpSBuPDojHcsAKctrZoHkDE19/2V23yWFE7KP0MOYEUPUIOJ4rbsSHPbTI4S6cnb3KYN0jSUnJXISOtHsg4S4ITJ8JVva7fyrLnJxP0SYnan8MMeL7f2Lqz5uI+O/c38BsNuv4VjqhcgAAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"Terraform Code Example\" title=\"\" src=\"/static/c73252aacccfc4f94c90bc4f3880c822/c5bb3/tf-code.png\" srcset=\"/static/c73252aacccfc4f94c90bc4f3880c822/04472/tf-code.png 170w,\n/static/c73252aacccfc4f94c90bc4f3880c822/9f933/tf-code.png 340w,\n/static/c73252aacccfc4f94c90bc4f3880c822/c5bb3/tf-code.png 680w,\n/static/c73252aacccfc4f94c90bc4f3880c822/5a190/tf-code.png 800w\" sizes=\"(max-width: 680px) 100vw, 680px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n    </span>\n          </p>\n<p>For a comprehensive list of add-ons, visit the <a href=\"https://github.com/aws-ia/terraform-aws-eks-blueprints/tree/main/modules/kubernetes-addons\" target=\"_blank\" rel=\"noopener noreferrer\">EKS Blueprints GitHub repository</a>.</p>\n<h2 id=\"Ô∏è-customizing-kubernetes-add-ons-with-eks-blueprints\" style=\"position:relative;\"><a href=\"#%EF%B8%8F-customizing-kubernetes-add-ons-with-eks-blueprints\" aria-label=\"Ô∏è customizing kubernetes add ons with eks blueprints permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üõ†Ô∏è Customizing Kubernetes Add-Ons with EKS Blueprints</h2>\n<p>Each add-on seamlessly integrates with an open-source, upstream Helm repository, ensuring access to the latest features and updates. EKS Blueprints simplifies the configuration of default IAM roles for service accounts (IRSA) associated with each add-on, enabling secure requests to AWS APIs.</p>\n<p>For advanced customization requirements, EKS Blueprints offers flexibility by allowing easy overrides of default Helm values. For instance, you can effortlessly replace Docker images specified in the <code class=\"language-text\">values.yaml</code> file with private Docker repositories like <a href=\"https://aws.amazon.com/ecr/\" target=\"_blank\" rel=\"noopener noreferrer\">ECR</a> or <a href=\"https://jfrog.com/artifactory/\" target=\"_blank\" rel=\"noopener noreferrer\">Artifactory</a>.</p>\n<p>Explore the following code snippet to learn how to leverage advanced configuration options specifically for the AWS Load Balancer Controller add-on:</p>\n<p><span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 75.88235294117648%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAAAsTAAALEwEAmpwYAAABvElEQVR42p2T2W7bMBBF81pbO0lL1soh5SYtGuT//83C7aVJGwaaxEYfjoaUhlez8cVN/qxHh13hkFUO+5I2sS8/339FOP+i2t/ntvsFPTkYIc7h4DzqdkWhHUpDaAsTKa/vDtHefEhWU7Axch57gRlWNIxUJeqjQzOQnus+2rC/rlX4FvySDd/yhoKFkS1vPXL+ac+0d7lECpKlde5uBJ+vCGV5KZVsLSMM6E7QjX8wzB+07xiWD/TTO9rBo5voMwpqk+pVJ6o7G2pYNG5THUNmTYKz6lYo1q85RFubE+pQLyWgL/K7w5/BpsgmbwJ5Ffg3CzlZ2NVikrgerWAWNqhZb538VpCPbTouUEbQtCeY2ePAbl+wDi0FjfWoDv45QTptw8JDR0HF9DQFTRIMVi+0NnWxfkpQtp5RTF4uNVOjv4xF1cbRudDFUQkzl5VPRDhxmOcTO8iUFSNUcxS6jkJ2dxMeNiUIdqPFvHhMFHPrwiaE2xLT1XNMV6XhDXXOKv99yo1e0WmLo7HozYJWh5TZCKaap6iuPKwhx2FrzE/smNIPsktcLnzxWOAfwUqfNkZ5e5Ensv8grz3+Ar81fYH4McrMAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"Alt text\" title=\"\" src=\"/static/2f4869df332b144e2d6fc77a5b6d381d/c5bb3/albc.png\" srcset=\"/static/2f4869df332b144e2d6fc77a5b6d381d/04472/albc.png 170w,\n/static/2f4869df332b144e2d6fc77a5b6d381d/9f933/albc.png 340w,\n/static/2f4869df332b144e2d6fc77a5b6d381d/c5bb3/albc.png 680w,\n/static/2f4869df332b144e2d6fc77a5b6d381d/5a190/albc.png 800w\" sizes=\"(max-width: 680px) 100vw, 680px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n    </span>\n          </p>\n<h2 id=\"-gitops-with-eks-blueprints-deploying-and-managing-add-ons-and-workloads\" style=\"position:relative;\"><a href=\"#-gitops-with-eks-blueprints-deploying-and-managing-add-ons-and-workloads\" aria-label=\" gitops with eks blueprints deploying and managing add ons and workloads permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üåü GitOps with EKS Blueprints: Deploying and Managing Add-Ons and Workloads</h2>\n<p>With built-in support for <a href=\"https://argo-cd.readthedocs.io/en/stable/\" target=\"_blank\" rel=\"noopener noreferrer\">Argo CD</a>, you can effortlessly adopt a GitOps-based approach. Bootstrap your EKS cluster with Argo CD and unleash the potential of managing one or multiple Argo CD Application resources.</p>\n<p>EKS Blueprints includes two sample Argo CD repositories:</p>\n<ul>\n<li><strong>Workloads Repository</strong>: Showcasing workload configuration management.</li>\n<li><strong>Add-Ons Repository</strong>: Demonstrating add-on configuration management.</li>\n</ul>\n<p>Both repositories follow the proven Argo CD <a href=\"https://argo-cd.readthedocs.io/en/stable/operator-manual/cluster-bootstrapping/\" target=\"_blank\" rel=\"noopener noreferrer\">App of Apps Pattern</a>. To demonstrate the power of GitOps, we present a code snippet that exemplifies how to bootstrap an EKS cluster with Argo CD along with two application resources utilizing the provided sample repositories.</p>\n<p><span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 68.23529411764706%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAAAsTAAALEwEAmpwYAAABz0lEQVR42p1Ta1PiQBAMoAl5QEBehhCIqNlAIIDnu0rL//+nxp7ZDRjLuyrvQ9fszmR7tnsn1iTPqDlR1BpnR5xN8l+jNVbkRGuywnRPweJAnfQB8Z66V4/kxlt8pP6DNCfLT3YgKMmd7ej8ck02urSjAuuVubH6EpU0qu/rpFa4fKJw+Uy96xeQliAsKEwO1J0fpAmjjRu78U7qzrQ45lmJjcY1wkH2RoxR/kFD9Q68UQBCd7olf3FHviH2kPOSPQg31Fn8kbwHZTZU1Qj7N68UoOhMdYGl2tGKziGtMbyl5igTNEa3xz3HhuQU9nXpFncLgJbxhpPD65KGyy0Fs4I6SYUNbMDtZnrNtaruz9bkGOmWP7+jHnwMEPlx2K8LvHy42AIb6gF9rDlepDrH+xDkjD5y3MiJDCEbzUTiCTxio9m/s8lK5DTH6hT/grrkVM9eOy7MSOiifQk/EX86fIr5l7whDMTDezOYmTzKGB7Gak+DK5ZTiFyWx7FrpIqf8C80NS9enzzkWeyAVCTDgkEKX+elHGDCrhDow0LC+0Q/StWAH0YI+REceOYlelideENuxANb6JEYqX97WY2OscuqfPv+i7V++S8zuZ+U9AnprWr/X7IrRwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"GitOps Workflow\" title=\"\" src=\"/static/a3a1b484aa9a3b6e9da126f4c0a611a3/c5bb3/gitops.png\" srcset=\"/static/a3a1b484aa9a3b6e9da126f4c0a611a3/04472/gitops.png 170w,\n/static/a3a1b484aa9a3b6e9da126f4c0a611a3/9f933/gitops.png 340w,\n/static/a3a1b484aa9a3b6e9da126f4c0a611a3/c5bb3/gitops.png 680w,\n/static/a3a1b484aa9a3b6e9da126f4c0a611a3/5a190/gitops.png 800w\" sizes=\"(max-width: 680px) 100vw, 680px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n    </span>\n          </p>\n<h2 id=\"eks-addons-blueprint-delegating-to-argocd\" style=\"position:relative;\"><a href=\"#eks-addons-blueprint-delegating-to-argocd\" aria-label=\"eks addons blueprint delegating to argocd permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>EKS Addons Blueprint: Delegating to ArgoCD</h2>\n<p><span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 72px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 100%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAsTAAALEwEAmpwYAAAEq0lEQVR42pVVe0xTVxw+LUycgb1kT3RBxQVdhhNYxImUCcoWQsYMHcLYkBSQR4tTWCRKqKW3La0IRHkE2OgtTpRCactgvMH2UmixakIMmZooS0RcQmRqFoT23t/OLY+A7g93kl/O7/zuPd/9vvP4LkIIccRiMReHO9ujxQYAHPbZivx/N9ckgiBipFJpvFKp9Fp6UDE46Kk2WaM1lC2XpGwn1JQ1hK3ztVo3NlahYIAQHN0YpAX3gUVFRUk4H8dx9eyxY68OArirzdZykho1k0O2XgxoVlM2bU2bfd0ykZUKsMw38ORImUyWq1DIxgni5PtsvbhYZi0Si2Nb/ny4GTMykZarOvWQTUcOjXaRllGCfedHjSFYpGn9GrNcs4olu35sf7rojLKg6Nw5NpdIi1VEYYGs/cGDbaTZOoiZGUgLDmq0r3HkWoCgrjFApNH3iBr0w0KyRbiI49oDjjiZt5ZNjLVJ+zprYyZgGCVqKxNbTp6Sl+juTARiyRTJsqNs/Q2UTSKo074lami9jKND2KA3CDWtrekX27wXdxO5UB096CDdzXkCFBfgD0Rf14dDc/nBsXG7MKuGGu/UUFYjZtehttj9M9U6qeiCvh/L1WMwoxADiy4Yti8pdvvEF/38pAvNYWYwbeDQXQrkuN/i5aRNHjBj8v2r3mTXa6gRU6PNnpZR35Sc06A3Yam6bFJnyCGbu3I0uracOuO7S4DbU6MxUSuinT2I/uozBCzxA0G41odoNoxDF03Vo5PVhU3NCUfUxrYsta5NWN/YffySoSOV7Lv8bbV5z6Jc125zzWVoAGwIZozI6eO9APjOmwge6TkMDCK4q98/2a7Jr/uB7Lik0p2/l1db9vQQUTWXKpU4hzv3WWAK+W7Ze2pjdvb36xeAB1A1ZghgQo4KEYKtPgjqf8JjMwJHDwegGsF8icdc7ZmkWUmDEvosIqj7hQ+Buw+ANG8nTNv9HSmpyZMx/Cw/F+CsEQngNwR0L3oGFJZ5BTEsGN2PgGlH4DzLZaAUMY9VHpDwTTgz9vtWBu55gyhtF7N95/758e5tcGcwKHX5HAIPraXbkB1uYDZXuDQzwIH5Xg7j7OMCXYOBVRi0FMsvQ0zKl59CQd4ugIc+0FH/MXwUEElrq3bg674+YunYLBjAdfQ2jCAlDCEbXoIJljGW6sRgDH0WMy5BzFz5K8yhmBCIi9sLcGsjTAxscYaERoCqIHgaYN17q0whKPLE6xFxuVmHBWlqgSDpZm++/9R0+WZwlLozLDumzA1mu7xpfnzYfFRUmOOx3dfx+NomOjY2AqKjw466kPh8t2VrSk9P//C7w4JfY+NTChMER4/kS0tuVsmPj7cWH/q7Xx71tLUy8Rnc/cCZmcaD8Mj9zKMxP5gZ3fRPTHRo5sK1Q9wXrEurrfBUqYpLFXLZlEImrZRIZHskhPKWnJBknJYpbsB9r93JCZ8X8iK+UN7u8cuAaZ8NruV6DmyZJb7cG7B9ScViaSg7VigUTSqlgiQIcbBCLr/9XybKZ2W+jNFi8DXY1sawRwbjj+wgCOmQq87jufNw4APv/gKz5xvLdOWvAPevsTWWBc49X8b3/wUhsp1PyKOTfgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"GitOps Workflow\" title=\"\" src=\"/static/60f7b462aa2aa9d6bec64b055e4bc4d5/044e1/bee.png\" srcset=\"/static/60f7b462aa2aa9d6bec64b055e4bc4d5/044e1/bee.png 72w\" sizes=\"(max-width: 72px) 100vw, 72px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n    </span>\n          </p>\n<p>The Helm Addon module provided by the <a href=\"https://github.com/aws-ia/terraform-aws-eks-blueprints\" target=\"_blank\" rel=\"noopener noreferrer\">terraform-aws-eks-blueprints</a> repository allows you to provision a generic Helm Chart as an add-on for an EKS cluster provisioned using the EKS Blueprints. This module offers flexibility in managing the installation of Helm charts and provides the option to delegate the installation to ArgoCD.</p>\n<p>Here's a breakdown of the module's functionality:</p>\n<h3 id=\"Ô∏è-iam-role-for-service-accounts\" style=\"position:relative;\"><a href=\"#%EF%B8%8F-iam-role-for-service-accounts\" aria-label=\"Ô∏è iam role for service accounts permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>‚ñ∂Ô∏è IAM Role for Service Accounts</h3>\n<p>The module creates an IAM role for Service Accounts (IRSA) with the provided configuration for the IRSA module. This ensures that the necessary permissions are granted to the add-on for making requests to AWS APIs.</p>\n<h3 id=\"Ô∏è-helm-chart-installation\" style=\"position:relative;\"><a href=\"#%EF%B8%8F-helm-chart-installation\" aria-label=\"Ô∏è helm chart installation permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>‚ñ∂Ô∏è Helm Chart Installation</h3>\n<p>If <code class=\"language-text\">manage_via_gitops</code> is set to <code class=\"language-text\">false</code>, the module provisions the Helm chart for the add-on based on the configuration provided in the <code class=\"language-text\">helm_config</code> section, following the <a href=\"https://registry.terraform.io/providers/hashicorp/helm/latest/docs\" target=\"_blank\" rel=\"noopener noreferrer\">Helm provider documentation</a>.</p>\n<p>This means that the module will handle the installation of the Helm chart directly within the Terraform code, based on the provided configuration.</p>\n<h3 id=\"Ô∏è-delegating-installation-to-argocd\" style=\"position:relative;\"><a href=\"#%EF%B8%8F-delegating-installation-to-argocd\" aria-label=\"Ô∏è delegating installation to argocd permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>‚ñ∂Ô∏è Delegating Installation to ArgoCD</h3>\n<p>Here's the awesome part! If you set <code class=\"language-text\">manage_via_gitops</code> to <code class=\"language-text\">true</code>, you can delegate the installation of the Helm chart to <a href=\"https://argo-cd.readthedocs.io/en/stable/\" target=\"_blank\" rel=\"noopener noreferrer\">ArgoCD</a>.</p>\n<p>By specifying <code class=\"language-text\">manage_via_gitops</code> as <code class=\"language-text\">true</code>, you are indicating that you want to manage the add-on installation through a GitOps-based approach, and in this case, using ArgoCD.</p>\n<p>Instead of installing the Helm chart directly, you can include a snippet in your code that delegates the installation to ArgoCD, allowing ArgoCD to handle the deployment and management of the add-on.</p>\n<p>This flexibility gives you the choice to either install Helm charts directly through Terraform or delegate the installation to ArgoCD, depending on your preference and the requirements of your deployment.</p>\n<p><span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 22.352941176470587%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAc0lEQVR42pXPWw7CMAxE0WwkfoSapKBSgdj/vpBcDXbZAPm4mh/rSC57l4+tehCJs6gTs1OtzrkZ0VSlBqJ2gy4D7dwOEkFbDKIXBI44/LtCLL7ub4xse2I8Xuj3DXa1wGgKO8F47dDWIJnqL2FwNIsl+AXbmG1n8eVycwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"GitOps Workflow\" title=\"\" src=\"/static/c6f940fc9db43734a6bd26ebc6fe4b41/c5bb3/charts.png\" srcset=\"/static/c6f940fc9db43734a6bd26ebc6fe4b41/04472/charts.png 170w,\n/static/c6f940fc9db43734a6bd26ebc6fe4b41/9f933/charts.png 340w,\n/static/c6f940fc9db43734a6bd26ebc6fe4b41/c5bb3/charts.png 680w,\n/static/c6f940fc9db43734a6bd26ebc6fe4b41/5a190/charts.png 800w\" sizes=\"(max-width: 680px) 100vw, 680px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n    </span>\n          </p>\n<h2 id=\"-auditing-and-compliance-with-eks-blueprints-and-argocd\" style=\"position:relative;\"><a href=\"#-auditing-and-compliance-with-eks-blueprints-and-argocd\" aria-label=\" auditing and compliance with eks blueprints and argocd permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üìü Auditing and Compliance with EKS Blueprints and ArgoCD</h2>\n<p>EKS Blueprints offer organizations a valuable solution for meeting auditing and compliance requirements. These blueprints provide pre-defined configurations that align with common security and compliance standards, ensuring a solid foundation for Kubernetes clusters.</p>\n<p>To effectively manage and maintain these configurations over time, <a href=\"https://argo-cd.readthedocs.io/en/stable/\" target=\"_blank\" rel=\"noopener noreferrer\">ArgoCD</a> can be employed. ArgoCD acts as a powerful tool for managing and auditing changes made to Kubernetes resources, offering an essential audit trail that tracks and documents any modifications.</p>\n<p>By leveraging EKS Blueprints in combination with ArgoCD, organizations can enhance their auditing and compliance capabilities, promoting greater transparency and control over their Kubernetes environments.</p>\n<p>EKS Blueprints provide support for onboarding and managing teams and easily configuring cluster access. We currently support two team types:</p>\n<ul>\n<li><strong>Application Teams</strong>: Represent teams managing workloads running in cluster namespaces.</li>\n<li><strong>Platform Teams</strong>: Represent platform administrators who have admin access (masters group) to clusters.</li>\n</ul>\n<p><span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 206.47058823529414%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAApCAYAAAA1bQl+AAAACXBIWXMAAAsTAAALEwEAmpwYAAACt0lEQVR42q2W23LbMAxE/R8VxTtFyXLSNP//V51pMmMNugtJdh/a2Kb7gIi+ZE1ggUMe3kb7mad+MV1/7vstzB/rB+PQ2/7so5OQEcmJjxZPL/iwKQ7W2XPOWWKMklJCRMF77YLe+2U8VhnGItNplFKKWPuEYNd1S62DzMdJck76pjFGo2c8Koh/XLx3cqpFxpKRrhOHlFPw4rF+WBB/FtMbmUqSH9MgA2pYEG/b2piGHVosao66SwqnEOQVNS2tglzMQ5YRogZrCn1/aodwNWrNrAoG1HRIQZ9NpkTvNWWPVPlmB3e7BocvpnBxHJLW7YgacrcVjp9qbhA0qyDrN0OMpgTdccKP5PYdVhhAY04UQU3Zk02Cu8tMNW817HsrQ15TNw/W8iLIlCnq7Oo0U06tgtYCXRiziDaxOsu9cBxdAyQOpjMLsTUBDrVWyahdBg/pei1R55p9uj7v3GGIQepUJOWgcI0FTR534F7jbkEwUcZhWI3AmuawpgU/lPQ1Iq6hNTZ3mFIxajrPMOYFkHifq7yg0bWV8JpNzjUnimP5LwgfgC7d4b2UZtpffVcb21nXjPy/Cvpgxaf15Lun8DdNmcZRXk8zXE6ajtnOlfYzBU0916zTsZ8p8akzxaxnyjuOU0KC7UOXZ7hrWnZIXJHOzl3HzT5TQ6KfqCoYQabJXXGWCYfGY7RHylEbms3LSZnwnNuIvU0K8QWRKRNhTgHLH2gGLGe3bsE60nGOoWkXTAoDvdtsgGXqDwN2P1MGiM1K7BWwbB0630TsgJ0QsnwSFPtlKSo0Gq5zFJvnWYnNi+d6c1h5+Ohd8QJYCu13Q94avnV4dkbTV2M2qN6661xMIZUJTtZyhyzHkTvdDePnexd8JXjeAbvGFaJ2G8E97VtwVUHM7+Lc/wXsTxjzgfh8Mj6Q7a/fFnZfxMiC9xAAAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"GitOps Workflow\" title=\"\" src=\"/static/0cc4089a123e875ccd5be58b263763cd/c5bb3/compliance.png\" srcset=\"/static/0cc4089a123e875ccd5be58b263763cd/04472/compliance.png 170w,\n/static/0cc4089a123e875ccd5be58b263763cd/9f933/compliance.png 340w,\n/static/0cc4089a123e875ccd5be58b263763cd/c5bb3/compliance.png 680w,\n/static/0cc4089a123e875ccd5be58b263763cd/5a190/compliance.png 800w\" sizes=\"(max-width: 680px) 100vw, 680px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n    </span>\n          </p>\n<h2 id=\"heading-towards-the-future-\" style=\"position:relative;\"><a href=\"#heading-towards-the-future-\" aria-label=\"heading towards the future  permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Heading Towards the Future: ü§ñ</h2>\n<p>Over the past years, <strong>EKS Blueprints</strong> has been diligently developed as an open-source project by a passionate team of AWS solution architects and specialists. Collaborating closely with the open-source community, customers, and partners, we have actively sought feedback to shape the project's direction.</p>\n<h3 id=\"-taking-the-next-steps\" style=\"position:relative;\"><a href=\"#-taking-the-next-steps\" aria-label=\" taking the next steps permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üìÖ Taking the Next Steps</h3>\n<p>To kickstart your journey with EKS Blueprints, please visit either the <a href=\"https://aws-ia.github.io/terraform-aws-eks-blueprints/\" target=\"_blank\" rel=\"noopener noreferrer\">EKS Blueprints for Terraform</a> or <a href=\"https://aws-quickstart.github.io/cdk-eks-blueprints/getting-started/\" target=\"_blank\" rel=\"noopener noreferrer\">EKS Blueprints for CDK</a> repositories. You'll find comprehensive project documentation and detailed instructions to help you get started seamlessly.</p>\n<h3 id=\"-the-deets\" style=\"position:relative;\"><a href=\"#-the-deets\" aria-label=\" the deets permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üîù The Deets</h3>\n<p><strong>EKS Blueprints</strong>, an open-source project developed by AWS solution architects and specialists, empowers organizations to meet auditing and compliance requirements effortlessly. It provides pre-defined configurations aligned with common security and compliance standards. <a href=\"https://argo-cd.readthedocs.io/en/stable/\" target=\"_blank\" rel=\"noopener noreferrer\">ArgoCD</a> can be utilized to manage and audit these configurations over time, offering an audit trail of Kubernetes resource changes.</p>\n<h2 id=\"-conclusion-\" style=\"position:relative;\"><a href=\"#-conclusion-\" aria-label=\" conclusion  permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üåü Conclusion üåü</h2>\n<p>In summary, <strong>EKS Blueprints</strong> streamlines Kubernetes cluster deployment by leveraging pre-defined configurations, aiding compliance efforts. With ArgoCD integration, managing and auditing configurations becomes seamless. üíÆ\n<br></p>\n<p><strong><em>Until next time, „Å§„Å•„Åè üéâ</em></strong></p>\n<blockquote>\n<p>üí° Thank you for Reading !! üôåüèªüòÅüìÉ, see you in the next blog.ü§ò  <em><strong>Until next time üéâ</strong></em></p>\n</blockquote>\n<p>üöÄ Thank you for sticking up till the end. If you have any questions/feedback regarding this blog feel free to connect with me:</p>\n<p><strong>‚ôªÔ∏è LinkedIn:</strong> <a href=\"https://www.linkedin.com/in/rajhi-saif/\" target=\"_blank\" rel=\"noopener noreferrer\">https://www.linkedin.com/in/rajhi-saif/</a></p>\n<p><strong>‚ôªÔ∏è X/Twitter:</strong> <a href=\"https://x.com/rajhisaifeddine\" target=\"_blank\" rel=\"noopener noreferrer\">https://x.com/rajhisaifeddine</a></p>\n<p><strong>The end ‚úåüèª</strong></p>\n<h1 align=\"center\">üî∞ Keep Learning !! Keep Sharing !! üî∞</h1>\n<p><strong>üìÖ Stay updated</strong></p>\n<p>Subscribe to our newsletter for more insights on AWS cloud computing and containers.</p>"}}},"staticQueryHashes":["1271460761","1321585977"],"slicesMap":{}}