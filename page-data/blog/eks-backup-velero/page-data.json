{"componentChunkName":"component---src-templates-blog-template-js","path":"/blog/eks-backup-velero/","result":{"data":{"markdownRemark":{"html":"<blockquote>\n<p><strong>Easily Backup EKS with Velero üõ≥</strong></p>\n</blockquote>\n<h2 id=\"Ô∏è-introduction\" style=\"position:relative;\"><a href=\"#%EF%B8%8F-introduction\" aria-label=\"Ô∏è introduction permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>‚ò∏Ô∏è Introduction</h2>\n<p>Welcome to a journey to explore <strong>Velero</strong> and how it makes Kubernetes backups easy. In the world of Kubernetes, keeping your cluster safe is very important. Velero helps with its strong features and simple interface.</p>\n<p>We‚Äôll look at how Velero changes Kubernetes backups. See how it makes managing backups, snapshots, and custom resources easy.</p>\n<h3 id=\"-goals--objectives\" style=\"position:relative;\"><a href=\"#-goals--objectives\" aria-label=\" goals  objectives permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üéØ Goals &#x26; Objectives</h3>\n<p>Join us as we explore Velero‚Äôs magic, offering practical tips and best practices to easily protect your AWS Kubernetes cluster. Let‚Äôs dive into the world of simple Kubernetes backups with Velero!</p>\n<h3 id=\"-prerequisites\" style=\"position:relative;\"><a href=\"#-prerequisites\" aria-label=\" prerequisites permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üöÄ Prerequisites</h3>\n<p>Before we start, I assume you have the following:</p>\n<ul>\n<li><a href=\"https://aws.amazon.com/\" target=\"_blank\" rel=\"noopener noreferrer\">AWS</a> and <a href=\"https://github.com/\" target=\"_blank\" rel=\"noopener noreferrer\">GitHub</a> accounts.</li>\n<li><a href=\"https://www.terraform.io/\" target=\"_blank\" rel=\"noopener noreferrer\">Terraform</a> installed and configured.</li>\n<li>The <a href=\"https://aws.amazon.com/cli/\" target=\"_blank\" rel=\"noopener noreferrer\">AWS CLI</a> installed and configured.</li>\n<li><a href=\"https://velero.io/\" target=\"_blank\" rel=\"noopener noreferrer\">Velero</a> installed.</li>\n<li><a href=\"https://terragrunt.gruntwork.io/\" target=\"_blank\" rel=\"noopener noreferrer\">Terragrunt</a></li>\n</ul>\n<h2 id=\"-the-workflow-landscape\" style=\"position:relative;\"><a href=\"#-the-workflow-landscape\" aria-label=\" the workflow landscape permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>‚ùÑ The Workflow Landscape</h2>\n<p><span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 72.94117647058825%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAAAsTAAALEwEAmpwYAAACvklEQVR42m1TS2/TQBB2S088JAQ/BK78gV6olIKKigAhLqGVKEIV4hwhfgJcKpC490ARx0IVTkjcQkCtkkDzcJz4/Yiz3l3vxsOs8yBBHWViz+w338x+3tU0NDvmmwHhXy0//uAnabkfJne1iTVMv2AGg6gfDW9Oc70B2QiT9KjvRwd+wstOzO+rPAAs5wCHpNsRE3rHdn+ENO0YIdmZ1C7XutajARPQ9ON7U8KuN1D4lm67VYV3Sfp0Roh/S9o4Wlor7Z3X/jO1XgG4MMPN2VrpE+LHebW+iCmVls8i1M4g+ke4NyOcmTkg6wGDdZewW42+vekzUXAIK2C8YUbJjWn3HIuxhfr5DAq+EIVK23poYp3CB0zcPjasVY0ICe2+BV3bBTrKQGS5SyQBJkdH880TjFW+1bOkbo3xqXKsUXZi2KChuFlD72XNnpWp9xgRJB0JBYiYXCAMmfyiOp12++LUMLMBlyP0LEbHfFbtWJnGkXyYCsDu2BHwCcAnE0Z8kXDAxxMmQkpVwyZ4NhpP+LODE/qEgeEE0PciCJJUkUCjrUuCwPA/QtWAY6HhBrLnhYBHBnBqqLd0CIcJVHUkdGMKuu0pEPiEI6mAynFNekOKhIsaKgkYEqJ+0nD8fAC8CFA5qYGJ9VXdAY1KEAjKHccXROTvqg5Qn8PFLcvD/GPhT+EVNlE+AqW5QA2F5ng+1JttaHUNOG3ruTeabcnx64+yrKzOJ4JX7uzvn2NpWlaEpu3I4/pv+NPuoHfBDcJcw3oPJ3QIfexRXsTzuN0wvecepUV7SItWTHasIV2dP4cqRvwTtY6SFGuINwndUjHquV3VzQdn3pTpJQ84vx6n2S6Ct+JU7vqcX5tfP/OmqO1M/c1++eKz9weXX3/+fjWfiNBXaisdJ6DqaVH6UuXffvt1ReFevPt4ab4e9Vj5C7egB8wR+DxlAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"workflow\" title=\"\" src=\"/static/67c895ab0aa79187931427924267ce45/c5bb3/workflow.png\" srcset=\"/static/67c895ab0aa79187931427924267ce45/04472/workflow.png 170w,\n/static/67c895ab0aa79187931427924267ce45/9f933/workflow.png 340w,\n/static/67c895ab0aa79187931427924267ce45/c5bb3/workflow.png 680w,\n/static/67c895ab0aa79187931427924267ce45/5a190/workflow.png 800w\" sizes=\"(max-width: 680px) 100vw, 680px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n    </span>\n          </p>\n<p>Velero is ideal for disaster recovery use cases, as well as for snapshotting your application state prior to performing system operations on your cluster (e.g., upgrades).</p>\n<h3 id=\"Ô∏è-velero-backup-workflow\" style=\"position:relative;\"><a href=\"#%EF%B8%8F-velero-backup-workflow\" aria-label=\"Ô∏è velero backup workflow permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>‚≠êÔ∏è Velero Backup Workflow</h3>\n<p>When you run <code class=\"language-text\">velero backup create test-backup</code>:</p>\n<ol>\n<li>The Velero client makes a call to the Kubernetes API server to create a Backup object.</li>\n<li>The <code class=\"language-text\">BackupController</code> notices the new Backup object and performs validation.</li>\n<li>The <code class=\"language-text\">BackupController</code> begins the backup process by collecting the data to back up by querying the API server for resources.</li>\n<li>The <code class=\"language-text\">BackupController</code> makes a call to the object storage service (e.g., <a href=\"https://aws.amazon.com/s3/\" target=\"_blank\" rel=\"noopener noreferrer\">AWS S3</a>) to upload the backup file.</li>\n</ol>\n<p>By default, <code class=\"language-text\">velero backup create</code> makes disk snapshots of any persistent volumes. You can adjust the snapshots by specifying additional flags. Run <code class=\"language-text\">velero backup create --help</code> to see available flags. Snapshots can be disabled with the option <code class=\"language-text\">--snapshot-volumes=false</code>.</p>\n<p><span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 56.470588235294116%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAACs0lEQVR42mNgmHnzE8MMKmKggVcZZt28yjjz1jXGmTeugWgQHyYOxjNuAMVuAMVuoMrNvAHFSGoZZt3awjATiOfdWAcU2Aim59zYBBYHy93cBBafeWMzmIaJz7qxiQlIM824tY1x5s3NEHmgOJAxCeiySbx1d3fqlT95IV/+6Cpb3+35QA0TgXITGWfcmMU869Z9IH4B1LgYaOgEhjnXeqQmPVxn3f7pExB/Nul494Rtxs2pQD0TGBgWXUkTq727IKrz0/95O7/9bV72879p2bNHQG8WMMy4niay+P5C5TXP/6tufPtffNnDbQzTrqWwzLhZat3x+ZFd66e3pi0vzji3fvmn1/NmG8OsSxkMDMuuuSoWPt/Ws+H3/9N3fvzcde7rP+/GNz/Zm+9nMiy86cI77168+soH1zVXPXgisfh+EcOcm3ZqE17VO3f8+GPU9GSDSsuNVsuGp9cc2r++ZJ51JxBo4FVtpcJHvWlTf/xfdujnnwmb//63q3x9T7DxsrvClL12ui2rPYWnHHVW79oSqtO61lWxb7uLQP9JO4fOX5fsWz4+Na95cNC29vl346YnMxnmntMChuFdOYaZ1yT18p4scah4/sK69NkdqfwnfsLLNkgFl3UHRZR2RgZUTfKMqOwIiSpvTwivmBCq3j5dwbjjXZRj69eXdg2vn9tUPzojOemGBsOch1IMDB1n+IGG8ovvvMAt135JUGXiCT7RVVd4GIBsJaAcX/0OIa2uLRJK3UfF+PvPC8i1HxbkB8oJzznCC6J5Ws+JCgH1CHbc5WeoPy8AdOFMVob6K2wWhcc4c2/dYo+fv59Dvv4+B0MaUByE6/ezoGCouHz9fg6VidvY4excCJsBDur/M9kDNYAwA8N/RrDY//+M9QwMTP+RaBCGydnX/2cB4dDQ/8wwcwCjqbSaDdTsmQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"logo\" title=\"\" src=\"/static/48361060518a22260fda230c6572a3d5/c5bb3/logo.png\" srcset=\"/static/48361060518a22260fda230c6572a3d5/04472/logo.png 170w,\n/static/48361060518a22260fda230c6572a3d5/9f933/logo.png 340w,\n/static/48361060518a22260fda230c6572a3d5/c5bb3/logo.png 680w,\n/static/48361060518a22260fda230c6572a3d5/5a190/logo.png 800w\" sizes=\"(max-width: 680px) 100vw, 680px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n    </span>\n          </p>\n<h2 id=\"streamline-infrastructure-automation-with-terraform-and-terragrunt\" style=\"position:relative;\"><a href=\"#streamline-infrastructure-automation-with-terraform-and-terragrunt\" aria-label=\"streamline infrastructure automation with terraform and terragrunt permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Streamline Infrastructure Automation with Terraform and Terragrunt</h2>\n<p>Automating infrastructure provisioning with <a href=\"https://www.terraform.io/\" target=\"_blank\" rel=\"noopener noreferrer\">Terraform</a> is a seamless process. By leveraging the comprehensive <a href=\"https://registry.terraform.io/providers/hashicorp/aws/latest\" target=\"_blank\" rel=\"noopener noreferrer\">AWS provider</a> available in the Terraform registry, setting up EKS, OIDC, and Velero resources becomes effortless.</p>\n<p>However, before diving into infrastructure automation, it's crucial to ensure that the Terraform provider is properly configured to interact with the target AWS account. Once configured, Terraform empowers you to effortlessly orchestrate the deployment of complex infrastructure setups, enabling you to focus on higher-level tasks and freeing up valuable time and resources.</p>\n<h2 id=\"-provision-of-the-eks-oidc-and-velero-resources-on-aws\" style=\"position:relative;\"><a href=\"#-provision-of-the-eks-oidc-and-velero-resources-on-aws\" aria-label=\" provision of the eks oidc and velero resources on aws permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üåê Provision of the EKS, OIDC, and Velero Resources on AWS</h2>\n<p>The Terraform configuration is organized as shown below:</p>\n<p><span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 139.41176470588235%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAcCAYAAABh2p9gAAAACXBIWXMAAAsTAAALEwEAmpwYAAABXklEQVR42q2Va26DQAyE98Xu2rSQtLlB73/BKmjrwUuJVKkKMT8skJA+jT1j475uw/d09Qt5t3CSirZyY3J3eWkcekVbOSrhTtPQ6JIbjckMdZSlXQqNZoHOuXEJJqhjAQJCk6j7KI05nqCwAjg0fpdK3g5kATKAqMGf0HKNjUQdXYuqHLwVqC3XWxWn4x6hcDxOCswCpLi6vCp9S1pwHpGC6vzcKHaF3NuetFbnESd8k5E8a5aaIgpZQl2vWY3ZsvhKy7+xQYuTAMmYQ3FUg405bZtiApawYDvW2aFlgE3AKkC0KzD6LNqyJdj00DJJDvlARP6PDVReuimG9eux8apsUwdjsjcAoephM5DJV+/ifm0A3Bw+79pk+4HdgbJ6uNjYlhqsB7bPEFnEDA0qVSH12GxAw29AFSLYY9K/HqcTjgMyJwr/XJrU6whwrHHZ2oUheI5zv4t4HlnD5NsPf1VQcyv7Y+AAAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"code\" title=\"\" src=\"/static/1bcd7b014302897252113fefa3143695/c5bb3/code.png\" srcset=\"/static/1bcd7b014302897252113fefa3143695/04472/code.png 170w,\n/static/1bcd7b014302897252113fefa3143695/9f933/code.png 340w,\n/static/1bcd7b014302897252113fefa3143695/c5bb3/code.png 680w,\n/static/1bcd7b014302897252113fefa3143695/5a190/code.png 800w\" sizes=\"(max-width: 680px) 100vw, 680px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n    </span>\n          </p>\n<h3 id=\"initialize-the-infrastructure-on-an-aws-account\" style=\"position:relative;\"><a href=\"#initialize-the-infrastructure-on-an-aws-account\" aria-label=\"initialize the infrastructure on an aws account permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Initialize the Infrastructure on an AWS Account</h3>\n<p>First, update the content of the local Terragrunt variable called <code class=\"language-text\">aws_profile</code> in the file named <a href=\"https://github.com/seifrajhi/aws-eks-irsa/blob/main/terraform/terragrunt-global-config.hcl\" target=\"_blank\" rel=\"noopener noreferrer\">terragrunt-global-config.hcl</a> to point to your AWS profile instead of mine üòâ.</p>\n<p>Once this is done, you can apply the infrastructure with Terragrunt as follows:</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token builtin class-name\">cd</span> terraform\nterragrunt run-all init\nterragrunt run-all apply</code></pre></div>\n<ul>\n<li>The first Terragrunt command will run <code class=\"language-text\">terraform init</code> in every Terraform layer in the <code class=\"language-text\">terraform</code> folder.</li>\n<li>The second Terragrunt command will run <code class=\"language-text\">terraform apply</code> in each layer.</li>\n</ul>\n<p>On the first apply, Terragrunt will ask if you want to create the Terraform states S3 bucket if it does not exist on your AWS account. It will also create a DynamoDB table for state locking.</p>\n<h3 id=\"how-is-the-aws-iam-oidc-provider-created\" style=\"position:relative;\"><a href=\"#how-is-the-aws-iam-oidc-provider-created\" aria-label=\"how is the aws iam oidc provider created permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>How is the AWS IAM OIDC Provider Created?</h3>\n<p>By default, the IAM OIDC provider is created by the <a href=\"https://github.com/aws-ia/terraform-aws-eks-blueprints/\" target=\"_blank\" rel=\"noopener noreferrer\">AWS EKS Blueprints for Terraform</a> with the input <code class=\"language-text\">enable_irsa</code> set to true.</p>\n<p>To demonstrate how it works, I set that input to false and created the OIDC provider with the AWS provider resources myself (you can find those resources in the file named <code class=\"language-text\">irsa.tf</code>).</p>\n<h3 id=\"how-are-the-velero-resources-created\" style=\"position:relative;\"><a href=\"#how-are-the-velero-resources-created\" aria-label=\"how are the velero resources created permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>How are the Velero Resources Created?</h3>\n<p>The Velero resources are defined in the <code class=\"language-text\">velero.tf</code> file, where configurations for backups, restores, and other Velero functionalities are specified. This Terraform script ensures the creation and configuration of Velero-related resources, enabling efficient data backups and restores for your infrastructure within the defined AWS environment.</p>\n<h3 id=\"how-to-manage-velero-technical-aspect\" style=\"position:relative;\"><a href=\"#how-to-manage-velero-technical-aspect\" aria-label=\"how to manage velero technical aspect permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>How to Manage Velero: Technical Aspect</h3>\n<p>After installing the Velero server on the EKS cluster, you can view Velero's server-side components by running:</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">kubectl get all <span class=\"token parameter variable\">-n</span> velero</code></pre></div>\n<p>Where <code class=\"language-text\">velero</code> is the namespace where all Velero components are running.</p>\n<p>Velero also uses a number of CRDs (Custom Resource Definitions) to represent its own resources like backups, backup schedules, etc.</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">kubectl get crd <span class=\"token operator\">|</span> <span class=\"token function\">grep</span> velero</code></pre></div>\n<h3 id=\"deploy-test-application\" style=\"position:relative;\"><a href=\"#deploy-test-application\" aria-label=\"deploy test application permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Deploy Test Application</h3>\n<p>This step involves deploying a sample application to validate the infrastructure setup and ensure successful integration of the components.</p>\n<p>Create a namespace and deploy the application:</p>\n<p><span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 32.35294117647059%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA00lEQVR42nVR0ZKEIAzza462IKsirNz5/1+lk2sX2fNh7yHTNJ1pUhjqIse4MoQ9vBew9y94kQbjnxDCR334Sulw5QlKCZwz9vTAPo0YlTvVAhECsy6/mRhe2q32hVTy4bYNtK6wyrWCf74bX5sJ7TtiighVTbYKspnhqUEUj1wwq7lo6sGVcrI2tl3GsSG2ame1PirXBPHiNrvmnYfrCQaX82kuvCygUuCU98Sk6fw0gSy1amJcNZ7ndmp/u/vJGvM0B+lp3on+3K2Xe6J/PsQW/gK7n7eJqDjB/gAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"app-test\" title=\"\" src=\"/static/ae8af3428090588d73ccc3a1fb208b9a/c5bb3/app-test.png\" srcset=\"/static/ae8af3428090588d73ccc3a1fb208b9a/04472/app-test.png 170w,\n/static/ae8af3428090588d73ccc3a1fb208b9a/9f933/app-test.png 340w,\n/static/ae8af3428090588d73ccc3a1fb208b9a/c5bb3/app-test.png 680w,\n/static/ae8af3428090588d73ccc3a1fb208b9a/5a190/app-test.png 800w\" sizes=\"(max-width: 680px) 100vw, 680px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n    </span>\n          </p>\n<p>Then verify the deployed application:</p>\n<p><span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 17.058823529411764%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAYAAACTWi8uAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAXElEQVR42pWMQQ6AIBADeQ4uLCECwvL/VxmwAol3OUzaQzuqBro56IcO6saYTkSLr8/cQcVTt5I0UorIuaBWGXnBew8RgbUWY/gbxUxtMI4M5yYOzLxEs+/IpvAF7N5a/KQQW5EAAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"get\" title=\"\" src=\"/static/9e58f0b788a32741f2d3a634b878ee18/c5bb3/get.png\" srcset=\"/static/9e58f0b788a32741f2d3a634b878ee18/04472/get.png 170w,\n/static/9e58f0b788a32741f2d3a634b878ee18/9f933/get.png 340w,\n/static/9e58f0b788a32741f2d3a634b878ee18/c5bb3/get.png 680w,\n/static/9e58f0b788a32741f2d3a634b878ee18/5a190/get.png 800w\" sizes=\"(max-width: 680px) 100vw, 680px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n    </span>\n          </p>\n<h3 id=\"-backups\" style=\"position:relative;\"><a href=\"#-backups\" aria-label=\" backups permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üíæ Backups</h3>\n<p>Now, let's look into backups in case something happens to the blog. Backups are for Kubernetes resources and persistent volumes. You can back up your entire cluster, or optionally choose a namespace or label selector to back up. They can be run one-off or scheduled. It's a good idea to have scheduled backups so you are certain you have a recent backup to easily fall back to. You can also create backup hooks if you want to execute actions before or after a backup is made. By default, the backup retention is 30 days, but you can change it with the <code class=\"language-text\">-ttl</code> flag.</p>\n<p>To see what all you can do with backups, run:</p>\n<p><span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 17.058823529411764%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAYAAACTWi8uAAAACXBIWXMAAAsTAAALEwEAmpwYAAAARklEQVR42mOwNtT8pWus8U9LU/uvtpbWX21tbYowg7qh0R8NE9P/6ubm/7VMTP5r6+r+B0qQjRm0dHT+gAzRAhlEoWEgAwGLKlo1qyYi6AAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"bckp\" title=\"\" src=\"/static/4a6c2a9b89deb93396ccab30d2dffdb8/c5bb3/bckp.png\" srcset=\"/static/4a6c2a9b89deb93396ccab30d2dffdb8/04472/bckp.png 170w,\n/static/4a6c2a9b89deb93396ccab30d2dffdb8/9f933/bckp.png 340w,\n/static/4a6c2a9b89deb93396ccab30d2dffdb8/c5bb3/bckp.png 680w,\n/static/4a6c2a9b89deb93396ccab30d2dffdb8/5a190/bckp.png 800w\" sizes=\"(max-width: 680px) 100vw, 680px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n    </span>\n          </p>\n<p>Let's start with the most basic option: creating a one-off backup. It's a good idea to give it a meaningful name so you remember what it was for, unlike what is done here.</p>\n<p><span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 17.058823529411764%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAYAAACTWi8uAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAbElEQVR42p3PzQ6EIAwE4LKA0CLFn7Pv/45GHRvZZC+e9vAdmklmUto07KruYqJTPsb/rwR3UqrxKCujLBkyJbBGiHew8CGBjPuiH/+OuIZDpgG8WFkbkFtEHRNmyagc+0BLPdd+M3vYN6+FN/aUQCmSYrGeAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"example\" title=\"\" src=\"/static/cf761c976566410cf11eee26251870af/c5bb3/example.png\" srcset=\"/static/cf761c976566410cf11eee26251870af/04472/example.png 170w,\n/static/cf761c976566410cf11eee26251870af/9f933/example.png 340w,\n/static/cf761c976566410cf11eee26251870af/c5bb3/example.png 680w,\n/static/cf761c976566410cf11eee26251870af/5a190/example.png 800w\" sizes=\"(max-width: 680px) 100vw, 680px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n    </span>\n          </p>\n<p>If we want to do a backup with all namespaces included, we can remove the flag <code class=\"language-text\">--include-namespaces</code>. And to include all namespaces except specific ones, we could use <code class=\"language-text\">--exclude-namespaces</code> with the namespace(s) we don't want.</p>\n<p>Let's create a backup from a schedule.</p>\n<p><span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 32.35294117647059%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAAAsTAAALEwEAmpwYAAABEUlEQVR42nVRXU+DQBC8A7UmRkRaTX2TUij9UkAbnwyltLalfDX9//8EMu4diWLUh8mws5fZ2YX1ZmF1MV+CmSuwQQRmrX6B/6G1e3wYNxDa9Syp+osTbr0MhpdDsRpj3jYyo2bYQPTib0OhmRTmcdmwNJzvK91L0Q1y3L+W0OYH6M8Z7l5Kqo+4HG9h+Dl6QQHVD8G8d7BJ+KV3Se8vjvJbpGSGl9VX071Mo9prKHbcMDUVYvFIdTYS3KYENiUZRrIv3p05a5yPNpJlQtVNau6mYBIHsFFCIJ4U4FRzZ0cmG8IHDaUh1vrnym0IjdLV2hPdLyhxQ6tqBMG6X6Az3lGdynXEjcVZHt5O6Ljbf3/gJzt7rZDt0DXoAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"schedule\" title=\"\" src=\"/static/fa7c116f89fb97f998abc491e2cfbdf6/c5bb3/schedule.png\" srcset=\"/static/fa7c116f89fb97f998abc491e2cfbdf6/04472/schedule.png 170w,\n/static/fa7c116f89fb97f998abc491e2cfbdf6/9f933/schedule.png 340w,\n/static/fa7c116f89fb97f998abc491e2cfbdf6/c5bb3/schedule.png 680w,\n/static/fa7c116f89fb97f998abc491e2cfbdf6/5a190/schedule.png 800w\" sizes=\"(max-width: 680px) 100vw, 680px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n    </span>\n          </p>\n<p>See all of the backups created:</p>\n<p><span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 20.58823529411765%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAyElEQVR42k1PyQ6CUBADwSii4BZJPLmABkXE7eLFuCOC0YP//yOYOvMICYem89pZ+qS+f0j11RGqc4M8PkEaHSEx53URuV70C31ivhUkqeHH0Ny7ELRZxiX7jMYiQt2LoM8fhBCKc8mGh9ki9io0x9wgqBPyB/tvam3fUOihTq/oUV33HpBtXh6i6t5QJt3afdAOEpj+E93NGwZxfqyzfokemUJIph/9OqsXmkEs0vElzQ1FAsU5i6RcF9Oayxg1SsxLGHw4//IfvzZ0uue9IYwAAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"result\" title=\"\" src=\"/static/e81f131c9d6961e08d7194c3f35afed0/c5bb3/result.png\" srcset=\"/static/e81f131c9d6961e08d7194c3f35afed0/04472/result.png 170w,\n/static/e81f131c9d6961e08d7194c3f35afed0/9f933/result.png 340w,\n/static/e81f131c9d6961e08d7194c3f35afed0/c5bb3/result.png 680w,\n/static/e81f131c9d6961e08d7194c3f35afed0/5a190/result.png 800w\" sizes=\"(max-width: 680px) 100vw, 680px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n    </span>\n          </p>\n<h2 id=\"-wreak-havoc\" style=\"position:relative;\"><a href=\"#-wreak-havoc\" aria-label=\" wreak havoc permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üí• Wreak Havoc</h2>\n<p>Now that we have a happy cluster state and that most excellent blog you created‚Ä¶ let's nuke the demo.</p>\n<p>Let's say that someone (you) accidentally (definitely intentionally) deleted the demo namespace by running the following:</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">kubectl delete namespace demo</code></pre></div>\n<p>Try to connect to the demo again. Shoot‚Ä¶ Now the site is down and so is that super important blog post you just made. What now?</p>\n<h3 id=\"-restore\" style=\"position:relative;\"><a href=\"#-restore\" aria-label=\" restore permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üîÑ Restore</h3>\n<p>Well, it's a good thing you have backups! Now it's time to look into restoring from a backup. To see what all you can do with restore, run:</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">velero restore <span class=\"token parameter variable\">-h</span></code></pre></div>\n<p>Let's now wait for all of the resources to be gone. First, check the output of <code class=\"language-text\">get all</code>:</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">kubectl get all <span class=\"token parameter variable\">-n</span> demo</code></pre></div>\n<p>Note: It might take some time until everything is properly deleted; so you may run these commands above until they give you a (somewhat ominous) \"No resources found\" output.</p>\n<p>Now to perform a restore:</p>\n<p>To take a look at what backups you have, you can run the following again:</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">velero backup get</code></pre></div>\n<p>To restore from the specific backup we created first:</p>\n<p>So the big questions are:\nDid all the resources come back up?</p>\n<p>Let's find out. First, let's check to see if our resources are back and running:</p>\n<p><span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 10.588235294117647%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAACCAYAAABYBvyLAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAaElEQVR42lXKwQoDIQyEYY0uaKJGwrrXQt//CUu3U4XSbQ/fYX7G3W17dPMvJn9K9Ccv4d/q8tNlKpE+zX2t7azwc2jBoRV7Exy9gmNCDgoOHckbNDcMFWRiJFLUreE2dhjPH7n5u7wBd6wrpLczbRcAAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"restore\" title=\"\" src=\"/static/a6c9b4eef35a409cb385d9618e5d3f77/c5bb3/restore.png\" srcset=\"/static/a6c9b4eef35a409cb385d9618e5d3f77/04472/restore.png 170w,\n/static/a6c9b4eef35a409cb385d9618e5d3f77/9f933/restore.png 340w,\n/static/a6c9b4eef35a409cb385d9618e5d3f77/c5bb3/restore.png 680w,\n/static/a6c9b4eef35a409cb385d9618e5d3f77/5a190/restore.png 800w\" sizes=\"(max-width: 680px) 100vw, 680px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n    </span>\n          </p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">kubectl get all <span class=\"token parameter variable\">-n</span> demo</code></pre></div>\n<p>It worked üéâ</p>\n<h2 id=\"-conclusion-\" style=\"position:relative;\"><a href=\"#-conclusion-\" aria-label=\" conclusion  permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üåü Conclusion üåü</h2>\n<p>This hands-on blog explored the simplified process of backing up a Kubernetes cluster using Velero. We delved into the magic of Velero, understanding its key components and how it seamlessly integrates with EKS. By following the step-by-step guide, readers can now confidently implement effective backup strategies for their EKS infrastructure, ensuring data resilience and peace of mind.</p>\n<p>Velero truly simplifies EKS backups, empowering organizations to safeguard their valuable data effortlessly.</p>\n<p>I hope you guys have enjoyed this hands-on tutorial and learned a bit more than what you knew before. Let me know if you have any questions related to this blog.</p>\n<br>\n<p><strong><em>Until next time, „Å§„Å•„Åè üéâ</em></strong></p>\n<blockquote>\n<p>üí° Thank you for Reading !! üôåüèªüòÅüìÉ, see you in the next blog.ü§ò  <em><strong>Until next time üéâ</strong></em></p>\n</blockquote>\n<p>üöÄ Thank you for sticking up till the end. If you have any questions/feedback regarding this blog feel free to connect with me:</p>\n<p><strong>‚ôªÔ∏è LinkedIn:</strong> <a href=\"https://www.linkedin.com/in/rajhi-saif/\" target=\"_blank\" rel=\"noopener noreferrer\">https://www.linkedin.com/in/rajhi-saif/</a></p>\n<p><strong>‚ôªÔ∏è X/Twitter:</strong> <a href=\"https://x.com/rajhisaifeddine\" target=\"_blank\" rel=\"noopener noreferrer\">https://x.com/rajhisaifeddine</a></p>\n<p><strong>The end ‚úåüèª</strong></p>\n<h1 align=\"center\">üî∞ Keep Learning !! Keep Sharing !! üî∞</h1>\n<p><strong>üìÖ Stay updated</strong></p>\n<p>Subscribe to our newsletter for more insights on AWS cloud computing and containers.</p>","timeToRead":5,"rawMarkdownBody":"\n> **Easily Backup EKS with Velero üõ≥**\n\n## ‚ò∏Ô∏è Introduction\n\nWelcome to a journey to explore **Velero** and how it makes Kubernetes backups easy. In the world of Kubernetes, keeping your cluster safe is very important. Velero helps with its strong features and simple interface.\n\nWe‚Äôll look at how Velero changes Kubernetes backups. See how it makes managing backups, snapshots, and custom resources easy.\n\n### üéØ Goals & Objectives\n\nJoin us as we explore Velero‚Äôs magic, offering practical tips and best practices to easily protect your AWS Kubernetes cluster. Let‚Äôs dive into the world of simple Kubernetes backups with Velero!\n\n### üöÄ Prerequisites\n\nBefore we start, I assume you have the following:\n\n- [AWS](https://aws.amazon.com/) and [GitHub](https://github.com/) accounts.\n- [Terraform](https://www.terraform.io/) installed and configured.\n- The [AWS CLI](https://aws.amazon.com/cli/) installed and configured.\n- [Velero](https://velero.io/) installed.\n- [Terragrunt](https://terragrunt.gruntwork.io/)\n\n## ‚ùÑ The Workflow Landscape\n\n![workflow](./workflow.png)\n\nVelero is ideal for disaster recovery use cases, as well as for snapshotting your application state prior to performing system operations on your cluster (e.g., upgrades).\n\n### ‚≠êÔ∏è Velero Backup Workflow\n\nWhen you run `velero backup create test-backup`:\n\n1. The Velero client makes a call to the Kubernetes API server to create a Backup object.\n2. The `BackupController` notices the new Backup object and performs validation.\n3. The `BackupController` begins the backup process by collecting the data to back up by querying the API server for resources.\n4. The `BackupController` makes a call to the object storage service (e.g., [AWS S3](https://aws.amazon.com/s3/)) to upload the backup file.\n\nBy default, `velero backup create` makes disk snapshots of any persistent volumes. You can adjust the snapshots by specifying additional flags. Run `velero backup create --help` to see available flags. Snapshots can be disabled with the option `--snapshot-volumes=false`.\n\n![logo](./logo.png)\n\n## Streamline Infrastructure Automation with Terraform and Terragrunt\n\nAutomating infrastructure provisioning with [Terraform](https://www.terraform.io/) is a seamless process. By leveraging the comprehensive [AWS provider](https://registry.terraform.io/providers/hashicorp/aws/latest) available in the Terraform registry, setting up EKS, OIDC, and Velero resources becomes effortless.\n\nHowever, before diving into infrastructure automation, it's crucial to ensure that the Terraform provider is properly configured to interact with the target AWS account. Once configured, Terraform empowers you to effortlessly orchestrate the deployment of complex infrastructure setups, enabling you to focus on higher-level tasks and freeing up valuable time and resources.\n\n## üåê Provision of the EKS, OIDC, and Velero Resources on AWS\n\nThe Terraform configuration is organized as shown below:\n\n![code](./code.png)\n\n### Initialize the Infrastructure on an AWS Account\n\nFirst, update the content of the local Terragrunt variable called `aws_profile` in the file named [terragrunt-global-config.hcl](https://github.com/seifrajhi/aws-eks-irsa/blob/main/terraform/terragrunt-global-config.hcl) to point to your AWS profile instead of mine üòâ.\n\nOnce this is done, you can apply the infrastructure with Terragrunt as follows:\n\n```shell\ncd terraform\nterragrunt run-all init\nterragrunt run-all apply\n```\n\n- The first Terragrunt command will run `terraform init` in every Terraform layer in the `terraform` folder.\n- The second Terragrunt command will run `terraform apply` in each layer.\n\nOn the first apply, Terragrunt will ask if you want to create the Terraform states S3 bucket if it does not exist on your AWS account. It will also create a DynamoDB table for state locking.\n\n### How is the AWS IAM OIDC Provider Created?\n\nBy default, the IAM OIDC provider is created by the [AWS EKS Blueprints for Terraform](https://github.com/aws-ia/terraform-aws-eks-blueprints/) with the input `enable_irsa` set to true.\n\nTo demonstrate how it works, I set that input to false and created the OIDC provider with the AWS provider resources myself (you can find those resources in the file named `irsa.tf`).\n\n### How are the Velero Resources Created?\n\nThe Velero resources are defined in the `velero.tf` file, where configurations for backups, restores, and other Velero functionalities are specified. This Terraform script ensures the creation and configuration of Velero-related resources, enabling efficient data backups and restores for your infrastructure within the defined AWS environment.\n\n###  How to Manage Velero: Technical Aspect\n\nAfter installing the Velero server on the EKS cluster, you can view Velero's server-side components by running:\n\n```shell\nkubectl get all -n velero\n```\n\nWhere `velero` is the namespace where all Velero components are running.\n\nVelero also uses a number of CRDs (Custom Resource Definitions) to represent its own resources like backups, backup schedules, etc.\n\n```shell\nkubectl get crd | grep velero\n```\n\n### Deploy Test Application\n\nThis step involves deploying a sample application to validate the infrastructure setup and ensure successful integration of the components.\n\nCreate a namespace and deploy the application:\n\n![app-test](./app-test.png)\n\nThen verify the deployed application:\n\n![get](./get.png)\n\n### üíæ Backups\n\nNow, let's look into backups in case something happens to the blog. Backups are for Kubernetes resources and persistent volumes. You can back up your entire cluster, or optionally choose a namespace or label selector to back up. They can be run one-off or scheduled. It's a good idea to have scheduled backups so you are certain you have a recent backup to easily fall back to. You can also create backup hooks if you want to execute actions before or after a backup is made. By default, the backup retention is 30 days, but you can change it with the `-ttl` flag.\n\nTo see what all you can do with backups, run:\n\n![bckp](./bckp.png)\n\nLet's start with the most basic option: creating a one-off backup. It's a good idea to give it a meaningful name so you remember what it was for, unlike what is done here.\n\n![example](./example.png)\n\nIf we want to do a backup with all namespaces included, we can remove the flag `--include-namespaces`. And to include all namespaces except specific ones, we could use `--exclude-namespaces` with the namespace(s) we don't want.\n\nLet's create a backup from a schedule.\n\n![schedule](./schedule.png)\n\nSee all of the backups created:\n\n![result](./result.png)\n\n## üí• Wreak Havoc\n\nNow that we have a happy cluster state and that most excellent blog you created‚Ä¶ let's nuke the demo.\n\nLet's say that someone (you) accidentally (definitely intentionally) deleted the demo namespace by running the following:\n\n```shell\nkubectl delete namespace demo\n```\n\nTry to connect to the demo again. Shoot‚Ä¶ Now the site is down and so is that super important blog post you just made. What now?\n\n### üîÑ Restore\n\nWell, it's a good thing you have backups! Now it's time to look into restoring from a backup. To see what all you can do with restore, run:\n\n```shell\nvelero restore -h\n```\n\nLet's now wait for all of the resources to be gone. First, check the output of `get all`:\n\n```shell\nkubectl get all -n demo\n```\n\nNote: It might take some time until everything is properly deleted; so you may run these commands above until they give you a (somewhat ominous) \"No resources found\" output.\n\nNow to perform a restore:\n\nTo take a look at what backups you have, you can run the following again:\n\n```shell\nvelero backup get\n```\n\nTo restore from the specific backup we created first:\n\nSo the big questions are:\nDid all the resources come back up?\n\nLet's find out. First, let's check to see if our resources are back and running:\n\n![restore](./restore.png)\n\n```shell\nkubectl get all -n demo\n```\n\nIt worked üéâ\n\n## üåü Conclusion üåü\n\nThis hands-on blog explored the simplified process of backing up a Kubernetes cluster using Velero. We delved into the magic of Velero, understanding its key components and how it seamlessly integrates with EKS. By following the step-by-step guide, readers can now confidently implement effective backup strategies for their EKS infrastructure, ensuring data resilience and peace of mind.\n\nVelero truly simplifies EKS backups, empowering organizations to safeguard their valuable data effortlessly.\n\nI hope you guys have enjoyed this hands-on tutorial and learned a bit more than what you knew before. Let me know if you have any questions related to this blog.\n\n<br>\n\n**_Until next time, „Å§„Å•„Åè üéâ_**\n\n> üí° Thank you for Reading !! üôåüèªüòÅüìÉ, see you in the next blog.ü§ò  _**Until next time üéâ**_\n\nüöÄ Thank you for sticking up till the end. If you have any questions/feedback regarding this blog feel free to connect with me:\n\n**‚ôªÔ∏è LinkedIn:** https://www.linkedin.com/in/rajhi-saif/\n\n**‚ôªÔ∏è X/Twitter:** https://x.com/rajhisaifeddine\n\n**The end ‚úåüèª**\n\n<h1 align=\"center\">üî∞ Keep Learning !! Keep Sharing !! üî∞</h1>\n\n**üìÖ Stay updated**\n\nSubscribe to our newsletter for more insights on AWS cloud computing and containers.\n","wordCount":{"words":1222},"frontmatter":{"id":"59c82e9da2b2254ec8bf6c8d","path":"/blog/eks-backup-velero/","humanDate":"Oct 20, 2024","fullDate":"2024-10-20","title":"EKS Backup Simplified: A Deep Dive into Velero's Magic","keywords":["AWS EKS","Velero","Kubernetes","Data protection"],"excerpt":"Discover how Velero simplifies EKS backups, ensuring data protection and recovery.","cover":{"childImageSharp":{"gatsbyImageData":{"layout":"fullWidth","placeholder":{"fallback":"data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAALABQDASIAAhEBAxEB/8QAFwAAAwEAAAAAAAAAAAAAAAAAAAMFAf/EABYBAQEBAAAAAAAAAAAAAAAAAAIAAf/aAAwDAQACEAMQAAABY2PjFQlm3//EABkQAAIDAQAAAAAAAAAAAAAAAAECAxARE//aAAgBAQABBQISAlmXOgra/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPwE//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPwE//8QAFhAAAwAAAAAAAAAAAAAAAAAAACBB/9oACAEBAAY/AiL/AP/EABsQAQEAAQUAAAAAAAAAAAAAAAEAEBExQWGR/9oACAEBAAE/IdiXMBu49iEjquP/2gAMAwEAAgADAAAAEE/v/8QAFxEAAwEAAAAAAAAAAAAAAAAAAAERIf/aAAgBAwEBPxBPCn//xAAXEQADAQAAAAAAAAAAAAAAAAAAAREh/9oACAECAQE/EGtIf//EABoQAQEBAQADAAAAAAAAAAAAAAERACExgeH/2gAIAQEAAT8QnYFYHDVFBjKb6eJvnJiveHm//9k="},"images":{"fallback":{"src":"/static/18baf81cd46c70dd0d0e4e67a3f2b6fd/1e21a/velero-cover.jpg","srcSet":"/static/18baf81cd46c70dd0d0e4e67a3f2b6fd/37bba/velero-cover.jpg 750w,\n/static/18baf81cd46c70dd0d0e4e67a3f2b6fd/1e21a/velero-cover.jpg 800w","sizes":"100vw"},"sources":[{"srcSet":"/static/18baf81cd46c70dd0d0e4e67a3f2b6fd/a66aa/velero-cover.webp 750w,\n/static/18baf81cd46c70dd0d0e4e67a3f2b6fd/b2a35/velero-cover.webp 800w","type":"image/webp","sizes":"100vw"}]},"width":1,"height":0.5625}}},"coverCredits":"Photo by Saifeddine Rajhi"}}},"pageContext":{"prevThought":{"frontmatter":{"path":"/blog/python-diagrams-as-code-architecture/","title":"Simplify Software architecture with Diagrams as Code DaC üìà","date":"2024-10-20 21:06:00"},"excerpt":"Using diagrams tool to visualize your architectureüî• üìä Introduction In the software development ecosystem, clear and effective‚Ä¶"},"nextThought":{"frontmatter":{"path":"/blog/eks-guardduty-security-protection/","title":"How Amazon GuardDuty can help keep Amazon EKS secure","date":"2024-10-20 20:40:00"},"excerpt":"Top-Notch Protection for EKS with Amazon GuardDuty üìö Introduction Amazon GuardDuty offers extended coverage, allowing for ongoing‚Ä¶"}}},"staticQueryHashes":["1271460761","1321585977"],"slicesMap":{}}