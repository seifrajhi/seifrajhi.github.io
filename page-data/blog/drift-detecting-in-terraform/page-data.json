{"componentChunkName":"component---src-templates-blog-template-js","path":"/blog/drift-detecting-in-terraform/","result":{"data":{"markdownRemark":{"html":"<blockquote>\n<p><strong>Maintaining consistency and reliability in your cloud environment.</strong></p>\n</blockquote>\n<h2 id=\"-introduction\" style=\"position:relative;\"><a href=\"#-introduction\" aria-label=\" introduction permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üìö Introduction</h2>\n<p>As <a href=\"https://en.wikipedia.org/wiki/Infrastructure_as_code\" target=\"_blank\" rel=\"noopener noreferrer\">infrastructure-as-code (IaC)</a> becomes the standard approach for managing cloud resources, it's important to ensure that the deployed infrastructure matches the defined configuration.</p>\n<p>However, changes can sometimes occur outside of the IaC process, leading to a state of <a href=\"https://developer.hashicorp.com/terraform/tutorials/state/resource-drift\" target=\"_blank\" rel=\"noopener noreferrer\"><strong>drift</strong></a> between the desired and actual infrastructure.</p>\n<p>Detecting and addressing this drift is essential for maintaining the reliability, security, and consistency of your cloud environment.</p>\n<p>In this blog post, we'll explore three powerful open-source tools that can help you detect drift in your <a href=\"https://www.terraform.io/\" target=\"_blank\" rel=\"noopener noreferrer\">Terraform</a>-managed infrastructure.</p>\n<h2 id=\"preamble\" style=\"position:relative;\"><a href=\"#preamble\" aria-label=\"preamble permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Preamble</h2>\n<p>Suppose that you have a S3 bucket and you already created it via terraform code block at day1 your infra and real life state goes like that;</p>\n<h3 id=\"day1\" style=\"position:relative;\"><a href=\"#day1\" aria-label=\"day1 permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Day1</h3>\n<p>When you run your IAC stack it your entire state graphic would be like that:</p>\n<p><span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 63.52941176470588%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAAsTAAALEwEAmpwYAAABiElEQVR42oWTSVPCQBCF8/88WZayhOnpWZMAKli4FQfkgN79w8+eSUQEKhxeMtm+ea+7U2itoWkiUsjrHpFmzHiILV/hw11jU4/wHMZ4CyPsmgGmVqFIIGXvQaa6CFWimVFY+ohFrLCKBveOsAyMl6gQWYBMJcq4hnIPSGstLs4DOScp3ROG9Q639ScG/hWDsMbN9Bt3fg2ivcPmrEPuRJqytFZyNtBs23fYdHKi1kiRdlV2BmXqPTBDiHJEEhl52QrEGhGnzejI/d91kS4mTmqYdskPBEQJYjGXes2tQWMYwTgE6+FtBXMC1IdAFuBje0NcsUQIboqZi/ASkTsHOTZRdtzXOAEaAS7FlXxsonTNIxrTReY8Kvqfjhp1AhRQKWPjJVLtqrbwUldO7lJNj6U7Ha4PgaVbgOoNYniUxjTSoGmvSJqXJkIlSe2Vnf+bjmIc3kHhGSSjM8kfNRfUgkfVFmV4k3It2j9N/46NHIbN135w9bmY5yJnR+pkhNqm+NVR4fvU35QffasqULJvzPYAAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"alt text\" title=\"\" src=\"/static/7802fa602b6ef50cb2f9b28bc49216ff/c5bb3/day1.png\" srcset=\"/static/7802fa602b6ef50cb2f9b28bc49216ff/04472/day1.png 170w,\n/static/7802fa602b6ef50cb2f9b28bc49216ff/9f933/day1.png 340w,\n/static/7802fa602b6ef50cb2f9b28bc49216ff/c5bb3/day1.png 680w,\n/static/7802fa602b6ef50cb2f9b28bc49216ff/5a190/day1.png 800w\" sizes=\"(max-width: 680px) 100vw, 680px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n    </span>\n          </p>\n<h3 id=\"day2\" style=\"position:relative;\"><a href=\"#day2\" aria-label=\"day2 permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Day2</h3>\n<p>After any kind of manual changes your IAC stack do not cover the entire state.</p>\n<p>Now your terraform stack looks like that:</p>\n<p><span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 68.23529411764706%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAAAsTAAALEwEAmpwYAAABwElEQVR42q2Ty27bMBBF9UVd9Re66CptGvghkcPhS0/LEpwH7Bgo2sZoF/3o25GjOggcJSjQxcUI1PAMOXOZGGNgSOMYJ8QiRRbBZPjNH3AIF/hZXWEfZziUX/CrniE3hPfxComRjyxuQewxfL8E1JqRc4baE8r8FrbYwsYeJqxh4g2cC7BEeOc/D0CDLNyCjHsGHE6liWG0QVfOsft+gdA6zMI3pPEOqe+RhjssygcoW0uewseQDUCGdu0ZTA2ncil220/Y3F+if7hE2c1lI4Epkzx1FFMq8bFlTOYRqHx3AtJQQH7UhcL2xxzdgRCuC8RNBdcWIOnlUzt41FN7ngG1LDipVlqDpgngpoKvpEBmoZSTXnoBulcHOALXkkjwzChclAFo2SwJWuD9EoWoul6g6JbIV3JFuQERTwEJqVsjWo/S+fGkdIxDEbYaLirUN/MjvNosEZtU1qWHdO6KRFm5llih8CUUB7FPgBnjSSYgy3LEltDuZ1jtluC6lsLxzGpJGu9BYgNykuBWE2qg/aD2qGX8KtbZQ9viNOETcDD0ojyMld7SuJF58hGMQ+knE14WvTblt9/yvyj5X6C/wD+kGlVzczs9CQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"alt text\" title=\"\" src=\"/static/ef20572d798fecbb9d5933f6f80f799a/c5bb3/day2.png\" srcset=\"/static/ef20572d798fecbb9d5933f6f80f799a/04472/day2.png 170w,\n/static/ef20572d798fecbb9d5933f6f80f799a/9f933/day2.png 340w,\n/static/ef20572d798fecbb9d5933f6f80f799a/c5bb3/day2.png 680w,\n/static/ef20572d798fecbb9d5933f6f80f799a/5a190/day2.png 800w\" sizes=\"(max-width: 680px) 100vw, 680px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n    </span>\n          </p>\n<p>In this graph the greenfield represents the drifted config space.That meaning is your real-state is far away from your current terraform state.</p>\n<p>And if you want to maintain your resources via codebase that would be fail because your terraform state will overlap and override the manual changes.</p>\n<p>This is a very common, known and big problem in many organization so to fix that problem you can close the console access and manage everything via platform pipelines, according to the circumstances of your organizational structure.</p>\n<h2 id=\"-driftctl\" style=\"position:relative;\"><a href=\"#-driftctl\" aria-label=\" driftctl permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>üöÄ Driftctl</h2>\n<p><img src=\"/e18a5433fd5c582ae1ae6ef10e5b5376/driftctl.svg\" alt=\"alt text\" loading=\"lazy\">\n          </p>\n<p><a href=\"https://terragrunt.gruntwork.io/\" target=\"_blank\" rel=\"noopener noreferrer\"><strong>Driftctl</strong></a> is a command-line interface (CLI) tool that specializes in detecting drift between your Terraform configuration and the actual state of your cloud resources. Driftctl offers several key features:</p>\n<ul>\n<li><strong>Comprehensive Drift Detection</strong>: Driftctl can identify both managed and unmanaged resources, providing a complete picture of the differences between your Terraform configuration and the live infrastructure.</li>\n<li><strong>Customizable Alerts</strong>: You can configure Driftctl to trigger alerts based on specific drift conditions, helping you stay on top of infrastructure changes.</li>\n<li><strong>Diff Generation</strong>: Driftctl generates detailed diffs, making it easy to understand the nature and scope of the detected drift.</li>\n<li><strong>CI/CD Integration</strong>: Driftctl can be seamlessly integrated into your continuous integration and continuous deployment (CI/CD) pipelines, enabling automated drift detection and remediation.</li>\n</ul>\n<blockquote>\n<p>This project is now in maintenance mode. maintainers cannot promise to review contributions üò¢.</p>\n<p>Please feel free to fork the project to apply any changes you might want to make.</p>\n</blockquote>\n<h2 id=\"terragrunt\" style=\"position:relative;\"><a href=\"#terragrunt\" aria-label=\"terragrunt permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Terragrunt</h2>\n<p><a href=\"https://terragrunt.gruntwork.io/\" target=\"_blank\" rel=\"noopener noreferrer\">Terragrunt</a> is a wrapper tool for Terraform that simplifies the management of complex Terraform configurations. Terragrunt includes built-in drift detection capabilities that compare your desired infrastructure state with the actual deployed resources.\nDrift Identification: Terragrunt provides clear and concise information about any detected drift, highlighting the differences between your Terraform configuration and the live infrastructure.\nAutomated Remediation: Terragrunt makes it easy to plan and apply the necessary changes to correct the identified drift, ensuring your infrastructure remains in sync with your Terraform configuration.</p>\n<p><a href=\"https://github.com/WoodProgrammer/haydarctl/tree/master\" target=\"_blank\" rel=\"noopener noreferrer\">Haydarctl</a>: is a very simple tool that just run the built-in terragrunt commands to compare states between each others.</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">terragrunt plan <span class=\"token operator\">&amp;</span> refresh</code></pre></div>\n<p>And it generates a simple markdown output according to the results.</p>\n<h2 id=\"atlantis\" style=\"position:relative;\"><a href=\"#atlantis\" aria-label=\"atlantis permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Atlantis</h2>\n<p><a href=\"https://www.runatlantis.io/\" target=\"_blank\" rel=\"noopener noreferrer\">Atlantis</a> is a self-hosted GitOps tool for Terraform that integrates with your continuous integration (CI) pipeline. Atlantis includes drift detection features that compare your Terraform configurations with the deployed infrastructure.</p>\n<ul>\n<li>\n<p><strong>GitOps Workflow with Atlantis</strong>:</p>\n<ul>\n<li>Seamless integration with your Git repository.</li>\n<li>Manage infrastructure changes through pull requests and merge approvals.</li>\n<li>Ensures all changes are tracked, reviewed, and approved before being applied.</li>\n<li>Maintains a high level of control and accountability.</li>\n</ul>\n</li>\n<li>\n<p><strong>Drift Visualization</strong>:</p>\n<ul>\n<li>User-friendly interface for visualizing and reviewing detected drift.</li>\n<li>Easier understanding and addressing of discrepancies between Terraform configuration and actual state.</li>\n<li>Provides clear and actionable insights.</li>\n<li>Helps maintain consistency and reliability in your cloud environment.</li>\n</ul>\n</li>\n</ul>\n<p><a href=\"https://github.com/cresta/atlantis-drift-detection\" target=\"_blank\" rel=\"noopener noreferrer\">atlantis-drift-detection</a> is an open-source solution for detecting and addressing drift in Terraform infrastructure managed by the Atlantis GitOps tool. Key features include automated drift detection, drift notification, untracked workspace notification, caching, and drift remediation through an example GitHub workflow.</p>\n<h2 id=\"terraform-plan\" style=\"position:relative;\"><a href=\"#terraform-plan\" aria-label=\"terraform plan permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>terraform plan</h2>\n<p>The <a href=\"https://developer.hashicorp.com/terraform/cli/commands/plan\" target=\"_blank\" rel=\"noopener noreferrer\">Terraform CLI</a> inherently detects drift for Terraform-managed resources when we run the <code class=\"language-text\">terraform plan</code> command. Any resources that have \"drifted\" in the remote cloud environment will be picked up as unexpected changes in the plan output.</p>\n<p>Unfortunately, <code class=\"language-text\">terraform plan</code> is unable to identify resources that are currently unmanaged by Terraform.</p>\n<p>Interestingly, many enterprise drift detection offerings from products like <a href=\"https://www.hashicorp.com/blog/terraform-cloud-adds-drift-detection-for-infrastructure-management\" target=\"_blank\" rel=\"noopener noreferrer\">Terraform Cloud</a> and <a href=\"https://spacelift.io/drift-detection\" target=\"_blank\" rel=\"noopener noreferrer\">Spacelift</a> are running managed, regular <code class=\"language-text\">terraform plan</code> commands under the hood.</p>\n<p><strong>Pros:</strong></p>\n<ul>\n<li>Natively integrated into the Terraform CLI.</li>\n<li>Out-of-the-box support for all cloud resources that can be managed by Terraform.</li>\n</ul>\n<p><strong>Cons:</strong></p>\n<ul>\n<li>Generally run only when trying to deploy infrastructure changes, which is not an ideal time to discover drift.</li>\n<li>Blind to cloud resources that are not already managed by Terraform.</li>\n</ul>\n<h2 id=\"terraformer\" style=\"position:relative;\"><a href=\"#terraformer\" aria-label=\"terraformer permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>terraformer</h2>\n<p><a href=\"https://github.com/GoogleCloudPlatform/terraformer\" target=\"_blank\" rel=\"noopener noreferrer\"><code class=\"language-text\">terraformer</code></a> is a popular tool for generating Terraform from existing cloud resources. It supports resources across all major cloud providers and many other smaller Terraform providers. Originally built by developers at Waze, the repo is now maintained by Google Cloud's GitHub organization.</p>\n<p><strong>Pros:</strong></p>\n<ul>\n<li>Create codified versions of an entire cloud subset, including resources that are outside of Terraform control, providing the information needed to match that given by Driftctl.</li>\n</ul>\n<p><strong>Cons:</strong></p>\n<ul>\n<li>Requires manual comparison against the current Terraform configuration to determine what has drifted and what resources are not yet controlled by Terraform.</li>\n<li>Repository is maintained irregularly, with infrequent commits and most issues closed while in \"stale\" status.</li>\n<li>Due to a reliance on internal Terraform packages, which were moved to internal/ sub-directories in subsequent releases, <code class=\"language-text\">terraformer</code> only directly supports Terraform 0.13.</li>\n<li>Not all cloud resources are supported by the tool.</li>\n</ul>\n<h2 id=\"conclusion\" style=\"position:relative;\"><a href=\"#conclusion\" aria-label=\"conclusion permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Conclusion</h2>\n<p>Configuration drift is a big trouble for the IAC and it is a very big problem to provide automation, idempotency, reusability and secure infrastructure, regarding to that you have to be care about the real and terraform states.\nThe open-source tools explored in this blog post provide powerful capabilities to detect and address drift in Terraform-managed infrastructure.</p>\n<h2 id=\"references\" style=\"position:relative;\"><a href=\"#references\" aria-label=\"references permalink\" class=\"anchor before\"><svg class=\"anchor-icon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>References</h2>\n<ul>\n<li><a href=\"https://www.reddit.com/r/devops/comments/18ba8xq/open_source_tools_to_detect_infrastructure_change/\" target=\"_blank\" rel=\"noopener noreferrer\">https://www.reddit.com/r/devops/comments/18ba8xq/open_source_tools_to_detect_infrastructure_change/</a></li>\n<li><a href=\"https://github.com/GoogleCloudPlatform/terraformer\" target=\"_blank\" rel=\"noopener noreferrer\">https://github.com/GoogleCloudPlatform/terraformer</a></li>\n<li><a href=\"https://medium.com/@hello_9187/open-source-driftctl-alternatives-fbe79f1a2d94\" target=\"_blank\" rel=\"noopener noreferrer\">https://medium.com/@hello_9187/open-source-driftctl-alternatives-fbe79f1a2d94</a></li>\n<li><a href=\"https://emirozbirdeveloper.medium.com/configuration-drifts-and-ha-dd55132b2132\" target=\"_blank\" rel=\"noopener noreferrer\">https://emirozbirdeveloper.medium.com/configuration-drifts-and-ha-dd55132b2132</a></li>\n</ul>\n<br>\n<p><strong><em>Until next time, „Å§„Å•„Åè üéâ</em></strong></p>\n<blockquote>\n<p>üí° Thank you for Reading !! üôåüèªüòÅüìÉ, see you in the next blog.ü§ò  <em><strong>Until next time üéâ</strong></em></p>\n</blockquote>\n<p>üöÄ Thank you for sticking up till the end. If you have any questions/feedback regarding this blog feel free to connect with me:</p>\n<p><strong>‚ôªÔ∏è LinkedIn:</strong> <a href=\"https://www.linkedin.com/in/rajhi-saif/\" target=\"_blank\" rel=\"noopener noreferrer\">https://www.linkedin.com/in/rajhi-saif/</a></p>\n<p><strong>‚ôªÔ∏è X/Twitter:</strong> <a href=\"https://x.com/rajhisaifeddine\" target=\"_blank\" rel=\"noopener noreferrer\">https://x.com/rajhisaifeddine</a></p>\n<p><strong>The end ‚úåüèª</strong></p>\n<h1 align=\"center\">üî∞ Keep Learning !! Keep Sharing !! üî∞</h1>\n<p><strong>üìÖ Stay updated</strong></p>\n<p>Subscribe to our newsletter for more insights on AWS cloud computing and containers.</p>","timeToRead":4,"rawMarkdownBody":"\n> **Maintaining consistency and reliability in your cloud environment.**\n\n## üìö Introduction\n\nAs [infrastructure-as-code (IaC)](https://en.wikipedia.org/wiki/Infrastructure_as_code) becomes the standard approach for managing cloud resources, it's important to ensure that the deployed infrastructure matches the defined configuration.\n\nHowever, changes can sometimes occur outside of the IaC process, leading to a state of [**drift**](https://developer.hashicorp.com/terraform/tutorials/state/resource-drift) between the desired and actual infrastructure.\n\nDetecting and addressing this drift is essential for maintaining the reliability, security, and consistency of your cloud environment.\n\nIn this blog post, we'll explore three powerful open-source tools that can help you detect drift in your [Terraform](https://www.terraform.io/)-managed infrastructure.\n\n## Preamble\n\nSuppose that you have a S3 bucket and you already created it via terraform code block at day1 your infra and real life state goes like that;\n\n### Day1\n\nWhen you run your IAC stack it your entire state graphic would be like that:\n\n![alt text](./day1.png)\n\n### Day2\n\nAfter any kind of manual changes your IAC stack do not cover the entire state.\n\nNow your terraform stack looks like that:\n\n![alt text](./day2.png)\n\nIn this graph the greenfield represents the drifted config space.That meaning is your real-state is far away from your current terraform state.\n\nAnd if you want to maintain your resources via codebase that would be fail because your terraform state will overlap and override the manual changes.\n\nThis is a very common, known and big problem in many organization so to fix that problem you can close the console access and manage everything via platform pipelines, according to the circumstances of your organizational structure.\n\n## üöÄ Driftctl\n\n![alt text](./driftctl.svg)\n\n[**Driftctl**](https://terragrunt.gruntwork.io/) is a command-line interface (CLI) tool that specializes in detecting drift between your Terraform configuration and the actual state of your cloud resources. Driftctl offers several key features:\n\n- **Comprehensive Drift Detection**: Driftctl can identify both managed and unmanaged resources, providing a complete picture of the differences between your Terraform configuration and the live infrastructure.\n- **Customizable Alerts**: You can configure Driftctl to trigger alerts based on specific drift conditions, helping you stay on top of infrastructure changes.\n- **Diff Generation**: Driftctl generates detailed diffs, making it easy to understand the nature and scope of the detected drift.\n- **CI/CD Integration**: Driftctl can be seamlessly integrated into your continuous integration and continuous deployment (CI/CD) pipelines, enabling automated drift detection and remediation.\n\n> This project is now in maintenance mode. maintainers cannot promise to review contributions üò¢.\n> \n> Please feel free to fork the project to apply any changes you might want to make.\n\n## Terragrunt\n\n[Terragrunt](https://terragrunt.gruntwork.io/) is a wrapper tool for Terraform that simplifies the management of complex Terraform configurations. Terragrunt includes built-in drift detection capabilities that compare your desired infrastructure state with the actual deployed resources.\nDrift Identification: Terragrunt provides clear and concise information about any detected drift, highlighting the differences between your Terraform configuration and the live infrastructure.\nAutomated Remediation: Terragrunt makes it easy to plan and apply the necessary changes to correct the identified drift, ensuring your infrastructure remains in sync with your Terraform configuration.\n\n[Haydarctl](https://github.com/WoodProgrammer/haydarctl/tree/master): is a very simple tool that just run the built-in terragrunt commands to compare states between each others.\n\n```shell\nterragrunt plan & refresh\n```\n\nAnd it generates a simple markdown output according to the results.\n\n## Atlantis\n\n[Atlantis](https://www.runatlantis.io/) is a self-hosted GitOps tool for Terraform that integrates with your continuous integration (CI) pipeline. Atlantis includes drift detection features that compare your Terraform configurations with the deployed infrastructure.\n\n- **GitOps Workflow with Atlantis**:\n  - Seamless integration with your Git repository.\n  - Manage infrastructure changes through pull requests and merge approvals.\n  - Ensures all changes are tracked, reviewed, and approved before being applied.\n  - Maintains a high level of control and accountability.\n\n- **Drift Visualization**:\n  - User-friendly interface for visualizing and reviewing detected drift.\n  - Easier understanding and addressing of discrepancies between Terraform configuration and actual state.\n  - Provides clear and actionable insights.\n  - Helps maintain consistency and reliability in your cloud environment.\n\n[atlantis-drift-detection](https://github.com/cresta/atlantis-drift-detection) is an open-source solution for detecting and addressing drift in Terraform infrastructure managed by the Atlantis GitOps tool. Key features include automated drift detection, drift notification, untracked workspace notification, caching, and drift remediation through an example GitHub workflow.\n\n## terraform plan\n\nThe [Terraform CLI](https://developer.hashicorp.com/terraform/cli/commands/plan) inherently detects drift for Terraform-managed resources when we run the `terraform plan` command. Any resources that have \"drifted\" in the remote cloud environment will be picked up as unexpected changes in the plan output.\n\nUnfortunately, `terraform plan` is unable to identify resources that are currently unmanaged by Terraform.\n\nInterestingly, many enterprise drift detection offerings from products like [Terraform Cloud](https://www.hashicorp.com/blog/terraform-cloud-adds-drift-detection-for-infrastructure-management) and [Spacelift](https://spacelift.io/drift-detection) are running managed, regular `terraform plan` commands under the hood.\n\n**Pros:**\n\n- Natively integrated into the Terraform CLI.\n- Out-of-the-box support for all cloud resources that can be managed by Terraform.\n\n**Cons:**\n\n- Generally run only when trying to deploy infrastructure changes, which is not an ideal time to discover drift.\n- Blind to cloud resources that are not already managed by Terraform.\n\n## terraformer\n\n[`terraformer`](https://github.com/GoogleCloudPlatform/terraformer) is a popular tool for generating Terraform from existing cloud resources. It supports resources across all major cloud providers and many other smaller Terraform providers. Originally built by developers at Waze, the repo is now maintained by Google Cloud's GitHub organization.\n\n**Pros:**\n\n- Create codified versions of an entire cloud subset, including resources that are outside of Terraform control, providing the information needed to match that given by Driftctl.\n\n**Cons:**\n\n- Requires manual comparison against the current Terraform configuration to determine what has drifted and what resources are not yet controlled by Terraform.\n- Repository is maintained irregularly, with infrequent commits and most issues closed while in \"stale\" status.\n- Due to a reliance on internal Terraform packages, which were moved to internal/ sub-directories in subsequent releases, `terraformer` only directly supports Terraform 0.13.\n- Not all cloud resources are supported by the tool.\n\n## Conclusion\n\nConfiguration drift is a big trouble for the IAC and it is a very big problem to provide automation, idempotency, reusability and secure infrastructure, regarding to that you have to be care about the real and terraform states.\nThe open-source tools explored in this blog post provide powerful capabilities to detect and address drift in Terraform-managed infrastructure.\n\n## References\n\n- https://www.reddit.com/r/devops/comments/18ba8xq/open_source_tools_to_detect_infrastructure_change/\n- https://github.com/GoogleCloudPlatform/terraformer\n- https://medium.com/@hello_9187/open-source-driftctl-alternatives-fbe79f1a2d94\n- https://emirozbirdeveloper.medium.com/configuration-drifts-and-ha-dd55132b2132\n  \n<br>\n\n**_Until next time, „Å§„Å•„Åè üéâ_**\n\n> üí° Thank you for Reading !! üôåüèªüòÅüìÉ, see you in the next blog.ü§ò  _**Until next time üéâ**_\n\nüöÄ Thank you for sticking up till the end. If you have any questions/feedback regarding this blog feel free to connect with me:\n\n**‚ôªÔ∏è LinkedIn:** https://www.linkedin.com/in/rajhi-saif/\n\n**‚ôªÔ∏è X/Twitter:** https://x.com/rajhisaifeddine\n\n**The end ‚úåüèª**\n\n<h1 align=\"center\">üî∞ Keep Learning !! Keep Sharing !! üî∞</h1>\n\n**üìÖ Stay updated**\n\nSubscribe to our newsletter for more insights on AWS cloud computing and containers.\n","wordCount":{"words":1058},"frontmatter":{"id":"2fa2ee31c68ecf01f6c5cf7d","path":"/blog/drift-detecting-in-terraform/","humanDate":"Oct 17, 2024","fullDate":"2024-10-17","title":"Open-source Tools for detecting drift in Terraform-managed Infrastructure","keywords":["Terraform","Drift detection","Open-source tools","Cloud infrastructure","Consistency","Reliability"],"excerpt":"Various open-source tools designed to detect and manage drift in Terraform-managed infrastructure, ensuring consistency and reliability in your cloud environment.","cover":{"childImageSharp":{"gatsbyImageData":{"layout":"fullWidth","placeholder":{"fallback":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAAsTAAALEwEAmpwYAAADQElEQVR42h2S608adhSG+bhkibs0WbXardFkNVobLwVi5CYid1QUL4CAsCIgIqCTtniZF1AHDop2UqOmrsO0tuslrq3O7sOW/mHPftmHN+ckJ+c5l7ySmmtSGpsM1FxXCqm5eqOHmps2ahr7qWtzU98Z4KY6RK10gkbN1P+qlfq50RkUNSF5kLrWCZoVMWpbfEi+q+/GF0jTPxRDpnShNkcwjcyhsE5j9SzTYkig92YYCuexB/MYRK5zr2H0ZLDfzeGMFOl2LGJxZ5iIFZFU19n4qtqAyhzDOpKiTeWjXR+l3TaHcnSJHk+WsfgOxokcjvCOAObov1vCFvgFk2cLi/dn9M41ZKYHVDWOI/mmYZSqGj0a8wyG0RVuGeLI7fdp0MVQj6+j8+UYmSmLuM1o4oi+8D6D0QO887/hnDkgvnKCfTKP1JLm6+YAks+uGbjeFkBjXGIydsIVWYjPb/tE8y6e1GMc8X2mVp7jFoDZ7Qtm8xdMZ9/iSj1DPrJDm22TBvV9qqVRrnaEkHzRNEaXs0hk+Zx7P71Dbl3iSmcYreehmHxEj78koMf8sPCWma2PJAufmMr/g3f1AmviFGP0KQpXiY6BDeo1c0i+lPmROrexpV8wMltBO5zjjnUVc2QfU7yMKVLBFv2d4fSfDKbe4Fx4hyN1hjb4BEv0BGPoGKX/EW3DWfEmAaxWR6ntneN7f452zzZ6sxOvK0E8+wp/pkwo+4nutUua0mdIk2/oDJ8KQIXesWMs9kPs+j3MA7vIfAWaB5aR1GkTfKtLctu+QsvgFn9Vynw8PWU88Qc/Lr9nIfcv3auXtCdf0xk6ZSL/N1OFS8zDB9iNZZyqHcYsexiSFVSBPQFUTHPLIuzhLtDQlyW0uIk9voVj6imZ9Q+kF87QCJhi5hUKb4XAxjnzpXN0lke4xXb+rod4e8Wf772kJ3SIpF4W4Y5pCdVQEXd8m71ykSprhC5PnpSAZbIfcC28Ryu204kzu61lVD0F+s2HjKt2CbfmiOlL9E0+RukrCR92BGjpnaejf51gssDs+iahpU2MwSLOpLDK2muCD14yHHnOoOsJ444jvKZfcWuKBLVFJls3MGvSKF2LyN3r/AeANQVdBMSefgAAAABJRU5ErkJggg=="},"images":{"fallback":{"src":"/static/1df251a43046748c454a180e9d226982/03644/drift-cover.png","srcSet":"/static/1df251a43046748c454a180e9d226982/23c6c/drift-cover.png 750w,\n/static/1df251a43046748c454a180e9d226982/03644/drift-cover.png 800w","sizes":"100vw"},"sources":[{"srcSet":"/static/1df251a43046748c454a180e9d226982/f8e3a/drift-cover.webp 750w,\n/static/1df251a43046748c454a180e9d226982/e9972/drift-cover.webp 800w","type":"image/webp","sizes":"100vw"}]},"width":1,"height":0.5750000000000001}}},"coverCredits":"Photo by Saifeddine Rajhi"}}},"pageContext":{"prevThought":{"frontmatter":{"path":"/blog/awslimitchecker-service-limits/","title":"Stay within bounds: Using AwsLimitChecker to manage AWS Service limits","date":"2024-10-17 18:06:00"},"excerpt":"Proactive AWS Service Limit Management üí° Introduction Nowadays, we rely on Amazon Web Services (AWS) for a lot of our cloud-based stuff at‚Ä¶"},"nextThought":{"frontmatter":{"path":"/blog/eks-cloudtrail-audit-logs/","title":"Amazon EKS: Analyze control plane and CloudTrail logs for better detective controls","date":"2024-10-17 15:06:00"},"excerpt":"Get visibility into EKS activities and AWS API calls for better security monitoring üìö Introduction In this blog post, we‚Äôll explore how to‚Ä¶"}}},"staticQueryHashes":["1271460761","1321585977"],"slicesMap":{}}